EDIInvoiceMatchInterfaceInput is a BusinessClass
    owned by ma
    prefix is W2295

    Ontology
    	symbolic key is EDIInvoiceMatchInterfaceInput

    Patterns
        disable AuditIndex
		disable Auditing 
       	disable EffectiveDated
       	disable DataTranslations

    Persistent Fields
    	RunGroup
        RecordType                 is AlphaUpper size 1
        	States
        		InvoiceHeader		value is "H"
        		InvoiceDetail		value is "D"
        		InvoiceDistribution	value is "A"
        		MiscAddOnCharge		value is "M"
        		LineAddOnCharge		value is "C"

        Company                 	is a MatchCompany
        Vendor                  	is like Vendor
        OldVendor            		is like OldVendor
        PayVendor                   is like Vendor
        InterfacedPayVendor			is like OldVendor
        EDINumber               	is like EDINumber 
        Invoice                 	is like Invoice
        Suffix                  	is like Suffix
        SeqNbr                  	is like SeqNbr
		ProcessType	        		  is AlphaUpper size 2
			default label is "InvoiceEntryTemplate"
	        States
				Basic			value is "B"
				Freight			value is "F"
	            MatchInvoice    value is "M"
	            AOCMatchInvoice value is "A"
	            ServiceContract value is "V"
        TaxCode                 	is like TaxCode
        TaxableUnitCost             is an InternationalCost
        Location                	is like InventoryLocation		
        PurchaseOrder				is like PurchaseOrder
        ExternalPurchaseOrder   	is Alpha size 22 
        ServiceContract         	is like Contract
		InterfacedPurchaseOrder		is like PurchaseOrderImport
		InterfacedPOCode            is like POCode
        BatchNumber             	is like BatchNumber 
        VoucherNumber           	is like VoucherNumber
		AuthorityCode				is like PayablesAuthorityCode 
        ProcessLevel            	is like PayablesProcessLevel		
        InvoiceType					is AlphaUpper size 1
            States
                Invoice               value is blank
                CreditMemo            value is "C"
                DebitMemo             value is "D"
            	MatchPrepayment       value is "R"
        InvoiceCurrency         	is like Currency
        InvoiceDate             	is Date   
        DueDate                 	is Date     
        DistributionDate        	is Date     
        PurchaseFromLocation    	is like PurchaseFromLocation		
        Description             	is like Description    
        InvoiceTransactionAmount    is like InternationalAmount
        AllowableAmountForDiscount  is like InternationalAmount
        TaxableAmount               is like InternationalAmount
        TaxAmount              		is like InternationalAmount
        BaseCurrencyConversionRate  is like CnvRate
        DiscountAmount              is like InternationalAmount
        DiscountPercent             is like DiscountRate 
        DiscountDate                is Date  
        DiscountAmount1             is like InternationalAmount
        DiscountAmount2             is like InternationalAmount
        DiscountAmount3             is like InternationalAmount
        DiscountPercent1            is like DiscountPercent 
        DiscountPercent2            is like DiscountPercent 
        DiscountPercent3            is like DiscountPercent 
        DiscountDate1               is Date    
        DiscountDate2               is Date    
        DiscountDate3               is Date     
        RemitToCode                 is like VendorLocation		
        RetailAmount                is like InternationalAmount
        InvoiceReceiptDate          is Date     
        ReasonCode                  is like ProcurementReasonCode
        Operator                   
        TermsCode                   is like TermsCode
        TaxAdjustment               is Alpha size 1
        PrintChargeback             is Boolean	
        MatchInvoiceUserField01 	is an InvUsrFld01
        MatchInvoiceUserField02 	is an InvUsrFld01
        MatchInvoiceUserField03 	is an InvUsrFld01
        MatchInvoiceUserField04 	is an InvUsrFld01
        MatchInvoiceUserField05 	is an InvUsrFld01
        VendorReturn            	is like VendorReturn		
        CostComponentMatch            is Boolean
        MatchCostComp           	is like InternationalCost
        	restricted
        	protected 
        HashQuantity            	is like Quantity
        RuleGroup               	is like MatchRule				
		MatchReferenceNumber		is like MatchReferenceNumber
        MatchPrepayment         	is Boolean	
        MatchPrepaymentMethod   	is like MatchPrepaymentMethod	
        ReferenceType		    	is like NordicReferenceType	
        CustomerID              	is like CustomerID 
        PaymentCategoryCode     	is like PaymentCategoryCode 
        NoPayConcern            	is like NoPayConcern 
        NatureOfTransactionCode 	is like NatureOfTransactionCode 
        UnloadingPort           	is like UnloadingPort 
        StatisticalProcedure    	is like IntrastatStatisticalProcedure 
        ShippingMethod          	is like ShipVia 
        ShipTerm                	is like ShipTerm		
        Dropship
        DiversityCode             	is like PayablesDiversityCode		
        PayImmediately              is a BooleanOverride
        FlexibleTermsFlag           is Boolean
        DistributionReference		is like Reference10 
        ContractRebateGroup
        GlobalDocumentType         	is like GlobalDocumentType		
        JournalBook             	is like JournalBook				
        	restricted
        	default label is "JournalBook"
		TransientPaymentNumber      is like TransactionNumber
        	default label is "PaymentNumber"
		TransientPaymentDate        is Date
        	default label is "PaymentDate"
		TransientPaymentAmount  	is like InternationalAmount
        	default label is "PaymentAmount"
        	

        LineNumber              	is like LineNumber
        AddOnCharge                 is like AddOnCharge
        Item                    	is like Item
        ItemDescription
        VendorItem              	is like VendorItem
        EnteredQuantity             is like Quantity
        EnteredUOM                  is like UnitOfMeasure
        UnitCost                	is like InternationalCost
        ExtendedAmount             	is like InternationalAmount
        TotalAddOnChargeAmount      is like InternationalAmount
        RetailUnitCost             	is like InternationalCost
		BuyUOMMatchedQuantity		is like Quantity
			default label is "BuyQuantity"
		VendorBuyUOM				is like UnitOfMeasure
        Account      				is a FinanceCodeBlock
        TaxIndicator
        InvoiceLineTaxable       	is Boolean
        TermsFlag               	is Alpha size 1
        CatchWeightCost         	is like InternationalCost
        LineTermsCode           	is like TermsCode				
        SupplementaryUOM           	is like UnitOfMeasure
        CommodityCode           	is like CommCodes			
        RetainagePercent            is like Pct	
        ItemGTIN                    is like ItemGTIN

        DistributionSequence   		is like SeqNbr
        DistributionAccount         is a FinanceCodeBlock
        OriginalTransactionAmount   is like InternationalAmount
        DistributionTaxableAmount   is like InternationalAmount
        DistributionDescription     is like Description    
        UnitAmount               	is like InternationalAmount	
        AssetDescription            is like Description    
        TagNumber                  	is like TagNumber
        ItemNumber                 is like AssetItemNumber
        ItemQuantity
        AssetTemplate           	is like AssetTemplate
        InServiceDate               is Date    
        PurchaseDate            	is Date    
        ModelNumber             	is like ModelNumber
        SerialNumber            	is like SerialNumber
        HoldAsset               	is Boolean	
        Asset                   	is like Asset
        ItemTaxTransaction			is like InternationalAmount
        AssetGroup              	is like AssetGroup
        Combine                 	is like Combine
        AccountingUnitGroup         is like AssetAccountingUnitGroup
        TaxUsageCode              	is like TaxUsageCode				
        DstUsrFld01             	is Alpha size 20
        DstUsrFld02             	is Alpha size 20
        DstUsrFld03             	is Alpha size 20
        DstUsrFld04             	is Alpha size 20
        DstUsrFld05             	is Alpha size 20
        GlobalLineType            	is like GlobalLineType

        ICNCode                 	is like ICNCode		
        LineType                    is AlphaUpper size 1
        StockWeight                 is like StockWeight 
        SupplementaryQuantity       is like Quantity

        MiscAddOnCharge				is like AddOnCharge
        MiscAddOnChargeAmount       is like InternationalAmount
        MiscellaneousAccount		is a FinanceCodeBlock
        AddOnChargePercent			
        AddOnChargeEntryMethod      is Alpha size 1
        LandedAddOnCharge           is Boolean
        LandedUnitCost          	is like InternationalCost
        ZeroCost                    is Boolean
        PrintOnPO                   is Boolean
        Summarize                   is Boolean
        CreatedDuringSpread			
        InvoicedTaxAmount        	is like InternationalAmount
        AccruedTaxAmount           	is like InternationalAmount
        BillingInvoiceAmount        is like InternationalAmount
        ExtTaxAmount            	is like InternationalAmount

		EAMWorkOrder
		EAMWorkOrderActivity
		EAMProjectID
		EAMProjectType
		EAMProjectTaxCode
		EAMManufacturing
    	EAMTrade
    	EAMCommodityCode
    	EAMLineType
    	Chemical					is Boolean
    	RebuildRepair				is Boolean
    	TestRequired				is Boolean

        CommentSeqNumber        	is Numeric size 1
        CommentName             	is like CommentName 
        CommentText             	is like CommentText 


        GlnCompany              	is like GlobalLocationNumber
        GlnVendor               	is like GlobalLocationNumber
        GlnLocation             	is like GlobalLocationNumber
        GlnPurchaseFromLocation    	is like GlobalLocationNumber
        GlnRemitTo              	is like GlobalLocationNumber
        GlnDtlDistCompany       	is like GlobalLocationNumber
        GlnDistCompany          	is like GlobalLocationNumber


		UseCompany					is like Company
		UseVendor					is like Vendor

		PayablesInvoice
			delete ignored
		Interfaced					is Boolean
		SystemAssignedInvoiceDetail   is like PayablesInvoiceDetail
		InvoiceGroup				is like PayablesInvoiceGroup		
    	EAMTool						is a EAMToolField  
    	InProgress					is Boolean
		HSNSACCode
		CreditMemoReferenceInvoice	is an Invoice
		IDMDocumentPID				is a DocumentPID
		CertificationNumber						
		CertificationDate			is Date		
		HoldCode                    is like PayablesHoldCode
				
	Transient Fields
		UseLocation 					is like InventoryLocation
		UsePurchaseFromLocation			is like PurchaseFromLocation
		UseRemitToCode					is like VendorLocation
		
    Local Fields
		LocalFinanceEnterpriseGroup		is like FinanceEnterpriseGroup
    	LocalRunGroup           		is a RunGroup
    	LocalCompany            		is like Company
		LocalErrorMessage       		is Alpha size 150
		LocalInterfaceResult            is like PayablesInvoiceInterfaceResult

    	InterfacedInvoice				is a PayablesInvoice view
		ErrorOccurred					is Boolean
		
		LocalVendor						is like Vendor
		LocalPurchaseOrder				is like PurchaseOrder

		ThisRunGroup					is like RunGroup
        ThisCompany						is like PayablesCompany
		ThisVendor						is like Vendor
		ThisOldVendor					is like OldVendor
		ThisEDINumber					is like EDINumber
		ThisInvoice						is like Invoice
		ThisSuffix						is like Suffix
		ThisPurchaseOrder				is like PurchaseOrder
		ThisInterfacedPurchaseOrder     is like PurchaseOrderImport
		ThisInterfacedPOCode            is like POCode

    	ImportedDistribution			is a PayablesInvoiceDistribution view
    	LocalDistribution				is like PayablesInvoiceDistribution

		LocalInvoiceDetailView          is a PayablesInvoiceDetail view

		NextSentence					is Boolean
		Counter							is Numeric 5
        Diff 							is Numeric size 16

        LocalSequence                  	is like SeqNbr
		
		LocalGlobalLocationNumberType   is like GlobalLocationNumberType
		LocalGlobalLocationNumber		is like GlobalLocationNumber

		CheckCompany					is like Company
		CheckPurchaseOrder				is like PurchaseOrder



		POLineLookup
		LocalTrigger					is Numeric 1
		LocalInterfaceAnalysis			is like InterfaceAnalysis

        LocalOriginalInvoice 			is like PayablesInvoice
		LocalOriginalInvoiceDetail 		is like PayablesInvoiceDetail
		LocalPOLine						is like LineNumber
		LocalContract					is like Contract
		LocalContractLine				is like LineNumber
		LocalQuantity					is like Quantity
		LocalUnitCost 					is like UnitCost
		AbsoluteUnitCost				is like UnitCost

	    QuantityAdjustment 				is Boolean
		CostAdjustment 					is Boolean
		
		LocalCXMLText					is Text

	Field Groups
		RunGroupCompany
   			RunGroup
   			Company
						
    Derived Fields
    	
    	InvoiceAlreadyExistsMessage is a MessageField
    		restricted
    		"PayablesInvoiceAlreadyCreated"
    
		CompanyRequiredMsg is a MessageField
			restricted
			"CompanyIsRequired"
			
    	NoDetailRecordsFoundMsg is a MessageField
    		restricted
    		"NoDetailRecordsFound"

		VendorRequiredMsg is a MessageField
			restricted
			"VendorIsRequired"
		    
		InterfacedVendorNotFoundMsg is a MessageField
			restricted
			"InterfacedVendorNotFound"

		InterfacedPayVendorNotFoundMsg is a MessageField
			restricted
			"InterfacedPayVendorNotFound"

		ProcessTypeRequiredMsg is a MessageField
			restricted
			"ProcessTypeRequired"


		DuplicateInvoiceMsg is a MessageField 
			restricted
			"ThisInvoiceIsEnteredTwiceInTheInterfaceSystem"

		PurchaseOrderRequiredMsg is a MessageField
			restricted
			"PurchaseOrderOrInterfacedPurchaseOrderRequiredForThisProcessType"

		InterfacedPurchaseOrderNotFoundMsg is a MessageField
			restricted
			"InterfacedPurchaseOrderNotFound"

		ServiceContractRequiredMsg is a MessageField
			restricted
			"ServiceContractRequiredForThisProcessType"

		InvalidProcessTypeMsg is a MessageField
			restricted
			"InvalidProcessType"

		InvoiceDetailNotAllowedForExpenseInvoiceMsg is a MessageField
			restricted
			"InvoiceDetailNotAllowedForExpenseInvoice"

		VendorItemDoesNotMatchPOLineMsg is a MessageField
			restricted
			"VendorItemDoesNotMatchPurchaseOrderLineVendorItem"
			
		VendorItemExistsOnMultiplePOLinesMsg is a MessageField
			restricted
			"VendorItemExistsOnMultiplePurchaseOrderLines"
			
		PurchaseOrderLineNotFoundMsg is a MessageField
			restricted
			"PurchaseOrderLineNotFoundForItem,VendorItemOrDescription"

		CannotInterfaceNoCostLineMsg is a MessageField
			restricted
			"CannotInterfaceNoCostPurchaseOrderLine"

		LineAOCNotAllowedOnServiceContractMsg is a MessageField
			restricted
			"LineAddOnChargeNotAllowedOnServiceContract"
			
		AOCNotAllowedForExpenseInvoiceMsg is a MessageField
			restricted
			"AddOnChargeNotAllowedForExpenseInvoice"
			
		InvoiceDetailNotFoundMsg is a MessageField
			restricted
			"InvoiceDetailNotFoundForAddOnCharge"
		
		CannotDetermineCompanyUsingGLNMsg is a MessageField
			restricted
			"CannotDetermineCompanyUsingGlobalLocationNumber"
		
		CannotDetermineVendorUsingGLNMsg is a MessageField
			restricted
			"CannotDetermineVendorUsingGlobalLocationNumber"
		
		CannotDetermineLocationUsingGLNMsg is a MessageField
			restricted
			"CannotDetermineLocationUsingGlobalLocationNumber"
		
		CannotDeterminePurchaseFromLocationUsingGLNMsg is a MessageField
			restricted
			"CannotDeterminePurchaseFromLocationUsingGlobalLocationNumber"
		
		CannotDetermineRemitToUsingGLNMsg is a MessageField
			restricted
			"CannotDetermineRemitToUsingGlobalLocationNumber"
		
		CannotDetermineItemUsingGTINMsg is a MessageField
			restricted
			"CannotDetermineItemUsingGTIN"

		GTINCheckDigitIsInvalidMsg is a MessageField
			restricted
			"GTINCheckDigitIsInvalid"

		AddOnChargeDoesNotExistMsg is a MessageField
			restricted
			"AddOnChargeDoesNotExist"


		LineMissingDataMsg is a MessageField
			restricted
			"Item,VendorItem,Description,OrLineNumberRequiredForDetailRecord"

		AddOnChargeRequiredMsg is a MessageField
			restricted
			"AddOnChargeRequired"

		MiscAddOnChargeRequiredMsg is a MessageField
			restricted
			"MiscellaneousAddOnChargeCodeRequired"

		DistributionSequenceRequiredMsg is a MessageField
			restricted
			"DistributionSequenceRequired"
			
		InvalidWorkOrderMsg is a MessageField
			restricted
			"WorkOrderDoesNotExistForInvoiceLines"

		NoDetailsForPrepaymentFromInvoice is a MessageField
			restricted
			"CannotHaveDetailsWhenMatchPrepaymentMethodIsPrepayFromInvoice"

		AdditionalLineMismatchMsg is a MessageField
			restricted
			"AdditionalLineMismatchOnUnitCostOrUnitOfMeasure;ViewInterfacedLineViaLink"
										
		ContractLineNotFoundMsg is a MessageField
			restricted
			"ContractLineNotFoundForLineNumber,VendorOrItem"

		HoldCodeDoesNotExistMsg is a MessageField
			restricted
			"HoldCodeDoesNotExist"
			
		DerivedVendor is a DerivedField
			type is like Vendor
			if  (OldVendor entered
			and  Vendor not entered)
				if  (VendorForLegacyVendorRel exists)
					return first VendorForLegacyVendorRel.Vendor 
				else
				if (InterfaceMappingVendorRel exists)
					return first InterfaceMappingVendorRel.Vendor
			else
				return Vendor

		DerivedPayVendor is a DerivedField
			type is like Vendor
			if  (PayVendor entered)
				return PayVendor
			else
			if  (InterfacedPayVendor entered)
				if  (LegacyPayVendorRel exists)
					return first LegacyPayVendorRel.Vendor 
				else
				if (InterfaceMappingPayVendorRel exists)
					return first InterfaceMappingPayVendorRel.Vendor

		DerivedPurchaseOrder is a DerivedField
			type is like PurchaseOrder
			if (PurchaseOrder entered)
				return PurchaseOrder
			else
			if  (InterfacedPurchaseOrderRel exists)
				return InterfacedPurchaseOrderRel.PurchaseOrder
			else
				CheckCompany 		= Company
				CheckPurchaseOrder 	= NumericInterfacedPurchaseOrder
				
				if  (CheckPurchaseOrderRel exists)
					return NumericInterfacedPurchaseOrder
					

    	NumericInterfacedPurchaseOrder is a DerivedField
    		type is like PurchaseOrder
    		if (InterfacedPurchaseOrder is numeric)
    			return InterfacedPurchaseOrder

    Relations
    	
    	EDIInvoiceMatchInterfaceInputByRunGroupRel
    		one-to-many relation to EDIInvoiceMatchInterfaceInput
    		Field Mapping uses ByRunGroup
				related.RunGroup				= LocalRunGroup
				
		InterfacedPurchaseOrderRel
			one-to-many relation to InterfacedPurchaseOrder
			Field Mapping uses ByImport
				related.Company              	= Company
				related.PurchaseOrderImport  	= InterfacedPurchaseOrder
                related.POCode					= InterfacedPOCode

		InterfaceHeaderRel
			one-to-one relation to EDIInvoiceMatchInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup				= RunGroup
		        related.Company					= Company
		        related.Vendor					= Vendor
		        related.OldVendor				= OldVendor
		        related.EDINumber				= EDINumber
		        related.Invoice					= Invoice
		        related.Suffix					= Suffix
		        related.LineNumber				= blank
		        related.SeqNbr					= blank
				related.RecordType				= "H"
				related.PurchaseOrder			= PurchaseOrder
				related.InterfacedPurchaseOrder = InterfacedPurchaseOrder
                related.InterfacedPOCode		= InterfacedPOCode
				
    	InterfaceDetailRel
			one-to-many relation to EDIInvoiceMatchInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup				= RunGroup
		        related.Company					= Company
		        related.Vendor					= Vendor
		        related.OldVendor				= OldVendor
		        related.EDINumber				= EDINumber
		        related.Invoice					= Invoice
		        related.Suffix					= Suffix
			Instance Selection
				where (related.PurchaseOrder			= PurchaseOrder
				and    related.InterfacedPurchaseOrder 	= InterfacedPurchaseOrder
                and    related.InterfacedPOCode			= InterfacedPOCode
				and    related.RecordType.InvoiceDetail)

    	InterfaceDetailForAOCRel
			one-to-one relation to EDIInvoiceMatchInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup				= RunGroup
		        related.Company					= Company
		        related.Vendor					= Vendor
		        related.OldVendor				= OldVendor
		        related.EDINumber				= EDINumber
		        related.Invoice					= Invoice
		        related.Suffix					= Suffix
		        related.LineNumber				= LineNumber
		        related.SeqNbr					= SeqNbr
				related.RecordType				= "D"
		        related.PurchaseOrder			= PurchaseOrder
		        related.InterfacedPurchaseOrder = InterfacedPurchaseOrder
                related.InterfacedPOCode		= InterfacedPOCode

    	InterfaceAOCRel
			one-to-many relation to EDIInvoiceMatchInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup				= RunGroup
		        related.Company					= Company
		        related.Vendor					= Vendor
		        related.OldVendor				= OldVendor
		        related.EDINumber				= EDINumber
		        related.Invoice					= Invoice
		        related.Suffix					= Suffix
			Instance Selection
				where (related.PurchaseOrder			= PurchaseOrder
				and    related.InterfacedPurchaseOrder 	= InterfacedPurchaseOrder
                and    related.InterfacedPOCode			= InterfacedPOCode
				and   (related.RecordType.MiscAddOnCharge
				or     related.RecordType.LineAddOnCharge))

    	InterfaceHeaderAOCRel
			one-to-many relation to EDIInvoiceMatchInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup				= RunGroup
		        related.Company					= Company
		        related.Vendor					= Vendor
		        related.OldVendor				= OldVendor
		        related.EDINumber				= EDINumber
		        related.Invoice					= Invoice
		        related.Suffix					= Suffix
		        related.LineNumber				= blank
			Instance Selection
				where (related.PurchaseOrder			= PurchaseOrder
				and    related.InterfacedPurchaseOrder 	= InterfacedPurchaseOrder
                and    related.InterfacedPOCode			= InterfacedPOCode
				and    related.RecordType.MiscAddOnCharge)

    	InterfaceLineAOCRel
			one-to-many relation to EDIInvoiceMatchInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup				= RunGroup
		        related.Company					= Company
		        related.Vendor					= Vendor
		        related.OldVendor				= OldVendor
		        related.EDINumber				= EDINumber
		        related.Invoice					= Invoice
		        related.Suffix					= Suffix
		        related.LineNumber				= LineNumber
			Instance Selection
				where (related.PurchaseOrder			= PurchaseOrder
				and    related.InterfacedPurchaseOrder 	= InterfacedPurchaseOrder
                and    related.InterfacedPOCode			= InterfacedPOCode
				and    related.RecordType.LineAddOnCharge)

    	InterfaceAOCForThisLineRel
			one-to-many relation to EDIInvoiceMatchInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup				= RunGroup
		        related.Company					= Company
		        related.Vendor					= Vendor
		        related.OldVendor				= OldVendor
		        related.EDINumber				= EDINumber
		        related.Invoice					= Invoice
		        related.Suffix					= Suffix
		        related.LineNumber				= LineNumber
		        related.SeqNbr					= SeqNbr
			Instance Selection
				where (related.PurchaseOrder			= PurchaseOrder
				and    related.InterfacedPurchaseOrder 	= InterfacedPurchaseOrder
                and    related.InterfacedPOCode			= InterfacedPOCode
				and    related.RecordType.LineAddOnCharge)

    	InterfaceDistributionRel
			one-to-many relation to EDIInvoiceMatchInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup				= RunGroup
		        related.Company					= Company
		        related.Vendor					= Vendor
		        related.OldVendor				= OldVendor
		        related.EDINumber				= EDINumber
		        related.Invoice					= Invoice
		        related.Suffix					= Suffix
			Instance Selection
				where (related.RecordType.InvoiceDistribution)

		LocalInterfaceResultsRel
			one-to-one relation to PayablesInvoiceInterfaceResult
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= Company.FinanceEnterpriseGroup
				related.PayablesInvoiceInterfaceResult	= LocalInterfaceResult
				
		SetInterfaceResultsRel
			one-to-one relation to PayablesInvoiceInterfaceResult
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= LocalFinanceEnterpriseGroup
				related.PayablesInvoiceInterfaceResult	= LocalInterfaceResult
				
		VendorForLegacyVendorRel
            one-to-many relation to Vendor
            Field Mapping uses ByLegacyVendor
				related.VendorGroup						= PayablesCompanyRel.VendorGroup
				related.LegacyVendor					= OldVendor

		InterfaceMappingVendorRel
            one-to-many relation to VendorMappingTableInterface
            Field Mapping uses symbolic key
				related.VendorGroup						= PayablesCompanyRel.VendorGroup
			Instance Selection
				where (related.VendorMappingTableInterface.OldVendor	= OldVendor)

		LegacyPayVendorRel
            one-to-many relation to Vendor
            Field Mapping uses ByLegacyVendor
				related.VendorGroup						= PayablesCompanyRel.VendorGroup
				related.LegacyVendor					= InterfacedPayVendor
			
		InterfaceMappingPayVendorRel
            one-to-many relation to VendorMappingTableInterface
            Field Mapping uses symbolic key
				related.VendorGroup								= PayablesCompanyRel.VendorGroup
			Instance Selection
				where (related.VendorMappingTableInterface.OldVendor	= InterfacedPayVendor)

		LocalVendorRel
            one-to-many relation to Vendor
            Field Mapping uses symbolic key
				related.VendorGroup						= PayablesCompanyRel.VendorGroup
				related.Vendor							= LocalVendor
			
		PayablesCompanyRel
			one-to-one relation to PayablesCompany
			Field Mapping uses symbolic key
				related.Company                     	= Company
		
		MatchCompanyRel
			one-to-one relation to MatchCompany
			Field Mapping uses symbolic key
				related.Company                     	= Company
		
		PurchasingCompanyRel
			one-to-one relation to PurchasingCompany
			Field Mapping uses symbolic key
				related.Company                    		= Company

        PurchaseOrderLineRel
            one-to-one relation to PurchaseOrderLine
            Field Mapping uses symbolic key
                related.Company							= Company
                related.PurchaseOrder					= LocalPurchaseOrder 
                related.PurchaseOrderLine				= LineNumber

		POLineByItemRel
            one-to-many relation to PurchaseOrderLine
            Field Mapping uses Set7
                related.Company							= Company
                related.PurchaseOrder					= LocalPurchaseOrder
                related.Item							= Item

        POLineByMatchDetailKeyRel
            one-to-many relation to PurchaseOrderLine
            Field Mapping uses Set11
                related.Company							= Company
                related.PurchaseOrder					= LocalPurchaseOrder 
                related.MatchDetailKey					= ItemDescription

        POLineByVendorItemRel
            one-to-many relation to PurchaseOrderLine
            Field Mapping uses Set15
                related.Company							= Company
                related.PurchaseOrder					= LocalPurchaseOrder 
                related.VendorItem						= VendorItem

        VendorItemRel
            one-to-many relation to VendorItem
            Field Mapping uses symbolic key
                related.ProcurementGroup 				= PurchasingCompanyRel.ProcurementGroup
                related.Item           					= Item
                related.Vendor       					= Vendor
                
        ItemUOMRel
        	one-to-one relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup         = PurchasingCompanyRel.ProcurementGroup
        		related.Item              = Item
        		related.UnitOfMeasure     = EnteredUOM
        		
		OtherAddOnChargesForSameLineRel
            one-to-many relation to EDIInvoiceMatchInterfaceInput
            Field Mapping uses ByRunGroup
            	related.RunGroup						= RunGroup
                related.Company			 				= Company
				related.Vendor							= Vendor
				related.OldVendor						= OldVendor
				related.EDINumber						= EDINumber
				related.Invoice							= Invoice
				related.Suffix							= Suffix
				related.LineNumber						= LineNumber
				related.SeqNbr							= SeqNbr
			Instance Selection
				where (related.PurchaseOrder			= ThisPurchaseOrder
				and    related.InterfacedPurchaseOrder 	= ThisInterfacedPurchaseOrder
                and    related.InterfacedPOCode			= ThisInterfacedPOCode
				and    related.RecordType.LineAddOnCharge
				and    related.AddOnCharge 				!= AddOnCharge)

        ThisInterfaceHeaderRel
            one-to-one relation to EDIInvoiceMatchInterfaceInput
            Field Mapping uses ByRunGroup
				related.RunGroup						= ThisRunGroup
                related.Company			 				= ThisCompany
				related.Vendor							= ThisVendor
				related.OldVendor						= ThisOldVendor
				related.EDINumber						= ThisEDINumber
				related.Invoice							= ThisInvoice
				related.Suffix							= ThisSuffix
		        related.LineNumber						= blank
		        related.SeqNbr							= blank
				related.RecordType						= "H"
				related.PurchaseOrder					= ThisPurchaseOrder
				related.InterfacedPurchaseOrder 		= ThisInterfacedPurchaseOrder
                related.InterfacedPOCode			    = ThisInterfacedPOCode
                
        DuplicateInvoiceRel 
            one-to-many relation to EDIInvoiceMatchInterfaceInput
            Field Mapping uses ByRunGroup
				related.RunGroup						= RunGroup
                related.Company			 				= Company
				related.Vendor							= Vendor
				related.OldVendor						= OldVendor
				related.EDINumber						= EDINumber
				related.Invoice							= Invoice
				related.Suffix							= Suffix
		        related.LineNumber						= blank
		        related.SeqNbr							= blank
				related.RecordType						= "H"
				related.PurchaseOrder					= PurchaseOrder
				related.InterfacedPurchaseOrder 		= InterfacedPurchaseOrder
                related.InterfacedPOCode			    = InterfacedPOCode
            Instance Selection 
            	where (related.EDIInvoiceMatchInterfaceInput != EDIInvoiceMatchInterfaceInput) 

        DuplicateLineRel 
            one-to-many relation to EDIInvoiceMatchInterfaceInput
			valid when (RecordType.InvoiceDetail)
            Field Mapping uses ByRunGroup
				related.RunGroup						= RunGroup
                related.Company			 				= Company
				related.Vendor							= Vendor
				related.OldVendor						= OldVendor
				related.EDINumber						= EDINumber
				related.Invoice							= Invoice
				related.Suffix							= Suffix
		        related.LineNumber						= LineNumber
            Instance Selection
            	where (related.EDIInvoiceMatchInterfaceInput != EDIInvoiceMatchInterfaceInput
				and    related.RecordType				= "D"
				and    related.PurchaseOrder			= PurchaseOrder
				and    related.InterfacedPurchaseOrder 	= InterfacedPurchaseOrder
                and    related.InterfacedPOCode			= InterfacedPOCode
            	and    related.Item						= Item
            	and    related.VendorItem				= VendorItem
            	and    related.Location					= Location)

        DuplicateAOCRel 
	        one-to-many relation to EDIInvoiceMatchInterfaceInput
			valid when (AOC)
            Field Mapping uses ByRunGroup
				related.RunGroup						= RunGroup
                related.Company			 				= Company
				related.Vendor							= Vendor
				related.OldVendor						= OldVendor
				related.EDINumber						= EDINumber
				related.Invoice							= Invoice
				related.Suffix							= Suffix
		        related.LineNumber						= LineNumber
            Instance Selection
            	where (related.EDIInvoiceMatchInterfaceInput != EDIInvoiceMatchInterfaceInput
				and    related.RecordType				= RecordType
				and    related.PurchaseOrder			= PurchaseOrder
				and    related.InterfacedPurchaseOrder 	= InterfacedPurchaseOrder
                and    related.InterfacedPOCode			= InterfacedPOCode
            	and    related.Item						= Item
            	and    related.VendorItem				= VendorItem
            	and    related.Location					= Location
            	and    related.AddOnCharge				= AddOnCharge
            	and    related.MiscAddOnCharge			= MiscAddOnCharge)


        LocalInvoicesInRunGroupRel
            one-to-many relation to EDIInvoiceMatchInterfaceInput
            Field Mapping uses ByRunGroup
				related.RunGroup						= LocalRunGroup

        LocalInvoicesInRunGroupCompanyRel
            one-to-many relation to EDIInvoiceMatchInterfaceInput
            Field Mapping uses ByRunGroup
				related.RunGroup						= LocalRunGroup
				related.Company							= LocalCompany

		LocalDistributionRel
			one-to-one relation to PayablesInvoiceDistribution
			Field Mapping uses symbolic key
				related.Company							= Company
				related.PayablesInvoice					= InterfaceHeaderRel.PayablesInvoice
				related.PayablesInvoiceDistribution		= LocalDistribution

       	TaxEntityRel				 
            one-to-one relation to TaxEntity
            Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= Company.FinanceEnterpriseGroup
                related.TaxEntity 						= Company.AccountingEntity
                
        EntityTaxCodeRel
            one-to-one relation to EntityTaxCode
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup			= Company.FinanceEnterpriseGroup
                related.TaxEntity 						= Company.AccountingEntity
                related.TaxCode 						= TaxCode

		LocalPurchasingCompanyRel
			one-to-one relation to PurchasingCompany
			Field Mapping uses symbolic key
				related.Company                    		= LocalCompany
				
        GlobalLocationNumberDetailSet6Rel
            one-to-one relation to GlobalLocationNumberDetail
            Field Mapping uses Set6
                related.Company                                           	= LocalCompany

        InventoryCompanyRel
            one-to-one relation to InventoryCompany
            Field Mapping uses symbolic key
                related.Company 											= UseCompany

        GlobalLocationNumberDetailSet2Rel
            one-to-many relation to GlobalLocationNumberDetail
            Field Mapping uses Set2
                related.ItemGroup                                           = LocalPurchasingCompanyRel.ProcurementGroup
                related.GlobalLocationNumberDetail.GlobalLocationNumberType = 2
            Instance Selection
                where (related.CompanyLocationBin.Company                   = LocalCompany)

        GlobalLocationNumberDetailSet4Rel
            one-to-many relation to GlobalLocationNumberDetail
            Field Mapping uses Set4
                related.ItemGroup                                           = LocalPurchasingCompanyRel.ProcurementGroup
                related.GlobalLocationNumberDetail.GlobalLocationNumberType = 7
                related.VendorAndVendorLocation.Vendor						= LocalVendor

        GlobalLocationNumberDetailSet7Rel
            one-to-many relation to GlobalLocationNumberDetail
            Field Mapping uses Set7
                related.GlobalLocationNumberDetail.GlobalLocationNumberType = LocalGlobalLocationNumberType
                related.GlobalLocationNumber								= LocalGlobalLocationNumber

        GlobalLocationNumberDetailSet1Rel
            one-to-many relation to GlobalLocationNumberDetail
            Field Mapping uses symbolic key
            	related.ItemGroup											= InventoryCompanyRel.ItemGroup
                related.GlobalLocationNumber								= LocalGlobalLocationNumber
            Instance Selection
                where (related.GlobalLocationNumberDetail.GlobalLocationNumberType = LocalGlobalLocationNumberType)

		ItemGTINRel
			one-to-many relation to ItemGTIN
			Field Mapping uses Set2
				related.ItemGroup  											= LocalCompany
				related.ItemGTIN 											= ItemGTIN
		
        GLNPayablesInvoiceRel
            one-to-one relation to PayablesInvoice
            Field Mapping uses symbolic key
                related.Company							= UseCompany
                related.PayablesInvoice					= PayablesInvoice 

    	MatchInvoiceImportForRunGroupRel
    		one-to-many relation to MatchInvoiceImport
    		Field Mapping uses ByRunGroup
				related.RunGroup				= LocalRunGroup
				
		AddOnChargeRel
			one-to-one relation to AddOnCharge
			Field Mapping uses symbolic key
				related.Company							= LocalCompany
				related.AddOnCharge						= AddOnCharge

		MiscAddOnChargeRel
			one-to-one relation to AddOnCharge
			Field Mapping uses symbolic key
				related.Company							= LocalCompany
				related.AddOnCharge						= MiscAddOnCharge

        CheckPurchaseOrderRel
            one-to-one relation to PurchaseOrder
            Field Mapping uses symbolic key
                related.Company							= CheckCompany
                related.PurchaseOrder					= CheckPurchaseOrder 

		MatchInvoiceImportRel
			one-to-one relation to MatchInvoiceImport
            Field Mapping uses ByCompanyVendorInvoice
                related.Company			 				= Company
				related.Vendor							= Vendor
				related.OldVendor						= OldVendor
				related.EDINumber						= EDINumber
				related.Invoice							= Invoice
				related.Suffix							= Suffix


		PayablesInvoiceInterfaceInProcessRel
			one-to-many relation to PayablesInvoice
			Field Mapping uses ByCompanyVendorInvoice
				related.Company			= Company
				related.Vendor			= Vendor
				related.Invoice			= Invoice
				related.Suffix			= Suffix
				related.CancelSequence	= blank
				related.InvoiceDate		= InvoiceDate						
			Instance Selection
				where (related.InterfaceInProcess)

				
		PurchasingVendorRel
			one-to-one relation to PurchasingVendor
				Field Mapping uses symbolic key
					related.VendorGroup					= PayablesCompanyRel.VendorGroup
	    			related.Vendor						= Vendor
	    			
		PayablesHoldCodeRel
			one-to-one relation to PayablesHoldCode
			Field Mapping uses symbolic key
				related.VendorGroup				= PayablesCompanyRel.VendorGroup
				related.HoldCode				= HoldCode

		PurchaseFromLocationRel
			one-to-one relation to PurchaseFromLocation
			Field Mapping uses symbolic key
				related.VendorGroup				= PayablesCompanyRel.VendorGroup
				related.Vendor					= Vendor
				related.PurchaseFromLocation	= PurchaseFromLocation

		InterfaceAnalysisDetailRel
			one-to-many relation to InterfaceAnalysisDetail
			Field Mapping uses AnalysisBucket
				related.InterfaceAnalysis	= LocalInterfaceAnalysis
				related.PayablesCompany		= Company
				related.Vendor				= Vendor
				related.Currency			= InvoiceCurrency
			Instance Selection
				where (related.MonthYear.Begin	<= InvoiceDate
				and    related.MonthYear.End	>= InvoiceDate)

        PayablesInvoiceDetailRel
        	one-to-one relation to PayablesInvoiceDetail
        	Field Mapping uses symbolic key
        		related.Company						= Company
        		related.PayablesInvoice				= InterfaceHeaderRel.PayablesInvoice
                related.PurchaseOrder  				= LocalPurchaseOrder
                related.PurchaseOrderLine    		= LineNumber
                related.Contract	  				= blank
                related.ContractLine    			= blank
                related.PayablesInvoiceDetail		= SystemAssignedInvoiceDetail

        PayablesInvoiceDetailWithContractRel
        	one-to-one relation to PayablesInvoiceDetail
        	Field Mapping uses symbolic key
        		related.Company						= Company
        		related.PayablesInvoice				= InterfaceHeaderRel.PayablesInvoice
                related.PurchaseOrder  				= LocalPurchaseOrder
                related.PurchaseOrderLine    		= LineNumber
                related.Contract	  				= PurchaseOrderLineRel.Contract
                related.ContractLine    			= PurchaseOrderLineRel.ContractLine
                related.PayablesInvoiceDetail		= SystemAssignedInvoiceDetail

        PayablesInvoiceDetailServiceContractRel
        	one-to-one relation to PayablesInvoiceDetail
        	Field Mapping uses symbolic key
        		related.Company						= Company
        		related.PayablesInvoice				= InterfaceHeaderRel.PayablesInvoice
                related.PurchaseOrder  				= blank
                related.PurchaseOrderLine    		= blank
                related.Contract	  				= InterfaceHeaderRel.ServiceContract
                related.ContractLine    			= LineNumber
                related.PayablesInvoiceDetail		= SystemAssignedInvoiceDetail

		ContractLineRel
			one-to-one relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup			= PayablesCompanyRel.VendorGroup
				related.Contract				= InterfaceHeaderRel.ServiceContract
				related.ContractLine			= LineNumber

		ContractLineByItemRel
			one-to-many relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup			= PayablesCompanyRel.VendorGroup
				related.Contract				= InterfaceHeaderRel.ServiceContract
			Instance Selection
				where (related.ItemNumber		= Item)

		ContractLineByVendorItemRel
			one-to-many relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup			= PayablesCompanyRel.VendorGroup
				related.Contract				= InterfaceHeaderRel.ServiceContract
			Instance Selection
				where (related.VendorItem		= VendorItem)

		ContractLineByItemDescriptionRel
			one-to-many relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup			= PayablesCompanyRel.VendorGroup
				related.Contract				= InterfaceHeaderRel.ServiceContract
			Instance Selection
				where (related.ItemDescription		= ItemDescription)

		GeneralLedgerSystemCodeRel		
			one-to-one relation to GeneralLedgerSystemCode
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= LocalFinanceEnterpriseGroup
				related.GeneralLedgerSystemCode	= "AP"	

        InterfaceResultInProcessRel
            one-to-many relation to PayablesInvoiceInterfaceResult
            Field Mapping uses ByRunGroup
                related.RunGroup                        = LocalRunGroup
            Instance Selection
                where (related.FinanceEnterpriseGroup    = LocalFinanceEnterpriseGroup
                and    related.RunType                    = 2 
                and    related.Status.InProcess)
                
		CXMLConfigurationRel
        	one-to-many relation to CXMLConfiguration
        	Field Mapping uses symbolic key
        		related.FinanceEnterpriseGroup	= Company.FinanceEnterpriseGroup
    		Instance Selection
    			where (related.Default)

        LocalOriginalInvoiceDetailRel
            one-to-many relation to PayablesInvoiceDetail
            Field Mapping uses symbolic key
                related.Company 						= Company
                related.PayablesInvoice 				= LocalOriginalInvoice
                related.PurchaseOrder  					= LocalPurchaseOrder
                related.PurchaseOrderLine    			= LocalPOLine
                related.Contract	  					= InterfaceHeaderRel.ServiceContract
                related.ContractLine    				= LocalContractLine

        OriginalInvoiceDetailRel
            one-to-one relation to PayablesInvoiceDetail
            Field Mapping uses symbolic key
                related.Company 						= Company
                related.PayablesInvoice 				= LocalOriginalInvoice 
                related.PurchaseOrder  					= LocalPurchaseOrder
                related.PurchaseOrderLine    			= LocalPOLine
                related.Contract	  					= InterfaceHeaderRel.ServiceContract
                related.ContractLine    				= LocalContractLine
                related.PayablesInvoiceDetail			= LocalOriginalInvoiceDetail

        LocalInterfacedDetailRel
            one-to-many relation to PayablesInvoiceDetail
            Field Mapping uses symbolic key
                related.Company 						= Company
                related.PayablesInvoice 				= InterfaceHeaderRel.PayablesInvoice
                related.PurchaseOrder  					= LocalPurchaseOrder
                related.PurchaseOrderLine    			= LocalPOLine
                related.Contract	  					= LocalContract
                related.ContractLine    				= LocalContractLine

        LocalInterfacedDetailExactRel
            one-to-one relation to PayablesInvoiceDetail
            Field Mapping uses symbolic key
                related.Company 						= Company
                related.PayablesInvoice 				= InterfaceHeaderRel.PayablesInvoice
                related.PurchaseOrder  					= LocalPurchaseOrder
                related.PurchaseOrderLine    			= LocalPOLine
                related.Contract	  					= LocalContract
                related.ContractLine    				= LocalContractLine
                related.PayablesInvoiceDetail			= LocalOriginalInvoiceDetail


	Conditions
		NoDetailRecordsFound
			when (!InterfaceDetailRel exists
			and   !InterfaceAOCRel exists)

		SkipThisRecord
	        when  (InterfaceHeaderRel.DuplicateInvoiceRel exists
			or    (RecordType.InvoiceHeader
			and    MatchInvoiceImportRel exists)
			or	   InterfaceHeaderRel.InProgress)

		HasDuplicateEDIInvoice
			when (InterfaceHeaderRel.DuplicateInvoiceRel exists)

		DuplicateLineExists
			when (RecordType.InvoiceDetail
			and   DuplicateLineRel exists)

		AOC
			when (RecordType.LineAddOnCharge
			or    RecordType.MiscAddOnCharge)

		DuplicateAOCExists
			when ((RecordType.LineAddOnCharge
			or     RecordType.MiscAddOnCharge)
			and    DuplicateAOCRel exists)

		HasDuplicateMatchInterfaceInvoice
			when (MatchInvoiceImportRel exists)

		MissingPurchaseOrder
			when (PurchaseOrder not entered
			and   InterfacedPurchaseOrder not entered)
			
		AutoRejectEnabled
			when (CXMLConfigurationRel.InvoiceAutoReject)
			
		IsHSNSACCodeEnabled
			restricted
			when (Company.GeneralLedgerCompany.RequireHSNSACCode)
			
		RequireWorkOrder
    		when (CheckPurchaseOrderRel.RequireWO)
    		
    	SecurityGroupAllowsAccess
			restricted
			when (Company !entered
			or   (Company entered
			and   Company.SecurityGroupAllowsAccess))
							
    Sets

        ByRunGroup
			Sort Order
				RunGroup
		        Company
		        Vendor
		        OldVendor
		        EDINumber
		        Invoice
		        Suffix
		        LineNumber
		        SeqNbr
		        RecordType
		        PurchaseOrder
		        InterfacedPurchaseOrder
		        InterfacedPOCode

        ByRunGroupInvoiceType
			Sort Order
				RunGroup
				Company
                Vendor
                OldVendor
				EDINumber
				InvoiceType
                Invoice
                Suffix
		        LineNumber
		        SeqNbr
		        RecordType
		        PurchaseOrder
		        InterfacedPurchaseOrder
		        InterfacedPOCode

        ByRunGroupUniqueID
			Sort Order
				RunGroup
		        Company
		        Vendor
		        OldVendor
		        EDINumber
		        Invoice
		        Suffix
		        LineNumber
		        SeqNbr
		        RecordType
		        PurchaseOrder
		        InterfacedPurchaseOrder
		        InterfacedPOCode
				EDIInvoiceMatchInterfaceInput
								
    Field Rules
        		
        RunGroup
        	required
        	
	Rule Blocks
		InterfaceEdits 
					
			if  (ProcessType not entered)
				if  (PurchaseOrder entered
				or   InterfacedPurchaseOrder entered)
					ProcessType = "M"
				else
				if  (ServiceContract entered)
					ProcessType = "V"
				else
					ProcessType = "B"
			else
				if  (PurchaseOrder not entered
				and  InterfacedPurchaseOrder not entered
				and  ServiceContract not entered)
					ProcessType = "B"
							
			if  (!EnableGLNProcessing
			and   Company not entered)
				ErrorOccurred		= true
				LocalErrorMessage	= CompanyRequiredMsg
			else
			if  (NoDetailRecordsFound
			and CreateDetails not entered
			and (ProcessType.MatchInvoice
			or   ProcessType.AOCMatchInvoice
			or   ProcessType.ServiceContract))
				ErrorOccurred		= true
				LocalErrorMessage	= NoDetailRecordsFoundMsg
			else
			if  (Vendor not entered
			and  OldVendor not entered)
				ErrorOccurred		= true
				LocalErrorMessage	= VendorRequiredMsg
			else
			if  (!EnableGLNProcessing
			and  Vendor not entered
			and  OldVendor entered
			and !VendorForLegacyVendorRel exists
			and !InterfaceMappingVendorRel exists)
				ErrorOccurred		= true
				LocalErrorMessage	= InterfacedVendorNotFoundMsg
			else
			if  (PayVendor not entered
			and  InterfacedPayVendor entered
			and !LegacyPayVendorRel exists
			and !InterfaceMappingPayVendorRel exists)
				ErrorOccurred		= true
				LocalErrorMessage	= InterfacedPayVendorNotFoundMsg
			else					
			if  (ProcessType not entered)
				ErrorOccurred		= true
				LocalErrorMessage	= ProcessTypeRequiredMsg
			else
			if  (DuplicateInvoiceRel exists) 
				ErrorOccurred		= true 
				LocalErrorMessage	= DuplicateInvoiceMsg 
			else
			if  (!ProcessType.Basic
			and  !ProcessType.Freight
			and  !ProcessType.MatchInvoice
			and  !ProcessType.AOCMatchInvoice
			and  !ProcessType.ServiceContract)
				ErrorOccurred		= true
				LocalErrorMessage	= InvalidProcessTypeMsg
			else
			if (ProcessType.ServiceContract
			and ServiceContract not entered)
				ErrorOccurred		= true
				LocalErrorMessage	= ServiceContractRequiredMsg
			else
			if  (MatchPrepaymentMethod = "1"
			and (InterfaceDetailRel exists
			or   InterfaceAOCRel exists))
				ErrorOccurred		= true
				LocalErrorMessage	= NoDetailsForPrepaymentFromInvoice
			else
			if  (PurchaseOrder not entered
			and  InterfacedPurchaseOrder not entered
			and  ServiceContract not entered
			and  InterfaceDetailRel exists)
				ErrorOccurred		= true
				LocalErrorMessage	= InvoiceDetailNotAllowedForExpenseInvoiceMsg
			else
			if  (PurchaseOrder not entered
			and  InterfacedPurchaseOrder not entered
			and  ServiceContract not entered
			and  InterfaceAOCRel exists)
				ErrorOccurred		= true
				LocalErrorMessage	= AOCNotAllowedForExpenseInvoiceMsg
			else
			if  (HoldCode entered
			and  PayablesHoldCodeRel not exists)
				ErrorOccurred		= true
				LocalErrorMessage		= HoldCodeDoesNotExistMsg
			else
			if  (ProcessType.MatchInvoice
			or   ProcessType.AOCMatchInvoice)
				CheckCompany = Company
				CheckPurchaseOrder = NumericInterfacedPurchaseOrder
				
				if  (PurchaseOrder not entered
				and  InterfacedPurchaseOrder not entered
				and  MatchReferenceNumber not entered)
					ErrorOccurred		= true
					LocalErrorMessage	= PurchaseOrderRequiredMsg
				else				
				if  (PurchaseOrder not entered
				and  InterfacedPurchaseOrderRel not exists
				and  CheckPurchaseOrderRel not exists
				and  MatchReferenceNumber not entered)
					ErrorOccurred		= true
					LocalErrorMessage	= InterfacedPurchaseOrderNotFoundMsg


		GLNProcessing

			LocalCompany							= PrmCompany
			UseCompany								= Company
			UseVendor								= Vendor
			initialize UseLocation
			initialize UsePurchaseFromLocation
			initialize UseRemitToCode
			
			if  (UseCompany not entered)	
				if  (GlnCompany = SaveGlobalLocationNumber1)
					UseCompany						= SaveCompany1
				else
				if  (GlnCompany = SaveGlobalLocationNumber2)
					UseCompany						= SaveCompany2

			if  (UseCompany not entered)	
				LocalGlobalLocationNumberType 		= 1
				LocalGlobalLocationNumber			= GlnCompany
				UseCompany							= first GlobalLocationNumberDetailSet7Rel.Company

			if  (UseCompany not entered)	
				LocalGlobalLocationNumberType 		= 2
				UseCompany							= first GlobalLocationNumberDetailSet7Rel.Company
				
			if  (UseCompany not entered)	
				ErrorOccurred						= true
				LocalErrorMessage					= CannotDetermineCompanyUsingGLNMsg

			if  (!ErrorOccurred)
				Counter = 1
				if  (UseVendor not entered)
					if  (PrmVendor entered
					and  GlnVendor = SaveGlobalLocationNumber7)
						UseVendor						= SaveVendor7
	
				if  (UseVendor not entered)					
					LocalGlobalLocationNumberType 		= 7
					LocalGlobalLocationNumber			= GlnVendor
					initialize Counter
					for each GlobalLocationNumberDetailSet1Rel
						Counter += 1
						UseVendor						= first GlobalLocationNumberDetailSet1Rel.VendorAndVendorLocation.Vendor
							
					if  (UseVendor not entered	
					or   Counter != 1)
						ErrorOccurred					= true
						LocalErrorMessage				= CannotDetermineVendorUsingGLNMsg

			if  (!ErrorOccurred)
				if  (GlnLocation entered)
					LocalGlobalLocationNumberType 		= 3
					LocalGlobalLocationNumber			= GlnLocation
					initialize Counter
					for each GlobalLocationNumberDetailSet1Rel
						Counter += 1
						UseLocation						= first GlobalLocationNumberDetailSet1Rel.RequestingCompanyAndLocation.RequestingLocation

					if  (UseLocation not entered	
					or   Counter != 1)
						ErrorOccurred					= true
						LocalErrorMessage				= CannotDetermineLocationUsingGLNMsg
	
			if  (!ErrorOccurred)
				if  (GlnPurchaseFromLocation entered)
					LocalGlobalLocationNumberType 		= 10
					LocalGlobalLocationNumber			= GlnPurchaseFromLocation
					initialize Counter
					for each GlobalLocationNumberDetailSet1Rel
						Counter += 1
						UsePurchaseFromLocation			= first GlobalLocationNumberDetailSet1Rel.PurchasingVendorAndPurchaseFromLocation.PurchaseFromLocation

					if  (UsePurchaseFromLocation not entered	
					or   Counter != 1)
						ErrorOccurred					= true
						LocalErrorMessage				= CannotDeterminePurchaseFromLocationUsingGLNMsg
	
			if  (!ErrorOccurred)
				if  (GlnRemitTo entered)
					LocalGlobalLocationNumberType 		= 3
					LocalGlobalLocationNumber			= GlnRemitTo
					initialize Counter
					for each GlobalLocationNumberDetailSet1Rel
						Counter += 1
						UseRemitToCode					= first GlobalLocationNumberDetailSet1Rel.VendorAndVendorLocation.VendorLocation

					if  (UseRemitToCode not entered	
					or   Counter != 1)
						ErrorOccurred					= true
						LocalErrorMessage				= CannotDetermineRemitToUsingGLNMsg
						
		CXMLInvoiceStatusCreate	
			invoke CreateCXMLInvoiceStatus OutboundCXMLInvoiceStatus
				invoked.DocumentNumber 				= Invoice
				invoked.InvoiceID 					= Invoice
				invoked.InvoiceDate					= InvoiceDate
				invoked.InvoiceStatus				= 4
				invoked.VendorGroup					= PayablesCompanyRel.VendorGroup
				invoked.Vendor						= Vendor
				invoked.PurchaseFromLocation 		= PurchaseFromLocation
				invoked.InvoiceComments				= LocalCXMLText
	
    Actions
        Create is a Create Action
        	restricted
        	
        Update is an Update Action
        
        Delete is a Delete Action  
			Action Rules
				if (RecordType.InvoiceHeader
				and PayablesInvoice entered)
						confirmation required
							"InvoiceIsPartiallyInterfacedAndThoseRecordsWillAlsoBeDeleted"
						invoke Unreleased.Delete PayablesInvoice
				
			            
        FastDelete is a Delete Action
			restricted
			bypass relational integrity rules
        
		CreateErrorRecord is an Instance Action
 			restricted
 			Parameters
 				PrmErrorMessage			is Alpha 150
 				PrmResult      			is like PayablesInvoiceInterfaceResult
 				PrmErrorLevel           is Numeric 2
				EnableGLNProcessing		is Boolean
				PrmErrorLine            is like LineNumber
 					
			Action Rules


				LocalInterfaceResult   		= PrmResult
				LocalCompany           		= Company
				initialize LocalSequence

				if  (EnableGLNProcessing)
					if (!RecordType.InvoiceHeader)
						LocalCompany						= InterfaceHeaderRel.UseCompany
						LocalVendor							= InterfaceHeaderRel.UseVendor
					else 
						LocalCompany						= UseCompany
						LocalVendor							= UseVendor
	

				if (MatchInvoiceImportRel not exists)
					invoke Update LocalInterfaceResultsRel
						invoked.Status = 2
	
					if  (LocalInterfaceResultsRel.MoveErrorsToNewRunGroup)
					
						if  (LocalInterfaceResultsRel.ErrorRunGroup not entered)
							increment PayablesCompanyRel.VendorGroup.LastErrorRunGroupNumber
							LocalRunGroup					= LocalInterfaceResultsRel.ErrorRunGroupPrefix + "ERRORS_" + PayablesCompanyRel.VendorGroup.LastErrorRunGroupNumber
	
							invoke Update LocalInterfaceResultsRel
								invoked.ErrorRunGroup		= LocalRunGroup
						else
							LocalRunGroup					= LocalInterfaceResultsRel.ErrorRunGroup
					else
						LocalRunGroup						= LocalInterfaceResultsRel.RunGroup
	
					if  (ProcessType not entered)
						if  (PurchaseOrder entered
						or   InterfacedPurchaseOrder entered)
							ProcessType = "M"
						else
						if  (ServiceContract entered)
							ProcessType = "V"
						else
							ProcessType = "B"


					invoke CreateNoRules MatchInvoiceImport
						fill in fields from InterfaceHeaderRel
							except invoked.RunGroup
						invoked.RunGroup					= LocalRunGroup
						invoked.RecordInError				= true
						invoked.ErrorMessage				= PrmErrorMessage
						invoked.InterfaceRun	            = PrmResult
						invoked.TotalTaxAmount				= InterfaceHeaderRel.TaxAmount
						if  (EnableGLNProcessing)
							if (!RecordType.InvoiceHeader)
								invoked.Company					= InterfaceHeaderRel.UseCompany
								invoked.Vendor					= InterfaceHeaderRel.UseVendor
								invoked.Location				= InterfaceHeaderRel.UseLocation
								invoked.PurchaseFromLocation	= InterfaceHeaderRel.UsePurchaseFromLocation
								invoked.RemitToCode				= InterfaceHeaderRel.UseRemitToCode
							else 
								invoked.Company					= LocalCompany
								invoked.Vendor					= LocalVendor
								invoked.Location				= UseLocation
								invoked.PurchaseFromLocation	= UsePurchaseFromLocation
								invoked.RemitToCode				= UseRemitToCode

				if (RecordType.InvoiceHeader)

					for each InterfaceDetailRel

						LocalSequence += 1
						invoke CreateNoRules PayablesInvoiceDetailImport
							fill in fields from each
								except invoked.RunGroup
							invoked.RunGroup				= LocalRunGroup
							invoked.Sequence				= LocalSequence
							invoked.DistributionAccount		= each.Account
							if  (EnableGLNProcessing)
								invoked.Company				= LocalCompany
								invoked.Vendor				= LocalVendor
							if  (each.LineNumber = PrmErrorLine)
							    invoked.RecordInError		= true
	

						for each each.InterfaceAOCForThisLineRel

							invoke CreateNoRules PayablesInvoiceAddOnChargeImport
								fill in fields from each
									except invoked.RunGroup
								invoked.RunGroup				= LocalRunGroup
								invoked.Sequence				= LocalSequence
								invoked.AddOnCharge				= each.AddOnCharge
								invoked.UnitCost				= each.UnitCost
								invoked.Quantity				= each.EnteredQuantity
								invoked.PostingAccount			= each.Account
								if  (EnableGLNProcessing)
									invoked.Company				= LocalCompany
									invoked.Vendor				= LocalVendor
							invoke FastDelete each
	

						invoke FastDelete each
	

					for each InterfaceHeaderAOCRel

						invoke CreateNoRules PayablesInvoiceAddOnChargeImport
							fill in fields from each
								except invoked.RunGroup
							invoked.RunGroup				= LocalRunGroup
							invoked.Sequence				= blank
							invoked.AddOnCharge				= each.MiscAddOnCharge
							invoked.EnteredAddOnChargeAmount = each.MiscAddOnChargeAmount
							invoked.PostingAccount			= each.MiscellaneousAccount
							if  (EnableGLNProcessing)
								invoked.Company				= LocalCompany
								invoked.Vendor				= LocalVendor
	
						invoke FastDelete each
	
	
					for each InterfaceDistributionRel
						invoke CreateNoRules MatchInvoiceDistributionImport
							fill in fields from each
								except invoked.RunGroup
							invoked.RunGroup				= LocalRunGroup
					        invoked.Sequence				= each.DistributionSequence
					        invoked.TaxableAmount			= each.DistributionTaxableAmount
					        invoked.Description				= each.DistributionDescription
							if  (EnableGLNProcessing)
								invoked.Company				= LocalCompany
								invoked.Vendor				= LocalVendor
	
						invoke FastDelete each 
					
					invoke FastDelete 
	
					commit transaction
				else
				if (RecordType.InvoiceDetail)

					invoke CreateNoRules PayablesInvoiceDetailImport
						fill in fields from this instance
							except invoked.RunGroup
						invoked.RunGroup				= MatchInvoiceImportRel.RunGroup
						invoked.Sequence				= SeqNbr
						invoked.DistributionAccount		= Account
						if  (EnableGLNProcessing)
							invoked.Company				= LocalCompany
							invoked.Vendor				= LocalVendor
						if  (LineNumber = PrmErrorLine)
						    invoked.RecordInError		= true
						invoked.RecordInError			= true
						invoked.ErrorMessage			= PrmErrorMessage


					for each InterfaceAOCForThisLineRel

						invoke CreateNoRules PayablesInvoiceAddOnChargeImport
							fill in fields from each
								except invoked.RunGroup
							invoked.RunGroup				= MatchInvoiceImportRel.RunGroup
							invoked.Sequence				= SeqNbr
							invoked.AddOnCharge				= each.AddOnCharge
							invoked.UnitCost				= each.UnitCost
							invoked.Quantity				= each.EnteredQuantity
							invoked.PostingAccount			= each.Account
							if  (EnableGLNProcessing)
								invoked.Company				= LocalCompany
								invoked.Vendor				= LocalVendor
							invoked.RecordInError			= true
							invoked.ErrorMessage			= PrmErrorMessage
						invoke FastDelete each

					for each InterfaceHeaderAOCRel
						if (!each.AddOnChargeRel.SpreadMethod.NoSpread)
							invoke CreateNoRules PayablesInvoiceAddOnChargeImport
								fill in fields from each
									except invoked.RunGroup
								invoked.RunGroup                = LocalRunGroup
								invoked.Sequence                = blank
								invoked.AddOnCharge             = each.MiscAddOnCharge
								invoked.EnteredAddOnChargeAmount = each.MiscAddOnChargeAmount
								invoked.PostingAccount          = each.MiscellaneousAccount
								if  (EnableGLNProcessing)
									invoked.Company             = LocalCompany
									invoked.Vendor              = LocalVendor

                    		invoke FastDelete each


					invoke FastDelete 
				else
				if (RecordType.MiscAddOnCharge)


					invoke CreateNoRules PayablesInvoiceAddOnChargeImport
						fill in fields from this instance
							except invoked.RunGroup
						invoked.RunGroup				= MatchInvoiceImportRel.RunGroup
						invoked.Sequence				= blank
						invoked.AddOnCharge				= MiscAddOnCharge
						invoked.EnteredAddOnChargeAmount = MiscAddOnChargeAmount
						invoked.PostingAccount			= MiscellaneousAccount
						if  (EnableGLNProcessing)
							invoked.Company				= LocalCompany
							invoked.Vendor				= LocalVendor
						invoked.RecordInError			= true
						invoked.ErrorMessage			= PrmErrorMessage

					invoke FastDelete 
				else
				if (RecordType.LineAddOnCharge)
				    if (InterfaceDetailForAOCRel exists)	
						invoke CreateNoRules PayablesInvoiceDetailImport
							fill in fields from InterfaceDetailForAOCRel
								except invoked.RunGroup
							invoked.RunGroup				= MatchInvoiceImportRel.RunGroup
							invoked.Sequence				= InterfaceDetailForAOCRel.SeqNbr
							invoked.DistributionAccount		= InterfaceDetailForAOCRel.Account
							if  (EnableGLNProcessing)
								invoked.Company				= LocalCompany
								invoked.Vendor				= LocalVendor
							if  (LineNumber = PrmErrorLine)
							    invoked.RecordInError		= true

						invoke FastDelete InterfaceDetailForAOCRel
						


					invoke CreateNoRules PayablesInvoiceAddOnChargeImport
						fill in fields from this instance
							except invoked.RunGroup
						invoked.RunGroup				= MatchInvoiceImportRel.RunGroup
						invoked.Sequence				= SeqNbr
						invoked.AddOnCharge				= AddOnCharge
						invoked.UnitCost				= UnitCost
						invoked.Quantity				= EnteredQuantity
						invoked.PostingAccount			= Account
						if  (EnableGLNProcessing)
							invoked.Company				= LocalCompany
							invoked.Vendor				= LocalVendor
						invoked.RecordInError			= true
						invoked.ErrorMessage			= PrmErrorMessage

					invoke FastDelete 
				else
				if (RecordType.InvoiceDistribution)
					invoke CreateNoRules MatchInvoiceDistributionImport
						fill in fields from this instance
							except invoked.RunGroup
						invoked.RunGroup				= MatchInvoiceImportRel.RunGroup
				        invoked.Sequence				= DistributionSequence
				        invoked.TaxableAmount			= DistributionTaxableAmount
				        invoked.Description				= DistributionDescription
						if  (EnableGLNProcessing)
							invoked.Company				= LocalCompany
							invoked.Vendor				= LocalVendor
						invoked.RecordInError			= true
						invoked.ErrorMessage			= PrmErrorMessage

					invoke FastDelete  
					
				
		MoveToMaintenance is an Instance Action
		    valid when (RecordType.InvoiceHeader)
		    Parameters
		        PrmRunGroup is like RunGroup
		    Parameter Rules
		        PrmRunGroup
		            initial value is RunGroup
		            required
			Action Rules
			    constraint (RecordType.InvoiceHeader)
			        "ActionValidOnHeaderRecordOnly"
			        
				initialize LocalSequence

				if  (ProcessType not entered)
					if  (PurchaseOrder entered
					or   InterfacedPurchaseOrder entered)
						ProcessType = "M"
					else
					if  (ServiceContract entered)
						ProcessType = "V"
					else
						ProcessType = "B"


				invoke CreateNoRules MatchInvoiceImport
					fill in fields from InterfaceHeaderRel
						except invoked.RunGroup
					invoked.RunGroup					= PrmRunGroup
					invoked.TotalTaxAmount				= TaxAmount


				for each InterfaceDetailRel

					LocalSequence += 1
					invoke CreateNoRules PayablesInvoiceDetailImport
						fill in fields from each
							except invoked.RunGroup
						invoked.RunGroup				= PrmRunGroup
						invoked.Sequence				= LocalSequence
						invoked.DistributionAccount		= each.Account


					for each each.InterfaceAOCForThisLineRel

						invoke CreateNoRules PayablesInvoiceAddOnChargeImport
							fill in fields from each
								except invoked.RunGroup
							invoked.RunGroup				= PrmRunGroup
							invoked.Sequence				= LocalSequence
							invoked.AddOnCharge				= each.AddOnCharge
							invoked.UnitCost				= each.UnitCost
							invoked.Quantity				= each.EnteredQuantity
							invoked.PostingAccount			= each.Account
						invoke FastDelete each


					invoke FastDelete each


				for each InterfaceHeaderAOCRel

					invoke CreateNoRules PayablesInvoiceAddOnChargeImport
						fill in fields from each
							except invoked.RunGroup
						invoked.RunGroup				= PrmRunGroup
						invoked.Sequence				= blank
						invoked.AddOnCharge				= each.MiscAddOnCharge
						invoked.EnteredAddOnChargeAmount = each.MiscAddOnChargeAmount
						invoked.PostingAccount			= each.MiscellaneousAccount

					invoke FastDelete each


				for each InterfaceDistributionRel
					invoke CreateNoRules MatchInvoiceDistributionImport
						fill in fields from each
							except invoked.RunGroup
						invoked.RunGroup				= PrmRunGroup
				        invoked.Sequence				= each.DistributionSequence
				        invoked.TaxableAmount			= each.DistributionTaxableAmount
				        invoked.Description				= each.DistributionDescription

					invoke FastDelete each 
				
				invoke FastDelete 
	
		
		InterfaceInvoices is a Set Action
			Parameters
				PrmRunGroup					is a RunGroup
					default label is "RunGroup"
				PrmCompany					is a PayablesCompany
				PrmVendorGroup				is a VendorGroup 
				PrmVendor					is a Vendor
					context of PrmVendorGroup 	
		        InvoiceProcess          	is AlphaUpper size 1
		            States
		                Add         value is "A"
		                AddAndMatch value is "M"
				MatchPoint					is Numeric 1
					States
						RuleGroupOne		value is 1
						RuleGroupTwo		value is 2
						RuleGroupThree		value is 3
				DefaultProcessLevel			is a PayablesProcessLevel
				DefaultAuthorityCode		is a PayablesAuthorityCode
					context of PrmVendorGroup		
				AllowMatchItemOrVendorItem	is Boolean
		    		default label is "AllowMatchOnEitherItemOrVendorItem"
				EnableGLNProcessing			is Boolean
				EnableGTINProcessing		is Boolean
				MoveErrorsToNewRunGroup  	is Boolean
					default label is "MoveErrorsToNewRunGroup"
				PrmErrorRunGroupPrefix		is AlphaUpper 15
					default label is "ErrorRunGroupPrefix"
				RemoveExistingMatchInterfaceInvoices is Boolean
				CreateDetails				is Numeric 1
					States
		 				FromPurchaseOrder			value is 2
		 				FromReceipt					value is 3
						FromReceiptThenFromPO		value is 4

			Parameter Rules
				PrmRunGroup
					required
						"RunGroupIsRequired"
					LocalRunGroup 	= PrmRunGroup

					for each LocalInvoicesInRunGroupRel
						if   ((PrmCompany not entered
						or     each.Company	= PrmCompany)
						and   (PrmVendor  not entered
						or     each.DerivedVendor	= PrmVendor))
					
							constraint (each.RecordType.InvoiceHeader or each.RecordType.InvoiceDetail or each.RecordType.InvoiceDistribution or each.RecordType.MiscAddOnCharge or each.RecordType.LineAddOnCharge)  
								"InvalidRecordType<RecordType>(SeeInvoice<each.Invoice>)"


					LocalFinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup
					
					for each InterfaceResultInProcessRel					
        				Diff = (current timestamp - each.RunTime)
						constraint (Diff > 86400)
							"ExistingJobForThisRunGroupIsAlreadyInProcess"

		        InvoiceProcess
		        	required
		        	initial value is "A"
		        	
		        MatchPoint
		        	default to 1
		        	initial value is 1
				PrmCompany			
					if (!PrmVendorGroup entered)
						PrmVendorGroup = PrmCompany.PayablesCompany.VendorGroup

				PrmVendorGroup		
					if (PrmVendor entered)
						required
							"VendorGroupRequiredWhenVendorIsEnteredWithouCompany"
					constraint (!PrmCompany entered or PrmCompany.PayablesCompany.VendorGroup = PrmVendorGroup)
						"VendorGroupDifferentFromEnteredCompanyVendorGroup<PrmCompany.PayablesCompany.VendorGroup>"

				EnableGLNProcessing
					if (EnableGLNProcessing)


						
						LocalCompany = PrmCompany
						
						initialize Counter

						if (PrmCompany entered)
							if  (GlobalLocationNumberDetailSet6Rel exists)
								SaveGlobalLocationNumber1	= GlobalLocationNumberDetailSet6Rel.GlobalLocationNumber
								SaveCompany1				= GlobalLocationNumberDetailSet6Rel.Company
								
							initialize Counter
							for each GlobalLocationNumberDetailSet2Rel
								Counter += 1
								if  (Counter = 1)
									SaveGlobalLocationNumber2	= each.GlobalLocationNumber
									SaveCompany2				= each.Company
								else
									constraint (instance count of GlobalLocationNumberDetailSet2Rel < 2)
										"MultipleRecordsFoundForCompanyGLN"
								
							if  (PrmVendor entered)
								LocalVendor = PrmVendor
								initialize Counter
								for each GlobalLocationNumberDetailSet4Rel
									Counter += 1
									if  (Counter = 1)
										SaveGlobalLocationNumber7	= each.GlobalLocationNumber
										SaveVendor7					= each.VendorAndVendorLocation.Vendor
									else
										constraint (instance count of GlobalLocationNumberDetailSet4Rel < 2)
											"MultipleRecordsFoundForVendorGLN"
							
				EnableGTINProcessing
			Local Fields
				LocalInstanceCount				is Numeric 10
				LocalInterfaceResultView		is a PayablesInvoiceInterfaceResult view
				SaveGlobalLocationNumber1		is like GlobalLocationNumber
				SaveCompany1					is like Company
				SaveGlobalLocationNumber2		is like GlobalLocationNumber
				SaveCompany2					is like Company
				SaveGlobalLocationNumber7		is like GlobalLocationNumber
				SaveVendor7						is like Vendor
					
				LocalInterfacedInvoiceCountTotal		is Numeric 10
				LocalInterfacedPurchaseOrderCount		is Numeric 10
				LocalInterfacedInvoiceAmountTotal		is an InternationalAmount
				LocalInterfaceInvoiceErrorCount			is Numeric 10
				LocalInterfacedCommentsCount			is Numeric 10
				LocalInterfaceCommentErrorCount			is Numeric 10
				
			Instance Selection			
				where  (RunGroup	= PrmRunGroup
				and     RecordType.InvoiceHeader
				and    (PrmCompany            			  not entered
				or      Company	= PrmCompany)
				and    (PrmVendor            			  not entered
				or      Vendor	= PrmVendor)
				and	   (PrmVendorGroup						not entered		
				or 		Company.PayablesCompany.VendorGroup = PrmVendorGroup))
				

			Sort Order is ByRunGroupInvoiceType

			Action Rules

				Empty Set Rules
					invoke Create PayablesInvoiceInterfaceResult
						assign result to LocalInterfaceResultView
						invoked.FinanceEnterpriseGroup		= actor.context.FinanceEnterpriseGroup
						invoked.RunTime						= current timestamp
						invoked.RunGroup					= PrmRunGroup
						invoked.RunType						= 2
						invoked.Company						= PrmCompany
						invoked.Vendor						= PrmVendor
				        invoked.InvoiceProcess				= InvoiceProcess
						invoked.MatchPoint					= MatchPoint
						invoked.ValidateVendorItem			= AllowMatchItemOrVendorItem
						invoked.MoveErrorsToNewRunGroup		= MoveErrorsToNewRunGroup
						invoked.ErrorRunGroupPrefix			= PrmErrorRunGroupPrefix
						invoked.DefaultProcessLevel			= DefaultProcessLevel
						invoked.DefaultAuthorityCode		= DefaultAuthorityCode
						invoked.EnableGLNProcessing			= EnableGLNProcessing
						invoked.EnableGTINProcessing		= EnableGTINProcessing
						invoked.Status						= 1 
						invoked.VendorGroup					= PrmVendorGroup	
				
				RunGroup Set Rules
					Entrance Rules
						ErrorOccurred							= false


												
						invoke Create PayablesInvoiceInterfaceResult
							assign result to LocalInterfaceResultView
							invoked.FinanceEnterpriseGroup		= actor.context.FinanceEnterpriseGroup
							invoked.RunTime						= current timestamp
							invoked.RunGroup					= PrmRunGroup
							invoked.RunType						= 2
							invoked.Company						= PrmCompany
							invoked.Vendor						= PrmVendor
					        invoked.InvoiceProcess				= InvoiceProcess
							invoked.MatchPoint					= MatchPoint
							invoked.ValidateVendorItem			= AllowMatchItemOrVendorItem
							invoked.ErrorRunGroupPrefix			= PrmErrorRunGroupPrefix
							invoked.MoveErrorsToNewRunGroup		= MoveErrorsToNewRunGroup 
							invoked.DefaultProcessLevel			= DefaultProcessLevel
							invoked.DefaultAuthorityCode		= DefaultAuthorityCode
							invoked.EnableGLNProcessing			= EnableGLNProcessing
							invoked.EnableGTINProcessing		= EnableGTINProcessing
							invoked.VendorGroup					= PrmVendorGroup	

					Exit Rules
						invoke Update LocalInterfaceResultView.PayablesInvoiceInterfaceResult
							invoked.RecordsProcessed			= LocalInstanceCount

							invoked.InterfacedInvoicesAmountTotal	= LocalInterfacedInvoiceAmountTotal
							invoked.InterfacedInvoicesCount			= LocalInterfacedInvoiceCountTotal
							invoked.InterfaceInvoiceErrorCount		= LocalInterfaceInvoiceErrorCount
							invoked.InterfacedCommentsCount			= LocalInterfacedCommentsCount
							invoked.InterfacedPurchaseOrdersCount    = LocalInterfacedPurchaseOrderCount

						invoke InvoiceDetailLoad EDIInvoiceMatchInterfaceInput
							invoked.PrmRunGroup					= PrmRunGroup
							invoked.PrmCompany					= PrmCompany
							invoked.PrmVendor					= PrmVendor
					        invoked.InvoiceProcess				= InvoiceProcess
							invoked.MatchPoint					= MatchPoint
							invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
							invoked.EnableGLNProcessing			= EnableGLNProcessing
							invoked.EnableGTINProcessing		= EnableGTINProcessing
							invoked.PrmInterfaceRun				= LocalInterfaceResultView.PayablesInvoiceInterfaceResult
							invoked.PrmVendorGroup				= PrmVendorGroup		
					
				Instance Rules


					if  (RemoveExistingMatchInterfaceInvoices
					and  MatchInvoiceImportRel exists)
						invoke Delete MatchInvoiceImportRel

					if (AutoRejectEnabled
					and !ErrorOccurred)
						CheckCompany        = Company
						CheckPurchaseOrder  = PurchaseOrder
						if (RequireWorkOrder)
							LocalCXMLText = InvalidWorkOrderMsg + ": "
							for each InterfaceDetailRel
								if (!each.EAMWorkOrder exists
									or each.EAMWorkOrder not entered)
									ErrorOccurred 		= true
									LocalCXMLText	 	+= each.SeqNbr + ", "
							if (ErrorOccurred)
								LocalErrorMessage	= InvalidWorkOrderMsg
					if (ErrorOccurred 
					and AutoRejectEnabled
					and LocalErrorMessage contains InvalidWorkOrderMsg)
						invoke CXMLInvoiceRejectStatus
							resume on error
						invoke Delete InterfaceDetailRel
						invoke Delete InterfaceAOCRel
						invoke Delete InterfaceHeaderRel
						LocalInterfaceInvoiceErrorCount			+= 1
					else
	                if  (SkipThisRecord)
						NextSentence = true
					else
	                if  (PayablesCompanyRel.Company.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)

						ErrorOccurred							= false
						LocalInterfaceResult 					= LocalInterfaceResultView.PayablesInvoiceInterfaceResult
	
						initialize ErrorOccurred
	
						if  (EnableGLNProcessing)
							include GLNProcessing

						if  (!ErrorOccurred)
							include InterfaceEdits
	
						if (ErrorOccurred)
							LocalInterfaceInvoiceErrorCount			+= 1
							invoke CreateErrorRecord
								invoked.PrmErrorMessage			= LocalErrorMessage
								invoked.PrmResult				= LocalInterfaceResult
								invoked.EnableGLNProcessing		= EnableGLNProcessing
						else		
	
							if  (ProcessType.MatchInvoice
							or   ProcessType.AOCMatchInvoice)
								LocalPurchaseOrder = DerivedPurchaseOrder
	
							invoke CreateImportInvoice PayablesInvoice
								assign result to InterfacedInvoice
								resume on error
									ErrorOccurred		= true
									LocalErrorMessage	= error message
								fill in fields from this instance
									except invoked.InvoiceAmount
									except invoked.DiscountAmount
									except invoked.TotalTaxAmount
		
								invoked.Vendor								= DerivedVendor
								invoked.PayVendor							= DerivedPayVendor
		
								if  (ProcessType.Basic)
									invoked.TransientInvoiceEntryTemplate	= 0
									if (ExternalPurchaseOrder entered)
										invoked.ExternalPurchaseOrder		= ExternalPurchaseOrder 
									else
									if (InterfacedPurchaseOrder entered)
										invoked.ExternalPurchaseOrder		= InterfacedPurchaseOrder 
									else
									if (PurchaseOrder entered)
										invoked.ExternalPurchaseOrder		= PurchaseOrder 
								else
								if  (ProcessType.Freight)
									invoked.TransientInvoiceEntryTemplate	= 3
									if (ExternalPurchaseOrder entered)
										invoked.ExternalPurchaseOrder		= ExternalPurchaseOrder 
									else
									if (InterfacedPurchaseOrder entered)
										invoked.ExternalPurchaseOrder		= InterfacedPurchaseOrder 
									else
									if (PurchaseOrder entered)
										invoked.ExternalPurchaseOrder		= PurchaseOrder 
								else
								if  (ProcessType.ServiceContract)
									invoked.TransientInvoiceEntryTemplate	= 5
								else
								if  (ProcessType.MatchInvoice)
									invoked.TransientInvoiceEntryTemplate	= 4
									invoked.FirstPurchaseOrder				= LocalPurchaseOrder
	
								else
								if  (ProcessType.AOCMatchInvoice)
									invoked.TransientInvoiceEntryTemplate	= 3
									invoked.FirstPurchaseOrder				= LocalPurchaseOrder
									invoked.TransientAddOnChargeOnly 		= true
									
								if   (!InterfaceDetailRel exists
								and   InterfaceAOCRel exists)
									invoked.TransientAddOnChargeOnly 		= true

								if (ProcessLevel not entered)
									invoked.ProcessLevel					= DefaultProcessLevel
																			
								if (AuthorityCode not entered
								and DefaultAuthorityCode entered)
									invoked.AuthorityCode					= DefaultAuthorityCode
	
								invoked.InvoiceAmount.CurrencyAmount		= InvoiceTransactionAmount
								invoked.DiscountAmount.CurrencyAmount		= DiscountAmount
								invoked.DiscountAmount.FunctionalAmount.EnteredCurrencyRate = DiscountPercent
								invoked.DiscountAmount.ExchangeDate			= DiscountDate
								
								invoked.CreditMemoReferenceInvoice			= CreditMemoReferenceInvoice
								invoked.IDMDocumentPID						= IDMDocumentPID
								invoked.ReceiptOfInvoiceDate				= InvoiceReceiptDate
								
								invoked.OverridePayImmediately				= PayImmediately
								invoked.InvoiceSource						= "E"
								invoked.InterfaceInProcess					= true
								invoked.OriginatingInterfaceRun				= LocalInterfaceResult
	
								if  (EnableGLNProcessing)
									invoked.Company							= UseCompany
									invoked.Vendor							= UseVendor
									invoked.Location						= UseLocation
									invoked.PurchaseFromLocation			= UsePurchaseFromLocation
									invoked.RemitToCode						= UseRemitToCode
								
								if (CreateDetails entered	
								and NoDetailRecordsFound)	
									invoked.TransientCreateDetails			= CreateDetails
									
							if (ErrorOccurred)

								LocalInterfaceInvoiceErrorCount			    += 1
								if  (PayablesInvoiceInterfaceInProcessRel exists
								and  PayablesInvoiceInterfaceInProcessRel.OriginatingInterfaceRun = LocalInterfaceResult)
									invoke Delete PayablesInvoiceInterfaceInProcessRel

								invoke Delete PayablesInvoice
								
								invoke CreateErrorRecord
									invoked.PrmErrorMessage					= LocalErrorMessage
									invoked.PrmResult						= LocalInterfaceResult
									invoked.EnableGLNProcessing				= EnableGLNProcessing
							else
								PayablesInvoice								= InterfacedInvoice.PayablesInvoice
								LocalInterfacedInvoiceCountTotal		    += 1


						LocalInstanceCount			+= 1

 		PostLoadInterface is a Set Action
 			restricted
			Parameters
				PrmRunGroup					is a RunGroup
					default label is "RunGroup"
				PrmCompany					is a PayablesCompany
				PrmVendorGroup				is a VendorGroup	
				PrmVendor					is a Vendor
					context of PrmVendorGroup		
		        InvoiceProcess          	is AlphaUpper size 1
		            States
		                Add         value is "A"
		                AddAndMatch value is "M"
				MatchPoint					is Numeric 1
					States
						RuleGroupOne		value is 1
						RuleGroupTwo		value is 2
						RuleGroupThree		value is 3
				AllowMatchItemOrVendorItem			is Boolean
				EnableGLNProcessing			is Boolean
				EnableGTINProcessing		is Boolean
				PrmInterfaceRun				is like PayablesInvoiceInterfaceResult

			Parameter Rules
				PrmRunGroup
					required

			Accumulators
				PerfectMatchCount
				PerfectMatchAmount
				MatchedInToleranceCount
				MatchedInToleranceAmount
				MatchedOutOfToleranceCount
				MatchedOutOfToleranceAmount
				MatchedWithChargebackCount
				MatchedWithChargebackAmount
				TotalChargebackAmount
				MatchedWithServiceContractCount
				MatchedWithServiceContractAmount
				UnmatchedCount
				UnmatchedAmount
				ReleasedExpenseCount
				ReleasedExpenseAmount
				ReleasedCreditCount
				ReleasedCreditAmount
				UnreleasedExpenseCount
				UnreleasedExpenseAmount
				UnreleasedCreditCount
				UnreleasedCreditAmount

			Instance Selection
				where  (RunGroup	= PrmRunGroup
				and     RecordType.InvoiceHeader
				and    (PrmCompany            			  not entered
				or      Company	= PrmCompany)
				and    (PrmVendor            			  not entered
				or      Vendor	= PrmVendor)
				and     PayablesInvoice entered
				and    (PrmVendorGroup					not entered		
				or      Company.PayablesCompany.VendorGroup = PrmVendorGroup))

			Sort Order is ByRunGroupInvoiceType

			Action Rules
				Empty Set Rules

					
					LocalFinanceEnterpriseGroup					= PrmCompany.FinanceEnterpriseGroup
					if (LocalFinanceEnterpriseGroup not entered)	
						LocalFinanceEnterpriseGroup				= actor.context.FinanceEnterpriseGroup

					LocalInterfaceResult						= PrmInterfaceRun
					if (!SetInterfaceResultsRel.Status = 2)
						invoke Update SetInterfaceResultsRel
							invoked.Status        			= 1

				RunGroup Set Rules
						
					Exit Rules


						LocalFinanceEnterpriseGroup					= PrmCompany.FinanceEnterpriseGroup
						if (LocalFinanceEnterpriseGroup not entered)	
							LocalFinanceEnterpriseGroup				= actor.context.FinanceEnterpriseGroup

						LocalInterfaceResult						= PrmInterfaceRun

						invoke Update SetInterfaceResultsRel
							invoked.PerfectMatchCount					= PerfectMatchCount
							invoked.PerfectMatchAmount					= PerfectMatchAmount
							invoked.MatchedInToleranceCount				= MatchedInToleranceCount
							invoked.MatchedInToleranceAmount			= MatchedInToleranceAmount
							invoked.MatcedOutOfToleranceCount			= MatchedOutOfToleranceCount
							invoked.MatchedOutOfToleranceAmount			= MatchedOutOfToleranceAmount
							invoked.MatchedWithChargebackCount			= MatchedWithChargebackCount
							invoked.MatchedWithChargebackAmount			= MatchedWithChargebackAmount
							invoked.TotalChargebackAmount				= TotalChargebackAmount
							invoked.MatchedWithServiceContractCount		= MatchedWithServiceContractCount
							invoked.MatchedWithServiceContractAmount	= MatchedWithServiceContractAmount
							invoked.UnmatchedCount						= UnmatchedCount
							invoked.UnmatchedAmount						= UnmatchedAmount
							invoked.ReleasedExpenseCount				= ReleasedExpenseCount
							invoked.ReleasedExpenseAmount				= ReleasedExpenseAmount
							invoked.ReleasedCreditCount					= ReleasedCreditCount
							invoked.ReleasedCreditAmount				= ReleasedCreditAmount
							invoked.UnreleasedExpenseCount				= UnreleasedExpenseCount
							invoked.UnreleasedExpenseAmount				= UnreleasedExpenseAmount
							invoked.UnreleasedCreditCount				= UnreleasedCreditCount
							invoked.UnreleasedCreditAmount				= UnreleasedCreditAmount
							if (!invoked.Status = 2)
								invoked.Status        			= 1

						if  (GeneralLedgerSystemCodeRel.EncumbranceOption.Track     	
						or   GeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit)	
							invoke ProcessInterfaceBatchEdits BudgetEditBatch					
								invoked.PrmFinanceEnterpriseGroup 	= LocalFinanceEnterpriseGroup 
								invoked.PrmBusinessClassName 		= "PayablesInvoice" 

						if (InvoiceProcess.AddAndMatch)
							invoke ScheduleAutoMatch SetInterfaceResultsRel

				Instance Rules



					LocalInterfaceResult = PrmInterfaceRun

					if  (PayablesInvoice = MatchInvoiceImportRel.PayablesInvoice)
						invoke FastDelete
					else  
	                if  (SkipThisRecord)

						NextSentence = true
					else
	                if  (PayablesCompanyRel.Company.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
						if  (EnableGLNProcessing)
							invoke FastUpdate GLNPayablesInvoiceRel
								invoked.InterfaceInProcess	= false
		
							ErrorOccurred		= false
							
							invoke UpdateErrorRecordsAction GLNPayablesInvoiceRel
								resume on error
									ErrorOccurred		= true
		
							if (!ErrorOccurred)
								if  (!PayablesInvoice.MatchProcessType.Expense)
									invoke InvoiceUpdate GLNPayablesInvoiceRel
										resume on error
											ErrorOccurred		= true
			
								if (!ErrorOccurred)
									if  (InvoiceProcess.AddAndMatch)

										invoke Unreleased.SubmitForApproval PayablesInvoice
											resume on error
												ErrorOccurred = true
												LocalErrorMessage	= error message
							
										if  (ErrorOccurred)
											invoke Update LocalInterfaceResultsRel
												invoked.MatchOrReleaseError = true								
											invoke PurgeSetsAndResourceRecords GLNPayablesInvoiceRel.MatchReconQueueRel
											invoke PurgeDetail GLNPayablesInvoiceRel.MatchWorkRel
											invoke Purge GLNPayablesInvoiceRel.MatchWorkRel
									else
										invoke CheckRoutingRules PayablesInvoice
											resume on error

							if (HoldCode entered)
								invoke PutInvoiceOnHold GLNPayablesInvoiceRel
									invoked.HoldCode = HoldCode

						else
							invoke FastUpdate PayablesInvoice
								invoked.InterfaceInProcess	= false
		
							ErrorOccurred		= false
							
							invoke UpdateErrorRecordsAction PayablesInvoice
								resume on error
									ErrorOccurred		= true
		
							if (!ErrorOccurred
							and !PayablesInvoice.MatchProcessType.Expense)

								invoke InvoiceUpdate PayablesInvoice
									resume on error
										ErrorOccurred		= true
										LocalErrorMessage	= error message

		
							if (!ErrorOccurred)
								if  (InvoiceProcess.AddAndMatch)

									invoke Unreleased.SubmitForApproval PayablesInvoice
										resume on error
											ErrorOccurred = true
											LocalErrorMessage	= error message

								else
								if   (PayablesInvoice.MatchProcessType.Expense
								and  ((PayablesInvoice.RemitToCode entered
								and    PayablesInvoice.RemitToCode.EDIAutoRelease)
								or    (PayablesInvoice.RemitToCode not entered
								and    PayablesInvoice.Vendor.EDIAutoRelease)))

									invoke Unreleased.Release PayablesInvoice
										resume on error
											ErrorOccurred		= true
											LocalErrorMessage	= error message

								else
									invoke CheckRoutingRules PayablesInvoice
										resume on error
						
								if  (ErrorOccurred)
									invoke Update LocalInterfaceResultsRel
										invoked.MatchOrReleaseError = true								
									invoke PurgeSetsAndResourceRecords PayablesInvoice.MatchReconQueueRel
									invoke PurgeDetail PayablesInvoice.MatchWorkRel
									invoke Purge PayablesInvoice.MatchWorkRel

							if (HoldCode entered)
								invoke PutInvoiceOnHold PayablesInvoice
									invoked.HoldCode = HoldCode

						if  (PayablesInvoice.MatchProcessType.Expense)
							if  (PayablesInvoice.InvoiceType.CreditMemo)
								if  (PayablesInvoice.Status.Unreleased)
									UnreleasedCreditCount				+= 1
									UnreleasedCreditAmount				+= PayablesInvoice.InvoiceAmount.CurrencyAmount
								else
									ReleasedCreditCount					+= 1
									ReleasedCreditAmount				+= PayablesInvoice.InvoiceAmount.CurrencyAmount
							else
								if  (PayablesInvoice.Status.Unreleased)
									UnreleasedExpenseCount				+= 1
									UnreleasedExpenseAmount				+= PayablesInvoice.InvoiceAmount.CurrencyAmount
								else
									ReleasedExpenseCount				+= 1
									ReleasedExpenseAmount				+= PayablesInvoice.InvoiceAmount.CurrencyAmount

						else
							UnmatchedCount							+= 1
							UnmatchedAmount							+= PayablesInvoice.InvoiceAmount.CurrencyAmount
	
						invoke FastDelete 
	

		InvoiceDetailLoad is a Set Action
			restricted
			Parameters
				PrmRunGroup					is a RunGroup
					default label is "RunGroup"
				PrmCompany					is a PayablesCompany
				PrmVendorGroup				is a VendorGroup	
				PrmVendor					is a Vendor
					context of PrmVendorGroup		
		        InvoiceProcess          	is AlphaUpper size 1
		            States
		                Add         value is "A"
		                AddAndMatch value is "M"
				MatchPoint					is Numeric 1
					States
						RuleGroupOne		value is 1
						RuleGroupTwo		value is 2
						RuleGroupThree		value is 3
				AllowMatchItemOrVendorItem			is Boolean
				EnableGLNProcessing			is Boolean
				EnableGTINProcessing		is Boolean
				PrmInterfaceRun				is like PayablesInvoiceInterfaceResult
				
			Parameter Rules
				PrmRunGroup
					required
						"RunGroupIsRequired"
			Local Fields
				LocalInterfacedDetailsCount			is Numeric 10

			Instance Selection
				where  (RunGroup	= PrmRunGroup
				and     RecordType.InvoiceDetail
				and    (PrmCompany            			  not entered
				or      Company	= PrmCompany)
				and    (PrmVendor            			  not entered
				or      Vendor	= PrmVendor)
				and    (PrmVendorGroup					not entered		
				or      Company.PayablesCompany.VendorGroup = PrmVendorGroup))

			Sort Order is ByRunGroupInvoiceType

			Action Rules

				Empty Set Rules
						

					invoke InvoiceDetailDistributionLoad EDIInvoiceMatchInterfaceInput
						invoked.PrmRunGroup					= PrmRunGroup
						invoked.PrmCompany					= PrmCompany
						invoked.PrmVendor					= PrmVendor
				        invoked.InvoiceProcess				= InvoiceProcess
						invoked.MatchPoint					= MatchPoint
						invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
						invoked.EnableGLNProcessing			= EnableGLNProcessing
						invoked.EnableGTINProcessing		= EnableGTINProcessing
						invoked.PrmInterfaceRun				= PrmInterfaceRun
						invoked.PrmVendorGroup				= PrmVendorGroup	

				RunGroup Set Rules
						
					Entrance Rules

					Exit Rules
						LocalFinanceEnterpriseGroup			= PrmCompany.FinanceEnterpriseGroup
						if (LocalFinanceEnterpriseGroup not entered)	
							LocalFinanceEnterpriseGroup		= actor.context.FinanceEnterpriseGroup
	
						LocalInterfaceResult				= PrmInterfaceRun
						invoke Update SetInterfaceResultsRel
							invoked.InterfacedDetailsCount			= LocalInterfacedDetailsCount

						invoke InvoiceDetailDistributionLoad EDIInvoiceMatchInterfaceInput
							invoked.PrmRunGroup					= PrmRunGroup
							invoked.PrmCompany					= PrmCompany
							invoked.PrmVendor					= PrmVendor
					        invoked.InvoiceProcess				= InvoiceProcess
							invoked.MatchPoint					= MatchPoint
							invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
							invoked.EnableGLNProcessing			= EnableGLNProcessing
							invoked.EnableGTINProcessing		= EnableGTINProcessing
							invoked.PrmInterfaceRun				= PrmInterfaceRun
							invoked.PrmVendorGroup				= PrmVendorGroup	


				Instance Rules

	                if  (SkipThisRecord)
						NextSentence = true
					else
					if  (!InterfaceHeaderRel exists
					or    InterfaceHeaderRel.PayablesInvoice not entered)

						NextSentence = true
					else
	                if  (PayablesCompanyRel.Company.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
						LocalInterfacedDetailsCount					+= 1
						ErrorOccurred								= false
	
						LocalVendor									= InterfaceHeaderRel.DerivedVendor						
						LocalPurchaseOrder							= DerivedPurchaseOrder

		
						if  (EnableGTINProcessing
						and  ItemGTIN entered)
							LocalCompany							= Company
							if  (EnableGLNProcessing)
								LocalCompany						= InterfaceHeaderRel.UseCompany
								
							Item									= first ItemGTINRel.Item
								











	
						if  (!ErrorOccurred)
							if  (EnableGLNProcessing
							and  GlnLocation entered)
								UseCompany								= InterfaceHeaderRel.UseCompany
								LocalGlobalLocationNumberType 			= 3
								LocalGlobalLocationNumber				= GlnLocation
								initialize Counter
								for each GlobalLocationNumberDetailSet1Rel
									Counter += 1
									UseLocation							= first GlobalLocationNumberDetailSet1Rel.RequestingCompanyAndLocation.RequestingLocation
			
								if  (UseLocation not entered	
								or   Counter != 1)
									ErrorOccurred						= true
									LocalErrorMessage					= CannotDetermineLocationUsingGLNMsg
		
						if  (!ErrorOccurred)
							if  (VendorItem not entered
							and  VendorItemRel exists)
								VendorItem								= VendorItemRel.VendorItem

						if  (!ErrorOccurred
						and  DerivedPurchaseOrder entered)

							initialize POLineLookup
							POLineLookup.Company				= Company
							POLineLookup.PurchaseOrder			= DerivedPurchaseOrder

							POLineLookup.PurchaseOrderLine		= LineNumber
							POLineLookup.Item					= Item
							POLineLookup.VendorItem				= VendorItem
							POLineLookup.Description			= ItemDescription
							POLineLookup.Location				= Location
							POLineLookup.AllowMatchItemOrVendorItem = AllowMatchItemOrVendorItem
							POLineLookup.InterfaceType 			= "I"
							if (Location not entered
							and InterfaceHeaderRel.Location entered)
								POLineLookup.Location			= InterfaceHeaderRel.Location
								
							LocalTrigger						= POLineLookup.ExecuteLookup
							
							if (POLineLookup.PurchaseOrderLine != LineNumber
							and InterfaceLineAOCRel exists)
							    invoke Update InterfaceLineAOCRel
							    	invoked.LineNumber			= POLineLookup.PurchaseOrderLine
							    	
							LineNumber							= POLineLookup.PurchaseOrderLine

							if  (POLineLookup.OutputErrorNumber entered)
								ErrorOccurred					= true
								LocalErrorMessage				= POLineLookup.OutputErrorMessage
							else
								Item							= POLineLookup.Item
								VendorItem						= POLineLookup.VendorItem
								if (EnteredUOM not entered)
								    EnteredUOM						= POLineLookup.PurchaseOrderLineRel.EnteredBuyUOM

						if (!ErrorOccurred
						and  InterfaceHeaderRel.ServiceContract entered
						and  LineNumber not entered)
							if  (AllowMatchItemOrVendorItem)
								if  (Item entered
								and  instance count of ContractLineByItemRel = 1)
									LineNumber			= first ContractLineByItemRel.ContractLine
								else
								if  (VendorItem entered
								and  instance count of ContractLineByVendorItemRel = 1)
									LineNumber			= first ContractLineByVendorItemRel.ContractLine
								else
								if  (ItemDescription entered
								and  instance count of ContractLineByItemDescriptionRel = 1)
									LineNumber			= first ContractLineByItemDescriptionRel.ContractLine
							else								
								if  (Item entered
								and  instance count of ContractLineByItemRel = 1
								and (VendorItem not entered
								or   first ContractLineByItemRel.VendorItem = VendorItem))
									LineNumber			= first ContractLineByItemRel.ContractLine
								else
								if  (VendorItem entered
								and  instance count of ContractLineByVendorItemRel = 1
								and (Item not entered
								or   first ContractLineByItemRel.ItemNumber = Item))
									LineNumber			= first ContractLineByVendorItemRel.ContractLine
								else
								if  (ItemDescription entered
								and  instance count of ContractLineByItemDescriptionRel = 1
								and (Item not entered
								or   first ContractLineByItemRel.ItemNumber = Item)
								and (VendorItem not entered
								or   first ContractLineByItemRel.VendorItem = VendorItem))
									LineNumber			= first ContractLineByItemDescriptionRel.ContractLine

							if  (LineNumber not entered)
								ErrorOccurred			= true
								LocalErrorMessage		= ContractLineNotFoundMsg
	


						if  (!ErrorOccurred)
							if  (InterfaceHeaderRel.ProcessType.Basic
							or   InterfaceHeaderRel.ProcessType.Freight)
								ErrorOccurred							= true
								LocalErrorMessage						= InvoiceDetailNotAllowedForExpenseInvoiceMsg
							

						if (!ErrorOccurred)
							if  (PurchaseOrderLineRel exists
							and  PurchaseOrderLineRel.CostOption.NoCharge
							and  LocalVendorRel.AllowZeroCostInvoice.No
							and  !MatchCompanyRel.AllowZeroCostInvoice)
								ErrorOccurred						= true
								LocalErrorMessage					= CannotInterfaceNoCostLineMsg
	

						if (!ErrorOccurred)
							if (!Interfaced)


								if  (!InterfaceHeaderRel.InvoiceType.CreditMemo
								and  !InterfaceHeaderRel.InvoiceType.DebitMemo)
									if (InterfaceHeaderRel.ServiceContract entered)
										LocalContract = InterfaceHeaderRel.ServiceContract
									    LocalContractLine = LineNumber
									    initialize LocalPOLine
									else
									if  (PurchaseOrderLineRel.Contract entered)
										LocalPOLine = LineNumber
										LocalContract = PurchaseOrderLineRel.Contract
									    LocalContractLine = PurchaseOrderLineRel.ContractLine
									else
									    LocalPOLine = LineNumber
									    initialize LocalContract
									    initialize LocalContractLine

								if  (InterfaceHeaderRel.InvoiceType.CreditMemo
								or    InterfaceHeaderRel.InvoiceType.DebitMemo)

									if (InterfaceHeaderRel.ServiceContract entered)
									    LocalContractLine = LineNumber
									    initialize LocalPOLine
									else
									    LocalPOLine = LineNumber
									    initialize LocalContractLine

					                LocalOriginalInvoice 			= InterfaceHeaderRel.PayablesInvoice.MatchInvoiceReferenceRel.OriginalInvoice
									LocalOriginalInvoiceDetail 		= first LocalOriginalInvoiceDetailRel.PayablesInvoiceDetail

									if (UnitCost < 0)
									    AbsoluteUnitCost = UnitCost * -1
									else
									    AbsoluteUnitCost = UnitCost



									if  (InterfaceHeaderRel.ServiceContract entered
									and (EnteredQuantity < 0
									or   AbsoluteUnitCost = ContractLineRel.BaseCost))
									    QuantityAdjustment = true
										CostAdjustment = false
									else
									if  (DerivedPurchaseOrder entered
									and (EnteredQuantity < 0
									or   AbsoluteUnitCost = PurchaseOrderLineRel.EnteredUnitCost))
									    QuantityAdjustment = true
										CostAdjustment = false
									else
									    CostAdjustment = true
										QuantityAdjustment = false


									invoke OnlineMemoCreate PayablesInvoiceDetail
										assign result to LocalInvoiceDetailView
										resume on error
											ErrorOccurred		= true
											LocalErrorMessage	= error message
										fill in fields from this instance
										invoked.Company						= Company
										invoked.PayablesInvoice				= InterfaceHeaderRel.PayablesInvoice
										invoked.CostOrQuantityAdjustment	= true
										if  (InterfaceHeaderRel.ServiceContract entered)
											invoked.Contract					= InterfaceHeaderRel.ServiceContract
											invoked.ContractLine				= LineNumber
										else
											invoked.PurchaseOrder				= DerivedPurchaseOrder
											invoked.PurchaseOrderLine			= LineNumber

										invoked.TransientDistributionAccount	= DistributionAccount 
								        invoked.RecordSource					= "LM"
										invoked.BypassInvoiceErrorChecking		= true
										invoked.FromInterface					= true
										if (LineNumber entered)
											invoked.BypassDistributionCreate	= true

										if (CostAdjustment)
											invoked.MemoAdjustType				= 1
											if (EnteredQuantity > 0)
												invoked.EnteredQuantity			= EnteredQuantity
											else
												invoked.EnteredQuantity			= EnteredQuantity * -1
												
											if (UnitCost < 0
		                                    and PurchaseOrderLineRel.ItemType.Inventoried)
												invoked.EnteredUnitCost			= UnitCost * -1
											else
    											invoked.EnteredUnitCost			= UnitCost
										else
											invoked.MemoAdjustType				= 2
											if (EnteredQuantity < 0)
												invoked.EnteredQuantity			= EnteredQuantity
											else
												invoked.EnteredQuantity			= EnteredQuantity * -1
												
											if (UnitCost > 0)
												invoked.EnteredUnitCost			= UnitCost
											else
												invoked.EnteredUnitCost			= UnitCost * -1
								else
								if  (LocalInterfacedDetailRel exists
								and  !PurchaseOrderLineRel.ServiceCode.Amount
								and  !LocalInterfacedDetailRel.ContractLine.ServiceCode.Amount)

									LocalOriginalInvoiceDetail 		= first LocalInterfacedDetailRel.PayablesInvoiceDetail
									round UnitCost to nearest LocalInterfacedDetailRel.DerivedRoundToCost
									if  (UnitCost != LocalInterfacedDetailExactRel.EnteredUnitCost
									or   EnteredUOM != LocalInterfacedDetailExactRel.EnteredUOM)
										ErrorOccurred			= true
										LocalErrorMessage		= AdditionalLineMismatchMsg
									else
										LocalInvoiceDetailView	= LocalInterfacedDetailExactRel.PayablesInvoiceDetail
									    invoke Update LocalInterfacedDetailExactRel
											resume on error
												ErrorOccurred		= true
												LocalErrorMessage	= error message
											invoked.EnteredQuantity					+= EnteredQuantity
								else

									invoke Create PayablesInvoiceDetail
										assign result to LocalInvoiceDetailView
										resume on error
											ErrorOccurred		= true
											LocalErrorMessage	= error message
										fill in fields from this instance
										invoked.PayablesInvoice					= InterfaceHeaderRel.PayablesInvoice
										invoked.EnteredQuantity					= EnteredQuantity
										invoked.EnteredUnitCost					= UnitCost
										invoked.EnteredUOM						= EnteredUOM
										if  (InterfaceHeaderRel.ServiceContract entered)
											invoked.Contract					= InterfaceHeaderRel.ServiceContract
											invoked.ContractLine				= LineNumber
										else
											invoked.PurchaseOrder				= DerivedPurchaseOrder
											invoked.PurchaseOrderLine			= LineNumber
		
										if  (PurchaseOrderLineRel exists
										and  EnteredUOM not entered)
											invoked.EnteredUOM					= PurchaseOrderLineRel.VendorPriceUOM
											invoked.EnteredUOMMultiplier		= PurchaseOrderLineRel.VendorPriceUOMMultiplier
										else
										if  (PurchaseOrderLineRel exists
										and  EnteredUOM not entered)
											invoked.EnteredUOM					= PurchaseOrderLineRel.VendorPriceUOM
											invoked.EnteredUOMMultiplier		= PurchaseOrderLineRel.VendorPriceUOMMultiplier
										else
										if  (ItemUOMRel exists)
											invoked.EnteredUOMMultiplier		= ItemUOMRel.UOMConversion
			
										invoked.TransientDistributionAccount	= Account 
								        invoked.RecordSource					= "LM"
										invoked.BypassInvoiceErrorChecking		= true
										invoked.FromInterface					= true
		
										if  (EnableGLNProcessing)
											invoked.Company						= InterfaceHeaderRel.UseCompany
											invoked.Vendor						= InterfaceHeaderRel.UseVendor
										if (LineNumber entered)
											invoked.BypassDistributionCreate	= true
	
						if (ErrorOccurred)

							invoke CreateErrorRecord 
								invoked.PrmErrorMessage			= LocalErrorMessage
								invoked.PrmResult				= PrmInterfaceRun
								invoked.EnableGLNProcessing		= EnableGLNProcessing
								invoked.PrmErrorLine			= LineNumber
						else
							Interfaced = true
							SystemAssignedInvoiceDetail = LocalInvoiceDetailView.PayablesInvoiceDetail
	
	
		InvoiceDetailDistributionLoad is a Set Action
			restricted
			Parameters
				PrmRunGroup					is a RunGroup
					default label is "RunGroup"
				PrmCompany					is a PayablesCompany
				PrmVendorGroup				is a VendorGroup	
				PrmVendor					is a Vendor
					context of PrmVendorGroup		
		        InvoiceProcess          	is AlphaUpper size 1
		            States
		                Add         value is "A"
		                AddAndMatch value is "M"
				MatchPoint					is Numeric 1
					States
						RuleGroupOne		value is 1
						RuleGroupTwo		value is 2
						RuleGroupThree		value is 3
				AllowMatchItemOrVendorItem			is Boolean
				EnableGLNProcessing			is Boolean
				EnableGTINProcessing		is Boolean
				PrmInterfaceRun				is like PayablesInvoiceInterfaceResult
				
			Parameter Rules
				PrmRunGroup
					required
						"RunGroupIsRequired"
			Local Fields

			Instance Selection
				where  (RunGroup	= PrmRunGroup
				and     RecordType.InvoiceDetail
				and    (PrmCompany            			  not entered
				or      Company	= PrmCompany)
				and    (PrmVendor            			  not entered
				or      Vendor	= PrmVendor)
				and    (PrmVendorGroup					not entered		
				or      Company.PayablesCompany.VendorGroup = PrmVendorGroup))

			Sort Order is ByRunGroupInvoiceType

			Action Rules

				Empty Set Rules
						

					invoke AddOnChargeLoad EDIInvoiceMatchInterfaceInput
						invoked.PrmRunGroup					= PrmRunGroup
						invoked.PrmCompany					= PrmCompany
						invoked.PrmVendor					= PrmVendor
				        invoked.InvoiceProcess				= InvoiceProcess
						invoked.MatchPoint					= MatchPoint
						invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
						invoked.EnableGLNProcessing			= EnableGLNProcessing
						invoked.EnableGTINProcessing		= EnableGTINProcessing
						invoked.PrmInterfaceRun				= PrmInterfaceRun
						invoked.PrmVendorGroup				= PrmVendorGroup	

				RunGroup Set Rules
						
					Entrance Rules

					Exit Rules
						invoke AddOnChargeLoad EDIInvoiceMatchInterfaceInput
							invoked.PrmRunGroup					= PrmRunGroup
							invoked.PrmCompany					= PrmCompany
							invoked.PrmVendor					= PrmVendor
					        invoked.InvoiceProcess				= InvoiceProcess
							invoked.MatchPoint					= MatchPoint
							invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
							invoked.EnableGLNProcessing			= EnableGLNProcessing
							invoked.EnableGTINProcessing		= EnableGTINProcessing
							invoked.PrmInterfaceRun				= PrmInterfaceRun
							invoked.PrmVendorGroup				= PrmVendorGroup	


				Instance Rules

	                if  (SkipThisRecord)
						NextSentence = true
					else
					if  (!InterfaceHeaderRel exists
					or    InterfaceHeaderRel.PayablesInvoice not entered)

						NextSentence = true
					else
	                if  (PayablesCompanyRel.Company.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup
					and  LineNumber entered)

						ErrorOccurred								= false
						LocalPurchaseOrder							= DerivedPurchaseOrder

						if  (InterfaceHeaderRel.ServiceContract entered
						and  !PayablesInvoiceDetailServiceContractRel.InvoiceDistributionsForContractLineRel exists)
							invoke CreateDistributionsFromInterface PayablesInvoiceDetailServiceContractRel
								resume on error
									ErrorOccurred		= true
									LocalErrorMessage	= error message
						else
						if (PurchaseOrderLineRel.Contract entered
						and  !PayablesInvoiceDetailWithContractRel.InvoiceDistributionsForPurchaseOrderLineRel exists)
							invoke CreateDistributionsFromInterface PayablesInvoiceDetailWithContractRel
								resume on error
									ErrorOccurred		= true
									LocalErrorMessage	= error message
						else
						if (!PayablesInvoiceDetailRel.InvoiceDistributionsForPurchaseOrderLineRel exists)
							invoke CreateDistributionsFromInterface PayablesInvoiceDetailRel
								resume on error
									ErrorOccurred		= true
									LocalErrorMessage	= error message
	
						if (ErrorOccurred)

							invoke CreateErrorRecord 
								invoked.PrmErrorMessage			= LocalErrorMessage
								invoked.PrmResult				= PrmInterfaceRun
								invoked.EnableGLNProcessing		= EnableGLNProcessing
								invoked.PrmErrorLine			= LineNumber
						else
						if  (!InterfaceAOCForThisLineRel exists)

							invoke FastDelete
						else

							Interfaced = true
	
		AddOnChargeLoad is a Set Action
			restricted
			Parameters
				PrmRunGroup					is a RunGroup
					default label is "RunGroup"
				PrmCompany					is a PayablesCompany
				PrmVendorGroup				is a VendorGroup		
				PrmVendor					is a Vendor
					context of PrmVendorGroup		
		        InvoiceProcess          	is AlphaUpper size 1
		            States
		                Add         value is "A"
		                AddAndMatch value is "M"
				MatchPoint					is Numeric 1
					States
						RuleGroupOne		value is 1
						RuleGroupTwo		value is 2
						RuleGroupThree		value is 3
				AllowMatchItemOrVendorItem			is Boolean
				EnableGLNProcessing			is Boolean
				EnableGTINProcessing		is Boolean
				PrmInterfaceRun				is like PayablesInvoiceInterfaceResult
				
			Parameter Rules
				PrmRunGroup
					required
						"RunGroupIsRequired"
			Local Fields
				LocalInterfacedAddOnCostsCount			is Numeric 10

			Instance Selection
				where  (RunGroup	= PrmRunGroup
				and    (RecordType.LineAddOnCharge
				or      RecordType.MiscAddOnCharge)
				and    (PrmCompany            			  not entered
				or      Company	= PrmCompany)
				and    (PrmVendor            			  not entered
				or      Vendor	= PrmVendor)
				and    (PrmVendorGroup					not entered		
				or      Company.PayablesCompany.VendorGroup = PrmVendorGroup))

			Sort Order is ByRunGroupInvoiceType

			Action Rules

				Empty Set Rules
					invoke MatchDistributionLoad EDIInvoiceMatchInterfaceInput
						invoked.PrmRunGroup					= PrmRunGroup
						invoked.PrmCompany					= PrmCompany
						invoked.PrmVendor					= PrmVendor
				        invoked.InvoiceProcess				= InvoiceProcess
						invoked.MatchPoint					= MatchPoint
						invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
						invoked.EnableGLNProcessing			= EnableGLNProcessing
						invoked.EnableGTINProcessing		= EnableGTINProcessing
						invoked.PrmInterfaceRun				= PrmInterfaceRun
						invoked.PrmVendorGroup				= PrmVendorGroup	

				RunGroup Set Rules
					Entrance Rules

					Exit Rules
						LocalFinanceEnterpriseGroup			= PrmCompany.FinanceEnterpriseGroup
						if (LocalFinanceEnterpriseGroup not entered)	
							LocalFinanceEnterpriseGroup		= actor.context.FinanceEnterpriseGroup
	
						LocalInterfaceResult				= PrmInterfaceRun
						invoke Update SetInterfaceResultsRel
							invoked.InterfacedAddOnCostsCount		= LocalInterfacedAddOnCostsCount

						invoke MatchDistributionLoad EDIInvoiceMatchInterfaceInput
							invoked.PrmRunGroup					= PrmRunGroup
							invoked.PrmCompany					= PrmCompany
							invoked.PrmVendor					= PrmVendor
					        invoked.InvoiceProcess				= InvoiceProcess
							invoked.MatchPoint					= MatchPoint
							invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
							invoked.EnableGLNProcessing			= EnableGLNProcessing
							invoked.EnableGTINProcessing		= EnableGTINProcessing
							invoked.PrmInterfaceRun				= PrmInterfaceRun
							invoked.PrmVendorGroup				= PrmVendorGroup	


				Instance Rules

					
	                if  (SkipThisRecord)
						NextSentence = true
					else
					if  (!InterfaceHeaderRel exists
					or    InterfaceHeaderRel.PayablesInvoice not entered)

						NextSentence = true
					else
	                if  (PayablesCompanyRel.Company.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
						LocalInterfacedAddOnCostsCount		+= 1
						ErrorOccurred						= false

						LocalCompany						= Company
						if  (EnableGLNProcessing)
							LocalCompany					= InterfaceHeaderRel.UseCompany
	


						if  (LineNumber entered
						and  AddOnCharge not entered)
							ErrorOccurred			= true
							LocalErrorMessage		= AddOnChargeRequiredMsg
						else
						if  (LineNumber entered
						and  !AddOnChargeRel exists)
							ErrorOccurred			= true
							LocalErrorMessage		= AddOnChargeDoesNotExistMsg
						else
						if  (LineNumber not entered
						and  MiscAddOnCharge not entered)
							ErrorOccurred			= true
							LocalErrorMessage		= MiscAddOnChargeRequiredMsg
						else
						if  (LineNumber not entered
						and  !MiscAddOnChargeRel exists)
							ErrorOccurred			= true
							LocalErrorMessage		= AddOnChargeDoesNotExistMsg
						else
						if  (InterfaceHeaderRel.ServiceContract entered
						and  LineNumber entered)
							ErrorOccurred			= true
							LocalErrorMessage		= LineAOCNotAllowedOnServiceContractMsg
						else
						if  (InterfaceHeaderRel.ProcessType.Basic
						or   InterfaceHeaderRel.ProcessType.Freight)
							ErrorOccurred			= true
							LocalErrorMessage		= AOCNotAllowedForExpenseInvoiceMsg
						else





						if  (LineNumber entered)
							invoke Create PayablesInvoiceAddOnCharge
								resume on error
									ErrorOccurred		= true
									LocalErrorMessage	= error message
								invoked.Company							= Company
								invoked.PayablesInvoice					= InterfaceHeaderRel.PayablesInvoice
								invoked.PurchaseOrder					= DerivedPurchaseOrder
								invoked.PurchaseOrderLine				= LineNumber
								invoked.AddOnCharge						= AddOnCharge
								invoked.AddOnChargePercent				= AddOnChargePercent
								invoked.EnteredUnitCost					= UnitCost
								invoked.EnteredQuantity					= EnteredQuantity
								invoked.TotalAddOnChargeAmount			= TotalAddOnChargeAmount
								invoked.BypassInvoiceErrorChecking		= true
								invoked.BypassAllowUpdate				= true
								invoked.CreateFromBatchSwitch			= true
								if  (EnableGLNProcessing)
									invoked.Company						= InterfaceHeaderRel.UseCompany
									invoked.Vendor						= InterfaceHeaderRel.UseVendor
						else
						if  (MiscAddOnChargeRel.SpreadMethod.NoSpread)

							invoke CreateMiscellaneousAddOnCosts PayablesInvoiceAddOnCharge
								resume on error
									ErrorOccurred		= true
									LocalErrorMessage	= error message
								invoked.Company							= Company
								invoked.PurchaseOrder					= DerivedPurchaseOrder
								invoked.PayablesInvoice					= InterfaceHeaderRel.PayablesInvoice
								invoked.AddOnCharge						= MiscAddOnCharge
								invoked.EnteredUnitCost					= MiscAddOnChargeAmount
								invoked.EnteredQuantity					= 1
								invoked.MiscellaneousAccount			= MiscellaneousAccount
								invoked.AddOnChargeAmount				= MiscAddOnChargeAmount
								invoked.TotalDistributionAmount			= MiscAddOnChargeAmount
								invoked.BypassInvoiceErrorChecking		= true
								invoked.BypassAllowUpdate				= true
								if  (EnableGLNProcessing)
									invoked.Company						= InterfaceHeaderRel.UseCompany
									invoked.Vendor						= InterfaceHeaderRel.UseVendor
						else

							invoke Create PayablesInvoiceSpreadAddOnCharge
								resume on error
									ErrorOccurred		= true
									LocalErrorMessage	= error message
								invoked.Company							= Company 
								invoked.Vendor							= Vendor
								invoked.PayablesInvoice					= InterfaceHeaderRel.PayablesInvoice
								invoked.PurchaseOrder					= DerivedPurchaseOrder
								invoked.AddOnCharge						= MiscAddOnCharge
								invoked.SpreadAmount					= MiscAddOnChargeAmount
								invoked.BypassAllowUpdate				= true
								invoked.AddOnChargePercent				= AddOnChargePercent
								if  (EnableGLNProcessing)
									invoked.Company						= InterfaceHeaderRel.UseCompany
									invoked.Vendor						= InterfaceHeaderRel.UseVendor
	
						if (ErrorOccurred)

							invoke CreateErrorRecord 
								invoked.PrmErrorMessage			= LocalErrorMessage
								invoked.PrmResult				= PrmInterfaceRun
								invoked.EnableGLNProcessing		= EnableGLNProcessing
						else
							if  (LineNumber entered
							and  !OtherAddOnChargesForSameLineRel exists)

								invoke FastDelete InterfaceDetailForAOCRel
							

							invoke FastDelete
	

		MatchDistributionLoad is a Set Action
			restricted
			Parameters
				PrmRunGroup					is a RunGroup
					default label is "RunGroup"
				PrmCompany					is a PayablesCompany
				PrmVendorGroup				is a VendorGroup		
				PrmVendor					is a Vendor
					context of PrmVendorGroup		
		        InvoiceProcess          	is AlphaUpper size 1
		            States
		                Add         value is "A"
		                AddAndMatch value is "M"
				MatchPoint					is Numeric 1
					States
						RuleGroupOne		value is 1
						RuleGroupTwo		value is 2
						RuleGroupThree		value is 3
				AllowMatchItemOrVendorItem			is Boolean
				EnableGLNProcessing			is Boolean
				EnableGTINProcessing		is Boolean
				PrmInterfaceRun				is like PayablesInvoiceInterfaceResult
				
			Parameter Rules
				PrmRunGroup
					required
						"RunGroupIsRequired"
			Local Fields
				ThisEDIInvoiceMatchInterfaceInput is an EDIInvoiceMatchInterfaceInput
				LocalInterfacedDistributionsCount		is Numeric 10

		        LocalTransactionTotal 			is an InternationalAmount	
		        LocalFunctionalTotal 			is an InternationalAmount
				LocalAlternateTotal  			is an InternationalAmount
				LocalAlternateTotal2 			is an InternationalAmount
				LocalAlternateTotal3			is an InternationalAmount
				LocalToFunctionalTotal			is an InternationalAmount
				LocalToAlternateTotal			is an InternationalAmount
				LocalToAlternateTotal2			is an InternationalAmount
				LocalToAlternateTotal3			is an InternationalAmount
				LocalProjectTotal				is an InternationalAmount
				LocalReportTotal1    			is an InternationalAmount
				LocalReportTotal2    			is an InternationalAmount
				LocalReportTotal3				is an InternationalAmount
				LocalReportTotal4				is an InternationalAmount
				LocalReportTotal5				is an InternationalAmount

			Instance Selection
				where (RunGroup	= PrmRunGroup
				and    RecordType.InvoiceDistribution
				and    (PrmCompany            			  not entered
				or      Company	= PrmCompany)
				and    (PrmVendor            			  not entered
				or      Vendor	= PrmVendor)
				and    (PrmVendorGroup					not entered		
				or      Company.PayablesCompany.VendorGroup = PrmVendorGroup))

			Sort Order is ByRunGroupInvoiceType

			Action Rules

				Empty Set Rules
						
					invoke PostLoadInterface EDIInvoiceMatchInterfaceInput
						invoked.PrmRunGroup					= PrmRunGroup
						invoked.PrmCompany					= PrmCompany
						invoked.PrmVendor					= PrmVendor
				        invoked.InvoiceProcess				= InvoiceProcess
						invoked.MatchPoint					= MatchPoint
						invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
						invoked.EnableGLNProcessing			= EnableGLNProcessing
						invoked.EnableGTINProcessing		= EnableGTINProcessing
						invoked.PrmInterfaceRun				= PrmInterfaceRun
						invoked.PrmVendorGroup				= PrmVendorGroup	

				RunGroup Set Rules
						
					Exit Rules

						LocalFinanceEnterpriseGroup			= PrmCompany.FinanceEnterpriseGroup
						if (LocalFinanceEnterpriseGroup not entered)	
							LocalFinanceEnterpriseGroup		= actor.context.FinanceEnterpriseGroup
	
						LocalInterfaceResult				= PrmInterfaceRun
						invoke Update SetInterfaceResultsRel
							invoked.InterfacedDistributionsCount	= LocalInterfacedDistributionsCount

						invoke PostLoadInterface EDIInvoiceMatchInterfaceInput
							invoked.PrmRunGroup					= PrmRunGroup
							invoked.PrmCompany					= PrmCompany
							invoked.PrmVendor					= PrmVendor
					        invoked.InvoiceProcess				= InvoiceProcess
							invoked.MatchPoint					= MatchPoint
							invoked.AllowMatchItemOrVendorItem			= AllowMatchItemOrVendorItem
							invoked.EnableGLNProcessing			= EnableGLNProcessing
							invoked.EnableGTINProcessing		= EnableGTINProcessing
							invoked.PrmInterfaceRun				= PrmInterfaceRun
							invoked.PrmVendorGroup				= PrmVendorGroup	

				Suffix Set Rules
				
					Entrance Rules
			            initialize LocalTransactionTotal
			            initialize LocalFunctionalTotal
						initialize LocalAlternateTotal
						initialize LocalAlternateTotal2
						initialize LocalAlternateTotal3
						initialize LocalToFunctionalTotal
						initialize LocalToAlternateTotal
						initialize LocalToAlternateTotal2
						initialize LocalToAlternateTotal3
						initialize LocalProjectTotal
						initialize LocalReportTotal1
						initialize LocalReportTotal2
						initialize LocalReportTotal3
						initialize LocalReportTotal4
						initialize LocalReportTotal5

						ThisRunGroup				= RunGroup		 					
		                ThisCompany					= Company
						ThisVendor					= Vendor
						ThisOldVendor				= OldVendor
						ThisEDINumber				= EDINumber
						ThisInvoice					= Invoice
						ThisSuffix					= Suffix
						ThisPurchaseOrder 			= PurchaseOrder
						ThisInterfacedPurchaseOrder = InterfacedPurchaseOrder
						ThisInterfacedPOCode		= InterfacedPOCode


						ThisEDIInvoiceMatchInterfaceInput = ThisInterfaceHeaderRel.EDIInvoiceMatchInterfaceInput
											
					Exit Rules


						if (LocalTransactionTotal entered)
							invoke FastUpdate ThisEDIInvoiceMatchInterfaceInput.PayablesInvoice
								invoked.TotalDistributionAmount.TransactionTotal		+= LocalTransactionTotal
								invoked.TotalDistributionAmount.FunctionalTotal			+= LocalFunctionalTotal
								invoked.TotalDistributionAmount.AlternateTotal			+= LocalAlternateTotal
								invoked.TotalDistributionAmount.AlternateTotal2			+= LocalAlternateTotal2
								invoked.TotalDistributionAmount.AlternateTotal3			+= LocalAlternateTotal3
								invoked.TotalDistributionAmount.ToFunctionalTotal		+= LocalToFunctionalTotal
								invoked.TotalDistributionAmount.ToAlternateTotal		+= LocalToAlternateTotal
								invoked.TotalDistributionAmount.ToAlternateTotal2		+= LocalToAlternateTotal2
								invoked.TotalDistributionAmount.ToAlternateTotal3		+= LocalToAlternateTotal3
								invoked.TotalDistributionAmount.ProjectTotal			+= LocalProjectTotal
								invoked.TotalDistributionAmount.ReportTotal1			+= LocalReportTotal1
								invoked.TotalDistributionAmount.ReportTotal2			+= LocalReportTotal2
								invoked.TotalDistributionAmount.ReportTotal3			+= LocalReportTotal3
								invoked.TotalDistributionAmount.ReportTotal4			+= LocalReportTotal4
								invoked.TotalDistributionAmount.ReportTotal5			+= LocalReportTotal5

				Instance Rules
	                if  (SkipThisRecord)
						NextSentence = true
					else
					if  (!InterfaceHeaderRel exists
					or    InterfaceHeaderRel.PayablesInvoice not entered
					or    InterfaceDetailRel exists)

						NextSentence = true
					else
	                if  (PayablesCompanyRel.Company.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
						LocalInterfacedDistributionsCount	+= 1
						ErrorOccurred						= false
	
						invoke CreateImport PayablesInvoiceDistribution
							assign result to ImportedDistribution
							resume on error
								ErrorOccurred		= true
								LocalErrorMessage	= error message

							fill in fields from this instance
							invoked.Company								= Company
							invoked.PayablesInvoice						= InterfaceHeaderRel.PayablesInvoice
							if (OldVendor entered
							and Vendor not entered)
								invoked.Vendor							= first VendorForLegacyVendorRel.Vendor
							else
								invoked.Vendor							= Vendor
							invoked.GLFinanceCodeBlock					= DistributionAccount
							invoked.GLTransactionAmount					= OriginalTransactionAmount
							invoked.DistributionAmount.CurrencyAmount	= OriginalTransactionAmount
								invoked.TransientAsset		= Asset
								invoked.TransientAssetTemplate = AssetTemplate
								invoked.TransientAssetDescription = AssetDescription
								if (AssetTemplate entered)
									invoked.AssetFlag		= "A"
								else
								if (Asset entered)
									invoked.AssetFlag		= "R"
	
	
					        invoked.TaxableAmount						= DistributionTaxableAmount
					        invoked.Description							= DistributionDescription
	
							invoked.TransientItemQuantity				= ItemQuantity 
					        invoked.TransientTagNumber					= TagNumber
					        invoked.TransientInServiceDate				= InServiceDate
					        invoked.TransientPurchaseDate				= PurchaseDate
					        invoked.TransientModelNumber				= ModelNumber
					        invoked.TransientSerialNumber				= SerialNumber
					        invoked.TransientHoldAsset					= HoldAsset
					        invoked.TransientAssetGroup					= AssetGroup
					        invoked.TransientCombine					= Combine
					        invoked.TransientAccountingUnitGroup 		= AccountingUnitGroup
	
							invoked.TransientBypassErrorUpdate 			= true
	
							if  (EnableGLNProcessing)
								invoked.Company							= InterfaceHeaderRel.UseCompany
								invoked.Vendor							= InterfaceHeaderRel.UseVendor
	
						if (ErrorOccurred)
							invoke CreateErrorRecord 
								invoked.PrmErrorMessage					= LocalErrorMessage
								invoked.PrmResult						= PrmInterfaceRun
								invoked.EnableGLNProcessing				= EnableGLNProcessing
										
						else

							LocalDistribution							= ImportedDistribution.PayablesInvoiceDistribution
	
				            if   (TaxCode entered
				            and   !TaxIndicator.Taxable
							and  ((TaxEntityRel.UseTaxCodeAccounts
							and    EntityTaxCodeRel.AccruedOrInvoiced.Accrued)
							or     (!TaxEntityRel.UseTaxCodeAccounts
							and    TaxEntityRel.AccruedOrInvoiced.Accrued)))
								NextSentence = true
							else
								LocalTransactionTotal   += LocalDistributionRel.DistributionAmount.CurrencyAmount
								LocalFunctionalTotal 	+= LocalDistributionRel.DistributionAmount.FunctionalAmount.EnteredCurrencyAmount
								LocalAlternateTotal  	+= LocalDistributionRel.DistributionAmount.AlternateAmount.EnteredCurrencyAmount
								LocalAlternateTotal2 	+= LocalDistributionRel.DistributionAmount.AlternateAmount2.EnteredCurrencyAmount
								LocalAlternateTotal3 	+= LocalDistributionRel.DistributionAmount.AlternateAmount3.EnteredCurrencyAmount
								LocalToFunctionalTotal 	+= LocalDistributionRel.DistributionAmount.ToFunctionalAmount.EnteredCurrencyAmount
								LocalToAlternateTotal  	+= LocalDistributionRel.DistributionAmount.ToAlternateAmount.EnteredCurrencyAmount
								LocalToAlternateTotal2 	+= LocalDistributionRel.DistributionAmount.ToAlternateAmount2.EnteredCurrencyAmount
								LocalToAlternateTotal3 	+= LocalDistributionRel.DistributionAmount.ToAlternateAmount3.EnteredCurrencyAmount
								LocalProjectTotal 		+= LocalDistributionRel.DistributionAmount.ProjectAmount.EnteredCurrencyAmount
								LocalReportTotal1    	+= LocalDistributionRel.DistributionAmount.ReportAmount1.EnteredCurrencyAmount
								LocalReportTotal2    	+= LocalDistributionRel.DistributionAmount.ReportAmount2.EnteredCurrencyAmount
								LocalReportTotal3    	+= LocalDistributionRel.DistributionAmount.ReportAmount3.EnteredCurrencyAmount
								LocalReportTotal4    	+= LocalDistributionRel.DistributionAmount.ReportAmount4.EnteredCurrencyAmount
								LocalReportTotal5    	+= LocalDistributionRel.DistributionAmount.ReportAmount5.EnteredCurrencyAmount


							invoke FastDelete
							
		DeleteAllTransactionsForRunGroup is a Set Action
			confirmation required
			Parameters
				PrmRunGroup				  is AlphaUpper 30
					default label is "RunGroup"
				DeletePartiallyInterfacedRecords is Boolean
			Instance Selection
				where (RunGroup	= PrmRunGroup
				and   (DeletePartiallyInterfacedRecords
				or     PayablesInvoice not entered))

			Action Rules
				Instance Rules
					if  (PayablesInvoice entered)
						invoke Unreleased.Delete PayablesInvoice

	                if  (PayablesCompanyRel.Company.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
						invoke FastDelete
						
		CXMLInvoiceRejectStatus is an Instance Action
			restricted
			Action Rules
				if (PurchaseFromLocation entered)
					if (PurchaseFromLocationRel.AribaEnabled.Integrated
						or PurchaseFromLocationRel.AribaEnabled.Flipper
						or PurchaseFromLocationRel.AribaEnabled.Light)
						include CXMLInvoiceStatusCreate
				else
				if (PurchasingVendorRel.AribaEnabled.Integrated
					or PurchasingVendorRel.AribaEnabled.Flipper
					or PurchasingVendorRel.AribaEnabled.Light)
					include CXMLInvoiceStatusCreate 
					
		UpdateInterfaceAnalysisDetails is a Set Action
			restricted
			Parameters
				PrmInterfaceAnalysis is like InterfaceAnalysis
			Local Fields
				LocalDateRange			is a DateRange
			Instance Selection			
				where (InvoiceTransactionAmount entered)
			Action Rules
				Instance Rules
					LocalInterfaceAnalysis		= PrmInterfaceAnalysis
					if (InterfaceAnalysisDetailRel exists)
						invoke UpdateInterfaceAnalysisDetails InterfaceAnalysisDetailRel
							invoked.PrmEDIInterfaceTotal	= InvoiceTransactionAmount
					else
						LocalDateRange.Begin	= InvoiceDate - InvoiceDate day + 1
						LocalDateRange.End		= LocalDateRange.Begin + 1 month - 1 day
						
						invoke Create InterfaceAnalysisDetail
							resume on error
							invoked.InterfaceAnalysis	= LocalInterfaceAnalysis
							invoked.PayablesCompany		= Company
							invoked.Vendor				= DerivedVendor
							invoked.Currency			= InvoiceCurrency
							invoked.MonthYear			= LocalDateRange
							invoked.EDIInterfaceTotal	= InvoiceTransactionAmount
							invoked.InterfaceTotal		= InvoiceTransactionAmount
					
        PopulateMissingCompanyOrVendor is a Set Action
            Parameters
                PrmCompany is a Company
                    default label is "Company"
            Parameter Rules
                PrmCompany
                    required
                    
            Sort Order is primary
            
            Instance Selection
                where (Company not entered
                or Vendor not entered)
            
            Action Rules
                Instance Rules
                    if (Company not entered)
                        CheckCompany = PrmCompany
                        CheckPurchaseOrder = PurchaseOrder
                        if (CheckPurchaseOrderRel exists)
                            Company = PrmCompany
                    if (Vendor not entered)
                        CheckCompany = Company
                        CheckPurchaseOrder = PurchaseOrder
                        if (CheckPurchaseOrderRel exists)
                            Vendor = CheckPurchaseOrderRel.Vendor
                                
        					
