PayablesCreditMemo is a BusinessClass
    owned by ap
    prefix is CRM
    classic name is APCRMEMO

    Ontology
        symbolic key is PayablesCreditMemo
            classic set name is CRMSET1
            classic name for PayablesCreditMemo.CreditMemoNumber is CR-MEMO-NBR
            classic name for PayablesCreditMemo.CreditMemoSuffix is CR-MEMO-SUFFIX
            classic name for PayablesCreditMemo.CreditMemoSequence is CR-SEQ-NBR
            classic name for PayablesCreditMemo.PayablesSequence is SEQ-NBR

    Patterns
        implements StaticJava
        disable AuditIndex
        implements Archivable

    Persistent Fields
        AmountApplied is an InternationalAmount
            classic name is AMT-APPLIED

	Conditions
		CanUnapply		
			when (first PayablesInvoicePaymentInvoicePayablesCreditMemoRel.Status.Released)

    Relations
		PayablesInvoicePaymentInvoicePayablesCreditMemoRel
			one-to-many relation to PayablesInvoicePayment
			Field Mapping uses ByCompanyVendorInvoice
				related.Company									= Company
				related.Vendor									= Vendor
				related.Invoice									= PayablesCreditMemo.Invoice
				related.Suffix									= PayablesCreditMemo.Suffix
				related.CancelSequence							= 0
				related.PayablesInvoicePayment.PaymentSequence  = PayablesCreditMemo.PayablesSequence
				related.PayablesInvoicePayment.VoidSequence		= 0
			Instance Selection					

				where 	  (related.PayablesInvoice				= PayablesCreditMemo.PayablesInvoice
				or		  PayablesCreditMemo.PayablesInvoice	 !entered)
		
		PayablesInvoicePaymentSeq1InvoicePayablesCreditMemoRel
			one-to-many relation to PayablesInvoicePayment
			Field Mapping uses ByCompanyVendorInvoice
				related.Company									= Company
				related.Vendor									= Vendor
				related.Invoice									= PayablesCreditMemo.Invoice
				related.Suffix									= PayablesCreditMemo.Suffix
				related.CancelSequence							= 0
				related.PayablesInvoicePayment.PaymentSequence  = 1
				related.PayablesInvoicePayment.VoidSequence		= 0
			Instance Selection							

				where 	  (related.PayablesInvoice							= PayablesCreditMemo.PayablesInvoice
				or		  PayablesCreditMemo.PayablesInvoice				 !entered)
				
		PayablesInvoicePaymentCreditPayablesCreditMemoRel
			one-to-many relation to PayablesInvoicePayment
			Field Mapping uses ByCompanyVendorInvoice
				related.Company									= Company
				related.Vendor									= Vendor
				related.Invoice									= PayablesCreditMemo.CreditMemoNumber
				related.Suffix									= PayablesCreditMemo.CreditMemoSuffix
				related.CancelSequence							= 0
				related.PayablesInvoicePayment.PaymentSequence  = PayablesCreditMemo.CreditMemoSequence
				related.PayablesInvoicePayment.VoidSequence		= 0
			Instance Selection						

				where 	  (related.PayablesInvoice							= PayablesCreditMemo.CreditMemoPayablesInvoice
				or		  PayablesCreditMemo.CreditMemoPayablesInvoice				!entered)

		PayablesInvoicePaymentSeq1CreditPayablesCreditMemoRel
			one-to-many relation to PayablesInvoicePayment
			Field Mapping uses ByCompanyVendorInvoice
				related.Company									= Company
				related.Vendor									= Vendor
				related.Invoice									= PayablesCreditMemo.CreditMemoNumber
				related.Suffix									= PayablesCreditMemo.CreditMemoSuffix
				related.CancelSequence							= 0
				related.PayablesInvoicePayment.PaymentSequence  = 1
				related.PayablesInvoicePayment.VoidSequence		= 0
			Instance Selection					

				where 	  (related.PayablesInvoice							= PayablesCreditMemo.CreditMemoPayablesInvoice
				or		  PayablesCreditMemo.CreditMemoPayablesInvoice				 !entered)
					
	Actions
		Create is a Create Action
			restricted

		Update is an Update Action
			restricted

		UnapplyCredit is an Instance Action		
			valid when (CanUnapply)
			Action Rules
				invoke UnapplyPaymentsFromThisCredit PayablesInvoicePaymentCreditPayablesCreditMemoRel

		UnapplyPayment is an Instance Action		
			valid when (CanUnapply)
			Action Rules
				invoke UnapplyCreditsFromThisPayment PayablesInvoicePaymentInvoicePayablesCreditMemoRel

		Delete is a Delete Action
			restricted
			Entrance Rules
				if (initiating action = "Delete")
					constraint (AmountApplied not entered)
						"MustUnapplyTheInvoiceFromTheCreditBeforeDeleting"
    	
    	Purge is a Purge Action
    		restricted
    		bypass relational integrity rules
    	
    Sets
        Set2
            indexed
            Sort Order
                Company
                Vendor
                PayablesCreditMemo.Invoice
                PayablesCreditMemo.Suffix
                PayablesCreditMemo.PayablesSequence
				PayablesCreditMemo.PayablesInvoice
                PayablesCreditMemo.CreditMemoNumber
                PayablesCreditMemo.CreditMemoSuffix
                PayablesCreditMemo.CreditMemoSequence
				PayablesCreditMemo.CreditMemoPayablesInvoice

        Set3
            indexed
            Sort Order
                Company
                Vendor
                PayablesCreditMemo.CreditMemoNumber
                PayablesCreditMemo.CreditMemoSuffix
				PayablesCreditMemo.CreditMemoPayablesInvoice
                PayablesCreditMemo.Invoice
                PayablesCreditMemo.Suffix
				PayablesCreditMemo.PayablesInvoice
                PayablesCreditMemo.PayablesSequence
                PayablesCreditMemo.CreditMemoSequence
