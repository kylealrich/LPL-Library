OneSourceTaxAttribute is a BusinessClass	
    owned by tx
	prefix is OAtr1

	Ontology
		symbolic key is OneSourceTaxAttribute

    Patterns
        disable Auditing
      	disable AuditIndex
       	disable EffectiveDated
       	disable DataTranslations
       	
	Persistent Fields
		RelatedObjectReference	is BusinessObjectReference
		AttributeNumber			is Numeric 2
			restricted
		UserAttributeName						
		Value 					is a UserAttributeValue		 										 
		LoadDynamicField  		is a DynamicField
			default label is "DynamicValue"	
		Description 			is Alpha 30
		

 	Sets

		ByAttributeNumber
			Sort Order
				FinanceEnterpriseGroup
				OneSourceTaxAttribute.UniqueIdOfRelatedObject				
				AttributeNumber 
				
		ByAttribute				 
			Sort Order
				FinanceEnterpriseGroup
				OneSourceTaxAttribute.UniqueIdOfRelatedObject				
				UserAttributeName 

	Local Fields
		Idx 						is Numeric 2
		LocalFinanceEnterpriseGroup is like FinanceEnterpriseGroup
		LocalUniqueID				is UniqueID
		LocalUserAttributeName 		is a UserAttributeName	 
		LocalUserAttributeNumber 	is Numeric 2
		LocalTransformValue         is Alpha 40
		RecordCount					is Numeric 2
		CharPos3                    is Alpha 2
		LocalAttributeValue		 	is a UserAttributeValue
		AttributeCharacter       	is Alpha 1
				
	Field Rules	 
		AttributeNumber
			if (AttributeNumber not entered)
				AttributeNumber = UserAttributeName[10:11]
			initial value is UserAttributeName[10:11]		
			default to UserAttributeName[10:11]	
			
		Value


								
		Description
			default to LoadDynamicField.Description
		LoadDynamicField
			if (LoadDynamicField changed)
				Description = LoadDynamicField.Description
			if (LoadDynamicField.DynamicType.Reserved)
				constraint (Value not entered)
					"ReservedFieldsCannotContainValues"			     				 
		
	Conditions
		DatesOnly 
			when (LoadDynamicField.DynamicType.Date)	
		GetOneSourceAttributes
			restricted
			when (ShowAttributesThat not entered
			or   (ShowAttributesThat.Available
			and   Value not entered
			and   LoadDynamicField not entered)
			or   (ShowAttributesThat.Used
			and   Value not entered
			and   LoadDynamicField entered))

		AvailableOneSourceAttributes
			restricted	
			when (Value not entered)

		ValueHasDynamicInd
			restricted
			when (Value[1:1] = "<")
			
		DescriptionHasDynamicInd
			restricted
			when (Description[1:1] = "<")
			
	Relations		
 		ThisOneSourceTaxAttributeRecordRel
			one-to-one relation to OneSourceTaxAttribute
			Field Mapping uses ByAttribute	 
				related.FinanceEnterpriseGroup 							= LocalFinanceEnterpriseGroup	
				related.OneSourceTaxAttribute.UniqueIdOfRelatedObject = LocalUniqueID
				related.UserAttributeName 								= LocalUserAttributeName 
				
	Transient Fields
		ShowAttributesThat is Alpha 1
			States
				All			value is blank
				Available   value is "A"
				Used        value is "U"
								
	Context Fields	 
		TaxEntity
		
	Derived Fields	
		DerivedLineNumber is a DerivedField 
			type is Numeric 2
			default label is "Number"
			return AttributeNumber
			
		DerivedAttributeValue is a DerivedField
			type is Alpha 50
			restricted
			if (ValueHasDynamicInd)
				LocalTransformValue = Value
				initialize Value
				return DerivedDynamicValue
				
		DerivedDynamicValue is a MessageField	
			"TestDynamicField"

		TestDynamicField is a StringField
			type is Alpha 40
			restricted
			"<"
			Description2
			">"

		Description2 is a DerivedField
			type is Alpha 40
			restricted
			return (LocalTransformValue - "<")		
			
		DerivedUserAttributeName is a DerivedField
			type is AlphaUpper 50
			restricted
			if (Idx = 1)
				return "ATTRIBUTE1"
			else
			if (Idx = 2)
				return "ATTRIBUTE2"
			else
			if (Idx = 3)
				return "ATTRIBUTE3"
			else
			if (Idx = 4)
				return "ATTRIBUTE4"
			else
			if (Idx = 5)
				return "ATTRIBUTE5"
			else
			if (Idx = 6)
				return "ATTRIBUTE6"
			else
			if (Idx = 7)
				return "ATTRIBUTE7"
			else
			if (Idx = 8)
				return "ATTRIBUTE8" 
			else
			if (Idx = 9)
				return "ATTRIBUTE9"
			else
			if (Idx = 10)
				return "ATTRIBUTE10"
			else
			if (Idx = 11)
				return "ATTRIBUTE11"
			else
			if (Idx = 12)
				return "ATTRIBUTE12" 
			else
			if (Idx = 13)
				return "ATTRIBUTE13"
			else
			if (Idx = 14)
				return "ATTRIBUTE14" 
			else
			if (Idx = 15)
				return "ATTRIBUTE15"
			else
			if (Idx = 16)
				return "ATTRIBUTE16" 
			else
			if (Idx = 17)
				return "ATTRIBUTE17"
			else
			if (Idx = 18)
				return "ATTRIBUTE18"			
			else
			if (Idx = 19)
				return "ATTRIBUTE19"
			else
			if (Idx = 20)
				return "ATTRIBUTE20"
			else
			if (Idx = 21)
				return "ATTRIBUTE21"
			else
			if (Idx = 22)
				return "ATTRIBUTE22"
			else
			if (Idx = 23)
				return "ATTRIBUTE23"
			else
			if (Idx = 24)
				return "ATTRIBUTE24"
			else
			if (Idx = 25)
				return "ATTRIBUTE25"
			else
			if (Idx = 26)
				return "ATTRIBUTE26" 
			else
			if (Idx = 27)
				return "ATTRIBUTE27"
			else
			if (Idx = 28)
				return "ATTRIBUTE28"
			else
			if (Idx = 29)
				return "ATTRIBUTE29"
			else
			if (Idx = 30)
				return "ATTRIBUTE30" 
			else
			if (Idx = 31)
				return "ATTRIBUTE31"
			else
			if (Idx = 32)
				return "ATTRIBUTE32" 
			else
			if (Idx = 33)
				return "ATTRIBUTE33"
			else
			if (Idx = 34)
				return "ATTRIBUTE34" 
			else
			if (Idx = 35)
				return "ATTRIBUTE35"
			else
			if (Idx = 36)
				return "ATTRIBUTE36"					
			else
			if (Idx = 37)
				return "ATTRIBUTE37"
			else
			if (Idx = 38)
				return "ATTRIBUTE38" 
			else
			if (Idx = 39)
				return "ATTRIBUTE39"
			else
			if (Idx = 40)
				return "ATTRIBUTE40"
			else
			if (Idx = 41)
				return "ATTRIBUTE41"
			else
			if (Idx = 42)
				return "ATTRIBUTE42"
			else
			if (Idx = 43)
				return "ATTRIBUTE43"
			else
			if (Idx = 44)
				return "ATTRIBUTE44"
			else
			if (Idx = 45)
				return "ATTRIBUTE45"
			else
			if (Idx = 46)
				return "ATTRIBUTE46"
			else
			if (Idx = 47)
				return "ATTRIBUTE47"
			else
			if (Idx = 48)
				return "ATTRIBUTE48" 
			else
			if (Idx = 49)
				return "ATTRIBUTE49"
			else
			if (Idx = 50)
				return "ATTRIBUTE50"

		TestDynamic is a DerivedField	  
			type is Alpha 40	 		 
			return "<Description>"		
			
		DerivedDynamicField is a DerivedField
			type is like UserAttributeValue	 
			Idx = 0
			if (LoadDynamicField.ValueIs.TaxEntity)
				return TaxEntity

	Rule Blocks
		LoadAttributes
			initialize Idx
			while (Idx < 50)
				Idx = Idx + 1
				LocalFinanceEnterpriseGroup	= ParmFinanceEnterpriseGroup
				LocalUniqueID				= ParmUniqueIdOfRelatedObject		
				LocalUserAttributeName 		= DerivedUserAttributeName  
				LocalUserAttributeNumber 	= LocalUserAttributeName[10:11] 	 
				if (ThisOneSourceTaxAttributeRecordRel not exist)
					invoke Create OneSourceTaxAttribute 
						invoked.FinanceEnterpriseGroup 							= LocalFinanceEnterpriseGroup	 
						invoked.OneSourceTaxAttribute.UniqueIdOfRelatedObject = LocalUniqueID					 
						invoked.UserAttributeName								= LocalUserAttributeName  
						invoked.AttributeNumber 								= LocalUserAttributeNumber
						invoked.Value											= blank	 
						invoked.Description										= blank  
					RecordCount +=1
	Actions
		Create is a Create Action
		Update is an Update Action
			Action Rules
				
		Delete is a Delete Action

		PreLoadAllAttributes is a Set Action
			restricted
			completion message is "OneSourceDefaultValuesSuccessfullyCreated"			
			run in foreground	 
			Parameters
				ParmFinanceEnterpriseGroup is a FinanceEnterpriseGroup
					default label is "FinanceEnterpriseGroup"
				ParmUniqueIdOfRelatedObject	is UniqueID		
			Parameter Rules
				ParmFinanceEnterpriseGroup
					initial value is actor.context.FinanceEnterpriseGroup  
					default to actor.context.FinanceEnterpriseGroup 
			Action Rules
				Empty Set Rules
					include LoadAttributes	 

				Set Rules
					Entrance Rules		
					Exit Rules
						include LoadAttributes		 

												
				Instance Rules	 
					include LoadAttributes		
			

			
 							
