StudentActivityVendorInvoice is a BusinessClass
    owned by studentactivities
    prefix is SAVI

    Ontology
    	symbolic key is StudentActivityVendorInvoice

    Persistent Fields
		InvoiceDate					is Date
		InvoiceAmount				is an InternationalAmount
		Description					is Alpha 60
		InvoiceImage				is an AlternateAttachment

	Transient Fields
		TransactionCurrencyCode			is a Currency
			derive value from StudentActivitySchool.DefaultAccountingEntity.FunctionalCurrency

	Derived Fields
		InvoiceCheckDate is a MessageField
			"<InvoiceDate month>/<InvoiceDate day>/<InvoiceDate year>"

	Local Fields
		LocalAttributeCtr   			is Numeric 2			

	Sets

	Relations


	Conditions
		HasAttachment
			restricted
			when (InvoiceImage entered)

	Create Rules  
		include IDM.CreateRules 
			replace AttachmentField with InvoiceImage
							
	Delete Rules
		include IDM.DeleteNoArchiveRules
			replace AttachmentField with InvoiceImage

	Commit Rules
		include IDM.CommitRules
			replace AttachmentField with InvoiceImage

	Field Rules
		InvoiceDate
			required
			
		InvoiceAmount
			required
	
	Actions
		Create is a Create Action
			Action Rules
				constraint (StudentActivityBankTransaction.VendorInvoiceCount < 12)
					"CannotAttachMoreThan12InvoicesToDisbursement"
			Exit Rules
				if (StudentActivityBankAccount.CheckDocumentTemplate entered
				and !StudentActivityBankTransaction.CheckPrinted)
					invoke CreateDetailLaserCheckDocument StudentActivityBankAccount
						invoked.PrmBankTransactionType				= BankTransactionType
						invoked.PrmStudentActivityBankTransaction	= StudentActivityBankTransaction
									
		Update is an Update Action
			Exit Rules
				if (StudentActivityBankAccount.CheckDocumentTemplate entered
				and !StudentActivityBankTransaction.CheckPrinted)
					invoke CreateDetailLaserCheckDocument StudentActivityBankAccount
						invoked.PrmBankTransactionType				= BankTransactionType
						invoked.PrmStudentActivityBankTransaction	= StudentActivityBankTransaction
		
		Delete is a Delete Action
			Exit Rules
				if (StudentActivityBankAccount.CheckDocumentTemplate entered
				and !StudentActivityBankTransaction.CheckPrinted)
					invoke CreateDetailLaserCheckDocument StudentActivityBankAccount
						invoked.PrmBankTransactionType				= BankTransactionType
						invoked.PrmStudentActivityBankTransaction	= StudentActivityBankTransaction

		UploadToIDM is an Instance Action  
			valid when (InvoiceImage.ValidForIDMUpload)
			Action Rules
				include IDM.MoveAttachmentsToIDM
					replace AttachmentField   with InvoiceImage	
						
									
		MoveAttachmentsToIDM is a Set Action
			restricted
			Instance Selection
				where (InvoiceImage.IsLocal)

			Accumulators
				InstanceCount

			Action Rules
				Instance Rules
					increment InstanceCount	

					include IDM.MoveAttachmentsToIDM
						replace AttachmentField   with InvoiceImage			

					commit transaction

					if (InstanceCount = config.IDM_MOVE_ATTACHMENTS_LIMIT)
						end set action instance loop
