CommodityCode is a BusinessClass
    owned by ic
    prefix is SCC


    Ontology
        symbolic key is CommodityCode


    Patterns
        implements StaticJava
        disable AuditIndex
        implements BODId

    Persistent Fields
		Description					is Alpha size 150
			translatable
		DepthLevel					is Numeric size 2
		NumberAssociatedOpenEvents	is Numeric size 8 
   		NumberRegisteredSuppliers	is Numeric size 8
   		Active						is Boolean
   		CommCodes
 		CommoditySearch				is a Description4
 			sql name is COMMSEARCH
 			text searchable
 		InternalReference			is Alpha size 150

	Local Fields
		LocalContractTierGroup
		LocalContractImportTierGroup
		LocalContractRebate
		LocalSubcontractor					is Numeric size 9
		ActionCode
		LocalBODCurrentTimeStamp			is a BODCurrentTimeStamp
		LocalNativeLPLBODTrigger			is Boolean			
		LocalBodAccountingEntity			is AlphaUpper size 12
		LocalCrossAccountingEntity 			is Alpha 40
		LocalCleanDocIDAccountingentity 	is Alpha 40
		LocalBODFormattedID					is Alpha 150
		CommodityCodeCleanDocXMLBOD			is XMLDocument
		NewBODTracker  				        is a FSMInboundBODTracker view
		LocalFSMInboundBODTracker	is Numeric 15
		Error            			is Boolean
	    ErrorMessage     			is Alpha 300
		LocalBODTrigger				is Boolean
		LocalConfigurationParameter	is Alpha size up to 200
		LocalSourceValue			is Alpha 30
		
	Context Fields
		SupplierGroup
		Supplier
		SupplierSourceId
		FSMInboundBODTracker

	Derived Fields
		RepresentativeText is a StringField
			type is Text
			default label is "CommodityCode"
			CommodityCode " - " Description 
		AttachedToSupplierDummyColumn is a StringField
			type is Alpha size 1
			""
		DepthLevelSegment is a DerivedField
			type is AlphaUpper size 10
			restricted
			return CommodityCode.Segment[DerivedDepthLevel]
		DepthLevelSegmentSize is a DerivedField
			type is Numeric size 2
			restricted
			return ItemGroup.CommodityCodeStructure.Segments.Segment[DerivedDepthLevel].Size
		ValidDepthLevelSegmentSize is a ConditionalField
			type is Boolean
			restricted
			if (DepthLevelSegment[DepthLevelSegmentSize + 1] entered)
				false
			else
				true
		InvalidSegmentSizeMessage is a MessageField
			restricted
			"Level<DerivedDepthLevel>ExceedsMaximumLengthOf<DepthLevelSegmentSize>"
		DerivedDepthLevel is a DerivedField
			type is Numeric size 1
			restricted
			return (CommodityCode levels)
		HasChild is a DerivedField
			type is Boolean
			restricted
			if (DepthLevel = 1
			and Level1CommodityCodeChildRel exists)
				return true
			else
			if (DepthLevel = 2
			and Level2CommodityCodeChildRel exists)
				return true
			else
			if (DepthLevel = 3
			and Level3CommodityCodeChildRel exists)
				return true
			else
			if (DepthLevel = 4
			and Level4CommodityCodeChildRel exists)
				return true
			else
			if (DepthLevel = 5
			and Level5CommodityCodeChildRel exists)
				return true
			else
				return false
		HasChildForInactivation is a DerivedField
			type is Boolean
			restricted
			if (DepthLevel = 1
			and Level1CommodityCodeChildInactivateRel exists)
				return true
			else
			if (DepthLevel = 2
			and Level2CommodityCodeChildInactivateRel exists)
				return true
			else
			if (DepthLevel = 3
			and Level3CommodityCodeChildInactivateRel exists)
				return true
			else
			if (DepthLevel = 4
			and Level4CommodityCodeChildInactivateRel exists)
				return true
			else
			if (DepthLevel = 5
			and Level5CommodityCodeChildInactivateRel exists)
				return true
			else
				return false
		CommodityCodeSegment1 is a DerivedField
			type is AlphaUpper 10
			restricted
			return CommodityCode.Segment[1]
		CommodityCodeSegment2 is a DerivedField
			type is AlphaUpper 10
			restricted
			return CommodityCode.Segment[2]
		CommodityCodeSegment3 is a DerivedField
			type is AlphaUpper 10
			restricted
			return CommodityCode.Segment[3]
		CommodityCodeSegment4 is a DerivedField
			type is AlphaUpper 10
			restricted
			return CommodityCode.Segment[4]
		CommodityCodeSegment5 is a DerivedField
			type is AlphaUpper 10
			restricted
			return CommodityCode.Segment[5]
		CommodityCodeSegment6 is a DerivedField
			type is AlphaUpper 10
			restricted
			return CommodityCode.Segment[6]

		DerivedDelimiter is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "Generic_Delimiter"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "tenantID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "releaseID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "logicalID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "VersionID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedappProdline is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "appProdline"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedCleanDocumentID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "RequiredCleanDocumentID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedMultipleFEG is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IsMultipleFEG"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedTriggerBODBasedOnCrossReference is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "TriggerBODBasedOnCrossReference"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		BODVariationID is a DerivedField
			type is Alpha 25
			restricted
			return bod id.VariationID
			
		DerivedBODCurrentTimeStamp is a DerivedField
			type is Alpha size 20
			restricted
			DerivedBODCurrentTimeStamp = system current timestamp
			return DerivedBODCurrentTimeStamp
			
		DerivedBODFormattedCurrentTimeStamp is a DerivedField
			type is Alpha size 30
			restricted
			return DerivedBODCurrentTimeStamp[1:4] + "-" + DerivedBODCurrentTimeStamp[5:6] + "-" + DerivedBODCurrentTimeStamp[7:8] + "T" + DerivedBODCurrentTimeStamp[9:10] + ":" + DerivedBODCurrentTimeStamp[11:12] + ":" + DerivedBODCurrentTimeStamp[13:14] + "Z"
		
		DerivedBODActionCode is a DerivedField
			type is Alpha 10
			restricted
			if (action type.Create or ActionCode.Create)
				return "Add"
			else
			if(action type.Update or action type.Delete)
				return "Replace"
			else
				return ""	
				
		DerivedBODStatusCode is a DerivedField
			type is Alpha 10
			restricted
			if (action type.Create or action type.Update)
				return "Open"
			else
			if(action type.Delete or ActionCode.Delete)
				return "Deleted"
			else
				return ""	
				
		DerivedFinanceEnterpriseGroup is a DerivedField
			type is Alpha 4
			restricted
			return ItemGroup.BusinessGroup.FinanceEnterpriseGroup
		
		DerivedCommodityCode is a DerivedField
			type is like CommCodes
			restricted
			if(CommodityCodeSegment2 = "")
				return CommodityCodeSegment1	
			else
			if(CommodityCodeSegment3 = "")
				return CommodityCodeSegment1 + CommodityCodeSegment2
			else
			if(CommodityCodeSegment4 = "")
				return CommodityCodeSegment1 + CommodityCodeSegment2 + CommodityCodeSegment3
			else
			if(CommodityCodeSegment5 = "")
				return CommodityCodeSegment1 + CommodityCodeSegment2 + CommodityCodeSegment3 + CommodityCodeSegment4
			else
			if(CommodityCodeSegment6 = "")
				return CommodityCodeSegment1 + CommodityCodeSegment2 + CommodityCodeSegment3 + CommodityCodeSegment4 + CommodityCodeSegment5
			else
				return CommodityCodeSegment1 + CommodityCodeSegment2 + CommodityCodeSegment3 + CommodityCodeSegment4 + CommodityCodeSegment5 + CommodityCodeSegment6

		DerivedBODDocumentID is a DerivedField
			type is Alpha 100
			restricted
			if(DerivedCleanDocumentID = "Y")
				return DerivedCommodityCode
			else
				return DerivedFinanceEnterpriseGroup + DerivedDelimiter + ItemGroup + DerivedDelimiter + DerivedCommodityCode
		
		DerivedBODRevision is a DerivedField
			type is Alpha 25
			restricted
			return ""
					
		DerivedBODFormattedId is a DerivedField
			type is Alpha 100
			restricted
			return 	"infor-nid:" + DerivedTenantID + ":" + ":"  + ":" + DerivedBODDocumentID+ ":" + DerivedBODRevision +"?CodeDefinition&verb=Sync&TrackerID="+LocalFSMInboundBODTracker
		
		DerivedCommodityCodeStructureMaxLevels is a DerivedField
			type is Numeric 2
			restricted
			return ItemGroup.CommodityCodeStructure.MaxLevels
				
		DerivedCommodityCodeStructureSegment1size is a DerivedField
			type is Alpha 10
			restricted
			if(ItemGroup.CommodityCodeStructure.Segments.Segment[1].Size = "0")
				return ""
			else 
				return ItemGroup.CommodityCodeStructure.Segments.Segment[1].Size
				
		DerivedCommodityCodeStructureSegment2size is a DerivedField
			type is Alpha 10
			restricted
			if(ItemGroup.CommodityCodeStructure.Segments.Segment[2].Size = "0")
				return ""
			else 
				return ItemGroup.CommodityCodeStructure.Segments.Segment[2].Size 
				
		DerivedCommodityCodeStructureSegment3size is a DerivedField
			type is Alpha 10
			restricted
			if(ItemGroup.CommodityCodeStructure.Segments.Segment[3].Size = "0")
				return ""
			else 
				return ItemGroup.CommodityCodeStructure.Segments.Segment[3].Size
				
		DerivedCommodityCodeStructureSegment4size is a DerivedField
			type is Alpha 10
			restricted
			if(ItemGroup.CommodityCodeStructure.Segments.Segment[4].Size = "0")
				return ""
			else 
				return ItemGroup.CommodityCodeStructure.Segments.Segment[4].Size
				
		DerivedCommodityCodeStructureSegment5size is a DerivedField
			type is Alpha 10
			restricted
			if(ItemGroup.CommodityCodeStructure.Segments.Segment[5].Size = "0")
				return ""
			else 
				return ItemGroup.CommodityCodeStructure.Segments.Segment[5].Size
	
		DerivedCommodityCodeStructureSegment6size is a DerivedField
			type is Alpha 10
			restricted
			if(ItemGroup.CommodityCodeStructure.Segments.Segment[6].Size = "0")
				return ""
			else
				return ItemGroup.CommodityCodeStructure.Segments.Segment[6].Size

				
		DerivedLastupdateBy is a DerivedField
			type is Alpha size 60
			restricted
			return update stamp.actor
		
		DerivedBODUpdateTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			DerivedBODUpdateTimeStamp = update stamp.timestamp
			return DerivedBODUpdateTimeStamp
			
		DerivedBODFormattedUpdateTimeStamp is a DerivedField
			type is Alpha size 30
			restricted
			return DerivedBODUpdateTimeStamp[1:4] + "-" + DerivedBODUpdateTimeStamp[5:6] + "-" + DerivedBODUpdateTimeStamp[7:8] + "T" + DerivedBODUpdateTimeStamp[9:10] + ":" + DerivedBODUpdateTimeStamp[11:12] + ":" + DerivedBODUpdateTimeStamp[13:14] + "Z"
		
		CommodityCodeXMLBOD is a DerivedField
			type is XMLDocument
	        restricted
	        CommodityCodeXMLBOD = template.IONSyncCodeDefination_CommodityCode_ST document for this instance					

	Conditions
		AllActive
			restricted
        	when ((Active)
            and  ((Level1)
            or    (Level2
            and    Level2CommodityCodeActiveParentRel exists)
            or    (Level3
            and    Level2CommodityCodeActiveParentRel exists
            and    Level3CommodityCodeActiveParentRel exists)
            or    (Level4
            and    Level2CommodityCodeActiveParentRel exists
            and    Level3CommodityCodeActiveParentRel exists
            and    Level4CommodityCodeActiveParentRel exists)
            or    (Level5
            and    Level2CommodityCodeActiveParentRel exists
            and    Level3CommodityCodeActiveParentRel exists
            and    Level4CommodityCodeActiveParentRel exists
            and    Level5CommodityCodeActiveParentRel exists)
            or    (Level6
            and    Level2CommodityCodeActiveParentRel exists
            and    Level3CommodityCodeActiveParentRel exists
            and    Level4CommodityCodeActiveParentRel exists
            and    Level5CommodityCodeActiveParentRel exists
            and    Level6CommodityCodeActiveParentRel exists)))
		
		RegistrationEligible
			restricted
			when (DepthLevel <= SupplierGroupRel.CommodityRegistrationLevel)
		Level1
			restricted
			when (CommodityCode.Segment[1] != blank
           	and   CommodityCode.Segment[2] = blank
           	and   CommodityCode.Segment[3] = blank
           	and   CommodityCode.Segment[4] = blank
           	and   CommodityCode.Segment[5] = blank
           	and   CommodityCode.Segment[6] = blank)
		Level2
			restricted
			when (CommodityCode.Segment[1] != blank
           	and   CommodityCode.Segment[2] != blank
           	and   CommodityCode.Segment[3] = blank
           	and   CommodityCode.Segment[4] = blank
           	and   CommodityCode.Segment[5] = blank
           	and   CommodityCode.Segment[6] = blank)
		Level3
			restricted
			when (CommodityCode.Segment[1] != blank
           	and   CommodityCode.Segment[2] != blank
           	and   CommodityCode.Segment[3] != blank
           	and   CommodityCode.Segment[4] = blank
           	and   CommodityCode.Segment[5] = blank
           	and   CommodityCode.Segment[6] = blank)
		Level4
			restricted
			when (CommodityCode.Segment[1] != blank
           	and   CommodityCode.Segment[2] != blank
           	and   CommodityCode.Segment[3] != blank
           	and   CommodityCode.Segment[4] != blank
           	and   CommodityCode.Segment[5] = blank
           	and   CommodityCode.Segment[6] = blank)
		Level5
			restricted
			when (CommodityCode.Segment[1] != blank
           	and   CommodityCode.Segment[2] != blank
           	and   CommodityCode.Segment[3] != blank
           	and   CommodityCode.Segment[4] != blank
           	and   CommodityCode.Segment[5] != blank
           	and   CommodityCode.Segment[6] = blank)
		Level6
			restricted
			when (CommodityCode.Segment[1] != blank
           	and   CommodityCode.Segment[2] != blank
           	and   CommodityCode.Segment[3] != blank
           	and   CommodityCode.Segment[4] != blank
           	and   CommodityCode.Segment[5] != blank
           	and   CommodityCode.Segment[6] != blank)
        NoLevel6TierParents
        	restricted
         	when (!Level2TierParentRel exists
         	and   !Level3TierParentRel exists
         	and   !Level4TierParentRel exists
         	and   !Level5TierParentRel exists
         	and   !Level6TierParentRel exists)
        NoLevel5TierParents
        	restricted
         	when (!Level2TierParentRel exists
         	and   !Level3TierParentRel exists
         	and   !Level4TierParentRel exists
         	and   !Level5TierParentRel exists)
        NoLevel4TierParents
        	restricted
         	when (!Level2TierParentRel exists
         	and   !Level3TierParentRel exists
         	and   !Level4TierParentRel exists)
        NoLevel3TierParents
        	restricted
         	when (!Level2TierParentRel exists
         	and   !Level3TierParentRel exists)
        NoLevel6ImportTierParents
        	restricted
         	when (!Level2ImportTierParentRel exists
         	and   !Level3ImportTierParentRel exists
         	and   !Level4ImportTierParentRel exists
         	and   !Level5ImportTierParentRel exists
         	and   !Level6ImportTierParentRel exists)
        NoLevel5ImportTierParents
        	restricted
         	when (!Level2ImportTierParentRel exists
         	and   !Level3ImportTierParentRel exists
         	and   !Level4ImportTierParentRel exists
         	and   !Level5ImportTierParentRel exists)
        NoLevel4ImportTierParents
        	restricted
         	when (!Level2ImportTierParentRel exists
         	and   !Level3ImportTierParentRel exists
         	and   !Level4ImportTierParentRel exists)
        NoLevel3ImportTierParents
        	restricted
         	when (!Level2ImportTierParentRel exists
         	and   !Level3ImportTierParentRel exists)
        NoLevel6RebateParents
        	restricted
         	when (!Level2RebateParentRel exists
         	and   !Level3RebateParentRel exists
         	and   !Level4RebateParentRel exists
         	and   !Level5RebateParentRel exists
         	and   !Level6RebateParentRel exists)
        NoLevel5RebateParents
        	restricted
         	when (!Level2RebateParentRel exists
         	and   !Level3RebateParentRel exists
         	and   !Level4RebateParentRel exists
         	and   !Level5RebateParentRel exists)
        NoLevel4RebateParents
        	restricted
         	when (!Level2RebateParentRel exists
         	and   !Level3RebateParentRel exists
         	and   !Level4RebateParentRel exists)
        NoLevel3RebateParents
        	restricted
         	when (!Level2RebateParentRel exists
         	and   !Level3RebateParentRel exists)
		IsAttachedToSupplier
			restricted
			when (SupplierCommodityCodeRel exists)
		Historical
			restricted
			when  (parentcontext.name = "InvoiceLineFact"
		        or parentcontext.name = "InvoiceLineFactCommodityCode"
		        or parentcontext.name = "PolineFact"
		        or parentcontext.name = "PoInvLineFact")
		
		SupplierCommodityCodeExists
			restricted
			when (InternalSupplierCommodityCodeRel exists)

		SupplierHasChildCommodityCode
			restricted
			when (ChildSupplierCommodityCodeRel exists)

		RegistrationSupplierHasChildCommodityCode
			restricted
			when (RegistrationChildSupplierCommodityCodeRel exists)

	Field Rules
   		Description
        	required
        Active
            initial value is true
        DepthLevel
        	DepthLevel = CommodityCode levels
		CommCodes
			CommCodes = CommodityCode

  	Sets

 		ByCommCodes
 			indexed
 			Sort Order
 				ItemGroup
 				CommCodes

 	Relations
		CommCodesRel
			one-to-one relation to CommCodes
			delete cascades
			Field Mapping uses symbolic key
				related.ItemGroup	= ItemGroup
				related.CommCodes	= CommCodes

		ItemsRel 
			one-to-many relation to Item
			Field Mapping uses ByCommodityCode
				related.ItemGroup		= ItemGroup
				related.CommodityCode   = CommCodes
		
		Level1CommodityCodeChildRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup        = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2] entered
                and    related.Active)

        Level2CommodityCodeChildRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup        = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2]  = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3] entered
                and    related.Active)

        Level3CommodityCodeChildRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup        = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2]  = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3]  = CommodityCodeSegment3
                and    related.CommodityCode.Segment[4] entered
                and    related.Active)

        Level4CommodityCodeChildRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup        = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2]  = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3]  = CommodityCodeSegment3
                and    related.CommodityCode.Segment[4]  = CommodityCodeSegment4
                and    related.CommodityCode.Segment[5] entered
                and    related.Active)

		Level5CommodityCodeChildRel
			one-to-many relation to CommodityCode
			Field Mapping uses symbolic key
				related.ItemGroup		= ItemGroup
			Instance Selection
           		where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
           		and	   related.CommodityCode.Segment[2]  = CommodityCodeSegment2
           		and	   related.CommodityCode.Segment[3]  = CommodityCodeSegment3
           		and	   related.CommodityCode.Segment[4]  = CommodityCodeSegment4
           		and	   related.CommodityCode.Segment[5]  = CommodityCodeSegment5
           		and	   related.CommodityCode.Segment[6] entered
           		and    related.Active)


   		Level1CommodityCodeChildInactivateRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup        = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2] entered)

        Level2CommodityCodeChildInactivateRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup        = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2]  = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3] entered)

        Level3CommodityCodeChildInactivateRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup        = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2]  = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3]  = CommodityCodeSegment3
                and    related.CommodityCode.Segment[4] entered)

        Level4CommodityCodeChildInactivateRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup        = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2]  = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3]  = CommodityCodeSegment3
                and    related.CommodityCode.Segment[4]  = CommodityCodeSegment4
                and    related.CommodityCode.Segment[5] entered)

		Level5CommodityCodeChildInactivateRel
			one-to-many relation to CommodityCode
			Field Mapping uses symbolic key
				related.ItemGroup		= ItemGroup
			Instance Selection
           		where (related.CommodityCode.Segment[1]  = CommodityCodeSegment1
           		and	   related.CommodityCode.Segment[2]  = CommodityCodeSegment2
           		and	   related.CommodityCode.Segment[3]  = CommodityCodeSegment3
           		and	   related.CommodityCode.Segment[4]  = CommodityCodeSegment4
           		and	   related.CommodityCode.Segment[5]  = CommodityCodeSegment5
           		and	   related.CommodityCode.Segment[6] entered)

   		SupplierGroupRel
  			one-to-one relation to SupplierGroup
  			Field Mapping uses symbolic key
  				related.SupplierGroup	= ItemGroup
           		
    	ContractTierQualifierCodeRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where (related.CommodityCode = CommodityCode)
            		
  		ContractImportTierQualifierCodeRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where (related.CommodityCode = CommodityCode)
  		
  		Level1TierChildrenRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1])
           		and    (related.CommodityCode.Segment[2] != blank
           		or      related.CommodityCode.Segment[3] != blank
           		or      related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level2TierChildrenRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2])
           		and    (related.CommodityCode.Segment[3] != blank
           		or      related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level3TierChildrenRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3])
           		and    (related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level4TierChildrenRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4]  = CommodityCode.Segment[4])
           		and    (related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level5TierChildrenRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4]  = CommodityCode.Segment[4]
           		and     related.CommodityCode.Segment[5]  = CommodityCode.Segment[5])
           		and    (related.CommodityCode.Segment[6] != blank))

    	Level2TierParentRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1])
           		and    (related.CommodityCode.Segment[2] = blank
           		and     related.CommodityCode.Segment[3] = blank
           		and     related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
    	Level3TierParentRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2])
           		and    (related.CommodityCode.Segment[3] = blank
           		and     related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level4TierParentRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3])
           		and    (related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level5TierParentRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4] = CommodityCode.Segment[4])
           		and    (related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level6TierParentRel
    		one-to-many relation to ContractTierQualifierCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.ContractTier		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4] = CommodityCode.Segment[4]
           		and     related.CommodityCode.Segment[5] = CommodityCode.Segment[5])
           		and    (related.CommodityCode.Segment[6] = blank))


     	Level1ImportTierChildrenRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1])
           		and    (related.CommodityCode.Segment[2] != blank
           		or      related.CommodityCode.Segment[3] != blank
           		or      related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
  		Level2ImportTierChildrenRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2])
           		and    (related.CommodityCode.Segment[3] != blank
           		or      related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level3ImportTierChildrenRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3])
           		and    (related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level4ImportTierChildrenRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4]  = CommodityCode.Segment[4])
           		and    (related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level5ImportTierChildrenRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4]  = CommodityCode.Segment[4]
           		and     related.CommodityCode.Segment[5]  = CommodityCode.Segment[5])
           		and    (related.CommodityCode.Segment[6] != blank))

    	Level2ImportTierParentRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1])
           		and    (related.CommodityCode.Segment[2] = blank
           		and     related.CommodityCode.Segment[3] = blank
           		and     related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level3ImportTierParentRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2])
           		and    (related.CommodityCode.Segment[3] = blank
           		and     related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level4ImportTierParentRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3])
           		and    (related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level5ImportTierParentRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4] = CommodityCode.Segment[4])
           		and    (related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level6ImportTierParentRel
    		one-to-many relation to ContractImportTierQualCode
            Field Mapping uses  symbolic key
          		related.ContractGroup		        = LocalContractImportTierGroup.ContractGroup
           		related.ContractImport			    = LocalContractImportTierGroup.ContractImport
           		related.ContractImportTier		    = LocalContractImportTierGroup.ContractImportTier
           		related.ContractImportTierQualifier = LocalContractImportTierGroup.ContractImportTierQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4] = CommodityCode.Segment[4]
           		and     related.CommodityCode.Segment[5] = CommodityCode.Segment[5])
           		and    (related.CommodityCode.Segment[6] = blank))

     	ContractRebateQualifierCodeRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where (related.CommodityCode = CommodityCode)
           		
  		Level1RebateChildrenRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1])
           		and    (related.CommodityCode.Segment[2] != blank
           		or      related.CommodityCode.Segment[3] != blank
           		or      related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
  		Level2RebateChildrenRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2])
           		and    (related.CommodityCode.Segment[3] != blank
           		or      related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level3RebateChildrenRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3])
           		and    (related.CommodityCode.Segment[4] != blank
           		or      related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level4RebateChildrenRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4]  = CommodityCode.Segment[4])
           		and    (related.CommodityCode.Segment[5] != blank
           		or      related.CommodityCode.Segment[6] != blank))
           		
  		Level5RebateChildrenRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1]  = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2]  = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3]  = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4]  = CommodityCode.Segment[4]
           		and     related.CommodityCode.Segment[5]  = CommodityCode.Segment[5])
           		and    (related.CommodityCode.Segment[6] != blank))


    	Level2RebateParentRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1])
           		and    (related.CommodityCode.Segment[2] = blank
           		and     related.CommodityCode.Segment[3] = blank
           		and     related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level3RebateParentRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2])
           		and    (related.CommodityCode.Segment[3] = blank
           		and     related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level4RebateParentRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3])
           		and    (related.CommodityCode.Segment[4] = blank
           		and     related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level5RebateParentRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4] = CommodityCode.Segment[4])
           		and    (related.CommodityCode.Segment[5] = blank
           		and     related.CommodityCode.Segment[6] = blank))
           		
    	Level6RebateParentRel
    		one-to-many relation to ContractRebateQualifierCode
            Field Mapping uses symbolic key
          		related.ContractGroup		    = LocalContractRebate.ContractGroup
           		related.Contract			    = LocalContractRebate.Contract
           		related.ContractRebateType		= LocalContractRebate.ContractRebateType
				related.ContractRebate			= blank
           		related.ContractRebateQualifier = LocalContractRebate.ContractRebateQualifier
           	Instance Selection
           		where ((related.CommodityCode.Segment[1] = CommodityCode.Segment[1]
           		and     related.CommodityCode.Segment[2] = CommodityCode.Segment[2]
           		and     related.CommodityCode.Segment[3] = CommodityCode.Segment[3]
           		and     related.CommodityCode.Segment[4] = CommodityCode.Segment[4]
           		and     related.CommodityCode.Segment[5] = CommodityCode.Segment[5])
           		and    (related.CommodityCode.Segment[6] = blank))

           		
    	ContractLineTierMemberQualRel
    		one-to-many relation to ContractLineTierMemberQual
            Field Mapping uses ByTierQual
          		related.ContractGroup		  = LocalContractTierGroup.ContractGroup
           		related.Contract			  = LocalContractTierGroup.Contract
           		related.Tier		  		  = LocalContractTierGroup.ContractTier
           		related.ContractTierQualifier = LocalContractTierGroup.ContractTierQualifier
           	Instance Selection
           		where (related.ItemCodesUsed)
  	
		CommoditySupplierRel 
        	one-to-many relation to SupplierCommodityCode 
            Field Mapping uses part of key 
            	related.SupplierGroup	= ItemGroup
            Instance Selection
            	where (related.Supplier.Active
            	and    related.SupplierSourceId.Active
             	and    CommodityCode within related.CommodityCode)

      	InternalSupplierCommodityCodeRel 
      		one-to-one relation to SupplierCommodityCode
      		Field Mapping uses part of key
      			related.SupplierGroup   	= SupplierGroup
      			related.Supplier        	= Supplier 
      			related.SupplierSourceId 	= SupplierSourceId
      			related.CommodityCode       = CommodityCode

      	RegistrationSupplierCommodityCodeRel 
      		one-to-one relation to SupplierCommodityCode
      		Field Mapping uses part of key
      			related.SupplierGroup   	= SupplierGroup
      			related.Supplier        	= Supplier 
      			related.SupplierSourceId 	= actor.agent(SupplierSourceId).SupplierSourceId
      			related.CommodityCode       = CommodityCode

		ChildSupplierCommodityCodeRel
			one-to-many relation to SupplierCommodityCode
			Field Mapping uses part of key 
				related.SupplierGroup   	= SupplierGroup
				related.Supplier        	= Supplier 
				related.SupplierSourceId 	= SupplierSourceId
			Instance Selection
				where (related.CommodityCode within CommodityCode)

		RegistrationChildSupplierCommodityCodeRel
			one-to-many relation to SupplierCommodityCode
			Field Mapping uses part of key 
				related.SupplierGroup   	= SupplierGroup
				related.Supplier        	= Supplier 
				related.SupplierSourceId 	= actor.agent(SupplierSourceId).SupplierSourceId
			Instance Selection
				where (related.CommodityCode within CommodityCode)
      	
      	SupplierCommodityCodeRel is a SupplierCommodityCode set
      		Instance Selection
      			where (related.SupplierGroup 						= actor.agent(SupplierSourceId).SupplierGroup
      			and	   related.Supplier 							= actor.agent(SupplierSourceId).Supplier
      			and	   related.SupplierSourceId 					= actor.agent(SupplierSourceId).SupplierSourceId)

		SubcontractorCommodityCodeRel 
        	one-to-many relation to SubcontractorCommodityCode 
            Field Mapping uses symbolic key 
            	related.SupplierGroup	= ItemGroup
            	related.Subcontractor	= LocalSubcontractor
            	
        Level2CommodityCodeActiveParentRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup       = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1] = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2] = blank
                and    related.Active)
        
        Level3CommodityCodeActiveParentRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup       = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1] = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2] = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3] = blank
                and    related.Active)
        
        Level4CommodityCodeActiveParentRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup       = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1] = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2] = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3] = CommodityCodeSegment3
                and    related.CommodityCode.Segment[4] = blank
                and    related.Active)
        
        Level5CommodityCodeActiveParentRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup       = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1] = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2] = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3] = CommodityCodeSegment3
                and    related.CommodityCode.Segment[4] = CommodityCodeSegment4
                and    related.CommodityCode.Segment[5] = blank
                and    related.Active)
        
        Level6CommodityCodeActiveParentRel
            one-to-many relation to CommodityCode
            Field Mapping uses symbolic key
                related.ItemGroup       = ItemGroup
            Instance Selection
                where (related.CommodityCode.Segment[1] = CommodityCodeSegment1
                and    related.CommodityCode.Segment[2] = CommodityCodeSegment2
                and    related.CommodityCode.Segment[3] = CommodityCodeSegment3
                and    related.CommodityCode.Segment[4] = CommodityCodeSegment4
                and    related.CommodityCode.Segment[5] = CommodityCodeSegment5
                and    related.CommodityCode.Segment[6] = blank
                and    related.Active)

                

		FSMBODConfigurationParameterRel
        	one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
            	related.FSMBODConfigurationParameter 		= LocalConfigurationParameter	
			
		FSMBODConfigurationRel
        	one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
            	related.FSMBODConfiguration.Verb 		= 1
            	related.FSMBODConfiguration.Noun 		= "CodeDefinition"
            	related.FSMBODConfiguration.Direction 	= 1
				
		FSMBODAECrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "CSFGLC"
            	related.FSMBODCrossReference.DestinationField 	= "DESTAE"
            Instance Selection
				where (related.SourceValue	= LocalCleanDocIDAccountingentity )
		
		FSMCleanDocIDAccountingEntityRel
			one-to-one relation to AccountingEntity
			Field Mapping uses symbolic key
    			related.FinanceEnterpriseGroup 	= ItemGroup.BusinessGroup.FinanceEnterpriseGroup
    			related.AccountingEntity		= LocalCleanDocIDAccountingentity

		FSMCleanDocIDCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "CSFGLC"
            	related.FSMBODCrossReference.DestinationField 	= "DESTAE"
				
		BODAccountingEntityRel
			one-to-many relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
			Instance Selection
				where (related.BusinessGroup = ItemGroup)

		FSMInboundBODTrackerRel
            one-to-one relation to FSMInboundBODTracker
            Field Mapping uses symbolic key
                related.FSMInboundBODTracker	= LocalFSMInboundBODTracker
				

    Rule Blocks

		
  	Attach Rules
		constraint (Historical
				or  Active)
					"CommodityCode<CommodityCode>OrCommodityCodeAtAHigherLevelIsInactive"
			
	Actions
		Create is a Create Action
    		Action Rules
    			constraint(ItemGroup.CommodityCodeStructure entered)
    				"CommodityStructureMustBeAttachedToItemGroup"
    			
    			constraint (ValidDepthLevelSegmentSize)
	    			"<InvalidSegmentSizeMessage>"	
				
				CommCodes = CommodityCode

				invoke Create CommCodesRel
					invoked.ItemGroup		= ItemGroup
					invoked.CommCodes		= CommCodes
					invoked.CcDescription	= Description
					if (Active)
						invoked.CcActive		= 1
					else
						invoked.CcActive        = 0

    			build text search field CommoditySearch
    				Fields
  						CommodityCode
  						Description
  			
    	AttachToSupplierContactFromForm is an Instance Action   
			default label is "AddSelected"
    		Action Rules
				if (SupplierSourceId entered)
					invoke AttachToSupplierContact
						invoked.SupplierGroup				= actor.agent(SupplierSourceId).SupplierGroup
						invoked.Supplier					= actor.agent(SupplierSourceId).Supplier
						invoked.SupplierSourceId			= SupplierSourceId
				else
					invoke AttachToSupplierContact
						invoked.SupplierGroup				= actor.agent(SupplierSourceId).SupplierGroup
						invoked.Supplier					= actor.agent(SupplierSourceId).Supplier
						invoked.SupplierSourceId			= actor.agent(SupplierSourceId).SupplierSourceId
  			
    	AttachToSupplierContact is an Instance Action
			default label is "Attach"
    		Parameters
    			SupplierGroup
    			Supplier
    			SupplierSourceId
    			
    		Parameter Rules
    			SupplierGroup
    				required
    			Supplier
    				required
    			SupplierSourceId
    				required
    				
    		Action Rules
    			invoke Create SupplierCommodityCode
    				invoked.SupplierGroup				= SupplierGroup
    				invoked.Supplier					= Supplier
    				invoked.SupplierSourceId			= SupplierSourceId
    				fill in fields from CommodityCode
    				    			    		
    	AttachToContact is an Instance Action
			default label is "Attach"
    		Action Rules
    			invoke Create SupplierCommodityCode
    				invoked.SupplierGroup				= actor.agent(SupplierSourceId).SupplierGroup
    				invoked.Supplier					= actor.agent(SupplierSourceId).Supplier
    				invoked.SupplierSourceId			= actor.agent(SupplierSourceId).SupplierSourceId
    				fill in fields from CommodityCode			    			    		
    				    			    		
    	AttachToSubcontractor is an Instance Action
			default label is "Attach"
    		Parameters
    			SupplierGroup
    			Subcontractor
    			
    		Parameter Rules
    			SupplierGroup
    				required
    			Subcontractor
	 				required
    				
    		Action Rules
    			LocalSubcontractor = Subcontractor
				constraint (!CommodityCode within all Subcontractor.SubcontractorCommodityCode set.SubcontractorCommodityCode.CommodityCode)
					"AlreadyRegisteredForTheSameOrAHigherLevelCommodityCodeWithinSameStructure"
				constraint (!all SubcontractorCommodityCodeRel.SubcontractorCommodityCode.CommodityCode within CommodityCode)
					"CannotSelectAHigherLevelCommodityCodeWhenALowerLevelCommodityCodeIsAlreadySelected;MustDeleteLowerLevelCommodityCodeBeforeAdding"
    			invoke Create SubcontractorCommodityCode
    				invoked.SupplierGroup								= SupplierGroup
    				invoked.Subcontractor								= Subcontractor
    				invoked.SubcontractorCommodityCode.CommodityCode	= CommodityCode
    				fill in fields from CommodityCode
    				    			    		
    	Update is an Update Action
    		Action Rules
    			invoke Update CommCodesRel
    		    	invoked.ItemGroup		= ItemGroup
    				invoked.CommCodes		= CommCodes
    				invoked.CcDescription	= Description
    				if (Active = true)
    					invoked.CcActive		= 1
    				else
    				if (Active = false)
    					invoked.CcActive        = 0
    				
    			build text search field CommoditySearch
    				Fields
  						CommodityCode
  						Description
    			
    			if (Active changed
    			and HasChildForInactivation)
    				if (DepthLevel = 1)
						for each Level1CommodityCodeChildInactivateRel 
							invoke Update each
								invoked.Active = Active
							invoke Update each CommCodesRel
			    				if (Active = true)
    								invoked.CcActive		= 1
    							else
    							if (Active = false)
    								invoked.CcActive        = 0	
    				if (DepthLevel = 2)
						for each Level2CommodityCodeChildInactivateRel 
							invoke Update each
								invoked.Active = Active
							invoke Update each CommCodesRel
			    				if (Active = true)
    								invoked.CcActive		= 1
    							else
    							if (Active = false)
    								invoked.CcActive        = 0	
    				if (DepthLevel = 3)
						for each Level3CommodityCodeChildInactivateRel 
							invoke Update each
								invoked.Active = Active
							invoke Update each CommCodesRel
			    				if (Active = true)
    								invoked.CcActive		= 1
    							else
    							if (Active = false)
    								invoked.CcActive        = 0
    				if (DepthLevel = 4)
						for each Level4CommodityCodeChildInactivateRel 
							invoke Update each
								invoked.Active = Active
							invoke Update each CommCodesRel
			    				if (Active = true)
    								invoked.CcActive		= 1
    							else
    							if (Active = false)
    								invoked.CcActive        = 0					
					if (DepthLevel = 5)
						for each Level5CommodityCodeChildInactivateRel 
							invoke Update each
								invoked.Active = Active
							invoke Update each CommCodesRel
			    				if (Active = true)
    								invoked.CcActive		= 1
    							else
    							if (Active = false)
    								invoked.CcActive        = 0
    						
    	Delete is a Delete Action
    		Entrance Rules
        		if (ItemGroup.BusinessGroup.FinanceEnterpriseGroup.BODTrigger)
					ActionCode	= ActionCode.Delete
					increment bod id.VariationID

					trigger "CommodityCodeService" PA service
						resume on error
						title is "EG:<ItemGroup.BusinessGroup.FinanceEnterpriseGroup>CommodityCode:<CommodityCode>"
						Criteria
							ItemGroup.BusinessGroup.FinanceEnterpriseGroup
						Variables
							ActionCode
							ItemGroup.BusinessGroup.FinanceEnterpriseGroup
								variable name is FinanceEnterpriseGroup
							ItemGroup
								variable name is ItemGroup
							LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
								variable name is CurrentTimeStamp
							include persistent fields from CommodityCode

    	
    	AttachToTierQualifier is an Instance Action
			Parameters
				ContractGroup
				Contract
				ContractTier
				ContractTierQualifier 
			Parameter Rules
				ContractGroup 
					required
				Contract
					required
				ContractTier
					required
				ContractTierQualifier
					required
			
			Action Rules
				constraint (Contract.NotClosed)
    				"CannotAdd;ContractIsClosed"		
				LocalContractTierGroup.ContractGroup 		 = ContractGroup
				LocalContractTierGroup.Contract 			 = Contract
				LocalContractTierGroup.ContractTier 		 = ContractTier
				LocalContractTierGroup.ContractTierQualifier = ContractTierQualifier
				if (Level1)
					constraint (!Level1TierChildrenRel exists) 
						"CannotAdd;TierQualifierCodesExistForCommodityCodeAtALowerLevel"
				else
				if (Level2)
					constraint (!Level2TierChildrenRel exists) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (!Level2TierParentRel exists)  
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level3)
					constraint (!Level3TierChildrenRel exists) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel3TierParents) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level4)
					constraint (!Level4TierChildrenRel exists) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel4TierParents) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level5)
					constraint (!Level5TierChildrenRel exists) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel5TierParents) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level6)
					constraint (NoLevel6TierParents) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
						
				if (!ContractTierQualifierCodeRel exists)
					invoke Create ContractTierQualifierCode
						invoked.Contract			  = Contract
						invoked.ContractGroup		  = ContractGroup
						invoked.ContractTier		  = ContractTier
						invoked.ContractTierQualifier = ContractTierQualifier
						invoked.CommodityCode  	  	  = CommodityCode
						invoked.ItemCategory		  = 1



    	
    	AttachToImportTierQualifier is an Instance Action
			Parameters
				ContractGroup
				ContractImport
				ContractImportTier
				ContractImportTierQualifier 
			Parameter Rules
				ContractGroup 
					required
				ContractImport
					required
				ContractImportTier
					required
				ContractImportTierQualifier
					required
			
			Action Rules
				LocalContractImportTierGroup.ContractGroup      		 = ContractGroup
				LocalContractImportTierGroup.ContractImport		         = ContractImport
				LocalContractImportTierGroup.ContractImportTier 		 = ContractImportTier
				LocalContractImportTierGroup.ContractImportTierQualifier = ContractImportTierQualifier
				if (Level1)
					constraint (!Level1ImportTierChildrenRel exists) 
						"CannotAdd;TierQualifierCodesExistForCommodityCodeAtALowerLevel"
				else
				if (Level2)
					constraint (!Level2ImportTierChildrenRel exists) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (!Level2ImportTierParentRel exists)  
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level3)
					constraint (!Level3ImportTierChildrenRel exists) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel3ImportTierParents) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level4)
					constraint (!Level4ImportTierChildrenRel exists) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel4ImportTierParents) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level5)
					constraint (!Level5ImportTierChildrenRel exists) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel5ImportTierParents) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level6)
					constraint (NoLevel6ImportTierParents) 
						"CannotAdd;TierQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
						
				if (!ContractImportTierQualifierCodeRel exists)
					invoke Create ContractImportTierQualCode
						invoked.ContractImport			    = ContractImport
						invoked.ContractGroup		        = ContractGroup
						invoked.ContractImportTier		    = ContractImportTier
						invoked.ContractImportTierQualifier = ContractImportTierQualifier
						invoked.CommodityCode  	  	        = CommodityCode
						invoked.ItemCategory		        = 1
    	
    	AttachToRebateQualifier is an Instance Action
			Parameters
				ContractGroup
				Contract
   				ContractRebateType			
   				ContractRebate				
   				ContractRebateQualifier
			Parameter Rules
				ContractGroup 
					required
				Contract
					required
				ContractRebateType
					required
				ContractRebate
					required
				ContractRebateQualifier
					required
			
			Action Rules
    			constraint (Contract.CanAmend)
    				"ContractMustBeInDraftOrAddendumOrAmendmentStatusToModifyRebateQualifiers"								
    			constraint (ContractRebate.Active)
    				"ContractRebateMustBeActiveToAddRebateQualifierCodes"


				LocalContractRebate.ContractGroup 		    = ContractGroup
				LocalContractRebate.Contract	            = Contract
				LocalContractRebate.ContractRebateType      = ContractRebateType
				LocalContractRebate.ContractRebateQualifier = ContractRebateQualifier			
				if (Level1)
					constraint (!Level1RebateChildrenRel exists) 
						"CannotAdd;RebateQualifierCodesExistForCommodityCodeAtALowerLevel"
				else
				if (Level2)
					constraint (!Level2RebateChildrenRel exists) 
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (!Level2RebateParentRel exists)  
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level3)
					constraint (!Level3RebateChildrenRel exists) 
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel3RebateParents) 
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level4)
					constraint (!Level4RebateChildrenRel exists) 
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel4RebateParents) 
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level5)
					constraint (!Level5RebateChildrenRel exists) 
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtALowerLevel"
					constraint (NoLevel5RebateParents) 
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
				else
				if (Level6)
					constraint (NoLevel6RebateParents) 
						"CannotAdd;RebateQualifierCodeRecordAlreadyExistsForCommodityCodeAtAHigherLevel"
						
				if (!ContractRebateQualifierCodeRel exists)
					invoke Create ContractRebateQualifierCode
						invoked.ContractGroup		    = ContractGroup
						invoked.Contract			    = Contract
						invoked.ContractRebateType		= ContractRebateType
						invoked.ContractRebateQualifier = ContractRebateQualifier
						invoked.CommodityCode  	  	    = CommodityCode
						invoked.ItemCategory		    = 1
		
		AttachToEvent is an Instance Action
			Parameters
				Company 		is a SourcingCompany
				SourcingEvent
										
			Parameter Rules
				Company
					required
				SourcingEvent
					required
			
			Action Rules
				constraint (Company.SourcingGroup = ItemGroup)
					"SourcingCompanyDoesNotBelongToItemGroup"
				invoke Create SourcingEventCommodities
					invoked.Company			= Company
					invoked.SourcingEvent	= SourcingEvent
					invoked.CommodityCode	= CommodityCode
		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmRevision          is Alpha size 22
					default label is "Revision"
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"
			Action Rules
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.Revision != PrmRevision)
					bod id.Revision				= PrmRevision
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord

		SendCommodityCodeBODNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				if(DerivedCleanDocumentID = "Y")
					send ion bod
						bod is CommodityCodeCleanDocXMLBOD
						bod type is "Sync.CodeDefinition"
						document id is DerivedBODDocumentID
						accounting entity is LocalCrossAccountingEntity
						variation id is	BODVariationID	
				else
					send ion bod
						bod is CommodityCodeXMLBOD
						bod type is "Sync.CodeDefinition"
						document id is DerivedBODDocumentID
						variation id is	BODVariationID

		TriggerCommodityCodeNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
				RestartFlag is Boolean
			Action Rules
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "CodeDefinition"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "CommodityCode"
					invoked.PrmFinanceEnterpriseGroup	= ItemGroup.BusinessGroup.FinanceEnterpriseGroup
					invoked.PrmBusinessGroup			= ItemGroup
					invoked.PrmMainUserTemplate			= "IONSyncCodeDefination_CommodityCode_ST"
				LocalNativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger
				LocalBODTrigger = true
				if(ItemGroup.BusinessGroup.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
					if(DerivedCleanDocumentID = "Y")
						if(RestartFlag)
							if (BODAccountingEntityRel exist)
								LocalBodAccountingEntity = FSMInboundBODTracker.Reference4	
								if(DerivedMultipleFEG = "Y")
									LocalCleanDocIDAccountingentity = DerivedFinanceEnterpriseGroup + DerivedDelimiter + LocalBodAccountingEntity
								else
									LocalCleanDocIDAccountingentity = LocalBodAccountingEntity
								initialize LocalCrossAccountingEntity
								if(DerivedTriggerBODBasedOnCrossReference = "Y")
									if (FSMBODAECrossReferenceDetailRel.DestinationValue entered)
										LocalCrossAccountingEntity = FSMBODAECrossReferenceDetailRel.DestinationValue
								else
									LocalCrossAccountingEntity = LocalCleanDocIDAccountingentity
								if(LocalCrossAccountingEntity entered)
									LocalFSMInboundBODTracker		= FSMInboundBODTracker
									invoke Update FSMInboundBODTrackerRel
										invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
										invoked.BODDocumentID			= DerivedBODDocumentID
										invoked.BODVariationID			= BODVariationID
										invoked.StartDate				= system current timestamp
										invoked.Direction				= 1								
										invoked.BODAccountingEntity		= LocalCrossAccountingEntity
										invoked.Reference1				= ItemGroup
										invoked.Reference2              = CommCodes	
										invoked.Reference3    			= "CommodityCode"
										invoked.Reference4				= LocalBodAccountingEntity						
										initialize invoked.Error			
										initialize invoked.ErrorMessage
									LocalBODFormattedID = "infor-nid:" + DerivedTenantID + ":" + LocalCrossAccountingEntity + "::" + DerivedBODDocumentID + ":" +"?CodeDefinition&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
									CommodityCodeCleanDocXMLBOD = template.IONSyncCodeDefination_CommodityCode_CleanDoc_ST document for this instance
									invoke SendCommodityCodeBODNativeLPL
										resume on error
					                   		Error            							= true
					                        ErrorMessage     							= error message
					                if(Error)
										invoke Update FSMInboundBODTrackerRel
											invoked.Error 								= Error
											invoked.ErrorMessage 						= ErrorMessage
											invoked.Status								= 2
											invoked.CloseDate							= system current timestamp
											invoked.BODXML								= CommodityCodeCleanDocXMLBOD
											invoked.BODID					            = LocalBODFormattedID
									else
										invoke Update FSMInboundBODTrackerRel
											invoked.Status									= 3
											invoked.CloseDate								= system current timestamp
											invoked.BODXML									= CommodityCodeCleanDocXMLBOD
											invoked.BODID					                = LocalBODFormattedID
						else
						if(DerivedTriggerBODBasedOnCrossReference = "Y")
							if(FSMCleanDocIDCrossReferenceDetailRel exists)
								for each FSMCleanDocIDCrossReferenceDetailRel
									initialize CommodityCodeCleanDocXMLBOD
									initialize LocalSourceValue
									LocalSourceValue = each.SourceValue
									if (LocalSourceValue entered)
										for each LocalSourceValue split on "<DerivedDelimiter>"
											initialize LocalCleanDocIDAccountingentity
											LocalCleanDocIDAccountingentity = each
									initialize LocalCrossAccountingEntity
									initialize LocalBODFormattedID
									if(FSMCleanDocIDAccountingEntityRel exists)
										LocalCrossAccountingEntity = each.DestinationValue
										if(LocalCrossAccountingEntity entered)
											if(FSMInboundBODTracker not entered)
												invoke Create FSMInboundBODTracker
													assign result to NewBODTracker
													invoked.Verb 					= 1
													invoked.Noun 					= "CodeDefinition"					
													invoked.BODDocumentID			= DerivedBODDocumentID
													invoked.BODVariationID			= BODVariationID
													invoked.Status					= 1
													invoked.StartDate				= system current timestamp
													invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
													invoked.BODAccountingEntity		= LocalCrossAccountingEntity
													invoked.Direction				= 1								
													invoked.Reference1				= ItemGroup
													invoked.Reference2              = CommCodes								
													invoked.Reference3				= "CommodityCode"	
													invoked.Reference4				= LocalBodAccountingEntity							
													initialize invoked.Error			
													initialize invoked.ErrorMessage					
												LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
												LocalBODFormattedID = "infor-nid:" + DerivedTenantID + ":" + LocalCrossAccountingEntity + "::" + DerivedBODDocumentID + ":" +"?CodeDefinition&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
												CommodityCodeCleanDocXMLBOD = template.IONSyncCodeDefination_CommodityCode_CleanDoc_ST document for this instance
											invoke SendCommodityCodeBODNativeLPL
												resume on error
													Error            							= true
													ErrorMessage     							= error message
											if(Error)
												invoke Update FSMInboundBODTrackerRel
													invoked.Error 								= Error
													invoked.ErrorMessage 						= ErrorMessage
													invoked.Status								= 2
													invoked.CloseDate							= system current timestamp
													invoked.BODXML								= CommodityCodeCleanDocXMLBOD
													invoked.BODID					            = LocalBODFormattedID
											else
												invoke Update FSMInboundBODTrackerRel
													invoked.Status									= 3
													invoked.CloseDate								= system current timestamp
													invoked.BODXML									= CommodityCodeCleanDocXMLBOD
													invoked.BODID					                = LocalBODFormattedID
						
						else
						if(DerivedTriggerBODBasedOnCrossReference = "N")
							if (BODAccountingEntityRel exist)
								for each BODAccountingEntityRel
									initialize LocalBodAccountingEntity
									initialize LocalCrossAccountingEntity
									initialize CommodityCodeCleanDocXMLBOD
									initialize LocalBODFormattedID
									LocalBodAccountingEntity = each.Company
									if(DerivedMultipleFEG = "Y")
										LocalCrossAccountingEntity = DerivedFinanceEnterpriseGroup + DerivedDelimiter + LocalBodAccountingEntity
									else
										LocalCrossAccountingEntity = LocalBodAccountingEntity
									
									if(LocalCrossAccountingEntity entered)
										if(FSMInboundBODTracker not entered)
											invoke Create FSMInboundBODTracker
												assign result to NewBODTracker
												invoked.Verb 					= 1
												invoked.Noun 					= "CodeDefinition"					
												invoked.BODDocumentID			= DerivedBODDocumentID
												invoked.BODVariationID			= BODVariationID
												invoked.Status					= 1
												invoked.StartDate				= system current timestamp
												invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
												invoked.BODAccountingEntity		= LocalCrossAccountingEntity
												invoked.Direction				= 1								
												invoked.Reference1				= ItemGroup
												invoked.Reference2              = CommCodes								
												invoked.Reference3				= "CommodityCode"	
												invoked.Reference4				= LocalBodAccountingEntity							
												initialize invoked.Error			
												initialize invoked.ErrorMessage					
											LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
											LocalBODFormattedID = "infor-nid:" + DerivedTenantID + ":" + LocalCrossAccountingEntity + "::" + DerivedBODDocumentID + ":" +"?CodeDefinition&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
											CommodityCodeCleanDocXMLBOD = template.IONSyncCodeDefination_CommodityCode_CleanDoc_ST document for this instance
										invoke SendCommodityCodeBODNativeLPL
											resume on error
												Error            							= true
												ErrorMessage     							= error message
										if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage
												invoked.Status								= 2
												invoked.CloseDate							= system current timestamp
												invoked.BODXML								= CommodityCodeCleanDocXMLBOD
												invoked.BODID					            = LocalBODFormattedID
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status									= 3
												invoked.CloseDate								= system current timestamp
												invoked.BODXML									= CommodityCodeCleanDocXMLBOD
												invoked.BODID					                = LocalBODFormattedID
					else
						if(FSMInboundBODTracker not entered)
							invoke Create FSMInboundBODTracker
								assign result to NewBODTracker
								invoked.Verb 					= 1
								invoked.Noun 					= "CodeDefinition"					
								invoked.BODDocumentID			= DerivedBODDocumentID
								invoked.BODVariationID			= BODVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.Direction				= 1								
								invoked.Reference1				= ItemGroup
								invoked.Reference2              = CommCodes								
								invoked.Reference3				= "CommodityCode"								
								initialize invoked.Error			
								initialize invoked.ErrorMessage					
							LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
						else 
							LocalFSMInboundBODTracker		= FSMInboundBODTracker
							invoke Update FSMInboundBODTrackerRel
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.BODDocumentID			= DerivedBODDocumentID
								invoked.BODVariationID			= BODVariationID
								invoked.BODID					= DerivedBODFormattedId
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.Direction				= 1								
								invoked.Reference1				= ItemGroup
								invoked.Reference2              = CommCodes
								invoked.Reference3				= "CommodityCode"								
								initialize invoked.Error			
								initialize invoked.ErrorMessage
						invoke SendCommodityCodeBODNativeLPL
							resume on error
		                   		Error            							= true
		                        ErrorMessage     							= error message
		                if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 								= Error
								invoked.ErrorMessage 						= ErrorMessage
								invoked.Status								= 2
								invoked.CloseDate							= system current timestamp
								invoked.BODXML								= CommodityCodeXMLBOD
								invoked.BODID					            = DerivedBODFormattedId
						else
							invoke Update FSMInboundBODTrackerRel
								invoked.Status									= 3
								invoked.CloseDate								= system current timestamp
								invoked.BODXML									= CommodityCodeXMLBOD
								invoked.BODID					                = DerivedBODFormattedId							

		
					

	Action Exit Rules
		if (ItemGroup.BusinessGroup.FinanceEnterpriseGroup.BODTrigger and !LocalBODTrigger)
			if (!action type.Delete)
				if (action != "UpdateBODIdFields") 
					ActionCode	= ActionCode.Update
					if (action type.Create)
						ActionCode	= ActionCode.Create				
					else
						if (action type.Delete)
							ActionCode	= ActionCode.Delete
					increment bod id.VariationID
					trigger "CommodityCodeService" PA service
						resume on error
						title is "EG:<ItemGroup.BusinessGroup.FinanceEnterpriseGroup>CommodityCode:<CommodityCode>"
						Criteria
							ItemGroup.BusinessGroup.FinanceEnterpriseGroup
						Variables
							ActionCode
							ItemGroup.BusinessGroup.FinanceEnterpriseGroup
								variable name is FinanceEnterpriseGroup
							ItemGroup
								variable name is ItemGroup
							LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
								variable name is CurrentTimeStamp
							include persistent fields from CommodityCode

