InvoiceLineFactCommodityCode is a BusinessClass
	owned by procurement
	prefix is ILFCC

	Ontology
		symbolic key is InvoiceLineFactCommodityCode

	Patterns
        disable Auditing
        disable EffectiveDated

	Persistent Fields
		CommodityCode
		Description				is Alpha 150
		TotalOnOffSpend			is an InternationalAmount
		ConsolidationLevel		is Numeric 1
	
	Local Fields
        SpendDimension

	Derived Fields
		DerivedCommodityCodeSegment2 is a ConditionalField
			type is Alpha size up to 10
			restricted
			if (StandaloneSegment2)
				blank
			else
				InvoiceLineFactCommodityCode.Segment[2]
				
		DerivedCommodityCodeSegment3 is a ConditionalField
			type is Alpha size up to 10
			restricted
			if (StandaloneSegment3)
				blank
			else
				InvoiceLineFactCommodityCode.Segment[3]
				
		DerivedCommodityCodeSegment4 is a ConditionalField
			type is Alpha size up to 10
			restricted
			if (StandaloneSegment4)
				blank
			else
				InvoiceLineFactCommodityCode.Segment[4]
				
		DerivedCommodityCodeSegment5 is a ConditionalField
			type is Alpha size up to 10
			restricted
			if (StandaloneSegment5)
				blank
			else
				InvoiceLineFactCommodityCode.Segment[5]
				
        DerivedDescription is a DerivedField
            type is Alpha 150
            if (StandaloneSegment2)
                return DerivedNoLevel2Message
            else
            if (StandaloneSegment3)
                return DerivedNoLevel3Message
            else
            if (StandaloneSegment4)
                return DerivedNoLevel4Message
            else
            if (StandaloneSegment5)
                return DerivedNoLevel5Message
            else
            if (Description entered)
                return Description
            else
                return DerivedNoLevelMessage
                
        DerivedNoLevel2Message is a MessageField
            "NoLevel2Value"
            
        DerivedNoLevel3Message is a MessageField
            "NoLevel3Value"
            
        DerivedNoLevel4Message is a MessageField
            "NoLevel4Value"
            
        DerivedNoLevel5Message is a MessageField
            "NoLevel5Value"
		
		DerivedNoLevelMessage is a MessageField
            "NoLevelValue"
   	Conditions
		StandaloneSegment2
			restricted
			when (InvoiceLineFactCommodityCode.Segment[2]	= "=")

		StandaloneSegment3
			restricted
			when (InvoiceLineFactCommodityCode.Segment[3]	= "=")

		StandaloneSegment4
			restricted
			when (InvoiceLineFactCommodityCode.Segment[4]	= "=")

		StandaloneSegment5
			restricted
			when (InvoiceLineFactCommodityCode.Segment[5]	= "=")

	Relations
		InvoiceLineFactsRel		is an InvoiceLineFact set
			Instance Selection

				where ((related.CommodityCode.Segment[1]		= CommodityCode.Segment[1]
				and    CommodityCode.Segment[2] not entered)
				or     (related.CommodityCode.Segment[1]		= CommodityCode.Segment[1]
				and     related.CommodityCode.Segment[2]		= CommodityCode.Segment[2]
				and     CommodityCode.Segment[3] not entered)
				or     (related.CommodityCode.Segment[1]		= CommodityCode.Segment[1]
				and     related.CommodityCode.Segment[2]		= CommodityCode.Segment[2]
				and     related.CommodityCode.Segment[3]		= CommodityCode.Segment[3]
				and     CommodityCode.Segment[4] not entered)
				or     (related.CommodityCode.Segment[1]		= CommodityCode.Segment[1]
				and     related.CommodityCode.Segment[2]		= CommodityCode.Segment[2]
				and     related.CommodityCode.Segment[3]		= CommodityCode.Segment[3]
				and     related.CommodityCode.Segment[4]		= CommodityCode.Segment[4]
				and     CommodityCode.Segment[5] not entered)
				or     (related.CommodityCode.Segment[1]		= CommodityCode.Segment[1]
				and     related.CommodityCode.Segment[2]		= CommodityCode.Segment[2]
				and     related.CommodityCode.Segment[3]		= CommodityCode.Segment[3]
				and     related.CommodityCode.Segment[4]		= CommodityCode.Segment[4]
				and     related.CommodityCode.Segment[5]		= CommodityCode.Segment[5]
				and     CommodityCode.Segment[6] not entered)
				or     (related.CommodityCode.Segment[1]		= CommodityCode.Segment[1]
				and     related.CommodityCode.Segment[2]		= CommodityCode.Segment[2]
				and     related.CommodityCode.Segment[3]		= CommodityCode.Segment[3]
				and     related.CommodityCode.Segment[4]		= CommodityCode.Segment[4]
				and     related.CommodityCode.Segment[5]		= CommodityCode.Segment[5]
				and     related.CommodityCode.Segment[6]		= CommodityCode.Segment[6]))
				
		InvoiceLineFactConsolidatesBySegmentRel
			one-to-many relation to InvoiceLineFactConsolidate
			Field Mapping uses ByLevelsOnOff
				related.ProcurementGroup							= ProcurementGroup
				related.InvoiceLineFactConsolidateControl			= InvoiceLineFactConsolidateControl
				related.InvoiceLineFactConsolidate.SpendCategory	= 1
				related.ConsolidationLevel							= 6
				related.InvoiceLineFactConsolidate.Level1.Type		= SpendDimension.Type.CommodityCodeSegment1
				related.InvoiceLineFactConsolidate.Level1.Value		= InvoiceLineFactCommodityCode.Segment[1]
			Instance Selection
				where ((related.InvoiceLineFactConsolidate.Level1.Value		= InvoiceLineFactCommodityCode.Segment[1]
				and     InvoiceLineFactCommodityCode.Segment[2] not entered)
				or     (related.InvoiceLineFactConsolidate.Level1.Value		= InvoiceLineFactCommodityCode.Segment[1]
				and     related.InvoiceLineFactConsolidate.Level2.Value		= DerivedCommodityCodeSegment2
				and     InvoiceLineFactCommodityCode.Segment[3] not entered)
				or     (related.InvoiceLineFactConsolidate.Level1.Value		= InvoiceLineFactCommodityCode.Segment[1]
				and     related.InvoiceLineFactConsolidate.Level2.Value		= InvoiceLineFactCommodityCode.Segment[2]
				and     related.InvoiceLineFactConsolidate.Level3.Value		= DerivedCommodityCodeSegment3
				and     InvoiceLineFactCommodityCode.Segment[4] not entered)
				or     (related.InvoiceLineFactConsolidate.Level1.Value		= InvoiceLineFactCommodityCode.Segment[1]
				and     related.InvoiceLineFactConsolidate.Level2.Value		= InvoiceLineFactCommodityCode.Segment[2]
				and     related.InvoiceLineFactConsolidate.Level3.Value		= InvoiceLineFactCommodityCode.Segment[3]
				and     related.InvoiceLineFactConsolidate.Level4.Value		= DerivedCommodityCodeSegment4
				and     InvoiceLineFactCommodityCode.Segment[5] not entered)
				or     (related.InvoiceLineFactConsolidate.Level1.Value		= InvoiceLineFactCommodityCode.Segment[1]
				and     related.InvoiceLineFactConsolidate.Level2.Value		= InvoiceLineFactCommodityCode.Segment[2]
				and     related.InvoiceLineFactConsolidate.Level3.Value		= InvoiceLineFactCommodityCode.Segment[3]
				and     related.InvoiceLineFactConsolidate.Level4.Value		= InvoiceLineFactCommodityCode.Segment[4]
				and     related.InvoiceLineFactConsolidate.Level4.Value		= InvoiceLineFactCommodityCode.Segment[5]))

		InvoiceLineFactConsolidatesByLevelRel
			one-to-many relation to InvoiceLineFactConsolidate
			Field Mapping uses ByLevels
				related.InvoiceLineFactConsolidate.Level1.Value	= InvoiceLineFactCommodityCode.Segment[1]
				related.InvoiceLineFactConsolidate.Level2.Value	= InvoiceLineFactCommodityCode.Segment[2]
				related.InvoiceLineFactConsolidate.Level3.Value	= InvoiceLineFactCommodityCode.Segment[3]
				related.InvoiceLineFactConsolidate.Level4.Value	= InvoiceLineFactCommodityCode.Segment[4]
				related.InvoiceLineFactConsolidate.Level5.Value	= InvoiceLineFactCommodityCode.Segment[5]
			Instance Selection
				where (related.InvoiceLineFactConsolidate.Level1.Type.CommodityCodeSegment1
				and    related.ConsolidationLevel					= ConsolidationLevel
				and    related.InvoiceLineFactConsolidateControl	= InvoiceLineFactConsolidateControl
				and    related.TotalOnOffSpend	> 0)
				
		ContextProcurementGroupRel
			one-to-one relation to ProcurementGroup
			Field Mapping uses symbolic key
				related.ProcurementGroup		= ProcurementGroup
	
	Sets
		ByCommodityCode
			duplicates
			Sort Order
				ProcurementGroup
				InvoiceLineFactConsolidateControl
				CommodityCode
				
	Actions
		Create is a Create Action
			restricted
		
		Update is an Update Action
			restricted
		
		Delete is a Delete Action
			restricted
		
		Purge is a Purge Action
			restricted
