PersonalUseHistory is a BusinessClass
    owned by am
    prefix is PUH
    classic name is AMPUHIS

    Ontology
        symbolic key is PersonalUseHistory
            classic set name is PUHSET1
            classic name for PersonalUseHistory.YearEndDate is YR-END-DATE

    Patterns
        implements StaticJava
        disable AuditIndex

    Persistent Fields

        PersonalUseCode
            classic name is PERSONAL-USE
        BusinessPercent
            classic name is BUS-PERCENT
        YearlyDepreciationAllowed is an InternationalAmount
            classic name is DEPR-ALLOW-YR
        DepreciationLimit         is an InternationalAmount
            classic name is DEPR-LIMIT
            
	Local Fields		
		LocalBook						is like Book
		LocalAsset						is like Asset
		LocalFinanceEnterpriseGroup		is like FinanceEnterpriseGroup
		
	Relations
		AssetBookPurgeRel
			one-to-many relation to AssetBook
			Field Mapping uses Set2
				related.FinanceEnterpriseGroup		= LocalFinanceEnterpriseGroup
		      	related.Book						= LocalBook
		    Instance Selection
		    	include deleted records
		    	where(related.Asset					= LocalAsset
		    	or LocalAsset not entered)
	
	Actions
		Create is a Create Action
			restricted
		Update is an Update Action
			restricted
		Delete is a Delete Action
			restricted
			
		Purge is a Purge Action
			bypass relational integrity rules
			restricted
		
		PersonalUseHistoryPurge is a Set Action
			restricted
			Parameters
				PrmFinanceEnterpriseGroup		is a FinanceEnterpriseGroup
				PrmAsset						is an Asset
				PrmBook							is a Book
				PrmPurgeOption					is Numeric 1
					default label is "ActionOption"
					States
						PurgeRecords 	value is 1
						ReportOnly		value is 2
				PrmCompany						is like Company
			Parameter Rules
				PrmFinanceEnterpriseGroup
					LocalFinanceEnterpriseGroup 		= PrmFinanceEnterpriseGroup
				PrmBook
					LocalBook 							= PrmBook
				PrmAsset
					LocalAsset = PrmAsset
			Local Fields
				LocalCounter					is Numeric 10
			Instance Selection
				include deleted records
				where(FinanceEnterpriseGroup					= PrmFinanceEnterpriseGroup
				and	  Book										= PrmBook
				and   Asset.Company								= PrmCompany				
				and   (PrmAsset not entered 	or Asset		= PrmAsset))
			Action Rules
				Set Rules
					Exit Rules

				Instance Rules

					if(PrmPurgeOption.PurgeRecords)
						invoke Purge
						
		PurgeDisposedPersonalUseHistory is a Set Action
			restricted
			Parameters
				PrmCompany					is an AssetCompany
				PrmAsset					is an Asset
				PrmFinanceEnterpriseGroup	is like FinanceEnterpriseGroup
				PrmLeaseCompany				is like GeneralLedgerCompany
				PrmLocationName				is like AssetLocation
				PrmDivision					is like AssetDivision
				PrmAssetGroup				is like AssetGroup
				PrmFromDate					is Date
				PrmToDate					is Date
				
			Instance Selection
				include deleted records
				where (Asset.Company = PrmCompany
				and   (PrmAsset not entered or (Asset = PrmAsset and Asset.Company.FinanceEnterpriseGroup = PrmFinanceEnterpriseGroup))
				and   (PrmLeaseCompany not entered or Asset.AssetLease.LeaseCompany = PrmLeaseCompany)
				and   (PrmLocationName not entered or Asset.AssetLocation = PrmLocationName)
				and   (PrmDivision not entered or Asset.AssetDivision = PrmDivision)
				and   (PrmAssetGroup not entered or Asset.AssetGroup = PrmAssetGroup)
				and   (PrmFromDate not entered or Asset.AssetDisposalDate >= PrmFromDate)
				and   (PrmToDate not entered or Asset.AssetDisposalDate <= PrmToDate)
				and   Asset.Status.Disposed)
				
			Action Rules
				Instance Rules
					invoke Purge
