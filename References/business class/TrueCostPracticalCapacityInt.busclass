TrueCostPracticalCapacityInt is a BusinessClass
	owned by truecost
	prefix is TCPCI
	default label is "True\CostPracticalCapacityInterface"
	Ontology
		symbolic key is TrueCostPracticalCapacityInt
			
	Patterns
		disable Auditing
		disable EffectiveDated
		disable AsOfDateProcessing
	
	Persistent Fields
		AccountingEntity	
		Structure												is AlphaUpper 15			
		Department												is AlphaUpper 15
		CostObject 												is AlphaUpper 15
		TrueCostDriver											is Alpha 25
		TrueCostWeight											is Alpha 25
		CapacityVolume											is Unsigned Decimal 19.4
		StartDate												is Date
		ErrorDescription										is Alpha 60
		
	Local Fields
		LocalLastSequence										is Numeric 4
		LocalTrueCostConfiguration								is like TrueCostConfiguration
		LocalRunGroup											is like RunGroup
		LocalAlphaDay											is Alpha 3
		LocalAlphaYear											is Alpha 4
	
	Transient Fields
    	TransientTrueCostDriver				is AlphaUpper 25
			default label is "True\CostDriver"
			derive value from TrueCostDriver
		TransientTrueCostWeight			is AlphaUpper 25
			default label is "True\CostWeight"
			derive value from TrueCostWeight
		
	Derived Fields
		DriverIsNotDefined										is a MessageField
			restricted
			"DriverIsNotDefined"
		DriverIsRequired										is a MessageField
			restricted
			"DriverFieldIsRequired"
		WeightIsNotDefined										is a MessageField
			restricted
			"WeightIsNotDefined"
		PracticalCapacityAlreadyExist							is a MessageField
			restricted
			"PracticalCapacityAlreadyExists"
		DepartmentIsRequired									is a MessageField
			restricted
			"DepartmentFieldIsRequired"
		DepartmentNotDefined									is a MessageField
			restricted
			"DepartmentIsNotDefined"
		CostObjectNotDefined									is a MessageField
			restricted
			"CostObjectIsNotDefinedUnder<Structure>"
		AccountingEntityNotDefined								is a MessageField
			restricted
			"AccountingEntityIsNotDefined"
		CostObjectNotExistObjectMap								is a MessageField
			restricted
			"NoAssociated_True\CostUnutilizedCapacityRecordExists"
		StructureNotDefined										is a MessageField
			restricted
			"StructureNotDefined"
		JulianDate is a DerivedField
			type is AlphaUpper 7
			restricted
			LocalAlphaYear	= StartDate year
			LocalAlphaDay	= StartDate year day
			JulianDate = LocalAlphaYear
			if (LocalAlphaDay size = 2)
				JulianDate += "0"
			JulianDate += LocalAlphaDay
			
	Conditions
		ErrorTransaction
			restricted
			when (ErrorDescription entered)
					
	Field Rules
		TrueCostConfiguration
			required
		AccountingEntity
			required	
				"AccountingEntityFieldIsRequired"
		Structure
			required
				"StructureIsRequired"
		Department
			required
				"DepartmentIsRequired"
		CostObject
			required
				"CostObjectIsRequired"
		TrueCostDriver
			required
				"True\CostDriverIsRequired"
		CapacityVolume
			if (CapacityVolume not entered
			or CapacityVolume  <0)
				constraint (CapacityVolume  > 0)
					"CapacityVolumeIsRequired"
			
		StartDate
			required
			
	Relations
		
		AccountingEntityRel
			one-to-one relation to AccountingEntity
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									=	TrueCostConfiguration	
				related.AccountingEntity										=	AccountingEntity
				
		TrueCostDriverRel
			one-to-many relation to TrueCostDriver
			Field Mapping uses symbolic key
				related.TrueCostConfiguration									=	TrueCostConfiguration	
				related.TrueCostDriver											=	TrueCostDriver
		TrueCostWeightRel
			one-to-many relation to TrueCostWeight
			Field Mapping uses symbolic key
				related.TrueCostConfiguration									= TrueCostConfiguration
				related.TrueCostWeight											= TrueCostWeight		
	
		TrueCostPracticalCapacityRel
			one-to-many relation to TrueCostPracticalCapacity
			Field Mapping uses symbolic key
				related.TrueCostConfiguration									=	TrueCostConfiguration	
				related.AccountingEntity										=	AccountingEntity	
				related.TrueCostPracticalCapacity.TrueCostDriver				=	TrueCostDriver
    			related.TrueCostPracticalCapacity.TrueCostWeight				= 	TrueCostWeight
				related.TrueCostPracticalCapacity.Structure						= 	Structure
				related.TrueCostPracticalCapacity.Department	        		= 	Department				
		        related.TrueCostPracticalCapacity.CostObject		    		= 	CostObject
		    Instance Selection		
    			where (related.TrueCostPracticalCapacity.StartDate			    = 	StartDate)
		
		DepartmentAccountingUnitRel
			one-to-one relation to AccountingUnit
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									=	TrueCostConfiguration	
				related.AccountingEntity										= 	AccountingEntity
				related.AccountingUnit											= 	Department
		
		UnutilizedCapacityObjectMapRel
			one-to-one relation to UnutilizedCapacityCostObject
			Field Mapping uses symbolic key
				related.TrueCostConfiguration									=	TrueCostConfiguration
				related.UnutilizedCapacityCostObject.Structure					= 	Structure
				related.UnutilizedCapacityCostObject.SummaryCostObject			=	CostObject
		

		Dimension1StructureRel
			one-to-many relation to FinanceDimension1Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration
				related.FinanceDimension1Structure								= 	Structure
		Dimension2StructureRel
			one-to-many relation to FinanceDimension2Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration
				related.FinanceDimension2Structure								=	Structure
		Dimension3StructureRel
			one-to-many relation to FinanceDimension3Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									=	TrueCostConfiguration
				related.FinanceDimension3Structure								=	Structure
		Dimension4StructureRel
			one-to-many relation to FinanceDimension4Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration
				related.FinanceDimension4Structure								= 	Structure
		Dimension5StructureRel
			one-to-many relation to FinanceDimension5Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration
				related.FinanceDimension5Structure								= 	Structure
		Dimension6StructureRel
			one-to-many relation to FinanceDimension6Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration
				related.FinanceDimension6Structure								= 	Structure
		Dimension7StructureRel
			one-to-many relation to FinanceDimension7Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration
				related.FinanceDimension7Structure								= 	Structure
		Dimension8StructureRel
			one-to-many relation to FinanceDimension8Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									=	TrueCostConfiguration
				related.FinanceDimension8Structure								= 	Structure
		Dimension9StructureRel
			one-to-many relation to FinanceDimension9Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration
				related.FinanceDimension9Structure								= 	Structure
		Dimension10StructureRel
			one-to-many relation to FinanceDimension10Structure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration
				related.FinanceDimension10Structure								= 	Structure
		
		Department1Rel
			one-to-one relation to FinanceDimension1
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension1 										= 	Department

		Department2Rel
			one-to-one relation to FinanceDimension2
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension2 										= 	Department

		Department3Rel
			one-to-one relation to FinanceDimension3
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension3 										= 	Department

		Department4Rel
			one-to-one relation to FinanceDimension4
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup							 		= 	TrueCostConfiguration	
				related.FinanceDimension4 										= 	Department

		Department5Rel
			one-to-one relation to FinanceDimension5
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup									= 	TrueCostConfiguration	
				related.FinanceDimension5 										= 	Department

		Department6Rel
			one-to-one relation to FinanceDimension6
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension6 										= 	Department

		Department7Rel
			one-to-one relation to FinanceDimension7
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension7 										= 	Department

		Department8Rel
			one-to-one relation to FinanceDimension8
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension8 										= 	Department

		Department9Rel
			one-to-one relation to FinanceDimension9
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension9 										= 	Department

		Department10Rel
			one-to-one relation to FinanceDimension10
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension10 										= 	Department

		CostObject1Rel
			one-to-many relation to FinanceDimension1Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension1Structure 								= 	Dimension1StructureRel.FinanceDimension1Structure
				related.FinanceDimension1 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)

		CostObject2Rel
			one-to-many relation to FinanceDimension2Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration
				related.FinanceDimension2Structure 								= 	Dimension2StructureRel.FinanceDimension2Structure	
				related.FinanceDimension2 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)

		CostObject3Rel
			one-to-many relation to FinanceDimension3Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension3Structure 								= 	Dimension3StructureRel.FinanceDimension3Structure
				related.FinanceDimension3 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)

		CostObject4Rel
			one-to-many relation to FinanceDimension4Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension4Structure 								= 	Dimension4StructureRel.FinanceDimension4Structure
				related.FinanceDimension4 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)

		CostObject5Rel
			one-to-many relation to FinanceDimension5Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration
				related.FinanceDimension5Structure 								= 	Dimension5StructureRel.FinanceDimension5Structure	
				related.FinanceDimension5 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)

		CostObject6Rel
			one-to-many relation to FinanceDimension6Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration
				related.FinanceDimension6Structure 								= 	Dimension6StructureRel.FinanceDimension6Structure	
				related.FinanceDimension6 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)

		CostObject7Rel
			one-to-many relation to FinanceDimension7Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration
				related.FinanceDimension7Structure 								= 	Dimension7StructureRel.FinanceDimension7Structure	
				related.FinanceDimension7 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)
	
		CostObject8Rel
			one-to-many relation to FinanceDimension8Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension8Structure 								= 	Dimension8StructureRel.FinanceDimension8Structure
				related.FinanceDimension8 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)

		CostObject9Rel
			one-to-many relation to FinanceDimension9Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration	
				related.FinanceDimension9Structure 								= 	Dimension9StructureRel.FinanceDimension9Structure
				related.FinanceDimension9 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)

		CostObject10Rel
			one-to-many relation to FinanceDimension10Hierarchy
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 									= 	TrueCostConfiguration
				related.FinanceDimension10Structure 							= 	Dimension10StructureRel.FinanceDimension10Structure	
				related.FinanceDimension10 										= 	CostObject
			Instance Selection
				where (related.DimensionType.Summary)
				
		RunGroupOtherRel
			one-to-many relation to TrueCostPracticalCapacityInt
			Field Mapping uses symbolic key
			Instance Selection
				where(related.TrueCostPracticalCapacityInt.RunGroup 		= 	TrueCostPracticalCapacityInt.RunGroup)
				
		RunGroupParamRel
			one-to-many relation to TrueCostPracticalCapacityInt
			Field Mapping uses symbolic key
				related.TrueCostConfiguration									= 	LocalTrueCostConfiguration
			Instance Selection
				where(related.TrueCostPracticalCapacityInt.RunGroup 		= 	LocalRunGroup)
				
		RunGroupDeleteRel
			one-to-many relation to TrueCostPracticalCapacityInt
			Field Mapping uses symbolic key
			Instance Selection
				where(related.TrueCostPracticalCapacityInt.RunGroup = LocalRunGroup)
				
		CopyRunGroupRel
			one-to-many relation to TrueCostPracticalCapacityInt
			Field Mapping uses symbolic key
				related.TrueCostConfiguration								= LocalTrueCostConfiguration
			Instance Selection
				where(related.TrueCostPracticalCapacityInt.RunGroup = LocalRunGroup)
				
	Rule Blocks
		
	Actions
		Create is a Create Action
			Entrance Rules
				LocalLastSequence = last RunGroupOtherRel.TrueCostPracticalCapacityInt.Sequence
				if(!TrueCostPracticalCapacityInt.Sequence entered)
					TrueCostPracticalCapacityInt.Sequence = (LocalLastSequence + 1)
			Action Rules
				TrueCostDriver	= TransientTrueCostDriver
				TrueCostWeight	= TransientTrueCostWeight
		Update is an Action
			Action Rules
			
		Delete is a Delete Action
			Action Rules
			
		Purge is a Purge Action
			restricted
		
		InterfacePracticalCapacityVolumes is a Set Action
			Parameters
				PrmTrueCostConfiguration		is a TrueCostConfiguration
					default label is "True\CostConfiguration"
				PrmRunGroup						is a RunGroup
					default label is "RunGroup" 
					
			Parameter Rules		
				PrmTrueCostConfiguration
					required					
				PrmRunGroup
					required
						"RunGroup_is_required"
					LocalTrueCostConfiguration	=	PrmTrueCostConfiguration
					LocalRunGroup				=	PrmRunGroup					
					constraint(RunGroupParamRel exists)
						"RunGroup_does_not_exist"
					LocalFirstCount =	instance count of RunGroupParamRel
				
			Instance Selection				
				where(TrueCostConfiguration = PrmTrueCostConfiguration
				and	TrueCostPracticalCapacityInt.RunGroup = PrmRunGroup)		
	
			Local Fields
				LocalFirstCount						is Numeric 10
				LocalFinalCount						is Numeric 10
				LocalActor							is an Actor
									
			Action Rules
				Empty Set Rules
				
				Set Rules
					Entrance Rules
						LocalActor = actor
					
					Exit Rules
						LocalFinalCount =	LocalFirstCount - instance count of RunGroupParamRel					
						send notification
							to LocalActor
							description is "ImportTo_True\Cost_Practical_CapacityHasCompleted"
							priority is high
							detail is "NumberOfSuccessfulRecords<LocalFinalCount>.___NumberOfFailedRecords<instance count of RunGroupParamRel>.___TotalRecordsProcessed<LocalFirstCount>"
					
				
				Instance Rules
					initialize ErrorDescription
					
					if(UnutilizedCapacityObjectMapRel not exist)
						ErrorDescription = CostObjectNotExistObjectMap
						
					if (TrueCostWeightRel not exists )
						ErrorDescription = WeightIsNotDefined
					
					if(TrueCostDriverRel not exists )
						ErrorDescription = DriverIsNotDefined
					
					if (CostObject entered )
						if((TrueCostConfiguration.CostObjectIsDimension1
						and CostObject1Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension2
						and CostObject2Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension3
						and CostObject3Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension4
						and CostObject4Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension5
						and CostObject5Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension6
						and CostObject6Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension7
						and CostObject7Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension8
						and CostObject8Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension9
						and CostObject9Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension10
						and CostObject10Rel not exists))
							ErrorDescription = CostObjectNotDefined			
					
					if (Department entered )			
						if((TrueCostConfiguration.DepartmentIsAccountingUnit
						and DepartmentAccountingUnitRel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension1
						and Department1Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension2
						and Department2Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension3
						and Department3Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension4
						and Department4Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension5
						and Department5Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension6
						and Department6Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension7
						and Department7Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension8
						and Department8Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension9
						and Department9Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension10
						and Department10Rel not exists))
							ErrorDescription = DepartmentNotDefined
					
					if (Structure entered )
						if((TrueCostConfiguration.CostObjectIsDimension1
						and Dimension1StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension2
						and Dimension2StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension3
						and Dimension3StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension4
						and Dimension4StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension5
						and Dimension5StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension6
						and Dimension6StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension7
						and Dimension7StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension8
						and Dimension8StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension9
						and Dimension9StructureRel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension10
						and Dimension10StructureRel not exists))
							ErrorDescription = StructureNotDefined		
						
					if(AccountingEntityRel not exists)
						ErrorDescription = AccountingEntityNotDefined
										
					if(TrueCostPracticalCapacityRel exists)
						ErrorDescription = PracticalCapacityAlreadyExist
						
					if (!ErrorDescription entered)
						invoke Create TrueCostPracticalCapacity
							resume on error
								ErrorDescription = error message
							invoked.TrueCostConfiguration   							= TrueCostConfiguration
							invoked.AccountingEntity        							= AccountingEntity
							invoked.TrueCostPracticalCapacity.Structure					= Structure
							invoked.TrueCostPracticalCapacity.TrueCostDriver          	= TrueCostDriver
							invoked.TrueCostPracticalCapacity.TrueCostWeight          	= TrueCostWeight
							invoked.TrueCostPracticalCapacity.Department              	= Department
							invoked.TrueCostPracticalCapacity.CostObject              	= CostObject
							invoked.TrueCostPracticalCapacity.StartDate               	= StartDate
							invoked.CapacityVolume          							= CapacityVolume
							
					if (!ErrorDescription entered)
						invoke Delete

		DeleteAllTransactionsForRunGroup is a Set Action
			default label is "DeleteAllTransactionsForRunGroup"
			Parameters
				PrmRunGroup						is a RunGroup
					default label is "RunGroup"
			Parameter Rules
				PrmRunGroup
					required
						"Run_GroupIsRequired"
					LocalRunGroup		=	PrmRunGroup				
					constraint(RunGroupDeleteRel exists)
						"Run_GroupDoesNotExist"
			Instance Selection				
				where(TrueCostPracticalCapacityInt.RunGroup = PrmRunGroup)
			
			Action Rules
				Instance Rules
					invoke Delete
					
		CopyRunGroup					is a Set Action
			default label is "CopyRunGroup"
			
			Parameters
				PrmTCConfig				is a TrueCostConfiguration
					default label is "True\CostConfiguration"
				PrmRunGroupFrom			is a RunGroup
					default label is "Copy_from_RunGroup"
				PrmRunGroupTo			is a RunGroup
					default label is "Copy_to_RunGroup"
					
			Parameter Rules
				PrmTCConfig
					required
				PrmRunGroupFrom
					required
					LocalTrueCostConfiguration = PrmTCConfig
					LocalRunGroup = PrmRunGroupFrom
					constraint (CopyRunGroupRel exists)
						"Source_Run_Group_does_not_exist"
					constraint (PrmRunGroupFrom != PrmRunGroupTo)
						"CopyFrom_Run_GroupCannotBeTheSameAsCopyTo_Run_Group"
				PrmRunGroupTo
					required
					
			Instance Selection
				where (TrueCostConfiguration = PrmTCConfig
				and TrueCostPracticalCapacityInt.RunGroup = PrmRunGroupFrom)
				
			Action Rules
				
				Instance Rules
					invoke Create TrueCostPracticalCapacityInt
						fill in fields from this instance
							except invoked.RunGroup
						invoked.RunGroup				= PrmRunGroupTo
