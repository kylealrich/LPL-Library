TrueCostResourceUnitCostDetails is a BusinessClass
	default label is "UnitCost"
	owned by truecost
	sql name is TrueCostRUCDT
	prefix is TCUCD
	
	Ontology
		symbolic key is TrueCostResourceUnitCostDetails
		
	
	Patterns
	
	Persistent Fields
		AccountingEntity
			default label is "<TrueCostConfiguration.AccountingEntityLabel>"
		AccountingUnit
			default label is "<TrueCostConfiguration.AccountingUnitLabel>"
		GeneralLedgerChartAccount
			restricted
		Project
			default label is "<TrueCostConfiguration.ProjectLabel>"
		FinanceDimension1
			default label is "<TrueCostConfiguration.FinanceDimension1Label>"
		FinanceDimension2
			default label is "<TrueCostConfiguration.FinanceDimension2Label>"
		FinanceDimension3
			default label is "<TrueCostConfiguration.FinanceDimension3Label>"
		FinanceDimension4
			default label is "<TrueCostConfiguration.FinanceDimension4Label>"
		FinanceDimension5
			default label is "<TrueCostConfiguration.FinanceDimension5Label>"
		FinanceDimension6
			default label is "<TrueCostConfiguration.FinanceDimension6Label>"
		FinanceDimension7
			default label is "<TrueCostConfiguration.FinanceDimension7Label>"
		FinanceDimension8
			default label is "<TrueCostConfiguration.FinanceDimension8Label>"
		FinanceDimension9
			default label is "<TrueCostConfiguration.FinanceDimension9Label>"
		FinanceDimension10
			default label is "<TrueCostConfiguration.FinanceDimension10Label>"
		AllocatedCost				is an InternationalAmount
		DirectCost					is an InternationalAmount
		TotalCost					is an InternationalAmount
		Volume						is an InternationalAmount
		UnitCost					is an InternationalAmount
	
	Field Rules
	
	Conditions
		IsMissingVolume
			restricted
			when(Volume not entered)
			
		IsNegativeUnitCost
			restricted
			when(UnitCost < 0 )
		
	Derived Fields
		
		ErrorMessageMissingVolume is a MessageField
			restricted
			"CostDriverVolumeIs0"
		
		ErrorMessageIsNegativeUnitCost is a MessageField
			restricted
			"UnitCostIsNegative"
		
		DerivedErrorMessage is a DerivedField
			type is MessageField
			if(IsMissingVolume)
				return ErrorMessageMissingVolume
			else
			if(IsNegativeUnitCost)
				return ErrorMessageIsNegativeUnitCost
		
	Actions
		Create is a Create Action
			restricted
			Action Rules
		Update is an Update Action
			restricted
			Action Rules
		Delete is a Delete Action
			restricted
		
		Purge is a Purge Action
			restricted
		
		ComputeTotalCost is a Set Action
			restricted
			Parameters
				PrmTrueCostConfiguration 						is a TrueCostConfiguration
				PrmTrueCostAllocationRun		 				is an AllocationRun
				PrmTrueCostResourceUtilizationDriver			is a TrueCostResourceUtilizationDriver
			
			Instance Selection
				where(TrueCostResourceUnitCost.AllocationRun 						= PrmTrueCostAllocationRun
				and   TrueCostResourceUnitCost.TrueCostResourceUtilizationDriver 	= PrmTrueCostResourceUtilizationDriver)
			Local Fields
				LocalWarningCount	is Numeric 6
				LocalResourceUnitCost is a TrueCostResourceUnitCost
			Action Rules
				Set Rules
					Entrance Rules
						LocalResourceUnitCost		= TrueCostResourceUnitCost
					Exit Rules
						increment LocalResourceUnitCost.WarningCount by LocalWarningCount
				Instance Rules
					TotalCost = AllocatedCost + DirectCost	
					UnitCost = TotalCost / Volume
					
					if(IsMissingVolume or IsNegativeUnitCost)
						LocalWarningCount += 1
						
		PurgeDetails is a Set Action
			restricted
			Parameters
				PrmTrueCostConfiguration 				is a TrueCostConfiguration
				PrmTrueCostAllocationRun				is a AllocationRun
				PrmTrueCostResourceUtilizationDriver	is a TrueCostResourceUtilizationDriver
			Parameter Rules
			Instance Selection
				where(TrueCostConfiguration				= PrmTrueCostConfiguration
				and   AllocationRun						= PrmTrueCostAllocationRun
				and	  TrueCostResourceUtilizationDriver	= PrmTrueCostResourceUtilizationDriver)
			Action Rules
				Instance Rules
					invoke Purge
					
					
