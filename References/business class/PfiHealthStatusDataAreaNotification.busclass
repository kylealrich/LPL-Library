PfiHealthStatusDataAreaNotification is a BusinessClass
    default label is "HealthStatusDataAreaNotification"
    owned by pfi
    prefix is HSDN
    store using com.lawson.rdtech.framework.pfi.HealthStatusDataAreaNotificationStorage

    Ontology
        symbolic key is PfiHealthStatusDataAreaNotification
        
    Patterns
        disable AsOfDateProcessing
        disable Auditing
        disable EffectiveDated
        disable UniqueID

    Persistent Fields
        Time is Numeric size 6
        Threshold is Numeric size 6
        Email is Alpha size 1000
        Select is Boolean
           
    Derived Fields
    
        RecordCount is a DerivedField
            type is Numeric size 12
            if (PfiHealthStatusDataAreaNotification.Status.NotReady)
                return NotReadyCount
            else
            if (PfiHealthStatusDataAreaNotification.Status.Ready)
                return ReadyCount
            else
            if (PfiHealthStatusDataAreaNotification.Status.Processing)
                return ProcessingCount
            else
            if (PfiHealthStatusDataAreaNotification.Status.Canceling)
                return CancelingCount
            else
            if (PfiHealthStatusDataAreaNotification.Status.Failed)
                return FailedCount
            else
            if (PfiHealthStatusDataAreaNotification.Status.ActionPendingInServer)
                return ActionPendingInServerCount
            else
            if (PfiHealthStatusDataAreaNotification.Status.WaitingOnUserAction)
                return WaitingOnUserActionCount
            return 0
                   
        ReadyCount is a DerivedField
            type is Numeric size 12
            if (ReadyRel.exists)
                return instance count of ReadyRel
            return 0
            
        ProcessingCount is a DerivedField
            type is Numeric size 12
            if (ProcessingRel.exists)
                return instance count of ProcessingRel
            return 0
            
        CancelingCount is a DerivedField
            type is Numeric size 12
            if (CancelingRel.exists)
                return instance count of CancelingRel
            return 0
            
        FailedCount is a DerivedField
            type is Numeric size 12
            if (FailedRel.exists)
                return instance count of FailedRel
            return 0    
       
        NotReadyCount is a DerivedField
            type is Numeric size 12
            if (NotReadyRel.exists)
                return instance count of NotReadyRel
            return 0
        
        ActionPendingInServerCount is a DerivedField
            type is Numeric size 12
            if (ActionPendingInServerRel.exists)
                return instance count of ActionPendingInServerRel
            return 0
              
        WaitingOnUserActionCount is a DerivedField
            type is Numeric size 12
            if (WaitingOnUserActionRel.exists)
                return instance count of WaitingOnUserActionRel
            return 0               
    Field Rules
        Time
            default to 0
            initial value is 0
            
        Threshold
            default to 0
            initial value is 0
    
    Relations

        NotReadyRel
            one-to-many relation to PfiWorkunit
            Field Mapping uses ByStatusWorkunitLive
                related.Status = PfiHealthStatusDataAreaNotification.Status.NotReady
            Instance Selection
                where (Select and related.ElapsedTime > Time * 60 )
        ReadyRel
            one-to-many relation to PfiWorkunit
            Field Mapping uses ByStatusWorkunitLive
                related.Status = PfiHealthStatusDataAreaNotification.Status.Ready
            Instance Selection
                where (Select and related.ElapsedTime > Time * 60 )
                
        ProcessingRel
            one-to-many relation to PfiWorkunit
            Field Mapping uses ByStatusWorkunitLive
                related.Status = PfiHealthStatusDataAreaNotification.Status.Processing
            Instance Selection
                where (Select and related.IsActionPending = false and related.IsActionPendingInServer = false and related.ElapsedTime > Time * 60 )

        CancelingRel
            one-to-many relation to PfiWorkunit
            Field Mapping uses ByStatusWorkunitLive
                related.Status = PfiHealthStatusDataAreaNotification.Status.Canceling
            Instance Selection
                where (Select and related.CancelingElapsedTime > Time * 60 )
                                        
        FailedRel
            one-to-many relation to PfiWorkunit
            Field Mapping uses ByStatusWorkunitLive
                related.Status = PfiHealthStatusDataAreaNotification.Status.Failed   
            Instance Selection
                where (Select)
                
        ActionPendingInServerRel
            one-to-many relation to PfiWorkunit
            Field Mapping uses ByStatusWorkunitLive
                related.Status = PfiHealthStatusDataAreaNotification.Status.Processing
            Instance Selection
                where (Select and related.IsActionPendingInServer = true and related.ActionPendingInServerElapsedTime > Time * 60)
                    
        WaitingOnUserActionRel
            one-to-many relation to PfiWorkunit
            Field Mapping uses ByStatusWorkunitLive
                related.Status = PfiHealthStatusDataAreaNotification.Status.Processing
            Instance Selection
                where (Select and related.IsActionPending = true and related.UAActivityElapsedTime > Time * 60 ) 
                
            
