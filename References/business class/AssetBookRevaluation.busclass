AssetBookRevaluation is a BusinessClass
    owned by am
    prefix is BRV
    classic name is AMASTBKRVL

    Ontology
        symbolic key is AssetBookRevaluation
            classic set name is BRVSET1
            classic name is PROCESS-SEQ

    Patterns
        implements StaticJava
        disable AuditIndex

    Persistent Fields

        Active                              	is AlphaUpper size 1
            classic name is BOOK-STATUS
        Currency
            classic name is CURRENCY-CODE
        TransactionNumberOfDecimals         	is a CurrencyNumberOfDecimals
            classic name is TRAN-ND
        Life
        LifeRemaining
            classic name is LIFE-REM
        Basis                               	is an InternationalAmount
            classic name is BOOK-BASIS
        RevalueBookBasis                        is an InternationalAmount
        AssetType                     
        RevalueStatus                           is AlphaUpper size 1
        RevalueDate                             is TimeStamp
        Operator                         		is an Actor
        RevaluedLifeToDateAmount            	is an InternationalAmount
        RevalueMethod                       	is AlphaUpper size 1
        Method
        DepreciationMethodSwitched          	is Boolean
            classic name is METH-SWITCHED
        InServiceDate                       	is Date
            classic name is INSRV-DATE
        MethTableYr                         	is a Year
        	default label is "Year"
        DepreciationStartDate               	is Date
            classic name is DEPR-STARTDATE
        LifeInYears
            classic name is LIFE-YEARS
        CurrentPeriodDepreciationCalculated 	is Boolean
            sql name is CPeriodDepreciationCalculated
            classic name is STATUS-CP-CALC
        CurrentPeriodDepreciation           	is an InternationalAmount
            classic name is DEPR-CP
        CurrentPeriodDepreciationAllowed    	is an InternationalAmount
            sql name is CPeriodDepreciationAllowed
            classic name is DEPR-CP-ALLOW
        YearToDateDepreciation              	is an InternationalAmount
            classic name is DEPR-YTD
        YearToDateDepreciationAllowed       	is an InternationalAmount
            classic name is DEPR-YTD-ALLOW
        YearToDateDepreciationOverride      	is an InternationalAmount
            classic name is DEPR-YTD-OVRRD
        LifeToDateDepreciation              	is an InternationalAmount
            classic name is DEPR-LTD
        LifeToDateDepreciationAllowed       	is an InternationalAmount
            classic name is DEPR-LTD-ALLOW
        LastClosedPeriodBalance             	is an InternationalAmount
            classic name is LAST-CLOSE
        FirstLastFl                         	is AlphaUpper size 1
        YearToDateInactiveMonths
            classic name is INACT-YTD
        LifeToDateInactiveMonths
            classic name is INACT-LTD
        SalvageValue                        	is an InternationalAmount
        BusinessPercent
            classic name is BUS-PERCENT
        PersonalUseCode
            classic name is PERSONAL-USE
        FirstYearExpenseAmount              	is an InternationalAmount
            classic name is YR1-EXP
        AssetTaxCreditTable
            classic name is TC-TABLE
        TaxCreditPropertyAmount             	is an InternationalAmount
            classic name is TC-PROPERTY
        TaxCredit                           	is an InternationalAmount
        InsuranceCalculationMethod          	is a Method
            classic name is INS-METHOD
        ActualInsuranceValue                	is an InternationalAmount
            classic name is INS-ACT-VAL
        CalculatedInsuranceValue            	is an InternationalAmount
            classic name is INS-CMPTD-VAL
        ReplacementCalculationMethod        	is a Method
            classic name is RPL-METHOD
        CalculatedReplacementValue          	is an InternationalAmount
            classic name is RPL-CMPTD-VAL
        AssetTagNumber                      	is a TagNumber
            classic name is AST-TAG-NBR
        RevalueAmount                           is an InternationalAmount
        Company                             	is a GeneralLedgerCompany
        RevalueDepreciationYearToDate			is an InternationalAmount
        RevalueDepreciationLifeToDate           is an InternationalAmount
        AssetDivision
            classic name is DIVISION
        AssetLocation
            classic name is LOCATION-NAME
        RevaluePercent                          is a Percent
        PostingDate								is Date

	Transient Fields	
		TransientPercentSign            		is AlphaUpper size 1
            States
                Increase value is "+"
                Decrease value is "-"
        RevaluationDate                       	is Date
    
    Local Fields
    	LocalRevaluationAmount					is an InternationalAmount
    	LocalTransactionAmount					is an InternationalAmount
    	DepreciationAmount						is an InternationalAmount
    	LocalDepreciationLTD					is an InternationalAmount
    	LocalRevalueLTD							is an InternationalAmount
    	LocalProportionateAmt					is Decimal size 31.15
		LocalAmt								is an InternationalAmount
	
	Derived Fields
		RevaluationMethod is a DerivedField
            type is Alpha 25
            default label is "RevalueMethod"
            if (RevalueMethod = "P") 
            	return "Proportionate"
            else
            	return "Elimination" 
        RevaluationStatus is a DerivedField
        	type is Alpha 25
        	default label is "RevalueStatus"
        	if (RevalueStatus = "U")
        		return "Unreleased"
        	else
        		return "Released"

		DerivedRoundTo is a DerivedField
    		type is Decimal 5.3
    		restricted
    		if (TransactionNumberOfDecimals = 2)
    			return .01
    		else
    		if (TransactionNumberOfDecimals = 0)
    			return 1
    		else
    		if (TransactionNumberOfDecimals = 3)
    			return .001
	
	Conditions
		IsRevaluePercent
			when (RevaluePercent entered)
		
		IsRevalueAmount
			when (RevalueAmount entered)
			
    Sets















	
	
	
	Relations
		AssetBookRel
			one-to-one relation to AssetBook
			Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
                related.Asset 					= Asset  
                related.Book					= Book
		AssetRel
			one-to-one relation to Asset
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
                related.Asset 					= Asset  
        
        BookCalendarCurrentRel
        	one-to-many relation to BookCalendar
        	Field Mapping uses Set4
        		related.Company					= Company
        		related.Book					= Book
			Instance Selection
				where (related.BookCalendar.CalendarStatus = "C")
		
		AssetRevalueTransactionRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.Asset					= Asset
			Instance Selection
				where (related.ProcessSequence	= Asset.LastAssetSequence
				and (related.AssetProcess.Revalue
				or related.AssetProcess.RevalueAmortization))
	
		RevalueTransactionRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.Asset					= Asset
			Instance Selection
				where (related.ProcessSequence	= Asset.LastAssetSequence
				and related.TransactionStatus.Unreleased
				and (related.AssetAccountType.RevalueLoss
				or related.AssetAccountType.RevalueSurplus))
		
		AssetRevalueBookTransactionRel
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.Asset					= Asset
			Instance Selection
				where (related.ProcessSequence	= Asset.LastAssetSequence
				and (related.AssetProcess.Revalue
				or related.AssetProcess.RevalueAmortization))
		
		RevalueBookTransactionRel
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.Asset					= Asset
			Instance Selection
				where (related.ProcessSequence	= Asset.LastAssetSequence
				and related.TransactionStatus.Unreleased
				and (related.AssetAccountType.RevalueLoss
				or related.AssetAccountType.RevalueSurplus))
				
		CompanySystemClosingControlRel
			one-to-one relation to CompanySystemClosingControl
			Field Mapping uses BySystemCode
				related.GeneralLedgerSystemCode		= "AM"
				related.Company						= Asset.Company		
		
	Rule Blocks
			
		CalculateRevalueAmount
			LocalDepreciationLTD = AssetBookRel.LifeToDateDepreciation
			LocalRevalueLTD = AssetBookRel.RvlLtd
			if (RevalueAmount entered)
				LocalRevaluationAmount = RevalueAmount
			else
			if (RevaluePercent entered)
				LocalRevaluationAmount = ((Basis - LifeToDateDepreciation) * RevaluePercent)
			round LocalRevaluationAmount to nearest DerivedRoundTo
			if (RevalueMethod = "E")
				if (TransientPercentSign.Increase)
					invoke BalanceUpdate AssetBookRel
						initialize invoked.YearToDateDepreciation
						initialize invoked.LifeToDateDepreciation
						invoked.Basis = ((Basis - LifeToDateDepreciation) + LocalRevaluationAmount)
						invoked.RvlLtd -= LocalRevaluationAmount
				else
					LocalRevaluationAmount = LocalRevaluationAmount * -1
					invoke BalanceUpdate AssetBookRel
						initialize invoked.YearToDateDepreciation
						initialize invoked.LifeToDateDepreciation
						invoked.Basis = (Basis + LocalRevaluationAmount) 
						invoked.RvlLtd -= LocalRevaluationAmount
			if (RevalueMethod = "P"
			and Asset.AssetType.PostToAccount.Asset)
				if (TransientPercentSign.Increase)
					LocalProportionateAmt = ((AssetBookRel.BookValue + LocalRevaluationAmount)/ AssetBookRel.BookValue)
				else
					LocalProportionateAmt = ((AssetBookRel.BookValue - LocalRevaluationAmount)/ AssetBookRel.BookValue)
				invoke BalanceUpdate AssetBookRel
					LocalAmt 	= (AssetBookRel.Basis * LocalProportionateAmt)
					round LocalAmt to nearest DerivedRoundTo
					invoked.Basis = LocalAmt
				
		RevalueElimination		
			if (LocalDepreciationLTD entered)
				if (BookCalendarCurrentRel.IsPostingBook)
					invoke Create AssetTransaction
						LocalTransactionAmount = LocalDepreciationLTD * -1
						include CreateAssetTransaction
						invoked.AssetAccountType			= "AST"
						invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
					invoke Create AssetTransaction
						LocalTransactionAmount = LocalDepreciationLTD
						include CreateAssetTransaction
						invoked.AssetAccountType			= "ACM"
						invoked.DistributionAccount			= AssetBookRel.TranAccumulatedDepreciationAccount
				else
					invoke Create AssetBookTransaction
						LocalTransactionAmount = LocalDepreciationLTD * -1
						include CreateAssetBookTransaction
						invoked.AssetAccountType			= "AST"
						invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
					invoke Create AssetBookTransaction
						LocalTransactionAmount = LocalDepreciationLTD
						include CreateAssetBookTransaction
						invoked.AssetAccountType			= "ACM"
						invoked.DistributionAccount			= AssetBookRel.TranAccumulatedDepreciationAccount
			if (LocalRevalueLTD not entered)
				if (BookCalendarCurrentRel.IsPostingBook)
					if (LocalRevaluationAmount < 0)
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount * -1
							include CreateAssetTransaction
							invoked.AssetAccountType			= "RVL"
							invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
					else
					if (LocalRevaluationAmount > 0)
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount * -1
							include CreateAssetTransaction
							invoked.AssetAccountType			= "RVS"
							invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
				else
					if (LocalRevaluationAmount < 0)
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount * -1
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "RVL"
							invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
					else
					if (LocalRevaluationAmount > 0)
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount * -1
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "RVS"
							invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
			else
			if (LocalRevalueLTD < 0)	
				if (BookCalendarCurrentRel.IsPostingBook)
					if (LocalRevaluationAmount < 0)
						if (LocalRevalueLTD entered)
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevalueLTD * -1
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVS"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
						LocalTransactionAmount = ((LocalRevaluationAmount - LocalRevalueLTD) * -1)
						if (LocalTransactionAmount entered)
							invoke Create AssetTransaction
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
					else
					if (LocalRevaluationAmount > 0)
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
							
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount * -1
							include CreateAssetTransaction
							invoked.AssetAccountType			= "RVS"
							invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
				else
					if (LocalRevaluationAmount < 0)
						if (LocalRevalueLTD entered)
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevalueLTD * -1
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVS"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
						LocalTransactionAmount = ((LocalRevaluationAmount - LocalRevalueLTD) * -1)
						if (LocalTransactionAmount entered)
							invoke Create AssetBookTransaction
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
					else
					if (LocalRevaluationAmount > 0)
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
							
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount * -1
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "RVS"
							invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
			else
			if (LocalRevalueLTD > 0)
				if (BookCalendarCurrentRel.IsPostingBook)
					if (LocalRevaluationAmount < 0)
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
						invoke Create AssetTransaction
							LocalTransactionAmount = (LocalRevaluationAmount * -1)
							include CreateAssetTransaction
							invoked.AssetAccountType			= "RVL"
							invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
					else
					if (LocalRevaluationAmount > 0)
						invoke Create AssetTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
						LocalTransactionAmount = ((LocalRevaluationAmount - LocalRevalueLTD) * -1)
						if (LocalTransactionAmount entered)
							invoke Create AssetTransaction
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVS"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
						if (LocalRevalueLTD entered)
							invoke Create AssetTransaction
								LocalTransactionAmount = (LocalRevalueLTD * -1)
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
				else
					if (LocalRevaluationAmount < 0)
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
						invoke Create AssetBookTransaction
							LocalTransactionAmount = (LocalRevaluationAmount * -1)
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "RVL"
							invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
					else
					if (LocalRevaluationAmount > 0)
						invoke Create AssetBookTransaction
							LocalTransactionAmount = LocalRevaluationAmount
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "AST"
							invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
						LocalTransactionAmount = ((LocalRevaluationAmount - LocalRevalueLTD) * -1)
						if (LocalTransactionAmount entered)
							invoke Create AssetBookTransaction
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVS"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
						if (LocalRevalueLTD entered)
							invoke Create AssetBookTransaction
								LocalTransactionAmount = (LocalRevalueLTD * -1)
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
								
		RevalueProportionate	
			if (AssetBookRel.LifeToDateDepreciation entered
			and AssetType.PostToAccount.Asset)
				if (AssetBookRel.LifeToDateDepreciation entered)
					LocalTransactionAmount = AssetBookRel.LifeToDateDepreciation - (AssetBookRel.LifeToDateDepreciation * LocalProportionateAmt)
					round LocalTransactionAmount to nearest DerivedRoundTo
					if (TransientPercentSign.Decrease)
						LocalTransactionAmount = LocalTransactionAmount * -1
				if (LocalTransactionAmount entered)
					if (BookCalendarCurrentRel.IsPostingBook)
						invoke Create AssetTransaction
							include CreateAssetTransaction
							invoked.AssetAccountType			= "ACM"
							invoked.DistributionAccount			= AssetBookRel.TranAccumulatedDepreciationAccount
					else
						invoke Create AssetBookTransaction
							include CreateAssetBookTransaction
							invoked.AssetAccountType			= "ACM"
							invoked.DistributionAccount			= AssetBookRel.TranAccumulatedDepreciationAccount
				if (TransientPercentSign.Increase)
					LocalTransactionAmount = LocalTransactionAmount * -1


				DepreciationAmount = LocalTransactionAmount
			if (AssetBookRel.RvlLtd not entered)
				if (TransientPercentSign.Increase)
					invoke BalanceUpdate AssetBookRel
						invoked.LifeToDateDepreciation += LocalTransactionAmount
						invoked.RvlLtd = LocalRevaluationAmount * -1
				else
					invoke BalanceUpdate AssetBookRel
						invoked.LifeToDateDepreciation += LocalTransactionAmount
						invoked.RvlLtd = LocalRevaluationAmount
			else
				if (AssetBookRel.RvlLtd > 0)
					if (TransientPercentSign.Increase)
						invoke BalanceUpdate AssetBookRel
							invoked.LifeToDateDepreciation += LocalTransactionAmount
							invoked.RvlLtd -= LocalRevaluationAmount
					else
						invoke BalanceUpdate AssetBookRel
							invoked.LifeToDateDepreciation += LocalTransactionAmount
							invoked.RvlLtd += LocalRevaluationAmount
				else
					if (AssetBookRel.RvlLtd < 0)
						if (TransientPercentSign.Increase)
							invoke BalanceUpdate AssetBookRel
								invoked.LifeToDateDepreciation += LocalTransactionAmount
								invoked.RvlLtd += (LocalRevaluationAmount * -1)
						else
							invoke BalanceUpdate AssetBookRel
								invoked.LifeToDateDepreciation += LocalTransactionAmount
								invoked.RvlLtd -= (LocalRevaluationAmount * -1)
			if (LocalRevalueLTD not entered)
				if (LocalRevaluationAmount entered)
					if (BookCalendarCurrentRel.IsPostingBook)
						if (TransientPercentSign.Increase)
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevaluationAmount * -1
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVS"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevaluationAmount + DepreciationAmount
								include CreateAssetTransaction
								if (AssetType.PostToAccount.Asset)
									invoked.AssetAccountType			= "AST"
									invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
								else
									invoked.AssetAccountType			= "RRA"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
						else
							LocalTransactionAmount = ((LocalRevaluationAmount + DepreciationAmount) * -1)
							if (LocalTransactionAmount entered)
								invoke Create AssetTransaction
									include CreateAssetTransaction
									if (AssetType.PostToAccount.Asset)
										invoked.AssetAccountType			= "AST"
										invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
									else
										invoked.AssetAccountType			= "RRA"
										invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevaluationAmount
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
					else
						if (TransientPercentSign.Increase)
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevaluationAmount * -1
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVS"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevaluationAmount + DepreciationAmount
								include CreateAssetBookTransaction
								if (AssetType.PostToAccount.Asset)
									invoked.AssetAccountType			= "AST"
									invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
								else
									invoked.AssetAccountType			= "RRA"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
						else
							LocalTransactionAmount = ((LocalRevaluationAmount + DepreciationAmount) * -1)
							if (LocalTransactionAmount entered)
								invoke Create AssetBookTransaction
									include CreateAssetBookTransaction
									if (AssetType.PostToAccount.Asset)
										invoked.AssetAccountType			= "AST"
										invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
									else
										invoked.AssetAccountType			= "RRA"
										invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevaluationAmount
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
			if (LocalRevalueLTD < 0)
				if (LocalRevaluationAmount entered)
					if (BookCalendarCurrentRel.IsPostingBook)
						if (TransientPercentSign.Increase)
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevaluationAmount + DepreciationAmount
								include CreateAssetTransaction
								if (AssetType.PostToAccount.Asset)
									invoked.AssetAccountType			= "AST"
									invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
								else
									invoked.AssetAccountType			= "RRA"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevaluationAmount * -1
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVS"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
						else
							LocalTransactionAmount = ((LocalRevaluationAmount + DepreciationAmount) * -1)
							if (LocalTransactionAmount entered)
								invoke Create AssetTransaction
									include CreateAssetTransaction
									if (AssetType.PostToAccount.Asset)
										invoked.AssetAccountType			= "AST"
										invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
									else
										invoked.AssetAccountType			= "RRA"
										invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							if (LocalRevalueLTD > LocalRevaluationAmount)
								invoke Create AssetTransaction
									LocalTransactionAmount = LocalRevaluationAmount * -1
									include CreateAssetTransaction
									invoked.AssetAccountType			= "RVS"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
							else
								invoke Create AssetTransaction
									LocalTransactionAmount = LocalRevaluationAmount
									include CreateAssetTransaction
									invoked.AssetAccountType			= "RVS"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
					else
						if (TransientPercentSign.Increase)
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevaluationAmount + DepreciationAmount
								include CreateAssetBookTransaction
								if (AssetType.PostToAccount.Asset)
									invoked.AssetAccountType			= "AST"
									invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
								else
									invoked.AssetAccountType			= "RRA"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevaluationAmount * -1
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVS"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
						else
							LocalTransactionAmount = ((LocalRevaluationAmount + DepreciationAmount) * -1)
							if (LocalTransactionAmount entered)
								invoke Create AssetBookTransaction
									include CreateAssetBookTransaction
									if (AssetType.PostToAccount.Asset)
										invoked.AssetAccountType			= "AST"
										invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
									else
										invoked.AssetAccountType			= "RRA"
										invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							if (AssetBookRel.RvlLtd > LocalRevaluationAmount)
								invoke Create AssetBookTransaction
									LocalTransactionAmount = LocalRevaluationAmount * -1
									include CreateAssetBookTransaction
									invoked.AssetAccountType			= "RVS"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
							else
								invoke Create AssetBookTransaction
									LocalTransactionAmount = LocalRevaluationAmount
									include CreateAssetBookTransaction
									invoked.AssetAccountType			= "RVS"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueSurplus
			if (LocalRevalueLTD > 0)
				if (LocalRevaluationAmount entered)
					if (BookCalendarCurrentRel.IsPostingBook)
						if (TransientPercentSign.Increase)
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevaluationAmount + DepreciationAmount
								include CreateAssetTransaction
								if (AssetType.PostToAccount.Asset)
									invoked.AssetAccountType			= "AST"
									invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
								else
									invoked.AssetAccountType			= "RRA"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevaluationAmount * -1
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
						else
							invoke Create AssetTransaction
								LocalTransactionAmount = ((LocalRevaluationAmount + DepreciationAmount) * -1)
								include CreateAssetTransaction
								if (AssetType.PostToAccount.Asset)
									invoked.AssetAccountType			= "AST"
									invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
								else
									invoked.AssetAccountType			= "RRA"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							invoke Create AssetTransaction
								LocalTransactionAmount = LocalRevaluationAmount
								include CreateAssetTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss

					else
						if (TransientPercentSign.Increase)
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevaluationAmount + DepreciationAmount
								include CreateAssetBookTransaction
								if (AssetType.PostToAccount.Asset)
									invoked.AssetAccountType			= "AST"
									invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
								else
									invoked.AssetAccountType			= "RRA"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevaluationAmount * -1
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
						else
							invoke Create AssetBookTransaction
								LocalTransactionAmount = ((LocalRevaluationAmount + DepreciationAmount) * -1)
								include CreateAssetBookTransaction
								if (AssetType.PostToAccount.Asset)
									invoked.AssetAccountType			= "AST"
									invoked.DistributionAccount			= AssetBookRel.TranAssetAccount
								else
									invoked.AssetAccountType			= "RRA"
									invoked.DistributionAccount			= AssetBookRel.TranRevalueReserve
							invoke Create AssetBookTransaction
								LocalTransactionAmount = LocalRevaluationAmount
								include CreateAssetBookTransaction
								invoked.AssetAccountType			= "RVL"
								invoked.DistributionAccount			= AssetBookRel.TranRevalueLoss
					
					
		CreateAssetBookTransaction
			invoked.FinanceEnterpriseGroup		= Asset.FinanceEnterpriseGroup
			invoked.ProcessSequence				= Asset.LastAssetSequence
			invoked.Asset						= Asset
			invoked.Company						= Asset.Company
			invoked.Book						= Book
			invoked.TransactionDate				= RevaluationDate
			if (PostingDate entered)
				invoked.PostingDate				= PostingDate
			else
				invoked.PostingDate				= RevaluationDate
			invoked.Reference					= "AssetRevalue"+ " " + Asset
			invoked.TransactionStatus			= "U"
			invoked.AssetProcess				= "RVL"
			invoked.TransactionNumberOfDecimals	= AssetBookRel.TransactionNumberOfDecimals
			invoked.TransactionAmount			= LocalTransactionAmount
			invoked.TransientBookCurrency		= Currency
			invoked.AssetTransactionAmount.TransactionAmount 		= LocalTransactionAmount
			invoked.AssetTransactionAmount.BaseAmount.ToCurrency	= Currency
			invoked.TransactionNumberOfDecimals	= TransactionNumberOfDecimals
			invoked.AssetTransactionAmount.ExchangeDate	  	= RevaluationDate
		
		CreateAssetTransaction
			invoked.FinanceEnterpriseGroup		= Asset.FinanceEnterpriseGroup
			invoked.ProcessSequence				= Asset.LastAssetSequence
			invoked.Asset						= Asset
			invoked.ProcessAsset				= Asset
			invoked.Company						= Asset.Company
			invoked.Book						= Book
			invoked.TransactionDate				= RevaluationDate
			if (PostingDate entered)
				invoked.PostingDate				= PostingDate
			else
				invoked.PostingDate				= RevaluationDate
			invoked.ProcessDate					= RevaluationDate
			invoked.Description					= "Asset" + " " + Asset + " " + Asset.AssetProcess
			invoked.Reference					= "AssetRevalue"+ " " + Asset
			invoked.TransactionStatus			= "U"
			invoked.AssetProcess				= "RVL"
			invoked.AssetType					= Asset.AssetType
			invoked.TransactionNumberOfDecimals	= AssetBookRel.TransactionNumberOfDecimals
			invoked.TransactionAmount			= LocalTransactionAmount
			invoked.TransientBookCurrency		= Currency
			invoked.AssetTransactionAmount.TransactionAmount 		= LocalTransactionAmount
			invoked.AssetTransactionAmount.BaseAmount.ToCurrency	= Currency
			invoked.TransactionNumberOfDecimals	= TransactionNumberOfDecimals
			invoked.AssetTransactionAmount.ExchangeDate	  	= RevaluationDate
		
		UpdateAssetBookRevaulation
			RevalueBookBasis	= AssetBookRel.Basis
			RevalueDepreciationLifeToDate = AssetBookRel.LifeToDateDepreciation
			RevalueDepreciationYearToDate = AssetBookRel.YearToDateDepreciation
						
			
	Field Rules
		Active
			default to AssetBookRel.Active
			
		Currency
			if (Book.PostCurrency.Book)
				default to Book.Currency
			else 
				default to Asset.Currency
		
		TransactionNumberOfDecimals
			if (Book.PostCurrency.Book)
				default to Book.Currency.NumberOfDecimals
			else 
				default to Asset.Currency.NumberOfDecimals
		
		Life
			default to AssetBookRel.Life
		
		LifeRemaining
			default to AssetBookRel.LifeRemaining
		
		Basis
			default to AssetBookRel.Basis
		
		AssetType
			initial value is Asset.AssetType
			default to Asset.AssetType
		
		Method
			default to AssetBookRel.Method
		
		InServiceDate
			default to AssetBookRel.InServiceDate
		
		MethTableYr
			default to AssetBookRel.YearPlacedInService
		
		DepreciationStartDate
			default to AssetBookRel.DepreciationStartDate
		
		LifeInYears
			default to AssetBookRel.LifeInYears
		
		YearToDateDepreciation
			default to AssetBookRel.YearToDateDepreciation
			
		LifeToDateDepreciation
			default to AssetBookRel.LifeToDateDepreciation
		
		SalvageValue
			default to AssetBookRel.SalvageValue
	
		CurrentPeriodDepreciation
			default to AssetBookRel.CurrentPeriodDepreciation
		
		AssetTagNumber
			default to Asset.TagNumber
		
		AssetDivision
			default to Asset.AssetDivision
		
		AssetLocation
			default to Asset.AssetLocation
		
		Company
			default to Asset.Company
		
		RevalueMethod
			if (Asset.AssetType.RevalueMethod.Elimination)
				RevalueMethod = "E"
			else
			if (Asset.AssetType.RevalueMethod.Proportionate)
				RevalueMethod = "P"
		
		RevaluationDate
			if (RevaluationDate not entered)
				confirmation required
					"RevaluationDateNotEntered,UseCurrentDateAsRevaluationDate"
				default to current date
		
		PostingDate
			default to RevaluationDate
			if (CompanySystemClosingControlRel exists
			and CompanySystemClosingControlRel.Control = true)
				constraint (PostingDate within CompanySystemClosingControlRel.ValidEntryDate)
					"PostingDateIsOutsideSystemControlValidEntryDateRange"
		
		Operator		
			default to actor
		
		TransientPercentSign
			initial value is "+" 
			default to "+" 
		
		RevalueDate
			default to current timestamp
		
	Actions
		Create is a Create Action
			Entrance Rules
				if (!AssetBookRel.Disposed)						
					if(RevaluationDate not entered
					and PostingDate not entered)
						PostingDate = current date
					if (AssetRel.Status.PostRelease)
						constraint (false)
							"AssetIs_In-_Progress,CannotPerformARevaluation"
					constraint (RevalueAmount entered
					or RevaluePercent entered)
						"AmountOrPercentIsRequired"
					if (RevaluePercent entered)
						constraint (AssetBookRel.Basis entered)
							"BookBasisAmountIsZero,CannotPerformAPercentRevaluation"
					if (RevalueAmount entered)
						constraint (RevaluePercent not entered)
							"EnterEitherAmountOrPercent"
					constraint (!Book.Impairment)
						"ImpairmentBookCannotBeRevalued"
					constraint (AssetBookRel exists)
						"AssetBookDoesNotExists"
					Company = Asset.Company




					RevalueStatus = "U"
			Exit Rules
				if (!AssetBookRel.Disposed)						
					include CalculateRevalueAmount
					invoke Released.Revalue Asset
					invoke DefaultAccounts AssetBookRel
					if (RevalueMethod = "E")
						include RevalueElimination
					else
					if (RevalueMethod = "P")
						include RevalueProportionate
					include UpdateAssetBookRevaulation

		Update is an Update Action
		
		Delete is a Delete Action
			restricted
		
		ResetRevalue is an Instance Action
			restricted
			Action Rules
				if (!AssetBookRel.Disposed)			
					invoke BalanceUpdate AssetBookRel
						invoked.Basis = Basis
						invoked.LifeToDateDepreciation = LifeToDateDepreciation
						invoked.YearToDateDepreciation = YearToDateDepreciation
						if (RevalueTransactionRel exists)
							invoked.RvlLtd -= sum RevalueTransactionRel.AssetTransactionAmount.TransactionAmount
						else
						if (RevalueBookTransactionRel exists)
							invoked.RvlLtd -= sum RevalueBookTransactionRel.AssetTransactionAmount.TransactionAmount


















							
					if (BookCalendarCurrentRel.IsPostingBook)
						invoke Delete AssetRevalueTransactionRel
					else
						invoke Delete AssetRevalueBookTransactionRel
			Exit Rules
				invoke DecrementLastAssetSequence AssetRel
				invoke Delete
		
		
		
		Release is an Instance Action
			restricted
			Entrance Rules
				RevalueStatus = "R"
