PayablesDiversityCode is a BusinessClass
    owned by ap
    prefix is AVC
    classic name is APDIVCODE

    Ontology
        symbolic key is PayablesDiversityCode
            classic set name is AVCSET1
            classic name is DIVERSE-CODE

    Patterns
        implements StaticJava
        disable AuditIndex

    Persistent Fields

        Description
        Active

	Transient Fields
		Supplier
		Subcontractor
	
	Context Fields
		SupplyManagementReport
	
	Derived Fields


		DerivedTotalEventsBidByDiversity is a DerivedField
			type is Numeric size 21
			return (sum SupplierDiversityCodeRel.DerivedTotalEventsBidBySupplier)
		
		DerivedTotalEventsAwardedByDiversity is a DerivedField
			type is Numeric size 21
			return (sum SupplierDiversityCodeRel.DerivedTotalEventsAwardedBySupplier)
		
		DerivedEventsBidPercentByDiversity is a ComputeField	
    		type is Percent size 6.2
    		(DerivedTotalEventsAwardedByDiversity/ DerivedTotalEventsBidByDiversity)

		DerivedTotalEventLinesBidByDiversity is a DerivedField
			type is Numeric size 6
			return (sum SupplierDiversityCodeRel.DerivedTotalEventLinesBidBySupplier)
		
		DerivedTotalEventLinesAwardedByDiversity is a DerivedField
			type is Numeric size 6
			return (sum SupplierDiversityCodeRel.DerivedTotalEventLinesAwardedBySupplier)
		
		DerivedEventLinesBidPercentBySupplier is a ComputeField	
    		type is Percent size 6.2
    		(DerivedTotalEventLinesAwardedByDiversity/ DerivedTotalEventLinesBidByDiversity)

 		DerivedBidTotalByDiversity is a DerivedField
			type is like InternationalAmount
			return (sum SupplierDiversityCodeRel.DerivedBidTotalBySupplier)
 		
 		DerivedAwardedTotalByDiversity is a DerivedField
			type is Decimal size 21.2
			return (sum SupplierDiversityCodeRel.DerivedAwardedTotalBySupplier)
 
		DerivedTotalBidPercentByDiversity is a ComputeField	
    		type is Percent size 6.2
    		(DerivedAwardedTotalByDiversity/ DerivedBidTotalByDiversity)
    		
    	DiverseTotal is a DerivedField
        	type is like InternationalAmount
			return sum VendorDiversityForPurchasingByDiversityCodeRel.DiverseTotal
    		
    	DiversityCodeDisplay is a DerivedField
    		type is like Description
    		restricted
    		if (EditDiversityCertDates)
    			return "Non-Diverse"
    		else
    			return PayablesDiversityCode
    			
    	PayablesInvoiceTotal is a DerivedField
        	type is like InternationalAmount
        	return sum VendorDiversityRel.GrandTotalInvoiceBasePayment

		XiStatusMessage is a DerivedField
			type is MessageField
			if (Active)
				return "Active"
			else
				return "Inactive"

	Conditions
		Historical
			restricted
			when  (parentcontext.name = "InvoiceLineFact"
		        or parentcontext.name = "PolineFact"
		        or parentcontext.name = "PoInvLineFact")
		        
		SupplierDiversityReportExists
			restricted
			when (SupplierDiversityReportRel exists)

		SupplierDiversityExists
			restricted
			when (SupplierDiversitysRel exists)
		
		SubcontractorDiversityExists
			restricted
			when (SubcontractorDiversityRel exists)
		
		SubcontractorDiversitiesExist
			restricted
			when (SubcontractorDiversitysRel exists)
		
		ContractSubcontractorDiversitiesExist
			restricted
			when (ContractSubcontractorDiversitiesRel exists)
		
		VendorDiversityRelExists
			restricted
			when (VendorDiversityRel exists)
		
		VendorDiversityForPurchasingByDiversityCodeRelExists
			restricted
			when (VendorDiversityForPurchasingByDiversityCodeRel exists)
			
		EditDiversityCertDates
			restricted
			when ((not SupplyManagementReport.EditDiversityCertificationDates
			and PayablesDiversityCode = blank)
			or (SupplyManagementReport.EditDiversityCertificationDates
			and any VendorDiversityRel.VendorDiversityEditDiversityCertDates))

		PurchaseOrderDiversityExists
			restricted
			when (PurchaseOrderDiversityRel exists)

		ContractDiversityExists
			restricted
			when (ContractDiversityRel exists)

		PayablesInvoiceDiversityExists
			restricted
			when (PayablesInvoiceRel exists)

	Relations
		SupplierDiversityReportRel 
			one-to-many relation to SupplierDiversityResponse
			Field Mapping uses ByDiversityCode
				related.SupplierGroup			= VendorGroup
        		related.PayablesDiversityCode	= PayablesDiversityCode
        	Instance Selection
        		where (related.EventNotificationAwardByDiversityRelExists
        		and (SupplyManagementReport.SupplyManagementReportSupplierGroupField.Supplier not entered
        		or 	related.Supplier = SupplyManagementReport.SupplyManagementReportSupplierGroupField.Supplier))
        
        SubcontractorDiversityRel 
			one-to-one relation to SubcontractorDiversity
			Field Mapping uses ByDiversityCode
				related.SupplierGroup			= VendorGroup
        		related.PayablesDiversityCode	= PayablesDiversityCode
        		related.Subcontractor           = Subcontractor


		VendorDiversityForPurchasingByDiversityCodeRel
			one-to-many relation to VendorDiversity
			Field Mapping uses Set2
				related.DiversityCode	= PayablesDiversityCode
				related.VendorGroup		= VendorGroup
			Instance Selection
				where (related.PurchaseOrdersWithDiversityCodesRelExists)


		VendorDiversityRel
			one-to-many relation to VendorDiversity
			Field Mapping uses Set2
				related.DiversityCode	= PayablesDiversityCode
				related.VendorGroup		= VendorGroup
			Instance Selection
				where (related.PayablesInvoiceByDiversityCodeAndVendorRelExists)


		SupplierDiversityCodeRel
			one-to-many relation to SupplierDiversityResponse
			Field Mapping uses ByDiversityCode
				related.SupplierGroup			= VendorGroup
				related.PayablesDiversityCode	= PayablesDiversityCode
				
		VendorDiversitysRel
			one-to-many relation to VendorDiversity
			Field Mapping uses Set2
				related.DiversityCode	= PayablesDiversityCode
				related.VendorGroup		= VendorGroup
			
		SupplierDiversitysRel
			one-to-many relation to SupplierDiversityResponse
			Field Mapping uses ByDiversityCode
				related.SupplierGroup    	  = VendorGroup
				related.PayablesDiversityCode = PayablesDiversityCode
		
		SubcontractorDiversitysRel
			one-to-many relation to SubcontractorDiversity
			Field Mapping uses ByDiversityCode
				related.SupplierGroup          = VendorGroup
				related.PayablesDiversityCode  = PayablesDiversityCode
		
		PayablesInvoiceRel
			one-to-many relation to PayablesInvoice
			Field Mapping uses ByDiversityCodeVendor
				related.DiversityCode   = PayablesDiversityCode
				







		PurchaseOrderDiversityRel
			one-to-many relation to PurchaseOrderDiversity
			Field Mapping uses ByDiversityCodeVendor
				related.PayablesDiversityCode   = PayablesDiversityCode
				
		ContractDiversityRel
			one-to-many relation to ContractDiversity
			Field Mapping uses ByDiversityCode
				related.PayablesDiversityCode    = PayablesDiversityCode
				related.ContractGroup            = VendorGroup
				
		ContractSubcontractorDiversitiesRel
			one-to-many relation to ContractSubcontractorDiversity
			Field Mapping uses ByDiversityCode
				related.PayablesDiversityCode    = PayablesDiversityCode
				related.ContractGroup            = VendorGroup
		
	Field Rules


	Attach Rules
		constraint (Historical
		or          Active)
			"DiversityCodeIsNotActive"
					
	Actions
		Create is a Create Action

		Update is an Update Action

		Delete is a Delete Action
		
		
		

