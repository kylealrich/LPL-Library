AssetBookTypeDepreciation is a BusinessClass
    owned by am
    prefix is ADX
    classic name is AMBKTYPEX

    Ontology
        symbolic key is AssetBookTypeDepreciation
            classic set name is ADXSET1
            classic name for AssetType.Type is ASSET-TYPE


    Patterns
        implements StaticJava
        disable AuditIndex

    Persistent Fields
		ClassPostingDimensions is a FinanceCodeBlockNoAccountFull
        DepreciationRate
            classic name is DEPR-RATE
            
	Local Fields
		LocalAsset		is an Asset
            

    Relations

        AssetBookTypeRel
            classic name is AMBOOKTYPE
            one-to-one relation to AssetBookType
            required
            Field Mapping uses symbolic key
                related.FinanceEnterpriseGroup 						= Company.FinanceEnterpriseGroup
                related.Book                   						= Book
                related.AssetBookType.Type     						= AssetType.Type
                related.AssetBookType.SubType  						= AssetType.SubType
                
		AssetBooksRel
			one-to-many relation to AssetBook
			Field Mapping uses Set2
				related.FinanceEnterpriseGroup						= Company.FinanceEnterpriseGroup
				related.Book										= Book
				
		AssetsRel
			one-to-many relation to Asset
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup						= Company.FinanceEnterpriseGroup 
				related.Asset										= LocalAsset
			Instance Selection
				where (related.AssetType							= AssetType
				and	   related.Company								= Company
				and	   related.AssetAccountingUnit					= ClassPostingDimensions)                

		ClassPostingDimensionsInUseRel
			one-to-many relation to AssetBookTypeDepreciation
			Field Mapping uses symbolic key
				related.Company					= Company
				related.Book					= Book
				related.AssetType.Type			= AssetType.Type	
				related.AssetType.SubType			= AssetType.SubType							
			Instance Selection	
				where (related.ClassPostingDimensions = ClassPostingDimensions
				and related.AssetBookTypeDepreciation != AssetBookTypeDepreciation)
				
	Conditions
		PostingDimensionsInUse
			when (ClassPostingDimensionsInUseRel exists) 
		
    Sets
                
	Field Rules
		ClassPostingDimensions
			required
			cannot be changed

		DepreciationRate
			constraint (DepreciationRate <= 1)
				"DepreciationRateCannotExceed100%"				
				
	Rule Blocks
	
		DeleteRules
		
			for each AssetBooksRel
				LocalAsset = each.Asset
				constraint (AssetsRel not exists)
					"CannotDeleteRate:ItIsBeingUsedByAsset<LocalAsset>"	

    Actions
        Create is a Create Action
			Action Rules
			
			Exit Rules
				constraint (!ClassPostingDimensionsInUseRel exists) 
					"PostingDimensionsAlreadyAssignedToThisAssetTypeAndClass"

        Update is an Update Action
			Action Rules

        Delete is a Delete Action
			Action Rules
				include DeleteRules
				
                

