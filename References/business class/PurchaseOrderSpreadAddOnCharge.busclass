PurchaseOrderSpreadAddOnCharge is a BusinessClass
    owned by po
    prefix is PSP
    classic name is POAOCSPRD

    Ontology
        symbolic key is PurchaseOrderSpreadAddOnCharge
            classic set name is PSPSET1
            classic name for AddOnCharge is AOC-CODE

    Patterns
        implements ContextualParent
        implements StaticJava
        disable AuditIndex
        implements Archivable

    Persistent Fields
    	SpreadMethod
        AddOnChargePercent
            classic name is AOC-RATE
        EnteredAddOnChargeAmount is an InternationalAmount
            classic name is ENT-AOC-AMOUNT
        CalculatedSpreadAmount   is an InternationalAmount
            classic name is CALC-SPRD-AMT
        SpreadDifference         is an InternationalAmount
        	restricted
            classic name is SPREAD-DIFF
        Taxable                  is Boolean
            classic name is TAXABLE-FLAG
        TaxCode				 


        Accrual                  is AlphaUpper size 1
            classic name is ACCRUAL-FL
            States
                Invoiced value is "I"
                Accrued  value is "A"
        TaxAmount                is an InternationalCost
        PrintOnPO                is Boolean
            classic name is AOC-ON-PO
        Summarize                is Boolean
            classic name is SUMMARY-FLAG
        Vendor
        PurchaseFromLocation
            classic name is PURCH-FR-LOC
        GlobalDocumentType
            classic name is GLBL-DOC-TYPE
        PostingAccount           is a FinanceCodeBlock
            classic name for PostingAccount.AccountingUnit is DST-ACCT-UNIT
            classic name for PostingAccount.GeneralLedgerChartAccount is DST-ACCOUNT
            classic name for PostingAccount.Project is ACTIVITY

	Context Fields
		PayablesCompany
		PayablesInvoice

    Local Fields 
    	LocalLineTotal      	 is an InternationalAmount
    	LocalFromSpread 		 is Boolean    				
    	LocalLineSpreadAmount	 is an InternationalAmount
		LocalRoundedLineSpreadAmount	is an InternationalAmount
			precision is DerivedCurrencyNumberOfDecimal
				round to precision
    	LocalAmountSpread		 is an InternationalAmount
    	LocalSpreadTotal  		 is an InternationalAmount 
    	LocalPurchaseOrderLine   is a PurchaseOrderLine


		
	Transient Fields
		TransientZeroCost				 		is Boolean
			derive value from first PurchaseOrderLineSpreadAddOnChargesRel.ZeroCost
		TransAddOnCostExists 	 				is Boolean    		
    	TransientCurrency		 				is a FromCurrency
    		derive value from DerivedCurrency 
    	TransientEnteredCurrencyConversionRate	is a EnteredCurrencyConversionRate
    		derive value from DerivedCurrencyConversion
    		
    Derived Fields	
    	DerivedTaxable 			 is a DerivedField
    		type is Boolean
    		restricted
    		return PurchaseOrderAndLineAddOnChargeRel.Taxable
    	
			    		
       	DerivedTaxCode			 is a DerivedField
   			type is AlphaUpper size 8
   			restricted 
    	 	if ( PurchaseOrderAndLineAddOnChargeRel.Taxable = "N" )
           		return (" ")	 
           	else
           		if ( PurchaseOrderAndLineAddOnChargeRel.TaxCode = " " )
       				if ( AddOnCharge.TaxCode != " " )
       					return ( AddOnCharge.TaxCode )

     



	
    	DerivedUnsignedEnteredAddOnChargeAmount is a DerivedField
    		type is like InternationalAmount
    		restricted
    		if (EnteredAddOnChargeAmount < 0)	
				return EnteredAddOnChargeAmount * -1
			else
				return EnteredAddOnChargeAmount

		ComputeSpreadPercent is a DerivedField
			type is like Pct
			return LocalPurchaseOrderLine.LineAmount / DerivedTotalLineAmount
		
		ComputedSpreadAmount is a DerivedField
			type is like InternationalAmount
			restricted
			return ComputeSpreadPercent * EnteredAddOnChargeAmount
		

		ComputedSpreadDifference is a DerivedField
			type is like InternationalAmount		
			restricted		
			return (EnteredAddOnChargeAmount - CalculatedSpreadAmount)
			
		DerivedItemAddOnCostRate is a DerivedField
			type is like AddOnChargePercent
			restricted
			if (TransientZeroCost)
				return 0
			else
				return AddOnChargePercent
				
		DerivedItemAddOnCostAmount is a DerivedField
			type is like InternationalAmount
			restricted
			if (TransientZeroCost)
				return 0
			if (IsSpreadByQuantity)
				return (((LocalPurchaseOrderLine.Quantity / DerivedTotalLineQuantity) * EnteredAddOnChargeAmount) / LocalPurchaseOrderLine.Quantity)
			else
				if (IsSpreadByAmount)
					return (((LocalPurchaseOrderLine.LineAmount / DerivedTotalLineAmount) * EnteredAddOnChargeAmount) / LocalPurchaseOrderLine.Quantity)
				
		DerivedTotalLineQuantity is a DerivedField
			type is like Quantity
			restricted
			return (sum PurchaseOrder.PurchaseOrderLinesWithCostRel.Quantity)
			
		DerivedTotalLineAmount is a DerivedField
			type is like InternationalAmount
			restricted
			return (sum PurchaseOrder.PurchaseOrderLinesWithCostRel.LineAmount)
		
		MissingWeight				is a MessageField
			restricted
			"WeightNotDefinedOrAllLinesExcluded"
			
		MissingVolume				is a MessageField
			restricted
			"VolumeNotDefinedOrAllLinesExcluded"	
			
		MissingWeightOrVolumeMessage is a DerivedField
			type is Alpha size 40
			restricted
			if (IsSpreadByWeight)
				return MissingWeight
			else
				if (IsSpreadByVolume)
					return MissingVolume
					
		DerivedCurrency is a DerivedField
			type is like FromCurrency
			restricted
			if (PurchaseOrderLineSpreadAddOnChargesRel exists 
			and old PurchaseOrder.Currency not entered)
				return first PurchaseOrderLineSpreadAddOnChargesRel.Currency
			else
				return PurchaseOrder.Currency
		
		DerivedCurrencyNumberOfDecimal is a DerivedField
			type is like Currency
			restricted
			if (PurchaseOrderLineSpreadAddOnChargesRel exists 
			and old PurchaseOrder.Currency not entered)
				return first PurchaseOrderLineSpreadAddOnChargesRel.Currency.NumberOfDecimals
			else
				return PurchaseOrder.Currency.NumberOfDecimals
			
		DerivedAOCDescription is a DerivedField 
			type is Alpha size 60
			return AddOnCharge.Description

		DerivedCurrencyConversion is a DerivedField
			type is like EnteredCurrencyConversionRate
			restricted
			if (PurchaseOrderLineSpreadAddOnChargesRel exists)
				return first PurchaseOrderLineSpreadAddOnChargesRel.EnteredCurrencyConversionRate
			else
				return PurchaseOrder.EnteredCurrencyConversionRate
			 	 		
    Conditions
        AuditRecordExists
            classic name is HAS-AUDIT-REC
            restricted
            when (first PoauditRel exists)












        
        PurchaseOrderAOCLineNotExists
        	restricted
        	when (not PurchaseOrderAndLineAddOnChargeRel exists)    
        	
        IsInventoried
        	restricted
            when (PurchaseOrderLineRel.ItemType.Inventoried)	

		IsNonStock 
			restricted
			when (PurchaseOrderLineRel.ItemType.NonStock)
			
		IsTaxable
			restricted
			when ( PurchaseOrderAndLineAddOnChargeRel.Taxable )

		AddOnCostExists
			restricted
			when ( (PurchaseOrderLineRel.Closed.Yes)	or ( (IsInventoried) and ( IccompanyRel.CostingMethod.StandardCosting) ) 
			or ( IsInventoried and PurchaseOrderLineRel.ReceivedQuantity > PurchaseOrderLineRel.MatchedQuantity ) 
			or ( IccompanyRel.CostingMethod.StandardCosting ) 
			or ( PurchaseOrderLineRel.ExcludeFromAddOnChargeSpread )    
			or ( IsSpreadByWeight and PurchaseOrderLineRel.StockWeight = 0 )
			or ( IsSpreadByVolume and PurchaseOrderLineRel.StockVolume = 0)  
			or ( ( SpreadMethod.Amount or SpreadMethod.Rate or SpreadMethod.Quantity ) and (PurchaseOrderLineRel.EnteredUnitCost = 0 )) )
					
		PayablesInvoiceSpreadAocExist
			restricted
			when (PayablesInvoiceSpreadAocRel exists)

		CreateInvoiceAocFromPoValid
			restricted
			when (!PayablesInvoiceSpreadAocExist
			and	  PayablesInvoice.IsUpdateable)

			
		IsSpreadByRate
			restricted
			when (SpreadMethod.Rate)
		
		IsSpreadByQuantity
			restricted
			when (SpreadMethod.Quantity)
		
		IsSpreadByAmount
			restricted
			when (SpreadMethod.Amount)
		
		IsSpreadByWeight
			restricted
			when (SpreadMethod.Weight)
			
		IsSpreadByVolume
			restricted
			when (SpreadMethod.Volume)
			
		IsAllowanceType
			restricted
			when (AddOnCharge.AddOnChargeType.Allowance)
		
		LinkedToContextInvoice
			restricted
			when (ContextMatchPurchaseOrderInvoiceRel exists)

    Relations
        IccompanyRel
            one-to-one relation to InventoryCompany
            required
            Field Mapping uses symbolic key
                related.Company = Company
                





        		 
        PoauditRel
            one-to-many relation to PurchaseOrderAudit
            Field Mapping uses Set4
                related.Company = Company
            Instance Selection
                where (related.PurchaseOrder = PurchaseOrder
                and   related.PurchaseOrderLine not entered
                and   related.AddOnCharge = AddOnCharge)








        PayablesInvoiceSpreadAddOnChargeRel
            one-to-many relation to PayablesInvoiceSpreadAddOnCharge
            Field Mapping uses ByAddOnChargePurchaseOrder
                related.Company        			= Company
                related.AddOnCharge    			= AddOnCharge
                related.PurchaseOrder  			= PurchaseOrder

		PurchaseOrderLineRel
			one-to-many relation to PurchaseOrderLine
		    Field Mapping uses symbolic key
		    	related.Company                  = Company
		        related.PurchaseOrder    	     = PurchaseOrder
		        related.PurchaseOrderLine        = LocalPurchaseOrderLine
		
		MatchedPurchaseOrderLinesRel
            one-to-many relation to PurchaseOrderLine
            Field Mapping uses Set11
                related.Company        = Company
                related.PurchaseOrder  = PurchaseOrder


                
        PurchaseOrderAndLineAddOnChargeRel
        	one-to-one relation to PurchaseOrderAndLineAddOnCharge
        	Field Mapping uses symbolic key
        		related.Company = Company

        		related.PurchaseOrder 	  = PurchaseOrder
        		related.PurchaseOrderLine = blank
        		related.AddOnCharge		  = AddOnCharge
        		
        PurchaseOrderAndLineAddOnChargeRels
            one-to-many relation to PurchaseOrderAndLineAddOnCharge
            Field Mapping uses symbolic key
            Instance Selection
                where (related.PurchaseOrderAndLineAddOnCharge.Company = Company

                and   related.PurchaseOrderAndLineAddOnCharge.PurchaseOrder = PurchaseOrder
                and   related.PurchaseOrderAndLineAddOnCharge.PurchaseOrderLine not entered)
                
        PurchaseOrderAndLineAddOnChargeSet2Rels
            one-to-many relation to PurchaseOrderAndLineAddOnCharge
            Field Mapping uses Set2
            Instance Selection
            	where (related.PurchaseOrderAndLineAddOnCharge.Company = Company
                and   related.PurchaseOrderAndLineAddOnCharge.AddOnCharge = AddOnCharge 
                and   related.PurchaseOrderAndLineAddOnCharge.PurchaseOrder =  PurchaseOrder)

        PurchaseOrderAndLineAddOnChargeSet4Rel 
        	one-to-many relation to PurchaseOrderAndLineAddOnCharge
        	Field Mapping uses Set4
            	related.Company = Company
                related.Vendor = Vendor 
                related.PurchaseOrder = PurchaseOrder
                related.AddOnCharge = AddOnCharge
    	 	    	 	    	 	



		PayablesInvoiceSpreadAocRel
			one-to-one relation to PayablesInvoiceSpreadAddOnCharge
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PayablesInvoice			= PayablesInvoice
				related.AddOnCharge				= AddOnCharge
				
		PurchaseOrderLineSpreadAddOnChargesRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses symbolic key
			Instance Selection
				where  (related.Company					= Company
				and 	related.PurchaseOrder			= PurchaseOrder
				and 	related.AddOnCharge				= AddOnCharge
				and 	related.PurchaseOrderLine entered)
				
		ContextMatchPurchaseOrderInvoiceRel
			one-to-one relation to MatchPurchaseOrderInvoice
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
				related.PayablesInvoice	= PayablesInvoice
				related.Vendor			= Vendor
		
		DuplicatePOLineAddOnChargeRel
			one-to-one relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company			    = Company
				related.PurchaseOrder		= PurchaseOrder
				related.PurchaseOrderLine	= LocalPurchaseOrderLine
				related.AddOnCharge		    = AddOnCharge		

    Sets









        ByVendor
            indexed
            Sort Order
                Company
                Vendor
                PurchaseOrder
                AddOnCharge





















	Field Rules
		SpreadMethod
			default to AddOnCharge.SpreadMethod
			constraint (not SpreadMethod.NoSpread)
				"MustUseAddOnChargeWithSpreadMethodOtherThanNO"	
			
			if (SpreadMethod.Rate)
				initialize EnteredAddOnChargeAmount
			else
				initialize AddOnChargePercent
				
			if (IsSpreadByWeight
			or  IsSpreadByVolume)
				for each PurchaseOrder.PurchaseOrderLinesWithCostRel
					constraint ((each.StockWeight entered
					or			 not IsSpreadByWeight)
					and         (each.StockVolume entered
					or			 not IsSpreadByVolume))
						"<MissingWeightOrVolumeMessage>"
			
		AddOnChargePercent
			if (IsSpreadByRate)
				default to AddOnCharge.AddOnChargePercent
				if (not TransientZeroCost)
					required
						"MustEnterAtLeastOneCost,Rate,OrZeroCostValue"
						
			else
				cannot be entered
					"RateCannotBeEnteredWhenNotSpreadingByRate"
			
		EnteredAddOnChargeAmount
			if (not IsSpreadByRate)
				if (not TransientZeroCost)
					required
						"MustEnterAtLeastOneCost,Rate,OrZeroCostValue"
			else
				cannot be entered
					"AmountCannotBeEnteredWhenSpreadingByRate"
			
			if (IsAllowanceType)
				if (EnteredAddOnChargeAmount >= 0)
					EnteredAddOnChargeAmount = EnteredAddOnChargeAmount * -1
			else
				constraint (EnteredAddOnChargeAmount >= 0)
					"CostTypeAddOnCharge,CannotEnterNegativeTotalAmount"

		TransientZeroCost
			constraint (EnteredAddOnChargeAmount not entered)
				"CannotEnterAmountAndSpecifyZeroCost"

			constraint (AddOnChargePercent not entered)
				"CannotEnterRateAndSpecifyZeroCost"				
			





    		
    	Taxable
    		default to AddOnCharge.Taxable
    		
    	TaxCode
    		default to AddOnCharge.TaxCode
    		if (Taxable)
    			required
    				"AddOnCostTaxableButNoTaxCodeEntered"
    		else
    			cannot be entered
    				"CannotHaveTaxCodeWhenTaxableFlagIsSetToFalse"
	    Accrual
	    	default to TaxCode.TaxCodeAccountsRel.AccruedOrInvoiced
	    	
	    PostingAccount
	    	default to AddOnCharge.PostingAccount
	    	


		
		PrintOnPO
			if (not Vendor = PurchaseOrder.Vendor)
				force default to false
			else
				default to AddOnCharge.PrintOnPO
	    	
	    Summarize 
	    	default to AddOnCharge.Summarize
	    
	    Vendor
	    	initial value is PurchaseOrder.Vendor
			default to PurchaseOrder.Vendor
			constraint (not Vendor.ERSCapable)
				"PurchaseOrderVendorIsErsCapable;AddOnChargeSpreadNotAllowed"

			
	    PurchaseFromLocation
	    	initial value is PurchaseOrder.PurchaseFromLocation
	    	default to PurchaseOrder.PurchaseFromLocation
		
	Rule Blocks
			

					
















































				







			


						
		CheckPOLines
			initialize LocalLineTotal
			for each MatchedPurchaseOrderLinesRel
				TransAddOnCostExists = false		
				
				if ( (each.Closed.Yes)	or ( (each.ItemType.Inventoried) and ( IccompanyRel.CostingMethod.StandardCosting) ) 
				or ( each.ItemType.Inventoried and each.ReceivedQuantity > each.MatchedQuantity ) 
				or ( IccompanyRel.CostingMethod.StandardCosting ) 
				or ( each.ExcludeFromAddOnChargeSpread )    
				or ( IsSpreadByWeight and each.StockWeight = 0 )
				or ( IsSpreadByVolume and each.StockVolume = 0)  
				or ( ( SpreadMethod.Amount or SpreadMethod.Rate or SpreadMethod.Quantity ) and (each.EnteredUnitCost = 0 )) ) 
						TransAddOnCostExists = true
						
				if  (not TransAddOnCostExists)
		   			if (IsSpreadByWeight)
		   				LocalLineTotal  = each.StockWeight

					else 
						if (IsSpreadByVolume)
							LocalLineTotal  = each.StockVolume

		
					if (SpreadMethod.Quantity)                 
						LocalLineTotal  = each.Quantity

		
					if (SpreadMethod.Amount or SpreadMethod.Rate)
						LocalLineTotal = each.EnteredUnitCost * each.VendorPriceUOMQuantity

					LocalSpreadTotal  = LocalSpreadTotal + LocalLineTotal 
					LocalFromSpread = true

					
					invoke CreatePurchaseOrderLineAddOnCharge PurchaseOrderAndLineAddOnCharge
						invoked.Company = Company
						invoked.PurchaseOrder = PurchaseOrder
						invoked.PurchaseOrderLine = each.PurchaseOrderLine
						invoked.AddOnCharge = AddOnCharge
						invoked.Vendor = Vendor
						invoked.AddOnChargePercent = AddOnChargePercent
						


											
	Actions
		Create is a Create Action
			valid when (PurchaseOrder.IsUpdateAllowed)

			
			Entrance Rules
				constraint (PurchaseOrder.PurchaseOrderLinesWithCostRel exist)
					"NoLinesToSpreadAgainst"
				



					
				if (IsAllowanceType)
					constraint (DerivedUnsignedEnteredAddOnChargeAmount <= PurchaseOrder.TotalOrderAmount)
						"AllowanceAddOnChargeAmountCannotExceedPurchaseOrderValue"




				


				
						
			Exit Rules

				if (IsSpreadByAmount)
					LocalSpreadTotal = sum PurchaseOrder.PurchaseOrderLinesForSpreadRel.ExtendedAmount
				else
				if (IsSpreadByQuantity)
					LocalSpreadTotal = sum PurchaseOrder.PurchaseOrderLinesForSpreadRel.Quantity
				else
				if (IsSpreadByWeight)
					LocalSpreadTotal = sum PurchaseOrder.PurchaseOrderLinesForSpreadRel.StockWeight
				else
				if (IsSpreadByVolume)
					LocalSpreadTotal = sum PurchaseOrder.PurchaseOrderLinesForSpreadRel.StockVolume
				
				for each PurchaseOrder.PurchaseOrderLinesForSpreadRel
					LocalPurchaseOrderLine 		= each.PurchaseOrderLine
					
					if (IsSpreadByAmount)
						LocalLineSpreadAmount	= ((LocalPurchaseOrderLine.ExtendedAmount/LocalSpreadTotal) * EnteredAddOnChargeAmount)
					else
					if (IsSpreadByQuantity)
						LocalLineSpreadAmount	= ((LocalPurchaseOrderLine.Quantity/LocalSpreadTotal)* EnteredAddOnChargeAmount)
					else
					if (IsSpreadByWeight)
						LocalLineSpreadAmount	= ((LocalPurchaseOrderLine.StockWeight/LocalSpreadTotal)* EnteredAddOnChargeAmount)
					else
					if (IsSpreadByVolume)
						LocalLineSpreadAmount	= ((LocalPurchaseOrderLine.StockVolume/LocalSpreadTotal)* EnteredAddOnChargeAmount)

					LocalRoundedLineSpreadAmount = LocalLineSpreadAmount

					if (IsSpreadByRate
					or	TransientZeroCost
					or  LocalRoundedLineSpreadAmount entered)
						invoke CreatePurchaseOrderLineAddOnCharge PurchaseOrderAndLineAddOnCharge
							fill in fields from this instance
								except invoked.AddOnChargePercent
								except invoked.EnteredUnitCost
							invoked.Company							= Company
							invoked.PurchaseOrder                   = PurchaseOrder
							invoked.PurchaseOrderLine				= LocalPurchaseOrderLine
							invoked.AddOnCharge						= AddOnCharge
							invoked.Quantity						= LocalPurchaseOrderLine.Quantity
							invoked.ZeroCost						= TransientZeroCost						
							if (IsSpreadByRate and not TransientZeroCost)
								invoked.AddOnChargePercent			= DerivedItemAddOnCostRate
								invoked.AddOnChargeEntryMethod		= AddOnChargeEntryMethod.RatePercentage
							else							
								invoked.AddOnChargeEntryMethod		= AddOnChargeEntryMethod.TotalAmount
								invoked.TotalAddOnChargeAmount		= LocalLineSpreadAmount 
							invoked.Currency						= TransientCurrency
							invoked.EnteredCurrencyConversionRate	= TransientEnteredCurrencyConversionRate
							invoked.CreatedDuringSpread             = true						


					CalculatedSpreadAmount += LocalLineSpreadAmount
				
				if (not IsSpreadByRate)
					LocalAmountSpread = sum PurchaseOrderLineSpreadAddOnChargesRel.TotalAddOnChargeAmount
					SpreadDifference = EnteredAddOnChargeAmount - LocalAmountSpread
							
					if (SpreadDifference entered)
						invoke AddSpreadDifference first PurchaseOrderLineSpreadAddOnChargesRel
							invoked.PrmSpreadDifference = SpreadDifference
						if (SpreadDifference > 1)
							CalculatedSpreadAmount += SpreadDifference
						initialize SpreadDifference
						 
					
						
		CreateFromCopyPurchaseOrder is a Create Action
			restricted
						
	 	FastUpdate is an Update Action
			restricted
			bypass field rules
		
		Delete is a Delete Action
			valid when (PurchaseOrder.AllowDelete)
			Entrance Rules




					
				invoke Delete PurchaseOrderLineSpreadAddOnChargesRel
				
		CreateInvoiceSpreadAddOnCharge is an Instance Action
			default label is "CreateInvoiceSpreadAddOnCharge"
			valid when (CreateInvoiceAocFromPoValid)	
			Parameters
				PayablesCompany
				PayablesInvoice

			Action Rules
				constraint (!PayablesInvoiceSpreadAocExist)
					"ChargeOrAllowanceExists" 

				if (PurchaseOrder.MatchedPurchaseOrderInvoicesRel exists)  
					initialize LocalAmountSpread		
					for each PayablesInvoiceSpreadAddOnChargeRel
						if (!each.PayablesInvoice.Status.Unreleased)
							LocalAmountSpread += each.SpreadAmount	
					LocalAmountSpread = EnteredAddOnChargeAmount - LocalAmountSpread	
				else
					LocalAmountSpread		  				= EnteredAddOnChargeAmount
									    				
				if (LocalAmountSpread != 0		
				or  SpreadMethod.Rate)
					invoke Create PayablesInvoiceSpreadAddOnCharge
						invoked.Company							= Company 
						invoked.Vendor							= Vendor
						invoked.PayablesInvoice					= PayablesInvoice
						invoked.PurchaseOrder					= PurchaseOrder
						invoked.AddOnCharge						= AddOnCharge
						invoked.SpreadAmount					= LocalAmountSpread
						invoked.AddOnChargePercent				= AddOnChargePercent
						if (initiating action = "MatchPurchaseOrderInvoice.CreateAOCFromPurchaseOrder"
						or  invoking action = "MatchPurchaseOrderInvoice.CreateAOCFromPurchaseOrder"
						or  initiating action = "PayablesInvoice.CreateInvoiceUnreleased"
						or  PayablesInvoice.InterfaceInProcess)
							invoked.BypassInvoiceErrorChecking		= true
							invoked.BypassAllowUpdate				= true
		
		BatchCopySpreadAddOnCharge is a Set Action
			restricted
			Parameters
				PrmCompany							is a PurchasingCompany
				PrmPurchaseOrder                    is like PurchaseOrder 
				PrmCopyFromPurchaseOrder			is a PurchaseOrder

			Instance Selection
				where	(Company			= PrmCompany
				and		 PurchaseOrder		= PrmCopyFromPurchaseOrder)

			Action Rules
				Instance Rules
					invoke CreateFromCopyPurchaseOrder
						resume on error
						fill in fields from this instance
                        invoked.PurchaseOrder = PrmPurchaseOrder

		Purge is a Purge Action
			restricted
		
		UpdateSpreadAddOnChargeVendor is an Instance Action
		    restricted
		    Parameters
                PrmVendor                           is a Vendor
	        	PrmPurchaseFromLocation				is a PurchaseFromLocation

	        Action Rules
				Vendor 					= PrmVendor
				PurchaseFromLocation	= PrmPurchaseFromLocation
				
