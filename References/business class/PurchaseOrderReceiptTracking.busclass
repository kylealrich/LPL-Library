PurchaseOrderReceiptTracking is a BusinessClass
    owned by po
    prefix is PTK
    classic name is POTRACK

    Ontology
        symbolic key is PurchaseOrderReceiptTracking
            classic set name is PTKSET1
            classic name for PurchaseOrderReceiptTracking.PackageTrackingNumber is PKG-TRK-NBR
            classic name for PurchaseOrderReceiptTracking.Requisition is REQ-NUMBER
            classic name for PurchaseOrderReceipt is REC-NUMBER
            classic name for PurchaseOrderReceiptLine is LINE-NBR

    Patterns
        implements StaticJava
        disable AuditIndex
        implements Archivable

    Persistent Fields

        NumberOfLabels is Numeric size 4
            classic name is NBR-LBLS
            default label is "Labels"
        PurchaseOrder
        Requester
        SignedBy       is AlphaUpper size 40
        DateSigned     is TimeStamp
            classic name is SIGNED-BY-DT
        ArrivalID      is Numeric size 13
        
    Local Fields
		LocalJSONResponse		is JSONObject	
		LocalWebServiceError		is Boolean
		LocalErrorMessage			is Alpha size 200

	Conditions
		PushArrivalToMSCM
			when(config.PushArrivalToMSCM = true)   	    
    
    Derived Fields
		GetDocumentJSON is a DerivedField	
			type is JSONObject
			GetDocumentJSON = template.MSCMArrivalFile_ST document for this instance
			
		CurrentTime is a NativeField
			type is Alpha size 20
			restricted

		DerivedRequisitionNumber is a DerivedField
			type is like Requisition
			default label is "Requisition"
			return PurchaseOrderReceiptTracking.Requisition
			
    Sets

        Set2
            indexed
            Sort Order
                Company
                PurchaseOrderReceipt
                PurchaseOrderReceiptTracking
                PurchaseOrderReceiptLine
	
	Relations
		PurchaseOrderLineSourcesRel
			one-to-many relation to PurchaseOrderLineSource
			Field Mapping uses symbolic key
				related.Company				= Company
				related.PurchaseOrder 		= PurchaseOrder
				related.PurchaseOrderLine 	= PurchaseOrderReceiptLine

    Field Rules
		PurchaseOrder
			default to PurchaseOrderReceipt.PurchaseOrder

		NumberOfLabels
			if (PurchaseOrderReceiptLine entered)
				if (!Company.PackageTrackingLevel.LineLevel)
					cannot be entered
						"CannotEnterLabels"	
			else
				if (Company.PackageTrackingLevel.HeaderLevel)
					if (Company.DefaultNumberOfLabelsTo1)
						default to 1
					else
						required
				else
					cannot be entered
						"CannotEnterLabels"			

		PurchaseOrderReceiptLine
			constraint (PurchaseOrderReceiptLine.Status.Entered)
				"CannotMaintainAReleasedReceiver"		
		
		Requester	
		








	Actions
		Create is a Create Action
						
		QuickCreate is a Create Action
			restricted
			
		CreateArrival is an Instance Action
			restricted
			Local Fields
				
			Action Rules
				if (PushArrivalToMSCM)
					invoke Add MSCMPurchaseOrderArrival
						resume on error
							LocalWebServiceError = true
							LocalErrorMessage = error message
						invoked.JSONRequest = GetDocumentJSON
						LocalJSONResponse 	= result.JSONResponse
				if (LocalWebServiceError or not PushArrivalToMSCM)
					invoke Create PurchaseOrderArrival
						fill in fields from this instance
		
					
		Update is an Update Action
			
		Delete is a Delete Action
				
		Purge is a Purge Action
			restricted
		
					
