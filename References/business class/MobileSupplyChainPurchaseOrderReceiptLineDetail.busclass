MobileSupplyChainPurchaseOrderReceiptLineDetail is a BusinessClass
    owned by mscm
    prefix is MSPLD
    sql name is "MSCMPOReceiptLineDetail"

    Ontology
        symbolic key is MobileSupplyChainPurchaseOrderReceiptLineDetail

    Persistent Fields
        SequenceNumber
        TrackingNumber
        Quantity                            is like Quantity
        CatchWeight                         is like Quantity
            precision is MobileSupplyChainPurchaseOrderReceiptLine.Item.NumberOfDecimalsQuantity
        Bin                                 is like Bin
        Lot                                 is like ItemLot
        Sublot                              is like Sublot
        LotExpirationDate                   is Date
        ManufacturingDate
        ShelfLife
        Serial                              is like ItemSerialNumber
        Hold                                is Boolean
        Item
        GTIN                                is like ItemGTIN
        UDIExpirationDate                   is Date
        UDIManufacturingDate                is Date
        ErrorMessage                        is Text

    Local Fields
        PurchaseOrderTransactionDetailView is a PurchaseOrderTransactionDetail view

    Field Rules

    Relations
        PurchaseOrderReceiptLineRel
            one-to-one relation to PurchaseOrderReceiptLine
            Field Mapping uses symbolic key
                related.Company                  = Company
                related.PurchaseOrderReceipt     = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                related.PurchaseOrderReceiptLine = MobileSupplyChainPurchaseOrderReceiptLine.PurchaseOrderReceiptLine

    Derived Fields

    Conditions
        IsCatchWeightItem
            restricted
            when (MobileSupplyChainPurchaseOrderReceiptLine.IsCatchWeightItem)
        
        HasPurchaseOrderTransactionDetail
            restricted
            when ((((PurchaseOrderReceiptLineRel.TrackingMethod = 1 or PurchaseOrderReceiptLineRel.TrackingMethod = 4)
                    and PurchaseOrderReceiptLineRel.IsInventoried
                    and PurchaseOrderReceiptLineRel.IsBinTracked
                    and Bin entered)                                                                                                       
                    or PurchaseOrderReceiptLineRel.IsLotOrSerialRequiredAtReceipt) and not PurchaseOrderReceiptLineRel.IsUDIRequiredAtReceipt) 
    
    Actions
        Create is a Create Action
            restricted
            Local Fields
                LocalDetailDocumentType                                is like PurchaseTransactionDocumentType
                LocalDetailDocumentNumber                              is like PurchaseOrderReceipt
                LocalDetailLineNumber                                  is like PurchaseOrderLine
                LocalDetailSequence                                    is like SequenceNumber
                LocalUDIDetailDocumentType                             is like PurchaseTransactionDocumentType
                LocalUDIDetailDocumentNumber                           is like PurchaseOrderReceipt
                LocalUDIDetailLineNumber                               is like PurchaseOrderLine
                LocalUDIDetailSequence                                 is like SequenceNumber
            Action Rules 
                if (MobileSupplyChainPurchaseOrderReceipt.ErrorMessage not entered
                and MobileSupplyChainPurchaseOrderReceiptLine.ErrorMessage not entered)
                    if (PurchaseOrderReceiptLineRel.IsUDIRequiredAtReceipt)
                        invoke Create PurchaseOrderUDIDetail
                            invoked.Company                                                 = Company
                            invoked.Location                                                = MobileSupplyChainPurchaseOrderReceiptLine.ShipToLocation
                            invoked.PurchaseOrderUDIDetail.PurchaseTransactionDocumentType  = PurchaseTransactionDocumentType.Receiving
                            invoked.PurchaseOrderUDIDetail.DocumentNumberNumeric            = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                            invoked.PurchaseOrderUDIDetail.LineNumber                       = MobileSupplyChainPurchaseOrderReceiptLine.PurchaseOrderReceiptLine
                            invoked.Item                                                    = Item
                            invoked.SourceDocumentAlpha                                     = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                            invoked.GTIN                                                    = GTIN
                            invoked.ManufacturingDate                                       = UDIManufacturingDate
                            invoked.ExpirationDate                                          = UDIExpirationDate
                            invoked.Lot                                                     = Lot
                            invoked.SerialNumber                                            = Serial
                            invoked.UOM                                                     = MobileSupplyChainPurchaseOrderReceiptLine.ReceivedUOM
                            invoked.StockUOM                                                = Item.StockUOM
                            invoked.Quantity                                                = Quantity

                        LocalUDIDetailDocumentType     = PurchaseTransactionDocumentType.Receiving
                        LocalUDIDetailDocumentNumber   = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                        LocalUDIDetailLineNumber       = MobileSupplyChainPurchaseOrderReceiptLine.PurchaseOrderLine
                        LocalUDIDetailSequence         = SequenceNumber

                        if (PurchaseOrderReceiptLineRel.IsBinTracked)
                            invoke Create PurchaseOrderTransactionDetail
                                invoked.Company                                                        = Company
                                invoked.PurchaseOrderReceipt                                           = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                                invoked.PurchaseOrderTransactionDetail.PurchaseTransactionDocumentType = PurchaseTransactionDocumentType.Receiving
                                invoked.PurchaseOrderTransactionDetail.DocumentNumberNumeric           = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                                invoked.SourceDocumentAlpha                                            = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                                invoked.PurchaseOrderTransactionDetail.LineNumber                      = MobileSupplyChainPurchaseOrderReceiptLine.PurchaseOrderReceiptLine
                                invoked.Bin                                                            = Bin
                                if (IsCatchWeightItem)
                                    invoked.Quantity                                                   = CatchWeight
                                    invoked.SecondaryQuantity                                          = Quantity
                                else
                                    invoked.Quantity                                                   = Quantity
                        
                    else
                    if (HasPurchaseOrderTransactionDetail)
                        invoke Create PurchaseOrderTransactionDetail
                            assign result to PurchaseOrderTransactionDetailView
                            invoked.Company                                                        = Company
                            invoked.PurchaseOrderReceipt                                           = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                            invoked.PurchaseOrderTransactionDetail.PurchaseTransactionDocumentType = PurchaseTransactionDocumentType.Receiving
                            invoked.PurchaseOrderTransactionDetail.DocumentNumberNumeric           = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                            invoked.SourceDocumentAlpha                                            = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                            invoked.PurchaseOrderTransactionDetail.LineNumber                      = MobileSupplyChainPurchaseOrderReceiptLine.PurchaseOrderReceiptLine
                            invoked.Lot                                                            = Lot
                            invoked.Serial                                                         = Serial
                            invoked.Bin                                                            = Bin
                            if (MobileSupplyChainPurchaseOrderReceiptLine.IsLotRequiredAtReceipt)
                                invoked.LotExpirationDate                                          = LotExpirationDate
                                if (MobileSupplyChainPurchaseOrderReceiptLine.ItemLocationRel.IsAWarehouseLocationItem)
                                    invoked.ManufacturingDate                                      = ManufacturingDate
                                    invoked.ShelfLife                                              = ShelfLife
                            if (IsCatchWeightItem)
                                invoked.Quantity                                                   = CatchWeight
                                invoked.SecondaryQuantity                                          = Quantity
                            else
                                invoked.Quantity                                                   = Quantity

                        LocalDetailDocumentType     = PurchaseTransactionDocumentType.Receiving
                        LocalDetailDocumentNumber   = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                        LocalDetailLineNumber       = MobileSupplyChainPurchaseOrderReceiptLine.PurchaseOrderLine
                        LocalDetailSequence         = SequenceNumber

                    if(TrackingNumber entered)                        
                        invoke Create MobileSupplyChainPurchaseOrderReceiptTracking
                            invoked.Company                                                        = Company
                            invoked.TrackingNumber                                                 = TrackingNumber
                            invoked.Quantity                                                       = Quantity
                            invoked.PurchaseOrderReceipt                                           = MobileSupplyChainPurchaseOrderReceipt.PurchaseOrderReceipt
                            invoked.PurchaseOrderReceiptLine                                       = MobileSupplyChainPurchaseOrderReceiptLine.PurchaseOrderReceiptLine
                            invoked.PurchaseOrderUDIDetail.PurchaseTransactionDocumentType         = LocalUDIDetailDocumentType
                            invoked.PurchaseOrderUDIDetail.DocumentNumberNumeric                   = LocalUDIDetailDocumentNumber
                            invoked.PurchaseOrderUDIDetail.LineNumber							   = LocalUDIDetailLineNumber
                            invoked.PurchaseOrderUDIDetail.TransactionSequence					   = LocalUDIDetailSequence
                            invoked.PurchaseOrderTransactionDetail.PurchaseTransactionDocumentType = LocalDetailDocumentType
                            invoked.PurchaseOrderTransactionDetail.DocumentNumberNumeric           = LocalDetailDocumentNumber
                            invoked.PurchaseOrderTransactionDetail.LineNumber                      = LocalDetailLineNumber 
                            invoked.PurchaseOrderTransactionDetail.TransactionSequence             = LocalDetailSequence

        Update is an Update Action
            restricted

        Delete is a Delete Action
            restricted
