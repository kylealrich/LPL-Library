TrueCostAllocation is a BusinessClass
	default label is "True\CostAllocation"
    owned by truecost
    prefix is TCALL

    Ontology
    	symbolic key is TrueCostAllocation
    	
    Patterns
    	implements ContextualParent

    Persistent Fields

        Description
        AllowMultiplePostings				is Boolean
        AllocationGroup
		Allocation
		
    Relations

    	TrueCostAllocatonLinePracticalCapacityVolumeRel
    		one-to-many relation to TrueCostAllocationLine
    		Field Mapping uses ByWithinDepartment
 				related.TrueCostConfiguration				= TrueCostConfiguration
 				related.TrueCostAllocationControl			= TrueCostAllocationControl
 				related.IsWithinDepartment					= true
 				related.TrueCostAllocation					= TrueCostAllocation
			Instance Selection
				where (related.Active
				and related.UseActualVolume = false)
		UnutilizedCapacityCostObjectRel
    		one-to-one relation to UnutilizedCapacityCostObject
    		Field Mapping uses symbolic key
    			related.TrueCostConfiguration 							= TrueCostConfiguration
    			related.UnutilizedCapacityCostObject.Structure			= TrueCostAllocationControl.CostObjectStructure
    			related.UnutilizedCapacityCostObject.SummaryCostObject 	= TrueCostAllocatonLinePracticalCapacityVolumeRel.TargetCostObjects
    				
    Local Fields
    	LocalAllocationView					is a Allocation view

	Derived Fields

		AllocationCodeAndDescription  is a MessageField
			"<TrueCostAllocation>_-_<Description>"
	
	Transient Fields

	Field Rules

	Conditions

		PracticalCapacitySetup
			restricted
			when (TrueCostAllocatonLinePracticalCapacityVolumeRel exist
			and UnutilizedCapacityCostObjectRel not exist)
			

		RecordExists
			restricted
			when (TrueCostAllocation exists)
	Actions
 		Create is an Action
			Action Rules
				invoke Create Allocation
					assign result to LocalAllocationView
					invoked.FinanceEnterpriseGroup	= TrueCostConfiguration
					invoked.AllocationControl		= TrueCostAllocationControl.AllocationControl
					invoked.AllocationSourceSystem	= AllocationSourceSystem.TrueCost
					invoked.Allocation				= TrueCostAllocation
					invoked.Description				= Description
					invoked.SourceLedger			= TrueCostAllocationControl.SourceLedger
					invoked.Ledger					= TrueCostAllocationControl.ActualsLedger 
					invoked.AllowMultiplePostings	= AllowMultiplePostings
					invoked.AllocationGroup			= AllocationGroup
					
				Allocation	= LocalAllocationView.Allocation
			
			Exit Rules

    	Update is an Update Action
			Action Rules
				invoke Update Allocation
					invoked.Description				= Description
					invoked.AllowMultiplePostings	= AllowMultiplePostings
					invoked.AllocationGroup			= AllocationGroup
					initialize invoked.AccountStructure

    		Exit Rules

    	Delete is a Delete Action
    		Action Rules
    			invoke Delete Allocation
    	
