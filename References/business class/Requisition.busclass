Requisition is a BusinessClass
	owned by rq
	prefix is RQH
	classic name is REQHEADER

	Ontology
		symbolic key is Requisition
			classic set name is RQHSET1
			classic name is REQ-NUMBER

	Patterns
		implements StaticJava
		disable AuditIndex
		implements AnalyticCube
			disable continuous update
			dynamically calculate totals
			write to base level only
		implements BODId
		enable explicit context override

	Persistent Fields
		Requester
		DefaultDistributionAccount      is a RQHeaderDefaultCodeBlock
		DefaultGLEncumbranceReference   is AlphaUpper 60
		RequestingLocation
			classic name is REQ-LOCATION
		RequestedDeliveryDate			is Date
			classic name is REQ-DEL-DATE
		CreationDate					is TimeStamp
		ReferenceNumber
			classic name is REFERENCE-NO
		RequisitionDescription			is Alpha size 30
			classic name is REQ-DESC
		RequisitionImport				is like RequisitionImport
		InterfaceInProcess				is Boolean
		OriginatingInterfaceRun			is a RequisitionInterfaceResult
			delete ignored
		FromCompanyLocation
		DeliverTo
		Vendor
		PurchaseFromLocation			is a VendorLocation
			classic name is PURCH-FR-LOC
		Buyer
			classic name is BUYER-CODE
		VendorName
		PrintRequisition				is Boolean
			classic name is PRINT-REQ-FL
		LastRequisitionLine				is a LineNumber
			classic name is LAST-LINE-NBR
			disable Auditing
		LastDeliverySequence			is a RequisitionSequence
			classic name is LAST-DEL-SEQ
			disable Auditing
		ReturnSequence					is a RequisitionSequence
			classic name is RETURN-SEQ
		Status							is Numeric size 1
			protected
			States
				Unreleased			value is 0
				Released			value is 1
				CreateInProgress	value is 2
				InProcess			value is 5
				ReleaseInProgress	value is 7
				Rejected			value is 8
				Processed			value is 9
		PurchaseOrderUserField1
			classic name is PO-USER-FLD-1
		PurchaseOrderUserField3			is a UserField2
			classic name is PO-USER-FLD-3
		PurchaseOrderUserField5			is a UserFld2
			classic name is PO-USER-FLD-5
		UserDate1						is Date
		UserDate2						is Date
		LastApprovalDate				is Date
			classic name is LAST-APRV-DT
		Approved						is Boolean
			classic name is APPROVED-FL
		AttainedLevel					is an ApprovalLevel
			classic name is ATTAIN-LEVEL
		ApprovalLevel
			classic name is APRV-LEVEL
		NumberOfLines
			protected
			classic name is NBR-LINES
			disable Auditing
		NumberOfClosedLines
			protected
			classic name is CLOSED-LINES
			disable Auditing
		Closed							is Boolean
			protected
			classic name is CLOSED-FL
		InventoryItemsTotal				is an InternationalAmount
			protected
			classic name is I-TOTAL
			disable Auditing
		NonstockItemsTotal				is an InternationalAmount
			protected
			classic name is N-TOTAL
			disable Auditing
		SpecialAndServiceItemsSTotal	is an InternationalAmount
			protected
			classic name is X-S-TOTAL
			default label is "SpecialAndServiceItemsTotal"
			disable Auditing
		Printed							is Boolean
			classic name is PRINTED-FL
		AllocationPriority
			classic name is ALLOC-PRI
		QuoteRequired					is Boolean
			classic name is QUOTE-FL
		ReturnNote						is a Note
		ReturnDate						is Date

		Asset
		AssetTemplate
		PurchaseTaxable					is Boolean
			classic name is PURCH-TAX-FL
		PurchaseTaxCode					is a TaxCode
			classic name is PURCH-TAX-CD
		OperatorID						is an Operator 
			holds pii
		Dropship						is Boolean
			classic name is DROPSHIP-FL
			default label is "ReceivingOptions"
		DropshipAddress					is a PostalAddressV2 
			holds pii
			classic name for DropshipAddress.DeliveryAddress.AddressLine1 is SH-ADDR1
			classic name for DropshipAddress.DeliveryAddress.AddressLine2 is SH-ADDR2
			classic name for DropshipAddress.DeliveryAddress.AddressLine3 is SH-ADDR3
			classic name for DropshipAddress.DeliveryAddress.AddressLine4 is SH-ADDR4
			classic name for DropshipAddress.Municipality is SH-CITY-ADDR5
			classic name for DropshipAddress.StateProvince is SH-STATE-PROV
			classic name for DropshipAddress.PostalCode is SH-POST-CODE
			classic name for DropshipAddress.County is SH-COUNTY
			classic name for DropshipAddress.Country is SH-COUNTRY-CD
		DropshipPhoneNumber				is an TelephoneNumber
			classic name for DropshipPhoneNumber.InternationalPrefix is SH-PHONE-PREF
			classic name for DropshipPhoneNumber.SubscriberNumber is SH-PHONE
			classic name for DropshipPhoneNumber.Extension is SH-PHONE-EXT
		DropshipContact					is an AddressContact 
			holds pii
			classic name is SH-CONTACT
		DropshipName					is a Name 
			holds pii
			classic name is SH-NAME
		ShippingNotes					is Text
		CapitalTotal                    is Decimal size 15.4
		TechnicalTotal                  is Decimal size 15.4
			classic name is TECH-TOTAL
		CapitalTechnicalTotal           is Decimal size 15.4
			classic name is CAP-TECH-TOTAL
		RequisitionRecordSource         is Numeric size 2
			classic name is RECORD-SOURCE
			States
				Rq10			value is 1
					default label is "RQ10"
				ERequisitions	value is 2
					default label is "E-Requisitions"
				Rq500			value is 3
					default label is "RQ500"
				Ic83			value is 4
					default label is "IC83"
				Ic142			value is 5
					default label is "IC142"
		ProcessFlowApprovalLevel
			classic name is PFLOW-APRV-LVL
		RequisitionApprovalType
			classic name is APPROVAL-TYPE
		BaseCurrencyCode				is a Currency
			classic name is BASE-CURR-CODE
			default label is "Currency"
		TransactionCurrencyCode			is a Currency
			classic name is TRAN-CURR-CODE
		PurchaseOrderBillToName			is a Name 
			holds pii
			classic name is POB-NAME
		PurchaseOrderBillToAddress		is a PostalAddressV2 
			holds pii
			classic name for PurchaseOrderBillToAddress.DeliveryAddress.AddressLine1 is POB-ADDR1
			classic name for PurchaseOrderBillToAddress.DeliveryAddress.AddressLine2 is POB-ADDR2
			classic name for PurchaseOrderBillToAddress.DeliveryAddress.AddressLine3 is POB-ADDR3
			classic name for PurchaseOrderBillToAddress.DeliveryAddress.AddressLine4 is POB-ADDR4
			classic name for PurchaseOrderBillToAddress.Municipality is POB-CITY-ADDR5
			classic name for PurchaseOrderBillToAddress.StateProvince is POB-STATE-PROV
			classic name for PurchaseOrderBillToAddress.PostalCode is POB-POSTAL-CD
			classic name for PurchaseOrderBillToAddress.County is POB-COUNTY
			classic name for PurchaseOrderBillToAddress.Country is POB-COUNTRY-CD
		PurchaseOrderBillToContact      is an AddressContact
			classic name is POB-CONTACT
		RequisitionSource               is a RqSource
			classic name is RQ-SOURCE
		OneSourceDocumentToOnePO        is Numeric size 1
			classic name is ONE-SRC-ONE-PO
			States
				NotApplicable value is 0
				No            value is 1
				Yes           value is 2
		ProcurementCardNumber
			classic name is PCARD-NBR
		SourcingEventRequired           is Boolean
			classic name is SS-EVENT-REQD
		PurchaseOrderBillToPhoneNumber  is an TelephoneNumber
			classic name for PurchaseOrderBillToPhoneNumber.InternationalPrefix is POB-PHONE-PREF
			classic name for PurchaseOrderBillToPhoneNumber.SubscriberNumber is POB-PHONE
			classic name for PurchaseOrderBillToPhoneNumber.Extension is POB-PHONE-EXT
		PurchaseOrderBillToEmailAddress is an EmailAddressMulti 
			holds pii
			sql name is POrderBillToEmailAddress
			classic name is POB-EMAIL-ADDR
		LocationRule                    is a WarehouseLocationRule
		ReleasedDate                    is TimeStamp
		ReleasingOperatorID             is an Operator 
			holds pii
			classic name is REL-OPER-ID
		ApprovedRejectedDate            is TimeStamp
			classic name is APR-REJ-DATE
		ApprovingRejectingOperatorID    is an Operator 
			holds pii
			classic name is APR-REJ-OPR-ID
		PurchaseOrderUserField7         is a UserFld7
			classic name is PO-USER-FLD-7
		CreatedBy                       is an Operator 
			holds pii
		LastUpdateDate                  is TimeStamp
			classic name is LAST-UPDT-DATE
		LastUpdateBy                    is an Operator 
			holds pii
		DefaultProcedureInformation 
			restricted
			classic name for DefaultProcedureInformation.DefaultProcedure is DFLT-PROC
			classic name for DefaultProcedureInformation.DefaultProcedureModifier is DFLT-PROC-MOD-
			classic name for DefaultProcedureInformation.DefaultProcedureDate is DFLT-PROC-DATE
			classic name for DefaultProcedureInformation.DefaultPractitioner is DFLT-PHYS-NAME
			classic name for DefaultProcedureInformation.DefaultNurseCoordinator is DFLT-NRS-COORD
			classic name for DefaultProcedureInformation.DefaultSalesRepresentative is DFLT-SALES-REP
			classic name for DefaultProcedureInformation.DefaultSupplierOrderNumber is DFLT-ORD-NBR
			classic name for DefaultProcedureInformation.DefaultRequester is DFLT-REQUESTOR
			classic name for DefaultProcedureInformation.DefaultUserDefined1 is DFLT-USERDEF1
			classic name for DefaultProcedureInformation.DefaultUserDefined2 is DFLT-USERDEF2
		PatientProcedure	
			restricted
			context of FromCompanyLocation.FromCompany
			delete ignored
		DefaultBillCode                 is a ConsignCode
			classic name is DFLT-CN-CODE
		GlobalDocumentType
			classic name is GLBL-DOC-TYPE
		ProcurementTemplate
		BudgetEditProcessing 			is Numeric size 1
			States
				NotInProcessing value is 0
				InProcess  		value is 1
				Failure    		value is 2
				Success    		value is 3
		AOCTotal						is an InternationalAmount
			protected
			disable Auditing
		HeaderAddOnChargeTotal			is an InternationalAmount
			protected
			disable Auditing
		LineAddOnChargeTotal			is an InternationalAmount
			protected
			disable Auditing
		ExtendedAmountTotal				is an InternationalAmount
			protected
			disable Auditing
		CurrencyTable
		RequisitionReleaseMessages 		is Numeric size 1
			States
				NoMessage value is blank
				RequisitionAmountLessThanVendorMinimumOrderAmount value is 1
					default label is "CannotRelease,RequisitionAmountLessThanVendorMinimumOrderAmount"
				RequisitionAmountLessThanPurchFromLocMinimumOrderAmount value is 2
					default label is "CannotRelease,RequisitionAmountLessThanPurchaseFromLocationMinimumOrderAmount"
		POCode
		CommodityCode                   is a CommCodes
		DefaultCommentType						is AlphaUpper size 1
			States
				PrintOnInternalDocuments	value is "I"
				PrintOnPurchaseOrder		value is "P"
				PrintOnPurchaseOrderTrailer	value is "T"
				PrintOnReceivingDocument	value is "R"
				PrintOnPickList				value is "L"
				PrintOnDeliveryTicket		value is "D"
				PrintOnRequisition			value is "Q"
				DisplayOnlyOnInternalDocuments value is "S"
				DisplayOnly					value is "O"
				InvoiceComments				value is "N"
		EAMWorkOrder
		EAMWorkOrderActivity
		TrialNotice                     is a RecallNotice
		AribaPOType
		QuoteNumber                              is Alpha size 30
		Confirming                               is Boolean
		IDMDocumentPID					is an IDMPID
			protected
			restricted
		IDMJob
			protected
			restricted
		ExternalRequisition				is an ExternalReqNbr  
		RequisitionStatusValue			is Numeric size 1
			States
				Closed	   				value is 1
				Unreleased 				value is 2
				Released   				value is 3
				InProcess  				value is 4
				Processed  				value is 5
				Rejected   				value is 6
				ReleaseInProgress		value is 7
				CreateInProgress		value is 8
		Printer 						is an IDMPrinter
	   	SupplierCreated                 is Numeric size 1
	   		States
	   			NotApplicable               value is 0
	   			Created                     value is 1
	   			Submitted                   value is 2
				Approved                    value is 3
				Rejected                    value is 4
		ForCapitatedProcedure           is Boolean
		DeliveryMethod
		

	Transient Fields
		TransientAccountingEntity		is an AccountingEntity		
			derive value from DerivedAccountingEntity				
		TransientCreateDate				is an ExchangeDate			
			derive value from DerivedCreationDate					
		TransientPostingDate			is a PostingDate			
			derive value from DerivedCreationDate					
		DefaultCommentCode              			is a StandardCommentCode
		DropshipRequestingLocation      			is Boolean
		DropshipRequester               			is Boolean
		CurrentApprover                 			is an Employee
		DropShipDefaulting 							is Numeric size 1
			default label is "Default_address_from"
			States
                None		 						value is 0
					default label is "ManualEntry"
                RequestingLocationAddress			value is 1
					default label is "RequestingLocation"
        		RequesterAddress					value is 2   
					default label is "Requester"
				ClearDefaults						value is 3
		ReceivingOptions						is Numeric size 1
			derive value from Dropship
			States
				ReceivingRequired			value is 0
				ReceivingNotAllowed			value is 1

		FillOrKill
			derive value from RequestingLocation.FillOrKill

		TransientCopyAllLines						is Boolean
		LastItemQuantity							is a Quantity
			derive value from last RequisitionLinesRel.Quantity
			precision is last RequisitionLinesRel.DerivedNumberOfDecimalsQuantity
		LastItemUOM									is a UnitOfMeasure
			derive value from last RequisitionLinesRel.EnteredUOM
		LastItemDescription							is a Description
			derive value from last RequisitionLinesRel.Description
		PreviousItemQuantity						is a Quantity
			derive value from PreviousRequisitionLineRel.Quantity
			precision is PreviousRequisitionLineRel.DerivedNumberOfDecimalsQuantity
		PreviousItemUOM								is a UnitOfMeasure
			derive value from PreviousRequisitionLineRel.EnteredUOM
		PreviousItemDescription						is a Description
			derive value from PreviousRequisitionLineRel.Description
		TransientCreatedProcurementTemplate			is a ProcurementTemplate


		TransientVisitNumber					 is a PatientVisit
			derive value from DerivedTranVisitNumber

		TransientPatientID                       is a Patient
			derive value from DerivedTranPatientID

		TransientCaseNumber						 is a CaseNumber
			derive value from DerivedTranCaseNumber

	   	TransientPatientLastName                 is a LastName
	   		derive value from DerivedTranPatientLastName

		TransientPatientFirstName                is a FirstName 
			holds pii
			derive value from DerivedTranPatientFirstName

		TransientPatientMiddleName            	 is a MiddleName
			derive value from DerivedTranPatientMiddleName

		TransientBirthdate						 is Date
			derive value from DerivedTranBirthdate

		TransientGender							 is a Gender
			derive value from DerivedTranGender

		TransientSocialSecurityNumber			 is a TaxID 
			holds pii
			derive value from DerivedTranSocialSecurityNumber

		TransientMaskSocialSecurityNumber		 is Boolean
		TransientFromMassRQCreateAndRelease      is Boolean
		TransientGLCalendarPeriod 				 is a GeneralLedgerCalendarPeriod	
			derive value from GeneralLedgerCalendarPeriodXrefRel.GeneralLedgerCalendarPeriod
		TransientQuantityMultiplier				 is a Quantity
		TransientAttachment						 is an Attachment
		TransientCommentTitle					 is a CommentName
		TransientStatus							 is Numeric size 2 
			States
				Unreleased 				value is 0
				Released   				value is 1
				CreateInProgress		value is 2
				InProcess  				value is 5
				ReleaseInProgress		value is 7
				Rejected   				value is 8
				Processed  				value is 9
				NeedsApproval			value is 10
			derive value from DerivedStatus
			default label is "Status"
			protected
		TransientTaxEntity						is a TaxEntity
			derive value from FromCompanyLocation.FromCompany.AccountingEntity
		TransientAllocationPriorityLevel        is an AllocationPriorityLevel
			derive value from DerivedAllocationPriorityLevel
		TransientRSSLPLRequisitionScreen				is Alpha size 1
			derive value from DerivedReturnYes

	Local Fields
		CalculateTax
		TaxOut                          			is Alpha 1
		Execute										is Boolean
		VerifySingleSourcePoDefaults
		CurrentVendor								is like Vendor
		CurrentPurchaseFromLocation					is like PurchaseFromLocation
		LocalContract                               is like Contract
		LocalContractLine							is like ContractLine
		LocalRequisitionLine                        is like RequisitionLine
		ValidatableAmount							is an InternationalAmount
		PurchaseFromAmount							is an InternationalAmount
		NeedsVendorValidation						is Boolean
		LocalPatientProcedureView       			is a PatientProcedure view
		LocalPatientProcedure						is like PatientProcedure
		LocalDeleteHeader 							is Boolean
		LocalActionCode								is an ActionCode
		LocalBODCurrentTimeStamp					is a BODCurrentTimeStamp
		LocalFinanceEnterpriseGroup 				is like FinanceEnterpriseGroup
		LocalAccountingEntity       				is an AccountingEntity
		LocalRequesterRestrictedAccount				is a FinanceCodeBlock	
		BODLineCount								is Numeric size 9		
		NativeLPLBODTrigger							is Boolean				
		LocalBODTrigger								is Boolean				
		LocalbodaccountingEntity 					is Alpha size 20		
		NewBODTracker  								is a FSMInboundBODTracker view
		LocalFSMInboundBODTracker					is Numeric 15
		LocalConfigurationParameter					is Alpha size up to 200
		Error            							is Boolean
	    ErrorMessage 
		LocalFunctionalAmount						is a CurrencyAmount
		LocalReportCurrencyExchangeGroup			is a ReportCurrencyExchangeGroup
	    

		IDMAttributes
		IDMGenerateDocument
		TimeStampInGMT
		AsyncId									is a AsyncActionRequest
		LocalPurgeCount					is Numeric 10
		LocalPurgeRecords				is Boolean
		LocalActor						is an Actor
		LocalTaxTotal					is an InternationalAmount
		LocalBuyer						is like Buyer
		LocalVendor						is like Vendor
		LocalProcurementTemplate        is like ProcurementTemplate
		AttributeCtr								is Numeric 2
		LocalExecute								is Boolean
		IDMXMLDefinition
		IDMItem
	Context Fields
		SearchDateRange					is a DateRange
		AccountingEntity
		AccountingUnit
		Account
		Project
		FinanceDimension1
		FinanceDimension2
		FinanceDimension3
		FinanceDimension4
		FinanceDimension5
		FinanceDimension6
		FinanceDimension7
		FinanceDimension8
		FinanceDimension9
		FinanceDimension10
		AuditDateRange					is a DateRange
		FSMInboundBODTracker
		
	Rule Blocks
		CreateWarehouseDemandHeader
			invoke Create WarehouseDemand
				if (LocalIsForSupply)
					invoked.Company							= Company
				else
					invoked.Company							= FromCompanyLocation.FromCompany
				invoked.WarehouseDemand.DemandSystemCode	= DemandSystemCode.Requisitions
				invoked.WarehouseDemand.DemandDocument		= Requisition
				invoked.WarehouseDemand.DemandCompany		= Company
				invoked.DocumentNumberNumeric				= Requisition
				invoked.Destination							= RequestingLocation
				invoked.RequirePickingFeedback				= FromCompanyLocation.FromLocation.WarehouseProcessType.RequirePickingFeedback
				invoked.RequirePackingFeedback				= FromCompanyLocation.FromLocation.WarehouseProcessType.RequirePackingFeedback
				if (Requisition.HasDropshipInfo)
					invoked.DestinationName					= DropshipName
					invoked.DestinationAddress				= DropshipAddress
				else
					invoked.DestinationName					= RequestingLocation.Name
					invoked.DestinationAddress				= RequestingLocation.PostalAddress
				invoked.RequireFreight						= WarehouseDemand.RequireFreight.NotAllowed

		SetIDMAttributes
			initialize IDMAttributes
			IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName		= "Company"
			IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue		= Company
			IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeName		= "CompanyName"
			IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeValue		= Company.Name
			IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeName		= "Requisition"
			IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeValue		= Requisition
			IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeName		= "Requester"
			IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeValue		= Requester
			IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeName		= "RequesterName"
			IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeValue		= Requester.Employee.Name.PreferredFirstAndLastName
			IDMAttributes.SingleValue.IDMAttribute[6].IDMAttributeName		= "RequestingLocation"
			IDMAttributes.SingleValue.IDMAttribute[6].IDMAttributeValue		= RequestingLocation
			
			if (IDMAdditionalAttributesLinesRel exists)
				AttributeCtr = 7
				include IDM.IDMAdditionalAttributes


			initialize LocalColSequence
			for each distinct Buyer in RequisitionLinesRel
				initialize LocalBuyer
				if (LocalColSequence < 100)
					LocalColSequence = LocalColSequence + 1
					if (each.Buyer entered)
						IDMAttributes.MultiValue1.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.Buyer
						LocalBuyer = each.Buyer
						IDMAttributes.MultiValue2.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = BuyerFromRequisitionLineRel.Buyer.Employee.Name.PreferredFirstAndLastName
				else
					end for each
			IDMAttributes.MultiValue1.IDMAttributeName  = "Buyer"
			IDMAttributes.MultiValue2.IDMAttributeName  = "BuyerName"
			

			initialize LocalColSequence
			for each distinct CommodityCode in RequisitionLinesRel
				if (LocalColSequence < 100)
					LocalColSequence += 1
					IDMAttributes.MultiValue3.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.CommodityCode
				else
					end for each
			IDMAttributes.MultiValue3.IDMAttributeName = "CommodityCode"


			initialize LocalColSequence
			for each distinct RequestedDeliveryDate in RequisitionLinesRel
				if (LocalColSequence < 100)
					LocalColSequence += 1
					IDMAttributes.MultiValue4.IDMAttributeDateOccurs.IDMAttributeDate[LocalColSequence] = each.RequestedDeliveryDate
				else
					end for each
			IDMAttributes.MultiValue4.IDMAttributeName = "RequestedDeliveryDate"


			initialize LocalColSequence
			for each distinct FromCompanyLocationBin.FromLocation in RequisitionLinesRel
				if (LocalColSequence < 100)
					LocalColSequence += 1
					IDMAttributes.MultiValue5.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.FromCompanyLocationBin.FromLocation
				else
					end for each
			IDMAttributes.MultiValue5.IDMAttributeName = "FromLocation"


			initialize LocalColSequence
			for each distinct DistributionAccount.Project in RequisitionLineDistributionsRel
				if (LocalColSequence < 100)
					LocalColSequence += 1
					IDMAttributes.MultiValue6.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.DistributionAccount.Project
				else
					end for each
			IDMAttributes.MultiValue6.IDMAttributeName = "Project"


			initialize LocalColSequence
			for each distinct Vendor in RequisitionLinesRel
				initialize LocalVendor
				if (LocalColSequence < 100)
					LocalColSequence += 1
					if (each.Vendor entered)
						IDMAttributes.MultiValue7.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.Vendor
						LocalVendor = each.Vendor
						IDMAttributes.MultiValue8.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = VendorFromRequisitionLineRel.VendorName
				else
					end for each
			IDMAttributes.MultiValue7.IDMAttributeName = "Vendor"
			IDMAttributes.MultiValue8.IDMAttributeName = "VendorName"


		CopyStandardCommentCode
			invoke Create RequisitionComment
				fill in fields from this instance
				invoked.CommentTitle 		= StandardCommentCodeRel.CommentName
				invoked.CommentType  		= StandardCommentCodeRel.StandardCommentPrintCode
				invoked.CommentText  		= StandardCommentCodeRel.CommentText
				invoked.Attachment.File   	= StandardCommentCodeRel.Attachment.File
				invoked.Attachment.MimeType = StandardCommentCodeRel.Attachment.MimeType
				invoked.Attachment.Title   	= StandardCommentCodeRel.Attachment.Title
			initialize DefaultCommentCode

		DefaultDropShipInfo
			if (DropshipRequestingLocation
			or  DropshipRequester)

				if (DropshipRequestingLocation)
			 		constraint (not DropshipRequester)
						"CanDropshipToRequestingLocationOrToRequester;NotBoth"

					initialize DropshipRequestingLocation
					Dropship			   = true
					DropshipName           = RequestingLocation.Name
					DropshipAddress        = RequestingLocation.PostalAddress

				if (DropshipRequester)
					constraint (not DropshipRequestingLocation)
						"CanDropshipToRequestingLocationOrToRequester;NotBoth"

					initialize DropshipRequester
					Dropship			   = true
					DropshipName           = Requester.Name
					DropshipPhoneNumber    = Requester.UseForWorkPhone.ContactDetail.Telephone		
					DropshipAddress        = Requester.RequesterPostalAddress

		HeaderEdit

			initialize VerifySingleSourcePoDefaults
			if (OneSourceDocumentToOnePO.NotApplicable)
				VerifySingleSourcePoDefaults.PosngsrcInCompany			= FromCompanyLocation.FromCompany
				VerifySingleSourcePoDefaults.PosngsrcInReqCompany   	= Company
				VerifySingleSourcePoDefaults.PosngsrcInSyatem			= "RQ"
				VerifySingleSourcePoDefaults.PosngsrcInIcLocation		= FromCompanyLocation.FromLocation
				VerifySingleSourcePoDefaults.PosngsrcInRqLocation		= RequestingLocation
				VerifySingleSourcePoDefaults.PosngsrcInVendor			= Vendor
				VerifySingleSourcePoDefaults.PosngsrcInVendorLocation	= PurchaseFromLocation
				VerifySingleSourcePoDefaults.PosngsrcInOneSrcOnePo		= 0
				VerifySingleSourcePoDefaults.PosngsrcInVendorGroup		= Vendor.VendorGroup
				Execute = VerifySingleSourcePoDefaults.VerifySingleSourcePo
				OneSourceDocumentToOnePO = VerifySingleSourcePoDefaults.PosngsrcOutRqOneSrcOnePo

		ClearCurrentRequisitionForRQC
			if (Requester.CurrentRequisitionForRQC = Requisition)
				invoke UpdateCurrentRequisitionForRQC Requester
					invoked.PrmCompany				= 0
					invoked.PrmRequisition     		= 0

		ClearCurrentPunchoutContextForRQC
			invoke UpdateCurrentPunchoutContextforRQC Requester
				invoked.PrmPunchoutURL = ""
				invoked.PrmPunchoutDataRecordKey = ""
				invoked.PrmHROrganization = 0
				invoked.PrmRequester = 0
				invoked.PrmVendorGroup = 0
				invoked.PrmVendor = 0
				invoked.PrmPunchoutVendor = 0
				invoked.PrmEnhancedPunchoutSetupRequest = false
				invoked.PrmRequisition = 0

		ReleaseLimitsValidation
			initialize CurrentVendor
			initialize CurrentPurchaseFromLocation

			initialize ValidatableAmount
			initialize PurchaseFromAmount
			initialize RequisitionReleaseMessages
			if (VendorEditRequisitionLineRel exists)
				for each VendorEditRequisitionLineRel
					if (CurrentVendor not entered or (CurrentVendor != each.Vendor))
						if (CurrentVendor entered)
							if (not AmountGreaterThanVendorMinimumOrder)
								RequisitionReleaseMessages = RequisitionReleaseMessages.RequisitionAmountLessThanVendorMinimumOrderAmount
								end for each

							if (CurrentPurchaseFromLocation entered)
								if (BelowLocationMinimumOrderAmount)
									RequisitionReleaseMessages = RequisitionReleaseMessages.RequisitionAmountLessThanPurchFromLocMinimumOrderAmount
									end for each

						CurrentVendor					= each.Vendor
						ValidatableAmount				= each.ApprovalValue

						if (each.PurchaseFromLocation entered)
							CurrentPurchaseFromLocation		= each.PurchaseFromLocation
							PurchaseFromAmount				= each.ApprovalValue

					else
						if (CurrentPurchaseFromLocation entered)
							if (CurrentPurchaseFromLocation = each.PurchaseFromLocation)
								PurchaseFromAmount				+= each.ApprovalValue
							else
								if (BelowLocationMinimumOrderAmount)
									RequisitionReleaseMessages = RequisitionReleaseMessages.RequisitionAmountLessThanPurchFromLocMinimumOrderAmount
									end for each
								CurrentPurchaseFromLocation		= each.PurchaseFromLocation
								PurchaseFromAmount				= each.ApprovalValue
						else 
							if (each.PurchaseFromLocation entered)
								CurrentPurchaseFromLocation		= each.PurchaseFromLocation
								PurchaseFromAmount				= each.ApprovalValue
						ValidatableAmount	+= each.ApprovalValue

				if (RequisitionReleaseMessages not entered and CurrentPurchaseFromLocation entered)
					if (BelowLocationMinimumOrderAmount)
						RequisitionReleaseMessages = RequisitionReleaseMessages.RequisitionAmountLessThanPurchFromLocMinimumOrderAmount

				if (RequisitionReleaseMessages not entered and CurrentVendor entered)
					if (not AmountGreaterThanVendorMinimumOrder)
						RequisitionReleaseMessages = RequisitionReleaseMessages.RequisitionAmountLessThanVendorMinimumOrderAmount

		CheckPHIProcedureInformation
			if (HasPatientProcedureRecord)
				invoke Update PatientProcedure
					invoked.VisitNumber				= TransientVisitNumber
					invoked.PatientID				= TransientPatientID
					invoked.CaseNumber				= TransientCaseNumber
					invoked.PatientLastName			= TransientPatientLastName
					invoked.PatientFirstName		= TransientPatientFirstName
					invoked.PatientMiddleName		= TransientPatientMiddleName
					invoked.Birthdate				= TransientBirthdate
					invoked.Gender					= TransientGender
					invoked.SocialSecurityNumber	= TransientSocialSecurityNumber
				
			else
			if (HasPHIDefaultProcInfo)
				invoke Create PatientProcedure
					assign result to LocalPatientProcedureView
					invoked.Company					= FromCompanyLocation.FromCompany
					invoked.VisitNumber				= TransientVisitNumber
					invoked.PatientID				= TransientPatientID
					invoked.CaseNumber				= TransientCaseNumber
					invoked.PatientLastName			= TransientPatientLastName
					invoked.PatientFirstName		= TransientPatientFirstName
					invoked.PatientMiddleName		= TransientPatientMiddleName
					invoked.Birthdate				= TransientBirthdate
					invoked.Gender					= TransientGender
					invoked.SocialSecurityNumber	= TransientSocialSecurityNumber
					invoked.RecordType		 		= 1

				PatientProcedure = LocalPatientProcedureView.PatientProcedure



		NativeLPLRequisitionTriggerCheck
			invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
				invoked.PrmVerb 					= 1
				invoked.PrmNoun						= "Requisition"
				invoked.PrmDirection				= 1
				invoked.PrmTriggerFrom				= "Requisition"
				invoked.PrmFinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				invoked.PrmAccountingEntity 		= Company.AccountingEntity
				invoked.PrmCompany 					= Company
				invoked.PrmMainUserTemplate 		= "IONRequisitionXML_ST"
			NativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger



		CalculateTaxTotal
			initialize LocalTaxTotal
				for each RequisitionLinesRel
					LocalTaxTotal += each.InvoicedTaxAmount
					LocalTaxTotal += each.AccruedTaxAmount

		CheckRequesterRestrictedAccount
			if (HasRequesterRestrictionsAllow or HasRequesterRestrictionsDisallow)
				if (Company.ItemGroup.StructureRow.Type.AccountingEntity)
					LocalRequesterRestrictedAccount.Ledger						= Company.ItemGroup.FinanceEnterpriseGroup.CoreLedger
					LocalRequesterRestrictedAccount.ToAccountingEntity			= DefaultDistributionAccount.ToAccountingEntity

				if (Company.ItemGroup.StructureRow.Type.AccountingUnit)
					LocalRequesterRestrictedAccount.Ledger						= Company.ItemGroup.FinanceEnterpriseGroup.CoreLedger
					LocalRequesterRestrictedAccount.ToAccountingEntity			= DefaultDistributionAccount.ToAccountingEntity
					LocalRequesterRestrictedAccount.AccountingUnit				= DefaultDistributionAccount.AccountingUnit

				if (Company.ItemGroup.StructureRow.Type.Account)
					LocalRequesterRestrictedAccount.GeneralLedgerChartAccount 	= DefaultDistributionAccount.GeneralLedgerChartAccount

				if (Company.ItemGroup.StructureRow.Type.Project)
					LocalRequesterRestrictedAccount.Project						= DefaultDistributionAccount.Project

				if (Company.ItemGroup.StructureRow.Type.Dimension1)
					LocalRequesterRestrictedAccount.FinanceDimension1			= DefaultDistributionAccount.FinanceDimension1

				if (Company.ItemGroup.StructureRow.Type.Dimension2)
					LocalRequesterRestrictedAccount.FinanceDimension2			= DefaultDistributionAccount.FinanceDimension2

				if (Company.ItemGroup.StructureRow.Type.Dimension3)
					LocalRequesterRestrictedAccount.FinanceDimension3			= DefaultDistributionAccount.FinanceDimension3

				if (Company.ItemGroup.StructureRow.Type.Dimension4)
					LocalRequesterRestrictedAccount.FinanceDimension4			= DefaultDistributionAccount.FinanceDimension4

				if (Company.ItemGroup.StructureRow.Type.Dimension5)
					LocalRequesterRestrictedAccount.FinanceDimension5			= DefaultDistributionAccount.FinanceDimension5

				if (Company.ItemGroup.StructureRow.Type.Dimension6)
					LocalRequesterRestrictedAccount.FinanceDimension6			= DefaultDistributionAccount.FinanceDimension6

				if (Company.ItemGroup.StructureRow.Type.Dimension7)
					LocalRequesterRestrictedAccount.FinanceDimension7			= DefaultDistributionAccount.FinanceDimension7

				if (Company.ItemGroup.StructureRow.Type.Dimension8)
					LocalRequesterRestrictedAccount.FinanceDimension8			= DefaultDistributionAccount.FinanceDimension8

				if (Company.ItemGroup.StructureRow.Type.Dimension9)
					LocalRequesterRestrictedAccount.FinanceDimension9			= DefaultDistributionAccount.FinanceDimension9

				if (Company.ItemGroup.StructureRow.Type.Dimension10)
					LocalRequesterRestrictedAccount.FinanceDimension10			= DefaultDistributionAccount.FinanceDimension10

				if (LocalRequesterRestrictedAccount entered)
					if (HasRequesterRestrictionsAllow)
						constraint (RequesterFinanceStructuresRel exists)
							"RequesterIsNotAllowedToUseThis<Company.ItemGroup.StructureRow.DisplayLabel>"

					if (HasRequesterRestrictionsDisallow)
						constraint (RequesterFinanceStructuresRel not exists)
							"RequesterIsNotAllowedToUseThis<Company.ItemGroup.StructureRow.DisplayLabel>"

		CreateUsingCopyFromTemplateExitRules
			if (TransientAttachment entered)
            	invoke Create RequisitionComment
			    	fill in fields from this instance
    				invoked.CommentTitle = TransientCommentTitle
    				invoked.Attachment   = TransientAttachment

			if (TransientCopyAllLines)
				if (instance count of ProcurementTemplate.ValidProcurementTemplateLinesRel > 50)
					make transition to CreateInProgress
					RequisitionStatusValue = RequisitionStatusValue.CreateInProgress

					invoke CreateRequisitionLineFromTemplateLineSet ProcurementTemplateLine in background
						invoked.PrmProcurementGroup			= ProcurementTemplate.ProcurementGroup
						invoked.PrmProcurementTemplate		= ProcurementTemplate
						invoked.PrmInventoryCompany			= Company
						invoked.PrmRequisition				= Requisition
						invoked.PrmCopyAllLines 			= TransientCopyAllLines
				else
					invoke CreateRequisitionLineFromTemplateLineSet ProcurementTemplateLine in foreground
						invoked.PrmProcurementGroup			= ProcurementTemplate.ProcurementGroup
						invoked.PrmProcurementTemplate		= ProcurementTemplate
						invoked.PrmInventoryCompany			= Company
						invoked.PrmRequisition				= Requisition
						invoked.PrmCopyAllLines 			= TransientCopyAllLines

		InventoryLocationStatusValidation
			constraint (FromCompanyLocation.FromLocation.Status.Active)
				"InventoryLocation<FromCompanyLocation.FromLocation>MustBeActive"

	Derived Fields

		DerivedIDMDocumentLink is a DerivedField
			type is Alpha 2083
			IDMItem.DocumentType = "FSM_Requisition" 
			if (IDMDocumentPID entered)
				IDMItem.IDMUniqueId	= IDMDocumentPID 
	   			return IDMItem.GetLink

		DerivedAccountingEntity is a DerivedField			
			type is like AccountingEntity					
			restricted										
			return Company.AccountingEntity					

		DerivedCreationDate is a DerivedField
			type is Date
			TimeStampInGMT.Value = CreationDate
			return TimeStampInGMT.CorporateDate

		DerivedRequsitionAmountCurrency is a DerivedField
			type is Alpha up to 27
			default label is "Amount"
			return ApprovalValue + " " + BaseCurrencyCode

		CommentsExistMessage is a MessageField
			"Has_Comments"

		LineErrorsMessage is a MessageField
			"Line_Errors"

		TotalCurrencyField is a DerivedField
			type is Alpha up to 31
			default label is "Total"
			return ApprovalValue + " " + BaseCurrencyCode.Currency
		

		DerivedTranVisitNumber is a DerivedField
			type is AlphaUpper size 20
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.VisitNumber
		DerivedTranPatientID is a DerivedField
			type is AlphaUpper size 20
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.PatientID
		DerivedTranCaseNumber is a DerivedField
			type is like CaseNumber
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.CaseNumber
		DerivedTranPatientLastName	is a DerivedField 
			type is like LastName
			holds pii
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.PatientLastName
		DerivedTranPatientFirstName	is a DerivedField 
			type is like FirstName
			holds pii
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.PatientFirstName
		DerivedTranPatientMiddleName is a DerivedField 
			type is like MiddleName
			holds pii
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.PatientMiddleName
		DerivedTranBirthdate		is a DerivedField
			type is Date
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.Birthdate
		DerivedTranGender  			is a DerivedField
			type is like Gender
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.Gender
		DerivedTranSocialSecurityNumber is a DerivedField 
			type is like TaxID
			holds pii
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.SocialSecurityNumber

		MatchesProjectSearch		is a DerivedField
			type is Boolean
			if ((Project entered
			and  ProjectCommitmentRel exists)
			or   !Project entered)
				return true

		MatchesFinDim1Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension1 entered
			and  Dimension1CommitmentRel exists)
			or   !FinanceDimension1 entered)
				return true

		MatchesFinDim2Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension2 entered
			and  Dimension2CommitmentRel exists)
			or   !FinanceDimension2 entered)
				return true

		MatchesFinDim3Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension3 entered
			and  Dimension3CommitmentRel exists)
			or   !FinanceDimension3 entered)
				return true

		MatchesFinDim4Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension4 entered
			and  Dimension4CommitmentRel exists)
			or   !FinanceDimension4 entered)
				return true

		MatchesFinDim5Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension5 entered
			and  Dimension5CommitmentRel exists)
			or   !FinanceDimension5 entered)
				return true

		MatchesFinDim6Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension6 entered
			and  Dimension6CommitmentRel exists)
			or   !FinanceDimension6 entered)
				return true

		MatchesFinDim7Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension7 entered
			and  Dimension7CommitmentRel exists)
			or   !FinanceDimension7 entered)
				return true

		MatchesFinDim8Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension8 entered
			and  Dimension8CommitmentRel exists)
			or   !FinanceDimension8 entered)
				return true

		MatchesFinDim9Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension9 entered
			and  Dimension9CommitmentRel exists)
			or   !FinanceDimension9 entered)
				return true

		MatchesFinDim10Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension10 entered
			and  Dimension10CommitmentRel exists)
			or   !FinanceDimension10 entered)
				return true

		MatchesAccountSearch		is a DerivedField
			type is Boolean
			if ((Account entered
			and  AccountCommitmentRel exists)
			or   Account !entered)
				return true

		MatchesAccountingUnitSearch		is a DerivedField
			type is Boolean
			if ((AccountingUnit entered
			and  AccountingUnitCommitmentRel exists)
			or   AccountingUnit !entered)
				return true

		MatchesAccountingEntitySearch	is a DerivedField
			type is Boolean
			if ((AccountingEntity entered
			and  AccountingEntityCommitmentRel exists)
			or   AccountingEntity !entered)
				return true

		DraftMessage						is a MessageField
			restricted
			"Draft"
		IssuedMessage						is a MessageField
			restricted
			"Original"

		CreateMessage is a LabelField
			restricted
			"CreateRequisition"

		RequisitionTitle is a LabelField
			restricted
			"Requisition<Requisition>"

		DerivedFormTitle is a DerivedField
			type is MessageField
			if (RecordExists)
				return RequisitionTitle
			else
				return CreateMessage

		DerivedFileName			is a DerivedField
			type is Alpha 50
			restricted
			if (IsProcessedOrRejected)
				return "Company " + Company + " Requisition " + Requisition + " Final Document"
			else
				return "Company " + Company + " Requisition " + Requisition + " Draft Document"

		DerivedIssueStatus			is a DerivedField
			type is Alpha 8
			if (IsProcessedOrRejected)
				return IssuedMessage
			else
				return DraftMessage

		ContextMessageEntityType is a StringField
			type is Alpha 30
			restricted
			"InforRequisition"

		ContextMessageText is a MessageField
			restricted
			"Requisition<Requisition>"

		RequesterEmailAddress is a DerivedField
			type is like EmailAddress
			restricted
			return Requester.Employee.EmployeeWorkEmailAddress

		ReleaseWithBudgetEditsMessage is a MessageField
			restricted
			"RequisitionWillBeReleasedIfBudgetEditsArePassed"

		ReleaseNoEditsMessage is a MessageField
			restricted
			"ReleaseComplete"

		ReleaseMessage is a DerivedField
			type is Text
			restricted
			if (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
			and CommitmentsExist)
   				return ReleaseWithBudgetEditsMessage
   			else
   				return ReleaseNoEditsMessage

		ApprovalValue                   is a DerivedField
			type is like InternationalAmount
			classic name is APPROVAL-VAL
			default label is "Total"
			return (InventoryItemsTotal + NonstockItemsTotal + SpecialAndServiceItemsSTotal + AOCTotal)

		DerivedTaxTotal                 is a DerivedField
			type is like InternationalAmount
			default label is "Tax Total"
			include CalculateTaxTotal
			return LocalTaxTotal

		CompanyAndRequisition           is a StringField
			type is Alpha size 11
			restricted
			classic name is WF-CO-REQ-NBR
			Company
			Requisition

		ClosedMessage                   is a MessageField
			restricted
			"Closed"

		UnreleasedMessage               is a MessageField
			restricted
			"Unreleased"

		InterfaceInProcessMessage		is a MessageField
			restricted
			"Unreleased.InterfaceInProcess"

		CreateInProgressMessage			is a MessageField
			restricted
			"Unreleased.CreateInProgress"

		NeedsApprovalMessage            is a MessageField
			restricted
			"Needs_\Approval"

		InProcessMessage                is a MessageField
			restricted
			"In_\Process"

		ProcessedMessage                is a MessageField
			restricted
			"Processed"

		RejectedMessage                 is a MessageField
			restricted
			"Rejected"

		ReleaseInProgressMessage		is a MessageField
			restricted
			"ReleaseInProgress"

		ReturnFromRequisitionCreatedMessage is a MessageField
			restricted
			"ReleaseCompleted;RequisitionHasBeenCreated<Requisition>"

		CopyFromRequisitionCreatedMessage is a MessageField
			restricted
			"RequisitionHasBeenCreated<Requisition>"

		RequisitionLinesCopiedMessage 	is a MessageField
			restricted
			"LinesFromRequisition<Requisition>HaveBeenCopied"

		BatchRequisitionLinesCopiedMessage 	is a MessageField
			restricted
			"LinesFromRequisition<Requisition>HaveBeenCopied_(ProcessRunningInBackground)"

		DerivedStatus					is a DerivedField 
			type is Numeric size 2
			if (NeedsApproval)
				return 10
			return Status

		DerivedStatusMessage            is a DerivedField	
			type is MessageField
			default label is "Status"
			if (IsUnreleased)
				if (InterfaceInProcess)
					return InterfaceInProcessMessage
				else
					return UnreleasedMessage
			else
				if (NeedsApproval)
					return NeedsApprovalMessage
				else
					if (Status.Processed
					and UnreleasedRequisitionLinesRel not exists)
						if (IsClosedStatus)
							return ClosedMessage
						else
							return ProcessedMessage
					else
						if (Status.InProcess)
							return InProcessMessage
						else
							if (IsRejectedStatus)
								return RejectedMessage
							else
								if (IsReleaseInProgress)
									return ReleaseInProgressMessage
								else
								if (IsCreateInProgress)
									return CreateInProgressMessage
								else
									return blank

		DerivedStatusValue            is a DerivedField	
			type is Numeric 2
			if (IsClosedStatus
			and not IsRejectedStatus)
				return 1
			else
			if (IsUnreleased)
				return 2
			else
			if (IsReleasedStatus)
				return 3
			else
			if (Status.InProcess)
				return 4
			else
			if (Status.Processed)
				return 5
			else
			if (IsRejectedStatus)
				return 6
			else
			if (IsReleaseInProgress)
				return 7
			else
				return 0

		CommentCount                    is a DerivedField
			type is Alpha size up to 20
			restricted
			if (RequisitionCommentRel exists)
				return "(" + instance count of RequisitionCommentRel + ")"
			else
				return ""

		DerivedAppsValue				is a DerivedField
			type is like PfiAppsValue
			restricted
			return "RequisitionApproval" + UniqueID			

		UserActionRoutingAsHtml			is a DerivedField
			type is RichText
			return first PfiWorkunitRel.UserActionRoutingAsHtml

		UserActionRoutingAsJson			is a DerivedField
			type is Text
			return first PfiWorkunitRel.UserActionRoutingAsJson

		DerivedOneSourceToPO			is a DerivedField
			type is Numeric size 1
			restricted
			if (RequestingLocation.OneSourceDocumentToOnePO)
				return 2
			else
				return 1


		RequisitionCount is a DerivedField
			type is Numeric 1
			restricted
			return 1

		DerivedApprovedDimension is a DerivedField
			type is like YesOrNo
			restricted
			if (Approved)
				return "Y"
			else
				return "N"

		DerivedClosedDimension is a DerivedField
			type is like YesOrNo
			restricted
			if (Closed)
				return "Y"
			else
				return "N"

		DerivedDropshipDimension is a DerivedField
			type is like YesOrNo
			restricted
			if (Requisition.Dropship)
				return "Y"
			else
				return "N"


		DerivedHasWorkunit is a DerivedField
			type is Boolean
			return HasWorkunit

		HasCommentsForRSS is a DerivedField
			type is Boolean
			if (Requester.DerivedAllowAllCommentTypes = "N")
				if (RSSCommentRel exists)
					return true
				else
					return false
			else
				if (RequisitionCommentRel exists)
					return true
				else
					return false

		HasAttachmentForRSS is a DerivedField
			type is Boolean
			if (RSSAttachmentRel exists)
				return true
			else
				return false

		BudgetEditsInProgressMessage is a MessageField
			restricted
			"BudgetEditsInProgress"

		BudgetErrorsExistMessage is a MessageField
			restricted
			"BudgetErrorsExist"

		HasKilledQuantityMessage is a MessageField
			restricted
			"LinesHaveKilledQuantity"

		DerivedKilledQuantityMessage is a DerivedField
			type is Text
			if (HasKilledQuantity)
				return HasKilledQuantityMessage

		DerivedRequisitionMessages is a DerivedField
			type is Text
			if (BudgetEditInProgress)
				return BudgetEditsInProgressMessage
			if (HeaderBudgetErrorsExist)
				return BudgetErrorsExistMessage
			if (DistributionBudgetErrorsExist)
				return BudgetErrorsExistMessage

	   	DerivedCompany is a StringField
			type is Alpha size up to 87
			Company
			" - "
			Company.Name

		RequestingLocationAndName is a StringField
			type is Alpha size up to 101
			restricted
			RequestingLocation
			" - "
			RequestingLocation.Name

		DerivedRequestingLocation is a DerivedField
			type is Alpha size up to 101
			if (RequestingLocation entered)
				return RequestingLocationAndName

		VendorAndVendorName is a StringField
			type is Alpha size up to 42
			restricted
			Vendor
			" - "
			Vendor.VendorName

		DerivedVendor is a DerivedField
			type is Alpha size up to 42
			if (Vendor entered)
				return VendorAndVendorName

		PurchaseFromLocationAndVendorName is a StringField
			type is Alpha size up to 37
			restricted
			PurchaseFromLocation
			" - "
			PurchaseFromLocation.VendorName

		DerivedPurchaseFromLocation is a DerivedField
			type is Alpha size up to 37
			if (PurchaseFromLocation entered)
				return PurchaseFromLocationAndVendorName

		BuyerAndName is a StringField
			type is Alpha size up to 117
			restricted
			Buyer
			" - "
			Buyer.Name

		DerivedBuyer is a DerivedField
			type is Alpha size up to 117
			if (Buyer entered)
				return BuyerAndName

		ToAccountingEntityAndName is a StringField
			type is Alpha size up to 93
			restricted
			DefaultDistributionAccount.ToAccountingEntity
			" - "
			DefaultDistributionAccount.ToAccountingEntity.Name

		DerivedToAccountingEntity is a DerivedField
			type is Alpha size up to 93
			if (DefaultDistributionAccount.ToAccountingEntity entered)
				return ToAccountingEntityAndName

		AccountAndDescription is a StringField
			type is Alpha size up to 89
			restricted
			DefaultDistributionAccount.GeneralLedgerChartAccount
			" - "
			DefaultDistributionAccount.GeneralLedgerChartAccount.AccountDescription

		DerivedAccount is a DerivedField
			type is Alpha size up to 89
			if (DefaultDistributionAccount.GeneralLedgerChartAccount entered)
				return AccountAndDescription

		AccountingUnitAndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.AccountingUnit
			" - "
			DefaultDistributionAccount.AccountingUnit.Description

		DerivedAccountingUnit is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.AccountingUnit entered)
				return AccountingUnitAndDescription

		ProjectAndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.Project
			" - "
			DefaultDistributionAccount.Project.Description

		DerivedProject is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.Project entered)
				return ProjectAndDescription

		FinanceDimension1AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension1
			" - "
			DefaultDistributionAccount.FinanceDimension1.Description

		DerivedFinanceDimension1 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension1 entered)
				return FinanceDimension1AndDescription

		FinanceDimension2AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension2
			" - "
			DefaultDistributionAccount.FinanceDimension2.Description

		DerivedFinanceDimension2 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension2 entered)
				return FinanceDimension2AndDescription

		FinanceDimension3AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension3
			" - "
			DefaultDistributionAccount.FinanceDimension3.Description

		DerivedFinanceDimension3 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension3 entered)
				return FinanceDimension3AndDescription

		FinanceDimension4AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension4
			" - "
			DefaultDistributionAccount.FinanceDimension4.Description

		DerivedFinanceDimension4 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension4 entered)
				return FinanceDimension4AndDescription

		FinanceDimension5AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension5
			" - "
			DefaultDistributionAccount.FinanceDimension5.Description

		DerivedFinanceDimension5 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension5 entered)
				return FinanceDimension5AndDescription

		FinanceDimension6AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension6
			" - "
			DefaultDistributionAccount.FinanceDimension6.Description

		DerivedFinanceDimension6 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension6 entered)
				return FinanceDimension6AndDescription

		FinanceDimension7AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension7
			" - "
			DefaultDistributionAccount.FinanceDimension7.Description

		DerivedFinanceDimension7 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension7 entered)
				return FinanceDimension7AndDescription

		FinanceDimension8AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension8
			" - "
			DefaultDistributionAccount.FinanceDimension8.Description

		DerivedFinanceDimension8 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension8 entered)
				return FinanceDimension8AndDescription

		FinanceDimension9AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension9
			" - "
			DefaultDistributionAccount.FinanceDimension9.Description

		DerivedFinanceDimension9 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension9 entered)
				return FinanceDimension9AndDescription

		FinanceDimension10AndDescription is a StringField
			type is Alpha size up to 88
			restricted
			DefaultDistributionAccount.FinanceDimension10
			" - "
			DefaultDistributionAccount.FinanceDimension10.Description

		DerivedFinanceDimension10 is a DerivedField
			type is Alpha size up to 88
			if (DefaultDistributionAccount.FinanceDimension10 entered)
				return FinanceDimension10AndDescription

		PurchaseTaxCodeAndDescription is a StringField
			type is Alpha size up to 78
			restricted
			PurchaseTaxCode
			" - "
			PurchaseTaxCode.Description

		DerivedPurchaseTaxCode is a DerivedField
			type is Alpha size up to 78
			if (PurchaseTaxCode entered)
				return PurchaseTaxCodeAndDescription

		FromCompanyAndName is a StringField
			type is Alpha size up to 37
			restricted
			FromCompanyLocation.FromCompany
			" - "
			FromCompanyLocation.FromCompany.Name

		DerivedFromCompany is a DerivedField
			type is Alpha size up to 37
			if (FromCompanyLocation.FromCompany entered)
				return FromCompanyAndName

		FromLocationAndName is a StringField
			type is Alpha size up to 37
			restricted
			FromCompanyLocation.FromLocation
			" - "
			FromCompanyLocation.FromLocation.Name

		DerivedFromLocation is a DerivedField
			type is Alpha size up to 37
			if (FromCompanyLocation.FromLocation entered)
				return FromLocationAndName

		POCodeAndDescription is a StringField
			type is Alpha size up to 67
			restricted
			POCode
			" - "
			POCode.Description

		DerivedPOCode is a DerivedField
			type is Alpha size up to 67
			if (POCode entered)
				return POCodeAndDescription

		CommodityCodeAndDescription is a StringField
			type is Alpha size up to 220
			restricted
			CommodityCode
			" - "
			CommodityCode.CcDescription

		DerivedCommodityCode is a DerivedField
			type is Alpha size up to 220
			if (CommodityCode entered)
				return CommodityCodeAndDescription

		DerivedRequester is a DerivedField
			type is like Requester
			default label is "Requester"
			return Requester

		DropshipTelephoneCountryAndDescription is a StringField
			type is Alpha size up to 59
			restricted
			DropshipPhoneNumber.InternationalPrefix
			" - "
			DropshipPhoneNumber.InternationalPrefix.Description

		DerivedDropshipTelephoneCountry is a DerivedField
			type is Alpha size up to 59
			if (DropshipPhoneNumber.InternationalPrefix entered)
				return DropshipTelephoneCountryAndDescription

		DropshipCountryAndDescription is a StringField
			type is Alpha size up to 46
			restricted
			DropshipAddress.Country
			" - "
			DropshipAddress.Country.Name

		DerivedDropshipCountry is a DerivedField
			type is Alpha size up to 46
			if (DropshipAddress.Country entered)
				return DropshipCountryAndDescription

		DropshipStateProvinceAndDescription is a StringField
			type is Alpha size up to 46
			restricted
			DropshipAddress.StateProvince
			" - "
			DropshipAddress.StateProvince.Name

		DerivedDropshipStateProvince is a DerivedField
			type is Alpha size up to 46
			if (DropshipAddress.StateProvince entered)
				return DropshipStateProvinceAndDescription





		DerivedDelimiter is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "Generic_Delimiter"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "tenantID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "releaseID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "logicalID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "VersionID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedappProdline is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "appProdline"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedBODVariationID is a DerivedField
			type is Alpha 25
			restricted
			return bod id.VariationID

		BODActionCode is a DerivedField
			type is Alpha size 10
			restricted
			return "Add"

		BODDocumentID	is a DerivedField
			type is AlphaUpper size 30
			return DerivedBODCompany + DerivedDelimiter + DerivedBODRequisition

		DerivedBODRequisition	is a DerivedField
			type is Alpha size 7
			restricted
			return Requisition using "%d"

		DerivedBODCompany is a DerivedField
			type is Alpha size 4
			restricted
			return Company using "%d"

		DerivedReqLocation is a DerivedField
			type is Alpha size 100
			restricted
			return DerivedBODCompany + DerivedDelimiter + RequestingLocation

		DerivedBODRequester is a DerivedField
			type is Alpha size 13
			restricted
			return 	Requester using "%d"

		DerivedBODFEG	is a DerivedField
			type is AlphaUpper size 4
			restricted
			return GeneralLedgerCompanyRel.FinanceEnterpriseGroup

		ReqDescription is a DerivedField
			type is Alpha size 30
			restricted
			return 	DerivedBODRequester + DerivedDelimiter+ DerivedBODRequisition

		BODBusinessGroup is a DerivedField
			type is AlphaUpper size 5
			restricted
			return Company.ItemGroup

		DerivedBODStatus is a DerivedField
			type is Alpha size 10
			restricted
			if(Status = 1 or Status = 5)
				return "Open"
			if(Status = 9)
				return "Approved"
			if(Status = 8)
				return "Rejected"
			else
				return "Open"

		DerivedBODAccountingEntity	is a DerivedField
			type is Alpha size 20
			restricted
			return DerivedBODFEG + DerivedDelimiter+ Company.AccountingEntity

		BODFormattedId is a DerivedField
			type is Alpha 100
			restricted
			return "infor-nid:" + DerivedTenantID +":" + DerivedBODAccountingEntity + ":" + DerivedReqLocation + ":" + BODDocumentID +":" + "?Requisition&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker

		BODCurrentTimeStamp is a DerivedField
			type is TimeStamp
			restricted
			BODCurrentTimeStamp = system current timestamp
			return BODCurrentTimeStamp

		AlphaCurrentTimeStamp is a DerivedField
			type is Alpha size 20
			restricted
			return BODCurrentTimeStamp

		BODFormattedCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			return AlphaCurrentTimeStamp[1:4] + "-" + AlphaCurrentTimeStamp[5:6] + "-" + AlphaCurrentTimeStamp[7:8] + "T" + AlphaCurrentTimeStamp[9:10] + ":" + AlphaCurrentTimeStamp[11:12] + ":" + AlphaCurrentTimeStamp[13:14] + "Z"

		BODLastUpdateDate is a DerivedField
			type is Alpha size 50
			restricted
			BODLastUpdateDate = LastUpdateDate
			return BODLastUpdateDate[1:4] + "-" + BODLastUpdateDate[5:6] + "-" + BODLastUpdateDate[7:8] + "T" + BODLastUpdateDate[9:10] + ":" + BODLastUpdateDate[11:12] + ":" + BODLastUpdateDate[13:14] + "Z"

		RequisitionXMLBOD is a DerivedField 			
			type is XMLDocument
			restricted
			RequisitionXMLBOD = template.IONRequisitionXML_ST document for this instance

		RequisitionLineXMLBOD is a DerivedField						
			type is XMLDocument
			restricted
			if (RequisitionLinesRel exist)
				initialize BODLineCount
				for each RequisitionLinesRel
					BODLineCount +=1
					each.BODReqLineSequenceCount	= BODLineCount
					each.LocalBODAccountingEntity	= DerivedBODAccountingEntity
					each.LocalBODRequestingLocation	= DerivedReqLocation
					each.LocalBODReqCurrencyCode	= BaseCurrencyCode
					RequisitionLineXMLBOD += template.IONRequisitionLineXML_ST document for each
				return RequisitionLineXMLBOD

			else
				return ""

		MobileCompanyDisplay is a LabelField
			"<Company.Name>_(<Company>)"

		MobileRequestingLocationDisplay is a LabelField
			"<RequestingLocation.Name>_(<RequestingLocation>)"

		MobileRequesterDisplay is a LabelField
			"<Requester.PresentationNameSnapshot>_(<Requester>)"

		DerivedApprovalValueWithCurrency is a LabelField
			"<ApprovalValue>_<BaseCurrencyCode>"
		
		MobileLinesAndTotal is a LabelField
			"<NumberOfLines>_|_Total:_<DerivedApprovalValueWithCurrency>"
		
		DerivedApproverDisplay is a StringField
			type is Alpha 100
			first PfiMetricsRel.PfiMetrics.PfiUserProfile.PersonName.FamilyName
			", "
			first PfiMetricsRel.PfiMetrics.PfiUserProfile.PersonName.GivenName
			" ("
			first PfiMetricsRel.PfiMetrics.PfiUserProfile
			")"

		DerivedPreviousApprover is a DerivedField
			type is Alpha 100
			if (PfiMetricsRel exists)
				return DerivedApproverDisplay
			else
				return blank





		DerivedCompletionDetailText	is a DerivedField
			type is RichText
			if (LocalPurgeRecords)
				return DerivedPurgeRequisitionText
			else
				return DerivedReportPurgeRequisitionText

		DerivedPurgeRequisitionText is a MessageField
			"RequisitionPurgeHasBeenCompletedFor<LocalPurgeCount>Records."

		DerivedReportPurgeRequisitionText is a MessageField
			"ThereAre<LocalPurgeCount>RequisitionRecordsWhichCanBePurged."

		DerivedForegroundLimit is a DerivedField
			type is Numeric 2
			restricted
			return 50

		DerivedCreateDate is a DerivedField
			type is Date
			return ReleasedDate

		DerivedMobileCurrentStatus is a DerivedField
			type is Alpha size 10
			if(IsMyCurrentRequisition)
				return "Current"
			else
				return ""

		DerivedRequesterName is a DerivedField
			type is Alpha up to 100
			return Requester.Employee.Name.PreferredFirstAndLastName

		DerivedNumberOfTaxableRQLines is a DerivedField
			type is Numeric size 6
			restricted
			return instance count of TaxableRequisitionLinesRel

		DerivedNumberOfTaxableHeaderAOCs is a DerivedField
			type is Numeric size 3
			restricted
			return instance count of TaxableRequisitionAddOnChargesRel

		DerivedNumberOfTaxableLineAOCs is a DerivedField
			type is Numeric size 3
			restricted
			return instance count of TaxableRequisitionLineAddOnChargesRel

		CapitatedProcedureCount is a ComputeField
			type is Numeric 6
			restricted
			(instance count of LinesForAProcedureRel)
		
		CapitatedProcedureAmount      is a DerivedField 
			type is like InternationalAmount
			return sum LinesForAProcedureRel.LineExtendedAmount

		CapitatedComponentChargeAmounts      is a DerivedField 
			type is like InternationalAmount
			return sum ChargedLinesForComponentsRel.LineExtendedAmount

		DerivedNumberOfTaxLineItems is a DerivedField
			type is Numeric size 3
			restricted
			return (DerivedNumberOfTaxableRQLines + DerivedNumberOfTaxableHeaderAOCs + DerivedNumberOfTaxableLineAOCs)
		
		DerivedOneYearReplicationData is a DerivedField
        	type is Boolean
            if ((current date - create date) <  360)
                return true
            else
                return false


		DefaultCompanyMessage is a MessageField 
			"IfNotEnteredCompanyWillDefaultTo<SupplierSourceIdRel.DefaultCompany.RepresentativeText>"
		
		DerivedDefaultCompany is a DerivedField
			type is Alpha 100
			if (SupplierSourceIdRel.DefaultCompany entered)
				return DefaultCompanyMessage
			else
				return blank

		DefaultRequestingLocationMessage is a MessageField 
			"IfNotEnteredRequestingLocationWillDefaultTo<SupplierSourceIdRel.DefaultRequestingLocation.RepresentativeText>"
		
		DerivedDefaultRequestingLocation is a DerivedField
			type is Alpha 150
			if (SupplierSourceIdRel.DefaultRequestingLocation entered)
				return DefaultRequestingLocationMessage
			else
				return blank	

		DefaultRequesterMessage is a MessageField 
			"IfNotEnteredRequesterWillDefaultTo<SupplierSourceIdRel.DefaultRequester>-<SupplierSourceIdRel.DefaultRequester.RequesterFirstLastName>"
		
		DerivedDefaultRequester is a DerivedField
			type is Alpha 150
			if (SupplierSourceIdRel.DefaultRequester entered)
				return DefaultRequesterMessage
			else
				return blank

		SpecialHandlingMessageForMultipleLines				is a MessageField
			"ItemsWith_\Special_\HandlingInstructionsExist"

		SpecialHandlingMessageForListMultipleLines			is a MessageField
			"ViewItemsWith_\Special_\Handling"				

		DerivedMSCMURLString1	is a DerivedField
			type is Alpha 110
			return "deliveryTracking?mode=trackinglist&searchMode=advanced&action=newsearch&numlocations=0&fromApp=RSS&companyno="
		
		DerivedMSCMURLString2	is a DerivedField
			type is Alpha 15
			return "&searchvalue="

		DerviedMSCMURLString3	is a DerivedField
			type is Alpha 115
			return "&CHK_searchvalue=INT%7C1%7C9999999%7CFalse%7CRequisition+Number&searchTerm=reqno&linetype=all&startDate=&endDate="

		DerivedMSCMURL is a DerivedField
			type is Alpha 400
			if (IsMSCMServerEnabled)
				return MSCMServerConfigurationRel.Value + DerivedMSCMURLString1 + Company + DerivedMSCMURLString2 + Requisition + DerviedMSCMURLString3
			else
				return blank

		DerivedAllocationPriorityLevel is a DerivedField
			type is like AllocationPriorityLevel
			restricted
			if (AllocationPriority entered
        	and RSSLPLConfigurationParameterRel exists)
				return AllocationPriority

		AmountLessThanVendorMinimumOrderAmount is a MessageField
			"Cannot_Release,_Requisition_Amount_Less_Than_Minimum_Order_Amount_For_Vendor:<CurrentVendor>"

		AmountLessThanPurchFromLocMinimumOrderAmount is a MessageField
			"Cannot_Release,_Requisition_Amount_Less_Than_Minimum_Order_Amount_For_Vendor:<CurrentVendor>_Purchase_From_Location:<CurrentPurchaseFromLocation>"

		DerivedRequisitionReleaseMessages is a DerivedField
			type is Alpha 200
			if (RequisitionReleaseMessages.RequisitionAmountLessThanVendorMinimumOrderAmount)
				display "2042RQDerivedVendorMinimumOrderAmount:<RequisitionReleaseMessages.RequisitionAmountLessThanVendorMinimumOrderAmount>"
				return AmountLessThanVendorMinimumOrderAmount
			else
				if (RequisitionReleaseMessages.RequisitionAmountLessThanPurchFromLocMinimumOrderAmount)
					display "2046RQDerivedPurchFrom:<RequisitionReleaseMessages.RequisitionAmountLessThanPurchFromLocMinimumOrderAmount>"
					return AmountLessThanPurchFromLocMinimumOrderAmount

		
		RSSLPLAddToNewRequisitionMessage is a MessageField
			"RequisitionHasBeenCreated<Requester.CurrentRequisitionForRQC>"
				
		RSSLPLLineAddedToRequisitionMessage is a MessageField
			"LinesFromRequisition<Requisition>HasBeenAddedToTheExistingRequisition"

		RSSLPLBatchLineAddedToRequisitionMessage is a MessageField
			"LinesFromRequisition<Requisition>HasBeenAddedToTheExistingRequisition_(ProcessRunningInBackground)"
		
		DerivedReturnYes is a DerivedField
			type is Alpha size 1
			restricted
			return "Y"

		DerivedMatrixApprovalTitle is a StringField
			type is Alpha 200
			restricted
			"Requisition "
			Requisition
			" from "
			Requester.Employee.Name.PreferredFirstAndLastName
			" in amount of "

		DerivedApprovalTitle	is a DerivedField
			type is Alpha 200
			restricted
			return DerivedMatrixApprovalTitle + " " + DerivedRequsitionAmountCurrency

		DerivedMatrixGLString is a DerivedField
			type is AlphaUpper 260
			if (DefaultDistributionAccount.Project entered)
				return DefaultDistributionAccount
			else
				return RequestingLocation.IssueAccount
				
		DerivedUseDefaultHeaderAccountForMatrix is a DerivedField
			type is Boolean
			if (RequisitionApprovalType.HeaderMatrixApproval
			and DefaultDistributionAccount.Project entered)
				return true
			else
				return false
		
		DerivedUseRequestingLocationIssueAccountForMatrix is a DerivedField
			type is Boolean
			if (RequisitionApprovalType.HeaderMatrixApproval
			and !DefaultDistributionAccount.Project entered)
				return true
			else
				return false
		
		DerivedDefaultDistributionAccountError is a MessageField
			"The_line_default_Distribution_Account_has_incorrect_or_missing_information_for_Header_Matrix_Approval"

		DerivedRequestingLocationIssueAccountError is a MessageField
			"The_Requesting_Location_Issue_Account_has_incorrect_or_missing_information_for_Header_Matrix_Approval"

		DerivedMatrixAccountErrorMessage is a DerivedField
			type is Alpha 125
			if (DefaultDistributionAccount.Project entered)
				return DerivedDefaultDistributionAccountError
			else
				return DerivedRequestingLocationIssueAccountError

		DerivedDeliveryMethodState is a DerivedField
			type is Alpha size 2
			return DeliveryMethod
		
		RSSLPLDerivedTotalCurrencyField is a DerivedField
			type is Alpha up to 31
			default label is "Total"
			if (RSSLPLDisplayCurrencyCode)
				return TotalCurrencyField
			else
				return ApprovalValue
		
		RSSLPLDerivedApprovalValueCurrency is a DerivedField
			type is MessageField
			default label is "RequestTotal"
			if (RSSLPLDisplayCurrencyCode)
				return DerivedApprovalValueWithCurrency
			else
				return ApprovalValue
		
		RSSLPLDerivedMobileLinesAndTotal is a DerivedField
			type is MessageField
			default label is "Lines"
			if (RSSLPLDisplayCurrencyCode)
				return MobileLinesAndTotal
			else
				return NumberOfLines + " | Total: " + RSSLPLDerivedApprovalValueCurrency

	Dimensions
		DerivedApprovedDimension
			dimension name is Approved

		Buyer
			caption is "<Name>"
			Attributes
				BuyerGroup
				Name

		TransientGLCalendarPeriod
			dimension name is Calendar
			caption is "<AlternateCaption>"
			Attributes
				YTDCrossReference
				SamePeriodLastYear
				YTDCrossRefSPLY
				PeriodType
				PeriodTypeName
				NumberOfDays

		DerivedClosedDimension
			dimension name is ClosedFlag

		DerivedDropshipDimension
			dimension name is Dropship











		Requisition
			dimension name is RequisitionNumber

		Requester
			caption is "<Name>"
			Attributes
				Name

		Status
			dimension name is HeaderStatus

		RequestingLocation
			dimension name is RequestingLocation

		RequisitionRecordSource
			dimension name is RequisitionSource

		RequisitionSource
			dimension name is RequisitionType

		Vendor
			caption is representative text
			Attributes
				VendorGroup
				VendorName
				VendorStatus
				VendorClass
				ContactName
				Operator
				Project
			Hierarchies
				VendorClass
					base level included
					Attributes
						VendorGroup
						VendorClass

	Measures
		RequisitionCount
		AOCTotal

	Conditions
		DropshipNameEntered
			when (DropshipName entered)
		RecordExists
			restricted
			when (Requisition exists)
		HasWorkunit
			restricted
			when (PfiWorkunitRel exists)

		HasLinesWithDuplicateSerial 
			restricted 
			when (ForCapitatedProcedure
			and   LinesWithDuplicateSerialRel exists)
		
		IsTrialRequisition
			when (TrialNotice entered)

		IsASupplier
			restricted
			when (actor.agent(SupplierSourceId).Supplier exists)	

        NonSupplierCanView
			restricted
			when (SupplierCreated = 0
			or    SupplierCreated = 2
			or    SupplierCreated = 3)
		
		OperatorIsSupplier
			restricted 
			when (OperatorIsSupplierPrimaryRel exists
			or    OperatorIsSupplierContactRel exists)
		
		CreatedBySupplier	
			restricted
			when (SupplierCreated > 0
			and   OperatorIsSupplier)
		
		SupplierSameAsOperatorID
			restricted
			when (CreatedBy = actor)
		
		NotSubmittedForSupplier
			restricted
			when (SupplierCreated = 1)
		
		CanUpdateForSupplier
			restricted
			when (SupplierSameAsOperatorID
			and   NotSubmittedForSupplier)

		SupplierCannotUpdate
			restricted
			when (SupplierCreated > 1)
		
		SupplierCanUpdateNoTemplate
			restricted
			when (CanUpdateForSupplier
			and   !FromProcurementTemplate)

		SupplierCanUpdateTemplate
			restricted
			when (CanUpdateForSupplier
			and   FromProcurementTemplate)

		CanSubmitForSupplier
			restricted
			when (SupplierSameAsOperatorID
			and   NotSubmittedForSupplier)

		CanChangeReviewer 
			restricted 
			when ((SupplierCreated = 1
			or     SupplierCreated = 2)
			and    actor.agent(Employee).Employee.Requester.SupplierRequisitionReviewer) 
		
		CanApproveSupplierCreated
			restricted
			when (SupplierCreated = 2
			and   actor.agent(Employee).Employee.Requester.SupplierRequisitionReviewer)

		MineCanApproveSupplierCreated
			restricted
			when (CanApproveSupplierCreated
			and  (IsMyRequisition
			or    RequesterNotEntered))

		ApprovedSupplierCreated
			restricted
			when (SupplierCreated = 3)

		UnsubmittedSupplierCreated
			restricted 
			when (SupplierCreated = 1)
		
		ReviewerCanSubmit
			restricted 
			when (UnsubmittedSupplierCreated
			and   IsMyRequisition)
		
		SupplierCanUseTemplates
			restricted
			when (SupplierSourceIdRel.AllowTemplate)

		UseLinesForThisTemplate
			restricted
			when (SupplierCanUseTemplates
			and   ProcurementTemplate entered)

		UseLinesForAllTemplates
			restricted
			when (SupplierCanUseTemplates
			and   ProcurementTemplate !entered)

		SupplierCanUseAdHoc
			restricted
			when (SupplierSourceIdRel.AllowAdHoc)

		SupplierCanUseContractSearch
			restricted
			when (SupplierSourceIdRel.AllowContractSearch)
		
		NoHelperLists 
			restricted
			when (((!SupplierCanUseContractSearch
			and     !UseLinesForThisTemplate
			and     !UseLinesForAllTemplates)
			or      !UnsubmittedSupplierCreated)
			and     !ForCapitatedProcedure
			and      RecordExists)

		CapitatedNoHelperLists 
			restricted 
			when (ForCapitatedProcedure
			and   SupplierCreated !=1)
		
		CapitatedHelperLists 
			restricted 
			when (ForCapitatedProcedure
			and   SupplierCreated =1)

		MultipleProcedures 
			restricted 
			when (CapitatedProcedureCount > 1)

		MixedProcedureLevels 
			restricted 
			when (PrimaryProcedureRel exists 
			and   RevisionProcedureRel exists)
		
		ComponentsNeedProcedureLevel 
			restricted 
			when (CapitatedProcedureCount = 0
			or    MixedProcedureLevels)
		
		PrimaryProcedure 
			restricted 
			when (PrimaryProcedureRel exists
			and   RevisionProcedureRel !exists)
		
		RevisionProcedure 
			restricted 
			when (PrimaryProcedureRel !exists
			and   RevisionProcedureRel exists)

		CapitatedNoContractLines 
			restricted 
			when (ForCapitatedProcedure
			and  !SupplierCanUseContractSearch)

		CapitatedContractLines 
			restricted 
			when (ForCapitatedProcedure
			and   SupplierCanUseContractSearch)
		
		HasNoProcedures 
			restricted 
			when (LinesForAProcedureRel !exists)

		HasProcedures 
			restricted 
			when (LinesForAProcedureRel exists)

		HasChargedLinesForComponentGroups 
			restricted 
			when (ChargedLinesForComponentsForGroupRel exist)

		HasChargedLinesForProcedureComponentGroups 
			restricted 
			when (ChargedLinesForComponentsForProcedureRel exist)

		HasNoChargeLinesForProcedureComponentGroups 
			restricted 
			when (NoChargeLinesForComponentsForProcedureRel exist)

		UnreleasedCapitatedHasChargeAndNoChargeComponents
			restricted 
			when (CapitatedUnreleased
			and   HasChargedLinesForProcedureComponentGroups
			and   HasNoChargeLinesForProcedureComponentGroups)
		
		CanSwapCapitatedComponents 
			restricted 
			when ((RequesterCanCreateCapitated
			or     BuyerCanCreateCapitated)
			and    UnreleasedCapitatedHasChargeAndNoChargeComponents)
		
		CapitatedContractsExist
			restricted 
			when (CapitatedContractRel exists)

		CapitatedUnreleased 
			restricted 
			when (ForCapitatedProcedure
			and   Status = 0)

		CapitatedReleased 
			restricted 
			when (ForCapitatedProcedure
			and   Status > 0)

		RequesterCanCreateCapitated
			restricted 
			when (actor.agent(Employee).Employee.Requester.CanCreateCapitatedRequisition)

		BuyerCanCreateCapitated
			restricted 
			when (actor.agent(Employee).Employee.Buyer.CanCreateCapitatedRequisition)

		ActorIsBuyer
			when (actor.agent(Employee).Employee.BuyerExists)

		RequesterOrBuyerCanCreateCapitated 
			restricted 
			when (RequesterCanCreateCapitated
			or    BuyerCanCreateCapitated)
		
		RequesterCanCreatePO 
			restricted 
			when (actor.agent(Employee).Employee.Requester.CanCreatePOForCapitatedRequisition)

		CanQuickCreatePO 
			restricted 
			when ((RequesterCanCreatePO
			or     ActorIsBuyer)
			and    Status = 9
			and   (ForCapitatedProcedure
			or     SupplierCreated = 3)
			and    PurchaseOrderInterfaceForThisActorRel !exists
			and   !HasPOLines)
		
		UpdateAllowedNotCapitated
			restricted 
			when (UpdateAllowed
			and  !ForCapitatedProcedure)

		CapitatedHasPOLines 
			restricted 
			when (ForCapitatedProcedure
			and   HasPOLines)
		
		HasLinesWithNoLotOrSerial 
			restricted 
			when (ForCapitatedProcedure
			and   Status = 0
			and   LinesWithNoLotOrSerialRel exists)

		HasLinesWithNoLotOrSerialSupplier 
			restricted 
			when (ForCapitatedProcedure
			and   LinesWithNoLotOrSerialRel exists
			and   SupplierCreated = 1
			and  (SupplierCanDisplayLot
			or    SupplierCanDisplaySerialNumber))

		ReadyToSwapCapitatedComponents 
			restricted 
			when (ForCapitatedProcedure  
			and   CapitatedSelectForSwapNoChargeRel exists
			and   CapitatedSelectForSwapChargedRel exists)			
		
		ContractSearchOnly
			restricted
			when (SupplierCanUseContractSearch
			and  !UseLinesForThisTemplate
			and  !UseLinesForAllTemplates
			and   UnsubmittedSupplierCreated
			and  !ForCapitatedProcedure)
		
		SingleTemplateSearchOnly
			restricted
			when (!SupplierCanUseContractSearch
			and   UseLinesForThisTemplate
			and  !UseLinesForAllTemplates
			and   UnsubmittedSupplierCreated
			and  !ForCapitatedProcedure)

		MultipleTemplateSearchOnly
			restricted
			when (!SupplierCanUseContractSearch
			and  !UseLinesForThisTemplate
			and   UseLinesForAllTemplates
			and   UnsubmittedSupplierCreated
			and  !ForCapitatedProcedure)

		ContractAndSingleTemplateSearch
			restricted
			when (SupplierCanUseContractSearch
			and   UseLinesForThisTemplate
			and  !UseLinesForAllTemplates
			and   UnsubmittedSupplierCreated
			and  !ForCapitatedProcedure)

		ContractAndMultipleTemplateSearch
			restricted
			when (SupplierCanUseContractSearch
			and  !UseLinesForThisTemplate
			and   UseLinesForAllTemplates
			and   UnsubmittedSupplierCreated
			and  !ForCapitatedProcedure)

		SupplierCanCreateDialog
			restricted
			when (VendorSameAsRequisitionVendor
			and   SupplierCannotUpdate)

		VendorSameAsRequisitionVendor
			restricted
			when (Vendor = SupplierRel.Vendor)

		HasMessageDialog
			restricted
			when (SupplierContactMessageRel exists)

		HasMessageDialogOther
			restricted
			when (SupplierMessageDialogRel exists)			
		
		RequesterEntered 
			restricted
			when (Requester entered)
		
		VendorEntered 
			restricted 
			when (Vendor entered)

		DescriptionEntered
			restricted 
			when (RequisitionDescription entered)

		PurchaseFromLocationEntered
			restricted 
			when (PurchaseFromLocation entered)

		HasNoContractLines
			restricted
			when (SupplierSourceIdByActorRel.ContractItemsOnly > 0
			and   HasLinesWithNoContractLine)
		
		HasLinesWithNoContractLine
			restricted
			when (LinesNotForAContractLineRel exists)
		
		AllLinesHaveContractLine
			restricted
			when (LinesNotForAContractLineRel !exists)

		RequesterNotEntered
			restricted 
			when (Requester !entered)

		SupplierCanDisplayLot
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewLotNumber)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewLotNumber))

		SupplierCanDisplaySerialNumber
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewSerialNumber)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewSerialNumber))

		CanDisplayVisitOrProcedure 
			restricted 
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewAnyVisitInformation)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewAnyVisitInformation))			
		
		CanDisplayVisitNumber
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewVisitNumber)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewVisitNumber))
		
		CanDisplayPatientID
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewMedicalRecordNumber)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewMedicalRecordNumber))

		CanDisplayCaseNumber
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewCaseID)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewCaseID))

		CanDisplayProcedure
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewProcedure)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewProcedure))

		CanDisplayPractitioner
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewPractitioner)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewPractitioner))

		CanDisplayPatient
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewPatientName)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewPatientName))

		CanDisplayBirthdate
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewPatientBirthdate)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewPatientBirthdate))

		CanDisplayGender
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewPatientGender)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewPatientGender))

		CanDisplayNurse
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewNurseCoordinator)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewNurseCoordinator))

		CanDisplaySupplierOrder	
			restricted
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierSourceIdRel.SupplierViewSupplierOrderNumber)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewSupplierOrderNumber))

		CanDisplayAnyProcedureInformation 
			restricted 
			when ((SupplierSourceIdRel.ProcedureDetailsFromContact
			and	   SupplierSourceIdRel.SupplierViewAnyProcedureInformation)
			or    (!SupplierSourceIdRel.ProcedureDetailsFromContact
			and    SupplierGroupRel.SupplierViewAnyProcedureInformation))

		
		ContractLinesExist
            restricted
            when (LinesForAContractLineRel exists)

		BelowLocationMinimumOrderAmount
			restricted
			when (CurrentPurchaseFromLocationRel.OrderMinimumAmountEdit.PurchaseOrdersAndRequisitions
			and   CurrentPurchaseFromLocationRel.MinimumPurchaseOrderAmount entered
			and   PurchaseFromAmount < CurrentPurchaseFromLocationRel.MinimumPurchaseOrderAmount)


		AmountGreaterThanLocationMinimumOrder
			restricted
			when (CurrentPurchaseFromLocationRel.MinimumPurchaseOrderAmount not entered
			or   (CurrentPurchaseFromLocationRel.OrderMinimumAmountEdit.PurchaseOrdersAndRequisitions
			and	  PurchaseFromAmount >= CurrentPurchaseFromLocationRel.MinimumPurchaseOrderAmount))

		AmountGreaterThanVendorMinimumOrder
			restricted
			when (PurchasingVendorFromLineRel.MinimumPurchaseOrderAmount not entered
			or	 PurchasingVendorFromLineRel.OrderMinimumAmountEdit.PurchaseOrders
			or 	 (PurchasingVendorFromLineRel.OrderMinimumAmountEdit.PurchaseOrdersAndRequisitions
			and	  ValidatableAmount >= PurchasingVendorFromLineRel.MinimumPurchaseOrderAmount))

		IsProcessedOrRejected
			restricted
			when (Status.Processed
			or	  Status.Rejected)

		NotIDMAndIsProcessedOrRejected
			restricted
			when (not Company.UseIDM and IsProcessedOrRejected)

		IDMAndIsProcessedOrRejected
			restricted
			when (Company.UseIDM and IsProcessedOrRejected)

        BudgetRebuildExists
        	restricted
        	when (BudgetRebuildBTGTRel exists)

        BudgetEditAndInterfaceNotInProcess
        	restricted
        	when (!BudgetEditInProgress
        	and   !InterfaceInProcess)

		UpdateAllowed
        	restricted
        	when (!BudgetEditInProgress
        	and   !InterfaceInProcess
        	and   IsUnreleased)

        IsApproved
        	restricted
            when (Approved)

        HasBuyer
        	restricted
            classic name is BUYER
            when (Buyer entered)

		BudgetEditingInformationExists
			restricted
			when (BudgetTemplateGroupTotalRel exists)

		BudgetEditInProgress
			when (BudgetEditProcessing = 1)

		BudgetEditFailure
			restricted
			when (BudgetEditProcessing = 2)

		BudgetTrackAndEdit
			when (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit)

		OpenCommitmentsExist
			restricted
			when (OpenGLCommitDrillRel exists)

		CommitmentSearchFilter
			restricted
			when (MatchesAccountingEntitySearch
			and	  MatchesAccountingUnitSearch
			and	  MatchesProjectSearch
			and	  MatchesFinDim1Search
			and	  MatchesFinDim2Search
			and	  MatchesFinDim3Search
			and	  MatchesFinDim4Search
			and	  MatchesFinDim5Search
			and	  MatchesFinDim6Search
			and	  MatchesFinDim7Search
			and	  MatchesFinDim8Search
			and	  MatchesFinDim9Search
			and	  MatchesFinDim10Search
			and	  MatchesAccountSearch)

		IsClosedStatus
			restricted
			when (Closed)

		HasLinesToKill
			restricted
			when (InventoryLinesToKillRel exists)

		HasDescription
			restricted
			classic name is HAS-DESCRIPTIO
			when (RequisitionDescription entered)

		HasReference
			restricted
			when (ReferenceNumber entered)

		IsNotApproved
			restricted
			when (not Approved
			and   AttainedLevel >  blank)

		IsPrintable
			restricted
			when (Status >  blank)

		IsRejectedStatus
			restricted
			classic name is REJECTED-STAT
			when (Status.Rejected)

		IsReleasedStatus
			restricted
			classic name is RELEASE-STAT
			when (Status.Released)

		IsReleaseInProgress
			restricted
			when (Status.ReleaseInProgress)

		IsUnreleased
			when (Status.Unreleased)

		Open
			restricted
			when ((Status.InProcess
			or     Status.Processed)
			and    !Closed)

		IsProcessed
	   		when (Status.Processed
			and not IsClosedStatus
			and UnreleasedRequisitionLinesRel not exists)

		IsClosed
	   		when (Status.Processed
			and IsClosedStatus
			and UnreleasedRequisitionLinesRel not exists)

		IsCreateInProgress
			when (Status.CreateInProgress)

		NeedsApproval
			when (((RequisitionApprovalType.HeaderApproval
			or     RequisitionApprovalType.LineApproval
			or     RequisitionApprovalType.HeaderMatrixApproval)
			and    Status.Released)
			or    (RequisitionApprovalType.LineApproval
			and    Status.Processed
			and    ForApprovalRequisitionLinesRel exists))

		NeedsApprovalFilter
			when ((RequisitionApprovalType.HeaderApproval
			or     RequisitionApprovalType.LineApproval
			or     RequisitionApprovalType.HeaderMatrixApproval)
			and    Status.Released)

		NeedsHeaderApproval
			when (RequisitionApprovalType.HeaderApproval
			or    RequisitionApprovalType.HeaderMatrixApproval)

		IsDropship
			restricted
			when (Dropship
			or    DropShipDefaulting.RequestingLocationAddress
			or    DropShipDefaulting.RequesterAddress
			or	  DropshipName entered
			or	  DropshipContact entered
			or	  DropshipPhoneNumber entered)

		HasDropshipInfo
			restricted
			when (DropshipName entered
			and   DropshipAddress entered)

		HasNoPurchaseOrderBillToInfo	
			restricted
			when (PurchaseOrderBillToName not entered
			and   PurchaseOrderBillToAddress not entered
			and   PurchaseOrderBillToContact not entered
			and   PurchaseOrderBillToPhoneNumber not entered
			and   PurchaseOrderBillToEmailAddress not entered)

		HasVendorLocation
			restricted
			when (VendorLocationRel exists)

		HasNonPHIDefaultProcInfo
			restricted
			when (DefaultProcedureInformation entered)

		HasPHIDefaultProcInfo
			restricted
			when (TransientVisitNumber 			entered
			or	  TransientPatientID 			entered
			or	  TransientCaseNumber 			entered
			or	  TransientPatientLastName 		entered
			or	  TransientPatientFirstName 	entered
			or	  TransientPatientMiddleName 	entered
			or	  TransientBirthdate 			entered
			or	  TransientGender 				entered
			or	  TransientSocialSecurityNumber entered)

		HasDefaultProcedureInformation
			restricted
			when (HasNonPHIDefaultProcInfo
			or    HasPHIDefaultProcInfo)

	   	PHIProcedureInformationChanged
	   		restricted
			when (PatientProcedure entered
			and  (TransientVisitNumber 			changed
			or	  TransientPatientID 			changed
			or	  TransientCaseNumber 			changed
		   	or	  TransientPatientLastName 		changed
			or	  TransientPatientFirstName 	changed
			or	  TransientPatientMiddleName 	changed
			or	  TransientBirthdate 			changed
			or	  TransientGender 				changed
			or	  TransientSocialSecurityNumber changed))

		HasPatientProcedureRecord
			restricted
			when (PatientProcedure exists)

		PatientProcedureInfoExists
			when (PatientProcedure exists
			or    DefaultProcedureInformation entered)

		IsDeletePatientProcAllowed
			when (Requisition.IsUnreleased
			and   PatientProcedureInfoExists)

		AllowMultipleCompaniesInRSS
			restricted
			when (actor.agent(Employee).Employee.Requester.DerivedCompanyDisplayOption = "S")

		IsValidCompanyForRequester
			restricted
			when (Requester.Company = Company or AllowMultipleCompaniesInRSS)

		IsValidForCompany
			restricted
			when (Requester.Company = Company)

		IsMyRequisition
			restricted
			when (Requester = actor.agent(Employee).Employee and IsValidForActorContext)

		IsMyCurrentRequisition
			restricted
			when (IsMyRequisition
			and   Company = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
			and   Requisition = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC)

		IsMyUnreleasedRequisition
			restricted
			when (IsUnreleased
			and   IsMyRequisition
			and   SupplierCreated != 1)

		IsMyOpenRequisition
			restricted
			when ((Open or IsUnreleased) and IsMyRequisition and !NeedsApproval)

		IsMyNeedsApprovalRequisition
			restricted
			when (NeedsApproval and IsMyRequisition)

		IsMyClosedRejectedRequisition
			restricted
			when ((IsClosedStatus or IsRejectedStatus) and IsMyRequisition)

		IsMyInProccessRequisition
			restricted
			when (IsMyRequisition
			and  (IsUnreleased or NeedsApproval)) 
		
		IsMyUnclosedRequisition
			restricted
			when (IsMyRequisition
			and   Open)		

		DisplayOfProcedureInfo
			restricted
			when (actor.agent(Employee).Employee.Requester.AllowDisplayOfProcedureInfo
			or SupplierDisplayOfProcedureInfo)

		SupplierDisplayOfProcedureInfo
			restricted
			when  (IsASupplier
			and   (Requester entered
			and    Requester.AllowDisplayOfProcedureInfo)
			or     Requester !entered)
		
		HasLinesForSourcing
			restricted
			when (RequisitionLinesToSourcingRel exists)

		IsValidForActorContext
			restricted
			when ((actor.context.FinanceEnterpriseGroup != ""
			and   GeneralLedgerCompanyRel.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
			or   (actor.context.FinanceEnterpriseGroup = ""))

		PunchoutLineExists
			restricted
			when (RequisitionLinesPunchoutRel exists)

		NonPunchoutLineExists
			restricted
			when (RequisitionLinesNonPunchoutRel exists)

		AllowPunchoutAndNonPunchout
			restricted
			when  (BuyingOrganizationRel.AllowCombinedItems)

	   	CommitmentsExist
	   		restricted
	   		when (GLCommitDrillRel exists)

		CommentsExist
			restricted
			when (RequisitionCommentRel exists)

		AddOnChargesExist
			restricted
			when (RequisitionAddOnChargesRel exists)

		SpreadAddOnChargesExist
			restricted
			when (RequisitionSpreadAOCRel exists)

	   	HeaderBudgetErrorsExist
			when (HeaderBudgetEditErrorRel exists)

		DistributionBudgetErrorsExist
			when (DistributionBudgetEditErrorRel exists)

	   	BudgetErrorsExist
			when (HeaderBudgetEditErrorRel exists
			or    DistributionBudgetEditErrorRel exists)

	   	HasNoLines
	   		when (RequisitionLinesRel !exists)

	   	HasLines
	   		restricted
	   		when (RequisitionLinesRel exists)

		HasPOLines
			restricted
			when (PurchaseOrderLineSourcesRel exists)

	   	IsForRelease
	   		restricted
	   		when (RequisitionLinesUnreleasedRel exists
	   		and  !BudgetEditInProgress
	   		and  !InterfaceInProcess
			and  (SupplierCreated = 0
			or    SupplierCreated = 3) 
	   		and  (IsUnreleased
	   		or	  Status.InProcess))

		WithinSearchDateRange
			restricted
			when (SearchDateRange not entered
			or   (SearchDateRange entered
			and   CreationDate date within SearchDateRange))

		NeedsACalendar
			restricted
			when (!BasicAnalyticsCalendarsRel exists)

		LineErrorsExist
			restricted
			when (RequisitionLinesInErrorRel exists)

		LineReturnsExist
			restricted
			when (RequisitionReturnLineRel exists)
		
		LineReturnQuantityExist
			restricted
			when (RequisitionReturnQuantityLineRel exists)

		LineReturnsAllowed
			when (RequisitionReturnAllowedLineRel exists)

		LineReturnsToNewRequisition
			restricted
			when (RequisitionReturnLineToNewRequisitionRel exists)
		
		DisplayReturns
			when (RequisitionReturnAllowedLineRel exists
			and   actor.agent(Employee).Employee.Requester.DerivedInventoryReturnsDisplayOption = "S")


		FromProcurementTemplate
			restricted
			when (ProcurementTemplate entered)

		AllowCreateUpdateDeleteComments	
			restricted
			when (Status.Unreleased or NeedsApproval)	

		MyRequestingLocationAllowed
			restricted
			when ((MyRequestingLocationRel exists
			and    actor.agent(Employee).Employee.Requester.Requester.RequestingLocationValidationOption.Allowed)
			or	  (MyRequestingLocationRel not exists
			and    actor.agent(Employee).Employee.Requester.Requester.RequestingLocationValidationOption.Disallowed))

		RequestingLocationAllowed
			restricted
			when ((RequestingLocationRel exists
			and    Requester.RequestingLocationValidationOption.Allowed)
			or	  (RequestingLocationRel not exists
			and    Requester.RequestingLocationValidationOption.Disallowed))

		MyRequestingLocations
			restricted
			when (MyRequesterRequestingLocationRel not exists
			or    MyRequestingLocationAllowed)

		RequesterRequestingLocations
			restricted
			when (RequesterRequestingLocationRel not exists
			or	  RequestingLocationAllowed)

		ManualEncumbrancesMayExist
			restricted
			when (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.GLSystemTrackAndEdit)

		ManualEncumbrancesExist   
			restricted
			when (GLCommitManualEncumbrancesRel exists)

		ManualEncumbranceIsValid
			restricted
			when (GLCommitByManualEncumbranceRel exists)

		WarehouseShipmentExists
			restricted
			when (WarehouseShipmentRel exists)

		HasIDMDocument
			restricted
			when (Company.UseIDM and IDMDocumentPID entered)

		IsValidForUpdatePrinter
			restricted
			when (Company.UseIDM
			and not Status.Unreleased)

		HasKilledQuantity
			when (RequisitionLinesKilledQuantityRel exists)

		LineErrorsFromHeaderExists
			restricted
			when (RequisitionLineErrorsRel exists)

		HasCatchWeightItem
			when (RequisitionLinesWithCatchWeightItemRel exists)

		HasRequesterRestrictionsAllow
			when (RequesterFinanceStructureExistRel exists
			and   Company.ItemGroup.StructureRow entered
			and   Company.ItemGroup.RequesterValidationOption.AllowValues)

		HasRequesterRestrictionsDisallow
			when (RequesterFinanceStructureExistRel exists
			and   Company.ItemGroup.StructureRow entered
			and   Company.ItemGroup.RequesterValidationOption.DisallowValues)

		FESEnabled
			when (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.FrontEndSplits
			and Company.FrontEndSplitRequisition)
			
		SetToCurrentAllowed
			restricted
			when (Status.Unreleased
			and   !IsMyCurrentRequisition)
			
		NumberOfLinesLessThanSix
			restricted
			when (NumberOfLines < 6)

		NumberOfLinesLessThanSixNotCapitated
			restricted 
			when (NumberOfLinesLessThanSix 
			and  !ForCapitatedProcedure)

		NumberOfLinesSixOrGreaterNotCapitated
			restricted 
			when (!NumberOfLinesLessThanSix
			and   !ForCapitatedProcedure)

		IsBuyerRequisition 
			restricted 
			when (Buyer = actor.agent(Employee).Employee and IsValidForActorContext)				

		ShowAddressesPanel
			when (Requester.AllowAlternateShipToAddress
			and   Requester.AllowBillTo
			and RequesterRel.DisplayDropShip)

		ShowDropshipAddressPanel
			when (Requester.AllowAlternateShipToAddress
			and   !Requester.AllowBillTo
			and RequesterRel.DisplayDropShip)

		ShowBillToAddressPanel
			when (!Requester.AllowAlternateShipToAddress
			and    Requester.AllowBillTo)
			

		FromCompanyLocationRequired
			restricted
			when (RequestingLocation.FromCompanyLocation not entered
			and Requester.RequestingLocation.FromCompanyLocation not entered
			and actor.agent(Employee).Employee.Requester.RequestingLocation.FromCompanyLocation not entered)

		RequestingLocationRequired
			restricted
			when (Requester.RequestingLocation not entered
			and actor.agent(Employee).Employee.Requester.RequestingLocation not entered)

		RequesterRequired
			restricted
			when (actor.agent(Employee).Employee not entered)

		SingleCallToOneSource
			restricted
			when (TaxEntityRel.ThirdParty.Sabrix
			and	  TaxEntityRel.DelayTaxProcessing
			and	  DerivedNumberOfTaxLineItems <= 200)

		SingleCallToVertex
			restricted
			when (TaxEntityRel.ThirdParty.VertexOSeries
			and	  TaxEntityRel.VertexCallMethod.ByTransaction
			and	  DerivedNumberOfTaxLineItems <= 200)

		VertexDelayTaxCall
			when (TaxEntityRel.ThirdParty.VertexOSeries
			and   TaxEntityRel.TaxAttributeCode entered)	


		HasLinesWithSpecialHandling
			when (RequisitionLinesWithSpecialHandlingRel exists)
	
		DisplayAOCOption
			restricted
			when (RequesterRel.DisplayAOCOption)

		DisplayRequestedDeliveryDate
			restricted
			when (RequesterRel.DisplayRequestedDeliveryDate)
			
		DisplayPOCode
			restricted
			when (RequesterRel.DisplayPOCode)
			
		DisplayTaxInfo
			restricted
			when (RequesterRel.DisplayTaxInfo)

		DisplayAccounting
			restricted
			when (RequesterRel.DisplayAccounting)

		DisplayBillCode
			restricted
			when (RequesterRel.DisplayBillCode)

		DisplayBuyer
			restricted
			when (RequesterRel.DisplayBuyer)

		DisplayOnlyBuyer
			restricted
			when (RequesterRel.DisplayOnlyBuyer)

		DisplayPatientProcedure
			restricted
			when (RequesterRel.DisplayPatientProcedure and DisplayOfProcedureInfo)

		DisplayVendor
			restricted
			when (RequesterRel.DisplayVendor)

		DisplayPurchaseFrom
			restricted
			when (RequesterRel.DisplayPurchaseFrom)

		DisplayCommodityCode
			restricted
			when (RequesterRel.DisplayCommodityCode)
		
		DisplayStrategicSourcingUsed
			restricted
			when (RequesterRel.StrategicSourcingUsed)
		
		RSSLPLAllocationPriorityLevelEnabled
			restricted
            when (RSSLPLConfigurationParameterRel exists)

		DisplayRequisitionDescription
			restricted
			when (RequesterRel.DisplayRequisitionDescription)
		
		DisplaySingleDocToPO
			restricted
			when (RequesterRel.DisplaySingleDocToPO)
		
		DisplayDeliverTo
			restricted
			when (RequesterRel.DisplayDeliverTo)

		DisplayCommentType
			restricted
			when (RequesterRel.DisplayCommentType)
		
		DisplayQuoteRequired
			restricted
			when (RequesterRel.DisplayQuoteRequired)

		RequisitionLinePunchoutIdExists
			restricted
			when (RequisitionLinesPunchoutIdRel exists)

		IsMSCMServerEnabled
			when (MSCMServerConfigurationRel exists)

		DisplayMSCMURL
			when (IsMSCMServerEnabled
			and (DerivedStatusValue = 1
			or DerivedStatusValue = 5))

		DisplayDropShip
			restricted
			when (RequesterRel.AllowAlternateShipToAddress
			and RequesterRel.DisplayDropShip)

		ResponsibilityMatrixApprovalExists
			restricted
			when (ResponsibilityMatrixApprovalProcessorRel exists)
		
		RSSLPLValidateDeliverTo
			restricted
			when (RequesterRel.RequireDeliverTo
			and DeliverTo not entered)
		
		RSSLPLValidatePOCode
			restricted
			when (RequesterRel.RequirePOCode
			and POCode not entered)
		
		RSSLPLValidateBuyer
			restricted
			when (RequesterRel.RequireBuyer
			and Buyer not entered)
		
		RSSLPLValidateRequisitionDescription
			restricted
			when (RequesterRel.RequireRequisitionDescription
			and  RequisitionDescription not entered)
		
		RSSLPLValidateRequestedDeliverDate
			restricted
			when (RequesterRel.RequireRequestedDeliveryDate
			and  RequestedDeliveryDate not entered)
		
		RSSLPLValidateVendor
			restricted
			when (RequesterRel.RequireVendor
			and  Vendor not entered)
		
		RSSLPLMissingRequiredFieldsHeader
			restricted
			when (RequesterRel.CurrentRequisitionForRQC entered
			and (RSSLPLValidateDeliverTo
			or RSSLPLValidatePOCode
			or RSSLPLValidateBuyer
			or RSSLPLValidateRequisitionDescription
			or RSSLPLValidateRequestedDeliverDate
			or RSSLPLValidateVendor))
		
		HasPreferenceCardTransaction
			restricted
			when (PreferenceCardRequisitionLinesRel exists)
		
		RSSLPLDisplayCurrencyCode
			restricted
			when (RequesterRel.RSSLPLDisplayCurrencyCode)
		
		RSSLPLDisplayAllocationPriorityLevel
			restricted
			when (RSSLPLAllocationPriorityLevelEnabled
			and RequesterRel.RSSLPLDisplayPriority)
		
		RSSLPLDisplayPriority
			restricted
			when (not RSSLPLAllocationPriorityLevelEnabled
			and RequesterRel.RSSLPLDisplayPriority)
		
		RSSLPLDisplayFromCompany
			restricted
			when (RequesterRel.RSSLPLDisplayFromCompany)
		
		RSSLPLDisplayFromLocation
			restricted
			when (RequesterRel.RSSLPLDisplayFromLocation)
		
		RSSLPLDisplayCompany
			restricted
			when (RequesterRel.RSSLPLDisplayCompany)
		
		RSSLPLDisplayRequestingLocation
			restricted
			when (RequesterRel.RSSLPLDisplayRequestingLocation)
		
		RSSLPLDisplayRequestingLocationAndCompanyHidden
			restricted
			when (RSSLPLDisplayRequestingLocation
			and not RSSLPLDisplayCompany)
		
		RSSLPLDisplayCompanyAndRequestingLocationHidden
			restricted
			when (RSSLPLDisplayCompany
			and not RSSLPLDisplayRequestingLocation)
		
		RSSLPLDisplayCompanyAndRequestingLocation
			restricted
			when (RSSLPLDisplayCompany
			and RSSLPLDisplayRequestingLocation)
		
		RSSLPLHideCompanyAndRequestingLocation
			restricted
			when (not RSSLPLDisplayCompany
			and not RSSLPLDisplayRequestingLocation)

	Relations
		TaxEntityRel
			one-to-one relation to TaxEntity
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.TaxEntity 				= Company.AccountingEntity
					
		RecipeItemsInFromLocationRel
			one-to-many relation to ItemLocation
			Field Mapping uses symbolic key
				related.Company				= FromCompanyLocation.FromCompany
				related.InventoryLocation	= FromCompanyLocation.FromLocation
			Instance Selection
				where (related.Item.Ingredient)
			
		RequisitionLinesWithCostRel is a RequisitionLine set
			Instance Selection
				where (related.TransactionUnitCost > 0)

		PrintOnRequisitionCommentsRel
			one-to-many relation to RequisitionComment
			Field Mapping uses part of key
				related.Company     = Company
				related.Requisition = Requisition
			Instance Selection
				where (related.CommentType.PrintOnRequisition
				or	   related.CommentType.PrintOnInternalDocuments)

		RequisitionSpreadAOCRel is a RequisitionSpreadAddOnCharge set

		BudgetEditBatchRel
			one-to-many relation to BudgetEditBatch
			Field Mapping uses ByDocumentID
				related.DocumentID                          = UniqueID

		BuyerRel
			one-to-one relation to Buyer
			Field Mapping uses symbolic key
				related.HROrganization 	= Requisition.Requester.HROrganization
				related.Buyer			= Requisition.Buyer
				
		BuyerFromRequisitionLineRel
			one-to-many relation to Buyer
			Field Mapping uses symbolic key
				related.HROrganization 	= Requisition.Requester.HROrganization
			Instance Selection
				where (related.Buyer			= LocalBuyer)
				
		VendorFromRequisitionLineRel
			one-to-many relation to Vendor
			Field Mapping uses symbolic key
				related.VendorGroup    = Company.ItemGroup
			Instance Selection
				where (related.Vendor         = LocalVendor)
				
		OperatorIsSupplierPrimaryRel
			one-to-one relation to ActorRole
			Field Mapping uses symbolic key
				related.Actor 			= OperatorID
				related.ActorRole.Role	= "SupplierPrimaryContact_ST"

		OperatorIsSupplierContactRel
			one-to-one relation to ActorRole
			Field Mapping uses symbolic key
				related.Actor 			= OperatorID
				related.ActorRole.Role	= "SupplierContact_ST"

		SupplierContactMessageRel
			one-to-many relation to SupplierContactMessage
			Field Mapping uses symbolic key
				related.SupplierGroup				= actor.agent(SupplierSourceId).SupplierGroup
 				related.Supplier  			 		= actor.agent(SupplierSourceId).Supplier
				related.SupplierSourceId            = actor.agent(SupplierSourceId).SupplierSourceId
			Instance Selection
				where (related.OriginatingCompany			= Company
				and    related.OriginatingRequisition       = Requisition)

		SupplierMessageDialogRel
			one-to-many relation to SupplierMessageDialog
			Field Mapping uses symbolic key
				related.SupplierGroup				= Company.ItemGroup
 				related.Supplier					= SupplierSourceIdByActorRel.Supplier
				related.SupplierSourceId            = SupplierSourceIdByActorRel.SupplierSourceId
			Instance Selection
				where (related.SupplierContactMessage.OriginatingCompany		= Company
				and    related.SupplierContactMessage.OriginatingRequisition    = Requisition)

        SupplierKeywordShadowRel
			one-to-many relation to KeywordShadow
			Field Mapping uses symbolic key

		SupplierGroupRel 
			one-to-one relation to SupplierGroup
			Field Mapping uses symbolic key
 				related.SupplierGroup 	= actor.agent(SupplierSourceId).SupplierGroup

		SupplierRel
			one-to-one relation to Supplier
			Field Mapping uses symbolic key
 				related.SupplierGroup 	= actor.agent(SupplierSourceId).SupplierGroup
 				related.Supplier   		= actor.agent(SupplierSourceId).Supplier								
		
		SupplierSourceIdRel
			one-to-one relation to SupplierSourceId
			Field Mapping uses symbolic key
 				related.SupplierGroup 		= actor.agent(SupplierSourceId).SupplierGroup
 				related.Supplier   			= actor.agent(SupplierSourceId).Supplier
				related.SupplierSourceId	= actor.agent(SupplierSourceId).SupplierSourceId

		SupplierSourceIdByActorRel
			one-to-many relation to SupplierSourceId
			Field Mapping uses symbolic key
 				related.SupplierGroup 		= Company.ItemGroup
			Instance Selection	 
				where (related.LoginName	   = CreatedBy
				and    related.Supplier.Vendor = Vendor)

		LocalContractRel
            one-to-one relation to Contract
            Field Mapping uses symbolic key
                related.ContractGroup   = Company.ItemGroup
                related.Contract        = LocalContract

        LinesForAContractLineRel
            one-to-many relation to RequisitionLine
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.Requisition             = Requisition
            Instance Selection
                where (related.ContractLine entered)

        LinesNotForAContractLineRel
            one-to-many relation to RequisitionLine
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.Requisition             = Requisition
            Instance Selection
                where (related.ContractLine !entered)

		ContractLinesForVendorRel
			one-to-many relation to ContractLine
			Field Mapping uses ByVendor
				related.Vendor                 = Vendor 
				related.ContractGroup          = Company.ItemGroup
			Instance Selection
				where (related.UseForCostDefaultingSomewhere)

		CapitatedContractRel 
			one-to-many relation to Contract
			Field Mapping uses symbolic key 
				related.ContractGroup	= Company.ItemGroup 
			Instance Selection 
				where (related.CapitatedContract)
		
		CapitatedComponentItemsRel 
			one-to-many relation to ContractCapitatedComponentGroupItem 
			Field Mapping uses symbolic key
				related.ContractGroup			        = Company.ItemGroup 
				related.Contract                        = any LinesForAProcedureRel.Contract 
				related.ContractLine                    = any LinesForAProcedureRel.ContractLine 
			Instance Selection 
				where (related.ContractLine.UseForCostDefaulting)
        
		LinesForAProcedureRel 
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (related.IsACapitatedProcedure)	

		ChargedLinesForComponentsRel 		
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (!related.IsACapitatedProcedure
				and     related.LineExtendedAmount > 0)	

		ChargedLinesForComponentsForProcedureRel 		
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (related.CapitatedComponentGroup entered
				and    related.CapitatedProcedureLine entered
				and    related.LineExtendedAmount > 0)		

		NoChargeLinesForComponentsForProcedureRel 		
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (related.CapitatedComponentGroup entered
				and    related.CapitatedProcedureLine entered
				and    related.LineExtendedAmount = 0)	

		ChargedLinesForComponentsForGroupRel 		
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (related.CapitatedComponentGroup entered
				and    related.LineExtendedAmount > 0)			

		PrimaryProcedureRel 
			one-to-many relation to RequisitionLine
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (related.CapitatedProcedureLevel = 1)			

		RevisionProcedureRel 
			one-to-many relation to RequisitionLine
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (related.CapitatedProcedureLevel = 2)	

		PurchaseOrderInterfaceForThisRequisitionRel 
			one-to-many relation to PurchaseOrderInterface 
			Field Mapping uses Set10
				related.PurchaseOrderInterface.SourceDocumentOrigin		= "RQ"
				related.PurchaseOrderInterface.OperatingCompany         = Company
				related.PurchaseOrderInterface.SourceDocumentNumeric	= Requisition	

		PurchaseOrderInterfaceForThisActorRel 
			one-to-many relation to PurchaseOrderInterface 
			Field Mapping uses ByActor
				related.Actor		= actor

		CapitatedSelectForSwapNoChargeRel 
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (related.CapitatedSelectForSwapNoCharge = true)	

		CapitatedSelectForSwapChargedRel
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company					= Company
				related.Requisition             = Requisition 
			Instance Selection 
				where (related.CapitatedSelectForSwapCharged = true)		
		LinesWithNoLotOrSerialRel 
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company			= Company 
				related.Requisition     = Requisition
			Instance Selection 
				where (related.CapitatedComponentGroup entered
				and   (related.PatientProcedure.SerialNumber !entered
				and    related.PatientProcedure.Lot !entered))					
		LinesWithDuplicateSerialRel
			one-to-many relation to RequisitionLine 
			Field Mapping uses symbolic key 
				related.Company			= Company 
				related.Requisition     = Requisition
			Instance Selection 
				where (related.HasDuplicateSerialNumber)
		LaterPOLineForAContractRel
            one-to-many relation to RequisitionLine
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.Requisition             = Requisition
            Instance Selection
                where (related.Contract = LocalContract
                and    related.RequisitionLine > LocalRequisitionLine)

		TrialNoticeRel
			one-to-one relation to RecallNotice
			Field Mapping uses symbolic key
				related.RecallGroup     = Company.ItemGroup
				related.RecallNotice    = TrialNotice

		BasicAnalyticsCalendarPeriodRel
			one-to-one relation to BasicAnalyticsCalendarPeriod
			Field Mapping uses LeafRecordsGregorian
				related.Date = CreationDate date

		GeneralLedgerCalendarPeriodXrefRel								
			one-to-one relation to GeneralLedgerCalendarPeriodXref
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.GeneralLedgerCalendarPeriodXref	= CreationDate

		FromLocationRel
			one-to-one relation to InventoryLocation
			Field Mapping uses symbolic key
				related.Company           = FromCompanyLocation.FromCompany
				related.InventoryLocation = FromCompanyLocation.FromLocation

		RequisitionAddOnChargesRel
			one-to-many relation to RequisitionLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company					= Company
				related.Requisition				= Requisition
				related.RequisitionLine			= blank

		TaxableRequisitionAddOnChargesRel
			one-to-many relation to RequisitionLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company					= Company
				related.Requisition				= Requisition
				related.RequisitionLine			= blank
			Instance Selection
				where (related.Taxable)

		TaxableRequisitionLineAddOnChargesRel
			one-to-many relation to RequisitionLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company					= Company
				related.Requisition				= Requisition
			Instance Selection
				where (related.RequisitionLine entered
				and	   related.Taxable)

		CurrentPurchaseFromLocationRel
			one-to-one relation to PurchaseFromLocation
			Field Mapping uses symbolic key
				related.VendorGroup				= Company.ItemGroup
				related.Vendor					= CurrentVendor
				related.PurchaseFromLocation	= CurrentPurchaseFromLocation

		HeaderAddOnChargesByRateRel
			one-to-many relation to RequisitionLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company					= Company
				related.Requisition				= Requisition
				related.RequisitionLine			= blank
			Instance Selection
				where (related.AddOnChargeEntryMethod.RatePercentage)

		PurchasingVendorFromLineRel
			one-to-one relation to PurchasingVendor
			Field Mapping uses symbolic key
				related.VendorGroup		= Company.ItemGroup
				related.Vendor			= CurrentVendor

		LinesForWarehouseProcessingRel
			one-to-many relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.Requisition        		= Requisition
			Instance Selection
				where (not related.CreatePurchaseOrder)

		InventoryLinesToKillRel
			one-to-many relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.Requisition        		= Requisition
			Instance Selection
				where (not related.CreatePurchaseOrder
				and    related.FillOrKill = "K")

		VendorEditRequisitionLineRel
			one-to-many relation to RequisitionLine
			Field Mapping uses ByVendor
			Instance Selection
				where	(related.Requisition	= Requisition
				and    	 related.Company		= Company
				and		 related.HasPurchasingVendor)

		RequisitionLinesInErrorRel
			one-to-many relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.Requisition        		= Requisition
			Instance Selection
				where (related.LineErrorsExist)

		ParLocationsRel
			one-to-many relation to ItemLocation
			Field Mapping uses symbolic key
				related.Company    			= Company
				related.InventoryLocation 	= RequestingLocation

		ParItemsRel
			one-to-many relation to BinGroupDetail
			Field Mapping uses symbolic key
				related.Company				= Company
				related.InventoryLocation	= RequestingLocation
				related.BinGroup			= RequestingLocation

		ParLocationsCountRel
			one-to-many relation to ItemLocation
			Field Mapping uses symbolic key
				related.Company    			= Company
				related.InventoryLocation 	= RequestingLocation
		   	Instance Selection
		   		where (related.ParLocationCount != related.ReorderPoint)


		RequisitionLinesRel is a RequisitionLine set
			classic name is REQ-LINES

		TaxableRequisitionLinesRel is a RequisitionLine set
			Instance Selection
				where (related.PurchaseTaxable)

		RequisitionLinesToCopyRel is a RequisitionLine set
			Instance Selection
				where (!related.CostCode.Punchout)

		RequisitionReturnLineRel is a RequisitionLine set
			Instance Selection
				where (related.ReturnQuantity entered
     			and    related.ReturnQuantity != related.RelReturnQuantityToDate)

		RequisitionReturnQuantityLineRel is a RequisitionLine set
			Instance Selection
				where (related.ReturnQuantity entered)

		RequisitionReturnAllowedLineRel is a RequisitionLine set
			Instance Selection
				where (related.AllowRequisitionReturn)

		RequisitionReturnLineToNewRequisitionRel is a RequisitionLine set
			Instance Selection
				where (related.NewRequisition)

		RequisitionLinesUnreleasedRel is a RequisitionLine set
			Instance Selection
				where (related.Status.Unreleased)

		RequisitionLinesProcessedRel is a RequisitionLine set    
			Instance Selection
				where (related.Status > 0)

		RequisitionLinesToSourcingRel is a RequisitionLine set
			Instance Selection
				where (related.SourcingEventRequired)

		RequisitionLinesToPurchaseOrderRel is a RequisitionLine set
			Instance Selection
				where (related.CreatePurchaseOrder)

		RequisitionLinesOpenRel
			one-to-many relation to RequisitionLine
			Field Mapping uses Set4
				related.Company     = Company
				related.Requisition = Requisition
			Instance Selection
				where (!related.Closed)

		RequisitionLinesNonPunchoutRel is a RequisitionLine set
			Instance Selection
				where (!related.CostCode.Punchout
		 		and	   related.PunchoutId not entered)

		RequisitionLinesPunchoutRel is a RequisitionLine set
			Instance Selection
				where (related.CostCode.Punchout
				or    (related.CostCode.Contract
				and    related.PunchoutId entered))

		PreviousRequisitionLineRel
			one-to-one relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company     	= Company
				related.Requisition 	= Requisition
				related.RequisitionLine = (LastRequisitionLine - 1)

		RequisitionLinesWithCatchWeightItemRel is a RequisitionLine set
			Instance Selection
				where (related.IsCatchWeightItem)

		RequisitionLineDistributionsRel is a RequisitionLineDistribution set
			Instance Selection
				where (related.AddOnCharge not entered)

		CurrentRequisitionRel
			one-to-one relation to Requisition
			Field Mapping uses symbolic key
				related.Company				= actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
				related.Requisition			= actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC











		PurchasingCompanyRel
			one-to-one relation to PurchasingCompany
			Field Mapping uses symbolic key
				related.Company = FromCompanyLocation.FromCompany

		SourcingCompanyRel
			one-to-one relation to SourcingCompany
			Field Mapping uses symbolic key
				related.Company = Company


		PayablesCompanyRel
			one-to-one relation to PayablesCompany
			Field Mapping uses symbolic key
				related.Company = Company

		RequisitionCommentRel
			one-to-many relation to RequisitionComment
			Field Mapping uses part of key
				related.Company     = Company
				related.Requisition = Requisition

		RSSCommentRel
			one-to-many relation to RequisitionComment
			Field Mapping uses part of key
				related.Company     = Company
				related.Requisition = Requisition
			Instance Selection
				where 	(related.CommentType = DefaultCommentType
				and 	 related.CommentText entered)

		RSSAttachmentRel
			one-to-many relation to RequisitionComment
		 	Field Mapping uses part of key
				related.Company     = Company
				related.Requisition = Requisition
			Instance Selection
				where 	(related.CommentType = DefaultCommentType
				and	   related.Attachment.MimeType entered)

		RequisitionLineDistributionRel
			one-to-many relation to RequisitionLineDistribution
			delete cascades
			Field Mapping uses symbolic key
				related.Company     = Company
				related.Requisition = Requisition

		CommittedRequisitionLineDistributionRel
			one-to-many relation to RequisitionLineDistribution
			Field Mapping uses symbolic key
				related.Company     = Company
				related.Requisition = Requisition
			Instance Selection
				where (related.CurrentCommitmentExists)

		VendorLocationRel
			one-to-one relation to VendorLocation
			Field Mapping uses symbolic key
				related.VendorGroup    = Company.ItemGroup
				related.Vendor         = Vendor
				related.VendorLocation = PurchaseFromLocation

		NewProcurementTemplateRel
			one-to-one relation to ProcurementTemplate
			Field Mapping uses symbolic key
				related.ProcurementGroup    = PurchasingCompanyRel.ProcurementGroup
				related.ProcurementTemplate = TransientCreatedProcurementTemplate

		ProcurementTemplateParticipantsByRequesterRel
			one-to-many relation to ProcurementTemplateParticipant
			Field Mapping uses ByRequester
				related.ProcurementGroup    = ProcurementTemplate.ProcurementGroup
				related.ProcurementTemplate = ProcurementTemplate
				related.Requester           = Requester

		ProcurementTemplateParticipantsByCompanyRel
			one-to-many relation to ProcurementTemplateParticipant
			Field Mapping uses Set4
				related.ProcurementGroup    = ProcurementTemplate.ProcurementGroup
				related.Company             = Requisition.Company
				related.ProcurementTemplate = ProcurementTemplate
			Instance Selection
				where (related.Requester			= blank
				and	   related.RequestingLocation	= blank)

		ProcurementTemplateParticipantsByRequestingLocationRel
			one-to-many relation to ProcurementTemplateParticipant
			Field Mapping uses Set5
				related.ProcurementGroup    = ProcurementTemplate.ProcurementGroup
				related.Company             = Requisition.Company
				related.RequestingLocation  = RequestingLocation
				related.ProcurementTemplate = ProcurementTemplate

		ProcurementTemplateParticipantsForAVendorRel
			one-to-many relation to ProcurementTemplateParticipant
			Field Mapping uses symbolic key
				related.ProcurementGroup    = ProcurementTemplate.ProcurementGroup
				related.ProcurementTemplate = ProcurementTemplate

		StandardCommentCodeRel
			one-to-many relation to StandardCommentCode
			Field Mapping uses Set1
				related.ProcurementGroup    = Company.ItemGroup
				related.StandardCommentCode = DefaultCommentCode
			Instance Selection
				where (related.IsoLocale not entered)

		BuyingOrganizationRel
			one-to-one relation to BuyingOrganization
			Field Mapping uses symbolic key
				related.BuyingOrganization = Company.ItemGroup

		RequesterFinanceStructureRel
			one-to-many relation to RequesterFinanceStructure
			Field Mapping uses symbolic key
			Instance Selection
				where (related.DistributionAccount	= DefaultDistributionAccount
				and     related.Requester			= Requester)

		RequesterFinanceStructureExistRel
			one-to-many relation to RequesterFinanceStructure
			Field Mapping uses symbolic key
				related.HROrganization				= Requester.HROrganization
				related.Requester					= Requester

		RequesterFinanceStructuresRel
			one-to-many relation to RequesterFinanceStructure
			Field Mapping uses symbolic key
				related.HROrganization				= Requester.HROrganization
				related.Requester					= Requester
			Instance Selection
				where (related.DistributionAccount	= LocalRequesterRestrictedAccount)

		RQGeneralLedgerSystemCodeRel
			one-to-one relation to GeneralLedgerSystemCode
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= Company.ItemGroup.FinanceEnterpriseGroup
				related.GeneralLedgerSystemCode			= "RQ"

		GLCommitDrillRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID            = UniqueID

		BudgetRebuildBTGTRel
			one-to-one relation to BudgetRebuildBTGT
			Field Mapping uses symbolic key
				related.BudgetRebuildBTGT.DocumentID = UniqueID

		OpenGLCommitDrillRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where (related.Status != 1)

		GLCommitManualEncumbrancesRel
			one-to-many relation to GLCommit
			Field Mapping uses ByGLEncumbranceReference
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup

		GLCommitByManualEncumbranceRel
			one-to-many relation to GLCommit
			Field Mapping uses ByGLEncumbranceReference
				related.FinanceEnterpriseGroup          = Company.ItemGroup.FinanceEnterpriseGroup
				related.GLEncumbranceReference          = DefaultGLEncumbranceReference
				related.System                          = "GL"

		GLCommitDocumentRel
			one-to-one relation to GLCommitDocument
			Field Mapping uses ByHeaderObjectReference
				related.HeaderObjectReference		= reference to this instance







		AccountingUnitCommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.AccountingUnit = AccountingUnit)

		AccountingEntityCommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.ToAccountingEntity = AccountingEntity)

		AccountCommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.GeneralLedgerChartAccount = Account)

		ProjectCommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.Project = Project)

		Dimension1CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension1 = FinanceDimension1)

		Dimension2CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension2 = FinanceDimension2)

		Dimension3CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension3 = FinanceDimension3)

		Dimension4CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension4 = FinanceDimension4)

		Dimension5CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension5 = FinanceDimension5)

		Dimension6CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension6 = FinanceDimension6)

		Dimension7CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension7 = FinanceDimension7)

		Dimension8CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension8 = FinanceDimension8)

		Dimension9CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension9 = FinanceDimension9)

		Dimension10CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension10 = FinanceDimension10)


		BudgetTemplateGroupTotalRel
			one-to-many relation to BudgetTemplateGroupTotal
			Field Mapping uses ByBudgetGroup
				related.FinanceEnterpriseGroup                    = Company.ItemGroup.FinanceEnterpriseGroup
				related.BudgetTemplateGroupTotal.BudgetEditGroup  = UniqueID

	   	HeaderBudgetEditErrorRel
			one-to-many relation to BudgetEditError
			Field Mapping uses ByBudgetGroup
				related.FinanceEnterpriseGroup              = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.BudgetEditError.BudgetEditGroup     = UniqueID

		DistributionBudgetEditErrorRel
			one-to-many relation to BudgetEditError
			Field Mapping uses ByHeaderUniqueID
				related.FinanceEnterpriseGroup              = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID                      = UniqueID

	   	UnreleasedRequisitionLinesRel is a RequisitionLine set
	   		Instance Selection
	   			where (related.Status.Unreleased)

	   	ForApprovalRequisitionLinesRel is a RequisitionLine set
	   		Instance Selection
	   			where (related.Status								= 1
	   			and	   related.Approved								= false)

	   	NotClosedOrRejectedLinesRel is a RequisitionLine set
	   		Instance Selection
	   			where (related.IsProcessedAndClosedStatus			= false
	   			and    related.IsRejectedStatus						= false)

		RequisitionLineByContract
			one-to-many relation to RequisitionLine
			Field Mapping uses Set10
				related.Company		= Company
				related.Requisition	= Requisition
			Instance Selection
				where (related.Contract.MaxEditPoAndRq)

		RequisitionLineByInventoriedItem
			one-to-many relation to RequisitionLine
			Field Mapping uses ByInventoryItem
				related.Company		= Company
				related.Requisition = Requisition
			Instance Selection
				where (related.ItemLocationRel.MaximumRequisitionQuantity entered)

		PfiWorkunitRel
			one-to-many relation to PfiWorkunit
			Field Mapping uses ByAppsKeyAppsValueWorkunit
				related.AppsKey		= "REQUISITION"			
				related.AppsValue	= DerivedAppsValue

		PfiMetricsRel
			one-to-many relation to PfiMetrics
			Field Mapping uses ByWorkunitActivityQueueAssignmentActionTakenUserProfileTask
			Instance Selection
				where (related.PfiWorkunit = first PfiWorkunitRel.PfiWorkunit)

		CompanySystemClosingControlRel
			one-to-one relation to CompanySystemClosingControl
			Field Mapping uses BySystemCode
				related.GeneralLedgerSystemCode		= "RQ"
				related.Company						= Company

		RequisitionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "Requisition"

		RequisitionLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "RequisitionLine"

		RequisitionLineDistributionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "RequisitionLineDistribution"

		BasicAnalyticsCalendarsRel 		is a BasicAnalyticsCalendar set

		MyRequesterRequestingLocationRel
			one-to-many relation to RequesterRequestingLocation
			Field Mapping uses Rrlset2
				related.Requester		= actor.agent(Employee).Employee

		PurchaseOrderLineSourcesRel
			one-to-many relation to PurchaseOrderLineSource
			Field Mapping uses Set2
				related.PurchaseOrderLineSource.OperatingCompany         = Company
				related.PurchaseOrderLineSource.SourceDocumentOrigin     = "RQ"
				related.PurchaseOrderLineSource.SourceDocumentNumeric    = Requisition

		MyRequestingLocationRel
			one-to-one relation to RequesterRequestingLocation
			Field Mapping uses symbolic key
				related.Company				= Company
				related.Requester			= actor.agent(Employee).Employee
				related.RequestingLocation  = RequestingLocation

		RequestingLocationRel
			one-to-one relation to RequesterRequestingLocation
			Field Mapping uses symbolic key
				related.Company				= Company
				related.Requester			= Requester
				related.RequestingLocation  = RequestingLocation

		RequesterRequestingLocationRel
			one-to-many relation to RequesterRequestingLocation
			Field Mapping uses Rrlset2
				related.Requester			= Requester

		PatientProcedureRel
			one-to-one relation to PatientProcedure
			Field Mapping uses symbolic key
				related.Company             = FromCompanyLocation.FromCompany
				related.PatientProcedure	= LocalPatientProcedure

		EntityTaxCodeRel
			one-to-one relation to EntityTaxCode
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.TaxEntity					= Company.AccountingEntity
				related.TaxCode						= PurchaseTaxCode

		AllEntityTaxCodesRel
			one-to-many relation to EntityTaxCode
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
			Instance Selection
				where (related.TaxEntity			= Company.AccountingEntity)

		InterEntityRelationRel
			one-to-one relation to GLInterEntityRelation
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.AccountingEntity			= Company.AccountingEntity
				related.ToAccountingEntity			= FromCompanyLocation.FromCompany.AccountingEntity

		WarehouseShipmentRel
			one-to-many relation to WarehouseShipment
			Field Mapping uses DemandSet
				related.Company									= Company
				related.InventoryLocation						= FromCompanyLocation.FromLocation
				related.WarehouseDemand.DemandSystemCode		= "RQ"
				related.WarehouseDemand.DemandDocument			= Requisition
				related.WarehouseDemand.DemandCompany			= Company

		InventoriedAndNonStockRequisitionLineRel
	   		one-to-many relation to RequisitionLine
	   		Field Mapping uses ByDeliverFromLocation
	   			related.Company		= Company
	   			related.Requisition = Requisition
	   		Instance Selection
	   			where (related.ItemLocationRel.MaximumRequisitionQuantity entered)

		UserDefaultPrinterRel
			one-to-one relation to UserDefaultPrinter
			Field Mapping uses symbolic key
				related.UserDefaultPrinter.Actor = actor

		DemandWarehouseDemandRel
			one-to-one relation to WarehouseDemand
			Field Mapping uses symbolic key
				related.Company								= FromCompanyLocation.FromCompany
				related.WarehouseDemand.DemandSystemCode	= "RQ"
				related.WarehouseDemand.DemandDocument		= Requisition
				related.WarehouseDemand.DemandCompany		= Company

		SupplyWarehouseDemandRel
			one-to-one relation to WarehouseDemand
			Field Mapping uses symbolic key
				related.Company								= Company
				related.WarehouseDemand.DemandSystemCode	= "RQ"
				related.WarehouseDemand.DemandDocument		= Requisition
				related.WarehouseDemand.DemandCompany		= Company

	




		FSMBODConfigurationParameterRel
        	one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
            	related.FSMBODConfigurationParameter 		= LocalConfigurationParameter

		FSMBODConfigurationRel
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 1
				related.FSMBODConfiguration.Noun 		= "Requisition"
				related.FSMBODConfiguration.Direction 	= 1

		ProcurementGroupRel
			one-to-one relation to ProcurementGroup
			Field Mapping uses symbolic key
				related.ProcurementGroup = Company.ItemGroup

		FSMInboundBODTrackerRel
            one-to-one relation to FSMInboundBODTracker
            Field Mapping uses symbolic key
                related.FSMInboundBODTracker	= LocalFSMInboundBODTracker






		PurgeRequisitionSpreadAddOnChargeRel is a RequisitionSpreadAddOnCharge set
			Instance Selection
				include deleted records

		PurgeRequisitionLineAddOnChargeRel is a RequisitionLineAddOnCharge set
			Instance Selection
				include deleted records

		PurgeRequisitionCommentRel is a RequisitionComment set
			Instance Selection
				include deleted records

		PurgeRequisitionLineRel is a RequisitionLine set
			Instance Selection
				include deleted records

		RequisitionLinesKilledQuantityRel
			one-to-many relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.Requisition        		= Requisition
			Instance Selection
				where (related.KilledQuantity entered)

		ProcurementTemplateLinesRel 
			one-to-many relation to ProcurementTemplateLine
			Field Mapping uses symbolic key
				related.ProcurementGroup    	= ProcurementTemplate.ProcurementGroup
				related.ProcurementTemplate 	= ProcurementTemplate

		ProcurementTemplateLinesForAVendorRel
			one-to-many relation to ProcurementTemplateLine
			Field Mapping uses symbolic key
				related.ProcurementGroup    	= Company.ItemGroup
			Instance Selection
				where (related.DerivedVendorForList = Vendor)		

		RequisitionLineErrorsRel
			one-to-many relation to RequisitionLineError
			Field Mapping uses symbolic key
				related.Company					= Company
				related.Requisition	        	= Requisition
			Instance Selection
				where (related.RequisitionLine not entered)
	
		OtherRequisitionLinesRel
			one-to-many relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company					= Company
			Instance Selection
				where (related.RequisitionLine.Requisition not = Requisition)

		GeneralLedgerCompanyRel
			one-to-one relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
				related.Company			= Company


		RequisitionLinesWithSpecialHandlingRel is a RequisitionLine set
			Instance Selection
				where (related.SpecialHandlingCode entered)
		
		RequesterRel 
			one-to-one relation to Requester
			Field Mapping uses symbolic key
				related.HROrganization = actor.agent(Employee).HROrganization
				related.Requester = actor.agent(Employee).Employee.Requester.Requester

		RequisitionLinesPunchoutIdRel is a RequisitionLine set
			Instance Selection
				where (related.PunchoutId entered)

      	MSCMServerConfigurationRel
            one-to-one relation to ConfigurationParameter
            Field Mapping uses symbolic key
                related.ConfigurationParameter.ConfigurationID	= "config"
                related.ConfigurationParameter.Name				= "MSCM_URL"
		
		IDMAdditionalAttributesLinesRel
			one-to-many relation to IDMAdditionalAttributesLines
			Field Mapping uses symbolic key
				related.IDMAdditionalAttributesHeader = "FSM_Requisition"
			Instance Selection
				where(related.IDMAdditionalAttributesHeader.ActivateAdditionalAttributes
				and	  related.ActivateAdditionalAttributes.Active)


		RSSLPLConfigurationParameterRel
            one-to-many relation to ConfigurationParameter
            Field Mapping uses symbolic key
                related.ConfigurationParameter.ConfigurationID  = "config"
                related.ConfigurationParameter.Name             = "RSS_LPLAllocationPriorityLevel"
			Instance Selection
				where (related.ConfigurationParameter.Value = "true")
		
		RSSLPLAllocationPriorityLevelRel
			one-to-many relation to AllocationPriorityLevel
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= actor.context.FinanceEnterpriseGroup
			Instance Selection
				where (related.UseAsDefault)
		ResponsibilityMatrixRel
			one-to-many relation to ResponsibilityMatrix
			Field Mapping uses ByPriorityAndDimensionCount
				related.FinanceEnterpriseGroup		= Company.ItemGroup.FinanceEnterpriseGroup
			Instance Selection
				where (related.Active)

		ResponsibilityMatrixApprovalProcessorRel
			one-to-one relation to ApprovalProcessor
			delete cascades
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup							= Company.ItemGroup.FinanceEnterpriseGroup
				related.ApprovalProcessor.ApprovalType					= blank
				related.ApprovalProcessor.SystemCode					= "RQ"
				related.ApprovalProcessor.ApprovalTransactionForm		= ApprovalTransactionForm.Requisition
				related.ApprovalProcessor.TransactionHeader1			= Company									
				related.ApprovalProcessor.TransactionHeader2			= RequestingLocation
				related.ApprovalProcessor.TransactionHeader3			= blank
				related.ApprovalProcessor.TransactionHeader4			= blank
				related.ApprovalProcessor.TransactionLine1				= blank
            	related.ApprovalProcessor.TransactionLine2            	= blank
				related.ApprovalProcessor.Transaction					= Requisition

		DefaultEntityRel
			one-to-one relation to AccountingEntity
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		   = Company.ItemGroup.FinanceEnterpriseGroup
				related.AccountingEntity			   = DefaultDistributionAccount.ToAccountingEntity

		IssueAccountEntityRel
			one-to-one relation to AccountingEntity
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		   = Company.ItemGroup.FinanceEnterpriseGroup
				related.AccountingEntity			   = RequestingLocation.IssueAccount.ToAccountingEntity
		
		ScheduledProcedureRel
			one-to-many relation to ScheduledProcedure
			Field Mapping uses symbolic key
				related.Company            			   = Company
			Instance Selection
				where (related.Requisition      	   = Requisition)

		PreferenceCardRequisitionLinesRel is a RequisitionLine set
		   	Instance Selection
		   		where (related.PreferenceCardTransaction)	

	Sets

		Set2
			indexed
			Sort Order
				Company
				RequestingLocation
				Requester
				Requisition

		Set3
			indexed
			Sort Order
				Requester
				Requisition descending
				Company

		Set7
			indexed
			Sort Order
				Requester
				Requisition
				Company

		ByRequester
			not indexed
			Sort Order
				Company
				Requester
				Requisition

		ByStatus
			indexed
			Sort Order
				Company
				Status
				Requisition

		Rrlset2
			duplicates
			Sort Order
				Requester

		ByValidationOption
			duplicates
			Sort Order
				Company
				Requester
				RequestingLocation

		ByProcurementTemplate
			Sort Order
				ProcurementTemplate
				Company
				Requisition

		ByCreationDate
			duplicates
			Sort Order
				CreationDate
				Requisition
				Requester
				Company

		ByRequestedDeliveryDate
			duplicates
			Sort Order
				RequestedDeliveryDate
				Requisition
				Requester
				Company

		ByRequisitionDescription
			duplicates
			Sort Order
				RequisitionDescription
				Requisition
				Requester
				Company

		ByVendor
			duplicates
			Sort Order
				Vendor
				Company
				Requester
				Requisition

		ByVendorName
			duplicates
			Sort Order
				VendorName
				Company
				Requester
				Requisition

		ByDerivedRequisitionMessages
			duplicates
			Sort Order
				RequisitionReleaseMessages
				Requisition
				Requester
				Company

		ByRequisitionStatusValue
			indexed
			Sort Order
				Company
				RequisitionStatusValue
				Requisition

	Field Rules
		Company
			initial value is actor.agent(Employee).Employee.Requester.Company
			default to actor.agent(Employee).Employee.Requester.Company

		Requester
			initial value is actor.agent(Employee).Employee
			if (!CreatedBySupplier)
				if  (!actor.agent(Employee).RequesterExists
				and   actor.agent(Employee).BuyerExists)
					Requester = actor.agent(Employee).BuyerRel.DefaultCapitatedRequester
				default to actor.agent(Employee).Employee
				required

		DefaultDistributionAccount
			if (DefaultGLEncumbranceReference entered
			and ManualEncumbranceIsValid)
				DefaultDistributionAccount = first GLCommitByManualEncumbranceRel.FinanceCodeBlock

		DefaultGLEncumbranceReference
			constraint (ManualEncumbranceIsValid)
				"GLEncumbranceReferenceIsNotValid"

		RequestingLocation
			initial value is Requester.RequestingLocation
			default to Requester.RequestingLocation
			if (RequestingLocation.ProcessLevel entered)
				constraint (RequestingLocation.ProcessLevel.Active)
					"Process_\Level<RequestingLocation.ProcessLevel>of<RequestingLocation>IsInactive"
			if (RequestingLocation changed)
				constraint (RequisitionLinesRel not exists)			   
					"LineExists;CannotChangeRequestingLocation"
			constraint (RequesterRequestingLocations)
				"RequesterIsNotAllowedToUseThisLocation"
			required


			if (DefaultDistributionAccount not entered)
				force default DefaultDistributionAccount to RequestingLocation.IssueAccount

			if (DefaultDistributionAccount entered) 
				include CheckRequesterRestrictedAccount

		FromCompanyLocation
			initial value is RequestingLocation.FromCompanyLocation
			default to RequestingLocation.FromCompanyLocation		
				default individual fields
			if ((RequestingLocation.InventoryTransactionType.DirectTransfer
			or RequestingLocation.InventoryTransactionType.IntransitTransfer)
			and not RequisitionSource.ReplenishmentByRequisition)
				constraint (FromCompanyLocation.FromCompany != Company
				or FromCompanyLocation.FromLocation != RequestingLocation)
					"OnATransfer,TransactionTypeLocationsCannotBeTheSame"
			if (FromCompanyLocation changed)
				constraint (RequisitionLinesRel not exists)		
					"LineExists;CannotChangeFromCompanyOrLocationOnHeader"	
				constraint (RequestingLocation not changed)
					"CannotChangeBothLocationsAtTheSameTime"
			if (Company != FromCompanyLocation.FromCompany)
				constraint (InterEntityRelationRel exists)
					"InterEntityRelationNotDefinedBetweenCompany<Company>AndCompany<FromCompanyLocation.FromCompany>"
				constraint (Company.ItemGroup = FromCompanyLocation.FromCompany.ItemGroup)
					"BothCompaniesItemGroupsMustMatch"
			constraint(PurchasingCompanyRel exists)
				"PurchasingCompanyDoesNotExist"
			constraint (not FromCompanyLocation.FromLocation.LocationType.ParLocation)
				"FromLocationIsAParLocation"
			required
				"From_\CompanyIsRequired"

		OneSourceDocumentToOnePO
			include HeaderEdit



			if (action type.Update
			and OneSourceDocumentToOnePO changed)
				constraint (Requester.OverrideSingleSourceToSinglePO)
					"RequesterDoesNotAllowOverrideOfSingleDocumentToAPurchaseOrder"
			if (RequisitionApprovalType.LineApproval)
				constraint (not OneSourceDocumentToOnePO.Yes)
					"SingleDocumentToAPurchaseOrderCannotBeYesIfLineLevelApproval"
			if (PurchaseOrderUserField1 entered
			or  PurchaseOrderUserField3 entered
			or  PurchaseOrderUserField5 entered
			or  UserDate1 entered
			or  UserDate2 entered)
				constraint (OneSourceDocumentToOnePO.Yes)
					"SingleDocumentToAPurchaseOrderMustBeYesIfPurchaseOrderUserFieldsEntered"

			if (RequisitionAddOnChargesRel exists) 
				constraint (OneSourceDocumentToOnePO.Yes)
					"SingleDocumentToAPurchaseOrderMustBeYesIfRequisitionHasMiscellaneousAddOnCharge"

		Vendor
			if (TransientRSSLPLRequisitionScreen entered
			and RequesterRel.RequireVendor)
				required
					"Field_VendorIsRequired"
			constraint (not SourcingEventRequired)
				"CannotEnterBothVendorAndSourcingEvent"
			constraint (Vendor.IsPoAddActive)
				"A\PVendor<Vendor>IsInactiveForAdding_\PurchaseOrders"

		VendorName
			force default to Vendor.VendorName

		PurchaseFromLocation
			constraint (HasVendorLocation)
				"Vendor<Vendor>Location<PurchaseFromLocation>IsInvalid"
			constraint (VendorLocationRel.IsActive)
				"Vendor<Vendor>Location<PurchaseFromLocation>IsInactive"
			constraint (VendorLocationRel.IsPoAddActive)
				"Vendor<Vendor>Location<PurchaseFromLocation>IsInactiveForAdding_\PurchaseOrders"
  			constraint (not VendorLocationRel.LocationType.RemitTo)
				"Vendor<Vendor>_\Location<PurchaseFromLocation>CannotBeA_\Remit_\ToOnly_\Vendor_\Location"

		GlobalDocumentType
			constraint (GlobalDocumentType.Active)
				"Global_\Document_\Type<GlobalDocumentType>IsInactive"

		SourcingEventRequired
			if (SourcingEventRequired)
				constraint (SourcingCompanyRel exists)
					"Strategic_\SourcingNotUsed;CannotSet_\Sourcing_\Event_\Required"
				constraint (not RequestingLocation.ParOrExchangeLocation)
					"Par_\Location;CannotSet_\Sourcing_\Event_\Required"

		OperatorID
			initial value is actor
			default to actor

		BaseCurrencyCode
			initial value is Company.Currency
			default to Company.Currency


		Buyer
			if (TransientRSSLPLRequisitionScreen entered
			and RequesterRel.RequireBuyer)
				required
					"Field_BuyerIsRequired"
			
			default to RequestingLocation.Buyer

		LocationRule
			default to RequestingLocation.LocationRule

			constraint(LocationRule.DetailsExist)
				"CannotAddLocationRuleThatDoesNotHaveAnyLocations"

		PurchaseTaxCode
			if (PurchaseTaxable)
				default to RequestingLocation.PurchaseTaxCode
				if (PurchaseTaxCode entered
				and not TaxEntityRel.ThirdParty.VertexOSeries
				and not TaxEntityRel.ThirdParty.Sabrix) 
					initialize CalculateTax
					CalculateTax.TaxEntity                      = FromCompanyLocation.FromCompany.AccountingEntity
					CalculateTax.TaxCode                        = PurchaseTaxCode
					CalculateTax.Function                       = CalculateTax.Function.Inquire
					CalculateTax.PostalAddress                  = RequestingLocation.PostalAddress
					TaxOut                                      = CalculateTax.ExecuteCalculateTax
					constraint (CalculateTax.OutputErrorNumber not entered)
						"<CalculateTax.OutputErrorMessage>"
			else
				initialize PurchaseTaxCode

		PurchaseTaxable
			if (action type.Create)
				default to RequestingLocation.PurchaseTaxable

		AllocationPriority
			if (Company.AllocationBasis.ByPriority)
				if (action type.Update
				and RSSLPLAllocationPriorityLevelEnabled
				and TransientAllocationPriorityLevel entered)
					default to TransientAllocationPriorityLevel
				else				
					default to Company.DefaultRQPriority

		RequisitionApprovalType
			if (RequisitionApprovalType not entered
			or  RequestingLocation changed)
				initialize RequisitionApprovalType
				default to Requester.RequisitionApprovalType
				default to RequestingLocation.RequisitionApprovalType
				default to Company.RequisitionApprovalType

		DropshipName
			if (Dropship)
				required
					"NameRequiredWhenNoReceivingIsDone"
			if (DropshipAddress.Country entered
			or	DropshipPhoneNumber entered
			or  DropshipContact entered)
				required
					"NameIsRequiredForAlternateShipToAddress"

		DropshipAddress
			if (Dropship)
				required
					"AddressRequiredWhenNoReceivingIsDone"
			if (DropshipName entered
			or	DropshipPhoneNumber entered
			or  DropshipContact entered)
				required
					"AddressIsRequiredForAlternateShipToAddress"

		TransactionCurrencyCode
			constraint (Vendor entered)
				"CannotEnterCurrencyCodeIfVendorIsNotEntered"
			if (HasVendorLocation)
				if (VendorLocationRel.InvoiceCurrency entered)
					constraint (VendorLocationRel.InvoiceCurrency = TransactionCurrencyCode)
						"EnteredCurrency:<TransactionCurrencyCode>MustBeVendor'sCurrency:<VendorLocationRel.InvoiceCurrency>"
			else
				if (Vendor.InvoiceCurrency entered)
					constraint (Vendor.InvoiceCurrency = TransactionCurrencyCode)
						"EnteredCurrency:<TransactionCurrencyCode>MustBeVendor'sCurrency:<Vendor.InvoiceCurrency>"

		RequestedDeliveryDate
			if (TransientRSSLPLRequisitionScreen entered
			and RequesterRel.RequireRequestedDeliveryDate)
				required
					"Field_Requested_Delivery_DateIsRequired"
			
			constraint (RequestedDeliveryDate >= current corporate date)
				"RequestedDeliveryDateCannotBeLessThanToday'sDate"

		SearchDateRange
			constraint (SearchDateRange.Begin <= SearchDateRange.End)
				"From_\DateCannotBeGreaterThan_\To_\Date"

		Printed
			initial value is true

		RequisitionSource
			default to RqSource.Requisition

		CreatedBy
			initial value is actor    
			default to actor

		CreationDate
			initial value is current timestamp
			default to current timestamp

		LastUpdateBy
			force default to actor

		LastUpdateDate
			force default to current timestamp

		CurrencyTable
			default to CompanySystemClosingControlRel.CurrencyTable
			default to GeneralLedgerCompanyRel.FinanceEnterpriseGroup.CurrencyTable

		POCode
			if (TransientRSSLPLRequisitionScreen entered
			and RequesterRel.RequirePOCode)
				required
					"Field_P\O_CodeIsRequired"
			
			if (PurchasingCompanyRel.ManualPOCodeAllowed.No	
			or PurchasingCompanyRel.ManualPOCodeAllowed.PurchaseOrdersOnly)
				cannot be entered
					"ManualEntryOfP\OCodeNotAllowed"
			else
				default to RequestingLocation.POCode

		CommodityCode
			constraint (CommodityCode.Active)
				"CommodityCodeIsInactive"

		DefaultCommentType
			initial value is Requester.DerivedDefaultCommentType
			default to Requester.DerivedDefaultCommentType


		TransientPatientID
			if (TransientVisitNumber exists)
				force default to TransientVisitNumber.Patient
		TransientPatientLastName
			if (TransientPatientID exists)
				force default to TransientPatientID.LastName
		TransientPatientFirstName
			if (TransientPatientID exists)
				force default to TransientPatientID.FirstName
		TransientPatientMiddleName
			if (TransientPatientID exists)
				force default to TransientPatientID.MiddleInitial
		TransientBirthdate
			if (TransientPatientID exists)
				force default to TransientPatientID.BirthDate
		TransientSocialSecurityNumber
			if (TransientPatientID exists)
				force default to TransientPatientID.FicaNbr

		DefaultBillCode
			if (action type.Create
			or (POCode changed))
				default to POCode.ConsignCode

		RequisitionStatusValue
			initial value is RequisitionStatusValue.Unreleased
			default to RequisitionStatusValue.Unreleased

			if (IsClosedStatus
			and not IsRejectedStatus)
				force default to RequisitionStatusValue.Closed

		PurchaseOrderBillToName
			default to FromLocationRel.PurchaseOrderBillToName
			default to PurchasingCompanyRel.PurchaseOrderBillToName

		PurchaseOrderBillToAddress
			default to FromLocationRel.PurchaseOrderBillToAddress
			default to PurchasingCompanyRel.PurchaseOrderBillToAddress

		PurchaseOrderBillToContact
			default to FromLocationRel.PurchaseOrderBillToContact
			default to PurchasingCompanyRel.PurchaseOrderBillToContact

		PurchaseOrderBillToPhoneNumber
			default to FromLocationRel.PurchaseOrderBillToPhoneNumber
			default to PurchasingCompanyRel.PurchaseOrderBillToPhoneNumber

		PurchaseOrderBillToEmailAddress
			default to FromLocationRel.PurchaseOrderBillToEmailAddress
			default to PurchasingCompanyRel.PurchaseOrderBillToEmailAddress

		Printer
			initial value is UserDefaultPrinterRel.IDMPrinter

		TransientTaxEntity
			force default to FromCompanyLocation.FromCompany.AccountingEntity
			
		TransientAllocationPriorityLevel
			if(action type.Update
			and TransientAllocationPriorityLevel changed)
				AllocationPriority = TransientAllocationPriorityLevel
		
		RequisitionDescription
			if (TransientRSSLPLRequisitionScreen entered
			and RequesterRel.RequireRequisitionDescription)
				required
					"Field_Requisition_DescriptionIsRequired"

		DeliverTo
			if (TransientRSSLPLRequisitionScreen entered
			and RequesterRel.RequireDeliverTo)
				required
					"Field_Deliver_ToIsRequired"

	Create Rules
   		include DefaultDropShipInfo		

		constraint (Requisition not entered)
			"RequisitionNumberWillBeAssigned"

	Create Exit Rules
		log untranslatable:"Company<Company>;Requisition<Requisition>;CreateDate<CreationDate>;RequisitionHeaderSource<this instance(locale of blank).RequisitionSource>."			
		if (DefaultCommentCode entered)
			include CopyStandardCommentCode
		if (DisplayOfProcedureInfo)
			include CheckPHIProcedureInformation


	Actions
		CreateAndSendRQDocToIDM is an Instance Action
			restricted
			Parameters
				IDMPrinter
			Local Fields
				IDMJobView	 		is an IDMJob view
				LocalColSequence    is Numeric size 3

			Action Rules
				initialize IDMGenerateDocument
				IDMGenerateDocument.IDMXMLDefinition.Busclass		= reference to this instance
				IDMGenerateDocument.IDMXMLDefinition.ListName		= "RequisitionListForIDM"
				IDMGenerateDocument.IDMXMLDefinition.DocumentName	= "Requisition"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].RelationName		= "RequisitionLinesRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListName			= "RequisitionLinesForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].LevelSection1	= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListTag			= "Lines"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ItemTag			= "Line"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].RelationName		= "LineAddOnChargesForIDMRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListName			= "LineAddOnChargesForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection1	= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection2	= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListTag			= "LineAddOnCharges"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ItemTag			= "LineAddOnCharge"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].RelationName		= "PrintOnRequisitionLineCommentsRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ListName			= "RequisitionLineCommentsForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].LevelSection1	= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].LevelSection2	= 2
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ListTag			= "LineComments"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ItemTag			= "LineComment"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].RelationName		= "RequisitionLineDistributionsRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ListName			= "RequisitionLineDistributionsForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].LevelSection1	= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].LevelSection2	= 3
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ListTag			= "LineDistributions"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ItemTag			= "LineDistribution"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].RelationName  = "RequisitionAddOnChargesRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ListName		 = "AddOnChargesForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].LevelSection1 = 2
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ListTag		 = "AddOnCharges"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ItemTag		 = "AddOnCharge"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].RelationName  = "RequisitionSpreadAOCRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ListName      = "RequisitionSpreadAddOnChargeForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].LevelSection1 = 3
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ListTag		 = "SpreadAddOnCharges"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ItemTag		 = "SpreadAddOnCharge"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].RelationName	 = "PrintOnRequisitionCommentsRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ListName 	 = "RequisitionCommentsForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].LevelSection1 = 4
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ListTag		 = "Comments"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ItemTag		 = "Comment"

				include SetIDMAttributes

				IDMGenerateDocument.IDMAttributes	 = IDMAttributes
				IDMGenerateDocument.TemplateUniqueId = Company.RequisitionTemplate.IDMUniqueId
				IDMGenerateDocument.DocumentType	 = "FSM_Requisition"
				IDMGenerateDocument.FileName		 = DerivedFileName + Company.RequisitionTemplate.DerivedOutputFormat
  				IDMGenerateDocument.IDMAccessControlList = "CSFDefined"

  				if (IDMPrinter entered)
  					IDMGenerateDocument.IDMPrinter	 = IDMPrinter 




				invoke CreateFromGenerateDocument IDMJob
					assign result to IDMJobView
					invoked.Actor				= actor
					invoked.Description			= "Requisition Issue"
					invoked.IDMGenerateDocument	= IDMGenerateDocument

  				IDMJob = IDMJobView.IDMJob

				invoke UpdateIDMUniqueID in background
					run after IDMJob.AsyncId

		UpdateIDMUniqueID is an Instance Action
			restricted
			Action Rules
				invoke FastUpdate
					invoked.IDMDocumentPID = IDMJob.MDSID

		UpdatePrinter is an Instance Action
			valid when (IsValidForUpdatePrinter)
			Parameters
				NewPrinter is a IDMPrinter

			Parameter Rules
				NewPrinter
					constraint (NewPrinter.Active)
						"SelectedPrinterMustBeActive"

			Action Rules
				invoke FastUpdate
					invoked.Printer = NewPrinter


		FastUpdate is an Update Action
			restricted
			bypass field rules


		UpdateIDMAttributes is an Instance Action
			run in background
			restricted
			Parameters
				PID									is an IDMPID
				AttrsSearch							is an IDMAttributeOccurs
   				Result								is Boolean

   			Local Fields
   				LocalColSequence               		is Numeric size 3

			Action Rules

				include SetIDMAttributes

				if (PID entered)
					IDMAttributes.PID = PID
					Result = IDMAttributes.ExecuteUpdateAttributeByPID
				else
					if (AttrsSearch entered)
						IDMAttributes.IDMDocumentType = "FSM_Requisition"
						IDMAttributes.AttributeSearch = AttrsSearch
						Result = IDMAttributes.ExecuteUpdateAttribute
				display "Result:_<Result>"

		CreateCapitated is a Create Action 
			valid when (RequesterOrBuyerCanCreateCapitated)
			default label is "CreateRequisitionForCapitatedProcedure"
			Field Rules
			
				PurchaseFromLocation
					default to SupplierSourceIdRel.VendorLocation
				
				RequestedDeliveryDate
					default to current date
				
				Vendor 
					required 

				TransientCommentTitle
				 	constraint(TransientAttachment.File entered)
						"AttachmentFileIsRequired"


			Action Rules
				DefaultProcedureInformation.DefaultRequester			= Requester.FirstLastName
				if (actor.agent(Employee).BuyerExists)
					Buyer = actor.agent(Employee).Employee	

				ForCapitatedProcedure 									= true
				if (Requester.SupplierRequisitionReviewer
				or  actor.agent(Employee).BuyerExists)
					SupplierCreated = 3
				else 
					SupplierCreated = 1

			Exit Rules
				if (TransientAttachment entered)
					invoke Create RequisitionComment
						fill in fields from this instance
						if (TransientCommentTitle !entered)
							TransientCommentTitle = "Supporting Document"
						invoked.CommentTitle = TransientCommentTitle
						invoked.Attachment   = TransientAttachment

		SupplierCreate is a Create Action
			valid when (IsASupplier)
			default label is "CreateRequisition"

			Field Rules
			
				Requester
					constraint (Requester.SupplierRequisitionReviewer)
						"CannotEnterThisReviewer;ReviewerIsNotAllowedToReviewSupplierRequsitions"	
				
				PurchaseFromLocation
					default to SupplierSourceIdRel.VendorLocation
				
				ProcurementTemplate
					force default to LocalProcurementTemplate
					if (ProcurementTemplate entered)
						constraint (ProcurementTemplateParticipantsForAVendorRel exists)
							"ProcurementTemplateNotAllowedForYourVendorNumber"	
						constraint (!ForCapitatedProcedure)
							"CannotUseTemplate;RequisitionIsForACapitatedProcedure"

				RequestedDeliveryDate
					default to current date
				
				TransientCommentTitle
				 	constraint(TransientAttachment.File entered)
						"AttachmentFileIsRequired"

			Action Rules
				
				if (RequestingLocation !entered)
					RequestingLocation = SupplierSourceIdRel.DefaultRequestingLocation
				if (Company !entered)
					Company = SupplierSourceIdRel.DefaultCompany
				FromCompanyLocation = RequestingLocation.FromCompanyLocation		
				Vendor 			= SupplierRel.Vendor
				DefaultProcedureInformation.DefaultRequester			= Requester.FirstLastName
				DefaultProcedureInformation.DefaultSalesRepresentative  = SupplierSourceIdRel.MainContact.FirstAndLastName
				OperatorID      = actor 
				SupplierCreated = 1
				
				if (Requester !entered)
					Requester = SupplierSourceIdRel.DefaultRequester
				if (RequestingLocation entered)
					constraint (RequestingLocation.HasFromCompanyAndLocation)
						"CannotEnterARequestingLocationThatDoesNotHaveAFromCompanyAndLocation" 
			Exit Rules
				if (TransientAttachment entered)
					invoke Create RequisitionComment
						fill in fields from this instance
						if (TransientCommentTitle !entered)
							TransientCommentTitle = "Supporting Document"
						invoked.CommentTitle = TransientCommentTitle
						invoked.Attachment   = TransientAttachment

		SupplierUpdate is an Update Action
			default label is "Update"
			valid when (CanUpdateForSupplier)

			Action Rules
				include DefaultDropShipInfo
				DefaultProcedureInformation.DefaultRequester			= Requester.FirstLastName
				DefaultProcedureInformation.DefaultSalesRepresentative = SupplierSourceIdRel.MainContact.FirstAndLastName

			Exit Rules
				if (TransientCopyAllLines)
					if (instance count of ProcurementTemplate.ValidProcurementTemplateLinesRel > 50)
						make transition to CreateInProgress
						RequisitionStatusValue = RequisitionStatusValue.CreateInProgress

						invoke CreateRequisitionLineFromTemplateLineSet ProcurementTemplateLine in background
							invoked.PrmProcurementGroup			= ProcurementTemplate.ProcurementGroup
							invoked.PrmProcurementTemplate		= ProcurementTemplate
							invoked.PrmInventoryCompany			= Company
							invoked.PrmRequisition				= Requisition
							invoked.PrmCopyAllLines 			= TransientCopyAllLines
					else
						invoke CreateRequisitionLineFromTemplateLineSet ProcurementTemplateLine in foreground
							invoked.PrmProcurementGroup			= ProcurementTemplate.ProcurementGroup
							invoked.PrmProcurementTemplate		= ProcurementTemplate
							invoked.PrmInventoryCompany			= Company
							invoked.PrmRequisition				= Requisition
							invoked.PrmCopyAllLines 			= TransientCopyAllLines
				if (DisplayOfProcedureInfo)
					include CheckPHIProcedureInformation
				if (Requester changed
				or  PHIProcedureInformationChanged
				or  DefaultProcedureInformation.DefaultProcedure changed
			    or  DefaultProcedureInformation.DefaultProcedureModifier changed
			    or  DefaultProcedureInformation.DefaultProcedureDate changed
			    or  DefaultProcedureInformation.DefaultPractitioner changed
			    or  DefaultProcedureInformation.DefaultNurseCoordinator changed
			    or  DefaultProcedureInformation.DefaultSupplierOrderNumber changed)
					for each RequisitionLinesRel
						invoke Update each.PatientProcedure 
							invoked.Procedure				= DefaultProcedureInformation.DefaultProcedure
							invoked.ProcedureModifier		= DefaultProcedureInformation.DefaultProcedureModifier
							invoked.ProcedureDate			= DefaultProcedureInformation.DefaultProcedureDate
							invoked.PhysicianName			= DefaultProcedureInformation.DefaultPractitioner
							invoked.NurseCoordinator		= DefaultProcedureInformation.DefaultNurseCoordinator
							invoked.OrderNumber				= DefaultProcedureInformation.DefaultSupplierOrderNumber
							invoked.Requestor				= DefaultProcedureInformation.DefaultRequester
							invoked.VisitNumber				= PatientProcedure.VisitNumber
							invoked.PatientID				= PatientProcedure.PatientID
							invoked.CaseNumber				= PatientProcedure.CaseNumber
							invoked.PatientLastName			= PatientProcedure.PatientLastName
							invoked.PatientFirstName		= PatientProcedure.PatientFirstName
							invoked.PatientMiddleName		= PatientProcedure.PatientMiddleName
							invoked.Birthdate				= PatientProcedure.Birthdate
							invoked.Gender					= PatientProcedure.Gender							

		SupplierDelete is a Delete Action
			default label is "Delete"
			valid when (CanUpdateForSupplier)

			Entrance Rules

				if (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
				or  RQGeneralLedgerSystemCodeRel.EncumbranceOption.Track)
					invoke Delete BudgetRebuildBTGTRel
					invoke Delete HeaderBudgetEditErrorRel
					invoke Delete DistributionBudgetEditErrorRel
					for each CommittedRequisitionLineDistributionRel
						invoke PurgeGLCommitment each
					invoke Delete BudgetTemplateGroupTotalRel
					invoke Delete BudgetEditBatchRel

				for each RequisitionLinesRel
					if (each.PatientProcedure entered)
						invoke DeletePatientProcedure RequisitionLinesRel

				if (PatientProcedureInfoExists)
					LocalDeleteHeader = true
					invoke DeletePatientProcedure

		SubmitForSupplier is an Instance Action
			valid when (CanSubmitForSupplier)
			default label is "Submit"
			Action Rules
				constraint (RequisitionLinesOpenRel exists)
					"MustHaveAtLeastOneLineItemToSubmit"
				if (HasLinesWithNoLotOrSerialSupplier)
					confirmation required 
						"ComponentLinesExistThatHaveNoLotOrSerialNumberEntered;DoYouWantToContinue?"
				if (ForCapitatedProcedure)
					if (HasNoProcedures)
						confirmation required 
							"CapitatedRequisitionHasNoProcedures;DoYouWantToContinue?"
				if (SupplierSourceIdRel.ContractItemsOnly = 2)
					if (HasLinesWithNoContractLine)
						confirmation required
							"AtLeastOneLineIsNotAssociatedWithAContract;DoYouWantToContinue?"
				if (HasLinesWithDuplicateSerial)
					confirmation required 
						"DuplicateSerialNumbersExistForLine<first LinesWithDuplicateSerialRel.RequisitionLine>;DoYouWantToContinue?"
				if (SupplierSourceIdRel.ContractItemsOnly = 1)
					constraint (AllLinesHaveContractLine)
						"CannotSubmit;AtLeastOneLineIsNotAssociatedWithAContract"
				if (SupplierSourceIdRel.AutoApprove = true
				and RequesterEntered)
					SupplierCreated = 3
				else
					SupplierCreated = 2
				if (Requester entered)
					send email
						to RequesterEmailAddress
						from SupplierSourceIdByActorRel.EmailAddress
						subject "SupplierRequisition<Requisition>HasBeenSubmitted"
						Contents
							"SupplierRequisition<Requisition>HasBeenSubmitted;ViewInSupplierRequisitions"				
		
		SubmitForSupplierOverride is an Instance Action 
			valid when (ReviewerCanSubmit)
			default label is "SubmitForSupplier"
			Action Rules 
				confirmation required
					"Warning;YouAreSubmittingThisRequisitionForTheSupplier.DoYouWantToContinue?"
				constraint (RequisitionLinesOpenRel exists)
					"MustHaveAtLeastOneLineItemToSubmit"
				if (SupplierSourceIdRel.AutoApprove = true
				and RequesterEntered)
					SupplierCreated = 3
				else
					SupplierCreated = 2
				send email
					to SupplierSourceIdByActorRel.EmailAddress
					from RequesterEmailAddress
					subject "YourRequisitionHasBeenSubmittedByTheReviewer"
					Contents
						"Requisition<Requisition>HasBeenSubmitted;ViewInMyRequisitions"				

		ApproveForSupplier is an Instance Action
			valid when (MineCanApproveSupplierCreated)
			default label is "Approve"
			Action Rules	

				SupplierCreated = 3

				if (RequesterNotEntered)
					Requester = actor.agent(Employee).Employee	

				send email
					to SupplierSourceIdByActorRel.EmailAddress
					from RequesterEmailAddress
					subject "YourRequisitionHasBeenApproved"
					Contents
						"Requisition<Requisition>HasBeenApproved;ViewInMyRequisitions"

		RejectForSupplier is an Instance Action
			valid when (MineCanApproveSupplierCreated)
			default label is "Reject"
			action comment required
			Action Rules
				SupplierCreated = 4
				Status          = 8

				if (RequesterNotEntered)
					Requester = actor.agent(Employee).Employee	

				send email
					to SupplierSourceIdByActorRel.EmailAddress
					from RequesterEmailAddress
					subject "YourRequisitionHasBeenRejected"
					Contents
						"Requisition<Requisition>HasBeenRejected;ViewInMyRequisitions"
						"Reason;<action comment>"

		ReturnForSupplier is an Instance Action
			valid when (MineCanApproveSupplierCreated)
			default label is "ReturnToSupplierForUpdates"
			action comment required
			Action Rules
				SupplierCreated = 1

				if (RequesterNotEntered)
					Requester = actor.agent(Employee).Employee	
				
				send email
					to SupplierSourceIdByActorRel.EmailAddress
					from RequesterEmailAddress
					subject "YourRequisitionHasBeenReturnedForUpdates"
					Contents
						"Requisition<Requisition>HasBeenReturnedForUpdates;ViewIn_My_Requisitions,Update,AndSubmit"
						"Comments:<action comment>"

		ChangeReviewer is an Instance Action
			valid when (CanChangeReviewer)
			default label is "ChangeReviewer/Requester"
			action comment required
			Parameters
				NewReviewer is a Requester
			Parameter Rules
				NewReviewer
					required
						"MustEnterANewReviewer"
					constraint (NewReviewer != Requester)
						"NewReviewerMustBeDifferentThanRequester"
					constraint (NewReviewer.SupplierRequisitionReviewer)
						"NewReviewerMustBeAllowedToReviewSupplierRequsitions"

			Action Rules
				Requester = NewReviewer
				send email
					to NewReviewer.Employee.EmployeeWorkEmailAddress
					from RequesterEmailAddress
					subject "YouHaveBeenAssignedASupplierRequisitionForReview"
					Contents
						"Requisition<Requisition>HasBeenAssignedToYouForReviewIn_Supplier_Requisitions"
						"Comments:<action comment>"


		SwapCapitatedCharges is an Instance Action 
			valid when (ReadyToSwapCapitatedComponents)
			Action Rules 
				invoke SupplierUpdate first CapitatedSelectForSwapNoChargeRel
					invoked.FromSwapFromNoCharge = true					
				invoke SupplierUpdate first CapitatedSelectForSwapChargedRel
					invoked.FromSwapToNoCharge = true



		CreateSupplierMessageAndDialog is an Instance Action  
			valid when (SupplierCanCreateDialog)
			Parameters
				ParmDialogMessage       is Alpha size 1000
					default label is "Message"
				ParmDialogAttachment	is an Attachment
					default label is "Attachment"
				ParmPriority            is Numeric 1
					States
						Low				value is 1
						Normal			value is 2
						High			value is 3
					default label is "Priority"
				ParmResponseRequested   is Boolean
					default label is "ResponseRequired"

			Parameter Rules
				ParmDialogMessage
					required

				ParmPriority
					initial value is 2

			Local Fields
				LocalSupplierContactMessage        is a SupplierContactMessage view

			Action Rules

				invoke Create SupplierContactMessage
					assign result to LocalSupplierContactMessage
					invoked.SupplierGroup  					= actor.agent(SupplierSourceId).SupplierGroup
 					invoked.Supplier    			 		= actor.agent(SupplierSourceId).Supplier
					invoked.SupplierSourceId                = actor.agent(SupplierSourceId).SupplierSourceId
					invoked.MessageTitle					= "Dialog for Requisition: " + Requisition
					invoked.MessageText                     = "User Created Message and Dialog for Requisition: " + Requisition
					invoked.Status							= 1
					invoked.Priority						= ParmPriority
					invoked.ReleaseStatus					= 2
					invoked.MessageOwner                    = Requester
					invoked.OriginatingCompany              = Company
					invoked.OriginatingRequisition          = Requisition

				invoke Create SupplierMessageDialog
					invoked.SupplierGroup  					= actor.agent(SupplierSourceId).SupplierGroup
 					invoked.Supplier    			 		= actor.agent(SupplierSourceId).Supplier
					invoked.SupplierSourceId                = actor.agent(SupplierSourceId).SupplierSourceId
					invoked.SupplierContactMessage 			= LocalSupplierContactMessage.SupplierContactMessage
					invoked.Message                 		= ParmDialogMessage
					invoked.MessageAttachment       		= ParmDialogAttachment
					invoked.ResponseRequested       		= ParmResponseRequested

		CreateMessageAndDialog is an Instance Action  
			default label is "StartASupplierDialog"
			valid when (CreatedBySupplier)
			Parameters
				ParmDialogMessage       is Alpha size 1000
					default label is "Message"
				ParmDialogAttachment	is an Attachment
					default label is "Attachment"
				ParmPriority            is Numeric 1
					States
						Low				value is 1
						Normal			value is 2
						High			value is 3
					default label is "Priority"
				ParmResponseRequested   is Boolean
					default label is "ResponseRequired"

			Parameter Rules
				ParmDialogMessage
					required

				ParmPriority
					initial value is 2

			Local Fields
				LocalSupplierContactMessage        is a SupplierContactMessage view

			Action Rules

				invoke Create SupplierContactMessage
					assign result to LocalSupplierContactMessage
					invoked.SupplierGroup  					= Company.ItemGroup					
 					invoked.Supplier    			 		= SupplierSourceIdByActorRel.Supplier
					invoked.SupplierSourceId                = SupplierSourceIdByActorRel.SupplierSourceId 
					invoked.MessageTitle					= "Dialog for Requisition: " + Requisition
					invoked.MessageText                     = "User Created Message and Dialog for Requisition: " + Requisition
					invoked.Status							= 1
					invoked.Priority						= ParmPriority
					invoked.ReleaseStatus					= 2
					invoked.MessageOwner                    = actor.agent(Employee).Employee
					invoked.OriginatingCompany              = Company
					invoked.OriginatingRequisition          = Requisition

				invoke Create SupplierMessageDialog
					invoked.SupplierGroup  					= Company.ItemGroup					
 					invoked.Supplier    			 		= SupplierSourceIdByActorRel.Supplier
					invoked.SupplierSourceId                = SupplierSourceIdByActorRel.SupplierSourceId 
					invoked.SupplierContactMessage 			= LocalSupplierContactMessage.SupplierContactMessage
					invoked.Message                 		= ParmDialogMessage
					invoked.MessageAttachment       		= ParmDialogAttachment
					invoked.ResponseRequested       		= ParmResponseRequested
					invoked.Origin                          = 1

		RebuildCommitmentTotals is an Instance Action
			restricted

			Action Rules

				invoke Purge  GLCommitDrillRel
					invoked.PrmPurgeRecalculate = true
				invoke Delete HeaderBudgetEditErrorRel
				invoke Delete DistributionBudgetEditErrorRel
				invoke Delete BudgetTemplateGroupTotalRel

				for each RequisitionLineDistributionRel
					invoke CreateCommitmentOnly each
						invoked.FromBudgetRebuild = true
				invoke EditTotalsRoute BudgetTemplateGroupTotal
					invoked.PrmFinanceEnterpriseGroup    											= Company.ItemGroup.FinanceEnterpriseGroup
					invoked.PrmBudgetEditGroup           											= UniqueID
					invoked.PrmBudgetEditCallBack.BudgetEditCallBackRequisition.InventoryCompany 	= Company
					invoked.PrmBudgetEditCallBack.BudgetEditCallBackRequisition.Requisition 		= Requisition
					invoked.PrmBusinessClassName                                                    = "Requisition"
					invoked.PrmEditContext                                                          = "Release"
					if (TransientFromMassRQCreateAndRelease
					or  BudgetEditBatchRel exists)
						invoked.PrmIsBatch                                                          = true

		DeletePatientProcedure is an Instance Action
			restricted
			Action Rules
				if (PatientProcedure entered)
					LocalPatientProcedure = PatientProcedure
					initialize PatientProcedure
				if (not LocalDeleteHeader)
					initialize DefaultProcedureInformation
				initialize LocalDeleteHeader
			Exit Rules
				if (LocalPatientProcedure entered)
					invoke Delete PatientProcedureRel

		IssueDraft is an Instance Action
			valid when (not IsProcessedOrRejected)
			Action Rules
				if (Company.UseIDM)
					constraint (Company.RequisitionTemplate entered)
						"CannotCreateDocument,NoTemplateDefinedForTheInventoryCompany"

					invoke CreateAndSendRQDocToIDM
				else
					invoke PrintRequisitions PrintRequisitions
						invoked.Company				= Company
						invoked.ReqLocation			= RequestingLocation
						invoked.ReqNumber			= Requisition

		IssueFinal is an Instance Action
			valid when (NotIDMAndIsProcessedOrRejected)
			Action Rules
				invoke PrintRequisitions PrintRequisitions
					invoked.Company				= Company
					invoked.ReqLocation			= RequestingLocation
					invoked.ReqNumber			= Requisition

		IssueFinalIDM is an Instance Action
			default label is "IssueFinal"
			valid when (IDMAndIsProcessedOrRejected)

			Action Rules
				invoke CreateAndSendRQDocToIDM
					invoked.IDMPrinter = Printer

		StartInterface is an Instance Action
			restricted
			Parameters
				PrmOriginatingInterfaceRun 	is like RequisitionInterfaceResult
			Entrance Rules
				constraint (IsUnreleased)
					"RequisitionIsNotUnreleased"
			Action Rules
				InterfaceInProcess 		= true
				OriginatingInterfaceRun = PrmOriginatingInterfaceRun

		FinishCreateFromTemplate is an Instance Action
			restricted
			Parameters
			Action Rules
				if (IsCreateInProgress)
					invoke CreateInProgress.TransitionToUnreleased
			Exit Rules
				invoke UpdateTotals

		FinishInterface is an Instance Action
			restricted
			Parameters
			Action Rules
				InterfaceInProcess = false
				LastRequisitionLine = last RequisitionLinesRel.RequisitionLine
			Exit Rules
				invoke UpdateTotals

		FinishAndReleaseInterface is an Instance Action
			restricted
			Parameters
			Local Fields
				TransactionError					is Boolean
				TransactionErrorMessage				is Alpha size up to 300
			Action Rules
				InterfaceInProcess = false
				LastRequisitionLine = last RequisitionLinesRel.RequisitionLine
			Exit Rules
				invoke UpdateTotals
				TransientFromMassRQCreateAndRelease = true
				invoke Unreleased.Release
					resume on error
						TransactionError		= true
						TransactionErrorMessage	= error message
				if(GeneralLedgerCompanyRel.FinanceEnterpriseGroup.FrontEndSplits
				and TransactionError
				and TransactionErrorMessage[1:5] = "RQFES")
					invoke Create RequisitionLineError
						fill in fields from this instance
						invoked.ErrorType 		= RequisitionLineError.ErrorType.FES
						invoked.ErrorMessage 	= TransactionErrorMessage

		UpdateFromInterface is an Instance Action
			restricted
			Parameters
				SetInterfaceInProcessFalse 	is Boolean
				ReleaseRequisition          is Boolean
				SetInterfaceInProcessTrue  	is Boolean
				PrmOriginatingInterfaceRun 	is like RequisitionInterfaceResult

			Action Rules
				if (SetInterfaceInProcessFalse = true)
					InterfaceInProcess = false
				if (SetInterfaceInProcessTrue = true)
					InterfaceInProcess = true
				if (PrmOriginatingInterfaceRun entered)
					OriginatingInterfaceRun = PrmOriginatingInterfaceRun


			Exit Rules
				if (SetInterfaceInProcessFalse = true)
					invoke UpdateTotals

				if (ReleaseRequisition = true)
					TransientFromMassRQCreateAndRelease = true
					if (IsUnreleased)
						invoke Unreleased.Release
							resume on error

		UpdateTotals is an Instance Action
			restricted
			refresh and lock this instance
			Action Rules
				initialize InventoryItemsTotal
				initialize NonstockItemsTotal
				initialize SpecialAndServiceItemsSTotal
				initialize ExtendedAmountTotal

				for each RequisitionLine set
					ExtendedAmountTotal	+= each.LineExtendedAmount
					if (each.ItemType.Inventoried)
						InventoryItemsTotal += each.ApprovalValue
					else
						if (each.ItemType.NonStock)
							NonstockItemsTotal += each.ApprovalValue
						else
							SpecialAndServiceItemsSTotal += each.ApprovalValue

					constraint (ApprovalValue < 10000000000000000.00)
						"MaximumTotalAmountExceeded"

			Exit Rules

				for each HeaderAddOnChargesByRateRel
					invoke Update each

		UpdateTotalsFromLine is an Instance Action
			refresh and lock this instance
			restricted
			Parameters
				PrmLineExtendedAmount						is an InternationalAmount
				PrmApprovalValue							is an InternationalAmount
				PrmItemType									is an ItemType
			Action Rules

				ExtendedAmountTotal					+= PrmLineExtendedAmount
				if (PrmItemType.Inventoried)
					InventoryItemsTotal 			+= PrmApprovalValue
				else
				if (PrmItemType.NonStock)
					NonstockItemsTotal 				+= PrmApprovalValue
				else
					SpecialAndServiceItemsSTotal 	+= PrmApprovalValue

				constraint (ApprovalValue < 10000000000000000.00)
					"MaximumTotalAmountExceeded"
			Exit Rules

				if (ExtendedAmountTotal changed)
					for each HeaderAddOnChargesByRateRel
						invoke Update each

		UpdateTotalsFromAOC is an Instance Action 
			restricted
			Parameters
				PrmLineAddOnChargeTotal			is an InternationalAmount
				PrmHeaderAddOnChargeTotal		is an InternationalAmount
			Action Rules
				LineAddOnChargeTotal	+= PrmLineAddOnChargeTotal
				AOCTotal				+= PrmLineAddOnChargeTotal
				HeaderAddOnChargeTotal	+= PrmHeaderAddOnChargeTotal
				AOCTotal				+= PrmHeaderAddOnChargeTotal

				constraint (ApprovalValue >= 0)
					"AllowanceAddOnChargeAmountCannotExceedRequisitionTotal"
				constraint (ApprovalValue < 10000000000000000.00)
					"MaximumTotalAmountExceeded"

		CreateFromReturnLine is a Create Action
			restricted
			bypass field rules

		Cancel is an Instance Action
			restricted
			Action Rules
				if (IsRejectedStatus)
					invoke Rejected.Close
				else
					if (Status.Processed)
						invoke Processed.Close

		UpdateBudgetResults is an Instance Action
			restricted
			Parameters
				ParmSuccess    is Boolean
			Action Rules
				if (ParmSuccess = true)
					BudgetEditProcessing = BudgetEditProcessing.Success 
					invoke FinalRelease
				else
					BudgetEditProcessing = BudgetEditProcessing.Failure 

		CancelTrialItems is an Instance Action
			restricted

			Action Rules

				if (Status.Unreleased)
					invoke Unreleased.Delete
				else
					for each RequisitionLine set
						invoke CancelTrialItems each

		UpdateDateAndTime is an Instance Action
			restricted
			refresh and lock this instance
			Parameters
				PrmLastDeliverySequence     is a RequisitionSequence
				PrmLastUpdateDate 			is TimeStamp
				PrmLastUpdateBy 			is an Actor

			Action Rules
				LastDeliverySequence = PrmLastDeliverySequence
				LastUpdateDate       = PrmLastUpdateDate
				LastUpdateBy         = PrmLastUpdateBy

		MobileRelease is an Instance Action 
			default label is "Release"
			restricted
			Action Rules
				invoke Release		

		RSSLPLRelease is an Instance Action
			completion message is "Requisition#_<Requisition>HasBeenSubmitted"
			valid when (IsForRelease)
			default label is "Submit"
			Entrance Rules
				
				if (RequesterRel.RequireRequisitionDescription)
					constraint(RequisitionDescription entered)
						"Field_Requisition_DescriptionIsRequired"
				
				if (RequesterRel.RequireRequestedDeliveryDate)
					constraint(RequestedDeliveryDate entered)
						"Field_Requested_Delivery_DateIsRequired"
				
				if (RequesterRel.RequireDeliverTo)
					constraint(DeliverTo entered)
						"Field_Delivery_ToIsRequired"
				
				if (RequesterRel.RequirePOCode)
					constraint(POCode entered)
						"Field_P\O_CodeIsRequired"
				
				if (RequesterRel.RequireVendor)
					constraint(Vendor entered)
						"Field_VendorIsRequired"
				
				if (RequesterRel.RequireBuyer)
					constraint(Buyer entered)
						"Field_BuyerIsRequired"
				
				confirmation required
					"Requisition#_<Requisition>WillBeSubmitted.DoYouWantToContinue?"
			Action Rules
				invoke Release

		Release is an Instance Action
			completion message is "<ReleaseMessage>"
			valid when (IsForRelease)

			Local Fields
				LocalTotalAmountPerContract			is an UnsignedInternationalAmount
				LocalTotalAmountPerContractLine		is an UnsignedInternationalAmount
				LocalTotalQuantityPerContractLine	is a Quantity
				LocalTotalQuantityPerLocation		is a Quantity
				LocalItem							is an Item
				LocalFromCompany					is a Company
				LocalItemLocation					is an InventoryLocation
				TransactionError					is Boolean
				TransactionErrorMessage				is Alpha 300
				FESFundingSourceTable
				FESCounter							is Numeric 4

			Action Rules
				constraint (RequisitionLinesUnreleasedRel exists)
					"NoRequisitionLinesAreAvailableToBeReleased"
				constraint (RequestingLocation.Active)
					"RequestingLocationIsInactive"
				if (RequestingLocation.ProcessLevel entered)
					constraint (RequestingLocation.ProcessLevel.Active)
						"ProcessLevel<RequestingLocation.ProcessLevel>IsInactive"
				if (ForCapitatedProcedure)
					if (HasLinesWithDuplicateSerial)
						confirmation required 
							"DuplicateSerialNumbersExistForLine<first LinesWithDuplicateSerialRel.RequisitionLine>;DoYouWantToContinue?"				
				constraint (FromCompanyLocation.FromLocation.IsActive)
					"DeliverFromLocationIsInactive"
				constraint (Status.Unreleased
				or 			Status.InProcess)
					"RequisitionHasAlreadyBeenReleased"

				constraint (Requester entered)
					"MustEnterARequesterBeforeReleasingTheRequisition"
				if (RequisitionApprovalType.HeaderMatrixApproval)
					constraint (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.EnableResponsibilityMatrix)
						"CannotUse_Responsibility_MatrixApprovalsWhenThe_Finance_Enterprise_GroupDoesNotHaveThe_Responsibility_MatrixTurnedOn._PleaseContactYourSystemAdministratorForFurtherAssistance."
				if (HasLinesWithNoLotOrSerial)
					confirmation required 
						"ComponentLinesExistThatHaveNoLotOrSerialNumberEntered;DoYouWantToContinue?"
				if (PurchaseTaxable and PurchaseTaxCode entered
				and not TaxEntityRel.ThirdParty.VertexOSeries
				and not TaxEntityRel.ThirdParty.Sabrix) 
					initialize CalculateTax
					CalculateTax.TaxEntity                      = FromCompanyLocation.FromCompany.AccountingEntity
					CalculateTax.TaxCode                        = PurchaseTaxCode
					CalculateTax.Function                       = CalculateTax.Function.Inquire
					TaxOut                                      = CalculateTax.ExecuteCalculateTax
					constraint (CalculateTax.OutputErrorNumber not entered)
						"<CalculateTax.OutputErrorMessage>"


				if (VendorEditRequisitionLineRel exists)
					include ReleaseLimitsValidation

				constraint (RequisitionReleaseMessages not entered)
					"<DerivedRequisitionReleaseMessages>"

				if (RequisitionAddOnChargesRel exists)
					constraint (RequisitionLinesToPurchaseOrderRel exists)
						"CannotRelease;HasMiscellaneousAddOnCharge,MustHaveRequisitionLinesGoingToPurchaseOrder"
					constraint (OneSourceDocumentToOnePO.Yes) 
						"SingleDocumentToAPurchaseOrderMustBeYesIfRequisitionHasMiscellaneousAddOnCharge"

				for each RequisitionLineByContract
					if (LocalContract 		not = each.Contract)
						LocalContract 		= each.Contract
						initialize LocalTotalAmountPerContract
						initialize LocalContractLine
					
					if (LocalContractLine 	not = each.ContractLine)
						LocalContractLine	= each.ContractLine
						initialize LocalTotalAmountPerContractLine
						initialize LocalTotalQuantityPerContractLine

					if (each.Contract.MaximumAmount > 0)
						LocalTotalAmountPerContract		+= each.DerivedCostInContractCurrency
						constraint (LocalTotalAmountPerContract <= each.Contract.AmountRemaining)
							"RequisitionAmountExceedsMaximumAmountRemainingForContract<each.Contract>"

					if (each.ContractLine.LifetimeMaximumAmount > 0)
						LocalTotalAmountPerContractLine			+= each.DerivedCostInContractCurrency
						constraint (LocalTotalAmountPerContractLine + each.ContractLine.MaximumLineAmountInUse <= each.ContractLine.LifetimeMaximumAmount)
							"RequisitionAmountExceedsLifetimeMaximumRemainingOnContract<each.Contract>ContractLine<each.ContractLine>"

					if (each.ContractLine.LifetimeMaximumQuantity > 0)
						LocalTotalQuantityPerContractLine		+= each.DerivedQuantityInContractUOM
						constraint (LocalTotalQuantityPerContractLine + each.ContractLine.QuantityOrdered <= each.ContractLine.LifetimeMaximumQuantity)
							"RequisitionQuantityExceedsLifetimeMaximumRemainingOnContract<each.Contract>ContractLine<each.ContractLine>"






















				if (TaxEntityRel.ThirdParty.Sabrix
				and TaxEntityRel.DelayTaxProcessing)
					for each RequisitionAddOnChargesRel
						invoke CalculateOneSourceLandedUnitCost each

				for each RequisitionLinesUnreleasedRel
					invoke Unreleased.EditRelease each

					if(FESEnabled)
						invoke Unreleased.FrontEndSplitDistributions each
							resume on error
								TransactionError		= true
								TransactionErrorMessage	= error message
						constraint(not TransactionError)
							"RQFES:\Front_\End_\Split<TransactionErrorMessage>"

				if (FESEnabled
				and GeneralLedgerCompanyRel.FinanceEnterpriseGroup.UseFundedAmounts)
					for each RequisitionLineDistribution set
						if (each.DistributionAccount.Project entered
						and each.DistributionAccount.FinanceDimension2 entered
						and each.ProjectFundingSourceRel exists
						and each.UncommittedProjectAmount entered)
							FESCounter = 1
							while (FESCounter < 1000)
								if (FESFundingSourceTable.FESFundingSource[FESCounter] not entered)
									FESFundingSourceTable.FESFundingSource[FESCounter].ProjectContract   = each.ProjectFundingSourceRel.ProjectContract
									FESFundingSourceTable.FESFundingSource[FESCounter].FinanceDimension2 = each.ProjectFundingSourceRel.FinanceDimension2
									FESFundingSourceTable.FESFundingSource[FESCounter].RemainingAmount	 = each.ProjectFundingSourceRel.RemainingFESAmount - each.UncommittedProjectAmount
									FESCounter = 1000
								else
								if (FESFundingSourceTable.FESFundingSource[FESCounter].ProjectContract   = each.ProjectFundingSourceRel.ProjectContract
								and	FESFundingSourceTable.FESFundingSource[FESCounter].FinanceDimension2 = each.ProjectFundingSourceRel.FinanceDimension2)
									FESFundingSourceTable.FESFundingSource[FESCounter].RemainingAmount  -= each.UncommittedProjectAmount
									FESCounter = 1000
								else
									FESCounter += 1
					FESCounter = 1
					while (FESCounter < 1000)
						if (FESFundingSourceTable.FESFundingSource[FESCounter] not entered)
							FESCounter = 1000
						else
							constraint (FESFundingSourceTable.FESFundingSource[FESCounter].RemainingAmount >= 0)
								"RQFES:\Front_\End_\SplitAmountExceedsRemainingFundedAmountFor<FESFundingSourceTable.FESFundingSource[FESCounter].FinanceDimension2>"
						FESCounter += 1

				if (RequisitionApprovalType.HeaderMatrixApproval)
					if ((DefaultDistributionAccount.Project entered
					and  DefaultEntityRel.FunctionalCurrency != BaseCurrencyCode)
					or  (DefaultDistributionAccount.Project not entered
					and  IssueAccountEntityRel.FunctionalCurrency != BaseCurrencyCode))
						LocalReportCurrencyExchangeGroup.CurrencyTable			    = CurrencyTable
						LocalReportCurrencyExchangeGroup.FinanceEnterpriseGroup	    = Company.ItemGroup.FinanceEnterpriseGroup
						if (DefaultDistributionAccount.Project entered)
							LocalReportCurrencyExchangeGroup.BaseAmount.ToCurrency	= DefaultEntityRel.FunctionalCurrency
						else
							LocalReportCurrencyExchangeGroup.BaseAmount.ToCurrency  = IssueAccountEntityRel.FunctionalCurrency
						LocalReportCurrencyExchangeGroup.ExchangeDate			  	= CreationDate date
						LocalReportCurrencyExchangeGroup.TransactionAmount		  	= ApprovalValue
						LocalReportCurrencyExchangeGroup.FromCurrency			  	= BaseCurrencyCode
						LocalFunctionalAmount									  	= LocalReportCurrencyExchangeGroup.BaseAmount.OutputCurrencyAmount
					else
						LocalFunctionalAmount									  	= ApprovalValue
					invoke SubmitForMatrixApproval first ResponsibilityMatrixRel
						invoked.PrmFinanceEnterpriseGroup 		= Company.ItemGroup.FinanceEnterpriseGroup
						invoked.PrmApprovalType					= blank
						invoked.PrmSystemCode					= "RQ"
						invoked.PrmApprovalTransactionForm		= ApprovalTransactionForm.Requisition
						invoked.PrmTransactionHeader1			= Company
						invoked.PrmTransactionHeader2			= RequestingLocation
						invoked.PrmTransactionHeader3			= blank
						invoked.PrmTransactionHeader4			= blank
						invoked.PrmTransactionLine1				= blank
						invoked.PrmTransactionLine2				= blank
						invoked.PrmTransaction					= Requisition
						if (DefaultDistributionAccount.Project entered)
							invoked.PrmFinanceCodeBlock			= DefaultDistributionAccount
						else
							invoked.PrmFinanceCodeBlock			= RequestingLocation.IssueAccount
						invoked.PrmApprovalTitle				= DerivedApprovalTitle
						invoked.PrmApprovalAmount				= LocalFunctionalAmount
						invoked.PrmValidateOnly					= true
						invoked.PrmValidateFrom					= 1 


				invoke Delete RequisitionLineErrorsRel

				if (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
				and CommitmentsExist)
	 				if (TransientFromMassRQCreateAndRelease = false)
		 				if (HeaderBudgetErrorsExist)
							invoke Delete HeaderBudgetEditErrorRel
						if (DistributionBudgetErrorsExist)
							for each CommittedRequisitionLineDistributionRel
								invoke DeleteBudgetErrors each
	 				BudgetEditProcessing = BudgetEditProcessing.InProcess
					invoke EditTotalsRoute BudgetTemplateGroupTotal
						invoked.PrmFinanceEnterpriseGroup    											= Company.ItemGroup.FinanceEnterpriseGroup
						invoked.PrmBudgetEditGroup           											= UniqueID
						invoked.PrmBudgetEditCallBack.BudgetEditCallBackRequisition.InventoryCompany 	= Company
						invoked.PrmBudgetEditCallBack.BudgetEditCallBackRequisition.Requisition 		= Requisition
						invoked.PrmBusinessClassName                                                    = "Requisition"
						invoked.PrmEditContext                                                          = "Release"
						if (TransientFromMassRQCreateAndRelease)
							invoked.PrmIsBatch                                                          = true
				else
				if (RQGeneralLedgerSystemCodeRel.EncumbranceOption.Track)
					invoke EditTotalsRoute BudgetTemplateGroupTotal
						invoked.PrmFinanceEnterpriseGroup    											= Company.ItemGroup.FinanceEnterpriseGroup
						invoked.PrmBudgetEditGroup           											= UniqueID
						invoked.PrmMode																	= BudgetEditMode.UpdateOnly
						invoked.PrmBusinessClassName                									= "Requisition"
						invoked.PrmEditContext                      									= "Release"
					invoke FinalRelease
				else
					invoke FinalRelease

				if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.IDMConfiguration.UpdateRequisitionAttributes)
					invoke UpdateIDMAttributes


						invoked.AttrsSearch.IDMAttribute[1].IDMAttributeName	= "Company"
						invoked.AttrsSearch.IDMAttribute[1].IDMAttributeValue 	= Company
						invoked.AttrsSearch.IDMAttribute[2].IDMAttributeName  	= "Requisition"
						invoked.AttrsSearch.IDMAttribute[2].IDMAttributeValue  	= Requisition

		FinalRelease is an Instance Action
			restricted
			Local Fields
				LocalIsForSupply			is Boolean
			Action Rules

				ReleasedDate                = current timestamp
				ReleasingOperatorID         = actor

				if (instance count of RequisitionLinesUnreleasedRel > DerivedForegroundLimit 
				or SingleCallToOneSource)
					make transition to ReleaseInProgress
					RequisitionStatusValue = RequisitionStatusValue.ReleaseInProgress
				else
					make transition to Released
					RequisitionStatusValue = RequisitionStatusValue.Released

			Exit Rules

				if (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
				or  RQGeneralLedgerSystemCodeRel.EncumbranceOption.Track)

					if (!HasLinesToKill)
						invoke UpdateToReleased GLCommit
							invoked.PrmFinanceEnterpriseGroup           = Company.ItemGroup.FinanceEnterpriseGroup
							invoked.PrmUniqueID                         = UniqueID
							invoked.PrmAccountingEntity                 = Company.AccountingEntity

				if (LinesForWarehouseProcessingRel exists)

					if (DemandWarehouseDemandRel not exists)
						include CreateWarehouseDemandHeader


					if (RequestingLocation.InventoryTransactionType.DirectTransfer
					or  RequestingLocation.InventoryTransactionType.IntransitTransfer)
						if (SupplyWarehouseDemandRel not exists)
							LocalIsForSupply = true
							include CreateWarehouseDemandHeader

				if (IsReleaseInProgress)
					invoke BatchReleaseLines RequisitionLine	in background
						invoked.PrmCompany		= Company
						invoked.PrmRequisition	= Requisition
				else
					invoke BatchReleaseLines RequisitionLine	in foreground
						invoked.PrmCompany		= Company
						invoked.PrmRequisition	= Requisition

				if (ScheduledProcedureRel exists)
					for each ScheduledProcedureRel
						invoke FastUpdate each
							initialize invoked.ErrorType
							initialize invoked.ErrorMessage

		FinalReleaseCompletion is an Instance Action
			restricted
			Action Rules
				if (IsReleaseInProgress)
					make transition to Released
					RequisitionStatusValue = RequisitionStatusValue.Released

				if (RequisitionApprovalType.HeaderApproval
				and !Approved)
					initiate RequisitionApproval process
						title is "Requisition<Requisition>_from<Requester.Employee.Name.PreferredFirstAndLastName>_in_amount_of<DerivedRequsitionAmountCurrency>"	//"ApprovalForCompany<Company>,Requisition<Requisition>"
						Criteria
							Company
							RequestingLocation
						category filter is RequestingLocation
						Variables
							Company
							Company.Name
								variable name is CompanyName
							Requisition
							ApprovalValue
							Requester
							Status
						URLs
							"<linkback(webapp is Approver navigation is PFIViewRequisition text is \"ViewRequisition\")>"

					trigger "RequisitionApprovalService" PA service 
						resume on error
						title is "CO:<Company>ApprovalPendingRequisition:<Requisition>"
						Criteria
							Company
							RequestingLocation
						category filter is RequestingLocation
						Variables
							Company
								variable name is Company
							Company.Name
								variable name is CompanyName
							Requisition
								variable name is Requisition
							ApprovalValue
								variable name is ApprovalValue
							Requester
								variable name is Requester
							Status
								variable name is Status
				else
				if (RequisitionApprovalType.HeaderMatrixApproval
				and !Approved)
					if ((DefaultDistributionAccount.Project entered
					and  DefaultEntityRel.FunctionalCurrency != BaseCurrencyCode)
					or  (DefaultDistributionAccount.Project not entered
					and  IssueAccountEntityRel.FunctionalCurrency != BaseCurrencyCode))
						LocalReportCurrencyExchangeGroup.CurrencyTable			    = CurrencyTable
						LocalReportCurrencyExchangeGroup.FinanceEnterpriseGroup	    = Company.ItemGroup.FinanceEnterpriseGroup
						if (DefaultDistributionAccount.Project entered)
							LocalReportCurrencyExchangeGroup.BaseAmount.ToCurrency	= DefaultEntityRel.FunctionalCurrency
						else
							LocalReportCurrencyExchangeGroup.BaseAmount.ToCurrency  = IssueAccountEntityRel.FunctionalCurrency
						LocalReportCurrencyExchangeGroup.ExchangeDate			  	= CreationDate date
						LocalReportCurrencyExchangeGroup.TransactionAmount		  	= ApprovalValue
						LocalReportCurrencyExchangeGroup.FromCurrency			  	= BaseCurrencyCode
						LocalFunctionalAmount									  	= LocalReportCurrencyExchangeGroup.BaseAmount.OutputCurrencyAmount
					else
						LocalFunctionalAmount									  	= ApprovalValue
					invoke SubmitForMatrixApproval first ResponsibilityMatrixRel
						invoked.PrmFinanceEnterpriseGroup 		= Company.ItemGroup.FinanceEnterpriseGroup
						invoked.PrmApprovalType					= blank
						invoked.PrmSystemCode					= "RQ"
						invoked.PrmApprovalTransactionForm		= ApprovalTransactionForm.Requisition
						invoked.PrmTransactionHeader1			= Company
						invoked.PrmTransactionHeader2			= RequestingLocation
						invoked.PrmTransactionHeader3			= blank
						invoked.PrmTransactionHeader4			= blank
						invoked.PrmTransactionLine1				= blank
						invoked.PrmTransactionLine2				= blank
						invoked.PrmTransaction					= Requisition
						if (DefaultDistributionAccount.Project entered)
							invoked.PrmFinanceCodeBlock			= DefaultDistributionAccount
						else
							invoked.PrmFinanceCodeBlock			= RequestingLocation.IssueAccount
						invoked.PrmApprovalTitle				= DerivedApprovalTitle
						invoked.PrmApprovalAmount				= LocalFunctionalAmount
						invoked.PrmValidateOnly					= false

					if (ResponsibilityMatrixApprovalProcessorRel.Status.ApprovalNotRequired)
						invoke Released.Process
				else
					invoke Released.Process

				if (PatientProcedureInfoExists)
					LocalDeleteHeader = true
					invoke DeletePatientProcedure
				include ClearCurrentRequisitionForRQC

				LocalFinanceEnterpriseGroup = Company.ItemGroup.FinanceEnterpriseGroup
				LocalAccountingEntity      =  Company.AccountingEntity

				if (Company.ItemGroup.FinanceEnterpriseGroup.BODTrigger)
						if (action != "UpdateBODIdFields") 
							LocalActionCode = LocalActionCode.Create
							increment bod id.VariationID
							trigger "RequisitionService" PA service
								resume on error
								title is "EG:<LocalFinanceEnterpriseGroup>CO:<Company>RQ:<Requisition>"
								Criteria
									LocalFinanceEnterpriseGroup
									Company

								Variables
									LocalActionCode
										variable name is ActionCode
									include persistent fields from Requisition
									bod id.VariationID
										variable name is BODVariationId
									LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
										variable name is CurrentTimeStamp
									LocalAccountingEntity
										variable name is AccountingEntity
									Company
										variable name is Company
									ApprovalValue
										variable name is ApprovalValue






			Exit Rules

                if (ContractLinesExist)
                    for each LinesForAContractLineRel
                        LocalContract          = each.Contract
                        LocalRequisitionLine   = each.RequisitionLine
                        if (LaterPOLineForAContractRel !exists
                        and LocalContractRel.UseCommitments)
                            invoke FinishUpdateContractAmounts LocalContractRel


		TriggerRequisitionNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "Requisition"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "Requisition"
					invoked.PrmFinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					invoked.PrmAccountingEntity 		= Company.AccountingEntity
					invoked.PrmCompany 					= Company
					invoked.PrmMainUserTemplate 		= "IONRequisitionXML_ST"
				NativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger
				if (Company.ItemGroup.FinanceEnterpriseGroup.BODTrigger and NativeLPLBODTrigger)
					if(FSMInboundBODTracker not entered)
						invoke Create FSMInboundBODTracker
							assign result to NewBODTracker
							invoked.Verb 					= 1
							invoked.Noun 					= "Requisition"					
							invoked.BODDocumentID			= BODDocumentID
							invoked.BODVariationID			= DerivedBODVariationID
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.FinanceEnterpriseGroup	= DerivedBODFEG
							invoked.Direction				= 1
							invoked.Reference1				= DerivedBODRequisition
							invoked.BODAccountingEntity		= DerivedBODAccountingEntity
							invoked.Reference2				= DerivedBODCompany
							initialize invoked.Error			
							initialize invoked.ErrorMessage					
						LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker	
					else 
						LocalFSMInboundBODTracker		= FSMInboundBODTracker	
						invoke Update FSMInboundBODTrackerRel
							invoked.FinanceEnterpriseGroup	= DerivedBODFEG
							invoked.BODDocumentID			= BODDocumentID
							invoked.BODVariationID			= DerivedBODVariationID
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.Direction				= 1
							invoked.Reference1				= DerivedBODRequisition
							invoked.BODAccountingEntity		= DerivedBODAccountingEntity
							invoked.Reference2				= DerivedBODCompany
							initialize invoked.Error			
							initialize invoked.ErrorMessage
					invoke SendRequisitionBODNativeLPL
						resume on error
							Error            							= true
							ErrorMessage     							= error message
					if(Error)
						invoke Update FSMInboundBODTrackerRel
							invoked.Error 								= Error
							invoked.ErrorMessage 						= ErrorMessage
							invoked.Status								= 2
							invoked.BODID								= BODFormattedId
							invoked.CloseDate							= system current timestamp
							invoked.BODXML								= RequisitionXMLBOD
					else
						invoke Update FSMInboundBODTrackerRel
							invoked.Status									= 3
							invoked.BODID									= BODFormattedId
							invoked.CloseDate								= system current timestamp
							invoked.BODXML									= RequisitionXMLBOD
		
		SendRequisitionBODNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Action Rules
				send ion bod
					bod is RequisitionXMLBOD
					bod type is "Sync.Requisition"
					accounting entity is DerivedBODAccountingEntity
					document id is BODDocumentID
					variation id is DerivedBODVariationID
					location is RequestingLocation
				LocalBODTrigger = true


		CloseRequisition is an Instance Action
			restricted
			Action Rules
				NumberOfClosedLines += 1
				if (NumberOfClosedLines = NumberOfLines)
					Closed = true

				if (BudgetEditingInformationExists)
					invoke EditTotalsRoute BudgetTemplateGroupTotal
						invoked.PrmFinanceEnterpriseGroup	= Company.ItemGroup.FinanceEnterpriseGroup
						invoked.PrmBudgetEditGroup			= UniqueID
						invoked.PrmMode						= BudgetEditMode.UpdateOnly
						invoked.PrmBusinessClassName		= "Requisition"
						invoked.PrmEditContext				= "Close"

		CreateTemplateFromRequisition is an Instance Action
			restricted
			Parameters
				PrmProcurementTemplate	is like ProcurementTemplate
				PrmDescription			is a Description
			Parameter Rules
				PrmProcurementTemplate
					required
				PrmDescription
					required
			Action Rules
				invoke Create ProcurementTemplate
					invoked.ProcurementGroup	= PurchasingCompanyRel.ProcurementGroup
					invoked.ProcurementTemplate	= PrmProcurementTemplate
					invoked.Description			= PrmDescription

				invoke Create ProcurementTemplateParticipant
					invoked.ProcurementGroup	= PurchasingCompanyRel.ProcurementGroup
					invoked.ProcurementTemplate	= PrmProcurementTemplate
					invoked.Requester			= Requester

				for each RequisitionLine set
					invoke CreateTemplateLine each
						invoked.PrmProcurementTemplate = PrmProcurementTemplate

		UpdateRequisitionCubes is a Set Action
			restricted
			Parameters
				UpdateRequisition					is Boolean
				UpdateRequisitionLine				is Boolean
				UpdateRequisitionLineDistribution	is Boolean
			Parameter Rules
				UpdateRequisition
					initial value is true
					if (!UpdateRequisitionLineDistribution
					and !UpdateRequisitionLine)
						constraint (UpdateRequisition)
							"MustSelectAtLeastOneOfRequisition,RequisitionLine,OrRequisitionLineDistribution"
					constraint (BasicAnalyticsCalendarsRel exists)
						"YouMustCreateABasicAnalyticsCalendarToUpdateRequisitionCubes"
				UpdateRequisitionLine
					initial value is true
					if (!UpdateRequisitionLineDistribution
					and !UpdateRequisition)
						constraint (UpdateRequisitionLine)
							"MustSelectAtLeastOneOfRequisition,RequisitionLine,OrRequisitionLineDistribution"
				UpdateRequisitionLineDistribution
					initial value is true
					if (!UpdateRequisitionLine
					and !UpdateRequisition)
						constraint (UpdateRequisitionLineDistribution)
							"MustSelectAtLeastOneOfRequisition,RequisitionLine,OrRequisitionLineDistribution"

			Action Rules
				Set Rules

					Exit Rules
						if (UpdateRequisition)
							invoke Refresh RequisitionAnalyticCubeRel in background

						if (UpdateRequisitionLine)
							invoke Refresh RequisitionLineAnalyticCubeRel in background

						if (UpdateRequisitionLineDistribution)
							invoke Refresh RequisitionLineDistributionAnalyticCubeRel in background


		UpdateFromAddOnCharge is an Instance Action
			restricted
			Action Rules
				OneSourceDocumentToOnePO = OneSourceDocumentToOnePO.Yes

		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmAccountingEntity  is Alpha size 22
					default label is "AccountingEntity"
				PrmLocation          is Alpha size 22
					default label is "Location"
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmRevision          is Alpha size 22
					default label is "Revision"
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"
				PrmVariationID       is Alpha size 22
					default label is "VariationID"
			Action Rules
				if (bod id.AccountingEntity != PrmAccountingEntity)
					bod id.AccountingEntity 	= PrmAccountingEntity
				if (bod id.Location != PrmLocation)
					bod id.Location				= PrmLocation
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.Revision != PrmRevision)
					bod id.Revision				= PrmRevision
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord
				if (bod id.VariationID != PrmVariationID)
					bod id.VariationID			= PrmVariationID


		CreateUsingCopyFromRequisitionBatch is a Set Action
			run in background
			completion message is "CreateUsingCopyFromRequisitionSubmitted"
			disable resume on error
			restricted
			Local Fields
				LocalFromLocationChanged		is Boolean
				LocalCompletionMessage			is Text
				NewRequisitionView   			is a Requisition view
			Parameters
				PrmCompany						is an InventoryCompany
				PrmCopyFromRequisition          is a Requisition
				PrmRequester			   		is a Requester
				PrmRequestingLocation  			is a RequestingLocation
				PrmFromCompanyLocation 			is a FromCompanyLocation
				PrmRequestedDeliveryDate 		is Date
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a PurchaseFromLocation
				PrmRequisitionSource			is a RqSource
				PrmRequisitionDescription		is Alpha size 30
				PrmDeliverTo					is a DeliverTo
				PrmPriority						is like AllocationPriority
				PrmBuyer						is a Buyer
				PrmCommodityCode				is a CommCodes
				PrmTaxCode						is a TaxCode
				PrmPurchaseTaxable				is Boolean
				PrmPoCode						is a POCode
			Parameter Rules
				PrmCompany
					required
				PrmCopyFromRequisition
					required
					constraint (PrmCopyFromRequisition exists)
						"CopyFromRequisition<PrmCopyFromRequisition>DoesNotExist"
				PrmRequester
					initial value is PrmCopyFromRequisition.Requester
					force default to PrmCopyFromRequisition.Requester
				PrmRequestingLocation
					initial value is PrmCopyFromRequisition.RequestingLocation
					default to PrmCopyFromRequisition.RequestingLocation
				PrmFromCompanyLocation
					initial value is PrmCopyFromRequisition.FromCompanyLocation
					if (PrmFromCompanyLocation != PrmCopyFromRequisition.FromCompanyLocation)
						LocalFromLocationChanged = true
					default to PrmCopyFromRequisition.FromCompanyLocation
				PrmRequestedDeliveryDate
					if(PrmCopyFromRequisition.RequestedDeliveryDate >= current corporate date)
						default to PrmCopyFromRequisition.RequestedDeliveryDate


				PrmRequisitionSource
					default to RqSource.Requisition

			Instance Selection
				where (Company = PrmCompany and Requisition = PrmCopyFromRequisition)
			Action Rules
				Instance Rules
					invoke Create Requisition
						assign result to NewRequisitionView
						fill in fields from PrmCopyFromRequisition
							except invoked.Requisition
							except invoked.CreationDate
							except invoked.ReferenceNumber
							except invoked.LastRequisitionLine
							except invoked.LastDeliverySequence
							except invoked.ReturnSequence
							except invoked.Status
							except invoked.LastApprovalDate
							except invoked.Approved
							except invoked.AttainedLevel
							except invoked.ApprovalLevel
							except invoked.NumberOfLines
							except invoked.NumberOfClosedLines
							except invoked.Closed
							except invoked.InventoryItemsTotal
							except invoked.NonstockItemsTotal
							except invoked.SpecialAndServiceItemsSTotal
							except invoked.HeaderAddOnChargeTotal
							except invoked.LineAddOnChargeTotal
							except invoked.AOCTotal
							except invoked.ExtendedAmountTotal
							except invoked.Printed
							except invoked.ReturnNote
							except invoked.ReturnDate
							except invoked.OperatorID
							except invoked.CapitalTotal
							except invoked.TechnicalTotal
							except invoked.CapitalTechnicalTotal
							except invoked.ProcessFlowApprovalLevel
							except invoked.ReleasedDate
							except invoked.ReleasingOperatorID
							except invoked.ApprovedRejectedDate
							except invoked.ApprovingRejectingOperatorID
							except invoked.CreatedBy
							except invoked.LastUpdateDate
							except invoked.LastUpdateBy
							except invoked.BudgetEditProcessing
							except invoked.RequisitionApprovalType
							except invoked.PatientProcedure
							except invoked.TransientVisitNumber
							except invoked.TransientPatientID
							except invoked.TransientCaseNumber
							except invoked.TransientPatientLastName
							except invoked.TransientPatientFirstName
							except invoked.TransientPatientMiddleName
							except invoked.TransientBirthdate
							except invoked.TransientGender
							except invoked.TransientSocialSecurityNumber
							except invoked.DefaultProcedureInformation
							except invoked.IDMDocumentPID
							except invoked.IDMJob
							except invoked.RequisitionStatusValue
							except invoked.Printer
							except invoked.SupplierCreated
							except invoked.TransientAllocationPriorityLevel
						invoked.Company						= PrmCompany
						invoked.Requisition					= 0
						invoked.Requester					= PrmRequester
						invoked.RequestingLocation 			= PrmRequestingLocation
						invoked.FromCompanyLocation 		= PrmFromCompanyLocation
						if (PrmRequestedDeliveryDate entered)
							invoked.RequestedDeliveryDate 		= PrmRequestedDeliveryDate
						if (PrmRequisitionDescription entered)
							invoked.RequisitionDescription		= PrmRequisitionDescription
						if (PrmDeliverTo entered)
							invoked.DeliverTo					= PrmDeliverTo
						if (PrmPriority entered)
							invoked.AllocationPriority			= PrmPriority
						if (PrmBuyer entered)
							invoked.Buyer					    = PrmBuyer
						if (PrmCommodityCode entered)
							invoked.CommodityCode				= PrmCommodityCode
						if (PrmTaxCode entered)
							invoked.PurchaseTaxCode				= PrmTaxCode
						if (PrmPurchaseTaxable entered)
							invoked.PurchaseTaxable				= PrmPurchaseTaxable
						if (PrmPoCode entered)
							invoked.POCode					    = PrmPoCode
						if (PrmVendor entered)
							invoked.Vendor					= PrmVendor
						else
							invoked.Vendor					= PrmCopyFromRequisition.Vendor
						if (PrmPurchaseFromLocation entered)									
							invoked.PurchaseFromLocation	= PrmPurchaseFromLocation
						else
							invoked.PurchaseFromLocation	= PrmCopyFromRequisition.PurchaseFromLocation
						invoked.RequisitionSource			= PrmRequisitionSource

					for each PrmCopyFromRequisition.RequisitionCommentRel
						invoke Create RequisitionComment
							fill in fields from each
								except invoked.Attachment.FSMAttachmentIDM
							invoked.Requisition     	= Requisition
							invoked.Attachment.File		= each.Attachment.File
							invoked.Attachment.MimeType	= each.Attachment.MimeType
							invoked.Attachment.Title	= each.Attachment.Title

					for each PrmCopyFromRequisition.RequisitionLinesToCopyRel
						invoke CopyRequisitionLine each
							invoked.PrmCompany  				= NewRequisitionView.Company
							invoked.PrmRequisition  			= NewRequisitionView.Requisition
							invoked.PrmFromLocationChanged		= LocalFromLocationChanged
							invoked.PrmVendor					= PrmVendor

					LastRequisitionLine    = NumberOfLines
					LocalCompletionMessage = CopyFromRequisitionCreatedMessage

					for each PrmCopyFromRequisition.RequisitionAddOnChargesRel
						invoke Create RequisitionLineAddOnCharge
							fill in fields from each
								except invoked.Requisition
								except invoked.EnteredUnitCost
								except invoked.AddOnChargePercent
								except invoked.TotalAddOnChargeAmount
							invoked.Requisition			= Requisition
							if (each.AddOnChargeEntryMethod.UnitCost)
								invoked.EnteredUnitCost = each.EnteredUnitCost
							else
								if (each.AddOnChargeEntryMethod.RatePercentage)
									invoked.AddOnChargePercent = each.AddOnChargePercent
								else
									if (each.AddOnChargeEntryMethod.TotalAmount)
										invoked.TotalAddOnChargeAmount = each.TotalAddOnChargeAmount

					for each PrmCopyFromRequisition.RequisitionSpreadAddOnCharge set
						invoke CopyFromRequisition RequisitionSpreadAddOnCharge
							fill in fields from each
							invoked.Requisition				= Requisition


		CopyAllLinesFromRequisitionBatch is a Set Action
			run in background
			completion message is "CopyAllLinesFromRequisitionSubmitted"
			restricted
			Local Fields
				LocalCompletionMessage is Text
			Parameters
				PrmCompany				is an InventoryCompany
				PrmCopyFromRequisition	is a Requisition
				PrmRequisition			is a Requisition
			Parameter Rules
				PrmCompany
					required
				PrmRequisition
					required
					constraint(PrmRequisition.Status.Unreleased)
						"RequistionMustBeUnreleased"
				PrmCopyFromRequisition
					required
					constraint(PrmCopyFromRequisition != PrmRequisition)
						"CannotCopyFromTheSameRequisition"
			Instance Selection
				where (Company = PrmCompany and Requisition = PrmCopyFromRequisition)
			Action Rules
				Instance Rules
					display "PrmCompany<PrmCompany>"
					display "PrmRequisition<Requisition>"
					display "PrmCopyFromRequisition<PrmCopyFromRequisition>"
					for each PrmCopyFromRequisition.RequisitionLinesToCopyRel
						invoke CopyRequisitionLine each
							invoked.PrmCompany		= PrmCompany
							invoked.PrmRequisition	= PrmRequisition

					LocalCompletionMessage = PrmCopyFromRequisition.RequisitionLinesCopiedMessage

		SendRequesterRQCreateNotification is an Instance Action
			restricted
			Local Fields
				LocalActor			is an Actor
			Action Rules
				LocalActor = actor
				send notification
					to LocalActor
					description is "RequisitionCreationCompleted._\Requisition<Requisition>"
					priority is medium
					detail is "RequisitionCreationCompleted._\Requisition<Requisition>"

					linkback(webapp is Requester navigation is RequisitionView text is "RequisitionCreationCompleted._\Requisition<Requisition>")

		PopulateRequisitionStatusValue is a Set Action
			restricted
			run in background

			Instance Selection
				where (Company entered
				and    RequisitionStatusValue not entered)

			Action Rules
				Instance Rules
					if (IsClosedStatus
					and not IsRejectedStatus)
						RequisitionStatusValue = RequisitionStatusValue.Closed
					else
					if (IsUnreleased)
						RequisitionStatusValue = RequisitionStatusValue.Unreleased
					else
					if (IsReleasedStatus)
						RequisitionStatusValue = RequisitionStatusValue.Released
					else
					if (Status.InProcess)
						RequisitionStatusValue = RequisitionStatusValue.InProcess
					else
					if (Status.Processed)
						RequisitionStatusValue = RequisitionStatusValue.Processed
					else
					if (IsRejectedStatus)
						RequisitionStatusValue = RequisitionStatusValue.Rejected
					else
					if (IsReleaseInProgress)
						RequisitionStatusValue = RequisitionStatusValue.ReleaseInProgress

		PurgeRequisition is a Set Action
			restricted
			Parameters
				PrmCompany										is an InventoryCompany
					default label is "Company"
				PrmPurgeRequisition								is AlphaUpper size 1
					default label is "PurgeRequisitions"
					States
						PurgeRequisitions		value is "Y"
						ReportOnlyDoNotPurge	value is "R"
				PrmCreationDate									is TimeStamp
					default label is "CreationDateCutOff"
				PrmPurgeTransactions							is AlphaUpper size 1
					default label is "PurgeTransactions"
					States
						PurgeTransactions	value is "Y"
						No					value is "N"
				PrmTransactionDate								is Date
					default label is "TransactionDateCutOff"

			Parameter Rules
				PrmCompany
					required
				PrmPurgeRequisition
					required
					initial value is "R"
					default to "R"
				PrmCreationDate
					required
				PrmPurgeTransactions
					required
					initial value is "N"
					default to "N"
				PrmTransactionDate
					if (PrmPurgeTransactions.PurgeTransactions)
						required
							"MustEnterTransactionDateCutOffWhenPurgingTransactions"

			Local Fields
				LocalSetPurgeCount								is Numeric 10

			Instance Selection
				include deleted records
				where (Company		= PrmCompany
				and    CreationDate <= PrmCreationDate
				and    Closed		= true
				and    IsProcessedOrRejected)

			Action Rules
				Empty Set Rules
					LocalActor = actor
					send notification
						to LocalActor
						description is "NoRequisitionRecordsFoundToPurge"
						priority is high
						detail is "ThereAreNoRequisitionRecordsPurged"
				Set Rules
					Exit Rules
						invoke SendPurgeNotification
							invoked.PrmPurgeCount			= LocalSetPurgeCount
							if (PrmPurgeRequisition.PurgeRequisitions)
								invoked.PrmPurgeRecords 	= true

						invoke PurgeRequisitionTransaction RequisitionTransaction
							invoked.PrmCompany				= PrmCompany
							invoked.PrmPurgeTransactions	= PrmPurgeTransactions
							invoked.PrmTransactionDate		= PrmTransactionDate

				Instance Rules
					LocalSetPurgeCount +=1
					if (PrmPurgeRequisition.PurgeRequisitions)
						invoke Purge

		Purge is a Purge Action
			restricted
			bypass relational integrity rules
			Entrance Rules
				invoke Purge PurgeRequisitionSpreadAddOnChargeRel
				invoke Purge PurgeRequisitionLineAddOnChargeRel
				invoke Purge PurgeRequisitionCommentRel
				invoke Purge PurgeRequisitionLineRel

		SendPurgeNotification is an Instance Action
			restricted
			Parameters
				PrmPurgeCount		is Numeric 10
				PrmPurgeRecords		is Boolean
			Local Fields
				LocalActor			is an Actor
			Action Rules
				LocalActor 			= actor
				LocalPurgeCount		= PrmPurgeCount
				LocalPurgeRecords	= PrmPurgeRecords
				send notification
					to LocalActor
					description is "RequisitionPurgeHasBeenCompleted"
					priority is high
					detail is "<DerivedCompletionDetailText>"

		RefreshAndLock is an Instance Action
			restricted
			refresh and lock this instance
		
		RSSLPLCopyRequisition is an Instance Action
            disable multiple instance selection
            default label is "CopyRequisition"
            completion message is "<LocalCompletionMessage>"
            Local Fields
                LocalCompletionMessage          is Text
            Parameters
                PrmCompany                      is an InventoryCompany
					default label is "Company"
                PrmExistingRequisition          is a Requisition
					default label is "Existing_Requisition"
                PrmCopyFromRequisition          is a Requisition
                PrmRequester                    is a Requester
                PrmRequestingLocation           is a RequestingLocation
                PrmFromCompanyLocation          is a FromCompanyLocation
                PrmRequestedDeliveryDate        is Date
                PrmVendor                       is a Vendor
                PrmPurchaseFromLocation         is a PurchaseFromLocation
                PrmRequisitionDescription       is Alpha size 30
                PrmDeliverTo                    is a DeliverTo
                PrmPriority                     is like AllocationPriority
                PrmBuyer                        is a Buyer
                PrmCommodityCode                is a CommCodes
                PrmTaxCode                      is a TaxCode
                PrmPurchaseTaxable              is Boolean
                PrmPoCode                       is a POCode
                PrmRSSSourceInformation         is Numeric size 1
                    States
                        NotApplicable           value is 0
                        SearchCatalog           value is 1
                        RecentlyRequestedItem   value is 2
                        ShoppingList            value is 3
                        Punchout                value is 4
                        SpecialAndService       value is 5
                        CopyRequisitionLine     value is 6
                PrmCopyRequisition              is Numeric size 1
                    States
                        CreateNewRequisition             value is 0
                        CopyLinesToExistingRequisition   value is 1
            Parameter Rules
                PrmCompany
					initial value is actor.agent(Employee).Employee.Requester.Company
					default to actor.agent(Employee).Employee.Requester.Company
					required
                PrmExistingRequisition
					if (PrmCopyRequisition.CopyLinesToExistingRequisition)
						required
						constraint(PrmExistingRequisition not = PrmCopyFromRequisition)
							"CannotAddFromTheSameRequisition"
						constraint(PrmExistingRequisition.Status.Unreleased)
							"TheExistingRequistionMustBeUnreleased"
				PrmCopyFromRequisition
					initial value is Requisition
					default to Requisition
                PrmRequester
					default to actor.agent(Employee).Employee
                PrmRequestingLocation
                    initial value is PrmCopyFromRequisition.RequestingLocation
                    default to PrmCopyFromRequisition.RequestingLocation
                PrmFromCompanyLocation
                    initial value is PrmCopyFromRequisition.FromCompanyLocation
                    default to PrmCopyFromRequisition.FromCompanyLocation
                PrmRequestedDeliveryDate
					if (PrmCopyRequisition.CreateNewRequisition
					and RequesterRel.RequireRequestedDeliveryDate)
						required
							"Field_Requested_Delivery_DateIsRequired"
                    else 
					if(PrmCopyFromRequisition.RequestedDeliveryDate >= current corporate date)
                        default to PrmCopyFromRequisition.RequestedDeliveryDate 
				PrmRequisitionDescription
					if (PrmCopyRequisition.CreateNewRequisition
					and RequesterRel.RequireRequisitionDescription)
						required
							"Field_Requisition_DescriptionIsRequired"
				PrmVendor
					if (PrmCopyRequisition.CreateNewRequisition
					and RequesterRel.RequireVendor)
						required
							"Field_VendorIsRequired"

            Action Rules
                if (PrmCopyRequisition.CreateNewRequisition)
                    invoke Unreleased.RSSLPLCreateUsingCopyFromRequisition
                        invoked.PrmCopyFromRequisition          = PrmCopyFromRequisition
                        invoked.PrmCompany                      = PrmCompany
                        invoked.PrmRequester                    = PrmRequester
                        invoked.PrmRequestingLocation           = PrmRequestingLocation
                        invoked.PrmFromCompanyLocation          = PrmFromCompanyLocation
                        invoked.PrmRequestedDeliveryDate        = PrmRequestedDeliveryDate
                        invoked.PrmRequisitionDescription       = PrmRequisitionDescription
                        invoked.PrmDeliverTo                    = PrmDeliverTo
                        invoked.PrmPriority                     = PrmPriority
                        invoked.PrmBuyer                        = PrmBuyer  
                        invoked.PrmCommodityCode                = PrmCommodityCode
                        invoked.PrmTaxCode                      = PrmTaxCode
                        invoked.PrmPurchaseTaxable              = PrmPurchaseTaxable
                        invoked.PrmPoCode                       = PrmPoCode 
                        invoked.PrmVendor                       = PrmVendor
                        invoked.PrmPurchaseFromLocation         = PrmPurchaseFromLocation
                        invoked.PrmRequisitionSource            = RqSource.RequisitionSelfService  
                        invoked.PrmCopyNonRSS                   = true
                else
                    if (PrmCopyFromRequisition.NumberOfLines <= 50)
						invoke CopyRequisitionSet RequisitionLine in foreground
							invoked.PrmExistingRequisition		= PrmExistingRequisition
							invoked.PrmCopyFromRequisition		= PrmCopyFromRequisition
							invoked.PrmCompany					= PrmCompany
							invoked.PrmRSSSourceInformation 	= PrmRSSSourceInformation.CopyRequisitionLine
							invoked.PrmRequisitionSource        = RqSource.RequisitionSelfService 
                    else
						invoke CopyRequisitionSet RequisitionLine
							invoked.PrmExistingRequisition		= PrmExistingRequisition
							invoked.PrmCopyFromRequisition		= PrmCopyFromRequisition
							invoked.PrmCompany					= PrmCompany
							invoked.PrmRSSSourceInformation 	= PrmRSSSourceInformation.CopyRequisitionLine
							invoked.PrmRequisitionSource		= RqSource.RequisitionSelfService 
            Exit Rules
                if (PrmCopyRequisition.CreateNewRequisition)
                    LocalCompletionMessage = RSSLPLAddToNewRequisitionMessage
					invoke UpdateCurrentRequisitionForRQC this instance.Requester
						invoked.PrmCompany				= PrmCompany
						invoked.PrmRequisition     		= Requester.CurrentRequisitionForRQC
                else
                    if (PrmCopyFromRequisition.NumberOfLines <= 50)
                        LocalCompletionMessage = PrmCopyFromRequisition.RSSLPLLineAddedToRequisitionMessage
                    else
                        LocalCompletionMessage = PrmCopyFromRequisition.RSSLPLBatchLineAddedToRequisitionMessage
					invoke UpdateCurrentRequisitionForRQC this instance.Requester
						invoked.PrmCompany				= PrmCompany
						invoked.PrmRequisition     		= PrmExistingRequisition
    StateCycles
        RequisitionLifeCycle is a StateCycle
            state field is Status

            Unreleased is a State

                Create is a Create Action
					Action Rules
					Exit Rules

                RSSLPLCreate is a Create Action
		            default label is "Create"
		        	completion message is "RequisitionCreated"
					Local Fields
						LocalIsDropship						is Boolean
           	    	Parameters
                    	PrmCompany							is an InventoryCompany
                    	PrmRequestingLocation  				is a RequestingLocation
		            	PrmFromCompanyLocation 				is a FromCompanyLocation
				        PrmReferenceNumber					is a ReferenceNumber
				        PrmRequisitionDescription       	is Alpha size 30
        				PrmRequestedDeliveryDate           	is Date
        				PrmAllocationPriority				is an AllocationPriority
				   		PrmVendor							is a Vendor
						PrmPurchaseFromLocation				is a VendorLocation     				
						PrmTransactionCurrencyCode			is a Currency
						PrmPurchaseTaxable					is Boolean
						PrmPurchaseTaxCode					is a TaxCode
						PrmDefaultDistributionAccount      	is a RQHeaderDefaultCodeBlock
						PrmBuyer							is a Buyer								
						PrmCommodityCode	        		is a CommCodes
						PrmPOCode							is a POCode
						PrmSourcingEventRequired           	is Boolean
						PrmDeliverTo						is a DeliverTo
						PrmDropshipAddress					is a PostalAddressV2
						PrmReceivingOptions			is Numeric size 1
							States
								ReceivingRequired			value is 0
								ReceivingNotAllowed			value is 1
						PrmDropship							is Boolean
						PrmDropshipPhoneNumber				is an TelephoneNumber
						PrmDropshipContact					is an AddressContact
						PrmDropshipName						is a Name
						PrmDropShipDefaulting 							is Numeric size 1
							default label is "Default_address_from"
							States
								None		 						value is 0
									default label is "ManualEntry"
								RequestingLocationAddress			value is 1
									default label is "RequestingLocation"
								RequesterAddress					value is 2   
									default label is "Requester"
								ClearDefaults						value is 3
						PrmOneSourceDocumentToOnePO        is Numeric size 1
							classic name is ONE-SRC-ONE-PO
							States
								NotApplicable value is 0
								No            value is 1
								Yes           value is 2
						PrmDefaultBillCode                 is a ConsignCode
						PrmAllocationPriorityLevel          is an AllocationPriorityLevel
					        default label is "Priority"
						PrmDefaultCommentCode				is a StandardCommentCode
						PrmCurrentDefaultDistributionAccount	is Alpha size 267 
						PrmDeliveryMethod 					is a DeliveryMethod
                    Parameter Rules
                    	PrmCompany
                    		required
				        	initial value is actor.agent(Employee).Employee.Requester.Company
	       					default to actor.agent(Employee).Employee.Requester.Company
                    	PrmRequestingLocation
                    		required
                    			"Field_\Requesting_\LocationIsRequired"
				        	initial value is actor.agent(Employee).Employee.Requester.RequestingLocation
        					default to actor.agent(Employee).Employee.Requester.RequestingLocation
						PrmDropship
							if (PrmReceivingOptions.ReceivingRequired)
				  				PrmDropship = false
							else
								PrmDropship = true
						PrmAllocationPriority
							if (RSSLPLConfigurationParameterRel exists)
								default to PrmAllocationPriorityLevel
								default to RSSLPLAllocationPriorityLevelRel.AllocationPriorityLevel
						PrmRequestedDeliveryDate
							if (RequesterRel.RequireRequestedDeliveryDate)
								required
									"Field_Requested_Delivery_DateIsRequired"
						PrmDeliverTo
							if (RequesterRel.RequireDeliverTo)
								required
									"Field_Deliver_ToIsRequired"
						PrmRequisitionDescription
							if (RequesterRel.RequireRequisitionDescription)
								required
									"Field_Requisition_DescriptionIsRequired"
						PrmPOCode
							if (RequesterRel.RequirePOCode)
								required
									"Field_P\O_CodeIsRequired"
						PrmBuyer
							if (RequesterRel.RequireBuyer)
								required
									"Field_BuyerIsRequired"
						PrmVendor
							if (RequesterRel.RequireVendor)
								required
									"Field_VendorIsRequired"
              		Action Rules
                		invoke Create this instance
                			invoked.Requester						= actor.agent(Employee).Employee
							invoked.Company							= PrmCompany
							invoked.RequestingLocation 				= PrmRequestingLocation              	
                        	invoked.FromCompanyLocation 			= PrmFromCompanyLocation
							invoked.ReferenceNumber					= PrmReferenceNumber
							invoked.RequisitionDescription			= PrmRequisitionDescription
							invoked.RequestedDeliveryDate			= PrmRequestedDeliveryDate
							invoked.AllocationPriority				 	= PrmAllocationPriority
							if (RSSLPLConfigurationParameterRel exists)
								invoked.TransientAllocationPriorityLevel 	= PrmAllocationPriority
							invoked.Vendor							= PrmVendor
							invoked.PurchaseFromLocation			= PrmPurchaseFromLocation
							invoked.TransactionCurrencyCode			= PrmTransactionCurrencyCode
							invoked.PurchaseTaxable					= PrmPurchaseTaxable
							invoked.PurchaseTaxCode					= PrmPurchaseTaxCode
							if (PrmCurrentDefaultDistributionAccount not = PrmRequestingLocation.IssueAccount)
								invoked.DefaultDistributionAccount 	= PrmDefaultDistributionAccount
							invoked.Buyer							= PrmBuyer
							invoked.CommodityCode					= PrmCommodityCode
							invoked.POCode							= PrmPOCode
							invoked.SourcingEventRequired           = PrmSourcingEventRequired
							invoked.DeliverTo						= PrmDeliverTo
							invoked.Dropship			   			= PrmDropship
							invoked.DropshipName					= PrmDropshipName
							invoked.DropshipPhoneNumber    			= PrmDropshipPhoneNumber
							invoked.DropshipContact					= PrmDropshipContact
							invoked.DropshipAddress        			= PrmDropshipAddress
							invoked.OneSourceDocumentToOnePO		= PrmOneSourceDocumentToOnePO
							invoked.DefaultBillCode					= PrmDefaultBillCode
							invoked.RequisitionSource				= RqSource.RequisitionSelfService
							invoked.DefaultCommentCode				= PrmDefaultCommentCode
							invoked.DeliveryMethod					= PrmDeliveryMethod

                	Exit Rules
						invoke UpdateCurrentRequisitionForRQC this instance.Requester
							invoked.PrmCompany				= PrmCompany
							invoked.PrmRequisition     		= this instance.Requisition

                MobileCreate is a Create Action
		            default label is "Create"
		        	completion message is "RequisitionCreated"
                	Parameters
                    	PrmRequester			   			is a Requester
                    	PrmCompany							is an InventoryCompany
                    	PrmRequestingLocation  				is a RequestingLocation
		            	PrmFromCompanyLocation 				is a FromCompanyLocation
				        PrmReferenceNumber					is a ReferenceNumber
				        PrmRequisitionDescription       	is Alpha size 30
        				PrmRequestedDeliveryDate           	is Date
        				PrmAllocationPriority				is an AllocationPriority
        				
                    Parameter Rules
                        PrmRequester
                        	initial value is actor.agent(Employee).Employee                    	
                        	default to actor.agent(Employee).Employee
                    	PrmCompany
                    		required
				        	initial value is PrmRequester.Company
        					default to PrmRequester.Company
				        	initial value is actor.agent(Employee).Employee.Requester.Company
	       					default to actor.agent(Employee).Employee.Requester.Company
                    	PrmRequestingLocation
                    		required
                    			"FieldRequestingLocation_is_required"
				        	initial value is actor.agent(Employee).Employee.Requester.RequestingLocation
        					default to actor.agent(Employee).Employee.Requester.RequestingLocation
                	Action Rules
                		invoke Create this instance
                			invoked.Requester						= PrmRequester
							invoked.Company							= PrmCompany
							invoked.RequestingLocation 				= PrmRequestingLocation              	
                        	invoked.FromCompanyLocation 			= PrmFromCompanyLocation
							invoked.ReferenceNumber					= PrmReferenceNumber
							invoked.RequisitionDescription			= PrmRequisitionDescription
							invoked.RequestedDeliveryDate			= PrmRequestedDeliveryDate
							invoked.AllocationPriority				= PrmAllocationPriority
							
                	Exit Rules
						invoke UpdateCurrentRequisitionForRQC this instance.Requester
							invoked.PrmCompany				= PrmCompany
							invoked.PrmRequisition     		= this instance.Requisition

                RSSLPLShop is an Instance Action
		            default label is "Shop"
                	valid when (UpdateAllowed)
					completion message is "Shop_forItems"
					disable multiple instance selection
					Exit Rules
						invoke UpdateCurrentRequisitionForRQC Requester
							invoked.PrmCompany		= Company
							invoked.PrmRequisition	= Requisition

                MobileShop is an Instance Action
                	restricted
		            default label is "Shop"
                	valid when (UpdateAllowed)
					completion message is "Shop_forItems"
					disable multiple instance selection
					Exit Rules
						invoke UpdateCurrentRequisitionForRQC Requester
							invoked.PrmCompany		= Company
							invoked.PrmRequisition	= Requisition

				RSSLPLCopyAllLinesFromRequisition is an Instance Action
					default label is "CopyAllRequisitionLines"
					completion message is "<LocalCompletionMessage>"
					Local Fields
						LocalCompletionMessage is Text
					Parameters
						PrmCompany				is an InventoryCompany
						PrmCopyFromRequisition	is a Requisition
						PrmRSSSourceInformation			is Numeric size 1
							States
            					NotApplicable         	value is 0
            					SearchCatalog    		value is 1
								RecentlyRequestedItem   value is 2
            					ShoppingList    		value is 3
								Punchout				value is 4
								SpecialAndService		value is 5
								CopyRequisitionLine 	value is 6
					Parameter Rules
						PrmCompany
							required
								"Field_\CompanyIsRequired"
						PrmCopyFromRequisition
							required
			                	"Field_\Copy_\From_\RequisitionIsRequired"
							constraint(PrmCopyFromRequisition != Requisition)
								"CannotCopyFromTheSameRequisition"
					Action Rules
						if (PrmCopyFromRequisition.NumberOfLines <= 50)
							for each PrmCopyFromRequisition.RequisitionLinesToCopyRel
								invoke CopyRequisitionLine each
									invoked.PrmCompany				= PrmCompany
									invoked.PrmRequisition 			= Requisition
									invoked.PrmRSSSourceInformation	= PrmRSSSourceInformation.CopyRequisitionLine
							LocalCompletionMessage = PrmCopyFromRequisition.RequisitionLinesCopiedMessage
						else
							invoke CopyAllLinesFromRequisitionBatch
								invoked.PrmCompany						= PrmCompany
								invoked.PrmRequisition					= Requisition
								invoked.PrmCopyFromRequisition			= PrmCopyFromRequisition
							LocalCompletionMessage = PrmCopyFromRequisition.BatchRequisitionLinesCopiedMessage

				CopyAllLinesFromRequisition is an Instance Action
					completion message is "<LocalCompletionMessage>"
					restricted
					Local Fields
						LocalCompletionMessage is Text
					Parameters
						PrmCompany				is an InventoryCompany
						PrmCopyFromRequisition	is a Requisition
						PrmRequisition			is a Requisition
					Parameter Rules
						PrmCompany
							required
						PrmRequisition
							required
							constraint(PrmRequisition.Status.Unreleased)
								"RequistionMustBeUnreleased"
						PrmCopyFromRequisition
							required
							constraint(PrmCopyFromRequisition != PrmRequisition)
								"CannotCopyFromTheSameRequisition"
					Action Rules
						for each PrmCopyFromRequisition.RequisitionLinesToCopyRel
							invoke CopyRequisitionLine each
								invoked.PrmCompany		= PrmCompany
								invoked.PrmRequisition  = PrmRequisition


						LocalCompletionMessage = PrmCopyFromRequisition.RequisitionLinesCopiedMessage

				CreateUsingCopyFromRequisition is a Create Action
					completion message is "<LocalCompletionMessage>"
					Local Fields
						LocalFromLocationChanged		is Boolean
						LocalCompletionMessage			is Text
					Parameters
						PrmCompany						is an InventoryCompany
						PrmCopyFromRequisition          is a Requisition
						PrmRequester			   		is a Requester
						PrmRequestingLocation			is a RequestingLocation
						PrmFromCompanyLocation			is a FromCompanyLocation
						PrmRequestedDeliveryDate		is Date
						PrmVendor						is a Vendor
						PrmPurchaseFromLocation			is a PurchaseFromLocation
						PrmRequisitionSource			is a RqSource
						PrmCopyNonRSS					is Boolean
						PrmRequisitionDescription		is Alpha size 30
						PrmDeliverTo					is a DeliverTo
						PrmPriority						is like AllocationPriority
						PrmBuyer						is a Buyer
						PrmCommodityCode				is a CommCodes
						PrmTaxCode						is a TaxCode
						PrmPurchaseTaxable				is Boolean
						PrmPoCode						is a POCode
					Parameter Rules
						PrmCompany
							required
						PrmCopyFromRequisition
							required
							constraint (PrmCopyFromRequisition exists)
								"CopyFromRequisition<PrmCopyFromRequisition>DoesNotExist"
						PrmRequester
							initial value is actor.agent(Employee).Employee
						PrmRequestingLocation
							initial value is PrmCopyFromRequisition.RequestingLocation
							default to PrmCopyFromRequisition.RequestingLocation
						PrmFromCompanyLocation
							initial value is PrmCopyFromRequisition.FromCompanyLocation
							if (PrmFromCompanyLocation != PrmCopyFromRequisition.FromCompanyLocation)
								LocalFromLocationChanged = true
							default to PrmCopyFromRequisition.FromCompanyLocation
						PrmRequestedDeliveryDate
							if(PrmCopyFromRequisition.RequestedDeliveryDate >= current corporate date)
								default to PrmCopyFromRequisition.RequestedDeliveryDate
						PrmRequisitionSource
							default to RqSource.Requisition
						PrmCopyNonRSS
							initial value is true
					Action Rules
						invoke Create this instance
							fill in fields from PrmCopyFromRequisition
								except invoked.Requisition
								except invoked.CreationDate
								except invoked.ReferenceNumber
								except invoked.LastRequisitionLine
								except invoked.LastDeliverySequence
								except invoked.ReturnSequence
								except invoked.Status
								except invoked.LastApprovalDate
								except invoked.Approved
								except invoked.AttainedLevel
								except invoked.ApprovalLevel
								except invoked.NumberOfLines
								except invoked.NumberOfClosedLines
								except invoked.Closed
								except invoked.InventoryItemsTotal
								except invoked.NonstockItemsTotal
								except invoked.SpecialAndServiceItemsSTotal
								except invoked.HeaderAddOnChargeTotal
								except invoked.LineAddOnChargeTotal
								except invoked.AOCTotal
								except invoked.ExtendedAmountTotal
								except invoked.Printed
								except invoked.ReturnNote
								except invoked.ReturnDate
								except invoked.OperatorID
								except invoked.CapitalTotal
								except invoked.TechnicalTotal
								except invoked.CapitalTechnicalTotal
								except invoked.ProcessFlowApprovalLevel
								except invoked.ReleasedDate
								except invoked.ReleasingOperatorID
								except invoked.ApprovedRejectedDate
								except invoked.ApprovingRejectingOperatorID
								except invoked.CreatedBy
								except invoked.LastUpdateDate
								except invoked.LastUpdateBy
								except invoked.BudgetEditProcessing
								except invoked.RequisitionApprovalType
								except invoked.PatientProcedure
								except invoked.TransientVisitNumber
								except invoked.TransientPatientID
								except invoked.TransientCaseNumber
								except invoked.TransientPatientLastName
								except invoked.TransientPatientFirstName
								except invoked.TransientPatientMiddleName
								except invoked.TransientBirthdate
								except invoked.TransientGender
								except invoked.TransientSocialSecurityNumber
								except invoked.DefaultProcedureInformation
								except invoked.IDMDocumentPID
								except invoked.IDMJob
								except invoked.RequisitionStatusValue
								except invoked.Printer
								except invoked.RequestedDeliveryDate
								except invoked.TransientAllocationPriorityLevel
							invoked.Company						= PrmCompany
							invoked.Requester					= PrmRequester
							invoked.RequestingLocation 			= PrmRequestingLocation
							invoked.FromCompanyLocation 		= PrmFromCompanyLocation
							if (PrmRequestedDeliveryDate entered)
								invoked.RequestedDeliveryDate 		= PrmRequestedDeliveryDate
							if (PrmRequisitionDescription entered)
								invoked.RequisitionDescription		= PrmRequisitionDescription
							if (PrmDeliverTo entered)
								invoked.DeliverTo					= PrmDeliverTo
							if (PrmPriority entered)
								invoked.AllocationPriority			= PrmPriority
							if (PrmBuyer entered)
								invoked.Buyer					    = PrmBuyer
							if (PrmCommodityCode entered)
								invoked.CommodityCode				= PrmCommodityCode
							if (PrmTaxCode entered)
								invoked.PurchaseTaxCode				= PrmTaxCode
							if (PrmPurchaseTaxable entered)
								invoked.PurchaseTaxable				= PrmPurchaseTaxable
							if (PrmPoCode entered)
								invoked.POCode					    = PrmPoCode
							if (PrmVendor entered)
								invoked.Vendor						= PrmVendor
								if (PrmPurchaseFromLocation entered)
									invoked.PurchaseFromLocation	= PrmPurchaseFromLocation
								else
								if (PrmCopyFromRequisition.PurchaseFromLocation entered
								and PrmVendor = PrmCopyFromRequisition.Vendor)
									invoked.PurchaseFromLocation	= PrmCopyFromRequisition.PurchaseFromLocation
							else
								invoked.Vendor					= PrmCopyFromRequisition.Vendor
								invoked.PurchaseFromLocation	= PrmCopyFromRequisition.PurchaseFromLocation
							invoked.RequisitionSource			= PrmRequisitionSource

						for each PrmCopyFromRequisition.RequisitionCommentRel
							invoke Create RequisitionComment
								fill in fields from each
									except invoked.Attachment.FSMAttachmentIDM
								invoked.Requisition     	= Requisition
								invoked.Attachment.File		= each.Attachment.File
								invoked.Attachment.MimeType	= each.Attachment.MimeType
								invoked.Attachment.Title	= each.Attachment.Title

						for each PrmCopyFromRequisition.RequisitionLinesToCopyRel 
							invoke CopyRequisitionLine each
								invoked.PrmCompany					= Company
								invoked.PrmRequisition  			= Requisition
								invoked.PrmFromLocationChanged		= LocalFromLocationChanged
								invoked.PrmVendor					= PrmVendor
								invoked.PrmCopyNonRSS				= PrmCopyNonRSS
								invoked.PrmMajorPurchasingClass		= each.MajorPurchasingClass
								invoked.PrmMinorPurchasingClass		= each.MinorPurchasingClass
								if (PrmCopyFromRequisition.RequestingLocation	!= PrmRequestingLocation)
									invoked.PrmHeaderInfoChanged	= true
						LastRequisitionLine    = NumberOfLines
						LocalCompletionMessage = CopyFromRequisitionCreatedMessage

						for each PrmCopyFromRequisition.RequisitionAddOnChargesRel
							invoke Create RequisitionLineAddOnCharge
								fill in fields from each
									except invoked.Requisition
									except invoked.EnteredUnitCost
									except invoked.AddOnChargePercent
									except invoked.TotalAddOnChargeAmount
								invoked.Requisition			= Requisition
								invoked.LocalBypassUpdateRequisition	= true
								if (each.TaxEntityUsesSabrix)
									initialize invoked.InvoicedTaxAmount
									initialize invoked.AccruedTaxAmount
								if (each.AddOnChargeEntryMethod.UnitCost)
									invoked.EnteredUnitCost = each.EnteredUnitCost
								else
									if (each.AddOnChargeEntryMethod.RatePercentage)
										invoked.AddOnChargePercent = each.AddOnChargePercent
									else
										if (each.AddOnChargeEntryMethod.TotalAmount)
											invoked.TotalAddOnChargeAmount = each.TotalAddOnChargeAmount

						for each PrmCopyFromRequisition.RequisitionSpreadAddOnCharge set
							invoke CopyFromRequisition RequisitionSpreadAddOnCharge
								fill in fields from each
								invoked.Requisition				= Requisition

                RSSLPLCreateUsingCopyFromRequisition is a Create Action
					default label is "CreateFromRequisition"
                	completion message is "<LocalCompletionMessage>"
                    Local Fields
                    	LocalFromLocationChanged		is Boolean
                    	LocalCompletionMessage			is Text
                    Parameters
                    	PrmCompany						is an InventoryCompany
                    	PrmCopyFromRequisition          is a Requisition
                    	PrmRequester			   		is a Requester
                    	PrmRequestingLocation  			is a RequestingLocation
                    	PrmFromCompanyLocation 			is a FromCompanyLocation
                    	PrmRequestedDeliveryDate 		is Date
                    	PrmVendor						is a Vendor
                    	PrmPurchaseFromLocation			is a PurchaseFromLocation
                    	PrmRequisitionSource			is a RqSource
                    	PrmCopyNonRSS					is Boolean
						PrmRequisitionDescription		is Alpha size 30
		            	PrmDeliverTo					is a DeliverTo
		            	PrmPriority						is like AllocationPriority
		            	PrmBuyer						is a Buyer
		            	PrmCommodityCode				is a CommCodes
		            	PrmTaxCode						is a TaxCode
		            	PrmPurchaseTaxable				is Boolean
		            	PrmPoCode						is a POCode
						PrmRSSSourceInformation			is Numeric size 1
							States
            					NotApplicable         	value is 0
            					SearchCatalog    		value is 1
								RecentlyRequestedItem   value is 2
            					ShoppingList    		value is 3
								Punchout				value is 4
								SpecialAndService		value is 5
								CopyRequisitionLine 	value is 6
                    Parameter Rules
                        PrmCompany
                        	required
                    		initial value is actor.agent(Employee).Employee.Requester.Company
                    		default to actor.agent(Employee).Employee.Requester.Company
                        PrmCopyFromRequisition
                            required
			                	"Field_\Copy_\From_\RequisitionIsRequired"
                            constraint (PrmCopyFromRequisition exists)
                            	"Copy_\From_\Requisition<PrmCopyFromRequisition>DoesNotExist"
                            PrmCompany = PrmCopyFromRequisition.Company
                        PrmRequester
                        	initial value is actor.agent(Employee).Employee
                    	PrmRequestingLocation
                    		initial value is PrmCopyFromRequisition.RequestingLocation
                    		default to PrmCopyFromRequisition.RequestingLocation
                    	PrmFromCompanyLocation
                    		initial value is PrmCopyFromRequisition.FromCompanyLocation
                    		if (PrmFromCompanyLocation != PrmCopyFromRequisition.FromCompanyLocation)
                    			LocalFromLocationChanged = true
                    		default to PrmCopyFromRequisition.FromCompanyLocation
                        PrmRequestedDeliveryDate
							if (RequesterRel.RequireRequestedDeliveryDate)
								required
									"Field_Requested_Delivery_DateIsRequired"
							else
							if(PrmCopyFromRequisition.RequestedDeliveryDate >= current corporate date)
                            	default to PrmCopyFromRequisition.RequestedDeliveryDate
						PrmRequisitionDescription
							if (RequesterRel.RequireRequisitionDescription)
								required
									"Field_Requisition_DescriptionIsRequired"
                        PrmRequisitionSource
                        	default to RqSource.RequisitionSelfService
                        PrmCopyNonRSS
                        	initial value is true
						PrmVendor
							if (RequesterRel.RequireVendor)
								required
									"Field_VendorIsRequired"
                    Action Rules
						invoke Create this instance
							fill in fields from PrmCopyFromRequisition
								except invoked.Requisition
								except invoked.CreationDate
								except invoked.ReferenceNumber
								except invoked.LastRequisitionLine
								except invoked.LastDeliverySequence
								except invoked.ReturnSequence
								except invoked.Status
								except invoked.LastApprovalDate
								except invoked.Approved
								except invoked.AttainedLevel
								except invoked.ApprovalLevel
								except invoked.NumberOfLines
								except invoked.NumberOfClosedLines
								except invoked.Closed
								except invoked.InventoryItemsTotal
								except invoked.NonstockItemsTotal
								except invoked.SpecialAndServiceItemsSTotal
								except invoked.HeaderAddOnChargeTotal
								except invoked.LineAddOnChargeTotal
								except invoked.AOCTotal
								except invoked.ExtendedAmountTotal
								except invoked.Printed
								except invoked.ReturnNote
								except invoked.ReturnDate
								except invoked.OperatorID
								except invoked.CapitalTotal
								except invoked.TechnicalTotal
								except invoked.CapitalTechnicalTotal
								except invoked.ProcessFlowApprovalLevel
								except invoked.ReleasedDate
								except invoked.ReleasingOperatorID
								except invoked.ApprovedRejectedDate
								except invoked.ApprovingRejectingOperatorID
								except invoked.CreatedBy
								except invoked.LastUpdateDate
								except invoked.LastUpdateBy
								except invoked.BudgetEditProcessing
								except invoked.RequisitionApprovalType
								except invoked.PatientProcedure
								except invoked.TransientVisitNumber
								except invoked.TransientPatientID
								except invoked.TransientCaseNumber
								except invoked.TransientPatientLastName
								except invoked.TransientPatientFirstName
								except invoked.TransientPatientMiddleName
								except invoked.TransientBirthdate
								except invoked.TransientGender
								except invoked.TransientSocialSecurityNumber
								except invoked.DefaultProcedureInformation
								except invoked.IDMDocumentPID
								except invoked.IDMJob
								except invoked.RequisitionStatusValue
								except invoked.Printer
								except invoked.RequestedDeliveryDate
								except invoked.TransientAllocationPriorityLevel
							invoked.Company						= PrmCompany
							invoked.Requester					= PrmRequester
							invoked.RequestingLocation 			= PrmRequestingLocation
                        	invoked.FromCompanyLocation 		= PrmFromCompanyLocation
                        	if (PrmRequestedDeliveryDate entered)
                    			invoked.RequestedDeliveryDate 		= PrmRequestedDeliveryDate
	                    	if (PrmRequisitionDescription entered)
								invoked.RequisitionDescription		= PrmRequisitionDescription
							if (PrmDeliverTo entered)		
								invoked.DeliverTo					= PrmDeliverTo
							if (PrmPriority entered)
								invoked.AllocationPriority			= PrmPriority											
							if (PrmBuyer entered)
								invoked.Buyer					    = PrmBuyer			
							if (PrmCommodityCode entered)
								invoked.CommodityCode				= PrmCommodityCode			
							if (PrmTaxCode entered)
								invoked.PurchaseTaxCode				= PrmTaxCode					
							if (PrmPurchaseTaxable entered)
								invoked.PurchaseTaxable				= PrmPurchaseTaxable				
							if (PrmPoCode entered)
								invoked.POCode					    = PrmPoCode
                        	if (PrmVendor entered)
                        		invoked.Vendor						= PrmVendor
                        		if (PrmPurchaseFromLocation entered)
                        			invoked.PurchaseFromLocation	= PrmPurchaseFromLocation
                        		else
                        		if (PrmCopyFromRequisition.PurchaseFromLocation entered
                        		and PrmVendor = PrmCopyFromRequisition.Vendor)
                        			invoked.PurchaseFromLocation	= PrmCopyFromRequisition.PurchaseFromLocation
                        	else
                        		invoked.Vendor					= PrmCopyFromRequisition.Vendor
                        		invoked.PurchaseFromLocation	= PrmCopyFromRequisition.PurchaseFromLocation
                        	invoked.RequisitionSource			= PrmRequisitionSource
							invoked.TransientRSSLPLRequisitionScreen = blank 

                        for each PrmCopyFromRequisition.RequisitionCommentRel
                            invoke Create RequisitionComment
                                fill in fields from each
									except invoked.Attachment.FSMAttachmentIDM
                                invoked.Requisition     	= Requisition
								invoked.Attachment.File		= each.Attachment.File
								invoked.Attachment.MimeType	= each.Attachment.MimeType
								invoked.Attachment.Title	= each.Attachment.Title

                        for each PrmCopyFromRequisition.RequisitionLinesToCopyRel 
                            invoke CopyRequisitionLine each
								invoked.PrmCompany					= Company
                                invoked.PrmRequisition  			= Requisition
                                invoked.PrmFromLocationChanged		= LocalFromLocationChanged
                                invoked.PrmVendor					= PrmVendor
                                invoked.PrmCopyNonRSS				= PrmCopyNonRSS
								invoked.PrmRSSSourceInformation  	= PrmRSSSourceInformation.CopyRequisitionLine
								invoked.PrmRequisitionSource		= PrmRequisitionSource


						LastRequisitionLine    = NumberOfLines
						LocalCompletionMessage = CopyFromRequisitionCreatedMessage

						for each PrmCopyFromRequisition.RequisitionAddOnChargesRel
							invoke Create RequisitionLineAddOnCharge
								fill in fields from each
									except invoked.Requisition
									except invoked.EnteredUnitCost
									except invoked.AddOnChargePercent
									except invoked.TotalAddOnChargeAmount
								invoked.Requisition			= Requisition
								invoked.LocalBypassUpdateRequisition	= true
								if (each.TaxEntityUsesSabrix)
									initialize invoked.InvoicedTaxAmount
									initialize invoked.AccruedTaxAmount
								if (each.AddOnChargeEntryMethod.UnitCost)
									invoked.EnteredUnitCost = each.EnteredUnitCost
								else
									if (each.AddOnChargeEntryMethod.RatePercentage)
										invoked.AddOnChargePercent = each.AddOnChargePercent
									else
										if (each.AddOnChargeEntryMethod.TotalAmount)
											invoked.TotalAddOnChargeAmount = each.TotalAddOnChargeAmount

						for each PrmCopyFromRequisition.RequisitionSpreadAddOnCharge set
							invoke CopyFromRequisition RequisitionSpreadAddOnCharge
								fill in fields from each
								invoked.Requisition				= Requisition
                	Exit Rules
						invoke UpdateCurrentRequisitionForRQC this instance.Requester
							invoked.PrmCompany				= PrmCompany
							invoked.PrmRequisition     		= this instance.Requisition



				CreateRequisitionFromReturn is a Create Action
					restricted
					completion message is "<LocalCompletionMessage>"
					Local Fields
						LocalFromLocationChanged	is Boolean
						LocalCompletionMessage		is Text
					Parameters
						PrmCompany					is an InventoryCompany
						PrmCopyFromRequisition		is a Requisition
						PrmRequester				is a Requester
						PrmRequestingLocation		is a RequestingLocation
						PrmFromCompanyLocation		is a FromCompanyLocation
						PrmRequestedDeliveryDate	is Date
						PrmVendor					is a Vendor
						PrmPurchaseFromLocation		is a PurchaseFromLocation
					Parameter Rules
						PrmCompany
							required
						PrmCopyFromRequisition
							required
						PrmRequester
							initial value is PrmCopyFromRequisition.Requester
							force default to PrmCopyFromRequisition.Requester
						PrmRequestingLocation
							initial value is PrmCopyFromRequisition.RequestingLocation
							default to PrmCopyFromRequisition.RequestingLocation
						PrmFromCompanyLocation
							initial value is PrmCopyFromRequisition.FromCompanyLocation
							if (PrmFromCompanyLocation != PrmCopyFromRequisition.FromCompanyLocation)
								LocalFromLocationChanged = true
							default to PrmCopyFromRequisition.FromCompanyLocation
						PrmRequestedDeliveryDate
							if(PrmCopyFromRequisition.RequestedDeliveryDate >= current corporate date)
								default to PrmCopyFromRequisition.RequestedDeliveryDate
					   	PrmPurchaseFromLocation
					   		default to PrmCopyFromRequisition.PurchaseFromLocation
					Action Rules
						invoke Create this instance
							fill in fields from PrmCopyFromRequisition
								except invoked.Requisition
								except invoked.CreationDate
								except invoked.ReferenceNumber
								except invoked.LastRequisitionLine
								except invoked.LastDeliverySequence
								except invoked.ReturnSequence
								except invoked.Status
								except invoked.LastApprovalDate
								except invoked.Approved
								except invoked.AttainedLevel
								except invoked.ApprovalLevel
								except invoked.NumberOfLines
								except invoked.NumberOfClosedLines
								except invoked.Closed
								except invoked.InventoryItemsTotal
								except invoked.NonstockItemsTotal
								except invoked.SpecialAndServiceItemsSTotal
								except invoked.Printed
								except invoked.ReturnNote
								except invoked.ReturnDate
								except invoked.OperatorID
								except invoked.CapitalTotal
								except invoked.TechnicalTotal
								except invoked.CapitalTechnicalTotal
								except invoked.ProcessFlowApprovalLevel
								except invoked.ReleasedDate
								except invoked.ReleasingOperatorID
								except invoked.ApprovedRejectedDate
								except invoked.ApprovingRejectingOperatorID
								except invoked.CreatedBy
								except invoked.LastUpdateDate
								except invoked.LastUpdateBy
								except invoked.OneSourceDocumentToOnePO
								except invoked.IDMDocumentPID
								except invoked.IDMJob
								except invoked.RequisitionStatusValue
								except invoked.HeaderAddOnChargeTotal
								except invoked.LineAddOnChargeTotal
								except invoked.AOCTotal
								except invoked.ExtendedAmountTotal
								except invoked.RequisitionApprovalType
								except invoked.BudgetEditProcessing
								except invoked.Printer
								except invoked.TransientAllocationPriorityLevel
							invoked.Company						= PrmCompany
							invoked.Requester					= PrmRequester
							invoked.RequestingLocation 			= PrmRequestingLocation
							invoked.FromCompanyLocation 		= PrmFromCompanyLocation
							invoked.RequestedDeliveryDate 		= PrmRequestedDeliveryDate
							if (PrmVendor entered)
								invoked.Vendor					= PrmVendor
							else
								invoked.Vendor					= PrmCopyFromRequisition.Vendor
							invoked.PurchaseFromLocation		= PrmPurchaseFromLocation
							invoked.RequisitionSource			= RqSource.Requisition

						for each PrmCopyFromRequisition.RequisitionCommentRel
							invoke Create RequisitionComment
								fill in fields from each
									except invoked.Attachment.FSMAttachmentIDM
								invoked.Requisition     	= Requisition
								invoked.Attachment.File		= each.Attachment.File
								invoked.Attachment.MimeType	= each.Attachment.MimeType
								invoked.Attachment.Title	= each.Attachment.Title

						for each PrmCopyFromRequisition.RequisitionReturnLineToNewRequisitionRel
							invoke CopyRequisitionLine each
								invoked.PrmCompany							= Company
								invoked.PrmRequisition  					= Requisition
								invoked.PrmFromLocationChanged				= LocalFromLocationChanged
								invoked.PrmReturnQuantity					= each.ReturnQuantity
								invoked.PrmCreateRequisitionLineFromReturn	= true
							increment NumberOfLines by 1
						invoke Release Requisition
						LocalCompletionMessage = ReturnFromRequisitionCreatedMessage

				CopyAllLinesFromTemplate is an Instance Action
					completion message is "LinesFromTemplate<PrmProcurementTemplate>HaveBeenCopied"
					restricted
					Parameters
						PrmProcurementTemplate is a ProcurementTemplate
					Parameter Rules
						ProcurementTemplate
							constraint (ProcurementTemplate.LastProcurementTemplateLine > 0)
								"ProcurementTemplateHasNoLines"

							constraint (ProcurementTemplateParticipantsByRequesterRel exists
							or ProcurementTemplateParticipantsByCompanyRel exists
							or ProcurementTemplateParticipantsByRequestingLocationRel exists)
								"NotAValid_\ParticipantFor_\Procurement_\Template"
							required

					Action Rules
						for each PrmProcurementTemplate.ValidProcurementTemplateLinesRel	
							display "WithinCreateAllLinesFromTemplate"
							invoke CreateFromProcurementTemplateLine RequisitionLine
								invoked.PrmProcurementTemplate		= PrmProcurementTemplate
								invoked.PrmProcurementTemplateLine	= each.ProcurementTemplateLine
								invoked.PrmRequisition				= Requisition
								invoked.PrmInventoryCompany			= Company
							increment NumberOfLines by 1



				CreateUsingCopyFromTemplate is a Create Action
					default label is "CreateFromTemplate"
					completion message is "Requisition<Requisition>Created"
					Field Rules
						Requester
							required

						ProcurementTemplate
							constraint (ProcurementTemplate.LastProcurementTemplateLine > 0)
								"ProcurementTemplateHasNoLines"

							constraint (ProcurementTemplateParticipantsByRequesterRel exists
							or ProcurementTemplateParticipantsByCompanyRel exists
							or ProcurementTemplateParticipantsByRequestingLocationRel exists)
								"NotAValidParticipantForProcurementTemplate"
							required

						RequisitionSource
							default to RqSource.Requisition

						TransientAttachment
						 	constraint(TransientCommentTitle entered)
								"TitleIsRequired"

						TransientCommentTitle
						 	constraint(TransientAttachment.File entered)
								"AttachmentFileIsRequired"

                    Exit Rules
						include CreateUsingCopyFromTemplateExitRules

                RSSLPLCreateUsingCopyFromTemplate is a Create Action
					default label is "CreateFromShoppingList"
					completion message is "Requisition<Requisition>Created"
                    Field Rules
                        Requester
                            required

						ProcurementTemplate
                            constraint (ProcurementTemplate.LastProcurementTemplateLine > 0)
                                "Shopping_\ListHasNoLines"

                            constraint (ProcurementTemplateParticipantsByRequesterRel exists
                            or ProcurementTemplateParticipantsByCompanyRel exists
                            or ProcurementTemplateParticipantsByRequestingLocationRel exists)
                                "NotAValidParticipantFor_\Shopping_\List"

							required
								"Field_\Shopping_\ListIsRequired"

						RequisitionSource
							default to RqSource.RequisitionSelfService

						TransientAttachment
						 	constraint(TransientCommentTitle entered)
								"TitleIsRequired"

						TransientCommentTitle
						 	constraint(TransientAttachment.File entered)
								"AttachmentFileIsRequired"

                    Exit Rules
						include CreateUsingCopyFromTemplateExitRules
						invoke UpdateCurrentRequisitionForRQC this instance.Requester
							invoked.PrmCompany				= this instance.Company
							invoked.PrmRequisition     		= this instance.Requisition


				CreateUsingCopyFromTemplateForRSS is a Create Action
					default label is "CreateFromTemplate"
					completion message is "Requisition<Requisition>Created"
					restricted
					Field Rules
						Requester
							required

						ProcurementTemplate
							constraint (ProcurementTemplate.LastProcurementTemplateLine > 0)
								"ProcurementTemplateHasNoLines"

							constraint (ProcurementTemplateParticipantsByRequesterRel exists
							or ProcurementTemplateParticipantsByCompanyRel exists
							or ProcurementTemplateParticipantsByRequestingLocationRel exists)
								"NotAValidParticipantForProcurementTemplate"
							required

						RequisitionSource
							default to RqSource.Requisition

					Exit Rules
						if (TransientCopyAllLines)
							if (ProcurementTemplate.NoOfLines > 50)
								invoke BatchCopyToRequisitionAllRSS ProcurementTemplateLine
										invoked.PrmProcurementTemplate			    = ProcurementTemplate
										invoked.PrmCompany							= Company
										invoked.PrmRequisition						= Requisition
										invoked.PrmRequestingLocation				= RequestingLocation
										invoked.PrmFromCompanyLocation				= FromCompanyLocation
										invoked.PrmDeliverTo						= DeliverTo
										invoked.PrmPOCode							= POCode
										invoked.PrmAllocationPriority				= AllocationPriority
										invoked.PrmPurchaseFromLocation				= PurchaseFromLocation
										invoked.PrmPurchaseTaxCode					= PurchaseTaxCode
										invoked.PrmPurchaseTaxable					= PurchaseTaxable
										invoked.PrmCommodityCode					= CommodityCode
										invoked.PrmQuantityMultiplier				= TransientQuantityMultiplier
							else
								for each ProcurementTemplate.ProcurementTemplateLine set
									invoke CreateFromProcurementTemplateLineForRSS RequisitionLine
										invoked.PrmProcurementTemplate		= ProcurementTemplate
										invoked.PrmProcurementTemplateLine	= each.ProcurementTemplateLine
										invoked.PrmRequisition				= Requisition
										invoked.PrmInventoryCompany			= Company



										invoked.PrmContract					= each.ProcurementTemplateLine.DerivedContractID
										invoked.PrmContractLine				= each.ProcurementTemplateLine.DerivedContractLine
										invoked.PrmCopyAllLines				= true					
										if (each.ProcurementTemplateLine.HasContract)
											invoked.PrmContract				= each.ProcurementTemplateLine.Contract
											invoked.PrmContractLine			= each.ProcurementTemplateLine.ContractLine
										else
											if (each.ProcurementTemplateLine.DerivedContractID not = 0)
												invoked.PrmContract		= each.ProcurementTemplateLine.DerivedContractID
												invoked.PrmContractLine	= each.ProcurementTemplateLine.DerivedContractLine



										invoked.PrmQuantityMultiplier       = TransientQuantityMultiplier


				CreateFromParLocation is a Create Action
					restricted

				MobileCreateFromParLocation is a Create Action
					restricted

				UpdateRequisitionLineFillOrKill is an Update Action
					Action Rules
						invoke Update
						if (FillOrKill != first RequisitionLinesRel.FillOrKill)
							for each RequisitionLinesRel
								invoke Update each
									invoked.FillOrKill = FillOrKill


				Update is an Update Action
					valid when (BudgetEditAndInterfaceNotInProcess)
					Entrance Rules
						constraint (not IsClosedStatus)
							"CannotChange;RequisitionIsClosed"
							
						include InventoryLocationStatusValidation

					Field Rules
						Requester
							cannot be changed
					
					Action Rules
						include DefaultDropShipInfo
					Exit Rules
						if (DisplayOfProcedureInfo)
							include CheckPHIProcedureInformation
						if (DefaultCommentCode entered)
							include CopyStandardCommentCode

				RSSLPLDelete is an Instance Action
					valid when (BudgetEditAndInterfaceNotInProcess)
					default label is "Delete"
					Entrance Rules
						confirmation required
							"RequisitionWillBeDeleted.DoYouWantToContinue?"
					Action Rules
						invoke Delete	

				Delete is a Delete Action
					valid when (BudgetEditAndInterfaceNotInProcess)
					Entrance Rules
						constraint (not IsClosedStatus)
							"CannotDelete;RequisitionIsClosed"

	  					if (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
						or  RQGeneralLedgerSystemCodeRel.EncumbranceOption.Track)
							invoke Delete BudgetRebuildBTGTRel
							invoke Delete HeaderBudgetEditErrorRel
							invoke Delete DistributionBudgetEditErrorRel
							for each CommittedRequisitionLineDistributionRel
								invoke PurgeGLCommitment each
							invoke Delete BudgetTemplateGroupTotalRel
							invoke Delete BudgetEditBatchRel

						for each RequisitionLinesRel
							if (each.PatientProcedure entered)
								invoke DeletePatientProcedure RequisitionLinesRel
							if (each.PreferenceCardTransaction
							and each.HasScheduledProcedureRecord)
								invoke CancelLine each.ScheduledProcedureLineRel
									invoked.PrmCancelQuantity = each.DerivedTotalQuantity


						if (PatientProcedureInfoExists)
							LocalDeleteHeader = true
							invoke DeletePatientProcedure

						include ClearCurrentPunchoutContextForRQC
					Exit Rules
						include ClearCurrentRequisitionForRQC


			Released is a State

				Delete is a Delete Action
					valid when (not NeedsApproval)	
					Entrance Rules
						constraint (not IsClosedStatus)
							"CannotDelete;RequisitionIsClosed"

						if (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
						or  RQGeneralLedgerSystemCodeRel.EncumbranceOption.Track)
							invoke Delete HeaderBudgetEditErrorRel
							invoke Delete DistributionBudgetEditErrorRel
							invoke Purge GLCommitDrillRel


						for each RequisitionLinesRel
							if (each.PatientProcedure entered)
								invoke DeletePatientProcedure RequisitionLinesRel

						if (PatientProcedureInfoExists)
							LocalDeleteHeader = true
							invoke DeletePatientProcedure

				Process is an Instance Action
					restricted
					Action Rules
						if (!RequisitionApprovalType.HeaderMatrixApproval)
							if (AttainedLevel = ApprovalLevel)
								ApprovedRejectedDate			= current timestamp
								ApprovingRejectingOperatorID	= actor
						LastUpdateDate						= current timestamp
						LastUpdateBy						= actor

						if (not Requisition.RequisitionApprovalType.LineApproval)
							if (NumberOfLines <= DerivedForegroundLimit)
								invoke BatchProcess RequisitionLine in foreground
									invoked.PrmCompany		= Company
									invoked.PrmRequisition	= Requisition
							else
								invoke BatchProcess RequisitionLine in background
									invoked.PrmCompany		= Company
									invoked.PrmRequisition	= Requisition

				TransitionToProcessed is an Instance Action
					restricted
					Action Rules
						make transition to Processed

						RequisitionStatusValue = RequisitionStatusValue.Processed

				DirectApprove is an Instance Action  
					restricted

					Action Rules
						invoke DirectAndManualApprove

				ManualApprove is an Instance Action
					valid when (NeedsHeaderApproval)
					Action Rules
						invoke DirectAndManualApprove

						if (RequisitionApprovalType.HeaderApproval)
							cancel RequisitionApproval process
						else
							invoke ManualApprove ResponsibilityMatrixApprovalProcessorRel

				DirectReject is an Instance Action  
					restricted

					Action Rules
						invoke DirectAndManualReject

				ManualReject is an Instance Action
					valid when (NeedsHeaderApproval)
					Action Rules
						invoke DirectAndManualReject

						if (RequisitionApprovalType.HeaderApproval)
							cancel RequisitionApproval process
						else
							invoke ManualReject ResponsibilityMatrixApprovalProcessorRel

				DirectUnrelease is an Instance Action  
					restricted

					Action Rules
						invoke DirectAndManualUnrelease

				ManualUnrelease is an Instance Action
					valid when (NeedsHeaderApproval)
					Action Rules
						invoke DirectAndManualUnrelease

						if (RequisitionApprovalType.HeaderApproval)
							cancel RequisitionApproval process
						else
							invoke ManualUnrelease ResponsibilityMatrixApprovalProcessorRel

				DirectAndManualApprove is an Instance Action    
					restricted
					default label is "Approve"
					completion message is "RequisitionIsApproved.<Status>"
					Entrance Rules
						constraint (RequestingLocation.Active)
							"Warning:RequestingLocationIsInactive,ApproveOrReject?"
					Action Rules
						LastApprovalDate            = current corporate date
						ApprovalLevel                = 0
						AttainedLevel                = 0
						Approved                    = true
						ApprovedRejectedDate        = current timestamp
						invoke Process

						if (RequisitionApprovalType.HeaderMatrixApproval)
							send email
								to RequesterEmailAddress
								from config.DefaultFromEmailAddress
								subject "Requisition<Requisition>HasBeenApproved"
								Contents
									"Requisition<Requisition>ForRequestingLocation<RequestingLocation.RequestingLocationNameID>HasBeenApproved"

				DirectAndManualReject is an Instance Action     
					restricted
					default label is "Reject"
					completion message is "RequisitionIsRejected.<Status>"
					Action Rules
						Status							= Status.Rejected
						LastApprovalDate                = current corporate date
						Approved                        = false //"R"
						Closed                          = true
						ApprovedRejectedDate            = current timestamp
						for each RequisitionLinesRel
							invoke Released.ManualAndPFIRejectLine each

						make transition to Rejected

						RequisitionStatusValue = RequisitionStatusValue.Rejected
					
				DirectAndManualUnrelease is an Instance Action    
					restricted
					completion message is "RequisitionIsUnreleased.<Status>"
					Action Rules
						LastApprovalDate            = current corporate date
						initialize ApprovalLevel
						initialize AttainedLevel
						initialize LastApprovalDate
						initialize ReleasedDate
						initialize ReleasingOperatorID
						for each RequisitionLinesRel
							invoke Released.ManualAndPFIUnrelease each
						make transition to Unreleased

						RequisitionStatusValue = RequisitionStatusValue.Unreleased

				Unrelease is an Instance Action

					restricted
					Action Rules
						LastUpdateDate                   = current timestamp
						LastUpdateBy                     = actor

						if (RequisitionLinesProcessedRel exists)
							make transition to InProcess	

							RequisitionStatusValue = RequisitionStatusValue.InProcess
						else
							make transition to Unreleased	

							RequisitionStatusValue = RequisitionStatusValue.Unreleased

				RejectFromLine is an Instance Action
					restricted
					Action Rules
						Status							= Status.Rejected
						LastApprovalDate                = current corporate date
						Approved                        = false
						Closed                          = true
						ApprovedRejectedDate            = current timestamp

						make transition to Rejected

						RequisitionStatusValue = RequisitionStatusValue.Rejected

			InProcess is a State

				Update is an Update Action
					Entrance Rules
						include InventoryLocationStatusValidation
					Action Rules
						constraint (not IsClosedStatus)
							"CannotChange;RequisitionIsClosed"

				Delete is a Delete Action
					Entrance Rules
						constraint (not IsClosedStatus)
							"CannotDelete;RequisitionIsClosed"
						constraint (RequisitionLinesProcessedRel not exists)
							"CannotDelete;AtLeastOneLineAlreadyReleased"

						if (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
						or  RQGeneralLedgerSystemCodeRel.EncumbranceOption.Track)
							invoke Delete HeaderBudgetEditErrorRel
							invoke Delete DistributionBudgetEditErrorRel
							invoke Purge GLCommitDrillRel


						for each RequisitionLinesRel
							if (each.PatientProcedure entered)
								invoke DeletePatientProcedure RequisitionLinesRel

						if (PatientProcedureInfoExists)
							LocalDeleteHeader = true
							invoke DeletePatientProcedure

				Unrelease is an Instance Action
					Action Rules
						LastUpdateDate                   = current timestamp
						LastUpdateBy                     = actor

						if (RequisitionLinesProcessedRel not exists)
							make transition to Unreleased	
							RequisitionStatusValue = RequisitionStatusValue.Unreleased

				TransitionToProcessed is an Instance Action
					restricted
					Action Rules
						make transition to Processed

						RequisitionStatusValue = RequisitionStatusValue.Processed

 			ReleaseInProgress is a State

 			CreateInProgress is a State
				TransitionToUnreleased is an Instance Action
					restricted
					Action Rules
						make transition to Unreleased
						RequisitionStatusValue = RequisitionStatusValue.Unreleased


			Rejected is a State


				Close is an Instance Action
					restricted
					valid when (not IsClosedStatus)

			Processed is a State

				Close is an Instance Action
					restricted
					valid when (not IsClosedStatus)
					Parameters
						PrmWarehouseShipment is like WarehouseShipment
						SkipLineLevelClose	 is Boolean
					Action Rules
						if (!SkipLineLevelClose)
							for each RequisitionLinesOpenRel
								if (each.Status.Processed)
									invoke Processed.Close each
										invoked.PrmWarehouseShipment = PrmWarehouseShipment
								else
								if (each.Status.Rejected)
									invoke Rejected.Close each
										invoked.PrmWarehouseShipment = PrmWarehouseShipment

						if (instance count of RequisitionLinesOpenRel = 0)
							Closed                          = true
							LastUpdateDate                  = current timestamp
							LastUpdateBy                    = actor

				Update is an Update Action    
					restricted
					bypass field rules

				QuickCreatePOForBillOnly is an Instance Action 
					valid when (CanQuickCreatePO)
					Parameters 
						ParmReleasePurchaseOrder 	is Boolean 
							default label is "ReleasePurchaseOrder"
						ParmBuyer                   is a Buyer 
							default label is "Buyer"
						ParmDefaultDeliveryDate     is Date
							default label is "DeliveryDate"
					
					Parameter Rules 
						ParmReleasePurchaseOrder
							initial value is true
						ParmBuyer 
							initial value is Buyer
						ParmDefaultDeliveryDate
							initial value is RequestedDeliveryDate
					
					Action Rules 
						for each PurchaseOrderInterfaceForThisRequisitionRel
							invoke SelectForPurchaseOrder each 
						invoke CreatePurchaseOrder PurchaseOrderInterface 
							invoked.PrmVendor						= Vendor
							invoked.PrmPurchaseFromLocation			= PurchaseFromLocation
							invoked.PrmBuyer						= ParmBuyer
			   				invoked.PrmPOCode						= POCode
							invoked.PrmDefaultDeliveryDate			= ParmDefaultDeliveryDate
			   				invoked.PrmCompany						= Company
							invoked.PrmReleasePurchaseOrder			= ParmReleasePurchaseOrder	
							invoked.PrmFromCapitated                = true 


				ReleaseReturns is an Instance Action
					valid when (LineReturnQuantityExist)

					Parameters
						PrmReturnDate              is Date
							default label is "ReturnDate"
						PrmReturnNote              is a Note
							default label is "ReturnNote"
						PrmDeliveryDate            is Date
							default label is "RequestedDeliveryDate"

					Parameter Rules
						PrmReturnDate
							initial value is ReturnDate
							default to current corporate date
							if (ReturnDate < current corporate date)
								force default to current corporate date
						PrmReturnNote
							initial value is ReturnNote

					Entrance Rules
						constraint (LineReturnsExist)
							"CannotRelease;NoRequisitionLineAreAvailableForReturn."

					Action Rules
						invoke Processed.Update
							invoked.ReturnDate = PrmReturnDate
							invoked.ReturnNote = PrmReturnNote

						for each RequisitionReturnLineRel
							invoke Processed.ReleaseReturn each

						increment ReturnSequence by 1
					Exit Rules
						if (LineReturnsToNewRequisition)
							invoke Unreleased.CreateRequisitionFromReturn
				 				invoked.PrmCompany					= Company
								invoked.PrmCopyFromRequisition		= Requisition
								invoked.PrmRequester				= Requester
								invoked.PrmRequestingLocation		= RequestingLocation
								invoked.PrmFromCompanyLocation		= FromCompanyLocation
								invoked.PrmRequestedDeliveryDate	= PrmDeliveryDate
								invoked.PrmVendor					= Vendor
