CustomerRepresentativeComment is a BusinessClass
    owned by ar
    prefix is CRCOM

    Ontology
    	part of CustomerRepresentative
    		relative key is Title is a CommentName
    	
    Persistent Fields
    	Comment 			is a Description4
    	Attachment			is an AlternateAttachment
    	    
    Field Rules
    	Comment
    		required
	Local Fields
		LocalAttributeCtr   is Numeric 2	

    Conditions
    	HasAttachment
    		restricted
    		when (Attachment entered)
	
	Create Rules  
		include IDM.CreateRules 
			replace AttachmentField with Attachment							
	Delete Rules
		include IDM.DeleteNoArchiveRules
			replace AttachmentField with Attachment
	Commit Rules
		include IDM.CommitRules
			replace AttachmentField with Attachment
			
	Actions
		Create is a Create Action

		Update is an Update Action

		Delete is a Delete Action

		UploadToIDM is an Instance Action  
			valid when (Attachment.ValidForIDMUpload)
			Action Rules
				include IDM.MoveAttachmentsToIDM
					replace AttachmentField   with Attachment	
						
									
		MoveAttachmentsToIDM is a Set Action
			restricted
			Instance Selection
				where (Attachment.IsLocal)

			Accumulators
				InstanceCount

			Action Rules
				Instance Rules
					increment InstanceCount	

					include IDM.MoveAttachmentsToIDM
						replace AttachmentField   with Attachment

					commit transaction

					if (InstanceCount = config.IDM_MOVE_ATTACHMENTS_LIMIT)
						end set action instance loop
						
