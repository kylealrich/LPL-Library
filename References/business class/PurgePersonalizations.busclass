PurgePersonalizations is a BusinessTask
    owned by admincon
    
    Patterns
        implements AdminCommand
        
    Parameters
    	Actor									
    	DeletedActor 			is like Actor	
		PhysicallyDelete  		is Boolean
		DeleteUserReportOutput 	is Boolean
		
	Parameter Rules
		Actor
			if (Actor entered)
				DeletedActor = Actor
			else
			if (DeletedActor not entered)
				required
					"MustEnterActorOrDeletedActor"
		
	Actions
		Purge is an Instance Action
			run in background
			
			Local Fields
				AsyncId is an AsyncActionRequest
			
			Action Rules

				if (PhysicallyDelete)
					invoke PurgePersonalizationsForActor UserList in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor
					
					invoke PurgePersonalizationsForActor UserCardView in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor
							
					invoke PurgePersonalizationsForActor UserForm in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor
						
					invoke PurgePersonalizationsForActor UserMenu in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor		
						
					invoke PurgePersonalizationsForActor UserPage in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor	
						
					invoke PurgePersonalizationsForActor UserSJRptMap in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor	
					
					invoke PurgePersonalizationsForActor UserImageMap in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor														
				else					
					invoke DeletePersonalizationsForActor UserList in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor

					invoke DeletePersonalizationsForActor UserCardView in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor
						
					invoke DeletePersonalizationsForActor UserForm in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor
						
					invoke DeletePersonalizationsForActor UserMenu in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor			
						
					invoke DeletePersonalizationsForActor UserPage in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor													
					
					invoke DeletePersonalizationsForActor UserSJRptMap in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor		
						
					invoke DeletePersonalizationsForActor UserImageMap in background group("ActorPersonalizationPurge")
						invoked.ParamDeletedActor 			= DeletedActor		
						
				invoke PurgeFoldersForActor UserFolder in background
					run after background group("ActorPersonalizationPurge")
					assign async action request id to AsyncId
					invoked.ParamDeletedActor 			= DeletedActor
					invoked.PhysicallyDeleteRelatedData = PhysicallyDelete
					invoked.DeleteRelatedUserReports	= DeleteUserReportOutput						
						
				invoke PurgeActorReports UserReport in background
					run after AsyncId
					invoked.ParamDeletedActor	= DeletedActor
					invoked.IncludeFolders		= true 
					invoked.ThruDate			= system current date
