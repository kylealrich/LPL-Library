ReconciliationAccountStructurePeriod is a BusinessClass
    owned by reconciliation
    prefix is RSTP
	sql name is ReconciliationStructurePeriod
	
    Patterns
    	implements DynamicCreation
    	
    Ontology
    	symbolic key is ReconciliationAccountStructurePeriod

    Persistent Fields
		PercentCompleteStatus	is Numeric 1
			States
				0To25	value is 1
				26To50	value is 2
				51To75	value is 3
				76To99	value is 4
				100		value is 5

	Derived Fields
		NumberOfOpenReconciliations	is a ComputeField
			type is Numeric 6
			(instance count of OpenByStructureRel)

		NumberOfInProcessReconciliations is a ComputeField
			type is Numeric 6
			(instance count of InProcessByStructureRel)

		NumberOfPendingReconciliations is a ComputeField
			type is Numeric 6
			(instance count of PendingApprovalByStructureRel)

		NumberOfClosedReconciliations is a ComputeField
			type is Numeric 6
			(instance count of ClosedByStructureRel)

		NumberOfIncompleteReconciliations is a ComputeField
			type is Numeric 7
			(NumberOfOpenReconciliations + NumberOfInProcessReconciliations + NumberOfPendingReconciliations)

		TotalNumberOfReconciliations is a ComputeField
			type is Numeric 7
			(instance count of TotalByStructureRel)

		PercentComplete is a ComputeField
			type is Percent 3
			(NumberOfClosedReconciliations / TotalNumberOfReconciliations)

	Conditions
		HasReconciliationsViewableByAuditor
			restricted
			when (ViewableByAuditorPeriodEndReconciliationHierarchyRel exists)
		
		ReconciliationsExistForPeriod
			restricted
			when (PeriodEndReconciliationRel exists)
		
		HasPeriodReconciliationGroups
			when (PeriodReconciliationGroupRel exists)
			
		HasAccountReconcilingItemsWithReasonCode
			when (ReconciliationManagementGroup.ReconcilingItemReasonCodeRequired
			and ReconciliationAccountStructure.ReconciliationType.Account)
			
		HasNonAccountReconcilingItemsWithReasonCode
			when (ReconciliationManagementGroup.ReconcilingItemReasonCodeRequired
			and ReconciliationAccountStructure.ReconciliationType.NonAccount)
					
	Sets
		ByStatus
			Sort Order
				ReconciliationManagementGroup
				ReconciliationAccountStructure
				GeneralLedgerCloseConfiguration
				GeneralLedgerClosePeriod
				PercentCompleteStatus

		ByGeneralLedgerClosePeriod
			Sort Order
				ReconciliationManagementGroup
				ReconciliationAccountStructure
				GeneralLedgerClosePeriod
  				GeneralLedgerCloseConfiguration
  				
	Relations
		PeriodEndReconciliationRel
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByStatus
				related.ReconciliationManagementGroup													= ReconciliationManagementGroup
				related.ReconciliationAccountStructure  												= ReconciliationAccountStructure
				related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration							= GeneralLedgerCloseConfiguration
				related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod	= GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
		
		AllReconcilingItemReasonRel
			one-to-many relation to ReconciliationPeriodDetail
			Field Mapping uses ByReasonCode
				related.ReconciliationManagementGroup	         = ReconciliationManagementGroup  
				related.ReconciliationAccountStructure	         = ReconciliationAccountStructure
				related.GeneralLedgerCloseConfiguration	         = GeneralLedgerCloseConfiguration
				related.DetailPeriod.GeneralLedgerCalendarPeriod = GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
			Instance Selection
				where (related.DetailType.ReconcilingItem)
				
		ReconcilingItemReasonRel
			one-to-many relation to ReconciliationPeriodDetail
			Field Mapping uses ByReasonCode
				related.ReconciliationManagementGroup	         = ReconciliationManagementGroup  
				related.ReconciliationAccountStructure	         = ReconciliationAccountStructure
				related.GeneralLedgerCloseConfiguration	         = GeneralLedgerCloseConfiguration
				related.DetailPeriod.GeneralLedgerCalendarPeriod = GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
			Instance Selection
				where (related.DetailType.ReconcilingItem
				and    related.ReconciliationReason entered)
				
		NonAccountPeriodEndReconciliationRel
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByNonAccountReconciliation
				related.ReconciliationManagementGroup													= ReconciliationManagementGroup
				related.ReconciliationAccountStructure  												= ReconciliationAccountStructure
				related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration							= GeneralLedgerCloseConfiguration
				related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod	= GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
				
		PeriodEndReconciliationHierarchyRel 
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByPeriod
				related.ReconciliationManagementGroup							= ReconciliationManagementGroup
				related.ReconciliationAccountStructure  						= ReconciliationAccountStructure
			Instance Selection
				where (related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration = GeneralLedgerCloseConfiguration
				and	   related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod = GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod)
		
		OpenPeriodEndReconciliationHierarchyRel
			one-to-many relation using PeriodEndReconciliationHierarchyRel
			Instance Selection
				where (related.Status = 0)	
		
		InProcessPeriodEndReconciliationHierarchyRel
			one-to-many relation using PeriodEndReconciliationHierarchyRel
			Instance Selection
				where (related.Status = 1)	
		
		PendingApprovalPeriodEndReconciliationHierarchyRel
			one-to-many relation using PeriodEndReconciliationHierarchyRel
			Instance Selection
				where (related.Status = 3)	
				
		ClosedPeriodEndReconciliationHierarchyRel
			one-to-many relation using PeriodEndReconciliationHierarchyRel
			Instance Selection
				where (related.Status = 7)	
		
		ViewableByAuditorPeriodEndReconciliationHierarchyRel
			one-to-many relation using PeriodEndReconciliationHierarchyRel
			Instance Selection
				where (related.Status.Closed
				and    related.ViewableByAuditor)
					
		OpenByStructureRel
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByStatus
				related.ReconciliationManagementGroup													= ReconciliationManagementGroup
				related.ReconciliationAccountStructure  												= ReconciliationAccountStructure
				related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration 						= GeneralLedgerCloseConfiguration
				related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod	= GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
				related.Status																			= 0	
			Instance Selection
				where (!related.ParentPeriodEndReconciliation.ReconciliationAccount entered	
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerCloseConfiguration entered
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod entered
				and    !related.ParentPeriodEndReconciliation.SequenceNumber entered)		

		InProcessByStructureRel
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByStatus
				related.ReconciliationManagementGroup													= ReconciliationManagementGroup
				related.ReconciliationAccountStructure  												= ReconciliationAccountStructure
				related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration 						= GeneralLedgerCloseConfiguration
				related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod	= GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
				related.Status																			= 1 
			Instance Selection
				where (!related.ParentPeriodEndReconciliation.ReconciliationAccount entered	
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerCloseConfiguration entered
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod entered
				and    !related.ParentPeriodEndReconciliation.SequenceNumber entered)		
				
		PendingApprovalByStructureRel
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByStatus
				related.ReconciliationManagementGroup													= ReconciliationManagementGroup
				related.ReconciliationAccountStructure  												= ReconciliationAccountStructure
				related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration 						= GeneralLedgerCloseConfiguration
				related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod	= GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
				related.Status																			= 3 
			Instance Selection
				where (!related.ParentPeriodEndReconciliation.ReconciliationAccount entered 
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerCloseConfiguration entered
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod entered
				and    !related.ParentPeriodEndReconciliation.SequenceNumber entered)		
				
		ClosedByStructureRel
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByStatus
				related.ReconciliationManagementGroup													= ReconciliationManagementGroup
				related.ReconciliationAccountStructure  												= ReconciliationAccountStructure
				related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration 						= GeneralLedgerCloseConfiguration
				related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod	= GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
				related.Status																			= 7 
			Instance Selection
				where (!related.ParentPeriodEndReconciliation.ReconciliationAccount entered 
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerCloseConfiguration entered
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod entered
				and    !related.ParentPeriodEndReconciliation.SequenceNumber entered)		
		
		TotalByStructureRel
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByStatus
				related.ReconciliationManagementGroup													= ReconciliationManagementGroup
				related.ReconciliationAccountStructure  												= ReconciliationAccountStructure
				related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration 						= GeneralLedgerCloseConfiguration
				related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod	= GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
			Instance Selection
				where (!related.ParentPeriodEndReconciliation.ReconciliationAccount entered 
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerCloseConfiguration entered
				and    !related.ParentPeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod entered
				and    !related.ParentPeriodEndReconciliation.SequenceNumber entered)		
		
		PeriodReconciliationGroupRel
			one-to-many relation to PeriodEndReconciliation
			Field Mapping uses ByLevelType
				related.ReconciliationManagementGroup  													= ReconciliationManagementGroup
				related.ReconciliationAccountStructure 													= ReconciliationAccountStructure
				related.LevelType					   													= 1 
				related.PeriodEndReconciliation.GeneralLedgerCloseConfiguration 						= GeneralLedgerCloseConfiguration
				related.PeriodEndReconciliation.GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod	= GeneralLedgerClosePeriod.GeneralLedgerCalendarPeriod
			Instance Selection
				where (related.Status < 7) 
							
	Field Rules
		PercentCompleteStatus
			if (PercentComplete <= .25)
				PercentCompleteStatus = 1
			if (PercentComplete	> .25
			and PercentComplete <= .50)
				PercentCompleteStatus = 2
			if (PercentComplete	> .50
			and PercentComplete <= .75)
				PercentCompleteStatus = 3
			if (PercentComplete	> .75
			and PercentComplete < 1)
				PercentCompleteStatus = 4
			if (PercentComplete	= 1)
				PercentCompleteStatus = 5
	
	Actions
		Create is a Create Action
										
		Update is an Update Action
			
		Delete is a Delete Action
			valid when (!ReconciliationsExistForPeriod)
