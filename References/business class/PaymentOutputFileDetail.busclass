PaymentOutputFileDetail is a BusinessClass
    owned by cb
    prefix is POFD

    Ontology
        symbolic key is PaymentOutputFileDetail

    Patterns
        implements StaticJava
        disable AuditIndex
		implements InlineUserFields
			size is 1000

    Persistent Fields
    	CashCode
    	RoutingNumber						is Alpha 35
        BankAccountCurrency 			    is a Currency
        BankCountry							is a Country

		BankClientIdentifier				is AlphaUpper 50
		CashLedgerTransactionIdentifier
        TransactionNumber
		GeneralLedgerSourceCode				is a GeneralLedgerEvent
			default label is "SourceCode"
		BankTransactionCode
		EffectiveDate						is Date
		PaymentDate							is Date
        PaymentAmount                       is an InternationalAmount
		PayBankCurrency						is a Currency

        PayBankAmount						is an InternationalAmount
		ApprovalCostCenter					is like AccountingUnit
        PaidName                            is a VendorName 
        	holds pii
        MailingName 	                    is a VendorName 
        	holds pii
        PayeePostalAddress                  is a PostalAddressV2	
        	holds pii
        	sql prefix is PYRPA


        PayBankAccountNumber				is a BankAccountNumber
        ElectronicPaymentCode
		FirstPartyReference					is Alpha 12
		SecondPartyReference				is Alpha 12
		PayorName							is a Name	 
			holds pii
		PayorPostalAddress				    is a PostalAddressV2	
			holds pii
		PayBankName							is a BankName

        PayBankPostalAddress				is a PostalAddressV2	
        	holds pii
		CrossBorderIdentifier
		PayBankEntity						is a BankEntity
		SwiftID
		InternationalBankAccountNumber 
			holds pii
		ChargeCode							is a CashLedgerChargeCode






		BankToBankInformation				is Alpha 140

		IntermediaryBankName				is a BankName

        IntermediaryBankPostalAddress		is a PostalAddressV2	
        	holds pii
        IntermediaryCrossBorderIdentifier	is a CrossBorderIdentifier
        IntermediaryBankEntity				is a BankEntity
        IntermediarySwiftID					is a SwiftID



        LanguageCode						is an IsoLocale
		NormalOrExpressCode

        InvoiceVendor                       is like Vendor
        InvoiceVendorName                   is a VendorName 
        	holds pii
		InvoiceVendorEmailAddress			is an EmailAddressMulti 
			holds pii
		PaidVendor                          is like Vendor
		Invoice								is an InvoiceNum
        PaymentComment                      is a CommentText
		TransactionData1					is a BankInstruct1	
		TransactionData2					is a BankInstruct2	
		TransactionData3					is a BankInstruct3	
		TransactionData4					is a BankInstruct4	
		PayBankAccountType					is like BankAccountType
		PayGlobalBankAccountType			is like GlobalBankAccountType	
		PayBankTypeDescription				is like Description	  
		PaymentIDMUniqueId					is an IDMPID
			restricted
			protected
		SupplementaryIDMUniqueId			is an IDMPID	
			restricted
			protected
		VendorGroupOutput					is like VendorGroup		
			default label is "VendorGroup"
		IDMEmailSent						is Boolean
			default label is "EmailSentForRemittanceAdvice"
		IDMJob
			protected
			delete ignored
		VATSplitAmount						is an InternationalAmount		
		SupplementaryIDMJob					is like IDMJob
			protected
		VendorBankCode1						is a VendorBankCode150	
		VendorBankCode2						is a VendorBankCode		
		VendorBankCode3						is a VendorBankCode		
		VendorBankCode4						is a VendorBankCode		
		VendorBankCode5						is a VendorBankCode		
		VendorBankCode6						is a VendorBankCode		
		VendorBankCode7						is a VendorBankCode		
		VendorBankCode8						is a VendorBankCode		
		VendorBankCode9						is a VendorBankCode		
		VendorBankCode10					is a VendorBankCode		
		VendorBankCode11					is a VendorBankCode		
		VendorBankCode12					is a VendorBankCode		
		VendorBankCode13					is a VendorBankCode		
		VendorBankCode14					is a VendorBankCode		
		VendorBankCode15					is a VendorBankCode		
		VendorBankCode16					is a VendorBankCode		
		VendorBankCode17					is a VendorBankCode		
		VendorBankCode18					is a VendorBankCode		
		VendorBankCode19					is a VendorBankCode		
		VendorBankCode20					is a VendorBankCode		
		EmailAddress											   	
		MobileNumber						is a TelephoneNumber	
		PayablesCompany						is like PayablesCompany	
		PayablesInvoice						is like PayablesInvoice	
		IDMXMLFile							is an Attachment
		CheckPrinted 						is Boolean
			protected
		VendorAccount 						is like VendorAccount
		VendorContactName					is like VendorName	
		NetPaymentAmountTotal				is an InternationalAmount
		PaymentAmountTotal					is an InternationalAmount
		DiscountAmountTotal					is an InternationalAmount
		WithholdingAmountTotal				is an InternationalAmount
		IDMPaymentPrintJob					is like IDMJob
			protected
		IDMRemittancePrintJob				is like IDMJob
			protected

	Transient Fields
		TransientAmountInRight				is AlphaRight size 19
			derive value from PaymentAmount
		TransientEmailFrom					is an EmailAddress			

	Rule Blocks
		BatchCheckPrint
			invoke BatchDocumentPrint IDMJob
				invoked.PrmIDMUniqueIDs   = LocalCheckIDMUniqueIDs
				invoked.PrmPrinter     	  = LocalPaymentPrinter
				invoked.PrmPrinterSettings 	= PaymentOutputFileHeader.CashPaymentFormatRel.PaymentPrinterSetting
				invoked.PrmDocumentType   = "FSM_PayablesPaymentOutput"
				invoked.PrmFileName		  = DerivedBatchPaymentOutputFilename
				invoked.PrmDescription 	  = PayablesPaymentOutputBatchPrintMsg
				invoked.PrmAdditionalDetails = LocalCheckNumbers
		
		BatchRemittancePrint
			invoke BatchDocumentPrint IDMJob
				invoked.PrmIDMUniqueIDs   = LocalRemittanceIDMUniqueIDs
				invoked.PrmPrinter     	  = LocalSupplementaryPrinter
				invoked.PrmPrinterSettings 	= PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryPrinterSetting
				invoked.PrmDocumentType   = "FSM_PayablesPaymentOutput"
				invoked.PrmFileName       = DerivedBatchSupplementaryOutputFilename
				invoked.PrmDescription 	  = SupplementaryOutputBatchPrintMsg
				invoked.PrmAdditionalDetails = LocalCheckNumbers
	
		SetCheckVersionAttributes
			initialize IDMAttributes
			IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName   = "CashCode"
			IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue  = CashCode
			IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeName   = "BankTransactionCode"
			IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeValue  = BankTransactionCode
			IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeName   = "BankTransactionCodeDescription"
			IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeValue  = BankTransactionCode.Description
			IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeName   = "TransactionNumber"
			IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeValue  = TransactionNumber
			IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeName	 = "Status"
			IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeValue	 = "Printed"
								
			IDMGenerateDocument.IDMAttributes			= IDMAttributes		
			IDMGenerateDocument.IDMAccessControlList 	= "CSFDefined"										
			IDMGenerateDocument.TemplateUniqueId		= PaymentOutputFileHeader.CashPaymentFormatRel.CheckVersionTemplate.IDMUniqueId
			IDMGenerateDocument.DocumentType			= "FSM_PayablesPaymentOutput"
			IDMGenerateDocument.FileName				= DerivedPaymentOutputFilename

		SetIDMXMLDefinition
			initialize IDMGenerateDocument
			initialize IDMXMLDefinition
			
			IDMGenerateDocument.IDMXMLDefinition.Busclass										 = reference to this instance
			IDMGenerateDocument.IDMXMLDefinition.ListName										 = "PaymentFileDetailListForIDMDoc"
			IDMGenerateDocument.IDMXMLDefinition.DocumentName									 = "PayablesPayment"
			
			if (PaymentOutputFileHeader.CashPaymentFormatRel.RemittanceOption.AlwaysAttached)
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].RelationName	 = "PaymentOutputFileRemittanceRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListName		 = "PaymentFileRemittanceDetailListForIDMDoc"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].LevelSection1 = 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListTag		 = "RemittanceDetails"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ItemTag		 = "RemittanceDetail"

				if (PaymentOutputFileHeader.CashPaymentFormatRel.ExcludeDistributionOnRemittance = false)
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].RelationName	 = "PayablesInvoiceDistributionRel"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListName 	 = "PayablesInvoiceDistributionForIDMList"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection1 = 1
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection2 = 1
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListTag		 = "DistributionLines"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ItemTag		 = "DistributionLine"				
				
			else
			if (PaymentOutputFileHeader.CashPaymentFormatRel.RemittanceOption.OverflowDocument)
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].RelationName  = "PaymentOutputFileRemittanceLinesRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListName		 = "PaymentFileRemittanceDetailListForIDMDoc"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].LevelSection1 = 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListTag		 = "RemittanceDetails"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ItemTag		 = "RemittanceDetail"
				
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].RelationName	 = "OverFlowOrSeparateRemittanceLinesRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListName		 = "PaymentFileRemittanceDetailListForIDMDoc"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection1 = 2
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListTag		 = "OverFlowOrSeparateRemittanceDetails"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ItemTag		 = "OverFlowOrSeparateRemittanceDetail"			
			
				if (PaymentOutputFileHeader.CashPaymentFormatRel.ExcludeDistributionOnRemittance = false)
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].RelationName	 = "PayablesInvoiceDistributionRel"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ListName 	 = "PayablesInvoiceDistributionForIDMList"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].LevelSection1 = 1
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].LevelSection2 = 1
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ListTag		 = "DistributionLines"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ItemTag		 = "DistributionLine"				

					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].RelationName	 = "PayablesInvoiceDistributionRel"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ListName 	 = "PayablesInvoiceDistributionForIDMList"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].LevelSection1 = 2
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].LevelSection2 = 1
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ListTag		 = "DistributionLines"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ItemTag		 = "DistributionLine"
					
			else
			if (PaymentOutputFileHeader.CashPaymentFormatRel.RemittanceOption.SeparateRemittance)
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].RelationName	 = "OverFlowOrSeparateRemittanceLinesRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListName		 = "PaymentFileRemittanceDetailListForIDMDoc"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].LevelSection1 = 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListTag		 = "OverFlowOrSeparateRemittanceDetails"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ItemTag		 = "OverFlowOrSeparateRemittanceDetail"

				if (PaymentOutputFileHeader.CashPaymentFormatRel.ExcludeDistributionOnRemittance = false)
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].RelationName	 = "PayablesInvoiceDistributionRel"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListName 	 = "PayablesInvoiceDistributionForIDMList"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection1 = 1
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection2 = 1
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListTag		 = "DistributionLines"
				    IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ItemTag		 = "DistributionLine"
			
			if (LocalGenerateXMLFile)
				IDMXMLDefinition 				= IDMGenerateDocument.IDMXMLDefinition
				IDMXMLDefinition.OutputFileName	= "PaymentOutputFile_" + PaymentOutputFileDetail + "_" + TransactionNumber + "_" + DerivedCurrentTimestamp + ".xml"
				
    Derived Fields

		DerivedIntelligentMailBarCode is a StringField
			type is Alpha size 31
			PaymentOutputFileHeader.CashPaymentFormatRel.BarcodeID
			PaymentOutputFileHeader.CashPaymentFormatRel.ServiceTypeID
			DerivedMailerIDAndSerial
			DerivedRoutingCode

		DerivedMailerIDAndSerial is a DerivedField
			type is Alpha size 15
			restricted
			if (PaymentOutputFileHeader.CashPaymentFormatRel.IntelligentMailBarcode.SixDigitMailerIdentifier)
				return (PaymentOutputFileHeader.CashPaymentFormatRel.TransientSixDigitMailerID + DerivedNineDigitSerialNumber)
			else
			if (PaymentOutputFileHeader.CashPaymentFormatRel.IntelligentMailBarcode.NineDigitMailerIdentifier)
				return (PaymentOutputFileHeader.CashPaymentFormatRel.TransientNineDigitMailerID + DerivedSixDigitSerialNumber)

		DerivedRoutingCode is a DerivedField
			type is Alpha size 11
			restricted
			LocalPostalCodeSize = VendorRel.VendorAddress.PostalCode size
			LocalPostalCode		= VendorRel.VendorAddress.PostalCode
			initialize LocalRoutingCode
			initialize LocalCounter
			LocalCounter = 1
			if (LocalPostalCodeSize > 0)
				while (LocalCounter <= LocalPostalCodeSize)
					if (LocalPostalCode[LocalCounter] is numeric)
						LocalRoutingCode += LocalPostalCode[LocalCounter]
					LocalCounter += 1	

				if (LocalRoutingCode size = 5
				or  LocalRoutingCode size = 9
				or  LocalRoutingCode size = 11)
					return LocalRoutingCode
			return blank

		DerivedTransactionIdentifierAlphaRight is a DerivedField
			type is AlphaRight 9
			restricted
			return CashLedgerTransactionIdentifier[2:10]

		DerivedSixDigitSerialNumber			 			is a DerivedField
			type is Alpha size 6
			restricted
			return com.lawson.apps.procurement.base.StringUtils.leadingZeros(DerivedTransactionIdentifierAlphaRight[4:9])				

		DerivedNineDigitSerialNumber			 			is a DerivedField
			type is Alpha size 9
			restricted
			return com.lawson.apps.procurement.base.StringUtils.leadingZeros(DerivedTransactionIdentifierAlphaRight)

		Print2ndSignature is a DerivedField
			type is Boolean
			if (PaymentAmount >= PaymentOutputFileHeader.CashPaymentFormatRel.SignatureThresholdAmount)
				return true
			else
				return false

		DerivedBankAccountType  is a DerivedField
            type is AlphaUpper size 2
            if (PayBankAccountType.Checking)
                return "C"
            else
            if (PayBankAccountType.Savings)
                return "S"
            else
            if (PayBankAccountType.IBAN)	
                return "I"
            else
            if (PayBankAccountType.Futsuu)
                return "01"
            else
            if (PayBankAccountType.Touza)
                return "02"
            else
            if (PayBankAccountType.Chochiku)
                return "03"
            else
            if (PayBankAccountType.Sonota)
                return "04"
            else
            if (PayBankAccountType.Other)
                return "99"
            else
                return "" 
                
		UnformattedComment is a NativeField
			type is Text
			restricted
			
		DerivedRemoveAfter is a StringField								
			type is Alpha up to 30
            restricted
			"\Q"
			"using"
			"\E"
			".*$"
		
		DerivedRemoveString is a StringField							
			type is Alpha up to 30
            restricted
			"\Q"
			"using"
			"\E"

		DoubleQuote is a StringField
            type is Alpha 2048
            restricted
            "\""

		DerivedDelimiter is a DerivedField
			type is Alpha 1
			if (PaymentOutputFileHeader.PaymentOutputMapping entered)
				return PaymentOutputFileHeader.PaymentOutputMapping.Delimiter

		DerivedLikeDelimiter is a DerivedField
			type is Alpha 3
			restricted
			if (PaymentOutputFileHeader.PaymentOutputMapping entered)
				return "*" + DerivedDelimiter + "*"

		DerivedCsvHeader is a DerivedField
            type is Text
            restricted
            if (PaymentOutputFileHeader.PaymentOutputMapping entered)
            	return CustomCsvHeader
            else
            	return CsvHeader
		
		CustomCsvHeader is a DerivedField
            type is Text
            restricted
            if (PaymentOutputFileHeader.PaymentOutputMapping entered)
	        	initialize LocalCustomCsvHeader
	        	LastPaymentOutputMappingDetail = PaymentOutputFileHeader.PaymentOutputMapping.last PaymentOutputMappingDetailRel.PaymentOutputMappingDetail
	        	for each PaymentOutputFileHeader.PaymentOutputMapping.PaymentOutputMappingDetailRel
					if (each.MappingType.Field)
						if (each.OverrideFieldName entered)
							LocalFieldName = each.OverrideFieldName
						else
							LocalFieldName = each.Field
							LocalFieldName -= DerivedRemoveAfter					
							LocalFieldName -= DerivedRemoveString					
					else
					if (each.MappingType.Literal)
						LocalFieldName = each.LiteralName
					else
					if (each.MappingType.Blank)
						LocalFieldName = each.BlankName

					if (PaymentOutputFileHeader.PaymentOutputMapping.RemoveQuotes)
						if (LocalFieldName like DerivedLikeDelimiter)
							LocalContainsDelimiterValue = true
						if (LocalContainsDelimiterValue)
							if (each.PaymentOutputMappingDetail = LastPaymentOutputMappingDetail)
								LocalCustomCsvHeader += DoubleQuote + LocalFieldName + DoubleQuote
							else
								LocalCustomCsvHeader += DoubleQuote + LocalFieldName + DoubleQuote + DerivedDelimiter 	
						else
						if (each.PaymentOutputMappingDetail = LastPaymentOutputMappingDetail)
							LocalCustomCsvHeader += LocalFieldName
						else
							LocalCustomCsvHeader += LocalFieldName + DerivedDelimiter
					else	
						if (each.PaymentOutputMappingDetail = LastPaymentOutputMappingDetail)
							LocalCustomCsvHeader += DoubleQuote + LocalFieldName + DoubleQuote
						else
							LocalCustomCsvHeader += DoubleQuote + LocalFieldName + DoubleQuote + DerivedDelimiter
					initialize LocalContainsDelimiterValue

				return LocalCustomCsvHeader
		
		CsvHeader is a StringField 
            type is Text
            restricted
			DoubleQuote
			CashCode label
			DoubleQuote
			","
			DoubleQuote
			RoutingNumber label
			DoubleQuote
			","
			DoubleQuote
			CashManagementAccount label
			DoubleQuote
			","
			DoubleQuote
			BankAccountCurrency label
			DoubleQuote
			","
			DoubleQuote
			BankClientIdentifier label
			DoubleQuote
			","
			CashLedgerTransactionIdentifier label
			","
			DoubleQuote
			TransactionNumber label
			DoubleQuote
			","
			DoubleQuote
			GeneralLedgerSourceCode label
			DoubleQuote
			","
			DoubleQuote
			BankTransactionCode label
			DoubleQuote
			","
			EffectiveDate label
			","
			PaymentDate label
			","
			PaymentAmount label
			","
			DoubleQuote
			PayBankCurrency label
			DoubleQuote
			","
			PayBankAmount label
			","
			DoubleQuote
			ApprovalCostCenter label
			DoubleQuote
			","
			DoubleQuote
			PaidName label
			DoubleQuote
			","
			DoubleQuote
			MailingName label
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.DeliveryAddress.AddressLine1 label
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.DeliveryAddress.AddressLine2 label
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.DeliveryAddress.AddressLine3 label
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.DeliveryAddress.AddressLine4 label
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.Municipality label
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.StateProvince label
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.PostalCode label
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.Country label
			DoubleQuote
			","
			DoubleQuote
			PayBankAccountNumber label
			DoubleQuote
			","
			DoubleQuote
			ElectronicPaymentCode label
			DoubleQuote
			","
			DoubleQuote
			FirstPartyReference label
			DoubleQuote
			","
			DoubleQuote
			SecondPartyReference label
			DoubleQuote
			","
			DoubleQuote
			PayBankName label
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.DeliveryAddress.AddressLine1 label
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.DeliveryAddress.AddressLine2 label
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.DeliveryAddress.AddressLine3 label
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.DeliveryAddress.AddressLine4 label
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.Municipality label
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.StateProvince label
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.PostalCode label
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.Country label
			DoubleQuote
			","
			DoubleQuote
			CrossBorderIdentifier label
			DoubleQuote
			","
			DoubleQuote
			PayBankEntity label
			DoubleQuote
			","
			DoubleQuote
			SwiftID label
			DoubleQuote
			","
			DoubleQuote
			InternationalBankAccountNumber label
			DoubleQuote
			","
			DoubleQuote
			ChargeCode label
			DoubleQuote
			","
			DoubleQuote
			BankToBankInformation label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankName label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine1 label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine2 label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine3 label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine4 label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.Municipality label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.StateProvince label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.PostalCode label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.Country label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryCrossBorderIdentifier label
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankEntity label
			DoubleQuote
			","
			DoubleQuote
			IntermediarySwiftID label
			DoubleQuote
			","
			DoubleQuote
			LanguageCode label
			DoubleQuote
			","
			DoubleQuote
			NormalOrExpressCode label
			DoubleQuote
			","
			PaidVendor label
			","
			DoubleQuote
			Invoice label
			DoubleQuote
			","
			DoubleQuote
			UnformattedComment label
			DoubleQuote
			","
			DoubleQuote
			TransactionData1 label
			DoubleQuote
			","
			DoubleQuote
			TransactionData2 label
			DoubleQuote
			","
			DoubleQuote
			TransactionData3 label
			DoubleQuote
			","
			DoubleQuote
			TransactionData4 label
			DoubleQuote
			","
			DoubleQuote
        	InvoiceVendor label
			DoubleQuote
			","
			DoubleQuote
        	InvoiceVendorName label
			DoubleQuote
			","
			DoubleQuote
        	InvoiceVendorEmailAddress label
			DoubleQuote
			","
			DoubleQuote
			PayorName label
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.DeliveryAddress.AddressLine1 label
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.DeliveryAddress.AddressLine2 label
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.DeliveryAddress.AddressLine3 label
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.DeliveryAddress.AddressLine4 label
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.Municipality label
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.StateProvince label
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.PostalCode label
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.Country label
			DoubleQuote
			","
			DoubleQuote
			PayBankAccountType label
			DoubleQuote
			","
			DoubleQuote
			PayBankTypeDescription label
			DoubleQuote
			","
			DoubleQuote
			VendorGroupOutput label		
			DoubleQuote
			","
			DoubleQuote
			VATSplitAmount label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode1 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode2 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode3 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode4 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode5 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode6 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode7 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode8 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode9 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode10 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode11 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode12 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode13 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode14 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode15 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode16 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode17 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode18 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode19 label		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode20 label		
			DoubleQuote
			","
			DoubleQuote					
			EmailAddress label
			DoubleQuote
			","
			DoubleQuote					
			MobileNumber label
			DoubleQuote
			","
			DoubleQuote
			PayGlobalBankAccountType label	
			DoubleQuote
			
		CsvFieldNames is a StringField 
            type is Text
            restricted
			CashCode full name
			","
			RoutingNumber full name
			","
			CashManagementAccount full name
			","
			BankAccountCurrency full name
			","
			BankClientIdentifier full name
			","
			CashLedgerTransactionIdentifier full name
			","
			TransactionNumber full name
			","
			GeneralLedgerSourceCode full name
			","
			BankTransactionCode full name
			","
			EffectiveDate full name
			","
			PaymentDate full name
			","
			PaymentAmount full name
			","
			PayBankCurrency full name
			","
			PayBankAmount full name
			","
			ApprovalCostCenter full name
			","
			PaidName full name
			","
			MailingName full name
			","
			PayeePostalAddress.DeliveryAddress.AddressLine1 full name
			","
			PayeePostalAddress.DeliveryAddress.AddressLine2 full name
			","
			PayeePostalAddress.DeliveryAddress.AddressLine3 full name
			","
			PayeePostalAddress.DeliveryAddress.AddressLine4 full name
			","
			PayeePostalAddress.Municipality full name
			","
			PayeePostalAddress.StateProvince full name
			","
			PayeePostalAddress.PostalCode full name
			","
			PayeePostalAddress.Country full name
			","
			PayBankAccountNumber full name
			","
			ElectronicPaymentCode full name
			","
			FirstPartyReference full name
			","
			SecondPartyReference full name
			","
			PayBankName full name
			","
			PayBankPostalAddress.DeliveryAddress.AddressLine1 full name
			","
			PayBankPostalAddress.DeliveryAddress.AddressLine2 full name
			","
			PayBankPostalAddress.DeliveryAddress.AddressLine3 full name
			","
			PayBankPostalAddress.DeliveryAddress.AddressLine4 full name
			","
			PayBankPostalAddress.Municipality full name
			","
			PayBankPostalAddress.StateProvince full name
			","
			PayBankPostalAddress.PostalCode full name
			","
			PayBankPostalAddress.Country full name
			","
			CrossBorderIdentifier full name
			","
			PayBankEntity full name
			","
			SwiftID full name
			","
			InternationalBankAccountNumber full name
			","
			ChargeCode full name
			","
			BankToBankInformation full name
			","
			IntermediaryBankName full name
			","
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine1 full name
			","
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine2 full name
			","
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine3 full name
			","
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine4 full name
			","
			IntermediaryBankPostalAddress.Municipality full name
			","
			IntermediaryBankPostalAddress.StateProvince full name
			","
			IntermediaryBankPostalAddress.PostalCode full name
			","
			IntermediaryBankPostalAddress.Country full name
			","
			IntermediaryCrossBorderIdentifier full name
			","
			IntermediaryBankEntity full name
			","
			IntermediarySwiftID full name
			","
			LanguageCode full name
			","
			NormalOrExpressCode full name
			","
			PaidVendor full name
			","
			Invoice full name
			","
			UnformattedComment full name
			","
			TransactionData1 full name
			","
			TransactionData2 full name
			","
			TransactionData3 full name
			","
			TransactionData4 full name
			","
        	InvoiceVendor full name
			","
        	InvoiceVendorName full name
			","
        	InvoiceVendorEmailAddress full name
			","
			PayorName full name
			","
			PayorPostalAddress.DeliveryAddress.AddressLine1 full name
			","
			PayorPostalAddress.DeliveryAddress.AddressLine2 full name
			","
			PayorPostalAddress.DeliveryAddress.AddressLine3 full name
			","
			PayorPostalAddress.DeliveryAddress.AddressLine4 full name
			","
			PayorPostalAddress.Municipality full name
			","
			PayorPostalAddress.StateProvince full name
			","
			PayorPostalAddress.PostalCode full name
			","
			PayorPostalAddress.Country full name
			","
			PayBankAccountType full name
			","
			PayBankTypeDescription full name
			","
			VendorGroupOutput full name
			","
			VATSplitAmount full name
			","
			VendorBankCode1 full name
			","
			VendorBankCode2 full name
			","
			VendorBankCode3 full name
			","
			VendorBankCode4 full name
			","
			VendorBankCode5 full name
			","
			VendorBankCode6 full name
			","
			VendorBankCode7 full name
			","
			VendorBankCode8 full name
			","
			VendorBankCode9 full name
			","
			VendorBankCode10 full name
			","
			VendorBankCode11 full name
			","
			VendorBankCode12 full name
			","
			VendorBankCode13 full name
			","
			VendorBankCode14 full name
			","
			VendorBankCode15 full name
			","
			VendorBankCode16 full name
			","
			VendorBankCode17 full name
			","
			VendorBankCode18 full name
			","
			VendorBankCode19 full name
			","
			VendorBankCode20 full name
			","
			EmailAddress full name
			","
			MobileNumber full name
			","
			PayGlobalBankAccountType full name	
			
		PaymentAmountNumberOfDecimals is a StringField
            type is Alpha 4
			"%."
			BankAccountCurrency.NumberOfDecimals
			"f"
			
		PayBankAmountNumberOfDecimals is a StringField
            type is Alpha 4
			"%."
			PayBankCurrency.NumberOfDecimals
			"f"
		
		DerivedCsvOutput is a DerivedField
            type is Text
            restricted
            if (PaymentOutputFileHeader.PaymentOutputMapping entered)
            	return CustomCsvOutput
            else
            	return CsvOutput
            	
		CustomCsvOutput is a DerivedField
            type is Text
            holds pii
            restricted
            if (PaymentOutputFileHeader.PaymentOutputMapping entered)
	        	initialize LocalCustomCsvOutput
	        	LastPaymentOutputMappingDetail = PaymentOutputFileHeader.PaymentOutputMapping.last PaymentOutputMappingDetailRel.PaymentOutputMappingDetail
	        	for each PaymentOutputFileHeader.PaymentOutputMapping.PaymentOutputMappingDetailRel
					if (each.MappingType.Field)
						LocalOutputField = each.Field
						LocalFieldValue = LocalOutputField compute value
					else
					if (each.MappingType.Literal)
						LocalFieldValue = each.LiteralValue
					else
					if (each.MappingType.Blank)
						LocalFieldValue = ""

					if (PaymentOutputFileHeader.PaymentOutputMapping.RemoveQuotes)
						if (LocalFieldValue like DerivedLikeDelimiter)
							LocalContainsDelimiterValue = true
						if (LocalContainsDelimiterValue)
							if (each.PaymentOutputMappingDetail = LastPaymentOutputMappingDetail)
								LocalCustomCsvOutput += DoubleQuote + LocalFieldValue + DoubleQuote
							else
								LocalCustomCsvOutput += DoubleQuote + LocalFieldValue + DoubleQuote + DerivedDelimiter 	
						else
						if (each.PaymentOutputMappingDetail = LastPaymentOutputMappingDetail)
							LocalCustomCsvOutput += LocalFieldValue
						else
							LocalCustomCsvOutput += LocalFieldValue + DerivedDelimiter
					else	
						if (each.PaymentOutputMappingDetail = LastPaymentOutputMappingDetail)
							LocalCustomCsvOutput += DoubleQuote + LocalFieldValue + DoubleQuote
						else
							LocalCustomCsvOutput += DoubleQuote + LocalFieldValue + DoubleQuote + DerivedDelimiter
					initialize LocalContainsDelimiterValue

				return LocalCustomCsvOutput
				
        CsvOutput is a StringField 
            type is Text
			holds pii
            restricted
			DoubleQuote
			CashCode
			DoubleQuote
			","
			DoubleQuote
			RoutingNumber
			DoubleQuote
			","
			DoubleQuote
			CashManagementAccount
			DoubleQuote
			","
			DoubleQuote
			BankAccountCurrency
			DoubleQuote
			","
			DoubleQuote
			BankClientIdentifier
			DoubleQuote
			","
			CashLedgerTransactionIdentifier
			","
			DoubleQuote
			TransactionNumber
			DoubleQuote
			","
			DoubleQuote
			GeneralLedgerSourceCode
			DoubleQuote
			","
			DoubleQuote
			BankTransactionCode
			DoubleQuote
			","
			EffectiveDate
			","
			PaymentDate
			","
			PaymentAmount using "<PaymentAmountNumberOfDecimals>"
			","
			DoubleQuote
			PayBankCurrency
			DoubleQuote
			","
			PayBankAmount using "<PayBankAmountNumberOfDecimals>"
			","
			DoubleQuote
			ApprovalCostCenter
			DoubleQuote
			","
			DoubleQuote
			PaidName
			DoubleQuote
			","
			DoubleQuote
			MailingName
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			PayeePostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			PayBankAccountNumber
			DoubleQuote
			","
			DoubleQuote
			ElectronicPaymentCode
			DoubleQuote
			","
			DoubleQuote
			FirstPartyReference
			DoubleQuote
			","
			DoubleQuote
			SecondPartyReference
			DoubleQuote
			","
			DoubleQuote
			PayBankName
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			PayBankPostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			CrossBorderIdentifier
			DoubleQuote
			","
			DoubleQuote
			PayBankEntity
			DoubleQuote
			","
			DoubleQuote
			SwiftID
			DoubleQuote
			","
			DoubleQuote
			InternationalBankAccountNumber
			DoubleQuote
			","
			DoubleQuote
			ChargeCode
			DoubleQuote
			","
			DoubleQuote
			BankToBankInformation
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankName
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			IntermediaryCrossBorderIdentifier
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankEntity
			DoubleQuote
			","
			DoubleQuote
			IntermediarySwiftID
			DoubleQuote
			","
			DoubleQuote
			LanguageCode
			DoubleQuote
			","
			DoubleQuote
			NormalOrExpressCode
			DoubleQuote
			","
			PaidVendor
			","
			DoubleQuote
			Invoice
			DoubleQuote
			","
			DoubleQuote
			UnformattedComment
			DoubleQuote
			","
			DoubleQuote
			TransactionData1
			DoubleQuote
			","
			DoubleQuote
			TransactionData2
			DoubleQuote
			","
			DoubleQuote
			TransactionData3
			DoubleQuote
			","
			DoubleQuote
			TransactionData4
			DoubleQuote
			","
			DoubleQuote
        	InvoiceVendor
			DoubleQuote
			","
			DoubleQuote
        	InvoiceVendorName
			DoubleQuote
			","
			DoubleQuote
        	InvoiceVendorEmailAddress 
			DoubleQuote
			","
			DoubleQuote
			PayorName
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			PayorPostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			PayBankAccountType 
			DoubleQuote
			","
			DoubleQuote
			PayBankTypeDescription 
			DoubleQuote
			","
			DoubleQuote
			VendorGroupOutput		
			DoubleQuote
			","
			DoubleQuote
			VATSplitAmount using "<PaymentAmountNumberOfDecimals>"		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode1		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode2		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode3		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode4		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode5		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode6		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode7		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode8		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode9		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode10		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode11		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode12		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode13		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode14		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode15		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode16		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode17		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode18		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode19		
			DoubleQuote
			","
			DoubleQuote
			VendorBankCode20		
			DoubleQuote
			","
			DoubleQuote				
			EmailAddress
			DoubleQuote
			","
			DoubleQuote				
			MobileNumber
			DoubleQuote
			","
			DoubleQuote
			PayGlobalBankAccountType	
			DoubleQuote
			
		PipeOutput is a DerivedField					
            type is Text
            restricted
            if (PaymentOutputFileHeader.PaymentOutputMapping entered)
            	return CustomPipeOutput
            else
            	return StandardPipeOutput
            	
		CustomPipeOutput is a DerivedField				
            type is Text
            holds pii
            restricted
            if (PaymentOutputFileHeader.PaymentOutputMapping entered)
	        	initialize LocalCustomCsvOutput
	        	LastPaymentOutputMappingDetail = PaymentOutputFileHeader.PaymentOutputMapping.last PaymentOutputMappingDetailRel.PaymentOutputMappingDetail
	        	for each PaymentOutputFileHeader.PaymentOutputMapping.PaymentOutputMappingDetailRel
					if (each.MappingType.Field)
						LocalOutputField = each.Field
						LocalFieldValue = LocalOutputField compute value
					else
					if (each.MappingType.Literal)
						LocalFieldValue = each.LiteralValue
					else
					if (each.MappingType.Blank)
						LocalFieldValue = ""

					if (each.PaymentOutputMappingDetail = LastPaymentOutputMappingDetail)
						LocalCustomCsvOutput += LocalFieldValue
					else
						LocalCustomCsvOutput += LocalFieldValue + "|"
				return LocalCustomCsvOutput

        StandardPipeOutput        is a StringField		
            type is Text
			holds pii
            restricted
			CashCode
			"|"
			RoutingNumber
			"|"
			CashManagementAccount
			"|"
			BankAccountCurrency
			"|"
			BankClientIdentifier
			"|"
			CashLedgerTransactionIdentifier
			"|"
			TransactionNumber
			"|"
			GeneralLedgerSourceCode
			"|"
			BankTransactionCode
			"|"
			EffectiveDate
			"|"
			PaymentDate
			"|"
			PaymentAmount using "<PaymentAmountNumberOfDecimals>"
			"|"
			PayBankCurrency
			"|"
			PayBankAmount using "<PayBankAmountNumberOfDecimals>"
			"|"
			ApprovalCostCenter
			"|"
			PaidName 
			"|"
			MailingName
			"|"
			PayeePostalAddress.DeliveryAddress.AddressLine1
			"|"
			PayeePostalAddress.DeliveryAddress.AddressLine2
			"|"
			PayeePostalAddress.DeliveryAddress.AddressLine3 
			"|"
			PayeePostalAddress.DeliveryAddress.AddressLine4 
			"|"
			PayeePostalAddress.Municipality 
			"|"
			PayeePostalAddress.StateProvince 
			"|"
			PayeePostalAddress.PostalCode 
			"|"
			PayeePostalAddress.Country 
			"|"
			PayBankAccountNumber 
			"|"
			ElectronicPaymentCode
			"|"
			FirstPartyReference 
			"|"
			SecondPartyReference 
			"|"
			PayBankName 
			"|"
			PayBankPostalAddress.DeliveryAddress.AddressLine1 
			"|"
			PayBankPostalAddress.DeliveryAddress.AddressLine2 
			"|"
			PayBankPostalAddress.DeliveryAddress.AddressLine3 
			"|"
			PayBankPostalAddress.DeliveryAddress.AddressLine4 
			"|"
			PayBankPostalAddress.Municipality 
			"|"
			PayBankPostalAddress.StateProvince 
			"|"
			PayBankPostalAddress.PostalCode 
			"|"
			PayBankPostalAddress.Country 
			"|"
			CrossBorderIdentifier
			"|"
			PayBankEntity
			"|"
			SwiftID
			"|"
			InternationalBankAccountNumber 
			"|"
			ChargeCode
			"|"
			BankToBankInformation
			"|"
			IntermediaryBankName 
			"|"
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine1 
			"|"
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine2 
			"|"
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine3 
			"|"
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine4 
			"|"
			IntermediaryBankPostalAddress.Municipality 
			"|"
			IntermediaryBankPostalAddress.StateProvince 
			"|"
			IntermediaryBankPostalAddress.PostalCode 
			"|"
			IntermediaryBankPostalAddress.Country 
			"|"
			IntermediaryCrossBorderIdentifier
			"|"
			IntermediaryBankEntity
			"|"
			IntermediarySwiftID
			"|"
			LanguageCode
			"|"
			NormalOrExpressCode
			"|"
			PaidVendor
			"|"
			Invoice
			"|"
			UnformattedComment
			"|"
			TransactionData1
			"|"
			TransactionData2
			"|"
			TransactionData3
			"|"
			TransactionData4
			"|"
        	InvoiceVendor
			"|"
        	InvoiceVendorName
			"|"
        	InvoiceVendorEmailAddress 
			"|"
			PayorName 
			"|"
			PayorPostalAddress.DeliveryAddress.AddressLine1 
			"|"
			PayorPostalAddress.DeliveryAddress.AddressLine2 
			"|"
			PayorPostalAddress.DeliveryAddress.AddressLine3 
			"|"
			PayorPostalAddress.DeliveryAddress.AddressLine4 
			"|"
			PayorPostalAddress.Municipality 
			"|"
			PayorPostalAddress.StateProvince 
			"|"
			PayorPostalAddress.PostalCode 
			"|"
			PayorPostalAddress.Country 
			"|"
			PayBankAccountType 
			"|"
			PayBankTypeDescription 
			"|"
			VendorGroupOutput		
			"|"
			VATSplitAmount using "<PaymentAmountNumberOfDecimals>"		
			"|"
			VendorBankCode1		
			"|"
			VendorBankCode2		
			"|"
			VendorBankCode3		
			"|"
			VendorBankCode4		
			"|"
			VendorBankCode5		
			"|"
			VendorBankCode6		
			"|"
			VendorBankCode7		
			"|"
			VendorBankCode8		
			"|"
			VendorBankCode9		
			"|"
			VendorBankCode10		
			"|"
			VendorBankCode11		
			"|"
			VendorBankCode12		
			"|"
			VendorBankCode13		
			"|"
			VendorBankCode14		
			"|"
			VendorBankCode15		
			"|"
			VendorBankCode16		
			"|"
			VendorBankCode17		
			"|"
			VendorBankCode18		
			"|"
			VendorBankCode19		
			"|"
			VendorBankCode20		
			"|"
			PayGlobalBankAccountType	
			
		TotalPaymentAmount	is a DerivedField
			type is like InternationalAmount
			if (PaymentAmountTotal entered)
				return PaymentAmountTotal
			return sum 	PaymentOutputFileRemittanceTotalRel.PaymentAmount

		TotalDiscountAmount	is a DerivedField
			type is like InternationalAmount
			if (DiscountAmountTotal entered)
				return DiscountAmountTotal
			return sum PaymentOutputFileRemittanceTotalRel.DiscountAmount

		TotalNetPaymentAmount	is a DerivedField
			type is like InternationalAmount
			if (NetPaymentAmountTotal entered)
				return NetPaymentAmountTotal
			return sum PaymentOutputFileRemittanceTotalRel.NetPaymentAmount		
				 
    	DerivedPaymentEmailSubject			is a StringField
    		type is Alpha 255
    		restricted
			PaymentOutputFileHeader.CashPaymentFormatRel.PaymentFilename  
			" "
			CashCode 
			" " 
			BankTransactionCode
			" "
			TransactionNumber

		DerivedBatchPaymentOutputFilename	is a StringField
			type is like IDMFileName
			restricted
			PaymentOutputFileHeader.CashPaymentFormatRel.PaymentFilename
			" "
			CashCode 
			" " 
			BankTransactionCode		

    	DerivedPaymentOutputFilename			is a StringField
    		type is like IDMFileName
    		restricted
			PaymentOutputFileHeader.CashPaymentFormatRel.PaymentFilename  
			" "
			CashCode 
			" " 
			BankTransactionCode
			" "
			TransactionNumber
			PaymentOutputFileHeader.CashPaymentFormatRel.PaymentTemplate.DerivedOutputFormat

    	DerivedSupplementaryEmailSubject	is a StringField
    		type is Alpha 255
			restricted
			PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryFilename 
			" "
			CashCode 
			" " 
			BankTransactionCode
			" "
			TransactionNumber

    	DerivedBatchSupplementaryOutputFilename	is a StringField
    		type is like IDMFileName
			restricted	
			PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryFilename  
			" "
			CashCode 
			" " 
			BankTransactionCode

    	DerivedDefaultSupplementaryOutputFilename			is a StringField
    		type is like IDMFileName
			restricted	
			PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryFilename 
			" "
			CashCode 
			" " 
			BankTransactionCode
			" "
			TransactionNumber
			PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryTemplate.DerivedOutputFormat
		
		DerivedSupplementaryOutputFilename					is a DerivedField
			type is like IDMFileName
			restricted
			if (PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryOutputFileName entered)
				return DerivedCashPaymentFormatSupplementaryOutputFileName + PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryTemplate.DerivedOutputFormat
			return DerivedDefaultSupplementaryOutputFilename
		
		DerivedCashPaymentFormatSupplementaryOutputFileName  is a DerivedField
			type is Alpha 255
			restricted
			LocalIDMEmailFileName = PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryOutputFileName
			return LocalIDMEmailFileName text
									
		PaymentInWords is a DerivedField
			type is Alpha 250

			if (PaymentOutputFileHeader.CashPaymentFormatRel.PaymentInWordsFormat entered)
				LocalIDMPaymentInWords = PaymentOutputFileHeader.CashPaymentFormatRel.PaymentInWordsFormat
				return LocalIDMPaymentInWords text
			else

				if (PaymentOutputFileHeader.CashPaymentFormatRel.SpanishCountries)
					AmountToTextTranslationSpanish.AmountArray  = TransientAmountInRight
					AmountToTextTranslationSpanish.IncludeCents = PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCents 
					AmountToTextTranslationSpanish.CentsFormat  = 0 
					return AmountToTextTranslationSpanish.AmountMessageField			
				else
					if (PaymentOutputFileHeader.CashPaymentFormatRel.CanadianFrench)
						AmountToTextTranslationFrench.AmountArray  = TransientAmountInRight
						AmountToTextTranslationFrench.IncludeCents = PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCents 
						AmountToTextTranslationFrench.CentsFormat  = 0 
						return AmountToTextTranslationFrench.AmountMessageField
					else

						AmountToTextTranslationEnglish.AmountArray  = TransientAmountInRight
						AmountToTextTranslationEnglish.IncludeCents = true
						AmountToTextTranslationEnglish.CentsFormat  = 0 
						return AmountToTextTranslationEnglish.AmountMessageField	
		
		AmountInWords is a DerivedField
			type is Alpha 250
			restricted		
			if (PaymentOutputFileHeader.CashPaymentFormatRel.SpanishCountries)
				AmountToTextTranslationSpanish.AmountArray  = TransientAmountInRight
				AmountToTextTranslationSpanish.IncludeCents = PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCents
				AmountToTextTranslationSpanish.CentsFormat  = 0 


				AmountToTextTranslationSpanish.IncludeCurrency = PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCurrency
				if (PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCurrency)
					AmountToTextTranslationSpanish.Currency	   = PaymentOutputFileHeader.CashPaymentFormatRel.Currency   
				return AmountToTextTranslationSpanish.AmountMessageField3
			else
				if (PaymentOutputFileHeader.CashPaymentFormatRel.CanadianFrench)
					AmountToTextTranslationFrench.AmountArray  = TransientAmountInRight
					AmountToTextTranslationFrench.IncludeCents = PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCents
					AmountToTextTranslationFrench.CentsFormat  = 0 


					AmountToTextTranslationFrench.IncludeCurrency = PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCurrency
					if (PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCurrency)
						AmountToTextTranslationFrench.Currency	   = PaymentOutputFileHeader.CashPaymentFormatRel.Currency   
					return AmountToTextTranslationFrench.AmountMessageField3
				else

					AmountToTextTranslationEnglish.AmountArray  = TransientAmountInRight
					AmountToTextTranslationEnglish.IncludeCents = PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCents
					AmountToTextTranslationEnglish.CentsFormat  = PaymentOutputFileHeader.CashPaymentFormatRel.CentsFormat
					AmountToTextTranslationEnglish.NumberOfDecimals = BankAccountCurrency.NumberOfDecimals
					if (PaymentOutputFileHeader.CashPaymentFormatRel.CentsFormat.WordWithMinorCurrency)
						AmountToTextTranslationEnglish.MinorCurrencyUnit = PaymentOutputFileHeader.CashPaymentFormatRel.MinorCurrencyUnit				
					AmountToTextTranslationEnglish.IncludeCurrency = PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCurrency
					if (PaymentOutputFileHeader.CashPaymentFormatRel.IncludeCurrency)
						AmountToTextTranslationEnglish.Currency	   = PaymentOutputFileHeader.CashPaymentFormatRel.Currency 
					return AmountToTextTranslationEnglish.AmountMessageField3	

		EmailNotificationMsg is a MessageField
			"<DerivedSupplementaryOutputFilename>WasSentToVendor<InvoiceVendor>-<InvoiceVendorName>"
		
		GeneratePayablesPaymentOutputMsg is a MessageField
			"GeneratePayablesPaymentOutput"

		PayablesPaymentOutputPrintMsg is a MessageField
			restricted
			"PayablesPaymentOutputPrint"

		PayablesPaymentOutputBatchPrintMsg is a MessageField
			"PayablesPaymentOutputBatchPrint:<LocalPrintedDocuments>Document(s)"

		SupplementaryOutputPrintMsg is a MessageField
			"SupplementaryOutputPrint"

		SupplementaryOutputBatchPrintMsg is a MessageField
			"SupplementaryOutputBatchPrint:<LocalPrintedDocuments>Document(s)"

		PaymentAttachedMsg is a MessageField
			restricted
			"PaymentAttached"

		RemittanceAdviceEmailBody is a MessageField
			restricted
			"RemittanceAdviceAttached"

		DerivedCashPaymentFormatSupplementaryEmailSubject	is a DerivedField
    		type is Alpha 255
    		restricted
			LocalIDMEmailSubject = PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryEmailSubject
			return LocalIDMEmailSubject text

		DerivedCashPaymentFormatCheckEmailSubject	is a DerivedField
    		type is Alpha 255
    		restricted
			LocalCheckIDMEmailSubject = PaymentOutputFileHeader.CashPaymentFormatRel.CheckEmailSubject
			return LocalCheckIDMEmailSubject text

		DerivedEmailCc			is a DerivedField 
			type is like MultipleEmailAddress 
			holds pii
			restricted
			initialize LocalIDMEmailCc
			
			if (PaymentOutputFileHeader.CashPaymentFormatRel.ExcludeFromEmailCc)
				initialize LocalIDMEmailCc
			else
				if (DerivedEmailFrom not = config.DefaultFromEmailAddress)
					LocalIDMEmailCc += DerivedEmailFrom
				
			for each VendorRel.VendorContactForIDMEmailRemittanceRel
				if (LocalIDMEmailCc entered)
					LocalIDMEmailCc += ", "
				LocalIDMEmailCc += each.EmailAddress
			return LocalIDMEmailCc	

		DerivedEmailCcForChecks		is a DerivedField 
			type is like MultipleEmailAddress
			holds pii
			restricted
			initialize LocalIDMEmailCc

			if (PaymentOutputFileHeader.CashPaymentFormatRel.ExcludeFromEmailCcChecks)
				initialize LocalIDMEmailCc
			else
				if (PaymentOutputFileHeader.CashPaymentFormatRel.PaymentFromEmail not = config.DefaultFromEmailAddress)
					LocalIDMEmailCc += PaymentOutputFileHeader.CashPaymentFormatRel.PaymentFromEmail			
				
			for each VendorRel.VendorContactForIDMEmailChecksRel
				if (LocalIDMEmailCc entered)
					LocalIDMEmailCc += ", "
				LocalIDMEmailCc += each.EmailAddress
			return LocalIDMEmailCc	

		DerivedEmailTo			is a DerivedField 
			type is like MultipleEmailAddress 
			holds pii
			restricted
			if (InvoiceVendorEmailAddress entered)
				return InvoiceVendorEmailAddress
			else
			if (VendorLocationEmailAddressExist)
				return first CashLedgerPayablesPaymentRel.RemitToCode.EmailAddress
			else
			if (VendorEmailAddressExist)
				return VendorRel.EmailAddress

		DerivedEmailFrom		is a DerivedField
			type is like EmailAddress 
			holds pii
			if ( PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryFromEmail entered)
				return PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryFromEmail
			else
			if (PayGroupRel.RemittanceAdviceFromEmailAddress entered)
				return PayGroupRel.RemittanceAdviceFromEmailAddress
			else
			if (VendorGroupRel.RemittanceAdviceFromEmailAddress entered)
				return VendorGroupRel.RemittanceAdviceFromEmailAddress
			else
				return config.DefaultFromEmailAddress
		
		AuxOnUsField is a DerivedField
			type is AlphaRight 18
			return MICRCheckNumber
			
		MICRCheckNumber			is a StringField
			type is Text
			"C"
			com.lawson.apps.procurement.base.StringUtils.trimLeadingSpaces(CheckNumberAlphaRight)
			"C"
			
		CheckNumberAlphaRight   is a DerivedField
			type is AlphaRight 22
			restricted
			return TransactionNumber

		TransitField	is a DerivedField
			type is Alpha 11
			return MICRRoutingNumber

		MICRRoutingNumber 		is a StringField
			type is Text
			"A"
			com.lawson.apps.procurement.base.StringUtils.trimLeadingSpaces(RoutingNumberAlphaRight)
			"A"

		RoutingNumberAlphaRight is a DerivedField
			type is AlphaRight 35
			restricted
			return RoutingNumber

		AccountOrOnUsField		is a DerivedField
			type is AlphaRight 14
			return MICRAccount	
		
		MICRAccount				is a StringField
			type is Text
			com.lawson.apps.procurement.base.StringUtils.trimLeadingSpaces(CashManagementAccountAlphaRight)
			"C"
		
		CashManagementAccountAlphaRight is a DerivedField
			type is AlphaRight 35
			restricted
			return CashManagementAccount

		DerivedIDMRemittanceLink is a DerivedField
			type is Alpha 2083
			restricted
			if (SupplementaryIDMUniqueId entered)
				IDMItem.DocumentType	= "FSM_PayablesPaymentOutput"
				IDMItem.IDMUniqueId		= SupplementaryIDMUniqueId 
				return IDMItem.GetLink
			return blank
		
		DerivedTotalWithholdingAmount is a DerivedField
            type is like InternationalAmount
			if (WithholdingAmountTotal entered)
				return WithholdingAmountTotal	
           	return sum PaymentOutputFileRemittanceTotalRel.DerivedWithholdingAmount
		
		DerivedIDMXml is a DerivedField
			type is Boolean
			if (not RetrievedIDMXML)
				LocalGenerateXMLFile = true
				include SetIDMXMLDefinition
				constraint (IDMXMLDefinition.GenerateXML)
					"ErrorOccuredInIDMXMLDefinition.GenerateXML"
				RetrievedIDMXML	= true
			return true
		
		DerivedCurrentTimestamp is a DerivedField
			type is Alpha size 12
			restricted
			return current timestamp

		DerivedIDMCheckLink is a DerivedField
			type is Alpha 2083
			restricted
    		if (PaymentIDMUniqueId entered) 
    			IDMItem.DocumentType	= "FSM_PayablesPaymentOutput"
    			IDMItem.IDMUniqueId		= PaymentIDMUniqueId 
	   			return IDMItem.GetLink
			return blank					

		DerivedNewLine is a DerivedField
			type is Alpha 6
			restricted
			return "\u000a"
				
	Local Fields
		AmountToTextTranslation
		AmountToTextTranslationSpanish
		AmountToTextTranslationEnglish
		AmountToTextTranslationFrench
		IDMGenerateDocument
		LocalPaymentFilename			is Alpha size 20		
		LocalSupplementaryFilename		is Alpha size 20						
		LocalPaymentTemplate			is an IDMTemplate
		LocalSupplemetaryTemplate		is an IDMTemplate
		LocalPaymentPrinter				is an IDMPrinter
		LocalSupplementaryPrinter		is an IDMPrinter
		LocalCheckIDMUniqueIDs			is an IDMUniqueIDOccurs
		LocalRemittanceIDMUniqueIDs		is an IDMUniqueIDOccurs		
		LocalCheckNumbers				is Text
		IDMItem
		Execute							is Boolean
		CashLedgerSourceRecord
		LocalPrintedDocuments			is Numeric 6
		LocalIDMEmailSubject			is Alpha 255
    		Text Variables
 				RemittanceAdviceFilename  value is PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryFilename
				CashCode				  value is CashCode
				BankTransactionCode		  value is BankTransactionCode
				TransactionNumber   	  value is TransactionNumber
				PaymentDate				  value is PaymentDate
				VendorName				  value is PaidName

		LocalIDMEmailFileName			is Alpha 255
			Text Variables
				RemittanceAdviceFilename  value is PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryFilename
				CashCode				  value is CashCode
				BankTransactionCode		  value is BankTransactionCode
				TransactionNumber   	  value is TransactionNumber
				PaymentDate				  value is PaymentDate
				VendorName				  value is PaidName
				
		LocalCheckIDMEmailSubject		is Alpha 255
    		Text Variables
 				PaymentFilename  		  value is PaymentOutputFileHeader.CashPaymentFormatRel.PaymentFilename
				CashCode				  value is CashCode
				BankTransactionCode		  value is BankTransactionCode
				TransactionNumber   	  value is TransactionNumber	
		LocalIDMEmailCc					is like MultipleEmailAddress 
			holds pii
		LocalFieldName					is LPLName
		LocalOutputField				is Alpha up to 200
			is related value for "PaymentOutputFileDetail"
		LocalFieldValue					is Alpha up to 20000 
		LocalCustomCsvHeader			is Text
		LocalCustomCsvOutput			is Text
		LastPaymentOutputMappingDetail	is like PaymentOutputMappingDetail
		LocalIDMPaymentInWords			is Alpha 250
			Text Variables
				AmountInWords			  value is AmountInWords
				CurrencyCode			  value is CashCode.Currency
				CurrencyDescription		  value is CashCode.Currency.Description
		LocalContainsDelimiterValue		is Boolean
		RetrievedIDMXML					is Boolean
		IDMXMLDefinition
		LocalGenerateXMLFile			is Boolean
		LocalCounter					is Numeric 2
		LocalPostalCodeSize				is Numeric 2
		LocalPostalCode					is like PostalCode
		LocalRoutingCode				is Alpha size 11

	Context Fields

    Conditions
		EmailRemittanceToVendor
			restricted
			when (RemittanceOptionUsesIDMTemplate
			and SupplementaryIDMUniqueId entered
			and DerivedEmailTo entered
			and ((BankTransactionCode.PaymentSummarization
			and first CashLedgerPayablesPaymentRel.CashLedgerTransactionPayGroupRel.ProcessForIDM)
			or 	(not BankTransactionCode.PaymentSummarization
			and first CashLedgerPayablesPaymentRel.CbtransRel.ProcessForIDM)))

		CheckVersioningEnabled
			restricted
			when (PaymentOutputFileHeader.CashPaymentFormatRel.CheckVersioning)

		ValidForMarkCheckAsPrinted
			restricted
			when (CheckVersioningEnabled
			and HasCheckIDMDocument
			and not CheckPrinted)
		
		ValidForMarkCheckAsUnprinted
			restricted
			when (CheckVersioningEnabled
			and CheckPrinted)

		RemittanceOptionUsesIDMTemplate
			restricted
			when (PaymentOutputFileHeader.CashPaymentFormatRel.UseIDMTemplate)

		HasRemittanceIDMTemplate
			restricted
			when (PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryTemplate entered)

		HasCheckIDMTemplate
			restricted
            when (PaymentOutputFileHeader.CashPaymentFormatRel.PaymentTemplate entered)

		ValidForGeneratePaymentCheck
			restricted
            when (HasCheckIDMTemplate 
			and (not CheckVersioningEnabled
			or (CheckVersioningEnabled 
			and not CheckPrinted)))	

		VendorEmailAddressNotEntered
			restricted
			when (RemittanceOptionUsesIDMTemplate
			and DerivedEmailTo not entered)
		
		VendorLocationEmailAddressExist
			restricted
			when (first CashLedgerPayablesPaymentRel.RemitToCode.EmailAddress entered)

		VendorEmailAddressExist	
			restricted
			when (VendorRel.EmailAddress entered)

		HasCheckIDMDocument
			when (PaymentIDMUniqueId entered)
			
		HasRemittanceIDMDocument
			when (SupplementaryIDMUniqueId entered)

		VendorBankCode1Entered		
			restricted
			when (VendorBankCode1 entered)

		VendorBankCode2Entered		
			restricted
			when (VendorBankCode2 entered)

		VendorBankCode3Entered		
			restricted
			when (VendorBankCode3 entered)

		VendorBankCode4Entered		
			restricted
			when (VendorBankCode4 entered)

		VendorBankCode5Entered		
			restricted
			when (VendorBankCode5 entered)

		VendorBankCode6Entered		
			restricted
			when (VendorBankCode6 entered)

		VendorBankCode7Entered		
			restricted
			when (VendorBankCode7 entered)

		VendorBankCode8Entered		
			restricted
			when (VendorBankCode8 entered)

		VendorBankCode9Entered		
			restricted
			when (VendorBankCode9 entered)

		VendorBankCode10Entered		
			restricted
			when (VendorBankCode10 entered)

		VendorBankCode11Entered		
			restricted
			when (VendorBankCode11 entered)

		VendorBankCode12Entered		
			restricted
			when (VendorBankCode12 entered)

		VendorBankCode13Entered		
			restricted
			when (VendorBankCode13 entered)

		VendorBankCode14Entered		
			restricted
			when (VendorBankCode14 entered)

		VendorBankCode15Entered		
			restricted
			when (VendorBankCode15 entered)

		VendorBankCode16Entered		
			restricted
			when (VendorBankCode16 entered)

		VendorBankCode17Entered		
			restricted
			when (VendorBankCode17 entered)

		VendorBankCode18Entered		
			restricted
			when (VendorBankCode18 entered)

		VendorBankCode19Entered		
			restricted
			when (VendorBankCode19 entered)

		VendorBankCode20Entered		
			restricted
			when (VendorBankCode20 entered)

		IsVendorPrimaryContactEmailPaymentCheckEnabled
			restricted
			when (VendorRel.PrimeVendorContactRel.EmailPaymentCheck
			or not VendorRel.PrimeVendorContactRel.OverrideIDMEmailDistribution)

		IsVendorPrimaryContactEmailRemittanceAdviceEnabled
			restricted
			when (VendorRel.PrimeVendorContactRel.EmailRemittanceAdvice
			or not VendorRel.PrimeVendorContactRel.OverrideIDMEmailDistribution)

	Relations
		PaymentOutputFileRemittanceRel
			one-to-many relation to PaymentOutputFileRemittance
			Field Mapping uses symbolic key
				related.CashManagementGroup			=	PaymentOutputFileHeader.CashManagementGroup
				related.CashManagementAccount		=	PaymentOutputFileHeader.CashManagementAccount
				related.PaymentOutputFileHeader		=	PaymentOutputFileHeader
				related.PaymentOutputFileDetail		=	PaymentOutputFileDetail

		PaymentOutputFileRemittanceLinesRel
			one-to-many relation to PaymentOutputFileRemittance
			Field Mapping uses symbolic key
				related.CashManagementGroup			=	PaymentOutputFileHeader.CashManagementGroup
				related.CashManagementAccount		=	PaymentOutputFileHeader.CashManagementAccount
				related.PaymentOutputFileHeader		=	PaymentOutputFileHeader
				related.PaymentOutputFileDetail		=	PaymentOutputFileDetail
			Instance Selection
				where (related.AttachedWithCheck)

		OverFlowOrSeparateRemittanceLinesRel
			one-to-many relation to PaymentOutputFileRemittance
			Field Mapping uses symbolic key
				related.CashManagementGroup			=	PaymentOutputFileHeader.CashManagementGroup
				related.CashManagementAccount		=	PaymentOutputFileHeader.CashManagementAccount
				related.PaymentOutputFileHeader		=	PaymentOutputFileHeader
				related.PaymentOutputFileDetail		=	PaymentOutputFileDetail
			Instance Selection
				where (not related.AttachedWithCheck)
				
		PaymentOutputFileRemittanceTotalRel
			one-to-many relation to PaymentOutputFileRemittance
			Field Mapping uses ByPaidVendor
				related.CashManagementGroup			=	PaymentOutputFileHeader.CashManagementGroup
				related.CashManagementAccount		=	PaymentOutputFileHeader.CashManagementAccount
				related.PaymentOutputFileHeader		=	PaymentOutputFileHeader
				related.PaymentOutputFileDetail		=	PaymentOutputFileDetail			
		CashLedgerPayablesPaymentRel
			one-to-many relation to CashLedgerPayablesPayment
			Field Mapping uses ByCashLedgerTransactionIdentifier
				related.CashManagementGroup		 		= PaymentOutputFileHeader.CashManagementGroup
				related.CashLedgerTransactionIdentifier = CashLedgerTransactionIdentifier
				related.TransactionNumber				= TransactionNumber
				related.CashCode						= CashCode
				related.CashLedgerSourceRecord			= CashLedgerSourceRecord.CashLedgerPayablesPayment

		VendorGroupRel
			one-to-one relation to VendorGroup
			Field Mapping uses symbolic key
				related.VendorGroup = VendorGroupOutput
		
		PayGroupRel
			one-to-one relation to PayGroup
			Field Mapping uses symbolic key
				related.VendorGroup = VendorGroupRel.VendorGroup
				related.PayGroup    = PaymentOutputFileHeader.PayGroupOutput

		VendorRel
			one-to-one relation to Vendor
			Field Mapping uses symbolic key
				related.VendorGroup = VendorGroupOutput
				related.Vendor		= InvoiceVendor

		IDMPaymentPrintJobRel
			one-to-one relation to IDMJob
			Field Mapping uses symbolic key
				related.IDMJob = IDMPaymentPrintJob	

		IDMRemittancePrintJobRel
			one-to-one relation to IDMJob
			Field Mapping uses symbolic key
				related.IDMJob = IDMRemittancePrintJob	


		SupplementaryIDMJobRel
			one-to-one relation to IDMJob
			Field Mapping uses symbolic key
				related.IDMJob = SupplementaryIDMJob	

		PayablesInvoiceRel					
			one-to-one relation to PayablesInvoice
			Field Mapping uses symbolic key
				related.Company 		= PayablesCompany
				related.PayablesInvoice	= PayablesInvoice

		CashLedgerPaymentRel				
			one-to-many relation to CashLedgerPayment
			Field Mapping uses ByCashLedgerTransactionIdentifier
				related.CashManagementGroup				= CashManagementGroup
				related.CashLedgerTransactionIdentifier	= CashLedgerTransactionIdentifier


    Sets

    Field Rules

	Actions
        Create is a Create Action
        	restricted

        Update is an Update Action
			restricted
							
        Delete is a Delete Action
			restricted
			
		UpdateUserFields is an Instance Action			
			default label is untranslatable
			restricted
			Action Rules
				invoke FastUpdate
					fill in user fields from VendorRel
					if (PayablesInvoice entered)
						fill in user fields from PayablesInvoiceRel
					else
						fill in user fields from first CashLedgerPaymentRel
					
		UpdateFromPaymentRun is an Update Action			
			default label is untranslatable
			restricted
			bypass field rules						
			Action Rules
				invoke FastUpdate
					fill in user fields from VendorRel
					if (PayablesInvoice entered)
						fill in user fields from PayablesInvoiceRel
					else
						fill in user fields from first CashLedgerPaymentRel
					
		FastUpdate is an Update Action
			default label is untranslatable
			restricted
			bypass field rules						
			Action Rules

		CreatePaymentRemittanceRequest is a Set Action		
			default label is untranslatable
			restricted
			Parameters
				PrmCashManagementGroup			is a CashManagementGroup
				PrmCashManagementAccount		is a CashManagementAccount
				PrmPaymentOutpuFileHeader		is a PaymentOutputFileHeader
			Instance Selection
				where (CashManagementGroup		= PrmCashManagementGroup
				and    CashManagementAccount	= PrmCashManagementAccount
				and    PaymentOutputFileHeader	= PrmPaymentOutpuFileHeader)
			Action Rules
				Instance Rules
					invoke CreatePaymentRemittanceRequest PaymentRemittanceRequest
						resume on error
						invoked.CashManagementGroup		= CashManagementGroup
						invoked.CashManagementAccount	= CashManagementAccount
						invoked.PaymentOutputFileHeader	= PaymentOutputFileHeader
						invoked.PaymentOutputFileDetail	= PaymentOutputFileDetail


		GenerateRemittanceAdvice is an Instance Action
			valid when (HasRemittanceIDMTemplate)
			Local Fields
			    LocalExecute					is Boolean
			    IDMAttributes
				IDMSupplementaryJobView			is an IDMJob view	
				Counter							is Numeric 6
				NumberOfRemittanceLines			is Numeric 6	
				
			Entrance Rules
				initialize Counter
				if (PaymentOutputFileHeader.CashPaymentFormatRel.RemittanceOption.OverflowDocument
				and PaymentOutputFileRemittanceRel exists)
					NumberOfRemittanceLines = PaymentOutputFileHeader.CashPaymentFormatRel.NumberOfRemittanceLines
					for each PaymentOutputFileRemittanceRel
						Counter += 1
						if Counter <= NumberOfRemittanceLines
							invoke Update each
								invoked.AttachedWithCheck = true
						else
							end for each	
												
			Action Rules
				include SetIDMXMLDefinition
				
				initialize IDMAttributes
				IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName  = "CashCode"
				IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue = CashCode
				IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeName  = "BankTransactionCode"
				IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeValue = BankTransactionCode
				IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeName  = "BankTransactionCodeDescription"
				IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeValue = BankTransactionCode.Description
				IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeName  = "TransactionNumber"
				IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeValue = TransactionNumber
				IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeName	= "Status"
				IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeValue	= "Open"
									
				IDMGenerateDocument.IDMAttributes		 = IDMAttributes		
    			IDMGenerateDocument.IDMAccessControlList = "CSFDefined"				
				IDMGenerateDocument.TemplateUniqueId	 = PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryTemplate.IDMUniqueId 
				IDMGenerateDocument.DocumentType		 = "FSM_PayablesPaymentOutput"
    			IDMGenerateDocument.FileName			 = DerivedSupplementaryOutputFilename
    			
    			invoke CreateFromGenerateDocument IDMJob
    				assign result to IDMSupplementaryJobView
    				invoked.Actor				= actor
					invoked.Description			= GeneratePayablesPaymentOutputMsg
					invoked.IDMGenerateDocument = IDMGenerateDocument	
				
				SupplementaryIDMJob = IDMSupplementaryJobView.IDMJob
					
				invoke UpdateSupplementaryIDMUniqueId in background
					run after IDMSupplementaryJobView.IDMJob.AsyncId	
	

		UpdateSupplementaryIDMUniqueId is an Instance Action
			default label is untranslatable
			restricted
			Action Rules
				if (SupplementaryIDMJobRel.GenerationStatus.Finished
				and SupplementaryIDMJobRel.MDSID entered)
					SupplementaryIDMUniqueId = SupplementaryIDMJobRel.MDSID


		GeneratePaymentCheck is an Instance Action
		    valid when (ValidForGeneratePaymentCheck)
		    Local Fields
		        IDMAttributes	
		        IDMPaymentJobView	 			is an IDMJob view		
		        Counter							is Numeric 6
		        NumberOfRemittanceLines			is Numeric 6
		
		    Action Rules
		        initialize Counter
		        
		        if (PaymentOutputFileHeader.CashPaymentFormatRel.RemittanceOption.OverflowDocument
		        and PaymentOutputFileRemittanceRel exists)
		            NumberOfRemittanceLines = PaymentOutputFileHeader.CashPaymentFormatRel.NumberOfRemittanceLines
		            for each PaymentOutputFileRemittanceRel
		                Counter += 1
		                if Counter <= NumberOfRemittanceLines
		                    invoke Update each
		                        invoked.AttachedWithCheck = true
		                else
		                    end for each
		
				include SetIDMXMLDefinition
				
		        initialize IDMAttributes
		        IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName  = "CashCode"
		        IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue = CashCode
		        IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeName  = "BankTransactionCode"
		        IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeValue = BankTransactionCode
		        IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeName  = "BankTransactionCodeDescription"
		        IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeValue = BankTransactionCode.Description
		        IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeName  = "TransactionNumber"
		        IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeValue = TransactionNumber
		        IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeName	= "Status"
		        IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeValue	= "Open"
		                            
		        IDMGenerateDocument.IDMAttributes		 = IDMAttributes		
		        IDMGenerateDocument.IDMAccessControlList = "CSFDefined"				
		        IDMGenerateDocument.TemplateUniqueId	 = PaymentOutputFileHeader.CashPaymentFormatRel.PaymentTemplate.IDMUniqueId 
		        IDMGenerateDocument.DocumentType		 = "FSM_PayablesPaymentOutput"
		        IDMGenerateDocument.FileName			 = DerivedPaymentOutputFilename
		        
		        invoke CreateFromGenerateDocument IDMJob
		            assign result to IDMPaymentJobView
		            invoked.Actor				= actor
		            invoked.Description			= GeneratePayablesPaymentOutputMsg
		            invoked.IDMGenerateDocument = IDMGenerateDocument	
		        
		        IDMJob = IDMPaymentJobView.IDMJob
		
		        invoke UpdatePaymentIDMUniqueId in background
		            run after IDMJob.AsyncId


		UpdatePaymentIDMUniqueId is an Instance Action
		    restricted
		    Action Rules
		        if (IDMJob.GenerationStatus.Finished
		        and IDMJob.MDSID entered)
		            PaymentIDMUniqueId = IDMJob.MDSID


		PrintCheckSet is a Set Action
			default label is untranslatable
			restricted
			Parameters
			    PrmCashManagementGroup	   is a CashManagementGroup
				PrmCashManagementAccount   is a CashManagementAccount
				PrmPaymentOutputFileHeader is a PaymentOutputFileHeader
				PrmPaymentPrinter          is an IDMPrinter
				PrmIncludeRemittanceAdvice is Boolean
				PrmRemittanceAdvicePrinter is an IDMPrinter		
				PrmPrintAll				   is Boolean 
				PrmPaymentOutputFileDetailRange is a PaymentOutputFileDetailRange
				PrmInstanceCount		   is Numeric 6

			Local Fields
				SamePrinter						is Boolean	
				Counter							is Numeric 6
				RemittanceCounter				is Numeric 6
				LocalBatchPrintLimit			is Numeric 6
				CheckIDMUniqueIDs				is an IDMUniqueIDOccurs
				RemittanceIDMUniqueIDs			is an IDMUniqueIDOccurs	
				CheckNumbers					is Text
				RemittanceCheckNumbers			is Text
				LocalAsyncID					is an AsyncActionRequest

			Accumulators
				NumberOfRecords	
				
			Instance Selection
				where (CashManagementGroup		= PrmCashManagementGroup
				and    CashManagementAccount	= PrmCashManagementAccount
				and    PaymentOutputFileHeader	= PrmPaymentOutputFileHeader
				and    PaymentIDMUniqueId entered
				and    PaymentOutputFileDetail within PrmPaymentOutputFileDetailRange)
				
			Action Rules
				Set Rules
					Entrance Rules
						initialize Counter
						initialize RemittanceCounter
						initialize NumberOfRecords
						initialize SamePrinter
						initialize CheckIDMUniqueIDs
						initialize RemittanceIDMUniqueIDs
						initialize LocalCheckIDMUniqueIDs
						initialize LocalRemittanceIDMUniqueIDs						
						initialize LocalCheckNumbers
						initialize CheckNumbers
						initialize RemittanceCheckNumbers
						CheckNumbers = "Transaction Number(s): "
						RemittanceCheckNumbers = "Transaction Number(s): "
						if (PrmPaymentPrinter = PrmRemittanceAdvicePrinter
						and PaymentOutputFileHeader.CashPaymentFormatRel.PaymentPrinterSetting = PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryPrinterSetting)
							SamePrinter = true
						
						if (PaymentOutputFileHeader.CashPaymentFormatRel.BatchPrintCount > 0)
							LocalBatchPrintLimit  = PaymentOutputFileHeader.CashPaymentFormatRel.BatchPrintCount
						else
							LocalBatchPrintLimit  = 100

						LocalAsyncID = current async action request id
						
					Exit Rules
						invoke GetStatusIDMJobPrint in background
							run after LocalAsyncID
							invoked.PrmCashManagementGroup		    = PrmCashManagementGroup
							invoked.PrmCashManagementAccount	    = PrmCashManagementAccount
							invoked.PrmPaymentOutputFileHeader	    = PrmPaymentOutputFileHeader	
							invoked.PrmPaymentOutputFileDetailRange = PrmPaymentOutputFileDetailRange	

				Instance Rules
					LocalPaymentPrinter       = PrmPaymentPrinter
					LocalSupplementaryPrinter = PrmRemittanceAdvicePrinter				
					NumberOfRecords += 1
					Counter += 1
					CheckIDMUniqueIDs.IDMPID[Counter] = PaymentIDMUniqueId
					CheckNumbers += TransactionNumber
					
					if (PaymentOutputFileHeader.CashPaymentFormatRel.SequentialPrintCheckAndRemittance)
						if (PaymentIDMUniqueId entered)
							invoke PrintCheck
								invoked.PrmPaymentPrinter    = PrmPaymentPrinter
								invoked.PrmBypassGetStatus   = true
						
						if (PrmIncludeRemittanceAdvice
						and SupplementaryIDMUniqueId entered)
							invoke PrintRemittanceAdvice
								invoked.PrmRemittanceAdvicePrinter = PrmRemittanceAdvicePrinter
								invoked.PrmBypassGetStatus         = true
					else
						if (PrmIncludeRemittanceAdvice
						and SupplementaryIDMUniqueId entered)
							if (SamePrinter)
								Counter += 1
								CheckIDMUniqueIDs.IDMPID[Counter] = SupplementaryIDMUniqueId
							else
								RemittanceCounter += 1
								RemittanceCheckNumbers += TransactionNumber
								RemittanceIDMUniqueIDs.IDMPID[RemittanceCounter] = SupplementaryIDMUniqueId
						
						if (NumberOfRecords = PrmInstanceCount
						or  Counter >= LocalBatchPrintLimit
						or  RemittanceCounter >= LocalBatchPrintLimit)
							if (CheckIDMUniqueIDs entered)
								LocalPrintedDocuments  = Counter
								initialize LocalCheckIDMUniqueIDs
								LocalCheckIDMUniqueIDs = CheckIDMUniqueIDs
								LocalCheckNumbers	   = CheckNumbers
								include BatchCheckPrint 
								initialize LocalCheckNumbers
								initialize LocalPrintedDocuments
							
							if (PrmIncludeRemittanceAdvice
							and RemittanceIDMUniqueIDs entered)
								LocalPrintedDocuments 		= RemittanceCounter
								initialize LocalRemittanceIDMUniqueIDs
								LocalRemittanceIDMUniqueIDs = RemittanceIDMUniqueIDs
								LocalCheckNumbers	   		= RemittanceCheckNumbers
								include BatchRemittancePrint
								initialize LocalCheckNumbers
								initialize LocalPrintedDocuments
							
							initialize Counter		
							initialize RemittanceCounter
							initialize CheckIDMUniqueIDs
							initialize RemittanceIDMUniqueIDs
							initialize LocalCheckNumbers
							initialize CheckNumbers
							initialize RemittanceCheckNumbers
							initialize LocalCheckIDMUniqueIDs
							initialize LocalRemittanceIDMUniqueIDs
							CheckNumbers = "Transaction Number(s): "
							RemittanceCheckNumbers = "Transaction Number(s): "
						else
							CheckNumbers += ", "
							if (SupplementaryIDMUniqueId entered)
								RemittanceCheckNumbers += ", "	

		GetStatusIDMJobPrint is a Set Action
			default label is untranslatable
			restricted		
			Parameters
				PrmCashManagementGroup			is a CashManagementGroup
				PrmCashManagementAccount		is a CashManagementAccount
				PrmPaymentOutputFileHeader		is a PaymentOutputFileHeader
				PrmPaymentOutputFileDetailRange is a PaymentOutputFileDetailRange

			Instance Selection
				where (CashManagementGroup		= PrmCashManagementGroup
				and    CashManagementAccount	= PrmCashManagementAccount
				and    PaymentOutputFileHeader	= PrmPaymentOutputFileHeader
				and    PaymentOutputFileDetail within PrmPaymentOutputFileDetailRange)
				
			Action Rules
				Instance Rules
					if (IDMPaymentPrintJob entered)
						invoke GetStatusBackground IDMPaymentPrintJobRel
							invoked.PrmFromSendToPrinter = true

					if (IDMRemittancePrintJob entered)
						invoke GetStatusBackground IDMRemittancePrintJobRel
							invoked.PrmFromSendToPrinter = true


		PrintCheck is an Instance Action
			valid when (HasCheckIDMDocument)
			Parameters
				PrmPaymentPrinter is an IDMPrinter
					default label is "PaymentPrinter"
				PrmIncludeRemittanceAdvice is Boolean
					default label is "IncludeRemittanceAdvice"
				PrmRemittanceAdvicePrinter is an IDMPrinter
					default label is "RemittanceAdvicePrinter"
				PrmBypassGetStatus   is Boolean
			Parameter Rules
				PrmPaymentPrinter
					initial value is PaymentOutputFileHeader.CashPaymentFormatRel.PaymentPrinter
					force default to PaymentOutputFileHeader.CashPaymentFormatRel.PaymentPrinter
					required
						"PaymentPrinterNotDefinedInCashPaymentFormat"

				PrmRemittanceAdvicePrinter
					initial value is PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryPrinter
					force default to PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryPrinter
					if (PrmIncludeRemittanceAdvice)
						required
							"RemittanceAdvicePrinterNotDefinedInCashPaymentFormat"
			
			Local Fields
				IDMJobView		  is an IDMJob view	

			Action Rules
				initialize IDMItem
				IDMItem.DocumentType = "FSM_PayablesPaymentOutput"
				IDMItem.IDMUniqueId	 = PaymentIDMUniqueId
				IDMItem.IDMPrinter	 = PrmPaymentPrinter 
				IDMItem.IDMPrinterSettings	= PaymentOutputFileHeader.CashPaymentFormatRel.PaymentPrinterSetting
				
				constraint (IDMItem.GetItemDetails)
					"DocumentDoesNotExistInIDM"
			
				IDMItem.IDMPID    = IDMItem.IDMItemDetails.PID

				invoke SendToPrinter IDMJob
					assign result to IDMJobView
					invoked.Description = PayablesPaymentOutputPrintMsg
					invoked.FileName	= DerivedPaymentOutputFilename
					invoked.IDMItem		= IDMItem	
					invoked.BypassGetStatus = PrmBypassGetStatus 
				
				if (PrmBypassGetStatus and IDMJobView entered)
					IDMPaymentPrintJob = IDMJobView.IDMJob

				if (PrmIncludeRemittanceAdvice
				and PrmRemittanceAdvicePrinter entered
				and SupplementaryIDMUniqueId entered)
					invoke PrintRemittanceAdvice
						invoked.PrmRemittanceAdvicePrinter = PrmRemittanceAdvicePrinter
						

		PrintRemittanceAdviceSet is a Set Action
			default label is untranslatable
			restricted
			Parameters
			    PrmCashManagementGroup	   is a CashManagementGroup
				PrmCashManagementAccount   is a CashManagementAccount
				PrmPaymentOutputFileHeader is a PaymentOutputFileHeader
				PrmRemittanceAdvicePrinter is an IDMPrinter	
				PrmPrintAll				   is Boolean
				PrmInstanceCount		   is Numeric 6	
				PrmPaymentOutputFileDetailRange is a PaymentOutputFileDetailRange

			Local Fields
				Counter							is Numeric 6
				LocalBatchPrintLimit			is Numeric 6
				CheckIDMUniqueIDs				is an IDMUniqueIDOccurs
				RemittanceIDMUniqueIDs			is an IDMUniqueIDOccurs	
				CheckNumbers					is Text
															
			Accumulators
				NumberOfRecords	
				
			Instance Selection
				where (CashManagementGroup		= PrmCashManagementGroup
				and    CashManagementAccount	= PrmCashManagementAccount
				and    PaymentOutputFileHeader	= PrmPaymentOutputFileHeader
				and    SupplementaryIDMUniqueId entered
				and    PaymentOutputFileDetail within PrmPaymentOutputFileDetailRange)
				
			Action Rules
				Set Rules
					Entrance Rules
						initialize Counter
						initialize RemittanceIDMUniqueIDs
						initialize LocalRemittanceIDMUniqueIDs						
						initialize NumberOfRecords
						initialize LocalCheckNumbers
						initialize CheckNumbers
						CheckNumbers = "Transaction Number(s): "
												
						if (PaymentOutputFileHeader.CashPaymentFormatRel.BatchPrintCount > 0) 
							LocalBatchPrintLimit = PaymentOutputFileHeader.CashPaymentFormatRel.BatchPrintCount				
						else
							LocalBatchPrintLimit = 100
						
				Instance Rules
					LocalSupplementaryPrinter = PrmRemittanceAdvicePrinter
					NumberOfRecords += 1
					Counter += 1
					CheckNumbers += TransactionNumber
					RemittanceIDMUniqueIDs.IDMPID[Counter] = SupplementaryIDMUniqueId

					if (NumberOfRecords = PrmInstanceCount
					or  Counter >= LocalBatchPrintLimit)
						LocalPrintedDocuments = Counter
						if (RemittanceIDMUniqueIDs entered)
							initialize LocalRemittanceIDMUniqueIDs
							LocalRemittanceIDMUniqueIDs = RemittanceIDMUniqueIDs
							LocalCheckNumbers = CheckNumbers
							include BatchRemittancePrint

						initialize Counter		
						initialize RemittanceIDMUniqueIDs
						initialize LocalCheckNumbers
						initialize CheckNumbers
						initialize LocalRemittanceIDMUniqueIDs						
						CheckNumbers = "Transaction Number(s): "
					else
						CheckNumbers += ", "			

		PrintRemittanceAdvice is an Instance Action	
			valid when (HasRemittanceIDMDocument)
			Parameters
				PrmRemittanceAdvicePrinter	is an IDMPrinter
					default label is "RemittanceAdvicePrinter"
				PrmBypassGetStatus is Boolean

			Parameter Rules
				PrmRemittanceAdvicePrinter
					initial value is PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryPrinter
					force default to PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryPrinter
					required
						"RemittanceAdvicePrinterNotDefinedInCashPaymentFormat"

			Local Fields
				IDMJobView		  is an IDMJob view	

			Action Rules
				initialize IDMItem
				IDMItem.DocumentType = "FSM_PayablesPaymentOutput"
				IDMItem.IDMUniqueId	 = SupplementaryIDMUniqueId
				IDMItem.IDMPrinter	 = PrmRemittanceAdvicePrinter 
				IDMItem.IDMPrinterSettings = PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryPrinterSetting

				constraint (IDMItem.GetItemDetails)
					"DocumentDoesNotExistInIDM"

				IDMItem.IDMPID    = IDMItem.IDMItemDetails.PID

				invoke SendToPrinter IDMJob
					assign result to IDMJobView
					invoked.Description = SupplementaryOutputPrintMsg
					invoked.FileName	= DerivedSupplementaryOutputFilename
					invoked.IDMItem		= IDMItem	
					invoked.BypassGetStatus = PrmBypassGetStatus 			

				if (PrmBypassGetStatus and IDMJobView entered)
					IDMRemittancePrintJob = IDMJobView.IDMJob


		GeneratePaymentDetailFile is a Set Action		
			default label is untranslatable
			run in background
			restricted
			Local Fields
			    LocalExecute					is Boolean
    			IDMAttributes	
    			IDMPaymentJobView	 			is an IDMJob view		
				IDMSupplementaryJobView			is an IDMJob view	
				Counter							is Numeric 6
				NumberOfRemittanceLines			is Numeric 6
				HasOverflowDetails				is Boolean	
				LocalAsyncID					is an AsyncActionRequest
				
			Parameters
				PrmCashManagementGroup			is a CashManagementGroup
				PrmCashManagementAccount		is a CashManagementAccount
				PrmPaymentOutputFileHeader		is a PaymentOutputFileHeader
				PrmPaymentTemplate				is an IDMTemplate
				PrmPaymentFilename				is Alpha size 20		
				PrmPaymentFromEmail				is an EmailAddress	
				PrmPaymentPrinter				is an IDMPrinter		
				PrmSupplementaryTemplate		is an IDMTemplate
				PrmSupplementaryFilename		is Alpha size 20
				PrmSupplementaryFromEmail		is an EmailAddress 
					holds pii
				PrmSupplementaryPrinter			is an IDMPrinter
				PrmUsePaymentPrinter			is Boolean
				PrmUsePaymentEMail				is Boolean
				PrmUseSupplementaryPrinter		is Boolean
				PrmUseSupplementaryEmail		is Boolean
				PrmConsolidateIDMNotification	is Boolean
				PrmPaymentOutputFileDetailRange is a PaymentOutputFileDetailRange
			Parameter Rules
			
			Accumulators
				NumberOfRecords				

			Instance Selection
				where (CashManagementGroup	= PrmCashManagementGroup
				and CashManagementAccount	= PrmCashManagementAccount
				and PaymentOutputFileHeader	= PrmPaymentOutputFileHeader
				and PaymentOutputFileDetail within PrmPaymentOutputFileDetailRange)				

			Action Rules
				Set Rules
					Entrance Rules
						LocalAsyncID = current async action request id
						
					Exit Rules
						invoke GetStatusPaymentDetailFile in background
							run after LocalAsyncID
							invoked.PrmCashManagementGroup		= PrmCashManagementGroup
							invoked.PrmCashManagementAccount	= PrmCashManagementAccount
							invoked.PrmPaymentOutputFileHeader	= PrmPaymentOutputFileHeader	
							invoked.PrmUsePaymentPrinter		= PrmUsePaymentPrinter
							invoked.PrmPaymentPrinter			= PrmPaymentPrinter
							invoked.PrmUseSupplementaryPrinter	= PrmUseSupplementaryPrinter
							invoked.PrmSupplementaryPrinter  	= PrmSupplementaryPrinter	
							invoked.PrmInstanceCount			= NumberOfRecords	
							invoked.PrmConsolidateIDMNotification	= PrmConsolidateIDMNotification
							invoked.PrmPaymentOutputFileDetailRange = PrmPaymentOutputFileDetailRange						
					
				Instance Rules
					initialize Counter
					initialize HasOverflowDetails
					NumberOfRecords += 1
					
					if (PaymentOutputFileHeader.CashPaymentFormatRel.RemittanceOption.OverflowDocument
					and PaymentOutputFileRemittanceRel exists)
						NumberOfRemittanceLines = PaymentOutputFileHeader.CashPaymentFormatRel.NumberOfRemittanceLines
						for each PaymentOutputFileRemittanceRel
							Counter += 1
							if Counter <= NumberOfRemittanceLines
								invoke Update each
									invoked.AttachedWithCheck = true
							else
								HasOverflowDetails = true
								end for each

					include SetIDMXMLDefinition
		
					initialize IDMAttributes
					IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName  	= "CashCode"
					IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue  	= CashCode
					IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeName  	= "BankTransactionCode"
					IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeValue  	= BankTransactionCode
					IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeName  	= "BankTransactionCodeDescription"
					IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeValue  	= BankTransactionCode.Description
					IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeName  	= "TransactionNumber"
					IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeValue  	= TransactionNumber
					IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeName		= "Status"
					IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeValue		= "Open"
										
					IDMGenerateDocument.IDMAttributes				= IDMAttributes		
	    			IDMGenerateDocument.IDMAccessControlList 		= "CSFDefined"										

					if (PrmPaymentTemplate entered)
						IDMGenerateDocument.TemplateUniqueId		= PrmPaymentTemplate.IDMUniqueId
						IDMGenerateDocument.DocumentType			= "FSM_PayablesPaymentOutput"
		    			IDMGenerateDocument.FileName				= DerivedPaymentOutputFilename
		    			
		    			if (PrmUsePaymentEMail
		    			and PrmPaymentFromEmail entered
		    			and InvoiceVendorEmailAddress entered
						and IsVendorPrimaryContactEmailPaymentCheckEnabled)
		    				TransientEmailFrom  = PrmPaymentFromEmail
		    				IDMGenerateDocument.IDMEmail.From	 	= PrmPaymentFromEmail
		    				IDMGenerateDocument.IDMEmail.To		 	= InvoiceVendorEmailAddress
							IDMGenerateDocument.IDMEmail.Cc		 	= DerivedEmailCcForChecks
							
		    				if (PaymentOutputFileHeader.CashPaymentFormatRel.CheckEmailSubject entered)
		    					IDMGenerateDocument.IDMEmail.Subject = DerivedCashPaymentFormatCheckEmailSubject
		    				else
		    					IDMGenerateDocument.IDMEmail.Subject = DerivedPaymentEmailSubject

							if (PaymentOutputFileHeader.CashPaymentFormatRel.CheckEmailTemplate entered)
								IDMGenerateDocument.EmailTemplateUniqueID = PaymentOutputFileHeader.CashPaymentFormatRel.CheckEmailTemplate.IDMUniqueId
							else
		    					IDMGenerateDocument.IDMEmail.Body	 = PaymentAttachedMsg

		    			invoke CreateFromGenerateDocument IDMJob
		    				assign result to IDMPaymentJobView
		    				invoked.Actor							= actor
							invoked.Description						= GeneratePayablesPaymentOutputMsg
							invoked.IDMGenerateDocument 			= IDMGenerateDocument	
							invoked.BypassGetStatus					= true
											
						IDMJob = IDMPaymentJobView.IDMJob
							
						
					if  (PrmSupplementaryTemplate entered	
					and (PaymentOutputFileHeader.CashPaymentFormatRel.RemittanceOption.SeparateRemittance
					or  (PaymentOutputFileHeader.CashPaymentFormatRel.RemittanceOption.OverflowDocument
					and  HasOverflowDetails)))							
						
						IDMGenerateDocument.TemplateUniqueId		= PrmSupplementaryTemplate.IDMUniqueId
						IDMGenerateDocument.DocumentType			= "FSM_PayablesPaymentOutput"
		    			IDMGenerateDocument.FileName				= DerivedSupplementaryOutputFilename
		    			
		    			initialize IDMGenerateDocument.IDMPrinter 
		    			initialize IDMGenerateDocument.IDMEmail
		    			
						PrmSupplementaryFromEmail = DerivedEmailFrom

		    			if (PrmUseSupplementaryEmail
		    			and PrmSupplementaryFromEmail entered
		    			and DerivedEmailTo entered
						and IsVendorPrimaryContactEmailRemittanceAdviceEnabled)
		    				IDMGenerateDocument.IDMEmail.From	 	= PrmSupplementaryFromEmail
		    				IDMGenerateDocument.IDMEmail.To		 	= DerivedEmailTo
		    				IDMGenerateDocument.IDMEmail.Cc		 	= DerivedEmailCc
		    				if (PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryEmailSubject entered)
		    					IDMGenerateDocument.IDMEmail.Subject	= DerivedCashPaymentFormatSupplementaryEmailSubject
		    				else
		    					IDMGenerateDocument.IDMEmail.Subject	= DerivedSupplementaryEmailSubject

							if (PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryEmailTemplate entered)
								IDMGenerateDocument.EmailTemplateUniqueID = PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryEmailTemplate.IDMUniqueId
							else
		    					IDMGenerateDocument.IDMEmail.Body		= RemittanceAdviceEmailBody

		    			invoke CreateFromGenerateDocument IDMJob
		    				assign result to IDMSupplementaryJobView
		    				invoked.Actor				= actor
							invoked.Description			= GeneratePayablesPaymentOutputMsg
							invoked.IDMGenerateDocument = IDMGenerateDocument	
							invoked.BypassGetStatus		= true
							
						SupplementaryIDMJob = IDMSupplementaryJobView.IDMJob
							


		GetStatusPaymentDetailFile is a Set Action
			default label is untranslatable
			restricted
			Parameters
				PrmCashManagementGroup			is a CashManagementGroup
					default label is "CashManagementGroup"
				PrmCashManagementAccount		is a CashManagementAccount
					default label is "CashManagementAccount"
				PrmPaymentOutputFileHeader		is a PaymentOutputFileHeader
					default label is "PaymentOutputFileHeader"
				PrmUsePaymentPrinter		 	is Boolean
				PrmPaymentPrinter				is an IDMPrinter	
					default label is "PaymentPrinter"	
				PrmUseSupplementaryPrinter		is Boolean
				PrmSupplementaryPrinter			is an IDMPrinter
					default label is "SupplementaryPrinter"
				PrmInstanceCount				is Numeric 6
					default label is "InstanceCount"
				PrmConsolidateIDMNotification	is Boolean
				PrmPaymentOutputFileDetailRange is a PaymentOutputFileDetailRange

			Local Fields
				LocalAsyncID					is an AsyncActionRequest			
				SamePrinter						is Boolean	
				DifferentPrinter				is Boolean
				Counter							is Numeric 6
				RemittanceCounter				is Numeric 6
				LocalBatchPrintLimit			is Numeric 6
				CheckIDMUniqueIDs				is an IDMUniqueIDOccurs
				RemittanceIDMUniqueIDs			is an IDMUniqueIDOccurs	
				CheckNumbers					is Text
				RemittanceCheckNumbers			is Text
				LocalActor						is an Actor
				CompletedDocuments				is Numeric 6
				FailedDocuments					is Numeric 6

			Accumulators
				NumberOfRecords	
															
			Instance Selection
				where (CashManagementGroup	= PrmCashManagementGroup
				and CashManagementAccount	= PrmCashManagementAccount
				and PaymentOutputFileHeader	= PrmPaymentOutputFileHeader
				and PaymentOutputFileDetail within PrmPaymentOutputFileDetailRange)
					
			Action Rules
				Set Rules
					Entrance Rules
						initialize Counter
						initialize RemittanceCounter
						initialize SamePrinter
						initialize CheckIDMUniqueIDs
						initialize RemittanceIDMUniqueIDs
						initialize LocalCheckNumbers
						initialize CheckNumbers
						initialize RemittanceCheckNumbers
						initialize CompletedDocuments
						initialize FailedDocuments
						CheckNumbers = "Transaction Number(s): "
						RemittanceCheckNumbers = "Transaction Number(s): "
						
						if (PrmUsePaymentPrinter 
						and PrmUseSupplementaryPrinter)
							if (PrmPaymentPrinter = PrmSupplementaryPrinter
							and PaymentOutputFileHeader.CashPaymentFormatRel.PaymentPrinterSetting = PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryPrinterSetting)
								SamePrinter = true
						
						if (PaymentOutputFileHeader.CashPaymentFormatRel.BatchPrintCount > 0)
							LocalBatchPrintLimit = PaymentOutputFileHeader.CashPaymentFormatRel.BatchPrintCount
						else
							LocalBatchPrintLimit = 100
						
						LocalAsyncID = current async action request id			

					Exit Rules
						invoke GetStatusIDMJobPrint in background
							run after LocalAsyncID
							invoked.PrmCashManagementGroup		= PrmCashManagementGroup
							invoked.PrmCashManagementAccount	= PrmCashManagementAccount
							invoked.PrmPaymentOutputFileHeader	= PrmPaymentOutputFileHeader	
							invoked.PrmPaymentOutputFileDetailRange = PrmPaymentOutputFileDetailRange					
						
						if (PrmConsolidateIDMNotification)
							LocalActor = actor
							send notification
								to LocalActor
								description is "<GeneratePayablesPaymentOutputMsg>Completed."
								priority is high
								detail is "<GeneratePayablesPaymentOutputMsg>Completed.TheFilesAreNowAvailableForViewingInIDM.PleaseCheckIDMJobLists.<DerivedNewLine><DerivedNewLine>\Completed:<CompletedDocuments>Document(s).<DerivedNewLine><DerivedNewLine>\Failed:<FailedDocuments>Document(s)."

				Instance Rules
					NumberOfRecords += 1
					if (IDMJob entered)
						invoke GetStatus IDMJob
							invoked.PrmFromGenerateDocument = true
							invoked.PrmConsolidateIDMNotification = PrmConsolidateIDMNotification	
						
						if (IDMJob.GenerationStatus.Finished
						and IDMJob.MDSID entered)
							PaymentIDMUniqueId = IDMJob.MDSID
							CheckNumbers += TransactionNumber
							CompletedDocuments +=1
						else
							FailedDocuments +=1
							
					if (SupplementaryIDMJob entered)
						invoke GetStatus SupplementaryIDMJobRel
							invoked.PrmFromGenerateDocument = true
							invoked.PrmConsolidateIDMNotification = PrmConsolidateIDMNotification
						
						if (SupplementaryIDMJobRel.GenerationStatus.Finished
						and SupplementaryIDMJobRel.MDSID entered)
					 		SupplementaryIDMUniqueId = SupplementaryIDMJobRel.MDSID
							CompletedDocuments +=1
						else
							FailedDocuments +=1
						
						if (SupplementaryIDMJobRel.EmailStatus.Finished)
							IDMEmailSent = true

					if (PrmUsePaymentPrinter or PrmUseSupplementaryPrinter)
						LocalPaymentPrinter 	  = PrmPaymentPrinter
						LocalSupplementaryPrinter = PrmSupplementaryPrinter		
		
						if (PaymentOutputFileHeader.CashPaymentFormatRel.SequentialPrintCheckAndRemittance)
							if (PaymentIDMUniqueId entered)
								invoke PrintCheck
									invoked.PrmPaymentPrinter = PrmPaymentPrinter
									invoked.PrmBypassGetStatus = true

							if 	(SupplementaryIDMUniqueId entered)
								invoke PrintRemittanceAdvice
									invoked.PrmRemittanceAdvicePrinter = PrmSupplementaryPrinter	
									invoked.PrmBypassGetStatus = true						
						else
							if (SamePrinter)
								if (PaymentIDMUniqueId entered)
									Counter += 1
									CheckIDMUniqueIDs.IDMPID[Counter] = PaymentIDMUniqueId
									
								if (SupplementaryIDMUniqueId entered)
									Counter += 1
									CheckIDMUniqueIDs.IDMPID[Counter] = SupplementaryIDMUniqueId
							else
								if (PrmUsePaymentPrinter
								and PrmPaymentPrinter entered
								and PaymentIDMUniqueId entered)
									Counter += 1
									CheckIDMUniqueIDs.IDMPID[Counter]  = PaymentIDMUniqueId
									
								if (PrmUseSupplementaryPrinter
								and PrmSupplementaryPrinter entered
								and SupplementaryIDMUniqueId entered)
									RemittanceCheckNumbers += TransactionNumber
									RemittanceCounter += 1 	
									RemittanceIDMUniqueIDs.IDMPID[RemittanceCounter] = SupplementaryIDMUniqueId

							if (NumberOfRecords = PrmInstanceCount
							or  Counter >= LocalBatchPrintLimit
							or  RemittanceCounter >= LocalBatchPrintLimit)
								if (CheckIDMUniqueIDs entered)
									LocalPrintedDocuments = Counter
									LocalCheckNumbers 	  = CheckNumbers
									initialize LocalCheckIDMUniqueIDs	
									LocalCheckIDMUniqueIDs = CheckIDMUniqueIDs
									include BatchCheckPrint
									initialize LocalPrintedDocuments
									initialize LocalCheckNumbers

								if (RemittanceIDMUniqueIDs entered)
									LocalPrintedDocuments = RemittanceCounter
									LocalCheckNumbers 	  = RemittanceCheckNumbers								
									initialize LocalRemittanceIDMUniqueIDs
									LocalRemittanceIDMUniqueIDs = RemittanceIDMUniqueIDs
									include BatchRemittancePrint
									initialize LocalPrintedDocuments
									initialize LocalCheckNumbers
		
								initialize Counter		
								initialize RemittanceCounter	
								initialize CheckIDMUniqueIDs
								initialize RemittanceIDMUniqueIDs
								initialize LocalCheckIDMUniqueIDs
								initialize LocalRemittanceIDMUniqueIDs							
								initialize LocalCheckNumbers
								initialize CheckNumbers
								initialize RemittanceCheckNumbers
								CheckNumbers = "Transaction Number(s): "							
								RemittanceCheckNumbers = "Transaction Number(s): "
							else
								CheckNumbers += ", "					
								if (SupplementaryIDMUniqueId entered)
									RemittanceCheckNumbers += ", "
							
		SendRemittanceAdvice is a Set Action
			default label is untranslatable
			restricted
			Parameters
				PrmPaymentOutpuFileHeader		is a PaymentOutputFileHeader
				PrmCashManagementGroup			is a CashManagementGroup
				PrmCashManagementAccount		is a CashManagementAccount
				PrmSupplementaryTemplate		is an IDMTemplate
				PrmSupplementaryFilename		is Alpha size 20
				PrmFromEmail					is an EmailAddress
					holds pii
				PrmEmailSubject					is Alpha 255				
				PrmEmailTemplate				is an IDMTemplate
				PrmConsolidateIDMNotification	is Boolean
			Local Fields
				LocalActor						is Actor
				LocalVendorNoEmailFlag			is Boolean
				LocalTransactionNotEmailed      is Text
				CompletedDocuments				is Numeric 6
				FailedDocuments					is Numeric 6
			Instance Selection
				where (CashManagementGroup	= PrmCashManagementGroup
				and CashManagementAccount	= PrmCashManagementAccount
				and PaymentOutputFileHeader	= PrmPaymentOutpuFileHeader
				and SupplementaryIDMUniqueId entered)
			Action Rules
				Set Rules
					Entrance Rules
						initialize CompletedDocuments
						initialize FailedDocuments
					Exit Rules
						LocalActor = actor
						if (LocalVendorNoEmailFlag)
							send notification												
								to LocalActor
								description is "EmailRemittanceAdviceCompletedForAccount:<PrmCashManagementAccount>,PaymentRunNumber:<PrmPaymentOutpuFileHeader>."
								priority is medium
								detail is "Remittance_AdviceSent:<CompletedDocuments>Document(s).<DerivedNewLine><DerivedNewLine>\Remittance_AdviceNotSent:<FailedDocuments>Document(s).<DerivedNewLine><DerivedNewLine>\TheVendor'sEmailAddressHasNotBeenSetUpForTheFollowing_Transaction_Identifier:<DerivedNewLine>\<LocalTransactionNotEmailed>."
						else
							send notification												
								to LocalActor
								description is "EmailRemittanceAdviceCompletedForAccount:<PrmCashManagementAccount>,PaymentRunNumber:<PrmPaymentOutpuFileHeader>."
								priority is medium
								detail is "Remittance_AdviceSent:<CompletedDocuments>Document(s).<DerivedNewLine><DerivedNewLine>\Remittance_AdviceNotSent:<FailedDocuments>Document(s).PleaseCheck_IDM_JobLists."
				Instance Rules
					if (DerivedEmailTo not entered)
						LocalVendorNoEmailFlag   = true
						if (LocalTransactionNotEmailed entered)
							LocalTransactionNotEmailed += ", "
						LocalTransactionNotEmailed += CashLedgerTransactionIdentifier
						FailedDocuments +=1
					else
					if (EmailRemittanceToVendor
					and IsVendorPrimaryContactEmailRemittanceAdviceEnabled)
						invoke EmailRemittanceAdviceToVendor
							invoked.PrmFromEmail	 = PrmFromEmail
							invoked.PrmToEmail       = DerivedEmailTo
							invoked.PrmCcEmail		 = DerivedEmailCc
							invoked.PrmEmailSubject	 = PrmEmailSubject		
							invoked.PrmEmailTemplate = PrmEmailTemplate
							invoked.PrmConsolidateIDMNotification = PrmConsolidateIDMNotification
						if (SupplementaryIDMJobRel.EmailStatus.Finished)
							CompletedDocuments += 1
						else
							FailedDocuments +=1


														
		EmailRemittanceAdviceToVendor is an Instance Action
			valid when (EmailRemittanceToVendor)
			disable multiple instance selection
			default label is  "EmailRemittanceAdvice"
			Local Fields
				IDMJobView			is an IDMJob view
			Parameters
				PrmFromEmail		is an EmailAddress 
					holds pii
					default label is "From"
				PrmToEmail			is like MultipleEmailAddress 
					holds pii
					default label is "To"
				PrmCcEmail			is like MultipleEmailAddress 
					holds pii
					default label is "Cc"
				
				PrmEmailSubject is Alpha 255
					default label is "Subject"
					Text Variables
						RemittanceAdviceFilename
						CashCode
						BankTransactionCode
						TransactionNumber
						PaymentDate
						VendorName
				
				PrmEmailTemplate is an IDMTemplate
					default label is "EmailTemplate"

				PrmConsolidateIDMNotification		is Boolean
				
			Parameter Rules
				PrmFromEmail
					initial value is DerivedEmailFrom
					required

				PrmToEmail
					initial value is DerivedEmailTo
					required

				PrmCcEmail
					initial value is DerivedEmailCc
				
				PrmEmailSubject
					initial value is PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryEmailSubject
						
				PrmEmailTemplate
					initial value is PaymentOutputFileHeader.CashPaymentFormatRel.SupplementaryEmailTemplate
					constraint (PrmEmailTemplate.IDMDocumentType.PayablesPaymentOutputEmail)
						"InvalidTemplate"
				
				PrmConsolidateIDMNotification
					default to false
			
			Action Rules					
				initialize IDMItem
				IDMItem.DocumentType  	 		= "FSM_PayablesPaymentOutput"
				IDMItem.IDMUniqueId	  			= SupplementaryIDMUniqueId

				include SetIDMXMLDefinition	
				
				IDMItem.IDMEmail.From 	 		= PrmFromEmail
				IDMItem.IDMEmail.To   	 		= PrmToEmail
				IDMItem.IDMEmail.Cc				= PrmCcEmail
				LocalIDMEmailSubject			= PrmEmailSubject
				if (PrmEmailSubject entered)
					IDMItem.IDMEmail.Subject	= LocalIDMEmailSubject text
				else
					IDMItem.IDMEmail.Subject	= DerivedSupplementaryEmailSubject

				if (PrmEmailTemplate entered)
					IDMItem.EmailTemplateUniqueID = PrmEmailTemplate.IDMUniqueId
				else
					IDMItem.IDMEmail.Body   	  = RemittanceAdviceEmailBody								

				constraint (IDMItem.GetItemDetails)
					"DocumentDoesNotExistInIDM"

				IDMItem.IDMPID    			 = IDMItem.IDMItemDetails.PID
				TransientEmailFrom			 = PrmFromEmail
				IDMItem.IDMXMLDefinition 	 = IDMGenerateDocument.IDMXMLDefinition

				invoke SendToEmail IDMJob
					assign result to IDMJobView
					invoked.LongDescription   = EmailNotificationMsg
					invoked.FileName      	  = DerivedSupplementaryOutputFilename
					invoked.IDMItem		      = IDMItem
					invoked.ConsolidateIDMNotification = PrmConsolidateIDMNotification

				SupplementaryIDMJob = IDMJobView.IDMJob
				
				invoke UpdateIDMEmailSent in background
					run after IDMJobView.IDMJob.AsyncId

		UpdateIDMEmailSent is an Instance Action
			default label is untranslatable
			restricted
			Action Rules
				if (SupplementaryIDMJobRel.EmailStatus.Finished)
					IDMEmailSent = true		
					
		SaveIDMXML is an Instance Action
			default label is "SaveXML"
			completion message is "XMLFileGenerated.PleaseCheckTheFileIn_Saved_XMLPanel."
			Exit Rules
				LocalGenerateXMLFile = true
				include SetIDMXMLDefinition

				constraint (IDMXMLDefinition.GenerateXML)
					"ErrorOccuredInIDMXMLDefinition.GenerateXML"
			
				IDMXMLFile = IDMXMLDefinition.OutputAttachment

		MarkCheckAsPrintedSet is a Set Action
			default label is untranslatable
			valid when (CheckVersioningEnabled)

			restricted
			Local Fields
			    LocalExecute					is Boolean
    			IDMAttributes	
    			IDMPaymentJobView	 			is an IDMJob view		
				LocalAsyncID					is an AsyncActionRequest
				
			Parameters
				PrmCashManagementGroup			is a CashManagementGroup
				PrmCashManagementAccount		is a CashManagementAccount
				PrmPaymentOutputFileHeader		is a PaymentOutputFileHeader
				PrmAllRecords					is Boolean
				PrmPaymentOutputFileDetailRange is a PaymentOutputFileDetailRange
			
			Instance Selection
				where (CashManagementGroup	= PrmCashManagementGroup
				and CashManagementAccount	= PrmCashManagementAccount
				and PaymentOutputFileHeader	= PrmPaymentOutputFileHeader
				and PaymentOutputFileDetail within PrmPaymentOutputFileDetailRange			
				and HasCheckIDMDocument 
				and not CheckPrinted)

			Action Rules
				Set Rules
					Entrance Rules
						LocalAsyncID = current async action request id
						
					Exit Rules
						invoke GetStatusCheckVersion in background
							run after LocalAsyncID
							invoked.PrmCashManagementGroup		    = PrmCashManagementGroup
							invoked.PrmCashManagementAccount	    = PrmCashManagementAccount
							invoked.PrmPaymentOutputFileHeader	    = PrmPaymentOutputFileHeader	
							invoked.PrmPaymentOutputFileDetailRange = PrmPaymentOutputFileDetailRange						
					
				Instance Rules
					CheckPrinted = true 
					include SetIDMXMLDefinition
					include SetCheckVersionAttributes

					invoke CreateFromGenerateDocument IDMJob
						assign result to IDMPaymentJobView
						invoked.Actor							= actor
						invoked.Description						= GeneratePayablesPaymentOutputMsg
						invoked.IDMGenerateDocument 			= IDMGenerateDocument	
						invoked.BypassGetStatus					= true
											
					IDMJob = IDMPaymentJobView.IDMJob

		GetStatusCheckVersion is a Set Action
			default label is untranslatable
			restricted
			Parameters
				PrmCashManagementGroup			is a CashManagementGroup
					default label is "CashManagementGroup"
				PrmCashManagementAccount		is a CashManagementAccount
					default label is "CashManagementAccount"
				PrmPaymentOutputFileHeader		is a PaymentOutputFileHeader
					default label is "PaymentOutputFileHeader"
				PrmPaymentOutputFileDetailRange is a PaymentOutputFileDetailRange

			Local Fields
				LocalActor						is Actor
				CompletedDocuments				is Numeric 6
				FailedDocuments					is Numeric 6

			Instance Selection
				where (CashManagementGroup	= PrmCashManagementGroup
				and CashManagementAccount	= PrmCashManagementAccount
				and PaymentOutputFileHeader	= PrmPaymentOutputFileHeader
				and PaymentOutputFileDetail within PrmPaymentOutputFileDetailRange
				and HasCheckIDMDocument
				and (IDMJob entered and IDMJob.Status.Submitted))
					
			Action Rules
				Set Rules
					Entrance Rules
						initialize CompletedDocuments
						initialize FailedDocuments

					Exit Rules
						LocalActor = actor
						send notification												
							to LocalActor
							description is "MarkAsPrintedCompletedForAccount:<PrmCashManagementAccount>,PaymentRunNumber:<PrmPaymentOutputFileHeader>."
							priority is medium
							detail is "PleaseCheck_IDM_Job_List.<DerivedNewLine>\Completed:<CompletedDocuments>Document(s).<DerivedNewLine><DerivedNewLine>\Failed:<FailedDocuments>Document(s)."

				Instance Rules
					invoke GetStatus IDMJob
						invoked.PrmFromGenerateDocument = true
						invoked.PrmConsolidateIDMNotification = true
					invoke GetFileAndUpdateInIDM
					if (CheckPrinted)
						CompletedDocuments += 1
					else
						FailedDocuments += 1


		GetFileAndUpdateInIDM is an Instance Action
			restricted
			Local Fields
				LocalAttachment is an IDMAttachment
			Action Rules
				if (IDMJob.GenerationStatus.Finished
				and IDMJob.MDSID entered)

					IDMItem.IDMUniqueId  	     = IDMJob.MDSID 
					IDMItem.DocumentType 		 = "FSM_PayablesPaymentOutput" 
					if (IDMItem.RetrieveResource)
						LocalAttachment	 = IDMItem.RetrievedAttachment

					if (LocalAttachment.MimeType entered)
						IDMItem.IDMUniqueId	   	= PaymentIDMUniqueId
						IDMItem.FileName		= LocalAttachment.Title
						IDMItem.Attachment     	= LocalAttachment
						IDMItem.IDMAccessControlList = "CSFDefined"
						IDMItem.IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName	= "Status"	
						IDMItem.IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue	= "Printed"			
						Execute 	           	= IDMItem.Update	
						CheckPrinted            = Execute 
				else
					CheckPrinted = false


		MarkCheckAsPrinted is an Instance Action
			default label is "Mark_\Check_as_\Printed"
			valid when (ValidForMarkCheckAsPrinted)
			Action Rules
				CheckPrinted = true 
				invoke GenerateCheckVersion


		MarkCheckAsUnprinted is an Instance Action
			default label is "Mark_\Check_as_\Unprinted"
			valid when (ValidForMarkCheckAsUnprinted)
			Action Rules	
				CheckPrinted = false 
				invoke GeneratePaymentCheck


		GenerateCheckVersion is an Instance Action
			restricted
			valid when (CheckVersioningEnabled)
			Local Fields
		        IDMAttributes	
		        IDMPaymentJobView	 			is an IDMJob view		
		
		    Action Rules
				include SetIDMXMLDefinition
				include SetCheckVersionAttributes
		        
		        invoke CreateFromGenerateDocument IDMJob
		            assign result to IDMPaymentJobView
		            invoked.Actor				= actor
		            invoked.Description			= GeneratePayablesPaymentOutputMsg
		            invoked.IDMGenerateDocument = IDMGenerateDocument	
		        
		        IDMJob = IDMPaymentJobView.IDMJob

		        invoke GetFileAndUpdateInIDM in background
		            run after IDMJob.AsyncId
