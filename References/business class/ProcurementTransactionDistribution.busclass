ProcurementTransactionDistribution is a BusinessClass
    owned by po
    prefix is MMD
    sql name is PTransactionDistribution
    classic name is MMDIST

    Ontology
        symbolic key is ProcurementTransactionDistribution

    Patterns
        implements StaticJava
        disable AuditIndex
        implements Archivable

    Persistent Fields

        SystemCode					is a GeneralLedgerSystemCode
            classic name is SYSTEM-CD
        Location                    is an InventoryLocation
        DocumentType
            classic name is DOC-TYPE
        ProcurementDocumentNumber
            classic name is DOC-NUMBER
        DocumentNumberNumeric
            classic name is DOC-NBR-NUM
        POCode
        LineNumber
            classic name is LINE-NBR
        ComponentSequence           is a PurchaseSequence
            classic name is COMPONENT-SEQ
        LineSequence                is a PurchaseSequence
            classic name is LINE-SEQ
        AddOnCharge
            classic name is AOC-CODE
        RequestingLocation
            classic name is REQ-LOCATION


        AssetTemplate
        Asset
        DistributionPercent         is a TotalPercent
            classic name is DIST-PERCENT
        DistributionQuantity        is a Quantity
            classic name is DIST-QTY
        DistributionAmount          is an InternationalAmount
            classic name is DIST-AMOUNT
        PostingType                 is AlphaUpper size 2
            States
                Inventory           value is "I1"
                Offset              value is "O1"
                RniExpenseAccount   value is "E1"
                    default label is "RNI Expense Account"
                ReceivedNotInvoiced value is "RN"
                MatchedNotReceived  value is "MN"
                AddOnCost           value is "A"
        Status                      is Numeric size 1
            States
                Unposted      value is 0
                Posted        value is 1
                NotToBePosted value is 2
                    default label is "Not to be Posted"
        PostedDate                  is TimeStamp
        GltObjId                    is an ObjId
        AtnObjId                    is an ObjId


        PullForFinancialReporting   is Boolean
            classic name is PULL-FOR-FR-FL
        ReceivedNotInvoicedObjectID is an ObjId
            classic name is RNI-OBJ-ID
        SpaObjId                    is an ObjId
        SpgObjId                    is an ObjId
        SppObjId                    is an ObjId
        CreatedBy                   is an Operator 
        	holds pii
        LastUpdateDate              is TimeStamp
            classic name is LAST-UPDT-DATE
        LastUpdateBy                is an Operator 
        	holds pii
        DistributionAccount         is a TransactionCodeBlock
            classic name for DistributionAccount.ToAccountingEntity is DIST-COMPANY
            classic name for DistributionAccount.AccountingUnit is ACCT-UNIT
            classic name for DistributionAccount.GeneralLedgerChartAccount is ACCOUNT
            classic name for DistributionAccount.Project is ACTIVITY
        Vendor
        PayablesInvoice

	Local Fields

    Conditions

        HasATNObjectID
            classic name is ATN-OBJ-ID-EX
            restricted
            when (AtnObjId entered)

        FromInventoryControl
            classic name is FROM-IC
            restricted
            when (SystemCode = "IC")

        FromPO
        	restricted
            when (SystemCode = "PO"
            and   DocumentType.PurchaseOrderTemplateNewPo)

        ForPOReceipt
            classic name is FROM-RECEIVING
            restricted
            when (DocumentType.PoReceiving
            or    DocumentType.ReceivingAdjustment
            or    DocumentType.InspectionReject)

        FromRequisitionLine
            classic name is FROM-REQLINE
            restricted
            when (SystemCode = "RQ" 
            and   DocumentType.Requisition)

        FromVendorReturn
            classic name is FROM-RETURN
            restricted
            when (DocumentType.VendorReturn)

        FromRequisition
            classic name is FROM-RQ
            restricted
            when (SystemCode = "RQ")

        HasActivity
        	restricted
            when (DistributionAccount.Project entered)

        PurchaseOrderAuditExists
            classic name is HAS-POAUDIT
            restricted
            when (SystemCode = "PO" 
            and   first PurchaseOrderAuditsRel exists)

        IsForFinancialReporting
            classic name is IC-FIN-RPTG-D
            restricted
            when (PullForFinancialReporting)

        IsPullForFinancialReporting
            classic name is IC-FIN-RPTING
            restricted
            when (PullForFinancialReporting)

        IsIntercompany
        	restricted
            when (Company != DistributionAccount.ToAccountingEntity)

        FromInterface
            classic name is INTERFACE
            restricted
            when (DocumentType.Interface)

        FromPayables
            classic name is MMDSET5-AP
            restricted
            when (SystemCode = "AP")

        NotPOMNR
            classic name is NOT-PO-MNR
            restricted
            when (not PostingType.MatchedNotReceived)

        NotPORNI
            classic name is NOT-PO-RNI
            restricted
            when (LineSequence != 999)

        ForPurchaseOrderLine
            classic name is PO-MMDIST
            restricted
            when (SystemCode = "PO" 
            and   DocumentType.PurchaseOrderTemplateNewPo
            and   LineSequence <  997)

        ForPurchaseOrderOrRequisition
            classic name is PO-OR-RQ
            restricted
            when (SystemCode = "PO" 
            and   DocumentType.PurchaseOrderTemplateNewPo
            and   LineSequence <  997
            or    SystemCode = "RQ" 
            and   DocumentType.Requisition)

        FromPOReceipt
            classic name is PO-RECEIVING
            restricted
            when (DocumentType.PoReceiving)

        IsPosted
        	restricted
            when (GltObjId entered)

        HasRNIObjectID
            classic name is RNI-OBJ-ID-EX
            restricted
            when (ReceivedNotInvoicedObjectID entered)

        IsToRequisitionLine
            classic name is TO-REQLINE
            restricted
            when (SystemCode = "RQ"  
            and   (DocumentType.DirectTransfer
                or    DocumentType.Issue
                or    DocumentType.TransferIssue))

        UnpostedRequisitionOrPO
            classic name is UNPOSTED-PO-RQ
            restricted
            when (Status.Unposted
            and   SystemCode = "PO"  
            and   not DocumentType.VendorReturnAdjustment
            and   not DocumentType.VendorReturn
            or    SystemCode = "RQ" 
            and   DocumentType.Issue
            or    DocumentType.RequisitionReturn)

    Relations
















        PoaocdtlRel
            one-to-one relation to PurchaseOrderAndLineAddOnCharge
            valid when (FromPO)
            required
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.PurchaseOrder  			= ProcurementDocumentNumber
                related.PurchaseOrderLine       = LineNumber
                related.AddOnCharge             = AddOnCharge

        PurchaseOrderAuditsRel
            one-to-many relation to PurchaseOrderAudit
            Field Mapping uses Set4
                related.Company = Company
            Instance Selection
                where (related.PurchaseOrder 					= ProcurementDocumentNumber
                and   related.PurchaseOrderLine 				= LineNumber
                and   related.AddOnCharge 						= AddOnCharge
                and   related.PurchaseOrderAudit.LineSequence 	= LineSequence)

        PolineRel
            one-to-one relation to PurchaseOrderLine
            valid when (FromPO)
            required
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.PurchaseOrder  			= ProcurementDocumentNumber
                related.PurchaseOrderLine       = LineNumber










        PoreturnhdRel
            one-to-one relation to VendorReturn
            valid when (FromVendorReturn)
            required
            Field Mapping uses symbolic key
                related.Company      = Company
                related.VendorReturn = DocumentNumberNumeric

        PoreturnlnRel
            one-to-one relation to VendorReturnLine
            valid when (FromVendorReturn)
            required
            Field Mapping uses symbolic key
                related.Company          = Company
                related.VendorReturn     = DocumentNumberNumeric
                related.VendorReturnLine = LineNumber

        PurchorderRel
            one-to-one relation to PurchaseOrder
            valid when (FromPO)
            required
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.PurchaseOrder  			= ProcurementDocumentNumber

        ReqlineRel
            one-to-one relation to RequisitionLine

            Field Mapping uses symbolic key
                related.Company         = Company
                related.Requisition     = DocumentNumberNumeric
                related.RequisitionLine = LineNumber

    Sets

        Set1
            indexed
            Sort Order
                Company
                SystemCode
                Location
                DocumentType
                ProcurementDocumentNumber
                DocumentNumberNumeric
                POCode
                LineNumber
                ComponentSequence
                AddOnCharge
                LineSequence
                RequestingLocation

                PayablesInvoice

        Set10
            indexed
            Instance Selection
                where (IsPullForFinancialReporting)
            Sort Order
                Company
                SystemCode
                Location
                DocumentType
                ProcurementDocumentNumber
                DocumentNumberNumeric
                POCode
                LineNumber
                ComponentSequence
                AddOnCharge
                LineSequence
                RequestingLocation

                PayablesInvoice

        Set11
            indexed
            Sort Order
                Company
                SystemCode
                Location
                DocumentType
                ProcurementDocumentNumber
                DocumentNumberNumeric
                POCode
                LineNumber
                ComponentSequence
                AddOnCharge
                LineSequence

                PayablesInvoice
                RequestingLocation

        Set12
            indexed
            Instance Selection
                where (HasRNIObjectID)
            Sort Order
                ReceivedNotInvoicedObjectID
                Company
                SystemCode
                Location
                DocumentType
                ProcurementDocumentNumber
                DocumentNumberNumeric
                LineNumber
                ComponentSequence
                LineSequence

		Set13
			indexed
			Sort Order
				Company
				PostedDate
				LastUpdateDate
				ProcurementTransactionDistribution

        Set2
            indexed
            Instance Selection
                where (HasATNObjectID)
            Sort Order
                AtnObjId
                Company
                SystemCode
                Location
                DocumentType
                ProcurementDocumentNumber
                DocumentNumberNumeric
                LineNumber
                ComponentSequence
                LineSequence

        Set3
            indexed
            Instance Selection
                where (IsPosted)
            Sort Order
                GltObjId
                Company
                SystemCode
                Location
                DocumentType
                ProcurementDocumentNumber
                DocumentNumberNumeric
                LineNumber
                ComponentSequence
                LineSequence

        Set4
            indexed
            Instance Selection
                where (ForPurchaseOrderLine)
            Sort Order
                Company
                ProcurementDocumentNumber
                DocumentNumberNumeric
                POCode
                LineNumber
                AddOnCharge
                LineSequence

        Set5
            indexed
            Instance Selection
                where (FromPayables)
            Sort Order
                Company

                PayablesInvoice
                LineNumber
                AddOnCharge
                LineSequence

        Set6
            indexed


            Sort Order
                Company
                SystemCode
                ProcurementDocumentNumber
                DocumentNumberNumeric
                RequestingLocation
                LineNumber
                LineSequence

        Set7
            indexed
            Instance Selection
                where (UnpostedRequisitionOrPO)
            Sort Order
                Company
                SystemCode
                DocumentType
                ProcurementDocumentNumber
                DocumentNumberNumeric
                LineNumber
                LineSequence
                ComponentSequence

        Set8
            indexed
            Instance Selection
                where (FromRequisitionLine)
            Sort Order
                Company
                DocumentNumberNumeric
                LineNumber
                LineSequence

        Set9
            indexed
            Instance Selection
                where (ForPurchaseOrderOrRequisition)
            Sort Order
                Company
                SystemCode
                DocumentType
                ProcurementDocumentNumber
                DocumentNumberNumeric
                POCode
                LineNumber
                AddOnCharge
                LineSequence

	Field Rules
		LineSequence
			autosequence using Set1


	Actions
		Create is a Create Action
		
		Update is an Update Action

		Delete is a Delete Action
		
		Purge is a Purge Action
			restricted
			
