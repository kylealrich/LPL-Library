AssetTransferFund is a BusinessClass
	owned by am
	prefix is ATrnF
	
	Ontology
		symbolic key is AssetTransferFund
		
	Patterns
		implements StaticJava
		
	Persistent Fields
		AccountingEntity				
		AccountingUnit					
		Fund 							is an AssetFundField	
		Project			
		FinanceDimension1
		FinanceDimension2
		FinanceDimension3
		FinanceDimension4
		FinanceDimension5
		FinanceDimension6
		FinanceDimension7
		FinanceDimension8
		FinanceDimension9
		FinanceDimension10
		TransactionAmount				is an InternationalAmount
			default label is "Amount"
			precision is LocalCurrency.NumberOfDecimals 
		PercentContribution				is Percent size 9.6
			
	Transient Fields
		TestCodeBlock 					is a FinanceCodeBlockNoAccountFull
		LocalCurrency					is a FromCurrency
			derive value from Asset.Currency
		TransientAccountingEntity		is an AccountingEntity	
			derive value from AssetTransferFund.AccountingEntity		
		TransientAccountingUnit			is an AccountingUnit		
			derive value from AssetTransferFund.AccountingUnit
			context of TransientAccountingEntity
		TransientProject 				is a Project				
			derive value from AssetTransferFund.Project
		TransientFinanceDimension1		is a FinanceDimension1							
			derive value from AssetTransferFund.FinanceDimension1
		TransientFinanceDimension2		is a FinanceDimension2					
			derive value from AssetTransferFund.FinanceDimension2
		TransientFinanceDimension3		is a FinanceDimension3					
			derive value from AssetTransferFund.FinanceDimension3
		TransientFinanceDimension4		is a FinanceDimension4			
			derive value from AssetTransferFund.FinanceDimension4
		TransientFinanceDimension5		is a FinanceDimension5					
			derive value from AssetTransferFund.FinanceDimension5
		TransientFinanceDimension6		is a FinanceDimension6					
			derive value from AssetTransferFund.FinanceDimension6
		TransientFinanceDimension7		is a FinanceDimension7					
			derive value from AssetTransferFund.FinanceDimension7
		TransientFinanceDimension8		is a FinanceDimension8			
			derive value from AssetTransferFund.FinanceDimension8
		TransientFinanceDimension9		is a FinanceDimension9					
			derive value from AssetTransferFund.FinanceDimension9
		TransientFinanceDimension10		is a FinanceDimension10		
			derive value from AssetTransferFund.FinanceDimension10
		TransientTransactionAmount		is an InternationalAmount
			derive value from AssetTransferFund.TransactionAmount
		TransientPercentContribution	is Percent size 9.6		
			derive value from AssetTransferFund.PercentContribution	

	Local Fields
		LocalToAsset					 is like Asset	
		LocalAccountingEntity			 is like AccountingEntity
		LocalAccountingUnit				 is like AccountingUnit
		LocalFund 						 is an AssetFundField
		LocalAssetItem					 is like AssetItem
		LocalAssetItemTransferFundsTotal is an InternationalAmount
		LocalItemCost					 is an InternationalAmount
		AllocatedPercent				 is an Percent
		FundCount						 is Numeric 3
		F1								 is Numeric 3	
		LocalPercentContribution		is Percent size 9.6
		LocalTransactionAmount			is an InternationalAmount

	Derived Fields
		DerivedCodeBlock is a DerivedField
			type is Boolean	
			TestCodeBlock.ToAccountingEntity = TransientAccountingEntity			
			TestCodeBlock.AccountingUnit 	= TransientAccountingUnit	
			TestCodeBlock.Project			= TransientProject 						
			TestCodeBlock.FinanceDimension1	= TransientFinanceDimension1						
			TestCodeBlock.FinanceDimension2 = TransientFinanceDimension2				
			TestCodeBlock.FinanceDimension3 = TransientFinanceDimension3				
			TestCodeBlock.FinanceDimension4 = TransientFinanceDimension4	
			TestCodeBlock.FinanceDimension5 = TransientFinanceDimension5			
			TestCodeBlock.FinanceDimension6 = TransientFinanceDimension6			
			TestCodeBlock.FinanceDimension7 = TransientFinanceDimension7				
			TestCodeBlock.FinanceDimension8 = TransientFinanceDimension8		
			TestCodeBlock.FinanceDimension9 = TransientFinanceDimension9					
			TestCodeBlock.FinanceDimension10 = TransientFinanceDimension10
			DerivedCodeBlock = true
			return DerivedCodeBlock

		WholeNumberPercent is a DerivedField
			type is Numeric 3		
			return (PercentContribution * 100)
				
		DerivedTransactionAmount is a DerivedField
			type is like InternationalAmount
			return sum AssetItemTransferFundsRel.TransactionAmount	
			
	Conditions
		FundOverride
			restricted
			when (Asset.FundOverride)
			
		UpdateAllowed
			restricted
			when (Asset.IsEnteredOrPostActiveProcess
			and FundOverride)	
			
		AccountingUnitIsFundDimension
			restricted
			when (FinanceEnterpriseGroup.FundDimension = 1)
			
        AccountingUnitSelected
        	when (AssetFundControlRel.AccountingUnit)
        ProjectSelected
        	when (AssetFundControlRel.Project)      	
		FinanceDimension1Selected
        	when (AssetFundControlRel.FinanceDimension1)
		FinanceDimension2Selected
        	when (AssetFundControlRel.FinanceDimension2)
		FinanceDimension3Selected
        	when (AssetFundControlRel.FinanceDimension3)
		FinanceDimension4Selected
        	when (AssetFundControlRel.FinanceDimension4)
		FinanceDimension5Selected
        	when (AssetFundControlRel.FinanceDimension5)
		FinanceDimension6Selected
        	when (AssetFundControlRel.FinanceDimension6)
		FinanceDimension7Selected
        	when (AssetFundControlRel.FinanceDimension7)
		FinanceDimension8Selected
        	when (AssetFundControlRel.FinanceDimension8)
		FinanceDimension9Selected
        	when (AssetFundControlRel.FinanceDimension9)
		FinanceDimension10Selected
        	when (AssetFundControlRel.FinanceDimension10)
        ModifiedDuringTransfer        
           	when (AssetFundRel.PercentContribution != PercentContribution)	
        	
		
	Relations
		AssetFundControlRel
			one-to-one relation to AssetFundControl
			Field Mapping uses symbolic key
				related.AssetFundControl		= FinanceEnterpriseGroup
							
		ThisInstanceRel
			one-to-one relation to AssetTransferFund
			Field Mapping uses ByAssetTransferFund				
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.Asset					= Asset 
				related.AccountingEntity		= AccountingEntity		
				related.AccountingUnit			= AccountingUnit
				related.Project					= Project
				related.FinanceDimension1		= FinanceDimension1
				related.FinanceDimension2		= FinanceDimension2
				related.FinanceDimension3		= FinanceDimension3				
				related.FinanceDimension4		= FinanceDimension4
				related.FinanceDimension5		= FinanceDimension5
				related.FinanceDimension6		= FinanceDimension6		
				related.FinanceDimension7		= FinanceDimension7
				related.FinanceDimension8		= FinanceDimension8
				related.FinanceDimension9		= FinanceDimension9
				related.FinanceDimension10		= FinanceDimension10


	   	AssetItemsRel
            one-to-many relation to AssetItem
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
                related.Asset 					= Asset

		AssetTransferFundsRel
			one-to-many relation to AssetTransferFund
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.Asset					= Asset 
						
		AssetItemTransferFundsRel
			one-to-many relation to AssetItemTransferFund
			Field Mapping uses ByTransferFundItem
				related.Asset					= Asset 
				related.AccountingEntity		= AccountingEntity		
				related.AccountingUnit			= AccountingUnit
				related.Project					= Project
				related.FinanceDimension1		= FinanceDimension1
				related.FinanceDimension2		= FinanceDimension2
				related.FinanceDimension3		= FinanceDimension3				
				related.FinanceDimension4		= FinanceDimension4
				related.FinanceDimension5		= FinanceDimension5
				related.FinanceDimension6		= FinanceDimension6		
				related.FinanceDimension7		= FinanceDimension7
				related.FinanceDimension8		= FinanceDimension8
				related.FinanceDimension9		= FinanceDimension9
				related.FinanceDimension10		= FinanceDimension10
				
		AllAssetItemTransferFundsRel
			one-to-many relation to AssetItemTransferFund
			Field Mapping uses ByTransferFundItem
				related.Asset					= Asset 
			
		AssetItemTransferFundRel		
			one-to-one relation to AssetItemTransferFund
			Field Mapping uses ByTransferFundItem
				related.Asset					= Asset 
				related.AccountingEntity		= LocalAccountingEntity		
				related.AccountingUnit			= LocalAccountingUnit
				related.Project					= Project
				related.FinanceDimension1		= FinanceDimension1
				related.FinanceDimension2		= FinanceDimension2
				related.FinanceDimension3		= FinanceDimension3				
				related.FinanceDimension4		= FinanceDimension4
				related.FinanceDimension5		= FinanceDimension5
				related.FinanceDimension6		= FinanceDimension6		
				related.FinanceDimension7		= FinanceDimension7
				related.FinanceDimension8		= FinanceDimension8
				related.FinanceDimension9		= FinanceDimension9
				related.FinanceDimension10		= FinanceDimension10
				related.AssetItem				= LocalAssetItem	

		AssetFundRel		
			one-to-one relation to AssetFund
			Field Mapping uses ByAssetFund
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.Asset					= Asset 
				related.RecordType				= 0 
				related.AccountingEntity		= AccountingEntity		
				related.AccountingUnit			= AccountingUnit
				related.Project					= Project
				related.FinanceDimension1		= FinanceDimension1
				related.FinanceDimension2		= FinanceDimension2
				related.FinanceDimension3		= FinanceDimension3				
				related.FinanceDimension4		= FinanceDimension4
				related.FinanceDimension5		= FinanceDimension5
				related.FinanceDimension6		= FinanceDimension6		
				related.FinanceDimension7		= FinanceDimension7
				related.FinanceDimension8		= FinanceDimension8
				related.FinanceDimension9		= FinanceDimension9
				related.FinanceDimension10		= FinanceDimension10

		ToAssetFundRel		
			one-to-one relation to AssetFund
			Field Mapping uses ByAssetFund
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.Asset					= AssetTransfer.AssetTransferTo.ToAsset 
				related.RecordType				= 0
				related.AccountingEntity		= AccountingEntity		
				related.AccountingUnit			= AccountingUnit
				related.Project					= Project
				related.FinanceDimension1		= FinanceDimension1
				related.FinanceDimension2		= FinanceDimension2
				related.FinanceDimension3		= FinanceDimension3				
				related.FinanceDimension4		= FinanceDimension4
				related.FinanceDimension5		= FinanceDimension5
				related.FinanceDimension6		= FinanceDimension6		
				related.FinanceDimension7		= FinanceDimension7
				related.FinanceDimension8		= FinanceDimension8
				related.FinanceDimension9		= FinanceDimension9
				related.FinanceDimension10		= FinanceDimension10

		ToAssetItemFundsRel		
			one-to-many relation to AssetItemFund
			Field Mapping uses ByAssetFundItem
				related.Asset					= AssetTransfer.AssetTransferTo.ToAsset 
				related.RecordType	    		= 0
												
		LocalItemTransfersRel
            one-to-many relation to AssetItemTransfer
            Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= Asset.FinanceEnterpriseGroup
				related.Asset					= Asset
				related.AssetTransfer			= AssetTransfer
				related.AssetItem				= LocalAssetItem
				

					
	Sets
		ByAssetTransferFund
			Sort Order
				FinanceEnterpriseGroup
				Asset
				AccountingEntity
				AccountingUnit
				Project			
				FinanceDimension1				
				FinanceDimension2
				FinanceDimension3
				FinanceDimension4
				FinanceDimension5
				FinanceDimension6
				FinanceDimension7
				FinanceDimension8
				FinanceDimension9
				FinanceDimension10

								
	Field Rules

	Rule Blocks
		UpdateFund
			if (Asset.FundOverride = true)
				TransactionAmount 	= (PercentContribution * AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost)		
			else
				TransactionAmount	= sum AssetItemTransferFundsRel.TransactionAmount
				PercentContribution = (TransactionAmount / AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost)			

		UpdateTransferFund
			if (Asset.FundOverride = true)
				TransactionAmount 	= (PercentContribution * AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost)		
			else
				TransactionAmount	= sum AssetItemTransferFundsRel.TransactionAmount
				if (AssetTransfer.ItemTotalTransactionCost = sum AssetTransferFundsRel.TransactionAmount) 
					initialize F1
					FundCount = instance count of AssetTransferFundsRel
					for each AssetTransferFundsRel
						F1 += 1 
						invoke NoEditUpdate each
							if (F1 < FundCount)
								PercentContribution 	= (TransactionAmount / AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost)
								AllocatedPercent		+= PercentContribution
							else
								PercentContribution 	= (1 - AllocatedPercent)

	Actions
		Create is an Action
			valid when (UpdateAllowed)

			Field Rules
				PercentContribution
					if (Asset.FundOverride)
						constraint (PercentContribution entered)
							"PercentContributionIsRequired"
					
					
			Action Rules
				constraint (!ThisInstanceRel exists)
					"AssetTransferFundAlreadyExists"
				if (FinanceEnterpriseGroup.FundDimension.AccountingUnit)
					constraint (AccountingUnit entered)
						"FundDimensionIsRequired"
					Fund = AccountingUnit	
				else
					constraint (FinanceDimension1 entered)	
						"FundDimensionIsRequired"
					Fund = FinanceDimension1	

				if (Asset.FundOverride = true)
					if (PercentContribution > 0)
						if (AssetTransfer.FullOrPartial.Full)
							TransactionAmount 	= PercentContribution * Asset.ItemTotalTransactionCost	
						else 
							TransactionAmount 	= PercentContribution * AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost	
							if (ToAssetFundRel exists)
								invoke Update ToAssetFundRel
									invoked.PercentContribution	= PercentContribution
									invoked.TransactionAmount	= TransactionAmount	
							else
								if (AssetTransfer.AssetTransferTo.ToAsset entered)
									invoke CreateFromAssetGenerate ToAssetFundRel
										fill in fields from this instance
					invoke UpdateItemTransferFunds
				else
					TransactionAmount	= sum AssetItemTransferFundsRel.TransactionAmount
					PercentContribution = (TransactionAmount / AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost)
					
		UpdateToAssetFund is an Instance Action
			restricted
			Action Rules	
				if (AssetTransfer.FullOrPartial.Partial)
					if (ToAssetFundRel exists)
						invoke Update ToAssetFundRel
							invoked.PercentContribution	= PercentContribution
							invoked.TransactionAmount	= TransactionAmount	

					else	
						if (AssetTransfer.AssetTransferTo.ToAsset entered)
							invoke CreateFromAssetGenerate ToAssetFundRel
								fill in fields from this instance		

		CreateFromItemTransferFund is a Create Action
			restricted
	
					
		UpdateFromItemTransferFund is an Update Action

			restricted

								
		CreateFromAssetGenerate is a Create Action
			restricted				
			Action Rules
				constraint (!ThisInstanceRel exists)
					"AssetTransferFundAlreadyExists"

		UpdateFromAssetGenerate is an Update Action
			bypass field rules
			restricted
						
		Update is an Action
			valid when (UpdateAllowed)
			Field Rules
				Fund
					cannot be changed
						"CannotBeChanged"	
				AccountingEntity
					cannot be changed
						"CannotBeChanged"	
				AccountingUnit
					cannot be changed
						"CannotBeChanged"
				Project
					cannot be changed
						"CannotBeChanged"
				FinanceDimension1
					cannot be changed
						"CannotBeChanged"
				FinanceDimension2
					cannot be changed
						"CannotBeChanged"
				FinanceDimension3
					cannot be changed
						"CannotBeChanged"
				FinanceDimension4
					cannot be changed
						"CannotBeChanged"
				FinanceDimension5						
					cannot be changed
						"CannotBeChanged"
				FinanceDimension6						
					cannot be changed
						"CannotBeChanged"
				FinanceDimension7
					cannot be changed
						"CannotBeChanged"
				FinanceDimension8
					cannot be changed
						"CannotBeChanged"
				FinanceDimension9						
					cannot be changed
						"CannotBeChanged"
				FinanceDimension10						
					cannot be changed
						"CannotBeChanged"
				PercentContribution
					required
						"PercentContributionIsRequired"
												
			Action Rules
				if (Asset.FundOverride = true)
					if (PercentContribution changed)
						include UpdateFund 		
					if (AssetTransfer.FullOrPartial.Partial)
						invoke Update ToAssetFundRel	
							invoked.PercentContribution	= PercentContribution
							invoked.TransactionAmount 	= TransactionAmount
					invoke UpdateFromAssetTransferFund AssetItemTransferFundsRel		
						invoked.PercentContribution = PercentContribution
												
		RefreshFund is an Instance Action
			restricted
			Action Rules
				if (Asset.FundOverride 	= true)
					TransactionAmount 	= (PercentContribution * AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost)
				else 	
					if (!AssetItemTransferFundsRel exists)  
						invoke Delete
					else	
						LocalAssetItemTransferFundsTotal	= sum AssetItemTransferFundsRel.TransactionAmount 	
						TransactionAmount 					= LocalAssetItemTransferFundsTotal				
						PercentContribution					= TransactionAmount / AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost

		RefreshFundAmount is an Instance Action
			restricted
			Parameters
				PrmPercentContribution		is Percent size 9.6
				PrmTransactionAmount		is an InternationalAmount	
			Action Rules
				if (PrmPercentContribution entered)
					PercentContribution		= PrmPercentContribution
				if (PrmTransactionAmount entered)	
					TransactionAmount 		= PrmTransactionAmount	
			
		UpdateTransferFund is an Instance Action
			Parameters
				PrmAccountingEntity		is an AccountingEntity		
				PrmAccountingUnit		is an AccountingUnit			
				PrmProject				is a Project
				PrmFinanceDimension1	is a FinanceDimension1
				PrmFinanceDimension2	is a FinanceDimension2
				PrmFinanceDimension3	is a FinanceDimension3
				PrmFinanceDimension4	is a FinanceDimension4
				PrmFinanceDimension5	is a FinanceDimension5
				PrmFinanceDimension6	is a FinanceDimension6
				PrmFinanceDimension7	is a FinanceDimension7
				PrmFinanceDimension8	is a FinanceDimension8
				PrmFinanceDimension9	is a FinanceDimension9
				PrmFinanceDimension10	is a FinanceDimension10
				PrmTransactionAmount	is an InternationalAmount
				PrmPercentContribution	is Percent size 9.6

			Parameter Rules	
				PrmAccountingEntity		
					initial value is TransientAccountingEntity		
				PrmAccountingUnit		
					initial value is TransientAccountingUnit			
				PrmProject				
					initial value is TransientProject
				PrmFinanceDimension1
					initial value is TransientFinanceDimension1
				PrmFinanceDimension2
					initial value is TransientFinanceDimension2
				PrmFinanceDimension3	
					initial value is TransientFinanceDimension3
				PrmFinanceDimension4
					initial value is TransientFinanceDimension4
				PrmFinanceDimension5
					initial value is TransientFinanceDimension5
				PrmFinanceDimension6
					initial value is TransientFinanceDimension6
				PrmFinanceDimension7
					initial value is TransientFinanceDimension7
				PrmFinanceDimension8
					initial value is TransientFinanceDimension8
				PrmFinanceDimension9
					initial value is TransientFinanceDimension9
				PrmFinanceDimension10
					initial value is TransientFinanceDimension10
				PrmTransactionAmount
					initial value is TransientTransactionAmount
				PrmPercentContribution
					initial value is TransientPercentContribution
					required
						"PercentContributionIsRequired"					


			Action Rules
				if (PrmAccountingEntity 	= AccountingEntity
				and PrmAccountingUnit 		= AccountingUnit	
				and PrmProject 				= Project				
				and PrmFinanceDimension1 	= FinanceDimension1 
				and PrmFinanceDimension2 	= FinanceDimension2
				and PrmFinanceDimension3 	= FinanceDimension3	
				and PrmFinanceDimension4 	= FinanceDimension4
				and PrmFinanceDimension5 	= FinanceDimension5 
				and PrmFinanceDimension6 	= FinanceDimension6 
				and PrmFinanceDimension7 	= FinanceDimension7
				and PrmFinanceDimension8 	= FinanceDimension8
				and PrmFinanceDimension9 	= FinanceDimension9 
				and PrmFinanceDimension10 	= FinanceDimension10)
					if (PrmPercentContribution != PercentContribution)
						invoke Update 
							invoked.PercentContribution = PrmPercentContribution
				else
					invoke CreateFromAssetGenerate AssetTransferFund
						invoked.FinanceEnterpriseGroup 	= FinanceEnterpriseGroup
						invoked.AccountingEntity 		= PrmAccountingEntity
						invoked.AccountingUnit 			= PrmAccountingUnit			
						invoked.Project					= PrmProject
						if (FinanceEnterpriseGroup.FundDimension.AccountingUnit)
							invoked.Fund 				= PrmAccountingUnit
						else	
							invoked.Fund 				= PrmFinanceDimension1								
						invoked.FinanceDimension1		= PrmFinanceDimension1
						invoked.FinanceDimension2		= PrmFinanceDimension2
						invoked.FinanceDimension3		= PrmFinanceDimension3
						invoked.FinanceDimension4		= PrmFinanceDimension4
						invoked.FinanceDimension5		= PrmFinanceDimension5
						invoked.FinanceDimension6		= PrmFinanceDimension6
						invoked.FinanceDimension7		= PrmFinanceDimension7
						invoked.FinanceDimension8		= PrmFinanceDimension8
						invoked.FinanceDimension9		= PrmFinanceDimension9
						invoked.FinanceDimension10		= PrmFinanceDimension10
						LocalPercentContribution 		= PrmPercentContribution
						if (AssetTransfer.FullOrPartial.Full)
							LocalTransactionAmount 		= LocalPercentContribution * Asset.ItemTotalTransactionCost	
						else 
							LocalTransactionAmount 		= LocalPercentContribution * AssetTransfer.AssetTransferTo.ToItemTotalTransactionCost
						invoked.TransactionAmount		= LocalTransactionAmount	
						invoked.PercentContribution		= LocalPercentContribution							
					if (AssetTransfer.FullOrPartial.Partial)
						invoke Create AssetFund
							invoked.FinanceEnterpriseGroup 	= FinanceEnterpriseGroup
							invoked.Asset					= AssetTransfer.AssetTransferTo.ToAsset
							invoked.AccountingEntity 		= PrmAccountingEntity
							invoked.AccountingUnit 			= PrmAccountingUnit			
							invoked.Project					= PrmProject
							if (FinanceEnterpriseGroup.FundDimension.AccountingUnit)
								invoked.Fund 				= PrmAccountingUnit
							else	
								invoked.Fund 				= PrmFinanceDimension1								
							invoked.FinanceDimension1		= PrmFinanceDimension1
							invoked.FinanceDimension2		= PrmFinanceDimension2
							invoked.FinanceDimension3		= PrmFinanceDimension3
							invoked.FinanceDimension4		= PrmFinanceDimension4
							invoked.FinanceDimension5		= PrmFinanceDimension5
							invoked.FinanceDimension6		= PrmFinanceDimension6
							invoked.FinanceDimension7		= PrmFinanceDimension7
							invoked.FinanceDimension8		= PrmFinanceDimension8
							invoked.FinanceDimension9		= PrmFinanceDimension9
							invoked.FinanceDimension10		= PrmFinanceDimension10
							invoked.TransactionAmount		= LocalTransactionAmount	
							invoked.PercentContribution		= LocalPercentContribution							
							fill in fields from this instance
								except invoked.AssetFund	
					invoke OnlineDelete
					invoke RebuidItemTransferFunds


		RebuidItemTransferFunds is a Set Action
			restricted
			Instance Selection	
				where (FinanceEnterpriseGroup 	= FinanceEnterpriseGroup
				and Asset 						= Asset
				and AssetTransfer 				= AssetTransfer)

			Action Rules
				Instance Rules
					for each AssetItemsRel
						LocalAssetItem 			= each.AssetItem
						LocalAccountingEntity	= AccountingEntity
						LocalAccountingUnit		= AccountingUnit
						LocalFund				= Fund	
						if (AssetTransfer.FullOrPartial.Full)	
							LocalItemCost		= each.TransactionItemCost
							if (AssetItemTransferFundRel exists)
								invoke UpdateFromAssetTransferFund AssetItemTransferFundRel 
									invoked.PercentContribution 	= PercentContribution
									invoked.TransactionAmount		= (PercentContribution * LocalItemCost)
							else 
								invoke Create AssetItemTransferFundRel
									invoked.Asset					= Asset
									invoked.AssetItem				= LocalAssetItem
									invoked.AccountingEntity		= LocalAccountingEntity		
									invoked.AccountingUnit			= LocalAccountingUnit
									invoked.Fund					= LocalFund			
									invoked.FinanceDimension1		= FinanceDimension1			
									invoked.PercentContribution 	= PercentContribution
									invoked.TransactionAmount		= (PercentContribution * LocalItemCost)		
									fill in fields from this instance
						else 	
							LocalToAsset = (AssetTransfer.AssetTransferTo.ToAsset)		
							if (LocalItemTransfersRel exists)
								LocalItemCost 		= LocalItemTransfersRel.ToTransactionItemCost							
								if (AssetItemTransferFundRel exists)
									invoke UpdateFromAssetTransferFund AssetItemTransferFundRel 
										invoked.PercentContribution 	= PercentContribution
										invoked.TransactionAmount		= (PercentContribution * LocalItemCost)
								else 
									invoke Create AssetItemTransferFundRel
										invoked.Asset					= Asset
										invoked.AssetItem				= LocalAssetItem
										invoked.AccountingEntity		= LocalAccountingEntity		
										invoked.AccountingUnit			= LocalAccountingUnit
										invoked.Fund					= LocalFund			
										invoked.FinanceDimension1		= FinanceDimension1			
										invoked.PercentContribution 	= PercentContribution
										invoked.TransactionAmount		= (PercentContribution * LocalItemCost)		
										fill in fields from this instance

		UpdateItemTransferFunds is an Instance Action
			restricted
			Action Rules
				for each AssetItemsRel
					LocalAssetItem 			= each.AssetItem
					LocalAccountingEntity	= AccountingEntity
					LocalAccountingUnit		= AccountingUnit
					LocalFund				= Fund					
					if (AssetTransfer.FullOrPartial.Full)	
						LocalItemCost		= each.TransactionItemCost
						if (AssetItemTransferFundRel exists)
							invoke UpdateFromAssetTransferFund AssetItemTransferFundRel 
								invoked.PercentContribution 	= PercentContribution
								invoked.TransactionAmount		= (PercentContribution * LocalItemCost)
						else 
							invoke Create AssetItemTransferFundRel
								invoked.Asset					= Asset
								invoked.AssetItem				= LocalAssetItem
								invoked.AccountingEntity		= LocalAccountingEntity		
								invoked.AccountingUnit			= LocalAccountingUnit
								invoked.Fund					= LocalFund			
								invoked.FinanceDimension1		= FinanceDimension1			
								invoked.PercentContribution 	= PercentContribution
								invoked.TransactionAmount		= (PercentContribution * LocalItemCost)		
								fill in fields from this instance

					else 	
						if (LocalItemTransfersRel exists)
							LocalItemCost 		= LocalItemTransfersRel.ToTransactionItemCost							
							if (AssetItemTransferFundRel exists)
								invoke UpdateFromAssetTransferFund AssetItemTransferFundRel 
									invoked.PercentContribution 	= PercentContribution
									invoked.TransactionAmount		= (PercentContribution * LocalItemCost)
							else 
								invoke Create AssetItemTransferFundRel
									invoked.Asset					= Asset
									invoked.AssetItem				= LocalAssetItem
									invoked.AccountingEntity		= LocalAccountingEntity		
									invoked.AccountingUnit			= LocalAccountingUnit
									invoked.Fund					= LocalFund			
									invoked.FinanceDimension1		= FinanceDimension1			
									invoked.PercentContribution 	= PercentContribution
									invoked.TransactionAmount		= (PercentContribution * LocalItemCost)		
									fill in fields from this instance
	

		
		Delete is an Action
			valid when (UpdateAllowed)	
			Action Rules
				invoke Delete AssetItemTransferFundsRel

		OnlineDelete is a Delete Action
			default label is "Delete"
			valid when (UpdateAllowed)	
			Action Rules
				if (AssetTransfer.FullOrPartial.Partial)	
					invoke Delete ToAssetFundRel
				invoke Delete AssetItemTransferFundsRel
			
		DeleteFromAsset is a Delete Action
			restricted	


