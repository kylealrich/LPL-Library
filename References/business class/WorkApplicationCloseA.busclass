WorkApplicationCloseA is a BusinessClass
    owned by ar
    prefix is r190a

    Ontology
        symbolic key is WorkApplicationCloseA
    
    Patterns
        disable AuditIndex
		disable Auditing 
       	disable EffectiveDated
       	disable DataTranslations
        disable StaticTranslations

    Persistent Fields
    	FinanceEnterpriseGroup  is like FinanceEnterpriseGroup
    	ApplicationCloseResult  is like ApplicationCloseResult
        RecKey                  is a AR190War190aRecKeyGroup
        TranAppliedAmount       is like InternationalAmount
        BaseAppliedAmount       is like InternationalAmount
        CrAppAmt                is like InternationalAmount
        ArCode                  is like ReceivableGeneralLedgerCode 
        DocumentNbr             is like DocumentNumber  
        BatchNbr                is like BatchNumber
        Customer                is like Customer    
        ProcessLevel            is like ReceivableProcessLevel
        AraOprCode              is like ReceivableOperator   
        BankInstCode            is like BankTransactionCode
        DepInstCode             is like BankTransactionCode 
        CrType                  is like CrType   
        ProgramSequence

	Local Fields
		DbCompany					is like Company
        DbCustomer					is like Customer
        DbTransType					is like TransType
        DbInvoice					is like Invoice

        DbBatchNbr					is like BatchNumber

	
	Derived Fields
		RNACashMsg is a MessageField
			restricted
			"RNACashAppliedOn"
	
	Relations
        ARCompanyRel
            one-to-one relation to ReceivableCompany
            Field Mapping uses symbolic key
                related.Company                     = RecKey.Company

        GLCompanyRel
            one-to-one relation to GeneralLedgerCompany
            Field Mapping uses symbolic key
                related.Company                     = RecKey.Company

        ARCodeRel
            one-to-one relation to ReceivableGeneralLedgerCode
            Field Mapping uses symbolic key
                related.Company                     = RecKey.CrCompany
                related.ReceivableGeneralLedgerCode = RecKey.OffsetCode

        DbReceivableGLDistributionRel
            one-to-many relation to ReceivableGLDistribution
            Field Mapping uses Set2
                related.ReceivableCompanyDataGroup.TransactionCompany 	= DbCompany
                related.BatchNumber        								= DbBatchNbr
                related.TransType          								= DbTransType
                related.Invoice            								= DbInvoice
                related.ReceivableCompanyDataGroup.Customer           	= DbCustomer

        CloseDistributionRel
            one-to-many relation to ReceivableGLDistribution
            Field Mapping uses ByApplicationCloseResult
                related.FinanceEnterpriseGroup 				= FinanceEnterpriseGroup
                related.ApplicationCloseResult        		= ApplicationCloseResult

    Sets

        RecKey
            indexed
            no duplicates
            Sort Order
            	FinanceEnterpriseGroup
            	ApplicationCloseResult
                RecKey

    Actions

        Create is a Create Action
        	restricted
			Entrance Rules
        		display "CreatingWork190a:<FinanceEnterpriseGroup>/<ApplicationCloseResult>/<RecKey.Company>/<RecKey.CrCompany>/<RecKey.OffsetCode>/<RecKey.GlDate>/<RecKey.AppCurrCd>/<RecKey.AppSource>/<RecKey.TransType>/<RecKey.Invoice>/<RecKey.PaymentSeq>/<RecKey.AppSeq>"        		
			
        	Exit Rules
        		display "Work190aCreated:<FinanceEnterpriseGroup>/<ApplicationCloseResult>/<RecKey.Company>/<RecKey.CrCompany>/<RecKey.OffsetCode>/<RecKey.GlDate>/<RecKey.AppCurrCd>/<RecKey.AppSource>/<RecKey.TransType>/<RecKey.Invoice>/<RecKey.PaymentSeq>/<RecKey.AppSeq>"        		
        
        Update is an Update Action
        	restricted

        FastUpdate is an Update Action
        	restricted
        	bypass field rules

        Delete is a Delete Action
        	restricted
        	
        FastDelete is a Delete Action
        	restricted
        	bypass relational integrity rules

		Process is a Set Action
			restricted
			
			Parameters
				PrmFinanceEnterpriseGroup 		is a FinanceEnterpriseGroup
				PrmApplicationCloseResult		is a ApplicationCloseResult
				PrmCreateDate					is TimeStamp

			Instance Selection
				where (FinanceEnterpriseGroup 	= PrmFinanceEnterpriseGroup
				and    ApplicationCloseResult	= PrmApplicationCloseResult)
				
			Local Fields
				WsDistSeq			is a Sequence
				


				
			Action Rules
				Instance Rules
					display "WorkA:<DbInvoice>TranAppliedAmount<TranAppliedAmount>"

					DbCompany					= RecKey.Company
					DbBatchNbr					= BatchNbr
					DbTransType					= RecKey.TransType
					DbInvoice					= RecKey.Invoice
					DbCustomer					= Customer
					WsDistSeq					= last DbReceivableGLDistributionRel.ReceivableGLDistribution + 1

					invoke CreateFromApplicationClose ReceivableGLDistribution
						invoked.FinanceEnterpriseGroup							= FinanceEnterpriseGroup
						invoked.ReceivableGLDistribution.ProgramSequence		= ProgramSequence
						invoked.LastDistributionSequence						= WsDistSeq
						invoked.CreateDate										= PrmCreateDate

						invoked.ReceivableCompanyGroup.GlCompany				= RecKey.CrCompany
		            	invoked.ReceivableCompanyDataGroup.TransactionCompany	= RecKey.Company
				        invoked.ReceivableCompanyDataGroup.ReceivableProcessLevel	= ProcessLevel

						invoked.GeneralLedgerAccount							= ARCodeRel.DistributionAccount
				        invoked.GeneralLedgerDate								= RecKey.GlDate
			        	invoked.TransactionDate									= RecKey.GlDate
						if  (RecKey.TransType = "C"
						or   RecKey.TransType = "P")
							invoked.DistributionAmount.CurrencyAmount 							= TranAppliedAmount * -1
   							invoked.DistributionAmount.FunctionalAmount.EnteredCurrencyAmount	= BaseAppliedAmount * -1
						else
							invoked.DistributionAmount.CurrencyAmount 							= TranAppliedAmount
   							invoked.DistributionAmount.FunctionalAmount.EnteredCurrencyAmount	= BaseAppliedAmount

						if  (RecKey.CrCompany != RecKey.Company)
							invoked.ToCompanyBaseAmount							= CrAppAmt

						invoked.TransType										= RecKey.TransType
						invoked.Invoice											= RecKey.Invoice
				        invoked.BatchNumber										= BatchNbr
						invoked.ReceivableCompanyDataGroup.Customer				= Customer
						invoked.OriginalCurrency								= RecKey.AppCurrCd
						invoked.Status											= 2
						invoked.Origin											= RecKey.AppSource

						if  (ARCompanyRel.DetailGLTransPerApplication = "Y")
							invoked.AccumulationType 							= "D"
						else
							invoked.AccumulationType 							= "S"
							invoked.ReceivableApplicationOjectID				= ProgramSequence

						invoked.DocumentNumber									= DocumentNbr
				        invoked.Description										= RNACashMsg + " " + current corporate date
				        

		            	invoked.ApplicationCloseResult							= PrmApplicationCloseResult


					invoke FastDelete        	
			
