PurchaseOrderLineAssetDetail is a BusinessClass
    owned by am
    prefix is AOD
    classic name is AMPOASTDTL

    Ontology
        symbolic key is PurchaseOrderLineAssetDetail
            classic set name is AODSET1
            classic name is DTL-SEQ-NBR
            name for PurchaseOrderLine is PurchaseOrderLineAsset
            classic name for PurchaseOrderLineAsset is LINE-NBR

    Patterns	
    	implements StaticJava
        disable AuditIndex

		
    Persistent Fields
        AssetTemplate
        Currency
            classic name is CURRENCY-CODE
        TransactionNumberOfDecimals 	is a CurrencyNumberOfDecimals
            classic name is TRAN-ND
        BaseNumberOfDecimals
            classic name is BASE-ND
        BarCode                     	is an AssetBarCode
        SerialNumber
        AssetAccountingUnit				is a FinanceCodeBlockNoAccountFull
        	default label is "DefaultTransactionDimensions"
        AssetDescription            	is a Description
            classic name is ASSET-DESC
        TagNumber
            classic name is TAG-NBR
        AssetGroup
        AssetAccountingUnitGroup
        	default label is "AssetDimensionGroup"
            classic name is AU-GROUP
        Combine
        HoldAsset                   	is Boolean
            classic name is HOLD-AM
        Project							is a FinanceCodeBlockProjectOnly
      		default label is "AssetProject"
        	classic name for Project.Project is ACTIVITY
        ItemNumber                  	is an AssetItemNumber
            classic name is ITEM-NBR
        ItemDescription             	is a Description
            classic name is ITEM-DESC
        ModelNumber
        PurchaseDate                	is Date
        InServiceDate               	is Date
            classic name is INSRV-DATE
        TransactionItemTax          	is an InternationalAmount
            classic name is ITEM-TAX-TRAN
        BaseItemTax                 	is an InternationalAmount
            classic name is ITEM-TAX-BASE
        Invoice
        Suffix
        AssetLocation
       		classic name is LOCATION-NAME
        AssetDivision
            classic name is DIVISION
        LocationDetail              	is an AssetLocationDetail
            classic name is ITEM-LOC-DTL
        POAssetObjectID             	is an ObjId
            classic name is PO-AST-OBJ-ID
        Received                    	is Numeric size 1
        	protected
			States
				No				value is 0
				Yes				value is 1
        Rejected                    	is Numeric size 1
        	protected
			States
				No				value is 0
				Yes				value is 1
        Returned                    	is Numeric size 1
        	protected
			States
				No				value is 0
				Yes				value is 1
        Invoiced                    	is Numeric size 1
        	protected
			States
				No				value is 0
				Yes				value is 1
        AssetCreated                	is Numeric size 1
        	protected
			States
				No				value is 0
				Yes				value is 1
        Cancelled                   	is Numeric size 1
        	protected
			States
				No				value is 0
				Yes				value is 1

	Context Fields 
		PurchaseOrderReceiptLine 
    Local Fields
    	LocalCurrencyAmount				is a CurrencyAmount
    	LocalPurchaseOrderReceiptAdjustmentAndInspectionLine is like POReceiptAdjustmentAndInspectionLineDistribution
    	LocalFunction					is Alpha size 10
    	LocalAssetAccountingUnit		is a FinanceCodeBlock
    	LocalProject					is like FinanceCodeBlockProjectOnly
    	LocalMaxQuantity				is like Quantity
    	LocalTotalDetails				is like Quantity
    	LocalTotalReceivedDetails		is like Quantity
    	LocalDistDetails				is like Quantity
    	LocalTotalQuantity 				is like Quantity
    	LocalLastSeqNumber				is like Quantity
    	LocalUnitCost					is an InternationalCost		
    	LocalAocUnitCost				is an InternationalCost		 
    	LocalTaxAmount 					is an InternationalAmount  	
    	LocalAocTaxAmount				is an InternationalAmount 	
    	LocalInvoiceDate				is Date 					
    	LocalUnitTax           			is an InternationalAmount 	
		LocalAocUnitTax					is an InternationalAmount	


		CalculateTax			


		LocalPayablesInvoice			is like PayablesInvoice




    	LocalChargeBack					is Boolean

    	LocalMaaTotalLandedAoc			is like Quantity		
    	LocalMaaInvoiceDetailQunatity	is like Quantity		
    	LocalMaaInvoiceTotalTax			is like Quantity		
    	LocalMaaTaxCode					is like TaxCode		
    	LocalAMTransactionItemCost		is a InternationalAmount		
    	LocalAMTransactionItemTax		is a InternationalAmount		
		LocalAMITransactionItemCostBase     is a InternationalAmount
		LocalAMITransactionItemTaxBase		is a InternationalAmount

		LocalCurrencyTable					is a CurrencyTable
		LocalCurrencyExchange				is a CurrencyExchange
		LocalFromCurrency					is a FromCurrency
		LocalExchangeDate					is an ExchangeDate
		LocalCurrencyRate              	    is a CurrencyExchangeRate
		LocalAccountingEntity				is an AccountingEntity
    	
    	LocalInvoiceDetailTotal			is an InternationalAmount	
        LocalInvoiceDetailHashQuantity 	is like Quantity 			
  		LocalInvoiceDetailTaxTotal		is an InternationalAmount  
  		LocalInvoiceDetailTaxCode		is like TaxCode				
  		
  		LocalReleaseQuantity			is like Quantity
		LocalMatchedQuantity			is like Quantity
		I1 								is Numeric 2
		I6 								is Numeric 2
		LocalMatchedQuantitySav 		is like Quantity 	
		LocalTotalAodReceived			is like Quantity				


		
		LocalAssetCreateQuantity		is like Quantity  	 
		LocalAssetDistQuantity			is like Quantity 
		
		TaxOrAddOnCharge				is Boolean

    
    Derived Fields
    
		TotalReceivedQuantity 				is a DerivedField                              
			type is like Quantity
			restricted
			return (sum PurchaseOrderLineAssetRel.DerivedStockReceivedQuantity)	    	        

		TotalRejectedQuantity 				is a DerivedField                              
			type is like Quantity
			restricted
			return (sum PurchaseOrderLineAssetRel.RejecytedQuantity)

		TotalReturnedQuantity 				is a DerivedField                             
			type is like Quantity
			restricted
			return (sum PurchaseOrderLineAssetRel.ReturnedQuantity)	
			
		TotalAssetCreateQuanity 			is a DerivedField                            
			type is like Quantity
			restricted
			return (sum PurchaseOrderLineAssetRel.AssetCreateQuanity)	
			
		TotalCancelledQuantity 				is a DerivedField                               
			type is like Quantity
			restricted
			return (sum PurchaseOrderLineAssetRel.CancelledQuantity)
    	
    	LocalReceived                       is a DerivedField
            type is Alpha size up to 10
            if (IsReceived)
                return "X"
            else
                return ""

    	LocalRejected                      	is a DerivedField
            type is Alpha size up to 10
            if (IsRejected)
                return "X"
            else
                return ""  
                
    	LocalReturned                      	is a DerivedField
            type is Alpha size up to 10
            if (IsReturned)
                return "X"
            else
                return ""  
                
    	LocalInvoiced       				is a DerivedField
            type is Alpha size up to 10
            if (IsInvoiced)
                return "X"
            else
                return "" 
                
    	LocalAssetCreated                  	is a DerivedField
            type is Alpha size up to 10
            if (IsAssetCreated)
                return "X"
            else
                return ""

    	LocalCancelled                      is a DerivedField
            type is Alpha size up to 10
            if (IsCancelled)
                return "X"
            else
                return ""                                                                                              

		DerivedHoldAsset					is a DerivedField
			type is Boolean
			if (PurchaseOrderLineAssetDefaultsRel exists)
				return PurchaseOrderLineAssetDefaultsRel.HoldAsset
			else
				return AssetCompanyRel.HoldAssetInterface
				
		DerivedItemNumber					is a DerivedField
			type is like AssetItemNumber
			restricted
			if (PurchaseOrderLineAssetDefaultsRel.ItemNumber entered)
				return PurchaseOrderLineAssetDefaultsRel.ItemNumber
			else
				return PurchaseOrderLineRel.Item
				
		DerivedItemDescription				is a DerivedField
			type is like Description
			restricted
			if (PurchaseOrderLineAssetDefaultsRel.ItemDescription entered)
				return PurchaseOrderLineAssetDefaultsRel.ItemDescription
			else
				return PurchaseOrderLineRel.Description
				
		DerivedReceived is a DerivedField
			type is Boolean
			default label is "Received"
			if (IsReceived)
				return true
			else
				return false
		
		DerivedReturned is a DerivedField
			type is Boolean
			default label is "Returned"
			if (IsReturned)
				return true
			else
				return false				
		
		DerivedRejected is a DerivedField
			type is Boolean
			default label is "Rejected"
			if (IsRejected)
				return true
			else
				return false
				
		DerivedAssetCreated is a DerivedField
			type is Boolean
			default label is "AssetCreated"
			if (IsAssetCreated)
				return true
			else
				return false
				
		DerivedInvoiced is a DerivedField
			type is Boolean
			default label is "Invoiced"
			if (IsInvoiced)
				return true
			else
				return false
				
		DerivedCancelled is a DerivedField
			type is Boolean
			default label is "Cancelled"
			if (IsCancelled)
				return true
			else
				return false

		DerivedLineAssetDetailTitle is a DerivedField
			type is MessageField
			if (not PurchaseOrderLineAssetDetail exists)
				return "AssetDetail"
			else
				return LineAssetDetailTitle

		LineAssetDetailTitle is a LabelField
			"AssetDetail<PurchaseOrderLineAssetDetail>"
				
    Conditions

        IsAmastitem
        	restricted
            when (AssetItemRel exists)

		IsAssetCreated
			restricted
            when (AssetCreated.Yes)

        IsCancelled
        	restricted
            when (Cancelled.Yes)

        IsInvoiced
        	restricted
            when (Invoiced.Yes)

        IsPoAstObjId
        	restricted
            when (POAssetObjectID entered)

        IsReceived
        	restricted
            when (Received.Yes)

        IsRejected
        	restricted
            when (Rejected.Yes)

        IsReturned
        	restricted
            when (Returned.Yes)
            
		IsPOReceiptUnreleased
			when (PurchaseOrderReceiptRel exists
			or PurchaseOrderReceiptAdjustmentAndInspectionRel exists)
		
		IsValidForReject
			when (  Rejected.No
			and     IsPOReceiptUnreleased
			and     IsReceived
			and not IsCancelled
			and not IsInvoiced
			and not IsAssetCreated)
		
		IsValidForUnreject
			when (  Rejected.Yes
			and     IsPOReceiptUnreleased
			and not IsCancelled
			and not IsReturned
			and not IsInvoiced
			and not IsAssetCreated)

		DisplayNotReceivedAlert 
			when (PurchaseOrderReceiptLine in context 
			and   Received.No)
    Relations

        AssetItemRel
            classic name is AMASTITEM
            one-to-one relation to AssetItem
            Field Mapping uses Set6
	           	related.FinanceEnterpriseGroup	= Company.FinanceEnterpriseGroup
                related.POAssetObjectID 		= POAssetObjectID

		AssetCompanyRel
			one-to-one relation to AssetCompany
            Field Mapping uses symbolic key
                related.Company = Company
                
		UniqueAssetsTagRel
			one-to-many relation to Asset
			Field Mapping uses ByCompanyTagAsset
				related.FinanceEnterpriseGroup	= Company.FinanceEnterpriseGroup
				related.Company 				= Company
				related.TagNumber				= TagNumber
                
        AssetInterfaceRel
        	one-to-many relation to AssetInterface
        	Field Mapping uses symbolic key
        		related.Company = Company
        	Instance Selection	
        		where (related.AssetTemplate = AssetTemplate) 
        		
 		GeneralLedgerCompanyRel
			one-to-one relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
				related.Company			= Company      		               
                

        PurchaseOrderLineAssetRel
            classic name is AMPOASTHDR
            one-to-one relation to PurchaseOrderLineAsset
            required
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.PurchaseOrder			= PurchaseOrder
                related.PurchaseOrderLine       = PurchaseOrderLineAsset

        PurchaseOrderLineAssetDefaultsRel
        	one-to-one relation to PurchaseOrderLineAssetDefaults
        	Field Mapping uses symbolic key
                related.Company                 = Company
                related.PurchaseOrder			= PurchaseOrder
                related.PurchaseOrderLine       = PurchaseOrderLineAsset	
        	
        
        PurchaseOrderLineRel
            classic name is POLINE
            one-to-one relation to PurchaseOrderLine
            required
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.PurchaseOrder			= PurchaseOrder
                related.PurchaseOrderLine       = PurchaseOrderLineAsset
   
 		
 		PurchaseOrderLineDistributionsRel
            one-to-many relation to PurchaseOrderLineDistribution
            Field Mapping uses symbolic key
                related.Company                   = Company
                related.PurchaseOrder             = PurchaseOrder
                related.PurchaseOrderLine         = PurchaseOrderLineAsset
                
 		PurchaseOrderReceiptAdjustmentAndInspectionLineDistRel
            one-to-many relation to POReceiptAdjustmentAndInspectionLineDistribution
            Field Mapping uses symbolic key
                related.Company				= Company
 		
 		PurchaseOrderLineAssetDetailsRels
			one-to-many relation to PurchaseOrderLineAssetDetail
		    Field Mapping uses symbolic key
		        related.Company = Company
		    Instance Selection
		        where (related.PurchaseOrder = PurchaseOrder
		        and   related.PurchaseOrderLineAsset = PurchaseOrderLineAsset)
		        
		PurchaseOrderLineAssetDetailsRel2
			one-to-many relation to PurchaseOrderLineAssetDetail
		    Field Mapping uses symbolic key
		        related.Company = Company
		    Instance Selection
		        where (related.PurchaseOrder = PurchaseOrder
		        and   related.PurchaseOrderLineAsset = PurchaseOrderLineAsset
		        and   related.Received = true )        
		        
		        
		PurchaseOrderLineAssetDetailRel
			one-to-many relation to PurchaseOrderLineAssetDetail
			Field Mapping uses symbolic key
				related.Company 					= Company
				related.PurchaseOrder 				= PurchaseOrder
                related.PurchaseOrderLineAsset		= PurchaseOrderLineAsset                

		PurchaseOrderLineAssetDetailDuplicateSerialNumberRel
			one-to-many relation to PurchaseOrderLineAssetDetail
			Field Mapping uses symbolic key
				related.Company 					= Company
				related.PurchaseOrder 				= PurchaseOrder
                related.PurchaseOrderLineAsset		= PurchaseOrderLineAsset  
			Instance Selection
				where (related.PurchaseOrderLineAssetDetail not = PurchaseOrderLineAssetDetail
				and    related.SerialNumber entered
				and	   related.SerialNumber					= SerialNumber)
				
		PurchaseOrderLineAssetDetailDuplicateBarCodeRel
			one-to-many relation to PurchaseOrderLineAssetDetail
			Field Mapping uses symbolic key
				related.Company 					= Company
				related.PurchaseOrder 				= PurchaseOrder
                related.PurchaseOrderLineAsset		= PurchaseOrderLineAsset  
			Instance Selection
				where (related.PurchaseOrderLineAssetDetail not = PurchaseOrderLineAssetDetail
				and	   related.BarCode entered
				and	   related.BarCode						= BarCode)
                
        PurchaseOrderAssetLineRels
            one-to-many relation to PurchaseOrderLine
            required
            Field Mapping uses symbolic key
                related.Company                 = Company
                related.PurchaseOrder			= PurchaseOrder

		PayablesInvoiceRel
			one-to-many relation to PayablesInvoice
			Field Mapping uses ByCompanyVendorInvoice
				related.Company  	   = Company
				related.Vendor   	   = PurchaseOrderLineAsset.Vendor 
				related.Invoice		   = Invoice
				related.Suffix		   = Suffix
				related.CancelSequence = 0
				
		PayablesInvoiceDetailRel
            one-to-many relation to PayablesInvoiceDetail
            Field Mapping uses symbolic key
                related.Company 					= Company

			Instance Selection
				where ( related.Vendor  					= PurchaseOrderLineAsset.Vendor
				and related.PurchaseOrder 				= PurchaseOrder
				and related.PurchaseOrderLine			= PurchaseOrderLineAsset 
				and related.Invoice		   				= Invoice
				and related.Suffix		   				= Suffix)		              

		PayablesInvoiceDetail2Rel
            one-to-many relation to PayablesInvoiceDetail
            Field Mapping uses symbolic key
                related.Company 					= Company
                related.PayablesInvoice				= LocalPayablesInvoice

				related.PurchaseOrder 				= PurchaseOrder
				related.PurchaseOrderLine			= PurchaseOrderLineAsset 
        
        DuplicateBarCodeRel
			one-to-many relation to AssetItem
			Field Mapping uses Set4
	           	related.FinanceEnterpriseGroup	= Company.FinanceEnterpriseGroup
				related.BarCode	= BarCode
			Instance Selection
				where (related.InvoiceAndPurchaseOrderInformation.PurchaseOrder != PurchaseOrder
				or     related.ItemNumber		!= ItemNumber)
			
		DuplicateAssetInterfaceBarCodeRel
			one-to-many relation to AssetInterface
			Field Mapping uses ByTemplateCombine
				related.Company					= Company
				related.AssetTemplate			= AssetTemplate
			Instance Selection
				where (related.BarCode entered
				and    related.BarCode			= BarCode
				and   (related.InvoiceAndPurchaseOrderInformation.PurchaseOrder != PurchaseOrder
				or     related.ItemNumber		!= ItemNumber))
				
        DuplicateAssetItemSerialRel
			one-to-many relation to AssetItem
			Field Mapping uses Set3
	           	related.FinanceEnterpriseGroup	= Company.FinanceEnterpriseGroup
				related.SerialNumber	= SerialNumber
			Instance Selection
				where (related.InvoiceAndPurchaseOrderInformation.PurchaseOrder != PurchaseOrder
				or     related.ItemNumber		!= ItemNumber)
			
		DuplicateAssetInterfaceSerialRel
			one-to-many relation to AssetInterface
			Field Mapping uses ByTemplateCombine
				related.Company					= Company
				related.AssetTemplate			= AssetTemplate
			Instance Selection
				where (related.SerialNumber entered
				and    related.SerialNumber		= SerialNumber
				and   (related.InvoiceAndPurchaseOrderInformation.PurchaseOrder != PurchaseOrder
				or     related.ItemNumber		!= ItemNumber))
				
		CompanyTaxCodeRel
			one-to-one relation to EntityTaxCode
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= Company.FinanceEnterpriseGroup
				related.TaxEntity 				= Company.AccountingEntity
				related.TaxCode 				= PurchaseOrderLineAsset.TaxCode	
				
		PayablesInvoiceAddOnChargeRel
            one-to-many relation to PayablesInvoiceAddOnCharge
            Field Mapping uses symbolic key
                related.Company 					= Company               
			Instance Selection
				where ( related.Vendor  					= PurchaseOrderLineAsset.Vendor
				and related.PurchaseOrder 				= PurchaseOrder
				and related.PurchaseOrderLine			= PurchaseOrderLineAsset 
				and related.Invoice		   				= Invoice
				and related.Suffix		   				= Suffix)							      

        PurchaseOrderLineDistributionWithAssetTemplateRel
        	one-to-many relation to PurchaseOrderLineDistribution
        	Field Mapping uses symbolic key
        		related.Company						= Company
        		related.PurchaseOrder				= PurchaseOrder
        		related.PurchaseOrderLine			= PurchaseOrderLineAsset
        	Instance Selection
        		where (related.AssetInformation.AssetTemplate entered)
        		
        PurchaseOrderReceiptRel
            one-to-many relation to PurchaseOrderReceipt
            Field Mapping uses ByPurchaseOrder
                related.Company                 = Company
                related.PurchaseOrder			= PurchaseOrder
            Instance Selection
            	where (related.Status.Unreleased)
            	
		PurchaseOrderReceiptAdjustmentAndInspectionRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses symbolic key
				related.Company										= Company
			Instance Selection
            	where (related.PurchaseOrderReceipt.PurchaseOrder	= PurchaseOrder
            	and	   related.Status.Unreleased)

		LocalPayablesInvoiceRel
			one-to-one relation to PayablesInvoice
			Field Mapping uses symbolic key
				related.Company  	   					= Company
				related.PayablesInvoice					= LocalPayablesInvoice
		
		LocalPayablesInvoiceDistributionsRel
			one-to-many relation to PayablesInvoiceDistribution
			Field Mapping uses ByPayablesInvoiceSuffixPOLine
				related.Company							= Company
				related.Vendor							= PurchaseOrderLineAsset.Vendor
				related.PayablesInvoice					= LocalPayablesInvoice
				related.Suffix							= Suffix
				related.PurchaseOrder					= PurchaseOrder
				related.PurchaseOrderLine				= PurchaseOrderLineAsset

    Sets

        Set2
            indexed
            Sort Order
                Company
                PurchaseOrder
                PurchaseOrderLineAsset
                PurchaseOrderLineAssetDetail descending

        Set3
            indexed
            Sort Order
                Company
                PurchaseOrder
                PurchaseOrderLineAsset
                BarCode
                SerialNumber
                PurchaseOrderLineAssetDetail


	Field Rules
		
		InServiceDate
			initial value is PurchaseOrderLineAssetDefaultsRel.InServiceDate
			default to PurchaseOrderLineAssetDefaultsRel.InServiceDate
			default to PurchaseDate
			constraint(InServiceDate >= PurchaseDate)
				"InServiceDateMustBeGreaterThanOrEqualToPurchaseDate"
				
		AssetTemplate
			initial value is first PurchaseOrderLineDistributionWithAssetTemplateRel.AssetInformation.AssetTemplate
			default to first PurchaseOrderLineDistributionWithAssetTemplateRel.AssetInformation.AssetTemplate
			
			required
			
			cannot be changed
				"CannotChangeAssetTemplate"	
			
		AssetDescription
			initial value is PurchaseOrderLineAssetDefaultsRel.AssetDescription
			default to PurchaseOrderLineAssetDefaultsRel.AssetDescription
			
		SerialNumber
			if (SerialNumber entered)
				constraint (PurchaseOrderLineAssetDetailDuplicateSerialNumberRel not exists)
					"DuplicateSerialNumber<SerialNumber>"
		
				constraint(DuplicateAssetItemSerialRel not exists)
					"SerialNumber<SerialNumber>AlreadyExistsOnAssetItem"		
	    		       
				constraint(DuplicateAssetInterfaceSerialRel not exists)
					"SerialNumber<SerialNumber>AlreadyExistsInAssetInterface"		
	    		       
		BarCode
			if (BarCode entered)
				constraint (PurchaseOrderLineAssetDetailDuplicateBarCodeRel not exists)
					"DuplicateBarcode<BarCode>"

				constraint(DuplicateBarCodeRel not exists)
					"Barcode<BarCode>AlreadyExistsOnAssetItem"		
	    		       
				constraint(DuplicateAssetInterfaceBarCodeRel not exists)
					"Barcode<BarCode>AlreadyExistsInAssetInterface"		
	    		       
		TagNumber
			initial value is PurchaseOrderLineAssetDefaultsRel.TagNumber
			default to PurchaseOrderLineAssetDefaultsRel.TagNumber
			
		AssetGroup
			initial value is PurchaseOrderLineAssetDefaultsRel.AssetGroup
			default to PurchaseOrderLineAssetDefaultsRel.AssetGroup
			
		AssetAccountingUnitGroup
			initial value is PurchaseOrderLineAssetDefaultsRel.AssetAccountingUnitGroup
			default to PurchaseOrderLineAssetDefaultsRel.AssetAccountingUnitGroup

		Project
			initial value is PurchaseOrderLineAssetDefaultsRel.Project
			default to PurchaseOrderLineAssetDefaultsRel.Project
			
		Combine
			initial value is PurchaseOrderLineAssetDefaultsRel.Combine
			default to PurchaseOrderLineAssetDefaultsRel.Combine
			
		HoldAsset
			initial value is DerivedHoldAsset
			default to DerivedHoldAsset
			
		ItemNumber
			initial value is DerivedItemNumber
			default to DerivedItemNumber
			
		ItemDescription
			initial value is DerivedItemDescription
			default to DerivedItemDescription
			
		ModelNumber
			initial value is PurchaseOrderLineAssetDefaultsRel.ModelNumber
			default to PurchaseOrderLineAssetDefaultsRel.ModelNumber
			
		PurchaseDate
			initial value is PurchaseOrderLineAssetDefaultsRel.PurchaseDate
			default to PurchaseOrderLineAssetDefaultsRel.PurchaseDate
			
		AssetLocation
			initial value is PurchaseOrderLineAssetDefaultsRel.AssetLocation
			default to PurchaseOrderLineAssetDefaultsRel.AssetLocation
			
		AssetDivision
			initial value is PurchaseOrderLineAssetDefaultsRel.AssetDivision
			default to PurchaseOrderLineAssetDefaultsRel.AssetDivision
			
		LocationDetail
			initial value is PurchaseOrderLineAssetDefaultsRel.LocationDetail
			default to PurchaseOrderLineAssetDefaultsRel.LocationDetail
	
	Rule Blocks
		
		PerformInvoiceDetail    
			LocalInvoiceDetailTotal    		= 0
			LocalInvoiceDetailTaxTotal 		= 0
			LocalInvoiceDetailHashQuantity 	= 0
			
			if (PayablesInvoiceDetailRel exists)
				for each PayablesInvoiceDetailRel 
					if (not each.ItemType.Service
					or each.PayablesInvoice.MatchProcessType = "S") 
						LocalInvoiceDetailTotal 		+= each.TotalDistributionAmount
						LocalInvoiceDetailHashQuantity	+= each.MatchedQuantity
								
					LocalInvoiceDetailTaxTotal 	+= each.TaxAmount 
					
					if(each.TaxCode exists
					or each.TaxCode not = "")
						LocalInvoiceDetailTaxCode = each.TaxCode
		
		ProcessAocCode	
			LocalMaaTotalLandedAoc			= 0
	    	LocalMaaInvoiceDetailQunatity	= 0
	    	LocalMaaInvoiceTotalTax			= 0
	    	LocalMaaTaxCode					= ""			
			if(PayablesInvoiceAddOnChargeRel exists)   
				for each PayablesInvoiceAddOnChargeRel 
					if( each.LandedAddOnCharge)
						LocalMaaTotalLandedAoc 			+= each.AddOnChargeAmount
						LocalMaaInvoiceDetailQunatity 	+= each.MatchedQuantity
					LocalMaaInvoiceTotalTax 			+= each.TaxAmount
					
					if(each.TaxCode not = ""
					or each.TaxCode exists)
						LocalMaaTaxCode = each.TaxCode 
		
		CreatePurchaseOrderLineAssetDetail
			invoke Create PurchaseOrderLineAssetDetail		            					
				invoked.PurchaseOrderLineAssetDetail 			= LocalLastSeqNumber
				if(AssetCompanyRel.DefaultDepreciationExpenseProject = "Y" 
				or AssetCompanyRel.DefaultDepreciationExpenseProject = "")
					invoked.HoldAsset							= AssetCompanyRel.HoldAssetInterface
				
				if(PurchaseOrderLineAssetDefaultsRel exists)
					invoked.AssetDescription 			= PurchaseOrderLineAssetDefaultsRel.AssetDescription
					invoked.TagNumber 					= PurchaseOrderLineAssetDefaultsRel.TagNumber
					invoked.AssetGroup 					= PurchaseOrderLineAssetDefaultsRel.AssetGroup
					invoked.AssetAccountingUnitGroup 	= PurchaseOrderLineAssetDefaultsRel.AssetAccountingUnitGroup
					if(PurchaseOrderLineAssetDefaultsRel.Project != "" )
						invoked.Project 				= PurchaseOrderLineAssetDefaultsRel.Project		            						
					invoked.Combine 					= PurchaseOrderLineAssetDefaultsRel.Combine
					if(PurchaseOrderLineAssetDefaultsRel.HoldAsset != "" )
						invoked.HoldAsset 				= PurchaseOrderLineAssetDefaultsRel.HoldAsset
					
					if(PurchaseOrderLineAssetDefaultsRel.ItemNumber != "" )
						invoked.ItemNumber 				= PurchaseOrderLineAssetDefaultsRel.ItemNumber
					if(PurchaseOrderLineAssetDefaultsRel.ItemDescription != "" )
						invoked.ItemDescription 		= PurchaseOrderLineAssetDefaultsRel.ItemDescription	
					invoked.ModelNumber					= PurchaseOrderLineAssetDefaultsRel.ModelNumber
					invoked.PurchaseDate 				= PurchaseOrderLineAssetDefaultsRel.PurchaseDate
					invoked.InServiceDate 				= PurchaseOrderLineAssetDefaultsRel.InServiceDate
					invoked.AssetLocation 				= PurchaseOrderLineAssetDefaultsRel.AssetLocation
					invoked.AssetDivision 				= PurchaseOrderLineAssetDefaultsRel.AssetDivision
					if(PurchaseOrderLineAssetDefaultsRel.LocationDetail != "" )
						invoked.LocationDetail 			= PurchaseOrderLineAssetDefaultsRel.LocationDetail
				if(PrmInvoice entered
				and PrmPurchaseDate not entered
				and PrmInServiceDate not entered)
					invoked.PurchaseDate 				= PayablesInvoiceDetailRel.PayablesInvoice.InvoiceDate
					invoked.InServiceDate				= PayablesInvoiceDetailRel.PayablesInvoice.InvoiceDate
					invoked.Currency					= PayablesInvoiceDetailRel.PayablesInvoice.InvoiceCurrency
					invoked.TransactionNumberOfDecimals = PayablesInvoiceDetailRel.PayablesInvoice.NumberOfDecimals
				if(GeneralLedgerCompanyRel.Currency exists)
					invoked.BaseNumberOfDecimals		= GeneralLedgerCompanyRel.Currency.NumberOfDecimals	
				
   				if (PurchaseOrderLineAssetDefaultsRel.ItemNumber not entered)
	        		invoked.ItemNumber 		= PurchaseOrderLineRel.Item
	        	if (PurchaseOrderLineAssetDefaultsRel.ItemDescription not entered)	
	        		invoked.ItemDescription = PurchaseOrderLineRel.Description
		
		CreateAssetInterface


			if (PurchaseOrderLineAsset.AssetCompanySystemClosingControlRel exists)
				LocalCurrencyTable 				 		= PurchaseOrderLineAsset.AssetCompanySystemClosingControlRel.CurrencyTable
			else 
				LocalCurrencyTable 				 		= Company.CurrencyTable

			initialize LocalCurrencyExchange
			LocalFromCurrency 				 			= first PayablesInvoiceRel.InvoiceCurrency
			LocalCurrencyExchange.ToCurrency 			= Company.Currency
			LocalCurrencyRate							= LocalCurrencyExchange.OutputCurrencyRate

			LocalCurrencyAmount							= LocalAMTransactionItemCost
			LocalExchangeDate 				 			= first PayablesInvoiceRel.InvoiceDate
			LocalAMITransactionItemCostBase 			= LocalCurrencyExchange.OutputCurrencyAmount
			
			if (LocalAMTransactionItemTax != 0)
				initialize LocalCurrencyExchange
				LocalFromCurrency 				 		= first PayablesInvoiceRel.InvoiceCurrency
				LocalCurrencyExchange.ToCurrency 		= Company.Currency
				LocalCurrencyExchange.EnteredCurrencyAmount = LocalAMTransactionItemTax
				LocalCurrencyAmount						= LocalCurrencyExchange.EnteredCurrencyAmount
				LocalExchangeDate 				 		= first PayablesInvoiceRel.InvoiceDate
				LocalAMITransactionItemTaxBase 			= LocalCurrencyExchange.OutputCurrencyAmount





			invoke Create AssetInterface
				if(AssetTemplate.Company.CopyUserFields)
					fill in user fields from LocalPayablesInvoiceRel
					fill in user fields from first LocalPayablesInvoiceDistributionsRel
				LocalAccountingEntity										= first PurchaseOrderLineDistributionsRel.DistributionAccount.ToAccountingEntity
				invoked.DistributionCodeBlock								= first PurchaseOrderLineDistributionsRel.DistributionAccount
				invoked.InterfaceSystem										= "AP"
				invoked.Company												= AssetTemplate.Company
				invoked.InvoiceAndPurchaseOrderInformation.InvoiceCompany 	= Company
				invoked.AssetTemplate										= AssetTemplate
				invoked.InvoiceAndPurchaseOrderInformation.Vendor 			= PurchaseOrderLineAsset.Vendor
				invoked.ItemQuantity										= 1
				invoked.InvoiceAndPurchaseOrderInformation.PayablesInvoice	= first PayablesInvoiceRel.PayablesInvoice
				invoked.InvoiceAndPurchaseOrderInformation.PurchaseOrder		= PurchaseOrder	
				invoked.InvoiceAndPurchaseOrderInformation.PurchaseOrderLine 	= PurchaseOrderLineAsset.PurchaseOrderLine
				invoked.TransactionNumberOfDecimals 							= TransactionNumberOfDecimals
				if (AssetCompanyRel.DefaultDepreciationExpenseProject)
					invoked.DepreciationExpenseProject.Project 					= Project
				invoked.BaseItemCost.FunctionalAmount.EnteredCurrencyAmount		= LocalAMITransactionItemCostBase
				invoked.BaseItemTax.FunctionalAmount.EnteredCurrencyAmount		= LocalAMITransactionItemTaxBase
				invoked.TransactionItemCost 									= LocalAMTransactionItemCost
				invoked.TransactionItemTax 										= LocalAMTransactionItemTax

				invoked.BaseNumberOfDecimals = BaseNumberOfDecimals
				invoked.Currency			 = PayablesInvoiceDetailRel.PayablesInvoice.InvoiceCurrency
				invoked.TagNumber			 = TagNumber
				invoked.AssetGroup			 = AssetGroup
				invoked.AssetDescription	 = AssetDescription
				invoked.PurchaseDate         = PurchaseDate
				invoked.PostingDate		 	 = PurchaseDate
				invoked.InServiceDate        = InServiceDate
				if (PurchaseDate not entered)
					invoked.PurchaseDate	 = first PayablesInvoiceRel.InvoiceDate
					invoked.PostingDate		 = first PayablesInvoiceRel.DistributionDate
				if (InServiceDate not entered)
					invoked.InServiceDate	= first PayablesInvoiceRel.InvoiceDate
					
				if (AssetAccountingUnit entered)		
					invoked.AssetAccountingUnit = AssetAccountingUnit
				else 
					if (AssetTemplate.TransactionDimensionDefault.FromTemplate)		
						if (AssetTemplate.AccountingUnit entered)	
							invoked.AssetAccountingUnit		= AssetTemplate.AccountingUnit
						else 	
							LocalAssetAccountingUnit		= first PurchaseOrderLineDistributionsRel.DistributionAccount
							invoked.AssetAccountingUnit		= LocalAssetAccountingUnit
					else 
						if (AssetTemplate.TransactionDimensionDefault.FromDistribution)					
							LocalAssetAccountingUnit		= first PurchaseOrderLineDistributionsRel.DistributionAccount
							invoked.AssetAccountingUnit		= LocalAssetAccountingUnit
						else 
							if (first PurchaseOrderLineDistributionsRel.AssetInformation.AssetTemplate.TransactionDimensionDefault.LeaveBlank)
								initialize invoked.AssetAccountingUnit
				invoked.Combine				= Combine
				if (ItemNumber entered)
					invoked.ItemNumber		= ItemNumber
   				else
	        		invoked.ItemNumber 		= PurchaseOrderLineRel.Item
	        	if (ItemDescription entered)	
					invoked.Description		= ItemDescription				
	        	else
	        		invoked.Description 	= PurchaseOrderLineRel.Description
	        		
				invoked.InvoiceAndPurchaseOrderInformation.InvoiceCompany 		= Company
				invoked.InvoiceAndPurchaseOrderInformation.PurchaseOrder 		= PurchaseOrder
				invoked.InvoiceAndPurchaseOrderInformation.PurchaseOrderLine 	= PurchaseOrderLineAsset.PurchaseOrderLine
				if (!TaxOrAddOnCharge)
					invoked.BarCode				 = BarCode
					invoked.ModelNumber			 = ModelNumber
					invoked.SerialNumber		 = SerialNumber
				invoked.HoldAsset			 = HoldAsset	
				invoked.AssetLocation		 = AssetLocation
				invoked.AssetDivision		 = AssetDivision
				invoked.AssetAccountingUnitGroup	 = AssetAccountingUnitGroup
				invoked.LocationDetail		 = LocationDetail
				invoked.AssetProject		 = Project

		
		ProcessAMRelease

			LocalAMTransactionItemCost = LocalUnitCost
							
			if (LocalUnitTax != 0)
				if (AssetCompanyRel.PayablesDistributionWithTax.Summary)
					LocalAMTransactionItemTax	=  LocalUnitTax
					LocalAMTransactionItemCost	+= LocalUnitTax
				else
					LocalAMTransactionItemTax = 0
			else
				LocalAMTransactionItemTax = 0		 		
			
			if (LocalAocUnitTax != 0)
				if (AssetCompanyRel.PayablesDistributionWithTax.Summary)
					LocalAMTransactionItemTax	+= LocalAocUnitTax
					LocalAMTransactionItemCost	+= LocalAocUnitTax
					
			if (LocalChargeBack)
				LocalAMTransactionItemTax	*= -1
				LocalAMTransactionItemCost	*= -1
								
			if (LocalUnitTax != 0
			and (AssetCompanyRel.PayablesDistributionWithTax.Detail
			or AssetCompanyRel.PayablesDistributionWithTax = "" ))
			
				LocalAMTransactionItemTax	= LocalUnitTax
				LocalAMTransactionItemCost	= LocalUnitTax
				
				if (LocalChargeBack)
					LocalAMTransactionItemTax	*= -1
					LocalAMTransactionItemCost	*= -1
														
			if (LocalAocUnitTax != 0
			and (AssetCompanyRel.PayablesDistributionWithTax.Detail
			or AssetCompanyRel.PayablesDistributionWithTax = "" ))
			
				LocalAMTransactionItemTax	= LocalAocUnitTax
				LocalAMTransactionItemCost	= LocalAocUnitTax
				
				if (LocalChargeBack)
					LocalAMTransactionItemTax	*= -1
					LocalAMTransactionItemCost	*= -1
									
			include CreateAssetInterface	

		ProcessAMUnRelease
			if (LocalUnitTax != 0)
				if (AssetCompanyRel.PayablesDistributionWithTax.Summary)
					LocalAMTransactionItemTax	=  LocalUnitTax
					LocalAMTransactionItemCost	+= LocalUnitTax
				else
					LocalAMTransactionItemTax = 0
			else
				LocalAMTransactionItemTax = 0		 		
			
			if (LocalAocUnitTax != 0)
				if (AssetCompanyRel.PayablesDistributionWithTax.Summary)
					LocalAMTransactionItemTax	+= LocalAocUnitTax
					LocalAMTransactionItemCost	+= LocalAocUnitTax
			
			if (LocalUnitTax != 0
			and (AssetCompanyRel.PayablesDistributionWithTax.Detail
			or AssetCompanyRel.PayablesDistributionWithTax = "" ))
			
				LocalUnitTax 				*= -1 	
				LocalAMTransactionItemTax	= LocalUnitTax
				LocalAMTransactionItemCost	= LocalUnitTax
				
			if (LocalAocUnitTax != 0
			and (AssetCompanyRel.PayablesDistributionWithTax.Detail
			or AssetCompanyRel.PayablesDistributionWithTax = "" ))
			
				LocalAocUnitTax				*= -1
				LocalAMTransactionItemTax	= LocalAocUnitTax
				LocalAMTransactionItemCost	= LocalAocUnitTax
				
			include CreateAssetInterface	
	
	Actions	
	     
	    Create is a Create Action
	    	valid when (IsPOReceiptUnreleased)

	    
	    Update is an Update Action
	    	Entrance Rules
	    		if (AssetCompanyRel.RequireUniqueTags = true)
					if (TagNumber entered) 
						constraint (UniqueAssetsTagRel not exists)
							"TagNumber<TagNumber>IsInUse" 
	    
	    	Action Rules
	    		
	    		LocalTotalDetails = instance count of PurchaseOrderLineAssetDetailRel
				
				if (PurchaseOrderLineAssetRel.InvoicedQuantity > PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
				and PurchaseOrderLineAssetRel.InvoicedQuantity >= PurchaseOrderLineAssetRel.ReceivedQuantity)
					LocalMaxQuantity = PurchaseOrderLineAssetRel.InvoicedQuantity + PurchaseOrderLineAssetRel.CancelledQuantity
				
				else	 	
	    		if (PurchaseOrderLineAssetRel.ReceivedQuantity > PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
	    		and PurchaseOrderLineAssetRel.ReceivedQuantity >= PurchaseOrderLineAssetRel.InvoicedQuantity)
	    			LocalMaxQuantity = PurchaseOrderLineAssetRel.ReceivedQuantity + PurchaseOrderLineAssetRel.CancelledQuantity
				else
					LocalMaxQuantity = PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
				
				if (instance count of PurchaseOrderLineAssetDetailsRel2 != 0)
					LocalTotalReceivedDetails = instance count of PurchaseOrderLineAssetDetailsRel2 
				else 
					LocalTotalReceivedDetails = 0
				
				if (PurchaseOrderLineAssetDetailRel not exists)
					constraint(false)
						"PurchaseOrderLineDetailDoesNotExist"				
				else
					LocalAssetAccountingUnit 	= PurchaseOrderLineAssetDetailRel.AssetAccountingUnit
					LocalProject				= PurchaseOrderLineAssetDetailRel.Project
				
				if (Invoice entered)
					if (first PayablesInvoiceRel not exists)			
						constraint(false)
							"InvoiceDoesNotExist"
					else
						constraint(PayablesInvoiceDetailRel exists)
							"InvoiceIsNoValidForPOLine"
											
	            if(LocalTotalDetails > LocalMaxQuantity)
	            	constraint(false)
	            		"TooManyAssetDetailLinesExist"
	    		
					    						    	    
				if(IsAssetCreated)
	    			constraint (false)
	    				"CannotUpdateDetailIfAssetCreated"
	    					    		
	    Delete is a Delete Action
	    	Action Rules
		    	constraint (not IsAssetCreated)
		    		"CannotDeleteDetails;AssetInterfaceRecordExists"
		    	constraint (not IsReceived 
		    	and not IsReturned
		    	and not IsRejected
		    	and not IsInvoiced
		    	and not IsCancelled)
		    		"CannotDeleteAssetDetail"		   	    	
		    
	    Receive is an Instance Action
	    	valid when (Received.No)
	    	Local Fields
	    		TotalReceivedCount is Numeric size 4
	    		
	    	
	    	Action Rules
	    		
	    		for each PurchaseOrderLineAssetDetailsRels
	    			if (each.Received.Yes)
	    				TotalReceivedCount += 1
	    			    				
	    		constraint (TotalReceivedCount < TotalReceivedQuantity)
	    			"CannotReceiveMoreDetailsThanTotalReceivedQuantity"

				Received = 1
				
				if(IsCancelled)
	    			constraint (false)
	    				"DetailIsCancelled"	    		
	    		
	    	Exit Rules

	    Unreceive is an Instance Action
	    	valid when (Received.Yes)
	    	Action Rules
	    		
				if (Received.Yes)
    				Received = 0
				
				if(IsCancelled)
	    			constraint (false)
	    				"DetailIsCancelled"	    		
				
				constraint (not IsReturned
		    	and not IsRejected
		    	and not IsInvoiced
		    	and not IsCancelled
		    	and not IsAssetCreated)
	    			"CannotUnreceiveMarkedAssetDetail"
	    			
	    Reject is an Instance Action
	    	valid when (IsValidForReject)
	    	Local Fields
	    		TotalRejectedCount is Numeric size 4
	    			    	
	    	Action Rules
	    		
	    		for each PurchaseOrderLineAssetDetailsRels
	    			if(each.IsRejected)
	    				TotalRejectedCount += 1

				constraint (TotalRejectedCount < TotalRejectedQuantity)
					"CannotRejectMoreDetailsThanTotalRejectedQuantity"				
	    	














	    					    				
	    		Rejected = 1	    					    						    					 	    		
	    
		Unreject is an Instance Action
			valid when (IsValidForUnreject)
			Local Fields
			Action Rules
				if (Rejected.Yes)
					Rejected = Rejected.No
				







	    
	    Return is an Instance Action
	    	Local Fields
	    		TotalReturnCount is Numeric size 4
	    			    	
	    	Action Rules
	    		
	    		for each PurchaseOrderLineAssetDetailsRels
	    			if(each.IsReturned)
	    				TotalReturnCount += 1




	    		
	    		if(TotalReturnCount > TotalReturnedQuantity)
	    			constraint (false)
	    				"CannotReturnMoreDetailsThanTotalReturnedQuantity"


				if(IsCancelled)
	    			constraint (false)
	    				"DetailIsCancelled"
				if(not IsReceived)
	    			constraint (false)
	    				"CannotReturnDetailIfNotReceived"		    				

	    		Returned = 1	    					
	    				 	    		
		
	    
	    Invoice is an Instance Action
	    	
	    	Action Rules
				if(IsCancelled)
	    			constraint (false)
	    				"DetailIsCancelled"	
	    				
	    		Invoiced = 1	    				 	    		 		
	    
	    Cancel is an Instance Action
	    	Local Fields
	    		TotalCancelledCount is Numeric size 4
	    		
	    	Action Rules
				if(IsReceived or IsInvoiced)
	    			constraint (false)
	    				"CannotCancelIfDetailIsMarked"				
	           	
	           	for each PurchaseOrderLineAssetDetailsRels
	    			if (each.IsCancelled)
	    				TotalCancelledCount += 1
	    		
	            constraint (TotalCancelledCount < PurchaseOrderLineAsset.DerivedPurchaseOrderLineCancelledQuantity)
	            	"CannotCancelMoreDetailsThanTotalCancelledQuantity"
	            
	            Cancelled = Cancelled.Yes
	            
	            increment PurchaseOrderLineAsset.CancelledQuantity by 1

	    CreatePurchaseOrderLineAssetDetails is a Create Action
	       	restricted	    	
	    	Parameters
	    		PrmCompany  		is a PurchasingCompany
	    		PrmPONumber 		is a PurchaseOrder
				PrmLineNumber		is a PurchaseOrderLineAsset
				PrmDetailSeqNumber 	is a PurchaseOrderLineAssetDetail
				PrmInvoice			is an Invoice
				PrmPurchaseDate		is Date
				PrmInServiceDate	is Date
				
			Parameter Rules
				PrmInvoice
					initial value is PrmDetailSeqNumber.Invoice	
				
				PrmPurchaseDate
					initial value is PrmDetailSeqNumber.PurchaseDate		

				PrmInServiceDate
					initial value is PrmDetailSeqNumber.InServiceDate		

				
			Field Rules					
				LocalChargeBack
					default to true
				
					
			Entrance Rules
				
				if (instance count of PurchaseOrderLineAssetDetailsRel2 != 0)
					LocalTotalReceivedDetails = instance count of PurchaseOrderLineAssetDetailsRel2  
				else 
					LocalTotalReceivedDetails = 0	 
			
			Action Rules
							
				LocalTotalDetails 	= instance count of PurchaseOrderLineAssetDetailRel
				LocalTotalQuantity 	= PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity  
				
				if (PurchaseOrderLineAssetRel.InvoicedQuantity > PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
				and PurchaseOrderLineAssetRel.InvoicedQuantity >= PurchaseOrderLineAssetRel.ReceivedQuantity)
					LocalMaxQuantity = PurchaseOrderLineAssetRel.InvoicedQuantity + PurchaseOrderLineAssetRel.CancelledQuantity
				
				else	 	
	    		if (PurchaseOrderLineAssetRel.ReceivedQuantity > PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
	    		and PurchaseOrderLineAssetRel.ReceivedQuantity >= PurchaseOrderLineAssetRel.InvoicedQuantity)
	    			LocalMaxQuantity = PurchaseOrderLineAssetRel.ReceivedQuantity + PurchaseOrderLineAssetRel.CancelledQuantity
				else
					LocalMaxQuantity = PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
				
				if (PurchaseOrderLineAssetDetailRel not exists)
					constraint(false)
						"PoLineDetailDoesNotExist"				

	            if(LocalTotalDetails > LocalMaxQuantity)
	            	constraint(false)
	            		"TooManyAssetDetailLinesExist"

            	if(LocalTotalDetails > 0) 
            		LocalDistDetails = LocalTotalQuantity 
            		if(PurchaseOrderLineAssetDetailRel exists)
            			LocalLastSeqNumber  = instance count of PurchaseOrderLineAssetDetailRel
            		else
            			LocalLastSeqNumber = 0
            		for each PurchaseOrderLineAssetDetailRel
            			if(LocalLastSeqNumber != 0)
	            			LocalLastSeqNumber = LocalLastSeqNumber + 1
	            		else
	            			LocalLastSeqNumber = 1
            			invoke Create PurchaseOrderLineAssetDetail	            						            					
            				invoked.PurchaseOrderLineAssetDetail 			= LocalLastSeqNumber
            				invoked.AssetTemplate 							= first PurchaseOrderReceiptAdjustmentAndInspectionLineDistRel.AssetInformation.AssetTemplate
            				if(PurchaseOrderLineAssetDefaultsRel exists)
            					invoked.AssetDescription 			= PurchaseOrderLineAssetDefaultsRel.AssetDescription
		    					invoked.TagNumber 					= PurchaseOrderLineAssetDefaultsRel.TagNumber
		    					invoked.AssetGroup 					= PurchaseOrderLineAssetDefaultsRel.AssetGroup
		    					invoked.AssetAccountingUnitGroup 	= PurchaseOrderLineAssetDefaultsRel.AssetAccountingUnitGroup
            					if(PurchaseOrderLineAssetDefaultsRel.Project != "" )
            						invoked.Project 				= PurchaseOrderLineAssetDefaultsRel.Project		            						
            					invoked.Combine 					= PurchaseOrderLineAssetDefaultsRel.Combine
            					if(PurchaseOrderLineAssetDefaultsRel.HoldAsset != "" )
            						invoked.HoldAsset 				= PurchaseOrderLineAssetDefaultsRel.HoldAsset
            					
            					if(PurchaseOrderLineAssetDefaultsRel.ItemNumber != "" )
            						invoked.ItemNumber 				= PurchaseOrderLineAssetDefaultsRel.ItemNumber
            					if(PurchaseOrderLineAssetDefaultsRel.ItemDescription != "" )
            						invoked.ItemDescription 		= PurchaseOrderLineAssetDefaultsRel.ItemDescription	
            					invoked.ModelNumber					= PurchaseOrderLineAssetDefaultsRel.ModelNumber
            					invoked.PurchaseDate 				= PurchaseOrderLineAssetDefaultsRel.PurchaseDate
		    					invoked.InServiceDate 				= PurchaseOrderLineAssetDefaultsRel.InServiceDate
		    					invoked.AssetLocation 				= PurchaseOrderLineAssetDefaultsRel.AssetLocation
		    					invoked.AssetDivision 				= PurchaseOrderLineAssetDefaultsRel.AssetDivision
            					if(PurchaseOrderLineAssetDefaultsRel.LocationDetail != "" )
            						invoked.LocationDetail 			= PurchaseOrderLineAssetDefaultsRel.LocationDetail
            					
            				
            				if(PrmInvoice entered
            				and PrmPurchaseDate not entered
            				and PrmInServiceDate not entered)
            					invoked.PurchaseDate 				= PayablesInvoiceDetailRel.PayablesInvoice.InvoiceDate
            					invoked.InServiceDate				= PayablesInvoiceDetailRel.PayablesInvoice.InvoiceDate
            					invoked.Currency					= PayablesInvoiceDetailRel.PayablesInvoice.InvoiceCurrency
            					invoked.TransactionNumberOfDecimals = PayablesInvoiceDetailRel.PayablesInvoice.NumberOfDecimals
            				if(GeneralLedgerCompanyRel.Currency exists)
								invoked.BaseNumberOfDecimals		= GeneralLedgerCompanyRel.Currency.NumberOfDecimals	 
            				
            				if (PurchaseOrderLineRel exists
            				and PurchaseOrderLineAssetDefaultsRel not exists)
				        		invoked.ItemNumber 		= PurchaseOrderLineRel.Item
				        		invoked.ItemDescription = PurchaseOrderLineRel.Description	
            	else	            		
            		if(PurchaseOrderLineAssetDetailRel exists)
            			LocalLastSeqNumber = instance count of PurchaseOrderLineAssetDetailRel
            		else
            			LocalLastSeqNumber = 0
            			
            		for each PurchaseOrderReceiptAdjustmentAndInspectionLineDistRel
            			if(LocalLastSeqNumber != 0)
	            			LocalLastSeqNumber = LocalLastSeqNumber + 1
	            		else
	            			LocalLastSeqNumber = 1
            			if(each.DistributionQuantity = 0)
            				LocalDistDetails   = LocalTotalQuantity
            				LocalTotalQuantity = 0
            			else
            				if(each.DistributionQuantity < 1)
            					LocalDistDetails	= 1
            					LocalTotalQuantity  = LocalTotalQuantity - LocalDistDetails
            				else
            					LocalDistDetails 	= each.DistributionQuantity
            					LocalTotalQuantity  = LocalTotalQuantity - each.DistributionQuantity			
            			LocalPurchaseOrderReceiptAdjustmentAndInspectionLine = each.POReceiptAdjustmentAndInspectionLineDistribution
            			include CreatePurchaseOrderLineAssetDetail          					 	
            			
            		
					if(LocalTotalQuantity != 0)
						LocalDistDetails = LocalTotalQuantity						
						
						for each PurchaseOrderReceiptAdjustmentAndInspectionLineDistRel
							if(LocalLastSeqNumber != 0)
	            				LocalLastSeqNumber = LocalLastSeqNumber + 1
	            			else
	            				LocalLastSeqNumber = 1
	            				
							LocalPurchaseOrderReceiptAdjustmentAndInspectionLine = each.POReceiptAdjustmentAndInspectionLineDistribution
							include CreatePurchaseOrderLineAssetDetail 
	    	 
	    
	    ProcessPOLineAssetDetails is an Instance Action
	    	restricted
	    	Parameters
	    		PrmCompany  		is a Company
	    		PrmPONumber 		is a PurchaseOrder
				PrmLineNumber		is a PurchaseOrderLineAsset
				PrmDetailSeqNumber 	is a PurchaseOrderLineAssetDetail
				PrmFunction 		is Alpha size 10 
				PrmInvoice 			is a PayablesInvoice
				
			Parameter Rules
					
			
			Action Rules

				LocalFunction = PrmFunction			
				
				LocalTotalQuantity = PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity  
				
				LocalChargeBack = true	
				
				LocalTotalDetails = instance count of PurchaseOrderLineAssetDetailRel
				
				if (PurchaseOrderLineAssetRel.InvoicedQuantity > PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
				and PurchaseOrderLineAssetRel.InvoicedQuantity >= PurchaseOrderLineAssetRel.ReceivedQuantity)
					LocalMaxQuantity = PurchaseOrderLineAssetRel.InvoicedQuantity + PurchaseOrderLineAssetRel.CancelledQuantity
				
				else	 	
	    		if (PurchaseOrderLineAssetRel.ReceivedQuantity > PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
	    		and PurchaseOrderLineAssetRel.ReceivedQuantity >= PurchaseOrderLineAssetRel.InvoicedQuantity)
	    			LocalMaxQuantity = PurchaseOrderLineAssetRel.ReceivedQuantity + PurchaseOrderLineAssetRel.CancelledQuantity
				else
					LocalMaxQuantity = PurchaseOrderLineAssetRel.PurchaseOrderLineQuantity
				
				if (instance count of PurchaseOrderLineAssetDetailsRel2 != 0)
					LocalTotalReceivedDetails = instance count of PurchaseOrderLineAssetDetailsRel2  
				else 
					LocalTotalReceivedDetails = 0
				
				if (PurchaseOrderLineAssetDetailRel not exists)
					constraint(false)
						"PoLineDetailDoesNotExist"				
				else
					LocalAssetAccountingUnit 	= PurchaseOrderLineAssetDetailRel.AssetAccountingUnit
					LocalProject		= PurchaseOrderLineAssetDetailRel.Project
		       
	            if(LocalTotalDetails > LocalMaxQuantity)
	            	constraint(false)
	            		"TooManyAssetDetailLinesExist"

				if  (LocalFunction = "Release"  
				and  AssetCreated.No
				and  Returned.No
				and  Rejected.No)
					invoke ReleasePurchaseOrderLineAssetDetail PurchaseOrderLineAssetDetail
						invoked.PrmInvoice = PrmInvoice
					
				if (LocalFunction = "UnRelease")
				
					LocalUnitCost 				+= LocalAocUnitCost
					LocalUnitCost 				*= -1
					LocalAMTransactionItemCost	 = LocalUnitCost				
					
					include ProcessAMUnRelease	
				
		ReleasePurchaseOrderLineAssetDetail is an Instance Action
			restricted			
			
			Parameters
				PrmInvoice is a PayablesInvoice

			Local Fields
				
			Action Rules

				LocalInvoiceDate 			= first PayablesInvoiceRel.InvoiceDate 
				LocalReleaseQuantity 		= 0
				
				if (action type.Update)	 				
					include PerformInvoiceDetail
					
					LocalUnitCost 			= LocalInvoiceDetailTotal / LocalInvoiceDetailHashQuantity   
					LocalMatchedQuantity 	= LocalInvoiceDetailHashQuantity 													
				
					if(LocalMatchedQuantity > 0
					and LocalMatchedQuantity < 1)
						LocalMatchedQuantity = 1
				
					if(LocalInvoiceDetailTaxCode not = "")
						if(CompanyTaxCodeRel exists)
							if(CompanyTaxCodeRel.LandedCost)
								LocalTaxAmount = LocalInvoiceDetailTaxTotal 
							else
							if (CompanyTaxCodeRel.LandedCost not entered )
								initialize CalculateTax    
								CalculateTax.Function			= "C"								 
								CalculateTax.InvoiceCompany		= first PayablesInvoiceRel.Company
								CalculateTax.TaxCode			= LocalInvoiceDetailTaxCode
								CalculateTax.InvoiceDate		= first PayablesInvoiceRel.InvoiceDate
								CalculateTax.PaymentDate		= first PayablesInvoiceRel.InvoiceDate
								CalculateTax.TaxDate			= first PayablesInvoiceRel.InvoiceDate
								CalculateTax.GeneralLedgerDate	= first PayablesInvoiceRel.InvoiceDate								
								CalculateTax.System				= "AP"
								CalculateTax.NumberOfDecimals	= first PayablesInvoiceRel.NumberOfDecimals
								CalculateTax.TaxableAmount		= LocalInvoiceDetailTotal

								if (CalculateTax.TaxableAmount = ""
								and CalculateTax.InvoiceAmount = "")								
									LocalTaxAmount = 0
								if (CalculateTax.InvoiceCompany = "")
									LocalTaxAmount = 0

							else 
								LocalTaxAmount = 0
										
					include ProcessAocCode   
					
					if(LocalMaaTotalLandedAoc != 0)
						LocalAocUnitCost = LocalMaaTotalLandedAoc / LocalInvoiceDetailHashQuantity 
					else
						LocalAocUnitCost = 0
					
					if(LocalMaaTaxCode != "")
						if(CompanyTaxCodeRel exists
						and CompanyTaxCodeRel.LandedCost)
							LocalAocTaxAmount = LocalMaaInvoiceTotalTax
						else
							LocalAocTaxAmount = 0

				LocalMatchedQuantitySav	= LocalMatchedQuantity
				
				if(LocalMatchedQuantity > 0
				and LocalMatchedQuantity < 1) 
					LocalMatchedQuantitySav = 1
				
				if(LocalTaxAmount != 0 
				and LocalMatchedQuantitySav !=0)
					LocalUnitTax = LocalTaxAmount / LocalMatchedQuantity
					LocalUnitTax = LocalUnitTax / LocalMatchedQuantitySav
				else 
					LocalUnitTax = 0
				
				if(LocalAocTaxAmount != 0
				and LocalMatchedQuantitySav !=0)
					LocalAocUnitTax = LocalAocTaxAmount / LocalMatchedQuantity
					LocalAocUnitTax = LocalAocTaxAmount / LocalMatchedQuantitySav
					
				else
					LocalAocUnitTax = 0		

				LocalTotalAodReceived = 0
				
				if(PurchaseOrderLineAssetDetailsRel2 exists)
					LocalTotalAodReceived = TotalReceivedQuantity

				if(PurchaseOrderLineAssetDetailsRels exists)
					for each PurchaseOrderLineAssetDetailsRels 
					 	LocalReleaseQuantity += 1			
				
				
				if (action type.Update
				and Invoiced = 1
				and AssetCreated != 1
				and Returned != 1
				and Rejected != 1)
					if((PurchaseOrderLineAsset.Dropship = "N"   
					and Received = 1)
					or PurchaseOrderLineAsset.Dropship = "Y"
					or LocalChargeBack)
						LocalReleaseQuantity += 1	




					
				if(LocalReleaseQuantity > 0)
					LocalUnitCost += LocalAocUnitCost 

					Invoice 		= PrmInvoice.Invoice
					Suffix			= PrmInvoice.Suffix

					if(InServiceDate not entered)
						InServiceDate = first PayablesInvoiceRel.InvoiceDate
							
					if(PurchaseDate not entered)
						PurchaseDate = first PayablesInvoiceRel.InvoiceDate
						
					Invoiced 		= 1
					AssetCreated 	= 1

					include ProcessAMRelease										
						
					if(LocalChargeBack)
						LocalReleaseQuantity *= 2
							
					
					LocalAssetCreateQuantity 			+= LocalReleaseQuantity 
					LocalAssetDistQuantity				+= LocalReleaseQuantity	 	
				else
					LocalAssetCreateQuantity 			= 0
					LocalAssetDistQuantity				= 0			
			
		Match is an Instance Action
			restricted			
			
			Parameters
				PrmInvoice is a PayablesInvoice

			Local Fields
				
			Action Rules


				LocalPayablesInvoice			= PrmInvoice			
				Invoice 						= PrmInvoice.Invoice
				Suffix							= PrmInvoice.Suffix

				if(InServiceDate not entered)
					InServiceDate = first PayablesInvoiceRel.InvoiceDate
						
				if(PurchaseDate not entered)
					PurchaseDate = first PayablesInvoiceRel.InvoiceDate
					
				Invoiced 						= 1
				AssetCreated 					= 1


				LocalAMTransactionItemTax  		= first PayablesInvoiceDetail2Rel.TaxAmount / PayablesInvoiceDetail2Rel.MatchedQuantity
        		LocalAMTransactionItemCost 		= first PayablesInvoiceDetail2Rel.EnteredUnitCost 

		    	if (AssetCompanyRel.PayablesDistributionWithTax.Summary)
            		LocalAMTransactionItemCost 	+= LocalAMTransactionItemTax
            		LocalAMTransactionItemCost 	+= first PayablesInvoiceDetail2Rel.TotalAddOnCost / PayablesInvoiceDetail2Rel.MatchedQuantity
            		LocalAMTransactionItemCost 	+= first PayablesInvoiceDetail2Rel.TotalAddOnCostTax / PayablesInvoiceDetail2Rel.MatchedQuantity

            		LocalAMTransactionItemTax 	+= first PayablesInvoiceDetail2Rel.TotalAddOnCostTax / PayablesInvoiceDetail2Rel.MatchedQuantity

			    	include CreateAssetInterface
				else
			    	include CreateAssetInterface
			    	
			    	if (LocalAMTransactionItemTax entered)

		                
		                TaxOrAddOnCharge			= true
	            		LocalAMTransactionItemCost 	= first PayablesInvoiceDetail2Rel.TaxAmount / PayablesInvoiceDetail2Rel.MatchedQuantity
	            		initialize LocalAMTransactionItemTax
		                include CreateAssetInterface
		                TaxOrAddOnCharge			= false

		            if (first PayablesInvoiceDetail2Rel.TotalAddOnCost entered)

		                
		                TaxOrAddOnCharge			= true
	            		LocalAMTransactionItemCost 	= first PayablesInvoiceDetail2Rel.TotalAddOnCost / PayablesInvoiceDetail2Rel.MatchedQuantity
	            		LocalAMTransactionItemTax 	= first PayablesInvoiceDetail2Rel.TotalAddOnCostTax / PayablesInvoiceDetail2Rel.MatchedQuantity
		                include CreateAssetInterface			    	
		                TaxOrAddOnCharge			= false

		            if (first PayablesInvoiceDetail2Rel.TotalAddOnCostTax entered)

		                
		                TaxOrAddOnCharge			= true
	            		LocalAMTransactionItemCost 	= first PayablesInvoiceDetail2Rel.TotalAddOnCostTax / PayablesInvoiceDetail2Rel.MatchedQuantity
	            		initialize LocalAMTransactionItemTax
		                include CreateAssetInterface			    	
		                TaxOrAddOnCharge			= false


		Unmatch is an Instance Action
			restricted			
			
			Parameters
				PrmInvoice is a PayablesInvoice

			Local Fields
				
			Action Rules


				LocalPayablesInvoice			= PrmInvoice			
				

				LocalAMTransactionItemTax  		= first PayablesInvoiceDetail2Rel.TaxAmount / PayablesInvoiceDetail2Rel.MatchedQuantity
        		LocalAMTransactionItemCost 		= first PayablesInvoiceDetail2Rel.TotalDistributionAmount / PayablesInvoiceDetail2Rel.MatchedQuantity
				LocalAMTransactionItemTax  		*= -1 
        		LocalAMTransactionItemCost 		*= -1

		    	if (AssetCompanyRel.PayablesDistributionWithTax.Summary)
            		LocalAMTransactionItemCost 	+= LocalAMTransactionItemTax 
            		LocalAMTransactionItemCost 	+= first PayablesInvoiceDetail2Rel.TotalAddOnCost * -1 / PayablesInvoiceDetail2Rel.MatchedQuantity
            		LocalAMTransactionItemCost 	+= first PayablesInvoiceDetail2Rel.TotalAddOnCostTax * -1 / PayablesInvoiceDetail2Rel.MatchedQuantity

            		LocalAMTransactionItemTax 	+= first PayablesInvoiceDetail2Rel.TotalAddOnCostTax * -1 / PayablesInvoiceDetail2Rel.MatchedQuantity

			    	include CreateAssetInterface
				else
			    	include CreateAssetInterface
			    	
			    	if (LocalAMTransactionItemTax entered)

		                
	            		LocalAMTransactionItemCost 	= first PayablesInvoiceDetail2Rel.TaxAmount * -1 / PayablesInvoiceDetail2Rel.MatchedQuantity  
	            		initialize LocalAMTransactionItemTax
		                include CreateAssetInterface
		                
		            if (first PayablesInvoiceDetail2Rel.TotalAddOnCost entered)

		                
	            		LocalAMTransactionItemCost 	= first PayablesInvoiceDetail2Rel.TotalAddOnCost * -1 / PayablesInvoiceDetail2Rel.MatchedQuantity
	            		LocalAMTransactionItemTax 	= first PayablesInvoiceDetail2Rel.TotalAddOnCostTax * -1 / PayablesInvoiceDetail2Rel.MatchedQuantity
		                include CreateAssetInterface			    	

			    	if (LocalAMTransactionItemTax entered)

		                
	            		LocalAMTransactionItemCost 	= first PayablesInvoiceDetail2Rel.TotalAddOnCostTax * -1  / PayablesInvoiceDetail2Rel.MatchedQuantity
	            		initialize LocalAMTransactionItemTax
		                include CreateAssetInterface
		                


				initialize Invoice
				initialize Suffix
				initialize InServiceDate 
				initialize PurchaseDate 
				initialize Invoiced 
				initialize AssetCreated 	

		
		Purge is a Purge Action
			restricted

		MatchAssetDetailsSet is a Set Action
			run in background
			Parameters
				PrmCompany is a PayablesCompany 
				PrmPurchaseOrder is a PurchaseOrder 
				PrmPurchaseOrderLine is a PurchaseOrderLine 
				PrmInvoice is a PayablesInvoice
				PrmMatchedQuantity is a Quantity 
			Parameter Rules 
				PrmCompany 
					required 
				PrmPurchaseOrder 
					required 
				PrmPurchaseOrderLine 
					required 
				PrmInvoice  
					required 
			Local Fields 
				Idx is Numeric 9 
			Instance Selection 
				where (Company = PrmCompany 
				and    PurchaseOrder = PrmPurchaseOrder 
				and    PurchaseOrderLineAsset = PrmPurchaseOrderLine
				and    Invoiced.No)
			Action Rules 
				Instance Rules
					if (Idx < PrmMatchedQuantity)
						Idx += 1
						invoke Match
							invoked.PrmInvoice = PrmInvoice 

		UnmatchAssetDetailsSet is a Set Action
			Parameters
				PrmCompany is a PayablesCompany 
				PrmPurchaseOrder is a PurchaseOrder 
				PrmPurchaseOrderLine is a PurchaseOrderLine 
				PrmInvoice is a PayablesInvoice
				PrmMatchedQuantity is a Quantity 
			Parameter Rules 
				PrmCompany 
					required 
				PrmPurchaseOrder 
					required 
				PrmPurchaseOrderLine 
					required 
				PrmInvoice  
					required 
			Local Fields 
				Idx is Numeric 9 
			Instance Selection 
				where (Company = PrmCompany 
				and    PurchaseOrder = PrmPurchaseOrder 
				and    PurchaseOrderLineAsset = PrmPurchaseOrderLine
				and    Invoiced.Yes)
			Action Rules 
				Instance Rules
					if (Idx < PrmMatchedQuantity)
						Idx += 1
						invoke Unmatch
							invoked.PrmInvoice = PrmInvoice 
		
		ReceiveAssetDetailsSet is a Set Action
			restricted
			Parameters
				PrmCompany 			  is like PayablesCompany 
				PrmPurchaseOrder      is like PurchaseOrder 
				PrmPurchaseOrderLine  is like PurchaseOrderLine

			Instance Selection
				where (Company                = PrmCompany
				and    PurchaseOrder          = PrmPurchaseOrder
				and    PurchaseOrderLineAsset = PrmPurchaseOrderLine
				and    Cancelled.No
				and    Received.No)

			Action Rules
				Instance Rules
					Received = 1
