RecallType is a BusinessClass
    owned by recall
    prefix is RMRT

    Ontology
    	symbolic key is RecallType
    	
    Persistent Fields
    	Description 				is Alpha size 250
    	Active						is Boolean
    	RecallAlerts
    	DefaultFDAClassification	is Numeric size 2
    		default label is "FDAClassification"
    		States
    			ClassI					value is 1
    			ClassII					value is 2
    			ClassIII				value is 3
    	ForItemProposal              is Boolean
   			default label is "ForNewItemProposal"
   	
	Local Fields
		LocalPeriod					  is Numeric size 5
								

	Context Fields
		RecallReport
		RecallReportPeriod
				
   	Field Rules
   		Description
   			required
   				"DescriptionIsRequired"
   		
   		Active
            default to true
        
        DefaultFDAClassification
        	if (ForItemProposal)
        		initialize DefaultFDAClassification
        
  	Attach Rules
		constraint (Active)
			"TypeIsInactive"
	
	Conditions
	
		ForNewItemProposal
			restricted
			when (ForItemProposal)
	
	Derived Fields
		Period1NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 1
			return (instance count of LocalPeriodNoticeRel)
			
		Period2NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 2
			return (instance count of LocalPeriodNoticeRel)
			
		Period3NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 3
			return (instance count of LocalPeriodNoticeRel)
			
		Period4NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 4
			return (instance count of LocalPeriodNoticeRel)
			
		Period5NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 5
			return (instance count of LocalPeriodNoticeRel)
			
		Period6NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 6
			return (instance count of LocalPeriodNoticeRel)
			
		Period7NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 7
			return (instance count of LocalPeriodNoticeRel)
			
		Period8NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 8
			return (instance count of LocalPeriodNoticeRel)
			
		Period9NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 9
			return (instance count of LocalPeriodNoticeRel)
			
		Period10NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 10
			return (instance count of LocalPeriodNoticeRel)
			
		Period11NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 11
			return (instance count of LocalPeriodNoticeRel)
			
		Period12NoticeCount is a DerivedField
			type is Numeric 5
			LocalPeriod = 12
			return (instance count of LocalPeriodNoticeRel)
			
		AnyPeriodNoticeCount is a ComputeField
			type is Numeric 5
			default label is "TotalNoticesAllPeriods"
			(instance count of AnyPeriodNoticeRel)
			
		DescriptionAndCount is a DerivedField
			type is like Description
			restricted
			return Description + " (" + AnyPeriodNoticeCount + ")"
			

	Relations
    	LocalPeriodNoticeRel
    		one-to-many relation to RecallNotice
    		Field Mapping uses ByRecallType
    			related.RecallGroup			= RecallGroup
    			related.RecallType			= RecallType
    		Instance Selection
				where (related.RecallNotice.ApplicableRecallNotice
				and    related.RecallNotice.DerivedReleaseDate >= LocalPeriodRel.ReportFromDate
				and    related.RecallNotice.DerivedReleaseDate <= LocalPeriodRel.ReportThruDate) 

    	AnyPeriodNoticeRel
    		one-to-many relation to RecallNotice
    		Field Mapping uses ByRecallType
    			related.RecallGroup			= RecallGroup
    			related.RecallType			= RecallType
    		Instance Selection
				where (related.RecallNotice.ApplicableRecallNotice
				and    related.RecallNotice.DerivedReleaseDate >= RecallReport.ReportFromDate
				and    related.RecallNotice.DerivedReleaseDate <= RecallReport.ReportThruDate) 

		LocalPeriodRel
			one-to-one relation to RecallReportPeriod
			Field Mapping uses symbolic key
				related.RecallGroup             = RecallGroup
				related.RecallReport			= RecallReport
				related.RecallReportPeriod		= LocalPeriod
				
		RecallReportRel
			one-to-one relation to RecallReport
			Field Mapping uses symbolic key
				related.RecallGroup             = RecallGroup
				related.RecallReport			= RecallReport
				
	Actions
		Create is a Create Action
		
		Update is an Update Action
		
		Delete is a Delete Action
		
		Purge is a Purge Action
			restricted
