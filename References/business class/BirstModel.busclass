BirstModel is a BusinessClass
	prefix is BMDL
	owned by la

	Patterns
		disable AsOfDateProcessing

	Ontology
		symbolic key is BirstModel

	Persistent Fields
		Description		is Text
		ModelType		is Numeric size 1
			States
				LiveAccess				value is 0
				AdvancedDataModeling	value is 1
		BirstSpace

	Local Fields
		LocalUpdateMessage					is Text
		LocalBirstModelSpaceID				is Alpha 50
		LocalBirstConsumerSpaceID			is Alpha 50
		LocalBirstConnectionID				is Alpha 50
		LocalBirstBirstDashboard			is Alpha 100
		LocalBirstReportPath				is Alpha 100
		LocalBirstWebServiceURL				is Alpha 100
		LocalSchemaName						is Alpha 50
		LocalPackageName					is Alpha 50
		LocalIDPID							is Alpha 50
		LocalBirstLiveAccessApplicationLID	is Alpha 300
		LocalBusinessClass					is like BusinessClass
		LocalBirstModelResultView			is a BirstModelResult view
		LocalBirstModelResult				is UniqueID
		LocalStatus							is Numeric size 1
			States
				Success	value is 1
				Error	value is 2
		LocalApplicationKey					is Alpha size 200
		LocalApplicationSecret				is Password
		LocalResourceUser					is Alpha size 200
		LocalResourcePassword				is Password
		LocalAccessTokenURL					is Alpha size 1000
		LocalBirstWsiEndpoint				is Alpha size 1000
		LocalIonApiCredentials				is Alpha size 1000
		LocalSetValuesFromCredentials		is Boolean
		LocalBirstSpaceGroup				is Alpha 50
		LocalBirstSpace						is Alpha 50
		LocalSpaceName						is Alpha 60
		LocalOwnerUsername					is Alpha 60
		LocalAvailableForIntegration		is Boolean
		LocalRequiredBirstFieldsEntered		is Boolean

	Derived Fields
		DerivedBirstUserName is a DerivedField
			type is Alpha size 100
			restricted
			return config(Analytics).BirstUsername

		DerivedBirstPassword is a NativeField
			type is Password
			restricted

		DerivedBirstModelSpaceID is a DerivedField
			type is Alpha size 50
			restricted
			return config(Analytics).BirstModelSpaceID

		DerivedBirstConsumerSpaceID is a DerivedField
			type is Alpha size 50
			restricted
			return config(Analytics).BirstConsumerSpaceID

		DerivedBirstDashboard is a DerivedField
			type is Alpha size 100
			restricted
			return config(Analytics).BirstDashboard
			
		DerivedBirstReportPath is a DerivedField
			type is Alpha size 100
			restricted
			return config(Analytics).BirstReportPath
			
		DerivedBirstWebServiceURL is a DerivedField
			type is Alpha size 100
			restricted
			return config(Analytics).BirstWebServiceURL
			
		DerivedBirstLiveAccessConnectionID is a DerivedField
			type is Alpha size 50
			restricted
			return config(Analytics).BirstLiveAccessConnectionID
			
		DerivedBirstLiveAccessSchemaName is a DerivedField
			type is Alpha size 50
			restricted
			return config(Analytics).BirstLiveAccessSchemaName

		DerivedBirstLiveAccessPackageName is a DerivedField
			type is Alpha size 50
			restricted
			return config(Analytics).BirstLiveAccessPackageName
			
		DerivedIDPID is a DerivedField
			type is Alpha size 50
			restricted
			return config(Analytics).BirstIDpid
			
		DerivedBirstLiveAccessApplicationLID is a DerivedField
			type is Alpha size 50
			restricted
			return config(Analytics).BirstLiveAccessApplicationLID

		DerivedApplicationKey is a DerivedField
			type is Alpha size 200
			restricted
			return BirstClientOAuthRel.ApplicationKey
			
		DerivedApplicationSecret is a DerivedField
			type is Password
			restricted
			return BirstClientOAuthRel.ApplicationSecret
			
		DerivedResourceUser is a DerivedField
			type is Alpha size 200
			restricted
			return BirstClientOAuthRel.ResourceUser
			
		DerivedResourcePassword is a DerivedField
			type is Password
			restricted
			return BirstClientOAuthRel.ResourcePassword
			
		DerivedAccessTokenURL is a DerivedField
			type is Alpha size 1000
			restricted
			return BirstClientOAuthRel.AccessTokenURL	

		DerivedBirstWsiEndpoint is a DerivedField
			type is Alpha size 1000
			restricted
			return BirstWsiEndpointParamRel.Value

		EnableV2BirstIntegration is a DerivedField
			type is Boolean
			restricted
			return config(Analytics).BirstEnableV2Integration

		BirstModelResultDescription is a MessageField
			"Update_\BirstModel"

	Actions
		Create is an Action
		Update is an Action
		Delete is an Action
		Purge is a Purge Action
		
		ClearCache is an Instance Action
			confirmation required

			Action Rules


		LoadSpacesFromBirst is an Instance Action
			confirmation required

			Action Rules

			Exit Rules


		CreateNewBirstSpace is an Instance Action
			confirmation required
			
			Parameters
				PrmSpaceName	is Alpha 60
					default label is "SpaceName"
					
			Parameter Rules
				PrmSpaceName
					required					

			Entrance Rules


			Action Rules
				if (LocalRequiredBirstFieldsEntered)
					invoke CreateBirstSpaceRecord

		CreateBirstSpaceRecord is an Instance Action
			restricted
			Action Rules
				if (!LocalBirstSpaceRel exists)
					invoke Create BirstSpace
						invoked.BirstSpace				= LocalBirstSpace
						invoked.SpaceName				= LocalSpaceName
						invoked.AvailableForIntegration	= LocalAvailableForIntegration
						invoked.OwnerUsername			= LocalOwnerUsername

		CreateBirstModelResult is an Instance Action
			restricted
			Action Rules
				invoke Create BirstModelResultDetail
					invoked.BirstModelResult	= LocalBirstModelResult
					invoked.Status				= LocalStatus
					invoked.Message				= LocalUpdateMessage
					invoked.BirstModel			= BirstModel
					invoked.BusinessClass		= LocalBusinessClass

		UpdateModel is an Instance Action
			run in background
			Parameters
				UpdateTable		is Boolean
				UpdateJoins		is Boolean
				UpdatePackage	is Boolean

			Local Fields 	
				LocalActor			is an Actor
				
			Entrance Rules
				LocalActor	= actor
				invoke Create BirstModelResult
					assign result to LocalBirstModelResultView
					invoked.User			= LocalActor
					invoked.Description		= BirstModelResultDescription
			
				LocalBirstModelResult = LocalBirstModelResultView.BirstModelResult
			
			Action Rules


		SetConfigurationParameters is an Instance Action
		
			Parameters
				BirstUserName					is Alpha 100
				BirstPassword					is Password
				SetDefaultParameterValues		is Boolean
				SetDefaultLIDandWebServiceURL	is Boolean
				BirstModelSpaceID				is Alpha 50
				BirstConsumerSpaceID			is Alpha 50
				BirstReportPath					is Alpha 100
				BirstDashboard					is Alpha 100
				BirstWebServiceURL				is Alpha 100
				BirstLiveAccessConnectionID		is Alpha 100
				BirstLiveAccessSchemaName		is Alpha 50
				BirstLiveAccessPackageName		is Alpha 50
				BirstLiveAccessApplicationLID	is Alpha 300
				BirstIDpid						is Alpha 50
					default label is "IdentityProviderID"

			Parameter Rules
				BirstUserName
					initial value is DerivedBirstUserName
					required
				BirstPassword
					initial value is DerivedBirstPassword
					required					
				BirstModelSpaceID
					initial value is DerivedBirstModelSpaceID
				BirstConsumerSpaceID
					initial value is DerivedBirstConsumerSpaceID
				BirstReportPath
					initial value is DerivedBirstReportPath
				BirstDashboard
					initial value is DerivedBirstDashboard
				BirstWebServiceURL
					initial value is DerivedBirstWebServiceURL
				BirstLiveAccessConnectionID
					initial value is DerivedBirstLiveAccessConnectionID
				BirstLiveAccessSchemaName
					initial value is DerivedBirstLiveAccessSchemaName
				BirstLiveAccessPackageName
					initial value is DerivedBirstLiveAccessPackageName					
				BirstIDpid
					initial value is DerivedIDPID
				BirstLiveAccessApplicationLID
					initial value is DerivedBirstLiveAccessApplicationLID

			Entrance Rules

			
			Action Rules
				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstUsername"
					invoked.Type = 8222 
					invoked.Length = 100
					invoked.Value = BirstUserName

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstPassword"
					invoked.Type = 8399 
					invoked.Length = 50
					invoked.Value = BirstPassword

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstModelSpaceID"
					invoked.Type = 8222 
					invoked.Length = 50
					invoked.Value = LocalBirstModelSpaceID

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstConsumerSpaceID"
					invoked.Type = 8222 
					invoked.Length = 50
					invoked.Value = LocalBirstConsumerSpaceID

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstReportPath"
					invoked.Type = 8222 
					invoked.Length = 100
					invoked.Value = LocalBirstReportPath

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstDashboard"
					invoked.Type = 8222 
					invoked.Length = 100
					invoked.Value = LocalBirstBirstDashboard

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstWebServiceURL"
					invoked.Type = 8222 
					invoked.Length = 100
					invoked.Value = LocalBirstWebServiceURL

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstLiveAccessConnectionID"
					invoked.Type = 8222 
					invoked.Length = 50
					invoked.Value = LocalBirstConnectionID

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstLiveAccessSchemaName"
					invoked.Type = 8222 
					invoked.Length = 50
					invoked.Value = LocalSchemaName

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstLiveAccessPackageName"
					invoked.Type = 8222 
					invoked.Length = 50
					invoked.Value = LocalPackageName

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstIDpid"
					invoked.Type = 8222 
					invoked.Length = 50
					invoked.Value = LocalIDPID

				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID = "Analytics"
					invoked.ConfigurationParameter.Name = "BirstLiveAccessApplicationLID"
					invoked.Type = 8222 
					invoked.Length = 300
					invoked.Value = LocalBirstLiveAccessApplicationLID 

		ConfigureBirstIonApi is an Instance Action
			default label is "ConfigureBirst_I\O\N_A\P\I"
			Parameters
				PrmApplicationKey			is Alpha size 200
					default label is "ApplicationKey"
				PrmApplicationSecret		is Password
					default label is "ApplicationSecret"
				PrmResourceUser				is Alpha size 200
					default label is "ResourceUser"
				PrmResourcePassword			is Password
					default label is "ResourcePassword"
				PrmAccessTokenURL			is Alpha size 1000
					default label is "AccessTokenURL"
				PrmBirstWsiEndpoint			is Alpha size 1000
					default label is "BirstW\S\I_Endpoint"
				PrmSetValuesFromCredentials	is Boolean
					default label is "SetValuesFromCredentials"
				PrmIonApiCredentials		is Alpha size 1000
					default label is "I\O\N_A\P\I_Credentials"

			Parameter Rules			
				PrmApplicationKey
					initial value is DerivedApplicationKey
				PrmApplicationSecret
					initial value is DerivedApplicationSecret
				PrmResourceUser
					initial value is DerivedResourceUser
				PrmResourcePassword
					initial value is DerivedResourcePassword
				PrmAccessTokenURL
					initial value is DerivedAccessTokenURL
				PrmBirstWsiEndpoint
					initial value is DerivedBirstWsiEndpoint
				PrmIonApiCredentials
					if PrmSetValuesFromCredentials
						required

			Entrance Rules


			Action Rules
				invoke Import ConfigurationParameter
					invoked.ConfigurationParameter.ConfigurationID	= "Analytics"
					invoked.ConfigurationParameter.Name				= "BirstWsiEndpoint"
					invoked.Type									= 8222 
					invoked.Length									= 1000
					invoked.Value									= LocalBirstWsiEndpoint

				if (BirstClientOAuthRel exists)
					invoke Update BirstClientOAuthRel
						invoked.Type				= 5	
						invoked.ApplicationKey		= LocalApplicationKey
						invoked.ApplicationSecret	= LocalApplicationSecret
						invoked.ResourceUser		= LocalResourceUser
						invoked.ResourcePassword	= LocalResourcePassword
						invoked.AccessTokenURL		= LocalAccessTokenURL
				else
					invoke Create OAuth
						invoked.OAuth				= "BirstClient"
						invoked.Type				= 5	
						invoked.ApplicationKey		= LocalApplicationKey
						invoked.ApplicationSecret	= LocalApplicationSecret
						invoked.ResourceUser		= LocalResourceUser
						invoked.ResourcePassword	= LocalResourcePassword
						invoked.AccessTokenURL		= LocalAccessTokenURL

	Relations
		BirstWsiEndpointParamRel
			one-to-one relation to ConfigurationParameter
			Field Mapping uses symbolic key
				related.ConfigurationParameter.ConfigurationID	= "Analytics"
				related.ConfigurationParameter.Name				= "BirstWsiEndpoint"

		BirstClientOAuthRel
			one-to-one relation to OAuth
			Field Mapping uses symbolic key
				related.OAuth = "BirstClient"

		BirstModelBCIncludedRel
			one-to-many relation to BirstModelBC
			Field Mapping uses ByIncludeInModel
				related.BirstModel		= BirstModel
				related.IncludeInModel	= true

		BirstModelQuerySourceIncludedRel
			one-to-many relation to BirstModelQuerySource
			Field Mapping uses ByIncludeInModel
				related.BirstModel		= BirstModel
				related.IncludeInModel	= true

		BirstModelBCFactTableRel
			one-to-many relation to BirstModelBC
			Field Mapping uses ByIncludeInModel
				related.BirstModel		= BirstModel
				related.IncludeInModel	= true
				related.BCType			= 1	
				
		BirstModelQuerySourceFactTableRel
			one-to-many relation to BirstModelQuerySource
			Field Mapping uses ByIncludeInModel
				related.BirstModel		= BirstModel
				related.IncludeInModel	= true
				related.SourceType		= 1	

		LocalBirstSpaceRel
			one-to-one relation to BirstSpace
			Field Mapping uses symbolic key
				related.BirstSpace	= LocalBirstSpace

		AvailableBirstSpaceRel
			one-to-many relation to BirstSpace
			Field Mapping uses ByAvailableForIntegration
				related.AvailableForIntegration = true
				
		
