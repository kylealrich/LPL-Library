AssetFundControl is a BusinessClass
	owned by am
	
	prefix is AstFC
	
	Ontology
		symbolic key is AssetFundControl
		
	
	Patterns
		implements StaticJava	
	Persistent Fields
        AccountingUnit			is Boolean
	   	Project					is Boolean
		FinanceDimension1		is Boolean	
		FinanceDimension2		is Boolean	
		FinanceDimension3		is Boolean
		FinanceDimension4		is Boolean				
		FinanceDimension5		is Boolean
		FinanceDimension6		is Boolean
		FinanceDimension7		is Boolean
		FinanceDimension8		is Boolean
		FinanceDimension9		is Boolean
		FinanceDimension10		is Boolean  
		FundAccountTypes

	Local Fields
		ActiveDimensions		is Numeric 1
		
	Derived Fields 
		FundDimensionLabel is a DerivedField
			type is Alpha 50
			if (AssetFundControl.FundDimension.AccountingUnit)
				return "FundDimensionIs:<AssetFundControl.AccountingUnitLabel>"
			else 
				return "FundDimensionIs:<AssetFundControl.FinanceDimension1Label>"	

	Relations
		ThisRecordRel
			one-to-one relation to AssetFundControl
			Field Mapping uses symbolic key
				related.AssetFundControl		= actor.context.FinanceEnterpriseGroup


	Conditions
		ThisRecordExists
			when (ThisRecordRel exists)
    	AccountingUnitIsValid
    		when (actor.context.FinanceEnterpriseGroup.AccountingUnitOrder entered)
        ProjectIsValid
    		when (actor.context.FinanceEnterpriseGroup.ProjectOrder entered)
		FinanceDimension1IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension1Order entered)
		FinanceDimension2IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension2Order entered)
		FinanceDimension3IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension3Order entered)
		FinanceDimension4IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension4Order entered)
		FinanceDimension5IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension5Order entered)
		FinanceDimension6IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension6Order entered)
		FinanceDimension7IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension7Order entered)
		FinanceDimension8IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension8Order entered)
		FinanceDimension9IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension9Order entered)
		FinanceDimension10IsValid	
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension10Order entered)			
			

	Field Rules
   		AssetFundControl
   			initial value is actor.context.FinanceEnterpriseGroup
   			cannot be changed
   				"FinanceEnterpriseGroupCannotBeChanged"
 
     	AccountingUnit		
     		if (AssetFundControl.FundDimension.AccountingUnit)
     			AccountingUnit 		= true

		FinanceDimension1	
			if (AssetFundControl.FundDimension.Dimension1)
     			FinanceDimension1 	= true
	
	Rule Blocks

		CountDimensions
			initialize ActiveDimensions
			if (AccountingUnit)
				ActiveDimensions += 1
			if (Project)
				ActiveDimensions += 1
			if (FinanceDimension1)	
				ActiveDimensions += 1
			if (FinanceDimension2)	
				ActiveDimensions += 1
			if (FinanceDimension3)
				ActiveDimensions += 1
			if (FinanceDimension4)				
				ActiveDimensions += 1
			if (FinanceDimension5)
				ActiveDimensions += 1
			if (FinanceDimension6)
				ActiveDimensions += 1
			if (FinanceDimension7)
				ActiveDimensions += 1
			if (FinanceDimension8)
				ActiveDimensions += 1
			if (FinanceDimension9)
				ActiveDimensions += 1
			if (FinanceDimension10) 	
				ActiveDimensions += 1
			constraint (ActiveDimensions <= 6)
				"UpTo6DimensionsCanBeSelected"
				
	Actions
		Create is an Action
			valid when (!ThisRecordExists)

			Action Rules
				if ((AssetFundControl.FinanceEnterpriseGroup.FundDimension.AccountingUnit
				and AccountingUnit = false)
				or (AssetFundControl.FinanceEnterpriseGroup.FundDimension.Dimension1
				and FinanceDimension1 = false))
					confirmation required
						"FundDimensionWillBeSelected"
					if (AssetFundControl.FinanceEnterpriseGroup.FundDimension.AccountingUnit)
						AccountingUnit	 	= true
					else 
						FinanceDimension1 	= true

			Exit Rules
				include CountDimensions
					
		
		FinanceEnterpriseGroupCreate is a Create Action
			restricted
			Exit Rules
				include CountDimensions			
								
		Update is an Action
	
			Action Rules
		     	if (AccountingUnit changed)
		     		constraint (AccountingUnit)
		     			"DimensionsCannotBeUnselected"	
		     	if (Project changed)
		     		constraint (Project)
		     			"DimensionsCannotBeUnselected"
		     	if (FinanceDimension1 changed)
		     		constraint (FinanceDimension1)
		     			"DimensionsCannotBeUnselected"
		     	if (FinanceDimension2 changed)
		     		constraint (FinanceDimension2)
		     			"DimensionsCannotBeUnselected"
		     	if (FinanceDimension3 changed)
		     		constraint (FinanceDimension3)
		     			"DimensionsCannotBeUnselected"	
		     	if (FinanceDimension4 changed)
		     		constraint (FinanceDimension4)
		     			"DimensionsCannotBeUnselected"	
		     	if (FinanceDimension5 changed)
		     		constraint (FinanceDimension5)
		     			"DimensionsCannotBeUnselected"									
		     	if (FinanceDimension6 changed)
		     		constraint (FinanceDimension6)
		     			"DimensionsCannotBeUnselected"
		     	if (FinanceDimension7 changed)
		     		constraint (FinanceDimension7)
		     			"DimensionsCannotBeUnselected"
		     	if (FinanceDimension8 changed)
		     		constraint (FinanceDimension8)
		     			"DimensionsCannotBeUnselected"
		     	if (FinanceDimension9 changed)
		     		constraint (FinanceDimension9)
		     			"DimensionsCannotBeUnselected"
		     	if (FinanceDimension10 changed)
		     		constraint (FinanceDimension10)
		     			"DimensionsCannotBeUnselected"										

			Exit Rules
				include CountDimensions
					
		Delete is an Action
			restricted
 								
