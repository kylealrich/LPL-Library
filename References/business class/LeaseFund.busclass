LeaseFund is a BusinessClass
	owned by lm
	prefix is LeasF
	
	Ontology
		symbolic key is LeaseFund
		
	Patterns
		implements StaticJava
		implements Archivable
		
	Persistent Fields
		AccountingEntity				
		AccountingUnit					
		Project			
		FinanceDimension1
		FinanceDimension2
		FinanceDimension3
		FinanceDimension4
		FinanceDimension5
		FinanceDimension6
		FinanceDimension7
		FinanceDimension8
		FinanceDimension9
		FinanceDimension10
		PercentContribution				is Percent size 9.6
			
	Transient Fields
			
	Local Fields
		LocalAccountingEntity			is like AccountingEntity
		LocalAccountingUnit				is like AccountingUnit
		LocalTotalPercentContribution	is Percent size 9.6
	
	Derived Fields
		WholeNumberPercent is a DerivedField
			type is Numeric 3		
			return (PercentContribution * 100)

		WholeNumberTotalPercent is a DerivedField
			type is Numeric 3		
			return (LocalTotalPercentContribution * 100)			

		AssetReleased is a DerivedField
			type is Boolean
			restricted
			if (LeaseAssetsRel exists)
				for each LeaseAssetsRel
					if (each.Status.Released
					or (each.Status.PostRelease
					and Lease.Status.Impairment))
						return true
			else
				if (Lease.Status.Released
				or  Lease.Status.Closed
				or  Lease.Status.Terminated
				or  Lease.Status.Deactivated)
					return true

	Conditions
			
		AccountingUnitIsFundDimension
			restricted
			when (Company.FinanceEnterpriseGroup.FundDimension = 1)				
        AccountingUnitSelected
        	when (AssetFundControlRel.AccountingUnit)
        ProjectSelected
        	when (AssetFundControlRel.Project)      	
		FinanceDimension1Selected
        	when (AssetFundControlRel.FinanceDimension1)
		FinanceDimension2Selected
        	when (AssetFundControlRel.FinanceDimension2)
		FinanceDimension3Selected
        	when (AssetFundControlRel.FinanceDimension3)
		FinanceDimension4Selected
        	when (AssetFundControlRel.FinanceDimension4)
		FinanceDimension5Selected
        	when (AssetFundControlRel.FinanceDimension5)
		FinanceDimension6Selected
        	when (AssetFundControlRel.FinanceDimension6)
		FinanceDimension7Selected
        	when (AssetFundControlRel.FinanceDimension7)
		FinanceDimension8Selected
        	when (AssetFundControlRel.FinanceDimension8)
		FinanceDimension9Selected
        	when (AssetFundControlRel.FinanceDimension9)
		FinanceDimension10Selected
        	when (AssetFundControlRel.FinanceDimension10)

		AllowCreateOrUpdate
			restricted
			when (!AssetReleased
			or   (Lease.Status.Modify
			and   ModificationInProgressRel.ModifyFundSplit))
		
	Relations
		AssetFundControlRel
			one-to-one relation to AssetFundControl
			Field Mapping uses symbolic key
				related.AssetFundControl		= Company.FinanceEnterpriseGroup
							
		ThisInstanceRel
			one-to-one relation to LeaseFund
			Field Mapping uses ByLeaseFund				
				related.Company					= Company
				related.Lease					= Lease
				related.AccountingEntity		= AccountingEntity		
				related.AccountingUnit			= AccountingUnit
				related.Project					= Project
				related.FinanceDimension1		= FinanceDimension1
				related.FinanceDimension2		= FinanceDimension2
				related.FinanceDimension3		= FinanceDimension3				
				related.FinanceDimension4		= FinanceDimension4
				related.FinanceDimension5		= FinanceDimension5
				related.FinanceDimension6		= FinanceDimension6		
				related.FinanceDimension7		= FinanceDimension7
				related.FinanceDimension8		= FinanceDimension8
				related.FinanceDimension9		= FinanceDimension9
				related.FinanceDimension10		= FinanceDimension10
		LeaseFundsRel
			one-to-many relation to LeaseFund
			Field Mapping uses symbolic key
				related.Company				= Company
				related.Lease				= Lease 

		LeaseModificationFundRel
			one-to-many relation to LeaseModificationFund
			Field Mapping uses symbolic key
				related.Company				= Company
				related.Lease				= Lease
			Instance Selection
				where (related.LeaseFund 			= LeaseFund
				and    related.LeaseModification 	=  ModificationInProgressRel.LeaseModification)

		ModificationInProgressRel
			one-to-many relation to LeaseModification
			Field Mapping uses symbolic key
				related.Company			= Company
				related.Lease			= Lease
				related.Vendor			= Lease.Lessor	
			Instance Selection
				where (related.Status.Unreleased)

		LeaseAssetsRel
			one-to-many relation to Asset
            Field Mapping uses Set13
                related.FinanceEnterpriseGroup 	= Company.FinanceEnterpriseGroup
                related.AssetLease.LeaseCompany = Company
                related.AssetLease.Lease 		= Lease  

		OtherLeaseFundsRel
			one-to-many relation to LeaseFund
			Field Mapping uses symbolic key
				related.Company				= Company
				related.Lease				= Lease 
			Instance Selection
				where (related.LeaseFund != LeaseFund)

		LeaseExecutoryCostCodesRel is a LeaseExecutoryCostCode set								
	Sets
		ByLeaseFund
			Sort Order
				Company
				Lease
				AccountingEntity
				AccountingUnit
				Project			
				FinanceDimension1
				FinanceDimension2
				FinanceDimension3
				FinanceDimension4
				FinanceDimension5
				FinanceDimension6
				FinanceDimension7
				FinanceDimension8
				FinanceDimension9
				FinanceDimension10
							
	Field Rules
		PercentContribution
			required
				"PercentContributionIsRequired"

	Rule Blocks

	Actions
		Create is an Action
			valid when (AllowCreateOrUpdate)

			Field Rules
										
			Action Rules
				constraint (Lease.LeaseAllocationCode not entered)
					"LeaseCannotHaveBothLeaseFundsAndLeaseAllocationCode"
				constraint (Lease.OperatingLeaseAllocationCode not entered)
					"LeaseCannotHaveBothLeaseFundsAndOperatingLeaseAllocationCode"
				if (LeaseExecutoryCostCodesRel exists)  
					for each LeaseExecutoryCostCodesRel
						if (each.HasReleasedLeaseAllocationCode)
							invoke Update each
								invoked.LeaseAllocationCode	= blank
			Exit Rules
				LocalTotalPercentContribution = sum LeaseFundsRel.PercentContribution
				if (WholeNumberTotalPercent > "100")
					constraint (false)
						"TheTotalPercentageForAllLeaseFundsCannotExceed100Percent"

		RestrictedCreate is a Create Action
			restricted
			bypass field rules

		RestrictedUpdate is an Update Action
			restricted

		Update is an Action
			valid when (AllowCreateOrUpdate)
			Field Rules







































												
			Action Rules
				constraint (Lease.LeaseAllocationCode not entered)
					"LeaseCannotHaveBothLeaseFundsAndLeaseAllocationCode"
				constraint (Lease.OperatingLeaseAllocationCode not entered)
					"LeaseCannotHaveBothLeaseFundsAndOperatingLeaseAllocationCode"
				if (LeaseExecutoryCostCodesRel exists)  
					for each LeaseExecutoryCostCodesRel
						if (each.HasReleasedLeaseAllocationCode)
							invoke Update each
								invoked.LeaseAllocationCode	= blank		
			Exit Rules
				LocalTotalPercentContribution = sum LeaseFundsRel.PercentContribution
				if (WholeNumberTotalPercent > "100")
					constraint (false)
						"TheTotalPercentageForAllLeaseFundsCannotExceed100Percent"		
																
		RefreshFund is an Instance Action
			restricted
			Action Rules

		ResetModification is an Instance Action
			restricted
			Action Rules
				if (LeaseModificationFundRel exists)
					invoke RestrictedUpdate
						fill in fields from this instance
						invoked.Company					= Company
						invoked.Lease					= Lease
						invoked.LeaseFund				= LeaseFund
						invoked.AccountingEntity		= AccountingEntity
						invoked.AccountingUnit			= AccountingUnit
						invoked.Project					= Project									
						invoked.FinanceDimension1		= FinanceDimension1
						invoked.FinanceDimension2		= FinanceDimension2
						invoked.FinanceDimension3		= FinanceDimension3
						invoked.FinanceDimension4		= FinanceDimension4
						invoked.FinanceDimension5		= FinanceDimension5
						invoked.FinanceDimension6		= FinanceDimension6
						invoked.FinanceDimension7		= FinanceDimension7
						invoked.FinanceDimension8		= FinanceDimension8
						invoked.FinanceDimension9		= FinanceDimension9
						invoked.FinanceDimension10		= FinanceDimension10			
						invoked.PercentContribution		= LeaseModificationFundRel.PercentContribution
					invoke DeleteFromAsset LeaseModificationFundRel
				else
					invoke Delete

		Delete is an Action
			valid when (AllowCreateOrUpdate)
			Entrance Rules
			Exit Rules
			
		DeleteFromAsset is a Delete Action
			restricted

		Purge is a Purge Action
			restricted
