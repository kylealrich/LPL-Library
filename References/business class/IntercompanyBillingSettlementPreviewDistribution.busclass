IntercompanyBillingSettlementPreviewDistribution is a BusinessClass
	owned by intercobilling
	prefix is ICBSP
	sql name is "ICBSettlementPreview"
	
	Ontology
		symbolic key is IntercompanyBillingSettlementPreviewDistribution
		
	
	Patterns
	
	Persistent Fields
		CurrencyTable
		AccountingEntity
		CurrencyCode				is a FromCurrency
			default label is "TransactionCurrency"
		TransactionAmount			is a CurrencyAmount
		IntercompanyBillingGroup
		IntercompanyBillingSettlementHeader
		BillingDocument				is Numeric 12
		InvoiceNumber				is an Invoice
		Description
		FinanceCodeBlock			is a TransactionCodeBlock
			default label is "FinanceStructure"
		TransactionDate				is an ExchangeDate
		PostingDate
			default label is "PostDate"
		ReportCurrencyAmount		is a FinanceCurrencyAmount
		ICBDistributionType			is Numeric 1
			default label is "DistributionType"
			States
				Payable				value is 0
				Receivable			value is 1
				Withholding			value is 2
				PayableBankFee		value is 3
				ReceivableBankFee	value is 4
		PayablesDistributionType	is AlphaUpper size 1
			default label is "PayableDistributionType"
			States
				Payment 				value is "P"
				PaymentAccrual 			value is "Y"
				GainLossDistribution	value is "G"
		Origin						is a DstType
		RechargeItem				is an IntercompanyBillingRechargeItem
		CashLedgerDistribRecordType
			default label is "RecordType"
		
	Local Fields
		LocalRunCalculations 		is Boolean
	
	Transient Fields
		BypassNegativeRateEdit
	
	Derived Fields
		DerivedFunctionalAmount	is a DerivedField
			type is like InternationalAmount
				precision is FinanceCodeBlock.ToAccountingEntity.FunctionalCurrency.NumberOfDecimals
			default label is "FunctionalAmount"
			if (AccountingEntity = FinanceCodeBlock.ToAccountingEntity)
        		return ReportCurrencyAmount.FunctionalAmount.EnteredCurrencyAmount
		    else
        		return ReportCurrencyAmount.ToFunctionalAmount.EnteredCurrencyAmount
    		
      	DerivedFunctionalCurrency is a DerivedField
      		type is like Currency
      		default label is "FunctionalCurrency"
      		if (ReportCurrencyAmount.FunctionalAmount.ToCurrency not entered
      		and ReportCurrencyAmount.ToFunctionalAmount.ToCurrency not entered)
      			LocalRunCalculations = ReportCurrencyAmount.AssignToCurrency
	      		
	  		if (AccountingEntity = FinanceCodeBlock.ToAccountingEntity)
	    		return ReportCurrencyAmount.FunctionalAmount.ToCurrency
		    else
	    		return ReportCurrencyAmount.ToFunctionalAmount.ToCurrency
	        		
	  	DerivedAlternateAmount is a DerivedField
	  		type is like InternationalAmount
	  			precision is FinanceCodeBlock.ToAccountingEntity.AlternateCurrency.NumberOfDecimals
	  		default label is "AlternateAmount"
	  		if (AccountingEntity = FinanceCodeBlock.ToAccountingEntity)
	  			return ReportCurrencyAmount.AlternateAmount.EnteredCurrencyAmount
	  		else
	  			return ReportCurrencyAmount.ToAlternateAmount.EnteredCurrencyAmount
	  			
	  	DerivedAlternateCurrency is a DerivedField
	  		type is like Currency
	  		default label is "AlternateCurrency"
	  		if (ReportCurrencyAmount.AlternateAmount.ToCurrency not entered
      		and ReportCurrencyAmount.ToAlternateAmount.ToCurrency not entered)
      			LocalRunCalculations = ReportCurrencyAmount.AssignToCurrency
  			
  			if (AccountingEntity = FinanceCodeBlock.ToAccountingEntity)
	    		return ReportCurrencyAmount.AlternateAmount.ToCurrency
		    else
	    		return ReportCurrencyAmount.ToAlternateAmount.ToCurrency
	    		
	    DerivedAlternateAmount2 is a DerivedField
	  		type is like InternationalAmount
	  			precision is FinanceCodeBlock.ToAccountingEntity.AlternateCurrency2.NumberOfDecimals
	  		default label is "AlternateAmount2"
	  		if (AccountingEntity = FinanceCodeBlock.ToAccountingEntity)
	  			return ReportCurrencyAmount.AlternateAmount2.EnteredCurrencyAmount
	  		else
	  			return ReportCurrencyAmount.ToAlternateAmount2.EnteredCurrencyAmount
	  			
	  	DerivedAlternateCurrency2 is a DerivedField
	  		type is like Currency
	  		default label is "AlternateCurrency2"
	  		if (ReportCurrencyAmount.AlternateAmount2.ToCurrency not entered
      		and ReportCurrencyAmount.ToAlternateAmount2.ToCurrency not entered)
      			LocalRunCalculations = ReportCurrencyAmount.AssignToCurrency
  			
  			if (AccountingEntity = FinanceCodeBlock.ToAccountingEntity)
	    		return ReportCurrencyAmount.AlternateAmount2.ToCurrency
		    else
	    		return ReportCurrencyAmount.ToAlternateAmount2.ToCurrency
        		
        DerivedAlternateAmount3 is a DerivedField
	  		type is like InternationalAmount
	  			precision is FinanceCodeBlock.ToAccountingEntity.AlternateCurrency3.NumberOfDecimals
	  		default label is "AlternateAmount3"
	  		if (AccountingEntity = FinanceCodeBlock.ToAccountingEntity)
	  			return ReportCurrencyAmount.AlternateAmount3.EnteredCurrencyAmount
	  		else
	  			return ReportCurrencyAmount.ToAlternateAmount3.EnteredCurrencyAmount
	  			
	  	DerivedAlternateCurrency3 is a DerivedField
	  		type is like Currency
	  		default label is "AlternateCurrency3"
	  		if (ReportCurrencyAmount.AlternateAmount3.ToCurrency not entered
      		and ReportCurrencyAmount.ToAlternateAmount3.ToCurrency not entered)
      			LocalRunCalculations = ReportCurrencyAmount.AssignToCurrency
  			
  			if (AccountingEntity = FinanceCodeBlock.ToAccountingEntity)
	    		return ReportCurrencyAmount.AlternateAmount3.ToCurrency
		    else
	    		return ReportCurrencyAmount.ToAlternateAmount3.ToCurrency
        		
	Sets
		ByIntercompanyBillingSettlementHeader
			duplicates
			Sort Order
				IntercompanyBillingGroup
				IntercompanyBillingSettlementHeader
				
	Actions
		Create is a Create Action
			restricted
			Action Rules
				if (ReportCurrencyAmount.FunctionalAmount.EnteredCurrencyRate entered)
					BypassNegativeRateEdit						 	= true
					ReportCurrencyAmount.UseDerivedCalculations 	= false
					ReportCurrencyAmount.KeepRateOnly				= true
				else	
					BypassNegativeRateEdit						 	= true
					ReportCurrencyAmount.UseDerivedCalculations 	= true
					LocalRunCalculations 							= ReportCurrencyAmount.DerivedCalculationsComplete
				
		CreateBypassFieldRules is a Create Action
			restricted
			bypass field rules
			Action Rules
				BypassNegativeRateEdit	= true
				default FinanceCodeBlock.Ledger to IntercompanyBillingGroup.FinanceEnterpriseGroup.CoreLedger
		
		Delete is a Delete Action
			restricted
			
		AdjustRoundedAmount is an Instance Action
			restricted
			default label is untranslatable
			Parameters
				PrmTransactionAmount is like CurrencyAmount
				PrmAmountsAdjustment is like FinanceCurrencyAmount
			Action Rules
				if (TransactionAmount entered)
					TransactionAmount											-= PrmTransactionAmount
				if (ReportCurrencyAmount.FunctionalAmount.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.FunctionalAmount.EnteredCurrencyAmount	-= PrmAmountsAdjustment.FunctionalAmount.EnteredCurrencyAmount
				if (ReportCurrencyAmount.AlternateAmount.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.AlternateAmount.EnteredCurrencyAmount	-= PrmAmountsAdjustment.AlternateAmount.EnteredCurrencyAmount
				if (ReportCurrencyAmount.AlternateAmount2.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.AlternateAmount2.EnteredCurrencyAmount	-= PrmAmountsAdjustment.AlternateAmount2.EnteredCurrencyAmount
				if (ReportCurrencyAmount.AlternateAmount3.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.AlternateAmount3.EnteredCurrencyAmount	-= PrmAmountsAdjustment.AlternateAmount3.EnteredCurrencyAmount
				if (ReportCurrencyAmount.ReportAmount1.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.ReportAmount1.EnteredCurrencyAmount	-= PrmAmountsAdjustment.ReportAmount1.EnteredCurrencyAmount
				if (ReportCurrencyAmount.ReportAmount2.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.ReportAmount2.EnteredCurrencyAmount	-= PrmAmountsAdjustment.ReportAmount2.EnteredCurrencyAmount
				if (ReportCurrencyAmount.ReportAmount3.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.ReportAmount3.EnteredCurrencyAmount	-= PrmAmountsAdjustment.ReportAmount3.EnteredCurrencyAmount
				if (ReportCurrencyAmount.ReportAmount4.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.ReportAmount4.EnteredCurrencyAmount	-= PrmAmountsAdjustment.ReportAmount4.EnteredCurrencyAmount
				if (ReportCurrencyAmount.ReportAmount5.EnteredCurrencyAmount entered)
					ReportCurrencyAmount.ReportAmount5.EnteredCurrencyAmount	-= PrmAmountsAdjustment.ReportAmount5.EnteredCurrencyAmount
