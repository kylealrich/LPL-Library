ProjectInvoiceTransaction is a BusinessClass
    owned by Projects
    prefix is PSINT

    Ontology
    	part of ProjectContractRunGroup
    		relative key is Counter is Numeric size 8
    		
	Patterns
		disable Auditing
		disable AuditIndex
		disable EffectiveDated
		disable AsOfDateProcessing
		
    Persistent Fields
    	InvoiceTransaction

	Local Fields

	Rule Blocks
		
	Derived Fields
			
    Conditions
    	BaseIsPositive
    		restricted
    		when (BaseTransactionRel.InvoiceTransaction.Positive)

    Relations
    	BaseTransactionRel
    		one-to-one relation to ProjectInvoiceTransaction
    		Field Mapping uses part of key
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.ProjectContract			= ProjectContract
				related.ProjectContractRunGroup = ProjectContractRunGroup
				related.Counter					= InvoiceTransaction.BaseCounter
		ProjectContractInvoiceRel
			one-to-many relation to ProjectContractInvoice
    		Field Mapping uses ByRunGroup
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.ProjectContract			= ProjectContract
				related.RunGroup				= ProjectContractRunGroup

    Sets
    	ByTransactionDate
			Sort Order
				FinanceEnterpriseGroup
				ProjectContract
				ProjectContractRunGroup
				InvoiceTransaction.Positive
				InvoiceTransaction.TransactionDate
				Counter
				
    Field Rules
			
	Actions
		Create is a Create Action
			restricted
			bypass field rules
		Update is an Update Action
			restricted


		Purge is a Purge Action
			restricted

		PurgeAll is a Set Action
			restricted
			Parameters
				PrmFinanceEnterpriseGroup	is a FinanceEnterpriseGroup
				PrmProjectContract			is a ProjectContract
				PrmProjectContractRunGroup	is like ProjectContractRunGroup
				Forecast					is Boolean
			Instance Selection
				where (FinanceEnterpriseGroup	= PrmFinanceEnterpriseGroup
				and    ProjectContract			= PrmProjectContract
				and    ProjectContractRunGroup	= PrmProjectContractRunGroup)
			Sort Order is primary
			Action Rules
				ProjectContractRunGroup Set Rules
					Exit Rules
						if (Forecast
						and ProjectContractInvoiceRel not exists)
							invoke Delete ProjectContractRunGroup
				Instance Rules
					invoke Purge

				
				
