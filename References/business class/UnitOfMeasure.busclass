UnitOfMeasure is a BusinessClass
    owned by ic
    prefix is ICV
    classic name is ICVALUOM

    Ontology
        symbolic key is UnitOfMeasure
            classic set name is ICVSET1
            classic name is VALID-UOM

    Patterns
        implements StaticJava
        disable AuditIndex
		implements BODId
    Persistent Fields

        Description
        Active
        
	Local Fields
		ActionCode
		LocalBODCurrentTimeStamp		is a BODCurrentTimeStamp
		LocalNativeLPLBODTrigger		is Boolean				
		LocalBodAccountingEntity		is AlphaUpper size 12
		LocalCrossAccountingEntity 		is Alpha 40
		LocalCleanDocIDAccountingentity 	is Alpha 40
		UnitOfMeasureCleanDocXMLBOD		is XMLDocument
		NewBODTracker  				is a FSMInboundBODTracker view
		LocalFSMInboundBODTracker	is Numeric 15
		Error            			is Boolean
	    ErrorMessage     			is Alpha 300
	    LocalBODTrigger				is Boolean
	    LocalConfigurationParameter	is Alpha size up to 200
		LocalSourceValue			is Alpha 30
		LocalBODFormattedID         is Alpha 100
	    
	Derived Fields
		UnitOfMeasureAndDescription is a MessageField
			default label is "UnitOfMeasure"
			"<UnitOfMeasure>_-_<Description>"


		DerivedDelimiter is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "Generic_Delimiter"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "tenantID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "releaseID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "logicalID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "VersionID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedappProdline is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "appProdline"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		BODVariationID is a DerivedField
			type is Alpha 25
			restricted
			return bod id.VariationID
			
		DerivedMultipleFEG is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IsMultipleFEG"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedCleanDocumentID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "RequiredCleanDocumentID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedTriggerBODBasedOnCrossReference is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "TriggerBODBasedOnCrossReference"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
			
		DerivedBODCurrentTimeStamp is a DerivedField
			type is Alpha size 20
			restricted
			DerivedBODCurrentTimeStamp = system current timestamp
			return DerivedBODCurrentTimeStamp
			
		DerivedBODFormattedCurrentTimeStamp is a DerivedField
			type is Alpha size 30
			restricted
			return DerivedBODCurrentTimeStamp[1:4] + "-" + DerivedBODCurrentTimeStamp[5:6] + "-" + DerivedBODCurrentTimeStamp[7:8] + "T" + DerivedBODCurrentTimeStamp[9:10] + ":" + DerivedBODCurrentTimeStamp[11:12] + ":" + DerivedBODCurrentTimeStamp[13:14] + "Z"
		
		DerivedBODActionCode is a DerivedField
			type is Alpha 10
			restricted
			if (action type.Create or ActionCode.Create)
				return "Add"
			else
			if(action type.Update or action type.Delete)
				return "Replace"
			else
				return ""
				
		DerivedBODStatusCode is a DerivedField
			type is Alpha 10
			restricted
			if(ActionCode.Delete or action type.Delete)
				return "Deleted"
			else
			if (ActionCode.Create or action type.Create or ActionCode.Update or action type.Update)
				return "Open"
				
		DerivedBODRevision is a DerivedField
			type is Alpha 25
			restricted
			return ""
					
		DerivedBODFormattedId is a DerivedField
			type is Alpha 100
			restricted
			return "infor-nid:" + DerivedTenantID + ":" + ":"  + ":" + UnitOfMeasure+ ":" + DerivedBODRevision +"?CodeDefinition&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
		
		DerivedLastupdateBy is a DerivedField
			type is Alpha size 60
			restricted
			return update stamp.actor
		
		DerivedFinanceEnterpriseGroup is a DerivedField
			type is Alpha size 4
			restricted
			return ItemGroup.BusinessGroup.FinanceEnterpriseGroup	
		
		DerivedBODUpdateTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			DerivedBODUpdateTimeStamp = update stamp.timestamp
			return DerivedBODUpdateTimeStamp
			
		DerivedBODFormattedUpdateTimeStamp is a DerivedField
			type is Alpha size 30
			restricted
			return DerivedBODUpdateTimeStamp[1:4] + "-" + DerivedBODUpdateTimeStamp[5:6] + "-" + DerivedBODUpdateTimeStamp[7:8] + "T" + DerivedBODUpdateTimeStamp[9:10] + ":" + DerivedBODUpdateTimeStamp[11:12] + ":" + DerivedBODUpdateTimeStamp[13:14] + "Z"
			 
		DerivedAccountingEntity	is a DerivedField
			type is Alpha size 100
			restricted
			return 	DerivedFinanceEnterpriseGroup + DerivedDelimiter +ItemGroup
			
		UnitOfMeasureXMLBOD is a DerivedField
			type is XMLDocument
	        restricted
	        UnitOfMeasureXMLBOD = template.IONSyncCodeDefination_UnitOfMeasure_ST document for this instance

	Context Fields
		Item
		ItemType
		FSMInboundBODTracker
		
	Field Rules
		Description
			required
		Active
			initial value is true

	Attach Rules
		if (not BypassRuleForTheseFiles)
			constraint (Active)
				"UnitOfMeasure<UnitOfMeasure>MustBeActive"

    Conditions

		ValidTrackedUnitOfMeasure
    		when (Item exists
    		and   ValidTrackedUOMRel exists)

    	ValidBuyUnitOfMeasure
    		when ((Item exists
    		and   ValidBuyUOMRel exists)
    		or    Item not exists)
    		
    	ValidTransactionUnitOfMeasure
    		when ((Item exists
    		and   ValidTransactionUOMRel exists)
    		or    Item not exists)
    	
    	ValidSellUnitOfMeasure
    		when ((Item exists
    		and   ValidSellUOMRel exists)
    		or    Item not exists)
    	
    	ValidSellPriceUnitOfMeasure
    		when ((Item exists
    		and   ValidSellPriceUOMRel exists)
    		or    Item not exists)
    	
    	ValidRequisitionUnitOfMeasure
    		when ((Item exists
    		and    ItemType.Inventoried
    		and    ValidTransactionUOMRel exists)
    		or    (Item exists
    		and    ItemType.NonStock
    		and    ValidBuyUOMRel exists)
    		or    (Item exists
    		and    ItemType not entered
    		and   (ValidTransactionUOMRel exists
    		or     ValidBuyUOMRel exists))
    		or     Item not exists)
    	
    	ItemExists
    		when (Item exists)
		
		BypassRuleForTheseFiles
			restricted
	   		when (parentcontext.name = "POReceiptLineTemplate"
			or 	  parentcontext.name = "PurchaseOrderReceiptLine"
			or    parentcontext.name = "PayablesInvoiceDetail"
			or    parentcontext.name = "PurchaseOrderEDIOutput")
    
    Relations
    
    	ValidBuyUOMRel
    		one-to-many relation to ItemUOM
    		Field Mapping uses symbolic key
    			related.ItemGroup        = ItemGroup
    			related.Item             = Item
    			related.UnitOfMeasure    = UnitOfMeasure
    		Instance Selection
    			where (related.OKForBuying)
    			
    	ValidTransactionUOMRel
    		one-to-many relation to ItemUOM
    		Field Mapping uses symbolic key
    			related.ItemGroup        = ItemGroup
    			related.Item             = Item
    			related.UnitOfMeasure    = UnitOfMeasure
    		Instance Selection
    			where (related.OKForTransaction)
    			
    	ValidRequisitionUOMRel
    		one-to-many relation to ItemUOM
    		Field Mapping uses symbolic key
    			related.ItemGroup        = ItemGroup
    			related.Item             = Item
    			related.UnitOfMeasure    = UnitOfMeasure
    		Instance Selection
    			where (related.OKForTransaction
    			or     related.OKForBuying)
    	
    	ValidSellUOMRel
    		one-to-many relation to ItemUOM
    		Field Mapping uses symbolic key
    			related.ItemGroup        = ItemGroup
    			related.Item             = Item
    			related.UnitOfMeasure    = UnitOfMeasure
    		Instance Selection
    			where (related.OKForSelling)
    			
    	ValidSellPriceUOMRel
    		one-to-many relation to ItemUOM
    		Field Mapping uses symbolic key
    			related.ItemGroup        = ItemGroup
    			related.Item             = Item
    			related.UnitOfMeasure    = UnitOfMeasure
    		Instance Selection
    			where (related.OKForSellPrice)

    	ValidTrackedUOMRel
    		one-to-many relation to ItemUOM
    		Field Mapping uses symbolic key
    			related.ItemGroup        = ItemGroup
    			related.Item             = Item
    			related.UnitOfMeasure    = UnitOfMeasure
    		Instance Selection
    			where (related.TrackedIn)


		FSMBODConfigurationParameterRel
        	one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
            	related.FSMBODConfigurationParameter 		= LocalConfigurationParameter
		
		FSMBODConfigurationRel
        	one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
            	related.FSMBODConfiguration.Verb 		= 1
            	related.FSMBODConfiguration.Noun 		= "CodeDefinition"
            	related.FSMBODConfiguration.Direction 	= 1
				
		FSMBODAECrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "CSFGLC"
            	related.FSMBODCrossReference.DestinationField 	= "DESTAE"
            Instance Selection
				where (related.SourceValue	= LocalCleanDocIDAccountingentity )
		
		FSMCleanDocIDAccountingEntityRel
			one-to-one relation to AccountingEntity
			Field Mapping uses symbolic key
    			related.FinanceEnterpriseGroup 	= ItemGroup.BusinessGroup.FinanceEnterpriseGroup
    			related.AccountingEntity		= LocalCleanDocIDAccountingentity
		
		FSMCleanDocIDCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "CSFGLC"
            	related.FSMBODCrossReference.DestinationField 	= "DESTAE"

		BODAccountingEntityRel
			one-to-many relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
			Instance Selection
				where (related.BusinessGroup = ItemGroup)
				
		FSMInboundBODTrackerRel
            one-to-one relation to FSMInboundBODTracker
            Field Mapping uses symbolic key
                related.FSMInboundBODTracker	= LocalFSMInboundBODTracker

    Rule Blocks					
    	TriggerUnitOfMeasureServiceRules
    		trigger "UnitOfMeasureService" PA service
				resume on error
				title is "EG:<ItemGroup.BusinessGroup.FinanceEnterpriseGroup>UOM:<UnitOfMeasure>"
				Criteria
					ItemGroup.BusinessGroup.FinanceEnterpriseGroup
					Item.ItemGroup
				Variables
					ActionCode
					ItemGroup.BusinessGroup.FinanceEnterpriseGroup
						variable name is FinanceEnterpriseGroup
					include persistent fields from UnitOfMeasure
					ItemGroup
						variable name is ItemGroup
					LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
						variable name is CurrentTimeStamp
    			
    Actions
        Create is a Create Action
			Field Rules
				UnitOfMeasure
					constraint (UnitOfMeasure != "****")
						"NotValid_\U\O\M;ReservedFor_\Order_\EntrySystem"        
								
        UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmRevision          is Alpha size 22
					default label is "Revision"
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"
			Action Rules
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.Revision != PrmRevision)
					bod id.Revision				= PrmRevision
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord
		Update is an Update Action

        Delete is a Delete Action
        	Entrance Rules
        		if (ItemGroup.BusinessGroup.FinanceEnterpriseGroup.BODTrigger)
					ActionCode	= ActionCode.Delete
					increment bod id.VariationID
					include TriggerUnitOfMeasureServiceRules

									
		BODDataInitialLoadCodeDefUOMCriteria is a Set Action
			restricted
			Parameters
				PrmFEG					is a FinanceEnterpriseGroup
				PrmFromItemGroup		is a ItemGroup
				PrmFromUOM				is a UnitOfMeasure
				PrmToUOM				is a UnitOfMeasure
					
			
			Parameter Rules
			
			Instance Selection
				where  (((PrmFEG entered
				and		  PrmFEG = ItemGroup.BusinessGroup.FinanceEnterpriseGroup)
				or		  PrmFEG not entered)	
				and		((PrmFromItemGroup entered
				and		  PrmFromItemGroup = ItemGroup)
				or		  PrmFromItemGroup not entered)				
				and    ((PrmFromUOM entered
				and		 PrmFromUOM <= UnitOfMeasure)
				or		 PrmFromUOM not entered)
				and    ((PrmToUOM entered
				and		 PrmToUOM >= UnitOfMeasure)
				or		 PrmToUOM not entered)				
				and		(Active = true))
					
			Sort Order
			
			Action Rules	
						
				Instance Rules	
					if (ItemGroup.BusinessGroup.FinanceEnterpriseGroup.BODTrigger)
						increment bod id.VariationID
						ActionCode	= ActionCode.Create
						include TriggerUnitOfMeasureServiceRules

								
		SendUnitOfMeasureBODNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				if(DerivedCleanDocumentID = "Y")
					send ion bod
						bod is UnitOfMeasureCleanDocXMLBOD
						bod type is "Sync.CodeDefinition"
						accounting entity is LocalCrossAccountingEntity
						document id is UnitOfMeasure
						variation id is	BODVariationID
				else
					send ion bod
						bod is UnitOfMeasureXMLBOD
						bod type is "Sync.CodeDefinition"
						accounting entity is DerivedAccountingEntity
						document id is UnitOfMeasure
						variation id is	BODVariationID				
					
		TriggerUnitOfMeasureNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
				RestartFlag is Boolean
			Action Rules
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "CodeDefinition"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "UnitOfMeasure"
					invoked.PrmFinanceEnterpriseGroup	= ItemGroup.BusinessGroup.FinanceEnterpriseGroup
					invoked.PrmBusinessGroup			= ItemGroup
					invoked.PrmMainUserTemplate			= "IONSyncCodeDefination_UnitOfMeasure_ST"
				LocalNativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger
				LocalBODTrigger = true
				if(ItemGroup.BusinessGroup.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
					if(DerivedCleanDocumentID = "Y")
						if(RestartFlag)
							if (BODAccountingEntityRel exist)
								LocalBodAccountingEntity = FSMInboundBODTracker.Reference3	
								if(DerivedMultipleFEG = "Y")
									LocalCleanDocIDAccountingentity = DerivedFinanceEnterpriseGroup + DerivedDelimiter + LocalBodAccountingEntity
								else
									LocalCleanDocIDAccountingentity = LocalBodAccountingEntity
								initialize LocalCrossAccountingEntity
								if(DerivedTriggerBODBasedOnCrossReference = "Y")
									if (FSMBODAECrossReferenceDetailRel.DestinationValue entered)	
										LocalCrossAccountingEntity = FSMBODAECrossReferenceDetailRel.DestinationValue
								else 
									LocalCrossAccountingEntity = LocalCleanDocIDAccountingentity
								UnitOfMeasureCleanDocXMLBOD = template.IONSyncCodeDefination_UnitOfMeasure_CleanDoc_ST document for this instance
								if(LocalCrossAccountingEntity entered)
									LocalFSMInboundBODTracker		= FSMInboundBODTracker
									invoke Update FSMInboundBODTrackerRel
										invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
										invoked.BODDocumentID			= UnitOfMeasure
										invoked.BODVariationID			= BODVariationID
										invoked.BODID					= DerivedBODFormattedId
										invoked.Status					= 1
										invoked.StartDate				= system current timestamp
										invoked.Direction				= 1
										invoked.Reference1				= ItemGroup
										invoked.BODAccountingEntity		= LocalCrossAccountingEntity
										invoked.Reference2				= "UnitOfMeasure"
										invoked.Reference3				= LocalBodAccountingEntity
										initialize invoked.Error			
										initialize invoked.ErrorMessage
									invoke SendUnitOfMeasureBODNativeLPL
										resume on error
					                   		Error            							= true
					                        ErrorMessage     							= error message
					                if(Error)
										invoke Update FSMInboundBODTrackerRel
											invoked.Error 								= Error
											invoked.ErrorMessage 						= ErrorMessage
											invoked.Status								= 2
											invoked.CloseDate							= system current timestamp
											invoked.BODXML								= UnitOfMeasureCleanDocXMLBOD
									else
										invoke Update FSMInboundBODTrackerRel
											invoked.Status									= 3
											invoked.CloseDate								= system current timestamp
											invoked.BODXML									= UnitOfMeasureCleanDocXMLBOD
						else
						if(DerivedTriggerBODBasedOnCrossReference = "Y")
							if(FSMCleanDocIDCrossReferenceDetailRel exists)
								for each FSMCleanDocIDCrossReferenceDetailRel
									initialize UnitOfMeasureCleanDocXMLBOD
									initialize LocalSourceValue
									LocalSourceValue = each.SourceValue
									if (LocalSourceValue entered)
										for each LocalSourceValue split on "<DerivedDelimiter>"
											initialize LocalCleanDocIDAccountingentity
											LocalCleanDocIDAccountingentity = each
									initialize LocalCrossAccountingEntity
									LocalBODFormattedID = DerivedBODFormattedId
									initialize LocalBODFormattedID 
									if(FSMCleanDocIDAccountingEntityRel exists)
										LocalCrossAccountingEntity = each.DestinationValue
										if(LocalCrossAccountingEntity entered)
											if(FSMInboundBODTracker not entered)
												invoke Create FSMInboundBODTracker
													assign result to NewBODTracker
													invoked.Verb 					= 1
													invoked.Noun 					= "CodeDefinition"					
													invoked.BODDocumentID			= UnitOfMeasure
													invoked.BODVariationID			= BODVariationID
													invoked.Status					= 1
													invoked.StartDate				= system current timestamp
													invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
													invoked.Direction				= 1
													invoked.Reference1				= ItemGroup
													invoked.BODAccountingEntity		= LocalCrossAccountingEntity
													invoked.Reference2				= "UnitOfMeasure"
													invoked.Reference3				= LocalBodAccountingEntity
													initialize invoked.Error			
													initialize invoked.ErrorMessage					
												LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
												UnitOfMeasureCleanDocXMLBOD = template.IONSyncCodeDefination_UnitOfMeasure_CleanDoc_ST document for this instance
										invoke SendUnitOfMeasureBODNativeLPL
											resume on error
						                   		Error            							= true
						                        ErrorMessage     							= error message
						                if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage
												invoked.Status								= 2
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= DerivedBODFormattedId
												invoked.BODXML								= UnitOfMeasureCleanDocXMLBOD
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status									= 3
												invoked.CloseDate								= system current timestamp
												invoked.BODID									= DerivedBODFormattedId
												invoked.BODXML									= UnitOfMeasureCleanDocXMLBOD

						else
						if(DerivedTriggerBODBasedOnCrossReference = "N")
							if (BODAccountingEntityRel exist)
								for each BODAccountingEntityRel
									initialize LocalBodAccountingEntity
									initialize LocalCrossAccountingEntity
									initialize UnitOfMeasureCleanDocXMLBOD
									LocalBODFormattedID = DerivedBODFormattedId
									initialize LocalBODFormattedID
									LocalBodAccountingEntity = each.AccountingEntity
									if(DerivedMultipleFEG = "Y")
										LocalCrossAccountingEntity = DerivedFinanceEnterpriseGroup + DerivedDelimiter + LocalBodAccountingEntity
									else
										LocalCrossAccountingEntity = LocalBodAccountingEntity
							
									UnitOfMeasureCleanDocXMLBOD = template.IONSyncCodeDefination_UnitOfMeasure_CleanDoc_ST document for this instance
									if(LocalCrossAccountingEntity entered)
										if(FSMInboundBODTracker not entered)
											invoke Create FSMInboundBODTracker
												assign result to NewBODTracker
												invoked.Verb 					= 1
												invoked.Noun 					= "CodeDefinition"					
												invoked.BODDocumentID			= UnitOfMeasure
												invoked.BODVariationID			= BODVariationID
												invoked.Status					= 1
												invoked.StartDate				= system current timestamp
												invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
												invoked.Direction				= 1
												invoked.Reference1				= ItemGroup
												invoked.BODAccountingEntity		= LocalCrossAccountingEntity
												invoked.Reference2				= "UnitOfMeasure"
												invoked.Reference3				= LocalBodAccountingEntity
												initialize invoked.Error			
												initialize invoked.ErrorMessage					
											LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
										invoke SendUnitOfMeasureBODNativeLPL
											resume on error
						                   		Error            							= true
						                        ErrorMessage     							= error message
						                if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage
												invoked.Status								= 2
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= DerivedBODFormattedId
												invoked.BODXML								= UnitOfMeasureCleanDocXMLBOD
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status									= 3
												invoked.CloseDate								= system current timestamp
												invoked.BODID									= DerivedBODFormattedId
												invoked.BODXML									= UnitOfMeasureCleanDocXMLBOD
					else
						if(FSMInboundBODTracker not entered)
							invoke Create FSMInboundBODTracker
								assign result to NewBODTracker
								invoked.Verb 					= 1
								invoked.Noun 					= "CodeDefinition"					
								invoked.BODDocumentID			= UnitOfMeasure
								invoked.BODVariationID			= BODVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.Direction				= 1
								invoked.Reference1				= ItemGroup
								invoked.BODAccountingEntity		= DerivedAccountingEntity
								invoked.Reference2				= "UnitOfMeasure"
								initialize invoked.Error			
								initialize invoked.ErrorMessage					
							LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
						else 
							LocalFSMInboundBODTracker		= FSMInboundBODTracker
							invoke Update FSMInboundBODTrackerRel
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.BODDocumentID			= UnitOfMeasure
								invoked.BODVariationID			= BODVariationID
								invoked.BODID					= DerivedBODFormattedId
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.Direction				= 1
								invoked.Reference1				= ItemGroup
								invoked.BODAccountingEntity		= DerivedAccountingEntity
								invoked.Reference2				= "UnitOfMeasure"
								initialize invoked.Error			
								initialize invoked.ErrorMessage
						invoke SendUnitOfMeasureBODNativeLPL
							resume on error
		                   		Error            							= true
		                        ErrorMessage     							= error message
		                if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 								= Error
								invoked.ErrorMessage 						= ErrorMessage
								invoked.Status								= 2
								invoked.CloseDate							= system current timestamp
								invoked.BODXML								= UnitOfMeasureXMLBOD
								invoked.BODID								= DerivedBODFormattedId		
						else
							invoke Update FSMInboundBODTrackerRel
								invoked.Status									= 3
								invoked.CloseDate								= system current timestamp
								invoked.BODXML									= UnitOfMeasureXMLBOD
								invoked.BODID									= DerivedBODFormattedId
					
	Action Exit Rules
		if (ItemGroup.BusinessGroup.FinanceEnterpriseGroup.BODTrigger and !LocalBODTrigger)
			if (!action type.Delete)
				if (action != "UpdateBODIdFields") 
					ActionCode	= ActionCode.Update
					if (action type.Create)
						ActionCode	= ActionCode.Create				
					else
						if (action type.Delete)
							ActionCode	= ActionCode.Delete
					increment bod id.VariationID
					include TriggerUnitOfMeasureServiceRules

		
	
	        
