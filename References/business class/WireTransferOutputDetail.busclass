WireTransferOutputDetail is a BusinessClass
    owned by cb
    prefix is WTOD

    Ontology
        symbolic key is WireTransferOutputDetail

    Patterns
        disable AuditIndex

    Persistent Fields
		EDINumber
		BankClientIdentifier				is AlphaUpper 50
		BranchIdentifier					is AlphaUpper 50

    	OriginatorName						is like Name	 
    		holds pii
    	OriginatorPostalAddress            	is a PostalAddressV2	
    		holds pii
    	OriginatorBankName					is a BankName
		OriginatorBankPostalAddress         is a PostalAddressV2	
			holds pii
		OriginatorRoutingNumber				is Alpha 35
		OriginatorSwiftID					is a SwiftID
		OriginatorBankAccount				is a CashManagementAccount
		OriginatorIBAN						is an InternationalBankAccountNumber 
			holds pii
		OriginatorBankAccountCurrency 		is a Currency
		OriginatorBankCurrencyISOCode		is AlphaUpper 3

		BeneficiaryName						is like Name	 
			holds pii
		BeneficiaryPostalAddress            is a PostalAddressV2	
			holds pii
		BeneficiaryBankName					is a BankName
		BeneficiaryBankPostalAddress        is a PostalAddressV2	
			holds pii
		BeneficiaryRoutingNumber			is Alpha 35
		BeneficiarySwiftID					is a SwiftID
		BeneficiaryBankAccount				is like CashManagementAccount
		BeneficiaryIBAN						is an InternationalBankAccountNumber 
			holds pii

		IntermediaryBankName				is a BankName
		IntermediaryBankPostalAddress       is a PostalAddressV2	
			holds pii
		IntermediaryRoutingNumber			is Alpha 35
		IntermediarySwiftID					is a SwiftID
		IntermediaryBankAccount				is like CashManagementAccount
		IntermediaryIBAN					is an InternationalBankAccountNumber 
			holds pii
				
        Reference							is a Description
		EffectiveDate						is Date
		TransactionDate						is Date
        TransactionAmount                   is an InternationalAmount
        TransactionCurrency					is a Currency
        TransactionCurrencyISOCode			is AlphaUpper 3
		TransactionData1                    is a TransactionData
		TransactionData2                    is a TransactionData
		TransactionData3                    is a TransactionData
		TransactionData4                    is a TransactionData
		
		WireTransferBatch
		WireTransferBatchDetail
		CashLedgerTransactionIdentifier
		
		ConfirmationDate					is Date		
		ConfirmationNumber					
		ConfirmationAmount					is an InternationalAmount
		ConfirmationComment					is Text
		Status								is Numeric 1
			States
				PendingConfirmation				value is 0
				Processed						value is 1
				Rejected						value is 2
							  
    Derived Fields
        DoubleQuote        is a StringField
            type is Alpha 2048
            restricted
            "\""
            
        CsvOutput        is a StringField
            type is Alpha 2048
            restricted
			DoubleQuote
			EDINumber
			DoubleQuote
			","
			DoubleQuote
    		BankClientIdentifier
    		DoubleQuote
			","
			DoubleQuote
			BranchIdentifier
			DoubleQuote
			","
			DoubleQuote
			OriginatorName
			DoubleQuote
			","
			DoubleQuote
			OriginatorPostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			OriginatorPostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			OriginatorPostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			OriginatorPostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			OriginatorPostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			OriginatorPostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			OriginatorPostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			OriginatorPostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankName
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankPostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankPostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankPostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankPostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankPostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankPostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankPostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankPostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			OriginatorRoutingNumber
			DoubleQuote
			","
			DoubleQuote
			OriginatorSwiftID
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankAccount
			DoubleQuote
			","
			DoubleQuote
			OriginatorIBAN
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankAccountCurrency
			DoubleQuote
			","
			DoubleQuote
			OriginatorBankCurrencyISOCode
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryName
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryPostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryPostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryPostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryPostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryPostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryPostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryPostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryPostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankName
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankPostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankPostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankPostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankPostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankPostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankPostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankPostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankPostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryRoutingNumber
			DoubleQuote
			","
			DoubleQuote
			BeneficiarySwiftID
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryBankAccount
			DoubleQuote
			","
			DoubleQuote
			BeneficiaryIBAN
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankName
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine1
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine2
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine3
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.DeliveryAddress.AddressLine4
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.Municipality
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.StateProvince
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.PostalCode
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankPostalAddress.Country
			DoubleQuote
			","
			DoubleQuote
			IntermediaryRoutingNumber
			DoubleQuote
			","
			DoubleQuote
			IntermediarySwiftID
			DoubleQuote
			","
			DoubleQuote
			IntermediaryBankAccount
			DoubleQuote
			","
			DoubleQuote
			IntermediaryIBAN
			DoubleQuote
			","
			DoubleQuote
			Reference
			DoubleQuote
			","
			EffectiveDate
			","
			TransactionDate
			","
			TransactionAmount
			","
			DoubleQuote
			TransactionCurrency
			DoubleQuote
			","
			DoubleQuote
			TransactionCurrencyISOCode
			DoubleQuote
			","
			DoubleQuote
			TransactionData1
			DoubleQuote
			","
			DoubleQuote
			TransactionData2
			DoubleQuote
			","
			DoubleQuote
			TransactionData3
			DoubleQuote
			","
			DoubleQuote
			TransactionData4
			DoubleQuote
			","
			DoubleQuote
			CashLedgerTransactionIdentifier
			DoubleQuote

	Conditions
		NotProcessedOrRejected
			restricted
			when (!Status.Processed 
			and   !Status.Rejected)
			
		ProcessedOrRejected
			restricted
			when (Status.Processed 
			or	  Status.Rejected)
		
		ConfirmationDifferenceAlert
			when (ConfirmationAmount entered
			and   TransactionAmount != ConfirmationAmount)
					
	Relations
		WireTransferBatchDetailRel
			one-to-one relation to WireTransferBatchDetail
			Field Mapping uses symbolic key
				related.CashManagementGroup		= CashManagementGroup
				related.WireTransferBatch		= WireTransferBatch
				related.WireTransferBatchDetail	= WireTransferBatchDetail

		CBCompanySystemClosingControlRel		
			one-to-one relation to CompanySystemClosingControl
			Field Mapping uses BySystemCode
				related.GeneralLedgerSystemCode		= "CB"
				related.Company						= WireTransferBatchDetailRel.FromCompany
	
	Sets
		ByWireTransferBatch
			Sort Order
				CashManagementGroup
				WireTransferBatch
				TransactionDate
				WireTransferOutput
				WireTransferOutputDetail
		
		ByCashLedgerTransactionIdentifier
			Sort Order
				CashManagementGroup
				CashLedgerTransactionIdentifier
                WireTransferOutput
				WireTransferOutputDetail		
									
	Actions
        Create is a Create Action
        	restricted

        Update is an Update Action
			restricted
		
		ConfirmWireTransfer is an Instance Action
			valid when (NotProcessedOrRejected)
			Parameters
				PrmCashLedgerUpdateAction	is Numeric 2
			    	States
			    		Accepted	value is 1
			    		Rejected	value is 2
				PrmPostingDate				is Date	
				PrmConfirmationDate			is Date
				PrmConfirmationNumber		is like ConfirmationNumber
				PrmConfirmationAmount		is an InternationalAmount
				PrmConfirmationComment		is Text
				
			Parameter Rules
				PrmCashLedgerUpdateAction
					initial value is 1 
					required
				
				PrmPostingDate		
					initial value is WireTransferBatchDetailRel.PostingDate
					if (PrmCashLedgerUpdateAction.Accepted)
						if (CBCompanySystemClosingControlRel.Control)	
							constraint (PrmPostingDate within CBCompanySystemClosingControlRel.ValidEntryDate)	
								"PostingDateOutsideValidDateRangeOf:<CBCompanySystemClosingControlRel.ValidEntryDate.Begin>-<CBCompanySystemClosingControlRel.ValidEntryDate.End>ForCBCompany<WireTransferBatchDetailRel.FromCompany>"	
					
				PrmConfirmationDate
					initial value is current corporate date
					required
					
				PrmConfirmationNumber	
					required
					
				PrmConfirmationAmount
					initial value is TransactionAmount
					if (PrmCashLedgerUpdateAction.Accepted)
						required
					else
						initialize
					
			Action Rules
				ConfirmationDate = PrmConfirmationDate
				ConfirmationNumber = PrmConfirmationNumber
				ConfirmationAmount = PrmConfirmationAmount
				ConfirmationComment = PrmConfirmationComment
				
				if (PrmCashLedgerUpdateAction.Accepted)
					for each WireTransferBatchDetailRel.WireTransferBatchDetailDistribution set
						invoke FastUpdate each
							invoked.DistributionConfirmedAmount = each.DistributionAmount
							invoked.PostingDate					= PrmPostingDate	
					
					invoke MarkAsProcessed WireTransferBatchDetailRel
						invoked.PrmConfirmationAmount = PrmConfirmationAmount
						invoked.PrmPostingDate		  = PrmPostingDate	
						
					Status = 1 
				else
				if (PrmCashLedgerUpdateAction.Rejected)
					invoke MarkAsRejected WireTransferBatchDetailRel
					
					Status = 2 
				
        Delete is a Delete Action
			restricted
			
		Purge is a Purge Action
			restricted
