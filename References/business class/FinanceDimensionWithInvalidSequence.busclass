FinanceDimensionWithInvalidSequence is a BusinessClass
	owned by GeneralLedger
	sql name is "FinDimInvalidSeq"
	prefix is FDWIS
	
	Ontology
		symbolic key is FinanceDimensionWithInvalidSequence
		
	
	Patterns
	
	Persistent Fields
        Dimension              is AlphaUpper size 15
        FinanceDimension1
        FinanceDimension2
        FinanceDimension3
        FinanceDimension4
        FinanceDimension5
        FinanceDimension6
        FinanceDimension7
        FinanceDimension8
        FinanceDimension9
        FinanceDimension10
        SequenceProblem		   is Numeric 1
        	States
        		Missing		   value is 1
        		Duplicate	   value is 2
        Completed              is Boolean
	
	Field Rules
	
    Relations
		Dim1MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 1
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim2MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 2
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim3MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 3
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim4MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 4
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim5MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 5
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim6MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 6
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim7MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 7
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim8MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 8
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim9MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 9
			Instance Selection
				where (related.SequenceProblem.Missing)
		Dim10MissingSequenceRel
			one-to-many relation to FinanceDimensionWithInvalidSequence
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
				related.FinanceDimensionType   = 10
			Instance Selection
				where (related.SequenceProblem.Missing)
								
    Derived Fields

        DerivedDimensionName is a DerivedField
            type is Alpha size 30
            if (FinanceDimensionType = 1)
                return "FinanceDimension1"
            if (FinanceDimensionType = 2)
                return "FinanceDimension2"
            if (FinanceDimensionType = 3)
                return "FinanceDimension3"
            if (FinanceDimensionType = 4)
                return "FinanceDimension4"
            if (FinanceDimensionType = 5)
                return "FinanceDimension5"
            if (FinanceDimensionType = 6)
                return "FinanceDimension6"
            if (FinanceDimensionType = 7)
                return "FinanceDimension7"
            if (FinanceDimensionType = 8)
                return "FinanceDimension8"
            if (FinanceDimensionType = 9)
                return "FinanceDimension9"
            if (FinanceDimensionType = 10)
                return "FinanceDimension10"
                
    Actions

        Create is a Create Action
			restricted
        Delete is a Delete Action

        FixDimensions is a Set Action
        	restricted
        	Parameters
        		PrmFinanceEnterpriseGroup is a FinanceEnterpriseGroup
            Instance Selection
                where (FinanceEnterpriseGroup = PrmFinanceEnterpriseGroup
                and    !Completed)
            Action Rules
                Instance Rules
                    if (FinanceDimensionType = 1)
                        invoke AssignNewSequence FinanceDimension1
                    else
                    if (FinanceDimensionType = 2)
                    	invoke AssignNewSequence FinanceDimension2
                    else
                    if (FinanceDimensionType = 3)
                        invoke AssignNewSequence FinanceDimension3
                    else
                    if (FinanceDimensionType = 4)
                        invoke AssignNewSequence FinanceDimension4
                    else
                    if (FinanceDimensionType = 5)
                        invoke AssignNewSequence FinanceDimension5
                    else
                    if (FinanceDimensionType = 6)
                        invoke AssignNewSequence FinanceDimension6
                    else
                    if (FinanceDimensionType = 7)
                        invoke AssignNewSequence FinanceDimension7
                    else
                    if (FinanceDimensionType = 8)
                        invoke AssignNewSequence FinanceDimension8
                    else
                    if (FinanceDimensionType = 9)
                        invoke AssignNewSequence FinanceDimension9
                    else
                    if (FinanceDimensionType = 10)
						invoke AssignNewSequence FinanceDimension10
                    
                    Completed = true

        CreateBusinessClassGroup is a Set Action
            disable checkpoint
        	Parameters
        		PrmFinanceEnterpriseGroup is a FinanceEnterpriseGroup
            Instance Selection
                where (FinanceEnterpriseGroup = PrmFinanceEnterpriseGroup)
            Local Fields
                LocalBusinessClass  is a BusinessClass
                LocalBusClassGroup  is a BusinessClassGroup
                LocalGLTotCondition is LPLText
                LocalGLTxnCondition is LPLText
                LocalQuote          is Alpha size 1
            Action Rules
                Set Rules
                    Entrance Rules
                        LocalQuote = "\""
                        LocalGLTotCondition = "("
                        LocalGLTxnCondition = "("
                    Exit Rules
                        LocalGLTotCondition += "))"
                        LocalBusinessClass = "GeneralLedgerTotal"
                        LocalBusClassGroup = ("_ZFDS_GLTOT_GROUP_" + PrmFinanceEnterpriseGroup)
                        if (LocalBusClassGroup exists)
                            invoke Update LocalBusClassGroup
                                invoked.Active = true
                                invoked.Condition = LocalGLTotCondition
                        else
                            invoke Create BusinessClassGroup
                                invoked.BusinessClass = LocalBusinessClass
                                invoked.BusinessClassGroup = LocalBusClassGroup
                                invoked.Description = "Totals with bad dimensions"
                                invoked.Active = true
                                invoked.Condition = LocalGLTotCondition
                        
                        LocalGLTxnCondition += "))"
                        LocalBusinessClass = "GeneralLedgerTransaction"
                        LocalBusClassGroup = ("_ZFDS_GLTXN_GROUP_" + PrmFinanceEnterpriseGroup)
                        if (LocalBusClassGroup exists)
                            invoke Update LocalBusClassGroup
                                invoked.Active = true
                                invoked.Condition = LocalGLTxnCondition
                        else
                            invoke Create BusinessClassGroup
                                invoked.BusinessClass = LocalBusinessClass
                                invoked.BusinessClassGroup = LocalBusClassGroup
                                invoked.Description = "Transactions with bad dimensions"
                                invoked.Active = true
                                invoked.Condition = LocalGLTxnCondition
                        
                        LocalBusinessClass = "GLTransactionDetail"
                        LocalBusClassGroup = ("_ZFDS_GLTXND_GROUP_" + PrmFinanceEnterpriseGroup)
                        if (LocalBusClassGroup exists)
                            invoke Update LocalBusClassGroup
                                invoked.Active = true
                                invoked.Condition = LocalGLTxnCondition
                        else
                            invoke Create BusinessClassGroup
                                invoked.BusinessClass = LocalBusinessClass
                                invoked.BusinessClassGroup = LocalBusClassGroup
                                invoked.Description = "Txn details with bad dimensions"
                                invoked.Active = true
                                invoked.Condition = LocalGLTxnCondition
                                
                Instance Rules
                    if (LocalGLTotCondition = "(")
                        LocalGLTotCondition += "FinanceEnterpriseGroup="
                        LocalGLTotCondition += LocalQuote
                        LocalGLTotCondition += PrmFinanceEnterpriseGroup
                        LocalGLTotCondition += LocalQuote
                        LocalGLTotCondition += " and (("

                        LocalGLTxnCondition += "FinanceEnterpriseGroup="
                        LocalGLTxnCondition += LocalQuote
                        LocalGLTxnCondition += PrmFinanceEnterpriseGroup
                        LocalGLTxnCondition += LocalQuote
                        LocalGLTxnCondition += " and Status < 2 and ((FinanceCodeBlock."                        
                    
                    	if (Dim1MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension1 = blank) or ("
                       	if (Dim2MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension2 = blank) or ("
                        if (Dim3MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension3 = blank) or ("
                    	if (Dim4MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension4 = blank) or ("
                    	if (Dim5MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension5 = blank) or ("
                    	if (Dim6MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension6 = blank) or ("
                     	if (Dim7MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension7 = blank) or ("
                    	if (Dim8MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension8 = blank) or ("
                    	if (Dim9MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension9 = blank) or ("
                    	if (Dim10MissingSequenceRel exists)
                    		LocalGLTotCondition += "FinanceDimension10 = blank) or ("
                    		                    		
                    else
                        LocalGLTotCondition += " or ("                    
                        LocalGLTxnCondition += " or (FinanceCodeBlock."

                    LocalGLTotCondition += DerivedDimensionName
                    LocalGLTotCondition += "="
                    LocalGLTotCondition += LocalQuote
                    LocalGLTotCondition += Dimension
                    LocalGLTotCondition += LocalQuote
                    LocalGLTotCondition += ")"
                    
                    LocalGLTxnCondition += DerivedDimensionName
                    LocalGLTxnCondition += "="
                    LocalGLTxnCondition += LocalQuote
                    LocalGLTxnCondition += Dimension
                    LocalGLTxnCondition += LocalQuote
                    LocalGLTxnCondition += ")"
                    
