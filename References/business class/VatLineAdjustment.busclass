VatLineAdjustment is a BusinessClass  
    owned by tx
    prefix is Vla













    Ontology
        symbolic key is VatLineAdjustment

    Patterns
        implements StaticJava
        disable AuditIndex

    Persistent Fields
        AdjustByVatBox      is a VatBoxNbr
        AdjustDescription	is a Description
		EffectOnVatBox 		is AlphaUpper size 1
            States
                AddTo           value is "+"
                SubtractFrom    value is "-"
                NoEffectOn   	value is blank
		AdjustByAmount		is a InternationalAmount		

    Sets
        ByAdjustByBoxNumber
            indexed
            Sort Order
				FinanceEnterpriseGroup	 
		 		TaxEntity 				 
		 		VatReportIDForCountry.VatReportID
		 		VatReportIDForCountry.CountryCode	             
				AdjustByVatBox
                VatReportingLine
                VatLineAdjustment
                
	Local Fields

	Derived Fields

		DerivedAdjByAmount is a DerivedField
	    	type is Decimal 8.3
	    	restricted	
	    	if (AdjustByThisVatReportingLineRel exist)
	    		return first AdjustByThisVatReportingLineRel.TotalTaxAmount
	    	else
	    		return blank
	    		
	
					
  	Field Rules
		FinanceEnterpriseGroup
			default to actor.context.FinanceEnterpriseGroup
        												
	Relations
        VatReportingLineRel
            classic name is TXVATRPTLN
            one-to-one relation to VatReportingLine
            required
            Field Mapping uses symbolic key
		    	related.FinanceEnterpriseGroup		      = TaxEntity.FinanceEnterpriseGroup
    			related.TaxEntity						  = TaxEntity 	
                related.VatReportIDForCountry.VatReportID = VatReportIDForCountry.VatReportID
                related.VatReportIDForCountry.CountryCode = VatReportIDForCountry.CountryCode
                related.VatReportingLine                  = VatReportingLine

      	AdjustByThisVatReportingLineRel
            one-to-many relation to VatReportingLine
            delete cascades

            Field Mapping uses ByBoxNumber
		    	related.FinanceEnterpriseGroup				= TaxEntity.FinanceEnterpriseGroup
   				related.TaxEntity							= TaxEntity 	
                related.VatReportIDForCountry.VatReportID 	= VatReportIDForCountry.VatReportID  
                related.VatReportIDForCountry.CountryCode 	= VatReportIDForCountry.CountryCode 
                related.VATBoxNumber						= AdjustByVatBox  



                                            		
    Actions
        Create is a Create Action
			Entrance Rules
				constraint (VatReportingLine.VATBoxNumber != AdjustByVatBox)	
					"VATBoxNumberCannotBeTheSameNumberAsAdjustmentBoxNumber"	     
        Update is an Update Action
        Delete is a Delete Action
        	Entrance Rules
        		initialize AdjustByVatBox		
 
		ClearAdjustByAmount is an Instance Action	
			default label is untranslatable	 	 

			Action Rules
				initialize AdjustByAmount

		UpdateAdjustByAmount is an Instance Action	
			default label is untranslatable	 	 

			Action Rules
				initialize AdjustByAmount
				if (AdjustByThisVatReportingLineRel exist)
     				if (EffectOnVatBox.AddTo)
		        		AdjustByAmount += DerivedAdjByAmount
		            if (EffectOnVatBox.SubtractFrom)
		            	AdjustByAmount -= DerivedAdjByAmount				
					
				
