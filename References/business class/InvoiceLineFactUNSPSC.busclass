InvoiceLineFactUNSPSC is a BusinessClass
	owned by procurement
	prefix is ILFUN

	Ontology
		symbolic key is InvoiceLineFactUNSPSC

	Patterns
        disable Auditing
        disable EffectiveDated

	Persistent Fields
		UNSPSCCode
		TotalSpend			is an InternationalAmount
		ConsolidationLevel	is Numeric 1
	
	Local Fields
		SpendDimension
				
	Derived Fields
		StringVariableLevel1 is a StringField
			type is Alpha size up to 35
			restricted
			InvoiceLineFactUNSPSC.Level[1]
			
	Conditions
		FamilyEntered
			restricted
			when (InvoiceLineFactUNSPSC.Level[2] entered
			and   InvoiceLineFactUNSPSC.Level[2] != "00")
			
		ClassEntered
			restricted
			when (InvoiceLineFactUNSPSC.Level[3] entered
			and   InvoiceLineFactUNSPSC.Level[3] != "00")
			
		CommodityEntered
			restricted
			when (InvoiceLineFactUNSPSC.Level[4] entered
			and   InvoiceLineFactUNSPSC.Level[4] != "00")
			
	
	Relations
		InvoiceLineFactConsolidatesForSegmentsRel
			one-to-many relation to InvoiceLineFactConsolidate
			Field Mapping uses ByConsolidationLevel
				related.ConsolidationLevel							= 1
				related.ProcurementGroup							= ProcurementGroup
				related.InvoiceLineFactConsolidateControl			= InvoiceLineFactConsolidateControl
				related.InvoiceLineFactConsolidate.Level1.Type		= SpendDimension.Type.UNSPSCSegment
				related.InvoiceLineFactConsolidate.Level1.Value		= UNSPSCCode.UNSPSCSegment
			Instance Selection
				where (related.TotalOnOffSpend	> 0)

		InvoiceLineFactConsolidatesFamiliesForSegmentRel
			one-to-many relation to InvoiceLineFactConsolidate
			Field Mapping uses ByConsolidationLevel
				related.ConsolidationLevel							= 2
				related.ProcurementGroup							= ProcurementGroup
				related.InvoiceLineFactConsolidateControl			= InvoiceLineFactConsolidateControl
				related.InvoiceLineFactConsolidate.Level1.Type		= SpendDimension.Type.UNSPSCSegment
				related.InvoiceLineFactConsolidate.Level1.Value		= UNSPSCCode.UNSPSCSegment
				related.InvoiceLineFactConsolidate.Level2.Type		= SpendDimension.Type.UNSPSCFamily
			Instance Selection 
				where (related.InvoiceLineFactConsolidate.SpendCategory.OnContract)

		ItemInvoiceLineFactConsolidatesRel
			one-to-many relation to InvoiceLineFactConsolidate
			Field Mapping uses ByLevelsOnOff
				related.ProcurementGroup							= ProcurementGroup
				related.InvoiceLineFactConsolidateControl			= InvoiceLineFactConsolidateControl
				related.InvoiceLineFactConsolidate.SpendCategory	= 1
				related.ConsolidationLevel							= 5
				related.InvoiceLineFactConsolidate.Level1.Type		= SpendDimension.Type.UNSPSCSegment
				related.InvoiceLineFactConsolidate.Level1.Value		= StringVariableLevel1
			Instance Selection
				where ((related.InvoiceLineFactConsolidate.Level1.Value		= StringVariableLevel1
				and     InvoiceLineFactUNSPSC.Level[2] not entered)
				or     (related.InvoiceLineFactConsolidate.Level1.Value		= StringVariableLevel1
				and     related.InvoiceLineFactConsolidate.Level2.Value		= InvoiceLineFactUNSPSC.Level[2]
				and     InvoiceLineFactUNSPSC.Level[3] not entered)
				or     (related.InvoiceLineFactConsolidate.Level1.Value		= StringVariableLevel1
				and     related.InvoiceLineFactConsolidate.Level2.Value		= InvoiceLineFactUNSPSC.Level[2]
				and     related.InvoiceLineFactConsolidate.Level3.Value		= InvoiceLineFactUNSPSC.Level[3]
				and     InvoiceLineFactUNSPSC.Level[4] not entered)
				or     (related.InvoiceLineFactConsolidate.Level1.Value		= StringVariableLevel1
				and     related.InvoiceLineFactConsolidate.Level2.Value		= InvoiceLineFactUNSPSC.Level[2]
				and     related.InvoiceLineFactConsolidate.Level3.Value		= InvoiceLineFactUNSPSC.Level[3]
				and     related.InvoiceLineFactConsolidate.Level4.Value		= InvoiceLineFactUNSPSC.Level[4]))

		InvoiceLineFactConsolidatesByLevelRel
			one-to-many relation to InvoiceLineFactConsolidate
			Field Mapping uses ByLevels
				related.InvoiceLineFactConsolidate.Level1.Value	= InvoiceLineFactUNSPSC.Level[1]
				related.InvoiceLineFactConsolidate.Level2.Value	= InvoiceLineFactUNSPSC.Level[2]
				related.InvoiceLineFactConsolidate.Level3.Value	= InvoiceLineFactUNSPSC.Level[3]
				related.InvoiceLineFactConsolidate.Level4.Value	= InvoiceLineFactUNSPSC.Level[4]
			Instance Selection
				where (related.InvoiceLineFactConsolidate.Level1.Type.UNSPSCSegment
				and    related.ConsolidationLevel					= ConsolidationLevel
				and    related.InvoiceLineFactConsolidateControl	= InvoiceLineFactConsolidateControl
				and    related.TotalOnOffSpend	> 0)

		UNSPSCForSegmentRel
			one-to-one relation to UNSPSCCode
			Field Mapping uses symbolic key
				related.ItemGroup				= ProcurementGroup
				related.UNSPSCCode.UNSPSCSegment	= UNSPSCCode.UNSPSCSegment
				related.UNSPSCCode.UNSPSCFamily		= "00"
				related.UNSPSCCode.UNSPSCClass		= "00"
				related.UNSPSCCode.UNSPSCCommodity	= "00"
																		
		UNSPSCForFamilyRel
			one-to-one relation to UNSPSCCode
			Field Mapping uses symbolic key
				related.ItemGroup				= ProcurementGroup
				related.UNSPSCCode.UNSPSCSegment	= UNSPSCCode.UNSPSCSegment
				related.UNSPSCCode.UNSPSCFamily		= UNSPSCCode.UNSPSCFamily
				related.UNSPSCCode.UNSPSCClass		= "00"
				related.UNSPSCCode.UNSPSCCommodity	= "00"
																		
		UNSPSCForClassRel
			one-to-one relation to UNSPSCCode
			Field Mapping uses symbolic key
				related.ItemGroup				= ProcurementGroup
				related.UNSPSCCode.UNSPSCSegment	= UNSPSCCode.UNSPSCSegment
				related.UNSPSCCode.UNSPSCFamily		= UNSPSCCode.UNSPSCFamily
				related.UNSPSCCode.UNSPSCClass		= UNSPSCCode.UNSPSCClass
				related.UNSPSCCode.UNSPSCCommodity	= "00"
																		
		UNSPSCForCommodityRel
			one-to-one relation to UNSPSCCode
			Field Mapping uses symbolic key
				related.ItemGroup				= ProcurementGroup
				related.UNSPSCCode.UNSPSCSegment	= UNSPSCCode.UNSPSCSegment
				related.UNSPSCCode.UNSPSCFamily		= UNSPSCCode.UNSPSCFamily
				related.UNSPSCCode.UNSPSCClass		= UNSPSCCode.UNSPSCClass
				related.UNSPSCCode.UNSPSCCommodity	= UNSPSCCode.UNSPSCCommodity
				
		ContextProcurementGroupRel
			one-to-one relation to ProcurementGroup
			Field Mapping uses symbolic key
				related.ProcurementGroup		= ProcurementGroup
	
	Sets
		ByUNSPSC
			duplicates
			Sort Order
				ProcurementGroup
				InvoiceLineFactConsolidateControl
				UNSPSCCode
				
	Field Rules

	Actions
		Create is a Create Action
			restricted
		
		Update is an Update Action
			restricted
		
		Delete is a Delete Action
			restricted
		
		Purge is a Purge Action
			restricted
