VertexTransactionMaintenance is a BusinessClass
    owned by webservice 
	prefix is VtxMt












    Ontology
        symbolic key is VertexTransactionMaintenance

    Patterns
		implements CRUD
	Persistent Fields
		WebServiceError 			is Boolean
		WebServiceErrorMessage 		is Text
		ResumeOnError				is Boolean		
		PostingDate					is Date	
		DocumentNumber				is Alpha 50		
		ResponseTime 				is Alpha 25		
		TransactionExistsIndicator	is Boolean
		ProcessType				is Alpha 1
			States
				Inquire			value is "I"	 			
				Reverse			value is "R" 				
				Delete			value is "D" 				
		Status					is Alpha 1
			States
				Selected				value is ""
				Validated				value is "V"		

				Processed				value is "P" 		
				Errored					value is "E" 		
				TransactionDoesNotExist	value is "X"		
				OnHold					value is "H"		
				




		VendorBusinessGroup			is like BusinessGroup
		OriginalTransactionId		is Alpha 40 						
		TransactionId				is Alpha 40 						
		UniqueIdOfRelatedObject 	is UniqueID							
		RelatedObject				is BusinessObjectReference 		
		RelatedObjectBusclass		is Alpha 30 
		TaxEntity            		
		SystemCode					is like GeneralLedgerSystemCode		
		Company						is like GeneralLedgerCompany
		Vendor  		        	is like Vendor
		Customer 					is like Customer 
		LocationCode				is a Location
		Invoice						is like Invoice
		PurchaseOrderNumber			is like PurchaseOrder
		TaxAreaId					is like TaxCode
		InvoiceAmount				is an InternationalAmount	
		TaxableAmount				is an InternationalAmount			
		TaxAmount					is an InternationalAmount
		GeneralLedgerAccount		is Alpha size 50
			default label is "GlobalLedgerAccount"
		ResultMessage				is Alpha 200						
		TaxPointDate				is Date
		ReasonText					is Alpha 30
		Processor					is like Actor
		DisplayMonitor   	    	is RichText
		Notes   	    			is RichText
		VoucherNumber				is like VoucherNumber
		DocumentSequenceId			is an IntrastatNumber
				
	Local Fields
		LocalBOR					is Alpha 30
		
	Transient Fields


		KeepCurrentDisplay	is Boolean








			
	Field Rules
		OriginalTransactionId

		TransactionId	

		Processor	

		Status

			
	Derived Fields
		DerivedFinanceEnterpriseGroup is a DerivedField			 
			type is like FinanceEnterpriseGroup
			if (TaxEntity entered
			and TaxEntity.FinanceEnterpriseGroup entered)
				return TaxEntity.FinanceEnterpriseGroup
			
			return actor.context.FinanceEnterpriseGroup		 
			
		DerivedBusinessObjectKey is a DerivedField
			type is Alpha 100
			if (RelatedObject entered)
				return com.lawson.apps.sharedfinance.base.StringUtils.trimLeadingSpaces(RelatedObject)
			else	
				return "VertexTransactionMaintenenace:" + CurrentTimestamp
				
		DerivedRelatedObject is a DerivedField
			type is Alpha 20
			restricted
			if (RelatedObject entered)
				LocalBOR = com.lawson.apps.sharedfinance.base.StringUtils.trimLeadingSpaces(RelatedObject)

				return LocalBOR
			else	
				return blank
			
		SuccessfullMessage	is a MessageField
        	restricted
			"TransactionId:<TransactionId>,SuccessfullyProcessed..."
 
		DateAlpha10 is a DerivedField
			type is Alpha 10
			return DateAlpha8[1:4] + "-" + DateAlpha8[5:6] + "-" + DateAlpha8[7:8]		 
			
		DateAlpha8 is a DerivedField
			type is Alpha 8
			return current corporate date
			
		DerivedAsOfDate is a DerivedField
			type is Date
			restricted
			return DateAlpha8

		DateWithDashesAlpha10 is a StringField	
			type is Alpha 10
			DateAlpha8[1:4]
			"-"
			DateAlpha8[5:6]
			"-"
			DateAlpha8[7:8]	

		DerivedKeyField is a DerivedField
			type is Alpha 100
			return "VertexTransactionMaintenance:" + CurrentTimestamp

		CurrentTimestamp is a DerivedField
			type is Alpha 20
			return current timestamp

		CurrentTimestampLabel is a LabelField
			"<current timestamp>"

		DisplayDate is a StringField	 
			type is RichText
			"Date..................: " CurrentTimestampLabel	 	 "<br>"


		DisplayOutputHeader is a StringField	 
			type is RichText	
			"<pre>"

			"+==================================================================================+<br>"
			"+                         * * *   O U P U T   * * *                                |<br>"				
			"+==================================================================================+<br>"	




		TableStyle is a StringField	 
			type is RichText
			"	<style>                                    "
			"	table {                                    "
			"		font-family: arial, sans-serif;        "
			"		border-collapse: collapse;             "
			"		width: 100%;                           "
			"	}                                          "
            "                                              "
			"	td, th {                                   "
			"		border: 1px solid #dddddd;             "
			"		text-align: left;                      "
			"		padding: 5px;                          "
			"	}                                          "
            "                                              "
			"	tr:nth-child(even) {                       "
			"		background-color: #dddddd;             "
			"	}                                          "
			"	</style>                                   "
	
		OutputReversal is a StringField	 
			type is RichText	
			"<pre>"	
			"+==================================================================================+<br>"
			"|  Date..................: " CurrentTimestampLabel	 	                   			"<br>"	 
			"+==================================================================================+<br>"
			"+                         * * *   REVERSAL REQUEST RESULTS * * *                   |<br>"				
			"+==================================================================================+<br>"	
			"| OriginalTransactionId..:" OriginalTransactionId 									"<br>"	 
			"| TransactionId..........:" TransactionId 											"<br>"	 
			"| PostingDate............:" PostingDate 											"<br>"	 
			"| DocumentNumber.........:" DocumentNumber 										"<br>"	 
			"| ResponseTime...........:" ResponseTime 											"<br>"	 
			"<table>                                            								"
			"  <tr>                                                                             "
			"	<th>WebServiceError</th>                                                        "
			"  </tr>                                                                            "
			"  <tr>                                                                             "
			"	<td>" WebServiceErrorMessage"</td>                                              "
			"  </tr>                                                                            "
			"</table>                                                                           "
			"</pre>"																	

		TransactionExistResults is a StringField	 
			type is RichText	
			"<pre>"	
			"+==================================================================================+<br>"
			"|  Date..................: " CurrentTimestampLabel	 	                   			"<br>"	 
			"+==================================================================================+<br>"
			"+                 * * *   TRANSACTION EXIST REQUEST RESULTS * * *                   |<br>"				
			"+==================================================================================+<br>"	
			"| TransactionId..............:" TransactionId 										"<br>"	 
			"| TransactionExistsIndicator.:" TransactionExistsIndicator 						"<br>"	 
			"| ResponseTime...............:" ResponseTime 										"<br>"	 
			TableStyle
			"<table>                                       										"
			"  <tr>                                        										"
			"	<th>WebServiceError</th>                   										"
			"  </tr>                                      								 		"
			"  <tr>                                        										"
			"	<td>" WebServiceErrorMessage"</td>         										"
			"  </tr>                                       										"
			"</table>                                      										"
			"</pre>"

    Sets

		ByRelatedObject

			duplicates
			Sort Order
				UniqueIdOfRelatedObject

		ByOriginalTransactionId
			duplicates
			Sort Order
				OriginalTransactionId	

		ByBusnessObjectRef
			duplicates
			Sort Order				
				RelatedObject
							 

	Relations		


























  		VertexConfigRel
        	one-to-one relation to VertexConfig
        	Field Mapping uses symbolic key
				related.VertexConfig 								= DerivedFinanceEnterpriseGroup	
 			
		VertexConfigVersionRel
        	one-to-many relation to VertexConfigVersion
        	Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup						= DerivedFinanceEnterpriseGroup	
			Instance Selection
				where (related.VertexConfigVersion.Version 			= VertexConfigRel.DefaultVersion.Version
				and	   related.VertexConfigVersion.ServiceRelease 	= VertexConfigRel.DefaultVersion.ServiceRelease
				and	   related.VertexConfigVersion.ServerName 		= VertexConfigRel.DefaultVersion.ServerName)

  		VertexConfigGroupRel
        	one-to-one relation to VertexConfig
        	Field Mapping uses symbolic key
				related.VertexConfig = DerivedFinanceEnterpriseGroup							

    Conditions



		TransactionIdExist
			when (TransactionId entered)
		TransactionIdNotEntered
			when (TransactionId not entered)					

	Rule Blocks			


		ProcessRequest 
				WebServiceError = false
				initialize WebServiceErrorMessage
				if (ProcessType.Reverse)
					invoke Reversal VertexTransactionRequest
						resume on error
							WebServiceError = true
							WebServiceErrorMessage = error message	
						invoked.Login.TrustedId							= VertexConfigVersionRel.TrustedId	  				 		 		 
						invoked.ReversalRequest.OriginalTransactionId	= OriginalTransactionId						
						invoked.ReversalRequest.TransactionId 			= TransactionId
						invoked.ReversalRequest.PostingDate				= PostingDate
						invoked.ReversalRequest.DocumentNumber			= DocumentNumber							

						OriginalTransactionId	= result.ReversalResponse.OriginalTransactionId
						TransactionId 			= result.ReversalResponse.TransactionId
						DocumentNumber 			= result.ReversalResponse.DocumentNumber
						PostingDate 			= result.ReversalResponse.PostingDate
						ResponseTime 			= result.ApplicationData.ResponseTimeMS
					
					if (WebServiceError)
						Status = "E"
						ResultMessage = "WebserviceError"
					else
						Status = "P"
						ResultMessage = "TransactionReversed"
							
					if (KeepCurrentDisplay)
						DisplayMonitor = DisplayMonitor + TransactionExistResults  
					else					
						DisplayMonitor = OutputReversal
				else
				if (ProcessType.Delete)
					if (OriginalTransactionId entered
					and TransactionId not entered)
						TransactionId = OriginalTransactionId				
					invoke DeleteTransaction VertexTransactionRequest
						resume on error
							WebServiceError = true
							WebServiceErrorMessage = error message	
						invoked.Login.TrustedId							= VertexConfigVersionRel.TrustedId	 				 		 		 			
						invoked.DeleteRequest.TransactionId 			= TransactionId					
						ResponseTime 		= result.ApplicationData.ResponseTimeMS

					if (KeepCurrentDisplay)
						DisplayMonitor = DisplayMonitor + TransactionExistResults  
					else
						DisplayMonitor = DisplayDate + "DeleteRequestCompleted..<ResponseTime>" + WebServiceErrorMessage 

					if (WebServiceError)
						Status = "E"
						ResultMessage = "WebserviceError"
					else
						Status = "P"
						ResultMessage = "TransactionDeleted"
				else
				if (ProcessType.Inquire)	

					if (OriginalTransactionId entered
					and TransactionId not entered)
						TransactionId = OriginalTransactionId
					invoke TransactionExist VertexTransactionRequest
						resume on error
							WebServiceError 		= true
							WebServiceErrorMessage 	= error message	



						invoked.Login.TrustedId							= VertexConfigVersionRel.TrustedId	 				 		 		 



						invoked.TransactionExistsRequest.TransactionId 	= TransactionId	




						TransactionId				= result.TransactionExistsResponse.TransactionId
						TransactionExistsIndicator 	= result.TransactionExistsResponse.TransactionExistsIndicator
						ResponseTime 				= result.ApplicationData.ResponseTimeMS

					if (WebServiceError)
						Status = "E"
						ResultMessage = "WebserviceError"
					else	
						if (TransactionExistsIndicator)	
							Status = "V"
							ResultMessage = "Successfull;RecordExistsInTaxJournal"
						else	
							Status = "X"
							ResultMessage = "TransactionNotFound"
						
					if (KeepCurrentDisplay)
						DisplayMonitor = DisplayMonitor + TransactionExistResults  
					else
						DisplayMonitor = TransactionExistResults					
				

	Actions

		Create is a Create Action
			Entrance Rules
				if (VertexTransactionMaintenance.BusinessObjectKey not entered)
					VertexTransactionMaintenance.BusinessObjectKey = DerivedBusinessObjectKey				
			Action Rules
				if (VertexTransactionMaintenance.BusinessObjectKey not entered)
					VertexTransactionMaintenance.BusinessObjectKey = DerivedBusinessObjectKey				
		Update is an Update Action
			Entrance Rules
				constraint (!Status.Processed)
					"CannotDelete;TransactionProcessed"
					
		Delete is a Delete Action


		ProcessTransaction is an Instance Action

			completion message is "ProcessTransactiontComplete..."
			Parameters
				PrmProcessType				is Alpha 1
					States
						Inquire			value is "I"	 	
						Reverse			value is "R" 		
						Delete			value is "D" 		
			Parameter Rules
			Entrance Rules
			Local Fields
			Action Rules	
				WebServiceError = false
				initialize WebServiceErrorMessage
				ProcessType 					= PrmProcessType
				include ProcessRequest
				

		ProcessTransaction2 is an Instance Action

			completion message is "ProcessTransactiontComplete..."
			Parameters
				PrmProcessType				is Alpha 1
					States
						Inquire			value is "I"	 	
						Reverse			value is "R" 		
						Delete			value is "D" 		
				PrmOriginalTransactionId	is Alpha 60 	
				PrmTransactionId			is Alpha 60 	
				PrmPostingDate				is Date	
				PrmDocumentNumber			is Alpha 50	
				PrmBOR						is BusinessObjectReference  
			Parameter Rules
				PrmProcessType
					required
				PrmOriginalTransactionId
					required
			Entrance Rules
			Local Fields
			Action Rules	
				WebServiceError = false
				initialize WebServiceErrorMessage
				ProcessType 					= PrmProcessType
				OriginalTransactionId			= PrmOriginalTransactionId
				TransactionId                   = PrmTransactionId		
				PostingDate                     = PrmPostingDate			
				DocumentNumber			        = PrmDocumentNumber		
				include ProcessRequest
		

		CallReversalRequest is an Instance Action

			completion message is "ReversalRequestComplete..."
			Parameters
				PrmOriginalTransactionId	is Alpha 60 	
				PrmTransactionId			is Alpha 60 	
				PrmPostingDate				is Date	
				PrmDocumentNumber			is Alpha 50	
				PrmProcessType					is Alpha 1
					States
						Inquire			value is "I"	 	
						Reverse			value is "R" 		
						Delete			value is "D" 		
			Parameter Rules
				PrmOriginalTransactionId
					required
			Entrance Rules
			Local Fields
			Action Rules	
				WebServiceError = false
				initialize WebServiceErrorMessage		
				invoke Reversal VertexTransactionRequest
					resume on error
						WebServiceError = true
						WebServiceErrorMessage = error message	



					invoked.Login.TrustedId							= VertexConfigVersionRel.TrustedId	 				 		 		 



					invoked.ReversalRequest.OriginalTransactionId	= PrmOriginalTransactionId						
					invoked.ReversalRequest.TransactionId 			= PrmTransactionId
					invoked.ReversalRequest.PostingDate				= PrmPostingDate
					invoked.ReversalRequest.DocumentNumber			= PrmDocumentNumber				





					OriginalTransactionId	= result.ReversalResponse.OriginalTransactionId
					TransactionId 			= result.ReversalResponse.TransactionId
					DocumentNumber 			= result.ReversalResponse.DocumentNumber
					PostingDate 			= result.ReversalResponse.PostingDate
					ResponseTime 			= result.ApplicationData.ResponseTimeMS
					
				DisplayMonitor = OutputReversal
				

		CallDeleteTaxJournalEntry is an Instance Action

			completion message is "DeleteRequestComplete..."
			Parameters
				PrmTransactionId			is Alpha 60 
			Parameter Rules
				PrmTransactionId
					required
			Entrance Rules
			Local Fields
			Action Rules	
				WebServiceError = false
				initialize WebServiceErrorMessage
				invoke DeleteTransaction VertexTransactionRequest
					resume on error
						WebServiceError = true
						WebServiceErrorMessage = error message	



					invoked.Login.TrustedId							= VertexConfigVersionRel.TrustedId	 				 		 		 



					invoked.DeleteRequest.TransactionId 			= PrmTransactionId	




					ResponseTime 		= result.ApplicationData.ResponseTimeMS

				DisplayMonitor = DisplayDate + "DeleteRequestCompleted..<ResponseTime>" + WebServiceErrorMessage 
				

		CheckIfCurrentTransExist is an Instance Action

			valid when (TransactionIdExist)
			completion message is "TransactionExistRequestComplete..."
			Entrance Rules
			Local Fields
			Action Rules
				WebServiceError = false
				initialize WebServiceErrorMessage
				invoke TransactionExist VertexTransactionRequest
					resume on error
						WebServiceError 		= true
						WebServiceErrorMessage 	= error message	



					invoked.Login.TrustedId			= VertexConfigVersionRel.TrustedId	 			 		 		 



					invoked.TransactionExistsRequest.TransactionId 	= TransactionId	




					TransactionId				= result.TransactionExistsResponse.TransactionId
					TransactionExistsIndicator 	= result.TransactionExistsResponse.TransactionExistsIndicator
					ResponseTime 				= result.ApplicationData.ResponseTimeMS

				DisplayMonitor = TransactionExistResults

		CheckIfTransactionExistNoTranId is an Instance Action

			valid when (TransactionIdNotEntered)
			completion message is "TransactionExistRequestComplete..."
			Parameters
				PrmTransactionId	is Alpha 40 
			Parameter Rules
				PrmTransactionId
					required
			Entrance Rules
			Local Fields
			Action Rules
				WebServiceError = false
				initialize WebServiceErrorMessage
				invoke TransactionExist VertexTransactionRequest
					resume on error
						WebServiceError 		= true
						WebServiceErrorMessage 	= error message	



					invoked.Login.TrustedId							= VertexConfigVersionRel.TrustedId	 				 		 		 



					invoked.TransactionExistsRequest.TransactionId 	= PrmTransactionId	




					TransactionId				= result.TransactionExistsResponse.TransactionId
					TransactionExistsIndicator 	= result.TransactionExistsResponse.TransactionExistsIndicator
					ResponseTime 				= result.ApplicationData.ResponseTimeMS

				DisplayMonitor = TransactionExistResults


		SelectVertexRecordsToProcess is a Create Action

			completion message is "RecordsSelectedToProcessComplete"
			Parameters
				PrmBusinesObjectKey		  is Alpha 100
				PrmProcessType			  is Alpha 1
					States
						Inquire			value is "I"	 	 
						Reverse			value is "R" 		 
						Delete			value is "D" 		 	
				PrmBOR					  is BusinessObjectReference		
				PrmRelatedObjectUniqueID  is Alpha 40 						
				PrmTaxEntity			  is Alpha 40						
				PrmSystemCode             is Alpha 40
				PrmCompany                is Alpha 40						
				PrmVendor                 is Alpha 40						
				PrmCustomer               is Alpha 40						
				PrmLocation               is Alpha 40
				PrmTaxCode                is Alpha 40						
				PrmTaxDate				  is Date
				PrmTaxableAmount		  is an InternationalAmount		
				PrmTaxAmount			  is an InternationalAmount	
				PrmInvoiceAmount          is an InternationalAmount	
			Parameter Rules	
			Local Fields
				LocalLineCount			  is Numeric 3
				LocalBusinessObjectKey		is Alpha 100
			Action Rules
				initialize LocalLineCount
				LocalBusinessObjectKey = "VertexTransactionMaintenenace:" + current timestamp 
				invoke Create VertexTransactionMaintenance
					invoked.VertexTransactionMaintenance.BusinessObjectKey 	= PrmBusinesObjectKey	 
					invoked.UniqueIdOfRelatedObject 	= PrmRelatedObjectUniqueID						
					invoked.RelatedObject				= PrmBOR						 				
					invoked.TaxEntity					= PrmTaxEntity
					invoked.Company						= PrmCompany
					invoked.Vendor						= PrmVendor
					invoked.Customer					= PrmCustomer
					invoked.LocationCode				= PrmLocation
					invoked.TaxAreaId					= PrmTaxCode
					invoked.SystemCode					= PrmSystemCode
					invoked.TaxPointDate				= PrmTaxDate
					invoked.TaxableAmount				= PrmTaxableAmount
					invoked.TaxAmount					= PrmTaxAmount
					invoked.InvoiceAmount				= PrmInvoiceAmount
					invoked.ProcessType					= PrmProcessType
				
				LocalLineCount += 1		
