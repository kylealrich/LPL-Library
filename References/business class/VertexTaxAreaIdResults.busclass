VertexTaxAreaIdResults is a BusinessClass
    owned by tx	  
	prefix is VtxIr	
	
    Ontology
        symbolic key is VertexTaxAreaIdResults
		
	Patterns
		implements CRUD
       	disable AuditIndex
    	disable Auditing		
        disable EffectiveDated
        disable UniqueID
		disable AsOfDateProcessing
		implements ContextualParent
		
	Persistent Fields
		TaxAreaId 				is like TaxCode 
		AsOfDate 				is Date			 
		ConfidenceIndicator 	is Numeric 3	 
		Selected				is Boolean
		RelatedObjectReference	is BusinessObjectReference
		RelatedSystem			is like GeneralLedgerSystemCode 
		WebServiceError 		is Boolean
		WebServiceErrorMessage 	is Text
		EntityTaxCodeDefault 	is like TaxCode		
		TaxEntityUsedInLookup 	is like TaxEntity	

    Context Fields
		AsOfDateRange			is a DateRange
				
	Conditions
		ConfIndUnderSpecifiedLimit
			restricted
			when (ConfidenceIndicator < VertexConfigVersionRel.ConfidenceIndicatorLimit)	
			
		



			
		InventoryLocationBusclass
			restricted
			when (DerivedRelatedObject = "InventoryLocation   ")	

		TaxEntityUsedInLookupEntered						
			restricted
			when (TaxEntityUsedInLookup entered)
		DefaultTaxCodeEntered						
			restricted
			when (EntityTaxCodeDefault entered)

		TaxEntityExist										
			restricted
			when (TaxEntityUsedInLookup entered
			and   TaxEntityRel exist)
		TaxEntityDoesNotExist										
			restricted
			when (TaxEntityUsedInLookup entered
			and   TaxEntityRel not exist)
		DefaultTaxCodeExist										
			restricted
			when (EntityTaxCodeDefault entered
			and   DefaultTaxCodeRel exist)
		DefaultTaxCodeDoesNotExist										
			restricted
			when (EntityTaxCodeDefault entered
			and   DefaultTaxCodeRel not exist)								
		TaxEntityUsesTaxCodeAccounts							
			restricted
			when (TaxEntityUsedInLookup entered

			and   TaxEntityRel.UseTaxCodeAccounts)
		TaxEntityDoesNotUseTaxCodeAccounts							
			restricted
			when (TaxEntityUsedInLookup entered
			and   TaxEntityRel exist
			and  !TaxEntityRel.UseTaxCodeAccounts)			
		TaxEntityEnteredButNoTaxCode
			restricted
			when (EntityTaxCodeDefault not entered
			and   TaxEntityUsedInLookup entered)
		EntityTaxCodeDefaultEnteredButNoTaxEntity
			restricted
			when (EntityTaxCodeDefault entered
			and   TaxEntityUsedInLookup not entered)	
		DefaultEntityTaxCodeNotExist
			restricted
			when (TaxEntityUsedInLookup entered
			and   EntityTaxCodeDefault entered
			and   DefaultEntityTaxCodeRel not exist)	
		NewEntityTaxCodeDoesNotExist
			restricted
			when (TaxEntityUsedInLookup entered
			and   EntityTaxCodeDefault entered
			and   DefaultEntityTaxCodeRel exist
			and   NewEntityTaxCodeSelectedRel not exist)
		NewEntityTaxCodeAlreadyExist
			restricted
			when (TaxEntityUsedInLookup entered
			and   EntityTaxCodeDefault entered
			and   NewEntityTaxCodeSelectedRel exist)

		WithinAsOfDateRange
			restricted
			when (AsOfDateRange not entered
			or	 (AsOfDateRange entered
			and	  AsOfDate within AsOfDateRange)
			and  (AsOfDateYear = AsOfDate year
			or    AsOfDateYear not entered))
																			
	Derived Fields 
		DefaultTaxCodesEntered is a DerivedField
			type is Boolean
			if (instance count of AnyEntityTaxCodeDefaultEnteredRel > 0)
				return true
			return false
			
		MultipleTaxAreaIdsExistSw is a DerivedField
			type is Boolean
			restricted
			if (ConfidenceIndicator > 1)
				return true
			else
				return false	

    	TaxAreaIdCardViewDisplay				is a LabelField
    		restricted
    		"TaxAreaId:<TaxAreaId>"
    	ConfidenceIndCardViewDisplay			is a LabelField
    		"ConfidenceIndicator:<ConfidenceIndicator>"

		NbrOfSelectedRecords is a DerivedField			
			type is Numeric 10	
			restricted	
			return (instance count of CheckNbrOfSelectedRel)

		DerivedRelatedObjectSize is a DerivedField
			type is Numeric 3
			restricted
			return RelatedObjectReference size
			
		DerivedRelatedBusinessObject is a DerivedField
			type is Alpha 20
			restricted
			return RelatedObjectReference												
				
		DerivedTaxCodeDescription is a DerivedField
			type is like Description	 
			restricted
			if (LocalCity entered
			and LocalState entered
			and LocalZip entered)
				return LocalCity + ", " + LocalState + " " + LocalZip
			else		
				return LocalCountry + ";" + LocalCity + ", " + LocalState + " " + LocalZip

		DerivedRelatedObject is a DerivedField
			type is Alpha 20
			restricted
			return com.lawson.apps.sharedfinance.base.StringUtils.trimLeadingSpaces(DerivedRelatedBusinessObject)

		DerivedDisplayTaxEntity is a DerivedField
			type is MessageField


			if (TaxEntityUsedInLookup entered)
				return "TaxEntity"

			
			return blank
				

		DisplayTaxEntityLabel is a LabelField

			"TaxEntity"

		DerivedDisplayDefaultTaxCode is a DerivedField
			type is MessageField

			if (DefaultTaxCodesEntered)

				return DisplayDefaultTaxCodeLabel
			
			return blank
				

		DisplayDefaultTaxCodeLabel is a LabelField

			"EntityTaxCodeDefault"

		DisplayTaxEntityTestLabel is a LabelField

			"TaxEntityTestlabel"
						
	Transient Fields
		DisplayErrorMessage is a CommentText
			derive value from WebServiceErrorMessage
				
		RelatedObject is Alpha 20
			derive value from DerivedRelatedObject	

        TransientRelatedObjectIs        is Alpha 20						 
            States
                Vendor 					value is "Vendor              "
                VendorLocation			value is "VendorLocation      "
                Customer	 			value is "Customer            "
                CustomerShipTo 			value is "CustomerShipTo      "
                InventoryLocation 		value is "InventoryLocation   "
                BillingProcessLevel 	value is "BillingProcessLevel "
                PayablesProcessLevel	value is "PayablesProcessLevel"	
                RequestingLocation 		value is "RequestingLocation  "	
			derive value from DerivedRelatedObject
			


		AsOfDateYear is a Year
			derive value from AsOfDate year
						
	Local Fields
        LocalRelatedObjectIs           is Alpha 20
            States
                Vendor 					value is "Vendor              "
                VendorLocation			value is "VendorLocation      "
                Customer	 			value is "Customer            "
                CustomerShipTo 			value is "CustomerShipTo      "
                InventoryLocation 		value is "InventoryLocation   "
                BillingProcessLevel 	value is "BillingProcessLevel "
                TaxEntity 				value is "TaxEntity           "
                ProjectServiceLocation	value is "ProjectServiceLocati"
                PayablesProcessLevel	value is "PayablesProcessLevel"	
                RequestingLocation 		value is "RequestingLocation  "	


		LocalTaxCode 					is a TaxCode
		LocalCountry					is a Country
		LocalCity						is Alpha 47	
		LocalState						is a StateProvince
		LocalZip						is a PostalCode
		LocalCounty						is a County       		
				         									

 	Sets

		ByTaxAreaId


			Sort Order
				VertexConfig
				VertexTaxAreaIdResults.LookupKey 			 
	            VertexTaxAreaIdResults.ResponseBusclassKey  	 
				TaxAreaId			 
	            VertexTaxAreaIdResults.Sequence 									 

		ByRelatedObjectReference
			Sort Order
				VertexConfig
				RelatedObjectReference
				VertexTaxAreaIdResults.LookupKey 			 
	            VertexTaxAreaIdResults.ResponseBusclassKey  	 
				ConfidenceIndicator	descending
				TaxAreaId			 
	            VertexTaxAreaIdResults.Sequence 		















																	
    Relations
 
    	RelatedObjectIsVendorRel
			one-to-many relation to Vendor
			Field Mapping uses symbolic key
				related.VendorGroup  					= VertexConfig
          	Instance Selection
				where (related.ObjectReference 			= RelatedObjectReference)

    	RelatedObjectIsVendorLocationRel				 
			one-to-many relation to VendorLocation
			Field Mapping uses symbolic key
				related.VendorGroup  					= VertexConfig
          	Instance Selection
				where (related.ObjectReference 			= RelatedObjectReference)

   		RelatedObjectIsCustomerShipToRel
			one-to-many relation to CustomerShipTo
			Field Mapping uses symbolic key
          	Instance Selection
				where (related.ObjectReference 			= RelatedObjectReference
				and    related.TransientFEG				= VertexConfig)

    	RelatedObjectIsBillingProcessLevelRel
			one-to-many relation to BillingProcessLevel
			Field Mapping uses symbolic key
         	Instance Selection
				where (related.ObjectReference 			= RelatedObjectReference
				and    related.TransientFEG				= VertexConfig)					

    	RelatedObjectIsPayablesProcessLevelRel	
			one-to-many relation to PayablesProcessLevel
			Field Mapping uses symbolic key
         	Instance Selection
				where (related.ObjectReference 			= RelatedObjectReference
				and    related.TransientFEG				= VertexConfig)

    	RelatedObjectIsProjectServiceLocationRel
			one-to-many relation to ProjectServiceLocation
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= VertexConfig
         	Instance Selection
				where (related.ObjectReference 			= RelatedObjectReference)
				
    	RelatedObjectIsInventoryLocationRel
			one-to-many relation to InventoryLocation
			Field Mapping uses symbolic key
         	Instance Selection
				where (related.TransientFEG				= VertexConfig
				and	   related.ObjectReference 			= RelatedObjectReference)

    	RelatedObjectIsRequestingLocationRel	
			one-to-many relation to RequestingLocation
			Field Mapping uses symbolic key
         	Instance Selection
				where (related.TransientFEG				= VertexConfig
				and	   related.ObjectReference 			= RelatedObjectReference)

    	RelatedObjectIsTaxEntityRel
			one-to-many relation to TaxEntity
			Field Mapping uses symbolic key
         	Instance Selection
				where (related.FinanceEnterpriseGroup	= VertexConfig		
				and    related.ObjectReference 			= RelatedObjectReference)
																
   		TaxAreaIdResults1Rel
			one-to-many relation to VertexTaxAreaIdResults
			Field Mapping uses ByTaxAreaId
				related.VertexConfig								= VertexConfig	
				related.VertexTaxAreaIdResults.LookupKey  			= VertexTaxAreaIdResults.LookupKey
            Instance Selection
				where (related.VertexTaxAreaIdResults.ResponseBusclassKey 	= VertexTaxAreaIdResults.ResponseBusclassKey
				and    related.VertexTaxAreaIdResults.Sequence 		= VertexTaxAreaIdResults.Sequence)



   		CheckNbrOfSelectedRel
			one-to-many relation to VertexTaxAreaIdResults
			Field Mapping uses ByTaxAreaId
				related.VertexConfig								= VertexConfig	
				related.VertexTaxAreaIdResults.LookupKey  			= VertexTaxAreaIdResults.LookupKey
				related.VertexTaxAreaIdResults.ResponseBusclassKey 	= VertexTaxAreaIdResults.ResponseBusclassKey

            Instance Selection

				where  (related.Selected 							= true)	 
				    



    	VertexTaxInquiryJurisdictionResultsRel
			one-to-many relation to VertexTaxAreaIdJurisdiction

			Field Mapping uses ByTaxAreaId
				related.VertexConfig											= VertexConfig	
            Instance Selection
				where (related.VertexTaxAreaIdJurisdiction.LookupKey  			= VertexTaxAreaIdResults.LookupKey
				and    related.VertexTaxAreaIdJurisdiction.ResponseBusclassKey 	= VertexTaxAreaIdResults.ResponseBusclassKey

				and	   related.TaxAreaId										= TaxAreaId)	 
				
    	VertexTaxAreaIdPostalAddressResultsRel
			one-to-many relation to VertexTaxAreaIdPostalAddress

			Field Mapping uses ByTaxAreaId
				related.VertexConfig											= VertexConfig
				related.VertexTaxAreaIdPostalAddress.LookupKey  				= VertexTaxAreaIdResults.LookupKey
				related.VertexTaxAreaIdPostalAddress.ResponseBusclassKey 		= VertexTaxAreaIdResults.ResponseBusclassKey	
            Instance Selection

				where (related.TaxAreaId										= TaxAreaId)	 	

   		VertexTaxInquiryStatusResultsRel
			one-to-many relation to VertexTaxAreaIdStatusResults
			Field Mapping uses ByTaxAreaId
				related.VertexConfig											= VertexConfig	
				related.VertexTaxAreaIdStatusResults.LookupKey  				= VertexTaxAreaIdResults.LookupKey
				related.VertexTaxAreaIdStatusResults.ResponseBusclassKey 		= VertexTaxAreaIdResults.ResponseBusclassKey	
            Instance Selection
				where (related.TaxAreaId										= TaxAreaId)	 	




    	VertexTaxInquiryJurisdictionResultsRel2
			one-to-many relation to VertexTaxAreaIdJurisdiction

			Field Mapping uses ByTaxAreaId
				related.VertexConfig											= VertexConfig
				related.VertexTaxAreaIdJurisdiction.LookupKey					= VertexTaxAreaIdResults.LookupKey					
				related.VertexTaxAreaIdJurisdiction.ResponseBusclassKey 		= VertexTaxAreaIdResults.ResponseBusclassKey
            Instance Selection
				where (related.TaxAreaId										= TaxAreaId)	 

   		VertexTaxInquiryStatusResultsRel2
			one-to-many relation to VertexTaxAreaIdStatusResults

			Field Mapping uses ByTaxAreaId
				related.VertexConfig											= VertexConfig	
			Instance Selection
				where (related.VertexTaxAreaIdStatusResults.LookupKey  			= VertexTaxAreaIdResults.LookupKey
				and    related.VertexTaxAreaIdStatusResults.ResponseBusclassKey	= VertexTaxAreaIdResults.ResponseBusclassKey	 
				and	   related.TaxAreaId										= TaxAreaId)	 
								
    	VertexTaxAreaIdPostalAddressResultsRel2
			one-to-many relation to VertexTaxAreaIdPostalAddress

			Field Mapping uses ByTaxAreaId
				related.VertexConfig											= VertexConfig
				related.VertexTaxAreaIdPostalAddress.LookupKey					= VertexTaxAreaIdResults.LookupKey					
				related.VertexTaxAreaIdPostalAddress.ResponseBusclassKey 		= VertexTaxAreaIdResults.ResponseBusclassKey					
            Instance Selection

				where  (related.TaxAreaId										= TaxAreaId)	 	

		VertexLookupResultsRel
			one-to-many relation to VertexLookupResults
			Field Mapping uses ByRelatedObjectReference	 
				related.VertexConfig											= VertexConfig
			Instance Selection	
				where (related.RelatedObjectReference							= RelatedObjectReference)


        DefaultEntityTaxCodeRel	 
            one-to-one relation to EntityTaxCode
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup		= VertexConfig 				
                related.TaxEntity 					= TaxEntityUsedInLookup 	 	
                related.TaxCode						= EntityTaxCodeDefault  
                
        NewEntityTaxCodeRel	 
            one-to-one relation to EntityTaxCode
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup		= VertexConfig 				
                related.TaxEntity 					= TaxEntityUsedInLookup 	 	
                related.TaxCode						= LocalTaxCode			 

        NewEntityTaxCodeSelectedRel	 
            one-to-one relation to EntityTaxCode
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup		= VertexConfig 				
                related.TaxEntity 					= TaxEntityUsedInLookup 	 	
                related.TaxCode						= TaxAreaId		
                
    	TaxEntityRel
			one-to-one relation to TaxEntity
			valid when (TaxEntityUsedInLookupEntered)							
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		= VertexConfig		
				related.TaxEntity	 				= TaxEntityUsedInLookup
   		DefaultTaxCodeRel
			one-to-one relation to TaxCode
			valid when (DefaultTaxCodeEntered)							
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		= VertexConfig		
				related.TaxCode	 					= EntityTaxCodeDefault
				
		AnyEntityTaxCodeDefaultEnteredRel
			one-to-many relation to VertexTaxAreaIdResults
			Field Mapping uses ByTaxAreaId
				related.VertexConfig								= VertexConfig	
				related.VertexTaxAreaIdResults.LookupKey  			= VertexTaxAreaIdResults.LookupKey
				related.VertexTaxAreaIdResults.ResponseBusclassKey 	= VertexTaxAreaIdResults.ResponseBusclassKey
            Instance Selection
				where  (related.EntityTaxCodeDefault entered)	 
									


		VertexConfigVersionRel
        	one-to-many relation to VertexConfigVersion
        	Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup						= VertexConfig
			Instance Selection
				where (related.VertexConfigVersion.Version 			= VertexConfig.DefaultVersion.Version
				and	   related.VertexConfigVersion.ServiceRelease 	= VertexConfig.DefaultVersion.ServiceRelease
				and	   related.VertexConfigVersion.ServerName 		= VertexConfig.DefaultVersion.ServerName)
										                
	Rule Blocks
		CreateTaxCode

			invoke Create TaxCode	 
				invoked.FinanceEnterpriseGroup 	= VertexConfig	 
				invoked.TaxCode					= LocalTaxCode	
				invoked.TaxType					= "S"
				invoked.Description				= DerivedTaxCodeDescription	









		CreateEntityTaxCode





			if (TaxEntityRel.UseTaxCodeAccounts
			and TaxEntityUsedInLookup entered
			and EntityTaxCodeDefault entered)

				if (NewEntityTaxCodeRel not exist
				and DefaultEntityTaxCodeRel exist)

					invoke Create EntityTaxCode				 
						fill in fields from DefaultEntityTaxCodeRel
						invoked.TaxEntity	= TaxEntityUsedInLookup 	 		
						invoked.TaxCode		= LocalTaxCode
						invoked.Status 		= 1	




	Actions

		Create is a Create Action
																	
		Update is an Update Action
			Entrance Rules

 			Action Rules











		UpdateAndBypassRules is an Update Action
			restricted
			bypass field rules	
			
		Delete is a Delete Action
			Entrance Rules
		   		invoke Delete VertexTaxInquiryJurisdictionResultsRel
		    	invoke Delete VertexTaxAreaIdPostalAddressResultsRel
		   		invoke Delete VertexTaxInquiryStatusResultsRel		
		   		
		Purge is a Purge Action		
			restricted
			Entrance Rules
		   		invoke Delete VertexTaxInquiryJurisdictionResultsRel
		    	invoke Delete VertexTaxAreaIdPostalAddressResultsRel
		   		invoke Delete VertexTaxInquiryStatusResultsRel			

			

		UpdateTaxCode is an Instance Action			 

			Parameters
			Local Fields






				
			Action Rules


				LocalRelatedObjectIs = com.lawson.apps.sharedfinance.base.StringUtils.trimLeadingSpaces(DerivedRelatedBusinessObject)	 


				constraint (LocalRelatedObjectIs not = "InventoryLocation")
					"InvalidActionForToUpdateTaxCodeFor<LocalRelatedObjectIs>;Use_\Update\Inventory\Tax\CodesActionToUpdate_\Inventory\Location"	 
					
				constraint (LocalRelatedObjectIs.Vendor
				or			LocalRelatedObjectIs.VendorLocation
				or			LocalRelatedObjectIs.RequestingLocation		
				or			LocalRelatedObjectIs.CustomerShipTo
				or			LocalRelatedObjectIs.BillingProcessLevel
				or			LocalRelatedObjectIs.PayablesProcessLevel	

				or			LocalRelatedObjectIs.TaxEntity
				or          LocalRelatedObjectIs.ProjectServiceLocation)
	      			"BusnessObject<LocalRelatedObjectIs>NotSetupForThisAction" 


				if (TaxEntityUsedInLookup entered)					
					constraint (TaxEntityExist)						
						"TaxEntityDoesNotExist"						


				if (EntityTaxCodeDefault entered)					
					constraint (DefaultEntityTaxCodeRel exist)		
						"DefaultEntityTaxCodeDoesNotExist"			
																
				if (VertexTaxAreaIdPostalAddressResultsRel exist)
					LocalCountry	= first VertexTaxAreaIdPostalAddressResultsRel.Country
					LocalCity		= first VertexTaxAreaIdPostalAddressResultsRel.City
					LocalState 		= first VertexTaxAreaIdPostalAddressResultsRel.MainDivision
					LocalZip 		= first VertexTaxAreaIdPostalAddressResultsRel.PostalCode
					LocalCounty		= first VertexTaxAreaIdPostalAddressResultsRel.SubDivision
				

				LocalTaxCode			= TaxAreaId	
				if (LocalTaxCode not exists												
				and LocalTaxCode entered)							
					include CreateTaxCode










				if (TaxEntityRel.UseTaxCodeAccounts)
					if (EntityTaxCodeDefault entered
					and TaxEntityUsedInLookup entered
					and NewEntityTaxCodeRel not exist)
						include CreateEntityTaxCode





				if (LocalRelatedObjectIs.VendorLocation
				and RelatedObjectIsVendorLocationRel exist)
						invoke Update RelatedObjectIsVendorLocationRel						 
							invoked.TaxCode = TaxAreaId										 

						invoke UpdateTaxCodeAndAddress RelatedObjectIsVendorLocationRel	 

							invoked.PrmZip		= LocalZip
							invoked.PrmCounty	= LocalCounty									



				else
				if (LocalRelatedObjectIs.Vendor)
					if (RelatedObjectIsVendorRel exist)	
						invoke Update RelatedObjectIsVendorRel
							invoked.TaxCode = TaxAreaId						 
						invoke UpdateTaxCodeAndAddress RelatedObjectIsVendorRel 
							invoked.PrmTaxCode 	= TaxAreaId		 
							invoked.PrmZip		= LocalZip
							invoked.PrmCounty	= LocalCounty



				else
				if (LocalRelatedObjectIs.CustomerShipTo
				and RelatedObjectIsCustomerShipToRel exist)	



					invoke UpdateTaxCodeAndAddress RelatedObjectIsCustomerShipToRel	
						invoked.PrmTaxCode 	= TaxAreaId
						invoked.PrmZip		= LocalZip
						invoked.PrmCounty	= LocalCounty		



				else
				if (LocalRelatedObjectIs.BillingProcessLevel
				and RelatedObjectIsBillingProcessLevelRel exist)	
					invoke UpdateTaxCodeAndAddress RelatedObjectIsBillingProcessLevelRel	
						invoked.PrmTaxCode 	= TaxAreaId
						invoked.PrmZip		= LocalZip
						invoked.PrmCounty	= LocalCounty		



				else
				if (LocalRelatedObjectIs.PayablesProcessLevel
				and RelatedObjectIsPayablesProcessLevelRel exist)	
					invoke UpdateTaxCodeAndAddress RelatedObjectIsPayablesProcessLevelRel	
						invoked.PrmTaxCode 	= TaxAreaId
						invoked.PrmZip		= LocalZip
						invoked.PrmCounty	= LocalCounty



				else
				if (LocalRelatedObjectIs.ProjectServiceLocation
				and RelatedObjectIsProjectServiceLocationRel exist)	
					invoke UpdateTaxCodeAndAddress RelatedObjectIsProjectServiceLocationRel	
						invoked.PrmTaxCode 	= TaxAreaId
						invoked.PrmZip		= LocalZip
						invoked.PrmCounty	= LocalCounty	



				else
				if (LocalRelatedObjectIs.RequestingLocation
				and RelatedObjectIsRequestingLocationRel exist)	
					invoke UpdateTaxCodeAndAddress RelatedObjectIsRequestingLocationRel	
						invoked.PrmTaxCode 	= TaxAreaId
						invoked.PrmZip		= LocalZip
						invoked.PrmCounty	= LocalCounty






























				if (LocalRelatedObjectIs.TaxEntity
				and RelatedObjectIsTaxEntityRel exist)	
					invoke Update RelatedObjectIsTaxEntityRel	
						invoked.LastVertexLookupTaxAreaId				= TaxAreaId
						invoked.ReturnedTaxAreaId						= TaxAreaId
						if (invoked.LastVertexLookupPostalAddress not entered)
							invoked.LastVertexLookupPostalAddress.Country 						= LocalCountry
							invoked.LastVertexLookupPostalAddress.DeliveryAddress.AddressLine1	= "1"
							invoked.LastVertexLookupPostalAddress.Municipality					= LocalCity
							invoked.LastVertexLookupPostalAddress.StateProvince					= LocalState
							invoked.LastVertexLookupPostalAddress.PostalCode					= LocalZip
							invoked.LastVertexLookupPostalAddress.County						= LocalCounty							
						
						if (invoked.LastVertexLookupPostalAddress.Country not entered)
							invoked.LastVertexLookupPostalAddress.Country = LocalCountry
						
						if (LocalCity entered)
							if (invoked.LastVertexLookupPostalAddress.Municipality not entered
							or  invoked.LastVertexLookupPostalAddress.Municipality entered
							and invoked.LastVertexLookupPostalAddress.Municipality	!= LocalCity)
								invoked.LastVertexLookupPostalAddress.Municipality	 = LocalCity
						

						if (invoked.LastVertexLookupPostalAddress.PostalCode not entered
						or  invoked.LastVertexLookupPostalAddress.PostalCode entered
						and invoked.LastVertexLookupPostalAddress.PostalCode   != LocalZip)

							invoked.LastVertexLookupPostalAddress.PostalCode	= LocalZip
						
						if (invoked.LastVertexLookupPostalAddress.County not entered
						or (invoked.LastVertexLookupPostalAddress.County entered
						and invoked.LastVertexLookupPostalAddress.County   	   != LocalCounty))						
							invoked.LastVertexLookupPostalAddress.County  		= LocalCounty
							
						invoked.TaxCalcAndLookup								= true	


		UpdateInventoryLocationTaxCodes is an Instance Action			 

			valid when (TransientRelatedObjectIs.InventoryLocation)
			Parameters
				ItemLocationType			is AlphaUpper 1	
					States
						SellTaxCodeOnly 		value is "S"
						PurchasingTaxCodeOnly	value is "P"
			Local Fields
				
			Action Rules
				LocalRelatedObjectIs = com.lawson.apps.sharedfinance.base.StringUtils.trimLeadingSpaces(DerivedRelatedBusinessObject)	 


				constraint (LocalRelatedObjectIs.InventoryLocation)
	      			"ThisActionIsOnlyValidForAn_\Inventory\Location" 

				if (VertexTaxAreaIdPostalAddressResultsRel exist)
					LocalCountry	= first VertexTaxAreaIdPostalAddressResultsRel.Country
					LocalCity		= first VertexTaxAreaIdPostalAddressResultsRel.City
					LocalState 		= first VertexTaxAreaIdPostalAddressResultsRel.MainDivision
					LocalZip 		= first VertexTaxAreaIdPostalAddressResultsRel.PostalCode
					LocalCounty		= first VertexTaxAreaIdPostalAddressResultsRel.SubDivision
				

				LocalTaxCode	= TaxAreaId	

				if (LocalTaxCode not exists)		
					include CreateTaxCode													 								 













				if (LocalRelatedObjectIs.InventoryLocation)
					if (RelatedObjectIsInventoryLocationRel exist)	
						invoke UpdateTaxCodeAndAddress RelatedObjectIsInventoryLocationRel
							invoked.PrmItemLocationType	= ItemLocationType
							invoked.PrmTaxCode 			= TaxAreaId	
							invoked.PrmZip  			= LocalZip
							invoked.PrmCounty			= LocalCounty															 










		PurgeVertexTaxAreaIdResults is a Set Action							
			completion message is "PurgeProcessComplete:<RecordCount>...RecordsProcessed"
			run in background		 
			Parameters 
				PrmVertexConfig		is a VertexConfig
					default label is "FinanceEnterpriseGroup"
				PrmAsOfDateRange is a DateRange
					default label is "AsOfDateRange"
				PrmAsOfDateYear	is a Year
					default label is "AsOfDateYear"	
				PrmCallingModuleKey is Alpha 20
					default label is "Module"					
				PrmLookupKey is Alpha 100					 
					default label is "LookupKey"					
			Parameter Rules
				PrmVertexConfig  
					initial value is actor.context.FinanceEnterpriseGroup	
					required						
			Local Fields
				RecordCount	is Numeric 10				
			Instance Selection			
				where (VertexConfig = PrmVertexConfig			 
				and   (AsOfDate within AsOfDateRange						 
				or     AsOfDateRange not entered)				


				and   (DerivedRelatedObject = PrmCallingModuleKey						 	
				or     PrmCallingModuleKey not entered) 					
			    and   (PrmAsOfDateYear = AsOfDate year					      		 
			    or     PrmAsOfDateYear not entered))				 
			Sort Order

			Accumulators



				
			Action Rules								
				Empty Set Rules
				
				Set Rules
					Entrance Rules

					Exit Rules
						
				Instance Rules
					increment RecordCount				
					invoke Purge VertexTaxAreaIdResults


														
