WorkApplicationCloseC is a BusinessClass
	owned by ar
	prefix is r190c

	Ontology
		symbolic key is WorkApplicationCloseC

	Patterns
		disable AuditIndex
		disable Auditing
		disable EffectiveDated
		disable DataTranslations
		disable StaticTranslations

	Persistent Fields
		FinanceEnterpriseGroup	is like FinanceEnterpriseGroup
		ApplicationCloseResult	is like ApplicationCloseResult
		RecKey					is a AR190War190cRecKeyGroup
		TranAppliedAmount		is like InternationalAmount
		BaseAppliedAmount		is like InternationalAmount
		CrAppAmt				is like InternationalAmount
		ArCode					is like ReceivableGeneralLedgerCode
		DocumentNbr				is like DocumentNumber
		Customer				is like Customer
		ProcessLevel			is like ReceivableProcessLevel
		BatchNbr				is like BatchNumber
		AraOprCode				is like ReceivableOperator
		DepInstCode				is like BankTransactionCode
		BankInstCode			is like BankTransactionCode
		ProgramSequence

	Derived Fields
		OffsetCredMsg is a MessageField
			restricted
			"OffsetCreditAppliedOn"

	Relations
		ARCompanyRel
			one-to-one relation to ReceivableCompany
			Field Mapping uses symbolic key
				related.Company					 = RecKey.CrCompany

		GLCompanyRel
			one-to-one relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
				related.Company					 = RecKey.Company

		ARCodeRel
			one-to-one relation to ReceivableGeneralLedgerCode
			Field Mapping uses symbolic key
				related.Company						 = RecKey.CrCompany
				related.ReceivableGeneralLedgerCode	 = RecKey.OffsetCode

		CloseDistributionRel
			one-to-many relation to ReceivableGLDistribution
			Field Mapping uses ByApplicationCloseResult
				related.FinanceEnterpriseGroup		 = FinanceEnterpriseGroup
				related.ApplicationCloseResult		 = ApplicationCloseResult

	Sets

		RecKey
			indexed
			no duplicates
			Sort Order
				FinanceEnterpriseGroup
				ApplicationCloseResult
				RecKey

	Actions

		Create is a Create Action
			restricted

		Update is an Update Action
			restricted

		FastUpdate is an Update Action
			restricted
			bypass field rules

		Delete is a Delete Action
			restricted

		FastDelete is a Delete Action
			restricted
			bypass relational integrity rules

		Process is a Set Action
			restricted

			Parameters
				PrmFinanceEnterpriseGroup		is a FinanceEnterpriseGroup
				PrmApplicationCloseResult		is a ApplicationCloseResult
				PrmCreateDate					is TimeStamp

			Instance Selection
				where (FinanceEnterpriseGroup	 = PrmFinanceEnterpriseGroup
				and	ApplicationCloseResult		 = PrmApplicationCloseResult)

			Local Fields



				
			Action Rules
				Instance Rules

					display "WorkC:<RecKey.Invoice>"

					invoke CreateFromApplicationClose ReceivableGLDistribution
						invoked.FinanceEnterpriseGroup							= FinanceEnterpriseGroup
						invoked.ReceivableGLDistribution.ProgramSequence		= ProgramSequence
						invoked.LastDistributionSequence						= 1
						invoked.CreateDate										= PrmCreateDate

						invoked.ReceivableCompanyGroup.GlCompany				= RecKey.CrCompany
						invoked.ReceivableCompanyDataGroup.TransactionCompany	= RecKey.Company
						invoked.ReceivableCompanyDataGroup.ReceivableProcessLevel	= ProcessLevel

						invoked.GeneralLedgerAccount							= ARCodeRel.DistributionAccount
						invoked.GeneralLedgerDate								= RecKey.GlDate
						invoked.TransactionDate									= RecKey.GlDate
						invoked.ReceivableCompanyDataGroup.Customer				= Customer

						invoked.Origin											= RecKey.AppSource
						invoked.Status											= 2
						invoked.OriginalCurrency								= RecKey.AppCurrCd

						if  (RecKey.TransType = "C"
						or   RecKey.TransType = "P")
							invoked.DistributionAmount.CurrencyAmount							= TranAppliedAmount * -1
							invoked.DistributionAmount.FunctionalAmount.EnteredCurrencyAmount	= BaseAppliedAmount * -1
							invoked.ToCompanyBaseAmount							= CrAppAmt * -1
						else
							invoked.DistributionAmount.CurrencyAmount							= TranAppliedAmount
							invoked.DistributionAmount.FunctionalAmount.EnteredCurrencyAmount	= BaseAppliedAmount
							invoked.ToCompanyBaseAmount							= CrAppAmt


						invoked.Description										= OffsetCredMsg + " " + PrmCreateDate
						invoked.TransType										= RecKey.TransType
						invoked.Invoice											= RecKey.Invoice
						invoked.BatchNumber										= BatchNbr
						invoked.DocumentNumber									= DocumentNbr

						invoked.AuditSummaryIndicator							= "03"	

						if  (ARCompanyRel.DetailGLTransPerApplication = "Y")
							invoked.AccumulationType							= "D"
						else
							invoked.AccumulationType							= "S"
							invoked.ReceivableApplicationOjectID				= ProgramSequence

						invoked.ApplicationCloseResult							= PrmApplicationCloseResult

					invoke FastDelete

