LCalcImportQueue is a BusinessClass
    owned by la
    prefix is CAIQ

    Ontology
        symbolic key is LCalcImportQueue

    Patterns
        implements CRUD
        implements CreateStamp
        disable Auditing
        disable EffectiveDated

    Persistent Fields   
        EnterpriseGroup
        BusinessClassName
        LastSequence			is Numeric size 6
        
        ProcessStatus           is Numeric size 2
            States
                New                 value is 0
                Pending             value is 10
                Processing          value is 20
                Complete            value is 30
                RolledBack          value is 40
                Failed              value is 90
           
    Conditions
        IsNew
        	default label is "New"
            when (ProcessStatus.New) 
        IsPending
        	default label is "Pending"
            when (ProcessStatus.Pending)
        IsComplete
        	default label is "Complete"
            when (ProcessStatus.Complete)
        IsFailed
        	default label is "Failed"
            when (ProcessStatus.Failed)
        IsRolledBack
        	default label is "Rollback"
        	when (ProcessStatus.RolledBack)
    
	Relations
		NewChildSet is an LCalcImportQueueEntry set
			Instance Selection 
				where (related.IsNew)
				
		PendingChildSet is an LCalcImportQueueEntry set
			Instance Selection 
				where (related.IsPending)
		
		FailedChildSet is an LCalcImportQueueEntry set
			Instance Selection 
				where (related.IsFailed)
		
		CompleteChildSet is an LCalcImportQueueEntry set
			Instance Selection 
				where (related.IsComplete)
		
    Sets
    
    	ByCreateStamp
    		indexed
    		Sort Order
    			create stamp
    			LCalcImportQueue
    			
    	ByNewStamp
    		indexed
    		Sort Order
    			create stamp
    			LCalcImportQueue
    		Instance Selection
    			where (IsNew)
    			
        ByPendingStamp
            indexed
            Sort Order
                create stamp
                LCalcImportQueue
            Instance Selection
                where (IsPending)

        ByCompleteStamp
            indexed
            Sort Order
                create stamp
                LCalcImportQueue
            Instance Selection
                where (IsComplete)

	StateCycles
	
		QueueLifeCycle is a StateCycle
			state field is ProcessStatus
			initial state is New
			
			New is a State

				Create is a Create Action
					restricted
				
				MakePending is an Instance Action

					Action Rules
						make transition to Pending
						
				MakeRolledBack is an Instance Action

					Action Rules
						make transition to RolledBack
						
			Pending is a State
			
				MakeProcessing is an Instance Action

					Action Rules
						make transition to Processing

			Processing is a State
				
				MakeComplete is an Instance Action

					Action Rules
						make transition to Complete
						
				MakeFailed is an Instance Action

					Action Rules
						make transition to Failed
						
				ResetPending is an Instance Action

					Action Rules
						for each FailedChildSet
							invoke Failed.ResetToPending each
						make transition to Pending
						
			Complete is a State
				Delete is a Delete Action
				Purge is a Purge Action
			
			Failed is a State
				Delete is a Delete Action
				Purge is a Purge Action
				
				ResetPending is an Instance Action

					Action Rules
						make transition to Pending
						
			RolledBack is a State
				Delete is a Delete Action
				Purge is a Purge Action
						
				
				
