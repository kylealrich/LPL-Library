TrueCostWeightDataInterface is a BusinessClass
	owned by truecost
	
	prefix is TCWDU
	default label is "True\CostWeightDataInterfaceMaintenance"
	Ontology
		symbolic key is TrueCostWeightDataInterface
		
	Patterns
		disable Auditing
		disable EffectiveDated
		disable AsOfDateProcessing
		
	Persistent Fields
		
		TrueCostWeight						is Alpha 25
		AccountingEntity					is like AccountingEntity
		Department							is Alpha 15
		CostObject							is Alpha 15
        Weight								is Decimal 19.4
        	default label is "Value"
        StartDate							is Date
        ErrorDescription					is Alpha 60
		
	Local Fields
		LocalLastSequence			        is Numeric size 20
		LocalTrueCostConfiguration			is like TrueCostConfiguration
		LocalRunGroup						is like RunGroup
		
	Transient Fields
		TransientTrueCostWeight			is AlphaUpper 25
			default label is "True\CostWeight"
			derive value from TrueCostWeight
	
	Derived Fields
		WeightIsNotDefined					is a MessageField
			restricted
			"WeightIsNotDefined"
		WeightIsRequired					is a MessageField
			restricted
			"WeightFieldIsRequired"
		WeightDataAlreadyExist				is a MessageField
			restricted
			"WeightDataEventAlreadyExist"
		DepartmentIsRequired				is a MessageField
			restricted
			"DepartmentFieldIsRequired"
		DepartmentNotDefined				is a MessageField
			restricted
			"DepartmentIsNotDefined"
		DepartmentMustBePosting				is a MessageField
			restricted
			"DepartmentMustBePosting"
		CostObjectNotDefined				is a MessageField
			restricted
			"CostObjectIsNotDefined"
		AccountingEntityNotDefined			is a MessageField
			restricted
			"AccountingEntityIsNotDefined"
        TargetsNotEntered                   is a MessageField
            restricted
            "DepartmentAndCostObjectAreRequiredForResourceRateWeightData"
        TargetsEntered                      is a MessageField
            restricted                      
            "CannotSpecifyBothDepartmentAndCostObjectUnlessResourceRate" 
        NoTargetEntered                    is a MessageField
            restricted                      
            "DepartmentOrCostObjectMustBeSpecified" 
            
		
			















	
	Field Rules
		TrueCostConfiguration
			required
		TrueCostWeight
			required
		AccountingEntity
			required
		StartDate
			required




	Conditions
		ErrorTransaction
			restricted
			when (ErrorDescription entered)

	Relations
		
		TrueCostConfigRel
			one-to-one relation to TrueCostConfiguration
			Field Mapping uses symbolic key
				related.TrueCostConfiguration = TrueCostConfiguration

		AccountingEntityRel
			one-to-one relation to AccountingEntity
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	=	TrueCostConfiguration	
				related.AccountingEntity		=	AccountingEntity

		TrueCostWeightRel
			one-to-one relation to TrueCostWeight
			Field Mapping uses symbolic key
				related.TrueCostConfiguration	=	TrueCostConfiguration	
				related.TrueCostWeight			=	TrueCostWeight

		TrueCostWeightDataRel
			one-to-one relation to TrueCostWeightData
			Field Mapping uses ByStartDateDescending
				related.TrueCostConfiguration					=	TrueCostConfiguration					
				related.TrueCostWeightData.AccountingEntity		=	AccountingEntity
				related.TrueCostWeightData.Department			= 	Department					
				related.TrueCostWeightData.CostObject			= 	CostObject
				related.TrueCostWeight							=	TrueCostWeight		
    			related.StartDate								= 	StartDate
    			
		DepartmentAccountingUnitRel
			one-to-one relation to AccountingUnit
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.AccountingEntity		= AccountingEntity
				related.AccountingUnit			= Department

		Department1Rel
			one-to-one relation to FinanceDimension1
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension1 		= Department

		Department2Rel
			one-to-one relation to FinanceDimension2
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension2 		= Department

		Department3Rel
			one-to-one relation to FinanceDimension3
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension3 		= Department

		Department4Rel
			one-to-one relation to FinanceDimension4
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension4 		= Department

		Department5Rel
			one-to-one relation to FinanceDimension5
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension5 		= Department

		Department6Rel
			one-to-one relation to FinanceDimension6
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension6 		= Department

		Department7Rel
			one-to-one relation to FinanceDimension7
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension7 		= Department

		Department8Rel
			one-to-one relation to FinanceDimension8
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension8 		= Department

		Department9Rel
			one-to-one relation to FinanceDimension9
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension9 		= Department

		Department10Rel
			one-to-one relation to FinanceDimension10
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension10 		= Department
				
		Department1SummaryRel
			one-to-many relation to FinanceDimension1
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension1 		= Department
			Instance Selection
				where (related.FinanceDimension1.DimensionType.Summary)

		Department2SummaryRel
			one-to-many relation to FinanceDimension2
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension2 		= Department
			Instance Selection
				where (related.FinanceDimension2.DimensionType.Summary)

		Department3SummaryRel
			one-to-many relation to FinanceDimension3
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension3 		= Department
			Instance Selection
				where (related.FinanceDimension3.DimensionType.Summary)

		Department4SummaryRel
			one-to-many relation to FinanceDimension4
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension4 		= Department
			Instance Selection
				where (related.FinanceDimension4.DimensionType.Summary)

		Department5SummaryRel
			one-to-many relation to FinanceDimension5
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension5 		= Department
			Instance Selection
				where (related.FinanceDimension5.DimensionType.Summary)

		Department6SummaryRel
			one-to-many relation to FinanceDimension6
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension6 		= Department
			Instance Selection
				where (related.FinanceDimension6.DimensionType.Summary)

		Department7SummaryRel
			one-to-many relation to FinanceDimension7
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension7 		= Department
			Instance Selection
				where (related.FinanceDimension7.DimensionType.Summary)

		Department8SummaryRel
			one-to-many relation to FinanceDimension8
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension8 		= Department
			Instance Selection
				where (related.FinanceDimension8.DimensionType.Summary)

		Department9SummaryRel
			one-to-many relation to FinanceDimension9
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension9 		= Department
			Instance Selection
				where (related.FinanceDimension9.DimensionType.Summary)

		Department10SummaryRel
			one-to-many relation to FinanceDimension10
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension10 		= Department
			Instance Selection
				where (related.FinanceDimension10.DimensionType.Summary)

		CostObject1Rel
			one-to-one relation to FinanceDimension1
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension1 		= CostObject

		CostObject2Rel
			one-to-one relation to FinanceDimension2
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension2 		= CostObject

		CostObject3Rel
			one-to-one relation to FinanceDimension3
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension3 		= CostObject

		CostObject4Rel
			one-to-one relation to FinanceDimension4
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension4 		= CostObject

		CostObject5Rel
			one-to-one relation to FinanceDimension5
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension5 		= CostObject

		CostObject6Rel
			one-to-one relation to FinanceDimension6
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension6 		= CostObject

		CostObject7Rel
			one-to-one relation to FinanceDimension7
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension7 		= CostObject

		CostObject8Rel
			one-to-one relation to FinanceDimension8
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension8 		= CostObject

		CostObject9Rel
			one-to-one relation to FinanceDimension9
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension9 		= CostObject

		CostObject10Rel
			one-to-one relation to FinanceDimension10
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= TrueCostConfiguration	
				related.FinanceDimension10 		= CostObject
				
		RunGroupOtherRel
			one-to-many relation to TrueCostWeightDataInterface
			Field Mapping uses symbolic key
			Instance Selection
				where(related.TrueCostWeightDataInterface.RunGroup = TrueCostWeightDataInterface.RunGroup)
				
		RunGroupLocalRel
			one-to-many relation to TrueCostWeightDataInterface
			Field Mapping uses symbolic key
				related.TrueCostConfiguration	= LocalTrueCostConfiguration
			Instance Selection
				where(related.TrueCostWeightDataInterface.RunGroup	= LocalRunGroup)
		
		RunGroupDeleteRel
			one-to-many relation to TrueCostWeightDataInterface
			Field Mapping uses symbolic key
			Instance Selection
				where(related.TrueCostWeightDataInterface.RunGroup = LocalRunGroup)
				
		CopyRunGroupRel
			one-to-many relation to TrueCostWeightDataInterface
			Field Mapping uses symbolic key
				related.TrueCostConfiguration	= LocalTrueCostConfiguration
			Instance Selection
				where(related.TrueCostWeightDataInterface.RunGroup = LocalRunGroup)
				
	Actions
		Create is a Create Action
			Entrance Rules			
				LocalLastSequence = last RunGroupOtherRel.TrueCostWeightDataInterface.Sequence			
				if(!TrueCostWeightDataInterface.Sequence entered)
					TrueCostWeightDataInterface.Sequence = (LocalLastSequence + 1)
			Action Rules
				TrueCostWeight = TransientTrueCostWeight
						
		Update is an Update Action
		
		Delete is a Delete Action
		
		Purge is a Purge Action
			restricted
		
		InterfaceWeightData		is a Set Action
			Parameters				
				PrmTrueCostConfiguration 		is a TrueCostConfiguration
					default label is "True\CostConfiguration"
				PrmRunGroup						is a RunGroup
					default label is "RunGroup"
						
			Parameter Rules		
				PrmTrueCostConfiguration
					required					
				PrmRunGroup
					required
						"RunGroup_is_required"
					LocalTrueCostConfiguration	=	PrmTrueCostConfiguration
					LocalRunGroup				=	PrmRunGroup
					constraint(RunGroupLocalRel exists)
						"RunGroup_does_not_exist"
					LocalFirstCount 			= instance count of RunGroupLocalRel
			
			Instance Selection				
				where(TrueCostConfiguration = PrmTrueCostConfiguration
				and	TrueCostWeightDataInterface.RunGroup = PrmRunGroup)
			
			Local Fields
				
				LocalFirstCount						is Numeric 10
				LocalFinalCount						is Numeric 10
				LocalActor							is an Actor
						
			Action Rules
				Empty Set Rules
				
				Set Rules
					Entrance Rules
						LocalActor = actor					
					Exit Rules
						LocalFinalCount =	LocalFirstCount - instance count of RunGroupLocalRel					
						send notification
							to LocalActor
							description is "ImportTo_True\Cost_Weight\DataHasCompleted"
							priority is high
							detail is "NumberOfSuccessfulRecords<LocalFinalCount>.___NumberOfFailedRecords<instance count of RunGroupLocalRel>___TotalRecordsProcessed<LocalFirstCount>"
						
				Instance Rules
					initialize ErrorDescription
					
					if(TrueCostWeightDataRel exists)																			
						ErrorDescription = WeightDataAlreadyExist						
										
					if (Department entered)
						if((TrueCostConfiguration.DepartmentIsAccountingUnit
						and DepartmentAccountingUnitRel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension1
						and Department1Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension2
						and Department2Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension3
						and Department3Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension4
						and Department4Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension5
						and Department5Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension6
						and Department6Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension7
						and Department7Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension8
						and Department8Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension9
						and Department9Rel not exists)
						or (TrueCostConfiguration.DepartmentIsDimension10
						and Department10Rel not exists))
							ErrorDescription = DepartmentNotDefined
							
						if((TrueCostConfiguration.DepartmentIsDimension1
						and Department1SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension2
						and Department2SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension3
						and Department3SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension4
						and Department4SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension5
						and Department5SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension6
						and Department6SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension7
						and Department7SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension8
						and Department8SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension9
						and Department9SummaryRel exists)
						or (TrueCostConfiguration.DepartmentIsDimension10
						and Department10SummaryRel exists))
							ErrorDescription = DepartmentMustBePosting
							
					if (CostObject entered)
						if((TrueCostConfiguration.CostObjectIsDimension1
						and CostObject1Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension2
						and CostObject2Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension3
						and CostObject3Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension4
						and CostObject4Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension5
						and CostObject5Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension6
						and CostObject6Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension7
						and CostObject7Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension8
						and CostObject8Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension9
						and CostObject9Rel not exists)
						or (TrueCostConfiguration.CostObjectIsDimension10
						and CostObject10Rel not exists))
							ErrorDescription = CostObjectNotDefined
					
					if(TrueCostWeightRel not exists)
						ErrorDescription = WeightIsNotDefined
						
					if (AccountingEntityRel not exists)
						ErrorDescription = AccountingEntityNotDefined
															
					if(TrueCostWeight not entered)
						ErrorDescription = WeightIsRequired

					if (TrueCostWeightRel.ResourceRate)
						if (Department not entered
						or CostObject not entered)
							ErrorDescription	= TargetsNotEntered
					else
						if (Department entered
						and CostObject entered)
							ErrorDescription	= TargetsEntered
                    
                    if (!TrueCostWeightRel.ResourceRate)
                        if (Department not entered
                        and CostObject not entered)
                            ErrorDescription    = NoTargetEntered

					if (!ErrorDescription entered)				
						invoke Create TrueCostWeightData
							resume on error
								ErrorDescription = error message															
							invoked.TrueCostConfiguration				= TrueCostConfiguration
							invoked.TrueCostWeight						= TrueCostWeight
							invoked.TrueCostWeightData.AccountingEntity	= AccountingEntity
							invoked.TrueCostWeightData.Department 		= Department
							invoked.TrueCostWeightData.CostObject		= CostObject						
							invoked.TrueCostWeightData.StartDate		= StartDate
							invoked.TrueCostWeightData.Weight			= Weight
					
					if (!ErrorDescription entered)		
						invoke Delete
						
		DeleteAllTransactionsForRunGroup is a Set Action
			default label is "DeleteAllTransactionsForRunGroup"
			Parameters
				PrmRunGroup						is a RunGroup
					default label is "RunGroup"
			Parameter Rules
				PrmRunGroup
					required
						"Run_GroupIsRequired"
					LocalRunGroup	= PrmRunGroup				
					constraint(RunGroupDeleteRel exists)
						"Run_GroupDoesNotExist"
			Instance Selection				
				where(TrueCostWeightDataInterface.RunGroup = PrmRunGroup)
			
			Action Rules
				Instance Rules
					invoke Delete

		CopyRunGroup					is a Set Action
			default label is "CopyRunGroup"
			
			Parameters
				PrmTCConfig				is a TrueCostConfiguration
					default label is "True\CostConfiguration"
				PrmRunGroupFrom			is a RunGroup
					default label is "Copy_from_RunGroup"
				PrmRunGroupTo			is a RunGroup
					default label is "Copy_to_RunGroup"
					
			Parameter Rules
				PrmTCConfig
					required
				PrmRunGroupFrom
					required
					LocalTrueCostConfiguration = PrmTCConfig
					LocalRunGroup = PrmRunGroupFrom
					constraint (CopyRunGroupRel exists)
						"Source_Run_GroupDoesNotExist"
					constraint (PrmRunGroupFrom != PrmRunGroupTo)
						"CopyFrom_Run_GroupCannotBeTheSameAsCopyTo_Run_Group"
				PrmRunGroupTo
					required
					
			Instance Selection
				where (TrueCostConfiguration = PrmTCConfig
				and TrueCostWeightDataInterface.RunGroup = PrmRunGroupFrom)
				
			Action Rules
				
				Instance Rules
					invoke Create TrueCostWeightDataInterface
						fill in fields from this instance
							except invoked.RunGroup
						invoked.RunGroup				= PrmRunGroupTo
