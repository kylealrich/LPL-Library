AsyncForecastSlice is a BusinessClass
	owned by async
    prefix is AFS
    stored in environment
	
	Ontology
		part of AsyncSchedulingForecast
	    	relative key is SliceKey is AlphaUpper size 12

	Patterns
		disable Auditing
        disable EffectiveDated
        disable AsOfDateProcessing
        implements UniqueID
		
	Persistent Fields
		MemberCount	is Numeric size 9
		PeriodStart is TimeStamp
		ForecastPeriodEnd is TimeStamp  
		
	Derived Fields
		SliceDescription is a NativeField 
			type is Alpha size 50


		SliceDataFormat is a DerivedField
			type is Numeric size 1
			return AsyncSchedulingForecast.SliceDataFormat
			
		TimeSliceSize is a DerivedField
			type is Numeric size 1
			return AsyncSchedulingForecast.TimeSliceSize
			
		TimeZone is a DerivedField
			type is Alpha size 30
			return AsyncSchedulingForecast.TimeZone
	
	Actions
		Create is a Create Action
			restricted
		Update is an Update Action
			restricted
		Delete is a Delete Action
			restricted
			
		PurgeOldForecasts is a Set Action
			disable checkpoint
			Parameters
				ThruEndDate 		is Date
				PurgeOffsetDays 	is Numeric size 3
				ParamForecast		is an AsyncSchedulingForecast
					default label is "ScheduleForecast"
			
			Local Fields
				LocalThruEndDate 	is Date
					value is ThruEndDate		
					


			Parameter Rules
				ThruEndDate   
					if (ThruEndDate entered)
						LocalThruEndDate = (ThruEndDate + 1 day)
					else	 
					if (not PurgeOffsetDays entered)
						required	
							"MustEnterThroughFinishDateOrOffset"
					else
						LocalThruEndDate  = current date - (PurgeOffsetDays - 1)
			
				PurgeOffsetDays
					constraint (not ThruEndDate entered)
						"CannotEnterBothThroughFinishDateAndOffset"
						
			Instance Selection
				where (ForecastPeriodEnd < LocalThruEndDate and (ParamForecast = blank or AsyncSchedulingForecast = ParamForecast))

			Sort Order
				ForecastPeriodEnd
				AsyncSchedulingForecast
				SliceKey
			
			Action Rules
				Instance Rules
					invoke Delete
		
