JournalDetailPurgeReport is a BusinessClass	
    owned by tx
    prefix is Vpg

    Ontology
        symbolic key is JournalDetailPurgeReport

    Patterns
        implements StaticJava
        disable AuditIndex
    	disable Auditing		
        disable EffectiveDated
        disable UniqueID
		disable AsOfDateProcessing
		enable explicit context override

    Persistent Fields

		TaxEntity
		CustomerGroup	 
		ProcessLevel	 
		SystemCode      is AlphaUpper 2
		Source			
		PostDate		is Date
		BeginYear		is a Year		
		BeginPeriod		is a Period
		EndYear			is a Year
		EndPeriod		is a Period		

		Results			is RichText

	Transient Fields	 
		PrmCustomerGroup			is a CustomerGroup
			default label is "CustomerGroup"
		PrmVatPurchaseSaleTransaction	is a VatPurchaseSaleTransaction		
			context of PrmCustomerGroup	
		PostDateYear				is a Year
			derive value from PostDate year
			
    Context Fields
		PostDateRange			is a DateRange

	Conditions
		WithinPostDateRange
			restricted
			when (PostDateRange not entered
			or	 (PostDateRange entered
			and	  PostDate within PostDateRange)
			and  (PostDateYear = PostDate year
			or    PostDateYear not entered))
			
    Relations

    Sets
		ByFEGTaxEntity				 
			duplicates
			Sort Order
				FinanceEnterpriseGroup
				TaxEntity
				ProcessLevel
				Source			 
				BeginYear		 
				BeginPeriod		 
		
	Actions
		Create is an Action
			restricted
		Update is an Action
			restricted
		Delete is an Action 
		Purge is a Purge Action
			restricted

		VatPurchaseSaleTransactionReportPurge is a Set Action			
			completion message is "PurgeActionSuccessfully<RecordCount>_Records"
			run in background		 
			Parameters 
				PrmFinEntGroup is a FinanceEnterpriseGroup
					default label is "FinanceEnterpriseGroup"			
				PrmTaxEntity is a TaxEntity
					default label is "TaxEntity"
			Parameter Rules
				PrmFinEntGroup
					initial value is actor.context.FinanceEnterpriseGroup	
					required	
				PrmTaxEntity
					required	
			Local Fields
				RecordCount			is Numeric 10
			Instance Selection			
				where (PrmFinEntGroup = PrmFinEntGroup  
				and    TaxEntity 	  = PrmTaxEntity)


			Action Rules								
				Instance Rules
					increment RecordCount
					invoke Purge	 
				
