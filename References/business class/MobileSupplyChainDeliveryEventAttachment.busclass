MobileSupplyChainDeliveryEventAttachment is a BusinessClass
    owned by mscm
    prefix is DEATC
    sql name is "MSCMDeliveryEventAttachment"
    Ontology
        part of MobileSupplyChainDeliveryEvent
            relative key is Sequence is Numeric size 3

    Persistent Fields
        Attachment       is an AlternateAttachment

    Local Fields
        LocalAttributeCtr       is Numeric 2
    Field Rules
        Sequence
            autosequence
                minimize contention

    Actions

        Create is a Create Action
            restricted

        Delete is a Delete Action
            restricted

        UploadToIDM is an Instance Action
            valid when (Attachment.ValidForIDMUpload)
            Action Rules
                include IDM.MoveAttachmentsToIDM
                    replace AttachmentField with Attachment

        MoveAttachmentsToIDM is a Set Action
            restricted

            Instance Selection
                where (Attachment.IsLocal)

            Accumulators
                InstanceCount

            Action Rules
                Instance Rules
                    increment InstanceCount

                    include IDM.MoveAttachmentsToIDM
                        replace AttachmentField with Attachment

                    commit transaction

                    if (InstanceCount = config.ID_MOVE_ATTACHMENTS_LIMIT)
                        end set action instance loop

    Create Rules
        include IDM.CreateRules
            replace AttachmentField with Attachment

    Delete Rules
        include IDM.DeleteRules
            replace AttachmentField with Attachment

    Commit Rules
        include IDM.CommitRules
            replace AttachmentField with Attachment
