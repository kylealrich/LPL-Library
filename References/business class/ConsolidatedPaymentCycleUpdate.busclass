ConsolidatedPaymentCycleUpdate is a BusinessClass
    owned by ap
    prefix is CVBU

    Ontology
        symbolic key is ConsolidatedPaymentCycleUpdate

    Patterns
        disable AuditIndex
		disable Auditing 
       	disable EffectiveDated

    Persistent Fields
        BalanceCurrency                 is a Currency
        PaymentCheckDate                is Date
        IndexCounter                    is Numeric size 2
        CurrentBalance                  is a CurrencyAmount
        CurrentPeriodPayments           is a CurrencyAmount
        CurrentPeriodGainLoss           is a CurrencyAmount
        CurrentPeriodDiscountLost       is a CurrencyAmount
        CurrentPeriodNbrOfPayments      is Decimal size 6
        CurrentPeriodDiscountTaken      is a CurrencyAmount
        CurrentYearIncomeWithholding    is a CurrencyAmount

    Relations
        VendorBalancesRel
			one-to-one relation to VendorBalance
			Field Mapping uses symbolic key
				related.VendorGroup    = VendorGroup
				related.Vendor         = Vendor
				related.VendorLocation = VendorLocation
				related.Company        = Company

    Actions
        Create is a Create Action
            restricted

        Update is an Update Action
            restricted

        Delete is a Delete Action
            restricted

        Purge is a Purge Action
            restricted

        UpdateVendorBalances is a Set Action
            default label is untranslatable
            restricted
            Parameters
                PrmVendorGroup          is a VendorGroup            

            Local Fields

            Accumulators
                TotalCurrentBalance
                TotalCurrentPeriodPayments
                TotalCurrentPeriodGainLoss
                TotalCurrentPeriodDiscountLost
                TotalCurrentPeriodDiscountTaken
                TotalCurrentYearIncomeWithholding

            Instance Selection
                where (VendorGroup = PrmVendorGroup)

            Sort Order
                VendorGroup
                Company
                Vendor
                VendorLocation

            Action Rules
                VendorLocation Set Rules
                    Exit Rules
                        invoke UpdateConsolidatedVendorBalances VendorBalancesRel
                            invoked.PrmCurrentBalance 			        = TotalCurrentBalance
                            invoked.PrmLastPaymentDate 		            = PaymentCheckDate
                            invoked.PrmCurrentPeriodPayments 			= TotalCurrentPeriodPayments
                            invoked.PrmCurrentPeriodGainLoss 			= TotalCurrentPeriodGainLoss
                            invoked.PrmCurrentPeriodDiscountLost 		= TotalCurrentPeriodDiscountLost
                            invoked.PrmCurrentPeriodDiscountTaken 		= TotalCurrentPeriodDiscountTaken
                            invoked.PrmCurrentYearIncomeWithholding     = TotalCurrentYearIncomeWithholding
                        invoke TriggerSupplierBalance VendorBalancesRel

                Instance Rules
                    TotalCurrentBalance                     += CurrentBalance
                    TotalCurrentPeriodPayments              += CurrentPeriodPayments
                    TotalCurrentPeriodGainLoss              += CurrentPeriodGainLoss
                    TotalCurrentPeriodDiscountLost          += CurrentPeriodDiscountLost
                    TotalCurrentPeriodDiscountTaken         += CurrentPeriodDiscountTaken
                    TotalCurrentYearIncomeWithholding       += CurrentYearIncomeWithholding
                    invoke Delete
