FinanceGroup is a BusinessClass
	owned by sharedfinance
	prefix is FiGrp

	Ontology
		symbolic key is FinanceGroup

	Patterns

    Persistent Fields
		Description						is Alpha 100
		CorporateCalendar				is a SystemCalendar
		CorporatePeriodGroup			is a SystemCalendarPeriodGroup
		Currency

		CashForecastApprovalRequired	is Boolean
		BankInterfaceAdministrator		is a FinanceResource
		AutomaticBankStatementImport 	is Boolean
    	IntradayStatementProcessing		is Numeric 2
    		States
    			KeepAllStatements 							value is 1
    			KeepLatestStatementAndAnyWithCashPosition	value is 2
    			KeepOnlyLatestStatement						value is 3
    	NumberOfCategorizationGroups	is a CategorizationGroup
		LastDirectForecastLoad			is TimeStamp
		DefaultRunGroup					is AlphaUpper 15
			default label is "JournalInterfaceDefaultRunGroup"
		SummarizeJournalPostings		is Boolean
		LastGroupingForTeam				is Numeric 9    

		StartLateReasonCodeRequired				is Boolean
		CloseLateReasonCodeRequired				is Boolean
		RejectReasonCodeRequired				is Boolean
		ReopenTaskReasonCodeRequired			is Boolean
		VoidReasonCodeRequired					is Boolean
		EstimateReasonCodeRequired				is Boolean
		RejectOneTimeTaskReasonCodeRequired		is Boolean
		AllowOneTimeTasks						is Boolean
		RequireApprovalOfOneTimeTasks			is Boolean
		OneTimeTaskDefaultApprovalCode			is an ApprovalCode

		RejectReconReasonCodeRequired			is Boolean
		ReopenReconReasonCodeRequired			is Boolean

		RejectCashForecastReasonCodeRequired	is Boolean

		JournalEntryApprovalRequired			is Boolean
		RejectJournalEntryReasonCodeRequired	is Boolean
		ReopenJournalReasonCodeRequired			is Boolean
		HasReconciliationsForAccountingUnits	is Boolean

    Derived Fields
    	DerivedEmptySet is a DerivedField
   			type is Boolean
			restricted
   			return false
						 
		LoadDirectForecastMessage is a MessageField
			restricted
	   		"Note:_\Direct_\ForecastDataWillBeLoadedForAll_\CompaniesAssociatedWithThe_\Finance_\GroupWhenNotEntered"




			
		BlankField is a DerivedField
			type is Alpha 1

			return blank
			
   	Field Rules
   		FinanceGroup
   			initial value is actor.context.FinanceGroup
   			
   		Description
   			required
			default to FinanceGroup.EnterpriseGroup.Description			

		CorporateCalendar
			if (CorporatePeriodGroup entered)
				required
					"Corporate_CalendarRequiredWhen_Corporate_Period_GroupEntered"

		Currency




		BankInterfaceAdministrator
			if (AutomaticBankStatementImport)
				required
					"BankInterfaceAdministratorIsRequiredWhenAutomaticBankStatementImportIsChecked"
			constraint (BankInterfaceAdministrator.EmailAddress entered)
				"BankInterfaceAdministratorMustHaveAnEmailAddressDefined"

		IntradayStatementProcessing
			default to 2 

		NumberOfCategorizationGroups
			default to 10

		RequireApprovalOfOneTimeTasks
			constraint (AllowOneTimeTasks)
				"CannotSetRequireApprovalForOneTimeTasksWhenNotAllowingOneTimeTasks"

		OneTimeTaskDefaultApprovalCode
			constraint (AllowOneTimeTasks)
				"CannotHaveDefaultApprovalCodeForOneTimeTasksWhenNotAllowingOneTimeTasks"
			constraint (RequireApprovalOfOneTimeTasks)
				"CannotHaveDefaultApprovalCodeForOneTimeTasksWhenNotRequiringApproval"

	Local Fields
		LocalCompany						is like Company 
		LocalBusinessClass					is a BusinessClass

	Context Fields
		EnterpriseGroup
		PayablesInvoice

    Conditions
 		FinanceGroupExists
 			restricted
 			when (FinanceGroup exists)
 			
    	NewGroup
			restricted
    		when (!EnterpriseGroup exists)

		HasStatementLineDistributions
			restricted
			when (ReleasedStatementLineDistributionsRel exists)

		HasNonCashLedgerDistributions
			restricted
			when (ReleasedNonCashLedgerDistributionsRel exists)



			
		HasInterfacedJournalEntries
			restricted
			when (InterfacedJournalEntriesRel exists)

		HasArchivedJournalEntries
			restricted
			when (ArchivedJournalEntriesRel exists)
							
	Relations




		




		FinanceTeamRel is a FinanceTeam set

		FinanceResourceRel
			one-to-many relation to FinanceResource
			Field Mapping uses symbolic key
				related.HROrganization	= FinanceGroup.HROrganization

		CompanyRel 
			one-to-many relation to GeneralLedgerCompany
			Field Mapping uses symbolic key

		FinanceTeamMemberRel 
			one-to-many relation to FinanceTeamMember
    		Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceGroup
			Instance Selection
				where (related.ActiveResource)	

		CalendarPeriodGroupRel
			one-to-many relation to SystemCalendarPeriodGroup
			Field Mapping uses symbolic key
					related.EnterpriseGroup = FinanceGroup
		
		CashPositionAnalyticCubeRel
			one-to-one relation to AnalyticCube
	        Field Mapping uses AnalyticCubeSet
	        	related.BusinessClass = "BankStatementLine"
	        	
	    ForecastingAnalyticCubeRel
			one-to-one relation to AnalyticCube
	        Field Mapping uses AnalyticCubeSet
	        	related.BusinessClass = "CashForecastPeriodAmount"
	        	
	    BankServicesAnalyticCubeRel
			one-to-one relation to AnalyticCube
	        Field Mapping uses AnalyticCubeSet
	        	related.BusinessClass = "BankServiceDetail"
	        	
		ReleasedStatementLineDistributionsRel
			one-to-many relation to BankStatementLineDistribution
			Field Mapping uses ByDistributionStatusByCashManagementGroup
				related.CashManagementGroup	= FinanceGroup
				related.Status			= 1 

		ReleasedNonCashLedgerDistributionsRel
			one-to-many relation to NonCashLedgerDistribution
			Field Mapping uses ByDistributionStatusByCashManagementGroup
				related.CashManagementGroup	= FinanceGroup
				related.Status				= 1 






		InterfacedJournalEntriesRel
			one-to-many relation to FinanceJournalInterface
			Field Mapping uses ByStatus
				related.FinanceGroup	= FinanceGroup
				related.Status			= 3



		ArchivedJournalEntriesRel
			one-to-many relation to FinanceJournalInterface
			Field Mapping uses ByStatus
				related.FinanceGroup	= FinanceGroup
				related.Status			= 9

		ReconciliationAccountsWithAccountingunitRel is a FinanceCompany set
			Instance Selection
				where (related.HasReconciliationsForAccountingUnits)

	Rule Blocks

	Actions	
		Create is a Create Action
			Entrance Rules




			Action Rules

		Update is an Update Action

		Delete is a Purge Action














		ArchiveInterfacedJournals is an Instance Action
			valid when (HasInterfacedJournalEntries)
			Action Rules
				invoke ArchiveInterfacedJournals FinanceJournalInterface
					invoked.PrmFinanceGroup	= FinanceGroup















					






















				



















































































		UpdateCashManagementCubes is a Set Action
			restricted
			Parameters
				CashPosition		 		is Boolean
				CashPositionOption   		is a CubeUpdateOption
				Forecasting		 	 		is Boolean
				ForecastingOption    		is a CubeUpdateOption
				BankServices		 		is Boolean
				BankServicesOption   		is a CubeUpdateOption
				
			Parameter Rules
				CashPosition
					initial value is true
				
				CashPositionOption
					initial value is 1 
					
				Forecasting
					initial value is true
					
				ForecastingOption
					initial value is 1 
					
				BankServices
					initial value is true
					
				BankServicesOption
					initial value is 1 
						
			Action Rules
				Set Rules
					Exit Rules
						if (CashPosition)
							if (CashPositionOption.Refresh)
								invoke Refresh CashPositionAnalyticCubeRel in background
							else
								invoke Reload CashPositionAnalyticCubeRel in background
							
						if (Forecasting)
							if (ForecastingOption.Refresh)
								invoke Refresh ForecastingAnalyticCubeRel in background
							else
								invoke Reload ForecastingAnalyticCubeRel in background
							
						if (BankServices)
							if (BankServicesOption.Refresh)
								invoke Refresh BankServicesAnalyticCubeRel in background
							else
								invoke Reload BankServicesAnalyticCubeRel in background






