ItemLocationAudit is a BusinessClass
	owned by ic
	prefix is ILAUD
	
	Ontology
		symbolic key is ItemLocationAudit
		
	Patterns
		implements StaticJava
		disable AuditIndex
		disable Auditing
		disable EffectiveDated
		implements Archivable
		
	Persistent Fields
		AfterStockOnHandQuantity		is like Quantity
		BeforeStockOnHandQuantity		is like Quantity
		AfterSecondaryQuantity			is like Quantity
		BeforeSecondaryQuantity			is like Quantity
		AfterUnallocatedQuantity		is like Quantity
		BeforeUnallocatedQuantity		is like Quantity
		AfterAllocatedQuantity			is like Quantity
		BeforeAllocatedQuantity			is like Quantity
		AfterInProcessQuantity			is like Quantity
		BeforeInProcessQuantity			is like Quantity
		AfterBackorderedQuantity		is like Quantity
		BeforeBackorderedQuantity		is like Quantity
		AfterInspectionHoldQuantity		is like Quantity
		BeforeInspectionHoldQuantity	is like Quantity
		AfterOnOrderQuantity			is like Quantity
		BeforeOnOrderQuantity			is like Quantity
		AfterWorkInProgressQuantity		is like Quantity
		BeforeWorkInProgressQuantity	is like Quantity
		AfterIntransitQuantity			is like Quantity
		BeforeIntransitQuantity			is like Quantity
		AfterAverageStockOnHandQuantity	is like Quantity
		BeforeAverageStockOnHandQuantity is like Quantity
		AfterAverageCost				is like InternationalCost
		BeforeAverageCost				is like InternationalCost
		AfterAverageAddOnCost			is like InternationalCost
		BeforeAverageAddOnCost			is like InternationalCost
		AfterLastReceiptCost			is like InternationalCost
		BeforeLastReceiptCost			is like InternationalCost
		AfterLastIssueCost				is like InternationalCost
		BeforeLastIssueCost				is like InternationalCost
        RootBusinessClass				is LPLName
        RootAction						is LPLName
        InvokingAction 					is LPLName
        ActionContext					is LPLName
		RootBusinessObjectReference		is BusinessObjectReference
		OriginatingTransaction			is BusinessObjectReference
		UpdateDate						is TimeStamp
		Actor							is like Actor

	Relations
		ItemLocationAuditRel 
			one-to-many relation to ItemLocationAudit
			Field Mapping uses symbolic key
				related.Company 			= Company
				related.InventoryLocation 	= InventoryLocation
				related.Item 				= Item

	Actions
		Create is a Create Action
			restricted
			Action Rules

		CreateError is a Create Action
			restricted
			bypass field rules
			Action Rules

				ItemLocationAudit = last ItemLocationAuditRel.ItemLocationAudit + 1 
				
		Purge is a Purge Action
			restricted
			bypass relational integrity rules

		PurgeOldAuditRecords is a Set Action
			restricted
			Parameters
				PrmCompany		  is a Company
					default label is "Company"
				PrmOffsetYear	  is Numeric 2
					default label is "OffsetYear"
			Parameter Rules
				PrmOffsetYear
					initial value is 2
					default to 2
					LocalOffsetDate = current corporate date - PrmOffsetYear as years
			Local Fields
				LocalOffsetDate   is Date
			Instance Selection
				include deleted records
				where ((PrmCompany not entered or Company = PrmCompany)
				and    (UpdateDate <= LocalOffsetDate))
			Action Rules
				Set Rules
					Exit Rules
						invoke PurgeOldRecords StockOnHandDetailAudit
							invoked.PrmCompany 		= PrmCompany
							invoked.PrmOffsetDate	= LocalOffsetDate
				Instance Rules
					invoke Purge
					

				
