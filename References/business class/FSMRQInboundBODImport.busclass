FSMRQInboundBODImport is a BusinessClass
	owned by integration
	prefix is FSMRQ
	
	Ontology
		symbolic key is FSMRQInboundBODImport
	
	Patterns
		implements InlineUserFields
			size is 1000
        implements StaticJava
        disable AuditIndex
	
	Context Fields
		FSMInboundBODTracker
		
	Persistent Fields
	
	Field Rules
	
	Local Fields

		NewRequisition  					is a Requisition view
		NewRequisitionLine					is a RequisitionLine view
		NewBODTracker  						is a FSMInboundBODTracker view
		LocalConfigurationParameter			is Alpha size up to 200
		Error             					is Boolean
		ErrorMessage      					is Alpha 300
		LocalFSMInboundBODTracker			is Numeric 15
		LocalGenericDelimiter				is Alpha 9
		LocalCommodityCodeDelimiter			is Alpha 9
		LocalAccountingEntity				is Alpha 40
		LocalSplitFEG						is Alpha 4
		LocalAE								is Alpha 40
		CrossAccountingEntity				is Alpha 40
		LocationAck							is Alpha 100
		LocalOrganization					is AlphaUpper 4
		LocalBODXML							is XMLDocument
		LocalVariationID					is Alpha 100
		LocalActionCode						is Alpha 9
		LocalRequisition					is Numeric 7
		LocalEAMDocID						is Numeric 7
		LocalIterator						is Numeric 9
		LocalreqLineCounter					is Numeric 9
		LocalReqCompany						is Numeric 4
		LocalLocID							is Alpha 50
		Localshiptolocation					is Alpha 50
		LocalHeadershiptolocation			is Alpha 50
		LocalHeadershiptolocationLen		is Numeric 9
		LocalHeadershiptolocationShipto		is Alpha 50
		LocalHeadershiptolocationWarehouse	is Alpha 50
		LocalLineshiptolocation				is Alpha 50
		LocalLineshiptolocationLen			is Numeric 9
		LocalLineshiptolocationShipto		is Alpha 50
		LocalLineshiptolocationWarehouse	is Alpha 50
		Localstore							is Alpha 50
		LocalRequestingLocation 			is AlphaUpper 20
		LocalReqLocFromLocation				is AlphaUpper 20
		LocalRequester						is Numeric 13
		LocalNameValue						is Alpha 100
		LocalNameValue1						is Alpha 100
		LocalNameValueID					is Alpha 100
		LocalReqLineDescription				is Alpha 60
		LocalRequisitionLineLength			is Numeric 30
		LocalReqLine						is Numeric 9
		LocalRequestedItem					is Alpha 100
		LocalItem							is AlphaUpper 32
		LocalUOM							is AlphaUpper 4
		LocalTempSupplier					is Alpha 100
		AccountStringLINE					is Alpha 100
		LocalSupplier						is Numeric 9
		LocalExpensableItemflag				is Boolean
		LocalUnitCost						is Decimal 21.8
		LocalCostOption						is AlphaUpper 1
		LocalServiceIndicator				is Boolean
		LocalFixedpriceFlag					is Boolean
		LocalQuantity						is Decimal 13.4
		LocalCommentLength					is Numeric 9
		CommentsCount						is Numeric 9
		LocalComment						is Alpha 200	
		LocalInventoryItemComment			is Alpha 200
		LocalServiceItemComment				is Alpha 200
		LocalUserAreaCount          		is Numeric 9
		LocalItemGroup						is AlphaUpper 5
		ItemlocExistsandTracked				is Boolean
		LocalEAMWorkOrderNumber				is AlphaUpper 30
		LocalEAMWorkOrderActivityNumber		is Numeric 8
		LocalEAMDropShipComment 			is AlphaUpper size 80
		LocalAribaPOType					is AlphaUpper 4
		LocalExternalRequisition			is Alpha 30	
		LocalReqHeaderComment				is RichText	
		LocalFEG							is AlphaUpper 4
		LocalTaskID							is Alpha 100
		LocalConfirmationCode 				is Alpha 100
		LocalAccountingUnit					is Alpha 25
		LocalAccount						is Alpha 26
		LocalProcessRequisitionXML 			is XMLDocument
		LocalNumberofLines					is Numeric 15
		IsDefaultDistribution				is Boolean
		ClassificationCodeLen				is Numeric 9
		LocalGeneralLedgerChartAccount		is AlphaUpper 26
		LocalRequStructureDefaultCode		is Alpha 20
		LocalTrackerID						is Numeric 15
		LocalErrorMessage 					is Alpha 300
        LocalFromLogicalID					is Alpha 40
        LocalLogicalID						is Alpha 100
        LocalComponentID					is Alpha 100
        LocalBODID							is Alpha 100
        LocalConfirmBOD						is Alpha 20
        LocalAcknowledgeBOD					is Alpha 20
        LocalStructureDefaultCodeDetail		is Numeric 9
        LocalCreateDateTime					is Alpha 25
        LocalDelete							is Alpha 9
        EAMRebuildRepair					is Boolean
        EAMProjectType						is AlphaUpper 10
        EAMProjectTaxCode					is AlphaUpper 10
        EAMDescription						is Alpha 350			
        EAMWorkOrderNumberLine				is AlphaUpper 30
		EAMWorkOrderActivityNumberLine		is Numeric 8
		EAMProjectID						is AlphaUpper 20
		DocumentReferenceLen				is Numeric 9
		LocalNumberOfLinesadded				is Numeric 15
		LocaldocumentID						is Alpha 30
		LocalCommodityCode					is like CommCodes
		LocalEAMCommodityCode				is Alpha 50
		CommodityCode						is like CommCodes
		LocalCommodityCode1					is Alpha 10
		LocalCommodityCode2					is Alpha 10
		LocalCommodityCode3					is Alpha 10
		LocalCommodityCode4					is Alpha 10
		LocalCommodityCode5					is Alpha 10
		LocalCommodityCode6					is Alpha 10
		LocalSegment1						is Numeric 10
		LocalSegment2						is Numeric 10
		LocalSegment3						is Numeric 10
		LocalSegment4						is Numeric 10
		LocalSegment5						is Numeric 10
		LocalSegment6						is Numeric 10
		LocalPurchaseFromLocation			is Alpha 40
		LocalShipFromlocation				is AlphaUpper 15 
		LocalLineNum						is Numeric 15
		LocalMainUserTemplate				is Alpha size 250
		LocalRequisitionLine				is XMLDocument
		LocalReqLineAckXML					is XMLDocument
		ProcessRequisitionLineAckXML        is XMLDocument
		OverrideContractCost				is Boolean
		HROrganization						is AlphaUpper 5
		CreatePurchaseOrder					is Boolean
		LocalItemType						is Alpha 2
		LocalOneSourceToOnePO				is Numeric 2


        LocalTotalAmount					is Alpha 100
		LocalLineLength						is Numeric 50
		LocalPulseAlertDescription			is Alpha size 300


	Derived Fields	
		
		DerivedConfigDocID is a DerivedField
			type is Alpha size 2
			restricted
			LocalConfigurationParameter = "RequiredCleanDocumentID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedConfigFEG is a DerivedField
			type is Alpha size 2
			restricted
			LocalConfigurationParameter = "IsMultipleFEG"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		ProcessRequisitionConfirmBODXML is a DerivedField
			type is XMLDocument
			restricted
			ProcessRequisitionConfirmBODXML = template.IONProcessRequisition_ConfirmBOD_ST document for this instance
		
		ProcessRequisitionAcknowledgeBODXML is a DerivedField
			type is XMLDocument
			restricted
			ProcessRequisitionAcknowledgeBODXML = template.IONProcessRequisition_AcknowledgeBOD_ST document for this instance
							
		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "tenantID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "releaseID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "logicalID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "VersionID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedGenericDelimiter is a DerivedField
			type is Alpha size 9
			restricted
			LocalConfigurationParameter = "Generic_Delimiter"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		BODCurrentTimeStamp is a DerivedField
			type is TimeStamp
			restricted
			BODCurrentTimeStamp = system current timestamp
			return BODCurrentTimeStamp
		
		AlphaCurrentTimeStamp is a DerivedField
			type is Alpha size 20
			restricted
			return BODCurrentTimeStamp	
			
		BODFormattedCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			return AlphaCurrentTimeStamp[1:4] + "-" + AlphaCurrentTimeStamp[5:6] + "-" + AlphaCurrentTimeStamp[7:8] + "T" + AlphaCurrentTimeStamp[9:10] + ":" + AlphaCurrentTimeStamp[11:12] + ":" + AlphaCurrentTimeStamp[13:14] + "Z"	
		
		DerivedBODIncludeUDFs is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "ProcessRequisition_In_Include_UDFs"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedIncludeUserDefineFields is a DerivedField
			type is Boolean
			restricted
			if(DerivedBODIncludeUDFs = "Y")
				return true
			else
				return false
				
		DerivedRequisitionShipment is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "RequisitionShipment"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedOneSourceToOnePO is a DerivedField
			type is Alpha size 10
			restricted
			LocalConfigurationParameter = "ProcessRequisition_OneSourceDocumentToOnePO"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedconfirmBodID is a DerivedField
			type is Alpha 300	
			restricted
			return "infor-nid:"+DerivedTenantID+":"+LocalAE + ":"+LocationAck+"?BOD&verb=Confirm&TrackerID="+ LocalTrackerID	
			
		DerivedAckBodID is a DerivedField
			type is Alpha 300	
			restricted
			return 	"infor-nid:"+DerivedTenantID+":"+LocalAE+":"+LocationAck+"?Requisition&verb=Ack&TrackerID="+ LocalTrackerID
		
		DerivedAcknowledgeBOD is a DerivedField
			type is Alpha 20
			restricted
			if(LocalAcknowledgeBOD = "F")
				return	"false"
			else
				return	"true"
					
		DerivedAckResponse is a DerivedField
			type is Alpha 20
			restricted
			if(DerivedAcknowledgeBOD = "true")
				return "Rejected"
			else
				return "Modified"
				
		DerivedReasonCode is a DerivedField
			type is Alpha 20
			restricted
			if(DerivedAcknowledgeBOD = "true")
				return "Application_Error"
			else
				return "Application_Success"
		
				
		DerivedDocumentID is a DerivedField
			type is Alpha 50
			restricted
			if(LocalRequisition entered and DerivedConfigDocID = "Y")
				return LocalRequisition
			else
			if(LocalRequisition entered and DerivedConfigDocID != "Y")
				return LocalReqCompany using "%d" + DerivedGenericDelimiter + LocalRequisition
			else
				return LocaldocumentID
		
		DerivedRequisitionErrorMessage is a DerivedField
			type is Alpha 300
			restricted
			return LocalErrorMessage
			
		DerivedRequisitionMessageDescription is a DerivedField
			type is Alpha 300
			restricted
			if(LocalConfirmBOD = "true")
				return "Error parsing ProcessRequisition:" + DerivedRequisitionErrorMessage + ":"+ "TrackerID="+ LocalTrackerID
			else
				return DerivedRequisitionErrorMessage 
				
		DerivedRequisitionOriginalBODMsg is a DerivedField
			type is XMLDocument
			restricted
			return LocalProcessRequisitionXML
				
		NativeItem	is a NativeField
			type is AlphaUpper 32
			restricted
				
		NativeSupplier	is a NativeField
			type is Numeric 9
			restricted	
		
		NativeShipToLocation is a NativeField
			type is Alpha 40
			restricted
		
		NativeWarehouseShipToLocation is a NativeField
			type is Alpha 40
			restricted
				
		NativeRequestingLocation is a NativeField		
			type is Alpha 40
			restricted
			
		NativeAccount	is a NativeField
			type is Alpha 50
			restricted
			
		NativeCommodityCode	is a NativeField
			type is like CommCodes
			restricted
			
		NativePurchaseFromLocation is a NativeField
			type is Alpha 40
			restricted
		
		NativeReqCompany is a NativeField
			type is Alpha 40
			restricted
			
		NativeCompany is a NativeField
			type is Alpha 40
			restricted
			

		DerivedRunGroup is a DerivedField
			type is Alpha size 50
			restricted
			return "EP"+ AlphaCurrentTimeStamp[1:4] + AlphaCurrentTimeStamp[5:6] + AlphaCurrentTimeStamp[7:8] + AlphaCurrentTimeStamp[9:10] 
		
		DerivedReqReference is a DerivedField
			type is Numeric size 7
			restricted
			return AlphaCurrentTimeStamp[3:4] + AlphaCurrentTimeStamp[9:10] + AlphaCurrentTimeStamp[11:12]
					
		SyncRequisitionPulseAlertXML is a DerivedField
			type is XMLDocument
			restricted
			SyncRequisitionPulseAlertXML = template.IONSyncRequisitionAlert_ST document for this instance
			return SyncRequisitionPulseAlertXML


	Relations
#ifdef module glif
#ifdef module po
#ifdef module GeneralLedger
#ifdef module ic
#ifdef module rq
		GeneralLedgerCompanyRel
			one-to-one relation to GeneralLedgerCompany
    		Field Mapping uses symbolic key
    			related.Company					= LocalReqCompany
    			
		PurchasingCompanyRel
			one-to-one relation to PurchasingCompany
    		Field Mapping uses symbolic key
    			related.Company					= LocalReqCompany
    	
    	StructureDefaultCodeDetailRel
    		one-to-many relation to StructureDefaultCodeDetail
    		Field Mapping uses symbolic key
    		Instance Selection
				where (	related.FinanceEnterpriseGroup	= LocalFEG
    			and		related.StructureDefaultCode	= LocalRequStructureDefaultCode)
    			
    	InventoryCompanyRel	
    		one-to-one relation to InventoryCompany
    		Field Mapping uses symbolic key
    			related.Company	=	LocalReqCompany
    			
    	ItemRel	
    		one-to-one relation to Item
    		Field Mapping uses symbolic key
    			related.ItemGroup	=	LocalItemGroup	
    			related.Item		=	LocalItem
    			
    	ItemLocationRel
    		one-to-one relation to ItemLocation
    		Field Mapping uses symbolic key
    			related.Company					=	LocalReqCompany	
    			related.InventoryLocation		=	LocalLineshiptolocation
    			related.Item					=	LocalItem
    	
    	RequestingLocationRel
    		one-to-one relation to RequestingLocation
    		Field Mapping uses symbolic key
    			related.Company					=	LocalReqCompany	
    			related.RequestingLocation		=	LocalRequestingLocation
    			
		RequisitionRel
			one-to-one relation to Requisition
			Field Mapping uses symbolic key
				related.Company					=  LocalReqCompany	
				related.Requisition				=  LocalRequisition
		
		CommodityCodeStructureRel
			one-to-one relation to CommodityCodeStructure
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup					= LocalFEG
				related.CommodityCodeStructure					= LocalItemGroup
#endif
#endif
#endif
#endif
#endif
		FinanceEnterpriseGroupRel
			one-to-one relation to FinanceEnterpriseGroup
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	=  LocalFEG		
				
		RequesterRel
			one-to-one relation to Requester
			Field Mapping uses symbolic key
				related.HROrganization			=  HROrganization		
				related.Requester				=  LocalRequester
		
		ContractLineRel
			one-to-many relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup			=	LocalItemGroup
			Instance Selection
				where (related.ItemNumber   = LocalItem)
					
		FSMBODConfigurationParameterRel
        	one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
            	related.FSMBODConfigurationParameter 		= LocalConfigurationParameter
		
		FSMInboundBODTrackerRel
            one-to-one relation to FSMInboundBODTracker
            Field Mapping uses symbolic key
                related.FSMInboundBODTracker	= LocalFSMInboundBODTracker                
		
		UserTemplateRel
			one-to-many relation to UserTemplate
			Field Mapping uses symbolic key
			Instance Selection
				where (related.UserTemplate   = LocalMainUserTemplate)
		
		FSMBODConfigurationRel
        	one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
            	related.FSMBODConfiguration.Verb 		= 2
            	related.FSMBODConfiguration.Noun 		= "Requisition"
            	related.FSMBODConfiguration.Direction 	= 2

		FSMBODCleanDocIDRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "DESTAE"
            	related.FSMBODCrossReference.DestinationField 	= "CSFGLC"
            Instance Selection
				where (related.SourceValue	= LocalAE)	
				

		FSMBODConfigurationSyncRequisitionRel
        	one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
            	related.FSMBODConfiguration.Verb 		= 1
            	related.FSMBODConfiguration.Noun 		= "Requisition"
            	related.FSMBODConfiguration.Direction 	= 2

		FSMBODConfigurationPulseAlertRel
        	one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
            	related.FSMBODConfiguration.Verb 		= 2
            	related.FSMBODConfiguration.Noun 		= "PulseAlert"
            	related.FSMBODConfiguration.Direction 	= 1


	Actions
		
		Create is a Create Action
			restricted
		
		Update is an Update Action
			restricted
		
		Delete is a Delete Action				
			restricted
			

		ProcessRequisitionBODImport is an Import Action
			restricted
			bod type is Process.Requisition	
			Parameters
				RequisitionBOD 				is XMLDocument
            Action Rules
				LocaldocumentID				= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID"
				LocalAE						= RequisitionBOD select "//DataArea/Process/AccountingEntityID"
				LocalBODID                 	= RequisitionBOD select "//ApplicationArea/BODID"
				LocalLocID					= RequisitionBOD select "//DataArea/Process/LocationID"
				LocalVariationID			= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID/@variationID"
				LocalBODXML					= RequisitionBOD
				LocalGenericDelimiter		= DerivedGenericDelimiter
				LocalReqCompany 			= NativeCompany
#ifdef module glif
#ifdef module po
#ifdef module GeneralLedger
#ifdef module ic
#ifdef module rq	

				if(DerivedConfigDocID = "Y")
					if(FSMBODCleanDocIDRel.DestinationValue entered )
						CrossAccountingEntity =  FSMBODCleanDocIDRel.DestinationValue
					else
						CrossAccountingEntity	=  LocalAE 
						
					if(DerivedConfigFEG != "Y")
						LocalReqCompany = CrossAccountingEntity
					else
					if(DerivedConfigFEG = "Y")
						if(CrossAccountingEntity entered)
							LocalReqCompany = NativeReqCompany	
						else
							LocalReqCompany = ""
							
				if(FSMBODConfigurationRel exists and FSMBODConfigurationRel.Enable)
					if(FSMInboundBODTracker not entered)
						invoke Create FSMInboundBODTracker
							assign result to NewBODTracker
							invoked.Verb 					= 2
							invoked.Noun 					= "Requisition"
							invoked.Direction				= 2
							invoked.BODXML					= LocalBODXML
							invoked.BODID					= LocalBODID
							invoked.Company					= LocalReqCompany
							invoked.BODVariationID			= LocalVariationID
							invoked.BODAccountingEntity		= LocalAE
							invoked.BODLocation				= LocalLocID
							invoked.BODDocumentID			= LocaldocumentID
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							initialize invoked.Error			
							initialize invoked.ErrorMessage
						LocalFSMInboundBODTracker = NewBODTracker.FSMInboundBODTracker
		            else
		            	LocalFSMInboundBODTracker 			= FSMInboundBODTracker
		            	invoke Update FSMInboundBODTrackerRel
							invoked.BODXML					= LocalBODXML
							invoked.BODID					= LocalBODID
							invoked.Company					= LocalReqCompany
							invoked.BODVariationID			= LocalVariationID
							invoked.BODAccountingEntity		= LocalAE
							invoked.BODDocumentID			= LocaldocumentID
							invoked.BODLocation				= LocalLocID
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							initialize invoked.Error			
							initialize invoked.ErrorMessage
							
					invoke CreateRequisition
						invoked.RequisitionBOD     		= RequisitionBOD
	                	invoked.PrmInboundTracker 		= LocalFSMInboundBODTracker	
	                	invoked.PrmReqCompany			= LocalReqCompany
	            else 
	            if(FSMInboundBODTracker not entered)
					invoke Create FSMInboundBODTracker
						assign result to NewBODTracker
						invoked.Verb 					= 2
						invoked.Noun 					= "Requisition"	
						invoked.Direction				= 2				
						invoked.Company					= LocalReqCompany
						invoked.BODAccountingEntity		= LocalAE
						invoked.BODDocumentID			= LocaldocumentID
						invoked.BODVariationID			= LocalVariationID
						invoked.BODID					= LocalBODID
						invoked.BODLocation				= LocalLocID
						invoked.BODXML					= LocalBODXML
						invoked.Status					= 4
						invoked.StartDate				= system current timestamp
						invoked.CloseDate				= system current timestamp
						invoked.Error					= true			
						invoked.ErrorMessage			= "Process Requisition Inbound BOD Service is not Enabled"
	            	LocalFSMInboundBODTracker = NewBODTracker.FSMInboundBODTracker
	            else
	            	LocalFSMInboundBODTracker = FSMInboundBODTracker
					invoke Update FSMInboundBODTrackerRel
						invoked.Company					= LocalReqCompany
						invoked.BODAccountingEntity		= LocalAE
						invoked.BODDocumentID			= LocaldocumentID
						invoked.BODVariationID			= LocalVariationID
						invoked.BODID					= LocalBODID
						invoked.BODLocation				= LocalLocID
						invoked.BODXML					= LocalBODXML
						invoked.Status					= 4
						invoked.StartDate				= system current timestamp
						invoked.CloseDate				= system current timestamp
						invoked.Error					= true			
						invoked.ErrorMessage			= "Process Requisition Inbound BOD Service is not Enabled"
	            	  	
	    CreateRequisition is an Import Action
	    	restricted			
			Parameters
				RequisitionBOD 			is XMLDocument
				PrmInboundTracker   	is like FSMInboundBODTracker
				PrmReqCompany			is Numeric 4	
			Local Fields
			Action Rules
				LocalFSMInboundBODTracker 			= PrmInboundTracker
				LocalOrganization					= RequisitionBOD select "//DataArea/Process/AccountingEntityID"
				LocaldocumentID 					= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID"
				LocalReqCompany						= PrmReqCompany
				LocalGenericDelimiter				= DerivedGenericDelimiter
				LocalRequester						= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/RequestorReference/IDs/ID"
				Localstore							= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/CustomerParty/Location[1]/ID[1]"	
				LocalRequestingLocation				= NativeRequestingLocation  
				LocalHeadershiptolocationLen		= RequisitionBOD select "count(//DataArea/Requisition/RequisitionHeader/ShipToParty/Location)"
				LocalEAMWorkOrderNumber				= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentReference/DocumentID/ID"
				LocalEAMWorkOrderActivityNumber		= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentReference/LineNumber"
				LocalExternalRequisition			= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID"
				LocalFEG							= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				LocalRequStructureDefaultCode		= PurchasingCompanyRel.RequisitionStructureDefaultCode
				LocalStructureDefaultCodeDetail		= StructureDefaultCodeDetailRel.StructureDefaultCodeDetail
				
				if(StructureDefaultCodeDetailRel exist)
					IsDefaultDistribution = true
				
				LocalIterator = 1
				while (LocalHeadershiptolocationLen >= LocalIterator)	
					LocalNameValueID	=	RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/ShipToParty/Location[<LocalIterator>]/@type"
					LocalNameValue		=	RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/ShipToParty/Location[<LocalIterator>]/ID"
					
					if(LocalNameValueID = "Ship-to")
						LocalHeadershiptolocationShipto = LocalNameValue	
					else
					if(LocalNameValueID = "Warehouse")
						LocalHeadershiptolocationWarehouse = LocalNameValue
					LocalIterator = LocalIterator + 1

				if(LocalHeadershiptolocationShipto entered)
					Localshiptolocation = LocalHeadershiptolocationShipto
				else
				if(LocalHeadershiptolocationShipto not entered and LocalHeadershiptolocationWarehouse entered)
					Localshiptolocation = LocalHeadershiptolocationWarehouse
				else
					Localshiptolocation = ""
				
				LocalHeadershiptolocation = NativeShipToLocation 	
				if(RequestingLocationRel exist)
					LocalReqLocFromLocation	=	RequestingLocationRel.FromCompanyLocation.FromLocation
					
				if(LocalHeadershiptolocation entered)
					LocalHeadershiptolocation	=	LocalHeadershiptolocation
				else
				if(LocalReqLocFromLocation	entered)
					LocalHeadershiptolocation	=	LocalReqLocFromLocation
				else
					LocalHeadershiptolocation	=	LocalRequestingLocation
				

				LocalUserAreaCount	=		RequisitionBOD select "count(//DataArea/Requisition/RequisitionHeader/UserArea/Property)"
				LocalIterator = 1
				while (LocalUserAreaCount >= LocalIterator)	
					LocalNameValueID		= 	RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/UserArea/Property[<LocalIterator>]/NameValue/@name"
					LocalNameValue			=	RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/UserArea/Property[<LocalIterator>]/NameValue"	
					if(LocalNameValueID = "eam.UDFNOTE02")
						LocalEAMDropShipComment  = LocalNameValue
					else
					if(LocalNameValueID = "eam.UDFCHAR09")
						LocalAribaPOType	= LocalNameValue
					LocalIterator = LocalIterator + 1
				
				if(DerivedIncludeUserDefineFields)
					LocalEAMDropShipComment			=	LocalEAMDropShipComment
					LocalAribaPOType				=	LocalAribaPOType
				else
					LocalEAMDropShipComment			=	""
					LocalAribaPOType				=	""
				
				if(DerivedConfigDocID = "Y")
					LocalHeadershiptolocation	=	Localshiptolocation
					LocalRequestingLocation     =    Localstore	
					

				if(DerivedRequisitionShipment = "Y" )
					LocalRequestingLocation =  LocalHeadershiptolocation					
					if(DerivedConfigDocID = "Y")
						LocalHeadershiptolocation = LocalHeadershiptolocationWarehouse
					else
						LocalHeadershiptolocation = NativeWarehouseShipToLocation
				
				if(DerivedOneSourceToOnePO = "Y")
					if(DerivedRequisitionShipment = "N")
						LocalOneSourceToOnePO = 2
					else
						LocalOneSourceToOnePO = 1
				else
				if(DerivedOneSourceToOnePO = "N" or DerivedOneSourceToOnePO not entered)	
					LocalOneSourceToOnePO = 1
				
				invoke Create Requisition
					assign result to NewRequisition
					resume on error
                   		Error            						= true
                        ErrorMessage     						= error message
					invoked.Company								= LocalReqCompany		
					invoked.Requester							= LocalRequester
					invoked.RequestingLocation					= LocalRequestingLocation
					invoked.FromCompanyLocation.FromCompany		= LocalReqCompany	
					invoked.FromCompanyLocation.FromLocation	= LocalHeadershiptolocation
					invoked.EAMWorkOrder						= LocalEAMWorkOrderNumber
					invoked.EAMWorkOrderActivity				= LocalEAMWorkOrderActivityNumber
					invoked.ShippingNotes						= LocalEAMDropShipComment 
					invoked.AribaPOType							= LocalAribaPOType
					invoked.ExternalRequisition					= LocalExternalRequisition	
					invoked.OneSourceDocumentToOnePO			= LocalOneSourceToOnePO
				if(Error)
					invoke Update FSMInboundBODTrackerRel
						invoked.Error 						= Error
						invoked.ErrorMessage 				= ErrorMessage
						invoked.Status						= 2
						invoked.CloseDate					= system current timestamp
					invoke SendRequisitionConfirmBOD
						invoked.PrmErrorMessage 			= ErrorMessage
						invoked.RequisitionBOD     			= RequisitionBOD
	                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
					invoke SendRequisitionACKBOD
                        invoked.PrmErrorMessage 			= ErrorMessage
                        invoked.RequisitionBOD     			= RequisitionBOD
	                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
	                	invoked.PrmReqCompany				= LocalReqCompany			
	                	invoked.PrmRequisition				= LocaldocumentID
				else
					LocalRequisition				= NewRequisition.Requisition
					invoke CreateRequisitionComment
						invoked.RequisitionBOD 		= RequisitionBOD
						invoked.PrmInboundTracker 	= LocalFSMInboundBODTracker
						invoked.PrmRequisition		= LocalRequisition
						invoked.PrmReqCompany		= LocalReqCompany
					invoke CreateRequisitionLine
						invoked.RequisitionBOD 				= RequisitionBOD
						invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
						invoked.PrmRequisition				= LocalRequisition
						invoked.PrmIsDefaultDistribution	= IsDefaultDistribution
						invoked.PrmRequestingLocation		= LocalRequestingLocation
	                	invoked.PrmHeadershiptolocation		= LocalHeadershiptolocation
	                	invoked.PrmRequester				= LocalRequester
	                	invoked.PrmReqCompany				= LocalReqCompany
							
		CreateRequisitionComment is an Import Action		
			restricted			
			Parameters
				RequisitionBOD 			is XMLDocument
				PrmInboundTracker   	is like FSMInboundBODTracker
				PrmRequisition			is like Requisition
				PrmReqCompany			is Numeric 4
			Action Rules
				LocalFSMInboundBODTracker 	= PrmInboundTracker
				LocalReqCompany				= PrmReqCompany
				LocalRequisition			= PrmRequisition
				LocalCommentLength			= RequisitionBOD select "count(//DataArea/Requisition/RequisitionHeader/Note)"
				LocalIterator = 1
				while(LocalCommentLength >= LocalIterator)
					LocalReqHeaderComment = RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/Note[<LocalIterator>]"
					invoke Create RequisitionComment
						invoked.Company				= LocalReqCompany	
						invoked.Requisition			= LocalRequisition
						invoked.CommentTitle		= "EAM Comments"
						invoked.CommentType			= "Print On Purchase Order"
						invoked.CommentText			= LocalReqHeaderComment
					if(Error)
						invoke Update FSMInboundBODTrackerRel
							invoked.Error 						= Error
							invoked.ErrorMessage 				= ErrorMessage
							invoked.Status						= 2
							invoked.CloseDate					= system current timestamp
						invoke SendRequisitionConfirmBOD
							invoked.PrmErrorMessage 			= ErrorMessage
							invoked.RequisitionBOD     			= RequisitionBOD
		                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
						invoke SendRequisitionACKBOD
	                        invoked.PrmErrorMessage 			= ErrorMessage
	                        invoked.RequisitionBOD     			= RequisitionBOD
		                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
		                	invoked.PrmReqCompany				= LocalReqCompany		
		                	invoked.PrmRequisition				= NewRequisition.Requisition	
		                LocalIterator 	= LocalCommentLength + 1		
	               	else
	               		LocalIterator	= LocalIterator + 1	

		CreateRequisitionLine is an Import Action		
			restricted			
			Parameters
				RequisitionBOD 					is XMLDocument
				PrmInboundTracker   			is like FSMInboundBODTracker
				PrmRequisition					is like Requisition
				PrmIsDefaultDistribution		is Boolean
				PrmRequestingLocation 			is AlphaUpper 20
				PrmHeadershiptolocation			is Alpha 50	
				PrmRequester					is Numeric 13
				PrmReqCompany					is Numeric 4
			Local Fields
				LocalRequisitionLine			is XMLDocument
			Action Rules
				LocalFSMInboundBODTracker 	= 	PrmInboundTracker
				IsDefaultDistribution		=	PrmIsDefaultDistribution
				LocalRequisition			=	PrmRequisition
				LocalReqCompany				=	PrmReqCompany
				LocalRequestingLocation		=	PrmRequestingLocation
				LocalFEG					=	GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				LocalRequester				=	PrmRequester	
				HROrganization				=	FinanceEnterpriseGroupRel.HROrganization
				OverrideContractCost		=	RequesterRel.OverrideContractCost
				LocalNumberofLines			=	0
				LocalRequisitionLineLength	=	RequisitionBOD select "count (//DataArea/Requisition/RequisitionLine)"
				LocalreqLineCounter =	1
				while(LocalRequisitionLineLength >= LocalreqLineCounter)

					initialize EAMRebuildRepair 
					initialize EAMProjectType 
					initialize EAMProjectTaxCode 
					initialize EAMDescription 
					initialize LocalInventoryItemComment 
					initialize LocalServiceItemComment
					initialize EAMWorkOrderNumberLine	
					initialize EAMWorkOrderActivityNumberLine 
					initialize EAMProjectID
					initialize Localshiptolocation
					initialize LocalLineshiptolocationShipto
					initialize LocalLineshiptolocationWarehouse
					initialize CommodityCode
					initialize LocalCommodityCode
					initialize LocalEAMCommodityCode
					initialize LocalCommodityCode1
					initialize LocalCommodityCode2
					initialize LocalCommodityCode3
					initialize LocalCommodityCode4
					initialize LocalCommodityCode5
					initialize LocalCommodityCode6
					LocalNumberofLines					=	LocalNumberofLines + 1
					LocalRequisitionLine				= 	RequisitionBOD select "//DataArea/Requisition/RequisitionLine[<LocalreqLineCounter>]"
					LocalGenericDelimiter				=  	DerivedGenericDelimiter
					LocalRequestedItem					=	LocalRequisitionLine select "/RequisitionLine/Item/ItemID/ID"	
					LocalReqLineDescription				=	LocalRequisitionLine select "/RequisitionLine/Item/Description"
					LocalUOM							=	LocalRequisitionLine select "/RequisitionLine/Quantity/@unitCode"
					LocalItem							=	NativeItem
					LocalTempSupplier					=	LocalRequisitionLine select "/RequisitionLine/SupplierParty/PartyIDs/ID"
					LocalSupplier						=	NativeSupplier
					LocalQuantity						=	LocalRequisitionLine select "/RequisitionLine/Quantity"
					LocalUnitCost						=	LocalRequisitionLine select "/RequisitionLine/UnitPrice/Amount"
					LocalServiceIndicator				=	LocalRequisitionLine select "/RequisitionLine/Item/ServiceIndicator"
					LocalFixedpriceFlag					=	LocalRequisitionLine select "/RequisitionLine/FixedPriceItemIndicator"
					LocalExpensableItemflag				=	LocalRequisitionLine select "/RequisitionLine/ExpensableItemIndicator"
					LocalPurchaseFromLocation			=	LocalRequisitionLine select "/RequisitionLine/ShipFromParty/PartyIDs/ID"
					LocalShipFromlocation 				=   NativePurchaseFromLocation
					LocalTotalAmount					=	LocalRequisitionLine select "/RequisitionLine/TotalAmount"

					LocalReqLineAckXML					= template.IONProcessRequisitionLine_AcknowledgeBOD_ST document
					ProcessRequisitionLineAckXML		+= LocalReqLineAckXML
					initialize LocalReqLineAckXML

					if(LocalItem = "undefined")
						LocalItem = LocalRequestedItem						

					if (LocalSupplier = "undefined")
						LocalSupplier	= ""
					else	
						if(LocalUnitCost != 0)
							LocalCostOption = 1
						else
						if(LocalUnitCost = 0)
							if(LocalExpensableItemflag = true)
								LocalCostOption = 2
							else
							if(LocalExpensableItemflag = false)
								LocalCostOption = 1

					LocalUserAreaCount		=	LocalRequisitionLine select "count(/RequisitionLine/UserArea/Property)"	
					LocalIterator = 1
					while (LocalUserAreaCount >= LocalIterator)
						LocalNameValueID	=	LocalRequisitionLine select "/RequisitionLine/UserArea/Property[<LocalIterator>]/NameValue/@name"
						LocalNameValue		=	LocalRequisitionLine select "/RequisitionLine/UserArea/Property[<LocalIterator>]/NameValue"
						if(LocalNameValueID 	= "eam.UDFCHKBOX01")
							EAMRebuildRepair 	= LocalNameValue
						else
						if(LocalNameValueID 	= "eam.UDFCHAR23")
							EAMProjectType   	= LocalNameValue
						else
						if(LocalNameValueID		= "eam.UDFCHAR24")
							EAMProjectTaxCode  	= LocalNameValue
						else
						if(LocalNameValueID 	= "eam.Notes")
							EAMDescription   	= LocalNameValue
						else
						if(LocalNameValueID 	= "eam.PartLongDescription")
							LocalInventoryItemComment = LocalNameValue
						else
						if(LocalNameValueID 	= "eam.ServiceLongDescription")
							LocalServiceItemComment = LocalNameValue
						LocalIterator = LocalIterator + 1
					
					if(LocalInventoryItemComment not entered)
						LocalComment	= LocalServiceItemComment
					else
						LocalComment	= LocalInventoryItemComment
						
					if(LocalComment entered)
						CommentsCount = 1
						
					if(InventoryCompanyRel exist)
						LocalItemGroup	= InventoryCompanyRel.ItemGroup
					else
						LocalItemGroup	= ""		
					
					DocumentReferenceLen	= LocalRequisitionLine select "count(/RequisitionLine/DocumentReference)"
					LocalIterator = 1
					while (DocumentReferenceLen >= LocalIterator)	
						LocalNameValueID	= LocalRequisitionLine select "/RequisitionLine/DocumentReference[<LocalIterator>]/@type"
						LocalNameValue		= LocalRequisitionLine select "/RequisitionLine/DocumentReference[<LocalIterator>]/DocumentID/ID"
						LocalNameValue1		= LocalRequisitionLine select "/RequisitionLine/DocumentReference[<LocalIterator>]/LineNumber"
						if(LocalNameValueID = "MaintenanceOrder")
							EAMWorkOrderNumberLine  = LocalNameValue
							EAMWorkOrderActivityNumberLine = LocalNameValue1	 
						else
						if(LocalNameValueID = "Project")
							EAMProjectID  = LocalNameValue
						LocalIterator = LocalIterator + 1
					
					LocalLineshiptolocationLen		= LocalRequisitionLine select "count(/RequisitionLine/ShipToParty/Location)"
					LocalIterator = 1
					while (LocalLineshiptolocationLen >= LocalIterator)	
						LocalNameValueID	= LocalRequisitionLine select "/RequisitionLine/ShipToParty/Location[<LocalIterator>]/@type"
						LocalNameValue		= LocalRequisitionLine select "/RequisitionLine/ShipToParty/Location[<LocalIterator>]/ID"
						if(LocalNameValueID = "Ship-to")
							LocalLineshiptolocationShipto = LocalNameValue	
						else
						if(LocalNameValueID = "Warehouse")
							LocalLineshiptolocationWarehouse = LocalNameValue
						LocalIterator = LocalIterator + 1

					if(LocalLineshiptolocationShipto entered)
						Localshiptolocation = LocalLineshiptolocationShipto
					else
					if(LocalLineshiptolocationShipto not entered and LocalLineshiptolocationWarehouse entered)
						Localshiptolocation = LocalLineshiptolocationWarehouse
					else
						Localshiptolocation = ""
					

					LocalLineshiptolocation	= NativeShipToLocation 
					
					if(LocalLineshiptolocation not entered)
						LocalLineshiptolocation = PrmHeadershiptolocation
					
					if(ItemLocationRel exist and ItemLocationRel.InventoryTracked = "true")
						ItemlocExistsandTracked = true
					else
						ItemlocExistsandTracked = false
					
					ClassificationCodeLen	= LocalRequisitionLine select "count(/RequisitionLine/Item/Classification/Codes/Code)"
					LocalIterator = 1
					while (ClassificationCodeLen >= LocalIterator)
						LocalNameValueID	= LocalRequisitionLine select "/RequisitionLine/Item/Classification[<LocalIterator>]/Codes/Code/@listID"
						LocalNameValue		= LocalRequisitionLine select "/RequisitionLine/Item/Classification[<LocalIterator>]/Codes/Code"
						if(LocalNameValueID = "Cost Centers")
							AccountStringLINE = LocalNameValue
						else
						if(LocalNameValueID = "Commodity Codes")
							LocalCommodityCode = LocalNameValue
							LocalEAMCommodityCode = LocalNameValue
						LocalIterator = LocalIterator + 1
						
					if(AccountStringLINE entered)
						LocalAccountingEntity =	NativeAccount
					
					if(RequestingLocationRel exist)
						LocalAccountingUnit				= RequestingLocationRel.IssueAccount.AccountingUnit
						LocalGeneralLedgerChartAccount	= RequestingLocationRel.IssueAccount.GeneralLedgerChartAccount
						LocalAE 						= RequestingLocationRel.IssueAccount.ToAccountingEntity
					else
						LocalAccountingUnit				= ""
						LocalGeneralLedgerChartAccount	= ""
						LocalAE							= ""
							

					if(CommodityCodeStructureRel exist)
						LocalSegment1					= CommodityCodeStructureRel.Segments.Segment[1].Size
						LocalSegment2					= CommodityCodeStructureRel.Segments.Segment[2].Size
						LocalSegment3					= CommodityCodeStructureRel.Segments.Segment[3].Size
						LocalSegment4					= CommodityCodeStructureRel.Segments.Segment[4].Size
						LocalSegment5					= CommodityCodeStructureRel.Segments.Segment[5].Size
						LocalSegment6					= CommodityCodeStructureRel.Segments.Segment[6].Size
						LocalCommodityCode				= NativeCommodityCode
						LocalCommodityCodeDelimiter		= "-"
						LocalCommodityCode1			= LocalCommodityCode1
						LocalCommodityCode2			= LocalCommodityCode2
						LocalCommodityCode3			= LocalCommodityCode3
						LocalCommodityCode4			= LocalCommodityCode4
						LocalCommodityCode5			= LocalCommodityCode5	
						LocalCommodityCode6			=LocalCommodityCode6
						
						if(LocalCommodityCode2 not entered)
							CommodityCode	=	LocalCommodityCode1
						else
						if(LocalCommodityCode3 not entered)
							CommodityCode	= LocalCommodityCode1+LocalCommodityCodeDelimiter+LocalCommodityCode2
						else
						if(LocalCommodityCode4 not entered)
							CommodityCode	= LocalCommodityCode1+LocalCommodityCodeDelimiter+LocalCommodityCode2+LocalCommodityCodeDelimiter+LocalCommodityCode3
						else
						if(LocalCommodityCode5 not entered)
							CommodityCode	= LocalCommodityCode1+LocalCommodityCodeDelimiter+LocalCommodityCode2+LocalCommodityCodeDelimiter+LocalCommodityCode3+LocalCommodityCodeDelimiter+LocalCommodityCode4
						else
						if(LocalCommodityCode6 not entered)
							CommodityCode	= LocalCommodityCode1+LocalCommodityCodeDelimiter+LocalCommodityCode2+LocalCommodityCodeDelimiter+LocalCommodityCode3+LocalCommodityCodeDelimiter+LocalCommodityCode4+LocalCommodityCodeDelimiter+LocalCommodityCode5
														

					if(CommodityCode entered)
						CommodityCode				= CommodityCode
					else
						CommodityCode				= LocalEAMCommodityCode
						
					if(DerivedIncludeUserDefineFields)
						EAMRebuildRepair			= EAMRebuildRepair
						EAMProjectType				= EAMProjectType
						EAMProjectTaxCode			= EAMProjectTaxCode
						CommodityCode				= CommodityCode
					else
						EAMRebuildRepair			= ""
						EAMProjectType				= ""
						EAMProjectTaxCode			= ""
						CommodityCode				= ""
					
					if(LocalFixedpriceFlag = "true")
						LocalUnitCost = LocalTotalAmount
						
					if(!OverrideContractCost)
						if(ContractLineRel exists)
							if(ItemlocExistsandTracked = "true" and LocalExpensableItemflag = "false")
								LocalUnitCost = ""
							else 
							if((ItemlocExistsandTracked = "false") or (ItemlocExistsandTracked = "true" and LocalExpensableItemflag = "true"))
								LocalUnitCost = ""
					
					if(DerivedConfigDocID = "Y")
						LocalItem				 = LocalRequestedItem
						LocalSupplier			 = LocalTempSupplier
						LocalShipFromlocation	 = LocalPurchaseFromLocation
						LocalLineshiptolocation	 = Localshiptolocation
						

					if(DerivedRequisitionShipment = "Y" )
						if(DerivedConfigDocID = "Y")
							LocalLineshiptolocation = LocalLineshiptolocationWarehouse
						else
							LocalHeadershiptolocationWarehouse = LocalLineshiptolocationWarehouse
							LocalLineshiptolocation				= NativeWarehouseShipToLocation
					
					if(DerivedRequisitionShipment = "Y" )
						if(ItemlocExistsandTracked = "true" and LocalExpensableItemflag = "false")
							CreatePurchaseOrder = false
						else 
						if((ItemlocExistsandTracked = "false") or (ItemlocExistsandTracked = "true" and LocalExpensableItemflag = "true"))
							CreatePurchaseOrder = false
					else
						CreatePurchaseOrder = true
						

					if(DerivedRequisitionShipment = "Y" )
						LocalItemType = ""
					else
					if(ItemlocExistsandTracked = "true" and LocalExpensableItemflag = "false")
						LocalItemType = "I"
					else 
					if((ItemlocExistsandTracked = "false") or (ItemlocExistsandTracked = "true" and LocalExpensableItemflag = "true"))
						LocalItemType = "N"
						
					if(LocalServiceIndicator = true and LocalFixedpriceFlag = true)
						invoke Create RequisitionLine
							assign result to NewRequisitionLine
							resume on error
		                   		Error            						= true
		                        ErrorMessage     						= error message
							invoked.Company								= LocalReqCompany
							invoked.Requisition							= LocalRequisition
							invoked.Quantity							= "1"
							invoked.Description							= LocalReqLineDescription
							invoked.Item								= LocalItem
							invoked.ItemType							= "S"
							invoked.ServiceCode							= "A"
							invoked.EnteredUOM							= LocalUOM
							invoked.CreatePurchaseOrder					= "T"
							invoked.TransactionUnitCost					= LocalUnitCost
							invoked.Vendor								= LocalSupplier
							invoked.EAMWorkOrder						= EAMWorkOrderNumberLine 
							invoked.EAMWorkOrderActivity				= EAMWorkOrderActivityNumberLine 
							invoked.EAMProjectTaxCode					= EAMProjectTaxCode 
							invoked.EAMProjectType						= EAMProjectType
							invoked.EAMTrade							= LocalItem 
							invoked.EAMProjectID						= EAMProjectID  
							invoked.EAMDescription						= EAMDescription 
							invoked.PurchaseFromLocation				= LocalShipFromlocation 
							invoked.FromCompanyLocationBin.FromLocation	= LocalLineshiptolocation 
							invoked.CommodityCode						= CommodityCode
							invoked.RebuildRepair						= EAMRebuildRepair
						if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 						= Error
								invoked.ErrorMessage 				= ErrorMessage
								invoked.Status						= 2
								invoked.CloseDate					= system current timestamp
							invoke SendRequisitionConfirmBOD
								invoked.PrmErrorMessage 			= ErrorMessage
								invoked.RequisitionBOD     			= RequisitionBOD
			                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
							invoke SendRequisitionACKBOD
		                        invoked.PrmErrorMessage 			= ErrorMessage
		                        invoked.RequisitionBOD     			= RequisitionBOD
			                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
			                	invoked.PrmReqCompany				= LocalReqCompany		
			                	invoked.PrmRequisition				= LocalRequisition
			                	invoked.PrmLinenum					= LocalreqLineCounter
			                invoke DeleteRequisition
								invoked.RequisitionBOD 				= RequisitionBOD
								invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
								invoked.PrmRequisition				= LocalRequisition
								invoked.PrmReqCompany				= LocalReqCompany		
			                LocalreqLineCounter = LocalRequisitionLineLength + 1
		                else
		                	LocalNumberOfLinesadded	=	LocalNumberOfLinesadded + 1
							LocalreqLineCounter		=	LocalreqLineCounter +  1
							if (LocalreqLineCounter%20 = 0)
			        			commit transaction	
						if(CommentsCount >0)
							LocalReqLine	=	NewRequisitionLine.RequisitionLine
							invoke Create RequisitionLineComment
								resume on error
			                   		Error            					= true
			                        ErrorMessage     					= error message
								invoked.Company							= LocalReqCompany		
								invoked.Requisition						= LocalRequisition
								invoked.RequisitionLine					= LocalReqLine
								invoked.SequenceNumber					= ""
								invoked.CommentType						= "P"
								invoked.CommentTitle					= "Long Description"
								invoked.CommentText						= LocalComment
							if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 						= Error
									invoked.ErrorMessage 				= ErrorMessage
									invoked.Status						= 2
									invoked.CloseDate					= system current timestamp
								invoke SendRequisitionConfirmBOD
									invoked.PrmErrorMessage 			= ErrorMessage
									invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
								invoke SendRequisitionACKBOD
			                        invoked.PrmErrorMessage 			= ErrorMessage
			                        invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
				                	invoked.PrmReqCompany				= LocalReqCompany		
				                	invoked.PrmRequisition				= LocalRequisition
				                	invoked.PrmLinenum					= LocalreqLineCounter
								LocalreqLineCounter = LocalRequisitionLineLength + 1
						if(IsDefaultDistribution = false)
							invoke Create RequisitionLineDistribution
								resume on error
			                   		Error            									= true
			                        ErrorMessage     									= error message
			                    invoked.Company											= LocalReqCompany	
								invoked.Requisition										= LocalRequisition
								invoked.RequisitionLine									= LocalNumberOfLinesadded
								invoked.DistributionAccount.ToAccountingEntity			= LocalAE			
								invoked.DistributionAccount.AccountingUnit				= LocalAccountingUnit
           						invoked.DistributionAccount.GeneralLedgerChartAccount	= LocalGeneralLedgerChartAccount
           					if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 						= Error
									invoked.ErrorMessage 				= ErrorMessage
									invoked.Status						= 2
									invoked.CloseDate					= system current timestamp
								invoke SendRequisitionConfirmBOD
									invoked.PrmErrorMessage 			= ErrorMessage
									invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
								invoke SendRequisitionACKBOD
			                        invoked.PrmErrorMessage 			= ErrorMessage
			                        invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
				                	invoked.PrmReqCompany				= LocalReqCompany		
				                	invoked.PrmRequisition				= LocalRequisition
				                	invoked.PrmLinenum					= LocalreqLineCounter
				                invoke DeleteRequisition
									invoked.RequisitionBOD 				= RequisitionBOD
									invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
									invoked.PrmRequisition				= LocalRequisition
									invoked.PrmReqCompany				= LocalReqCompany		
								LocalreqLineCounter = LocalRequisitionLineLength + 1
					else
					if(LocalServiceIndicator = true and LocalFixedpriceFlag = false)
						invoke Create RequisitionLine
							assign result to NewRequisitionLine
							resume on error
		                   		Error            						= true
		                        ErrorMessage     						= error message
							invoked.Company								= LocalReqCompany
							invoked.Requisition							= LocalRequisition
							invoked.Quantity							= LocalQuantity
							invoked.Description							= LocalReqLineDescription
							invoked.Item								= LocalItem
							invoked.ItemType							= "S"
							invoked.ServiceCode							= "Q"
							invoked.EnteredUOM							= LocalUOM
							invoked.CreatePurchaseOrder					= "T"
							invoked.TransactionUnitCost					= LocalUnitCost
							invoked.Vendor								= LocalSupplier
							invoked.EAMWorkOrder						= EAMWorkOrderNumberLine 
							invoked.EAMWorkOrderActivity				= EAMWorkOrderActivityNumberLine 
							invoked.EAMProjectTaxCode					= EAMProjectTaxCode 
							invoked.EAMProjectType						= EAMProjectType
							invoked.EAMTrade							= LocalItem 
							invoked.EAMProjectID						= EAMProjectID  
							invoked.EAMDescription						= EAMDescription 
							invoked.PurchaseFromLocation				= LocalShipFromlocation 
							invoked.FromCompanyLocationBin.FromLocation	= LocalLineshiptolocation 
							invoked.CommodityCode						= CommodityCode
							invoked.RebuildRepair						= EAMRebuildRepair
						if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 						= Error
								invoked.ErrorMessage 				= ErrorMessage
								invoked.Status						= 2
								invoked.CloseDate					= system current timestamp
							invoke SendRequisitionConfirmBOD
								invoked.PrmErrorMessage 			= ErrorMessage
								invoked.RequisitionBOD     			= RequisitionBOD
			                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
							invoke SendRequisitionACKBOD
		                        invoked.PrmErrorMessage 			= ErrorMessage
		                        invoked.RequisitionBOD     			= RequisitionBOD
			                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
			                	invoked.PrmReqCompany				= LocalReqCompany		
			                	invoked.PrmRequisition				= LocalRequisition
			                	invoked.PrmLinenum					= LocalreqLineCounter
			                invoke DeleteRequisition
								invoked.RequisitionBOD 				= RequisitionBOD
								invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
								invoked.PrmRequisition				= LocalRequisition
								invoked.PrmReqCompany				= LocalReqCompany		
			                LocalreqLineCounter = LocalRequisitionLineLength + 1
			            else
			            	LocalNumberOfLinesadded	=	LocalNumberOfLinesadded + 1
							LocalreqLineCounter		=	LocalreqLineCounter +  1
							if (LocalreqLineCounter%20 = 0)
			        			commit transaction
						if(CommentsCount >0)
							LocalReqLine	=	NewRequisitionLine.RequisitionLine
							invoke Create RequisitionLineComment
								resume on error
			                   		Error            					= true
			                        ErrorMessage     					= error message
								invoked.Company							= LocalReqCompany		
								invoked.Requisition						= LocalRequisition
								invoked.RequisitionLine					= LocalReqLine
								invoked.SequenceNumber					= ""
								invoked.CommentType						= "P"
								invoked.CommentTitle					= "Long Description"
								invoked.CommentText						= LocalComment
							if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 						= Error
									invoked.ErrorMessage 				= ErrorMessage
									invoked.Status						= 2
									invoked.CloseDate					= system current timestamp
								invoke SendRequisitionConfirmBOD
									invoked.PrmErrorMessage 			= ErrorMessage
									invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
								invoke SendRequisitionACKBOD
			                        invoked.PrmErrorMessage 			= ErrorMessage
			                        invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
				                	invoked.PrmReqCompany				= LocalReqCompany		
				                	invoked.PrmRequisition				= LocalRequisition
				                	invoked.PrmLinenum					= LocalreqLineCounter
				                LocalreqLineCounter = LocalRequisitionLineLength + 1
						if(IsDefaultDistribution	=	false)
							invoke Create RequisitionLineDistribution
								resume on error
			                   		Error            									= true
			                        ErrorMessage     									= error message
			                    invoked.Company											= LocalReqCompany		
								invoked.Requisition										= LocalRequisition
								invoked.RequisitionLine									= LocalNumberOfLinesadded
								invoked.DistributionAccount.ToAccountingEntity			= LocalAE			
								invoked.DistributionAccount.AccountingUnit				= LocalAccountingUnit
           						invoked.DistributionAccount.GeneralLedgerChartAccount	= LocalGeneralLedgerChartAccount
           					if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 						= Error
									invoked.ErrorMessage 				= ErrorMessage
									invoked.Status						= 2
									invoked.CloseDate					= system current timestamp
								invoke SendRequisitionConfirmBOD
									invoked.PrmErrorMessage 			= ErrorMessage
									invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
								invoke SendRequisitionACKBOD
			                        invoked.PrmErrorMessage 			= ErrorMessage
			                        invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
				                	invoked.PrmReqCompany				= LocalReqCompany		
				                	invoked.PrmRequisition				= LocalRequisition
				                	invoked.PrmLinenum					= LocalreqLineCounter
				                invoke DeleteRequisition
									invoked.RequisitionBOD 				= RequisitionBOD
									invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
									invoked.PrmRequisition				= LocalRequisition
									invoked.PrmReqCompany				= LocalReqCompany		
								LocalreqLineCounter = LocalRequisitionLineLength + 1         
					else
					if(ItemRel exist)	
						if(ItemlocExistsandTracked = "true" and LocalExpensableItemflag = "false")
							invoke Create RequisitionLine
								assign result to NewRequisitionLine
								resume on error
			                   		Error            						= true
			                        ErrorMessage     						= error message
								invoked.Company								= LocalReqCompany
								invoked.Requisition							= LocalRequisition
								invoked.Quantity							= LocalQuantity
								invoked.Description							= LocalReqLineDescription
								invoked.Item								= LocalItem
								invoked.ItemType							= LocalItemType
								invoked.TransactionUnitCost					= LocalUnitCost
								invoked.EnteredUOM							= LocalUOM
								invoked.CreatePurchaseOrder					= CreatePurchaseOrder
								invoked.Vendor								= LocalSupplier
								invoked.EAMWorkOrder						= EAMWorkOrderNumberLine 
								invoked.EAMWorkOrderActivity				= EAMWorkOrderActivityNumberLine 
								invoked.EAMProjectTaxCode					= EAMProjectTaxCode 
								invoked.EAMProjectType						= EAMProjectType
								invoked.EAMTrade							= LocalItem 
								invoked.EAMProjectID						= EAMProjectID  
								invoked.EAMDescription						= EAMDescription 
								invoked.PurchaseFromLocation				= LocalShipFromlocation 
								invoked.FromCompanyLocationBin.FromLocation	= LocalLineshiptolocation 
								invoked.CommodityCode						= CommodityCode
								invoked.RebuildRepair						= EAMRebuildRepair							
							if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 						= Error
									invoked.ErrorMessage 				= ErrorMessage
									invoked.Status						= 2
									invoked.CloseDate					= system current timestamp
								invoke SendRequisitionConfirmBOD
									invoked.PrmErrorMessage 			= ErrorMessage
									invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
								invoke SendRequisitionACKBOD
			                        invoked.PrmErrorMessage 			= ErrorMessage
			                        invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
				                	invoked.PrmReqCompany				= LocalReqCompany		
				                	invoked.PrmRequisition				= LocalRequisition
				                	invoked.PrmLinenum					= LocalreqLineCounter
				                invoke DeleteRequisition
									invoked.RequisitionBOD 		= RequisitionBOD
									invoked.PrmInboundTracker 	= LocalFSMInboundBODTracker
									invoked.PrmRequisition		= LocalRequisition
									invoked.PrmReqCompany		= LocalReqCompany		
				                LocalreqLineCounter = LocalRequisitionLineLength + 1
							else
								LocalNumberOfLinesadded	=	LocalNumberOfLinesadded + 1
								LocalreqLineCounter		=	LocalreqLineCounter +  1
								if (LocalreqLineCounter%20 = 0)
			        				commit transaction
							if(CommentsCount >0)
								LocalReqLine	=	NewRequisitionLine.RequisitionLine
								invoke Create RequisitionLineComment
									resume on error
				                   		Error            					= true
				                        ErrorMessage     					= error message
									invoked.Company							= LocalReqCompany		
									invoked.Requisition						= LocalRequisition
									invoked.RequisitionLine					= LocalReqLine
									invoked.SequenceNumber					= ""
									invoked.CommentType						= "P"
									invoked.CommentTitle					= "Long Description"
									invoked.CommentText						= LocalComment
								if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 						= Error
										invoked.ErrorMessage 				= ErrorMessage
										invoked.Status						= 2
										invoked.CloseDate					= system current timestamp
									invoke SendRequisitionConfirmBOD
										invoked.PrmErrorMessage 			= ErrorMessage
										invoked.RequisitionBOD     			= RequisitionBOD
					                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
									invoke SendRequisitionACKBOD
				                        invoked.PrmErrorMessage 			= ErrorMessage
				                        invoked.RequisitionBOD     			= RequisitionBOD
					                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
					                	invoked.PrmReqCompany				= LocalReqCompany		
					                	invoked.PrmRequisition				= LocalRequisition
					                	invoked.PrmLinenum					= LocalreqLineCounter
					                LocalreqLineCounter = LocalRequisitionLineLength + 1
							if(IsDefaultDistribution	=	false)
								invoke Create RequisitionLineDistribution
									resume on error
				                   		Error            									= true
				                        ErrorMessage     									= error message
				                    invoked.Company											= LocalReqCompany		
									invoked.Requisition										= LocalRequisition
									invoked.RequisitionLine									= LocalNumberOfLinesadded
									invoked.DistributionAccount.ToAccountingEntity			= LocalAE			
									invoked.DistributionAccount.AccountingUnit				= LocalAccountingUnit
	           						invoked.DistributionAccount.GeneralLedgerChartAccount	= LocalGeneralLedgerChartAccount
	           					if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 						= Error
										invoked.ErrorMessage 				= ErrorMessage
										invoked.Status						= 2
										invoked.CloseDate					= system current timestamp
									invoke SendRequisitionConfirmBOD
										invoked.PrmErrorMessage 			= ErrorMessage
										invoked.RequisitionBOD     			= RequisitionBOD
					                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
									invoke SendRequisitionACKBOD
				                        invoked.PrmErrorMessage 			= ErrorMessage
				                        invoked.RequisitionBOD     			= RequisitionBOD
					                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
					                	invoked.PrmReqCompany				= LocalReqCompany		
					                	invoked.PrmRequisition				= LocalRequisition
					                	invoked.PrmLinenum					= LocalreqLineCounter
					                invoke DeleteRequisition
										invoked.RequisitionBOD 				= RequisitionBOD
										invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
										invoked.PrmRequisition				= LocalRequisition
										invoked.PrmReqCompany				= LocalReqCompany		
									LocalreqLineCounter = LocalRequisitionLineLength + 1
						else 
						if((ItemlocExistsandTracked = "false") or (ItemlocExistsandTracked = "true" and LocalExpensableItemflag = "true"))
							invoke Create RequisitionLine
								assign result to NewRequisitionLine
								resume on error
			                   		Error            						= true
			                        ErrorMessage     						= error message
								invoked.Company								= LocalReqCompany
								invoked.Requisition							= LocalRequisition
								invoked.Quantity							= LocalQuantity
								invoked.Description							= LocalReqLineDescription
								invoked.Item								= LocalItem
								invoked.ItemType							= LocalItemType
								invoked.TransactionUnitCost					= LocalUnitCost
								invoked.EnteredUOM							= LocalUOM
								invoked.CreatePurchaseOrder					= CreatePurchaseOrder
								invoked.Vendor								= LocalSupplier
								invoked.UnitCost							= LocalUnitCost 
								invoked.EAMWorkOrder						= EAMWorkOrderNumberLine 
								invoked.EAMWorkOrderActivity				= EAMWorkOrderActivityNumberLine 
								invoked.EAMProjectTaxCode					= EAMProjectTaxCode 
								invoked.EAMProjectType						= EAMProjectType
								invoked.EAMTrade							= LocalItem 
								invoked.EAMProjectID						= EAMProjectID  
								invoked.EAMDescription						= EAMDescription 
								invoked.PurchaseFromLocation				= LocalShipFromlocation 
								invoked.FromCompanyLocationBin.FromLocation	= LocalLineshiptolocation 
								invoked.CommodityCode						= CommodityCode
								invoked.RebuildRepair						= EAMRebuildRepair							
							if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 						= Error
									invoked.ErrorMessage 				= ErrorMessage
									invoked.Status						= 2
									invoked.CloseDate					= system current timestamp
								invoke SendRequisitionConfirmBOD
									invoked.PrmErrorMessage 			= ErrorMessage
									invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
								invoke SendRequisitionACKBOD
			                        invoked.PrmErrorMessage 			= ErrorMessage
			                        invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
				                	invoked.PrmReqCompany				= LocalReqCompany		
				                	invoked.PrmRequisition				= LocalRequisition
				                	invoked.PrmLinenum					= LocalreqLineCounter
				                invoke DeleteRequisition
									invoked.RequisitionBOD 				= RequisitionBOD
									invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
									invoked.PrmRequisition				= LocalRequisition
									invoked.PrmReqCompany				= LocalReqCompany		
				                LocalreqLineCounter = LocalRequisitionLineLength + 1
							else
								LocalNumberOfLinesadded	=	LocalNumberOfLinesadded + 1
								LocalreqLineCounter		=	LocalreqLineCounter +  1
								if (LocalreqLineCounter%20 = 0)
			        				commit transaction
							if(CommentsCount >0)
								LocalReqLine	=	NewRequisitionLine.RequisitionLine
								invoke Create RequisitionLineComment
									resume on error
				                   		Error            						= true
				                        ErrorMessage     						= error message
									invoked.Company								= LocalReqCompany		
									invoked.Requisition							= LocalRequisition
									invoked.RequisitionLine						= LocalReqLine
									invoked.SequenceNumber						= ""
									invoked.CommentType							= "P"
									invoked.CommentTitle						= "Long Description"
									invoked.CommentText							= LocalComment
								if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 						= Error
										invoked.ErrorMessage 				= ErrorMessage
										invoked.Status						= 2
										invoked.CloseDate					= system current timestamp
									invoke SendRequisitionConfirmBOD
										invoked.PrmErrorMessage 			= ErrorMessage
										invoked.RequisitionBOD     			= RequisitionBOD
					                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
									invoke SendRequisitionACKBOD
				                        invoked.PrmErrorMessage 			= ErrorMessage
				                        invoked.RequisitionBOD     			= RequisitionBOD
					                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
					                	invoked.PrmReqCompany				= LocalReqCompany		
					                	invoked.PrmRequisition				= LocalRequisition
					                	invoked.PrmLinenum					= LocalreqLineCounter
					                LocalreqLineCounter = LocalRequisitionLineLength + 1
							if(IsDefaultDistribution	=	false)
								invoke Create RequisitionLineDistribution
									resume on error
				                   		Error            									= true
				                        ErrorMessage     									= error message
				                    invoked.Company											= LocalReqCompany		
									invoked.Requisition										= LocalRequisition
									invoked.RequisitionLine									= LocalNumberOfLinesadded
									invoked.DistributionAccount.ToAccountingEntity			= LocalAE			
									invoked.DistributionAccount.AccountingUnit				= LocalAccountingUnit
	           						invoked.DistributionAccount.GeneralLedgerChartAccount	= LocalGeneralLedgerChartAccount
	           					if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 						= Error
										invoked.ErrorMessage 				= ErrorMessage
										invoked.Status						= 2
										invoked.CloseDate					= system current timestamp
									invoke SendRequisitionConfirmBOD
										invoked.PrmErrorMessage 			= ErrorMessage
										invoked.RequisitionBOD     			= RequisitionBOD
					                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
									invoke SendRequisitionACKBOD
				                        invoked.PrmErrorMessage 			= ErrorMessage
				                        invoked.RequisitionBOD     			= RequisitionBOD
					                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
					                	invoked.PrmReqCompany				= LocalReqCompany		
					                	invoked.PrmRequisition				= LocalRequisition
					                	invoked.PrmLinenum					= LocalreqLineCounter
					                invoke DeleteRequisition
										invoked.RequisitionBOD 				= RequisitionBOD
										invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
										invoked.PrmRequisition				= LocalRequisition
										invoked.PrmReqCompany				= LocalReqCompany		
									LocalreqLineCounter = LocalRequisitionLineLength + 1
					else
						invoke Create RequisitionLine
							assign result to NewRequisitionLine
							resume on error
		                   		Error            						= true
		                        ErrorMessage     						= error message
							invoked.Company								= LocalReqCompany
							invoked.Requisition							= LocalRequisition
							invoked.Quantity							= LocalQuantity
							invoked.Description							= LocalReqLineDescription
							invoked.Item								= LocalItem
							invoked.ItemType							= "X"
							invoked.TransactionUnitCost					= LocalUnitCost
							invoked.EnteredUOM							= LocalUOM
							invoked.CreatePurchaseOrder					= "T"
							invoked.Vendor								= LocalSupplier
							invoked.EAMWorkOrder						= EAMWorkOrderNumberLine 
							invoked.EAMWorkOrderActivity				= EAMWorkOrderActivityNumberLine 
							invoked.EAMProjectTaxCode					= EAMProjectTaxCode 
							invoked.EAMProjectType						= EAMProjectType
							invoked.EAMTrade							= LocalItem 
							invoked.EAMProjectID						= EAMProjectID  
							invoked.EAMDescription						= EAMDescription 
							invoked.PurchaseFromLocation				= LocalShipFromlocation 
							invoked.FromCompanyLocationBin.FromLocation	= LocalLineshiptolocation 
							invoked.CommodityCode						= CommodityCode
							invoked.RebuildRepair						= EAMRebuildRepair						
						if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 						= Error
								invoked.ErrorMessage 				= ErrorMessage
								invoked.Status						= 2
								invoked.CloseDate					= system current timestamp
							invoke SendRequisitionConfirmBOD
								invoked.PrmErrorMessage 			= ErrorMessage
								invoked.RequisitionBOD     			= RequisitionBOD
			                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
							invoke SendRequisitionACKBOD
		                        invoked.PrmErrorMessage 			= ErrorMessage
		                        invoked.RequisitionBOD     			= RequisitionBOD
			                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
			                	invoked.PrmReqCompany				= LocalReqCompany		
			                	invoked.PrmRequisition				= LocalRequisition
			                	invoked.PrmLinenum					= LocalreqLineCounter
			                invoke DeleteRequisition
								invoked.RequisitionBOD 				= RequisitionBOD
								invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
								invoked.PrmRequisition				= LocalRequisition
								invoked.PrmReqCompany				= LocalReqCompany		
			                LocalreqLineCounter = LocalRequisitionLineLength + 1
						else
							LocalNumberOfLinesadded	=	LocalNumberOfLinesadded + 1
							LocalreqLineCounter		=	LocalreqLineCounter +  1
							if (LocalreqLineCounter%20 = 0)
			        			commit transaction
						if(CommentsCount >0)
							LocalReqLine	=	NewRequisitionLine.RequisitionLine
							invoke Create RequisitionLineComment
								resume on error
			                   		Error            					= true
			                        ErrorMessage     					= error message
								invoked.Company							= LocalReqCompany		
								invoked.Requisition						= LocalRequisition
								invoked.RequisitionLine					= LocalReqLine
								invoked.SequenceNumber					= ""
								invoked.CommentType						= "P"
								invoked.CommentTitle					= "Long Description"
								invoked.CommentText						= LocalComment
							if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 						= Error
									invoked.ErrorMessage 				= ErrorMessage
									invoked.Status						= 2
									invoked.CloseDate					= system current timestamp
								invoke SendRequisitionConfirmBOD
									invoked.PrmErrorMessage 			= ErrorMessage
									invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
								invoke SendRequisitionACKBOD
			                        invoked.PrmErrorMessage 			= ErrorMessage
			                        invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
				                	invoked.PrmReqCompany				= LocalReqCompany		
				                	invoked.PrmRequisition				= LocalRequisition
				                	invoked.PrmLinenum					= LocalreqLineCounter
	               				LocalreqLineCounter = LocalRequisitionLineLength + 1
						if(IsDefaultDistribution	=	false)
							invoke Create RequisitionLineDistribution
								resume on error
			                   		Error            									= true
			                        ErrorMessage     									= error message
			                    invoked.Company											= LocalReqCompany		
								invoked.Requisition										= LocalRequisition
								invoked.RequisitionLine									= LocalNumberOfLinesadded
								invoked.DistributionAccount.ToAccountingEntity			= LocalAE			
								invoked.DistributionAccount.AccountingUnit				= LocalAccountingUnit
           						invoked.DistributionAccount.GeneralLedgerChartAccount	= LocalGeneralLedgerChartAccount
           					if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 						= Error
									invoked.ErrorMessage 				= ErrorMessage
									invoked.Status						= 2
									invoked.CloseDate					= system current timestamp
								invoke SendRequisitionConfirmBOD
									invoked.PrmErrorMessage 			= ErrorMessage
									invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
								invoke SendRequisitionACKBOD
			                        invoked.PrmErrorMessage 			= ErrorMessage
			                        invoked.RequisitionBOD     			= RequisitionBOD
				                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
				                	invoked.PrmReqCompany				= LocalReqCompany		
				                	invoked.PrmRequisition				= LocalRequisition
				                	invoked.PrmLinenum					= LocalreqLineCounter
				                invoke DeleteRequisition
									invoked.RequisitionBOD 				= RequisitionBOD
									invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
									invoked.PrmRequisition				= LocalRequisition
									invoked.PrmReqCompany				= LocalReqCompany		
								LocalreqLineCounter = LocalRequisitionLineLength + 1
		        if((!FSMInboundBODTrackerRel.Error) and (LocalNumberofLines = LocalNumberOfLinesadded))
					invoke ReleaseRequisition
						invoked.RequisitionBOD 			= RequisitionBOD
						invoked.PrmInboundTracker 		= LocalFSMInboundBODTracker
						invoked.PrmRequisition			= LocalRequisition
						invoked.PrmReqCompany			= LocalReqCompany		
				else
				if(RequisitionRel exist)
					invoke DeleteRequisition
						invoked.RequisitionBOD 		= RequisitionBOD
						invoked.PrmInboundTracker 	= LocalFSMInboundBODTracker
						invoked.PrmRequisition		= LocalRequisition
						invoked.PrmReqCompany		= LocalReqCompany		
							
		ReleaseRequisition is an Instance Action		
			restricted			
			Parameters
				RequisitionBOD 			is XMLDocument
				PrmInboundTracker   	is like FSMInboundBODTracker
				PrmRequisition			is like Requisition
				PrmReqCompany			is Numeric 4
			Local Fields
			Action Rules
				LocalFSMInboundBODTracker 		= PrmInboundTracker
				LocalRequisition				= PrmRequisition
				LocalReqCompany 				= PrmReqCompany
				invoke Unreleased.Release RequisitionRel
					resume on error
	               		Error           		= true
	                	ErrorMessage   	 		= error message
				if(Error)
					invoke Update FSMInboundBODTrackerRel
						invoked.Error 						= Error
						invoked.ErrorMessage 				= ErrorMessage
						invoked.Status						= 2
						invoked.CloseDate					= system current timestamp
					invoke SendRequisitionConfirmBOD
						invoked.PrmErrorMessage 			= ErrorMessage
						invoked.RequisitionBOD     			= RequisitionBOD
	                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker	
					invoke SendRequisitionACKBOD
                        invoked.PrmErrorMessage 			= ErrorMessage
                        invoked.RequisitionBOD     			= RequisitionBOD
	                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
	                	invoked.PrmReqCompany				= LocalReqCompany		
	                	invoked.PrmRequisition				= LocalRequisition
	                	invoked.PrmLineXML					= ProcessRequisitionLineAckXML
	                invoke DeleteRequisition
						invoked.RequisitionBOD 				= RequisitionBOD
						invoked.PrmInboundTracker 			= LocalFSMInboundBODTracker
						invoked.PrmRequisition				= LocalRequisition
						invoked.PrmReqCompany				= LocalReqCompany		
				else
					invoke Update FSMInboundBODTrackerRel
						invoked.Status						= 3
						invoked.CloseDate					= system current timestamp
					invoke SendRequisitionACKBOD
                        invoked.PrmErrorMessage 			= "Modified"		
                        invoked.RequisitionBOD     			= RequisitionBOD
	                	invoked.PrmTrackerID 				= LocalFSMInboundBODTracker
	                	invoked.PrmRequisition				= LocalRequisition
	                	invoked.PrmReqCompany				= LocalReqCompany		
	                	invoked.PrmAcknowledgeBOD			= "F"
	                	invoked.PrmLineXML					= ProcessRequisitionLineAckXML
				
        DeleteRequisition is an Instance Action		
			restricted			
			Parameters
				RequisitionBOD 			is XMLDocument
				PrmInboundTracker   	is like FSMInboundBODTracker
				PrmRequisition			is like Requisition
				PrmReqCompany			is Numeric 4		
			Local Fields
			Action Rules
				LocalFSMInboundBODTracker 		= PrmInboundTracker
				LocalRequisition				= PrmRequisition
				LocalReqCompany 				= PrmReqCompany
				invoke Unreleased.Delete RequisitionRel
					resume on error
	               		Error           		= true
	                	ErrorMessage   	 		= error message
				invoke Update FSMInboundBODTrackerRel
					invoked.Error 			= Error
					invoked.ErrorMessage 	= ErrorMessage
					invoked.Status			= 2
					invoked.CloseDate		= system current timestamp 
		
		SendRequisitionConfirmBOD is an Instance Action
			restricted			
			Parameters
				RequisitionBOD 					is XMLDocument
				PrmErrorMessage 				is Alpha 300
				PrmTrackerID					is Numeric 15
			Action Rules
				LocalProcessRequisitionXML		= RequisitionBOD
				LocalErrorMessage				= PrmErrorMessage
				LocalTrackerID					= PrmTrackerID
				LocalAE							= RequisitionBOD select "//DataArea/Process/AccountingEntityID"
				LocationAck						= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/CustomerParty/Location/ID"
				LocalLogicalID					= RequisitionBOD select "//ApplicationArea/Sender/LogicalID"
				LocalComponentID				= RequisitionBOD select "//ApplicationArea/Sender/ComponentID"
				LocalBODID						= RequisitionBOD select "//ApplicationArea/BODID"	
				LocaldocumentID 				= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID"
				LocalConfirmBOD					= "true"
				LocalCreateDateTime				= RequisitionBOD select "//ApplicationArea/CreationDateTime"
				LocalDelete						= "Y"
				LocalMainUserTemplate			= "IONProcessRequisition_ConfirmBOD_ST"
				if(UserTemplateRel exists)
					send ion bod
						bod is ProcessRequisitionConfirmBODXML
						bod type is "Confirm.BOD"
						accounting entity is LocalAE
						document id is LocaldocumentID
		
		SendRequisitionACKBOD is an Instance Action
			restricted			
			Parameters
				RequisitionBOD 					is XMLDocument
				PrmErrorMessage 				is Alpha 300
				PrmTrackerID					is Numeric 15
				PrmRequisition					is like Requisition
				PrmReqCompany					is Numeric 4	
				PrmLinenum						is Numeric 15
				PrmAcknowledgeBOD				is Alpha 10
				PrmLineXML						is XMLDocument
			Action Rules
				LocalProcessRequisitionXML		= RequisitionBOD
				ProcessRequisitionLineAckXML	= PrmLineXML
				LocalErrorMessage				= PrmErrorMessage
				LocalTrackerID					= PrmTrackerID
				LocalAE							= RequisitionBOD select "//DataArea/Process/AccountingEntityID"
				LocationAck						= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/CustomerParty/Location/ID"
				LocalLineNum					= PrmLinenum
				LocalRequisition				= PrmRequisition
				LocalReqCompany 				= PrmReqCompany
				LocaldocumentID 				= RequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID"
				LocalAcknowledgeBOD				= PrmAcknowledgeBOD	
				LocalLogicalID					= RequisitionBOD select "//ApplicationArea/Sender/LogicalID"
				LocalComponentID				= RequisitionBOD select "//ApplicationArea/Sender/ComponentID"
				LocalTaskID						= RequisitionBOD select "//ApplicationArea/Sender/TaskID"
				LocalConfirmationCode			= RequisitionBOD select "//ApplicationArea/Sender/ConfirmationCode"
				LocalCreateDateTime				= RequisitionBOD select "//ApplicationArea/CreationDateTime"
				LocalBODID						= RequisitionBOD select "//ApplicationArea/BODID"
				LocalMainUserTemplate			= "IONProcessRequisition_AcknowledgeBOD_ST"
				if(UserTemplateRel exists)
					send ion bod
						bod is ProcessRequisitionAcknowledgeBODXML
						bod type is "Acknowledge.Requisition"	
						accounting entity is LocalAE
						document id is LocaldocumentID
#endif
#endif
#endif
#endif
#endif

		SyncRequisitionBODImport is an Import Action
			restricted
			bod type is Sync.Requisition
			Parameters
				SyncRequisitionBOD 	is XMLDocument
			Action Rules
				LocalReqCompany		= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID/@accountingEntity"
				LocalVariationID	= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID/@variationID"
				LocaldocumentID		= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID"
				LocalBODID          = SyncRequisitionBOD select "//ApplicationArea/BODID"
				LocalBODXML			= SyncRequisitionBOD
				
				if(FSMBODConfigurationSyncRequisitionRel exists and FSMBODConfigurationSyncRequisitionRel.Enable)
					if(FSMInboundBODTracker not entered)
						invoke Create FSMInboundBODTracker
							assign result to NewBODTracker
							invoked.Verb 					= 1
							invoked.Noun 					= "Requisition"
							invoked.Direction				= 2					
							invoked.Company					= LocalReqCompany
							invoked.BODAccountingEntity		= LocalReqCompany
							invoked.BODVariationID			= LocalVariationID
							invoked.BODDocumentID			= LocaldocumentID
							invoked.Status					= 1
							invoked.BODID					= LocalBODID
							invoked.RunGroup				= DerivedRunGroup
							invoked.StartDate				= system current timestamp
							invoked.BODXML					= LocalBODXML
							initialize invoked.Error			
							initialize invoked.ErrorMessage					
						LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
					else
						LocalFSMInboundBODTracker	= FSMInboundBODTracker
						invoke Update FSMInboundBODTrackerRel
							invoked.Company					= LocalReqCompany
							invoked.BODAccountingEntity		= LocalReqCompany
							invoked.BODVariationID			= LocalVariationID
							invoked.BODDocumentID			= LocaldocumentID
							invoked.Status					= 1
							invoked.BODID					= LocalBODID
							invoked.RunGroup				= DerivedRunGroup
							invoked.StartDate				= system current timestamp
							invoked.BODXML					= LocalBODXML
							initialize invoked.Error			
							initialize invoked.ErrorMessage	
							
					invoke CreateRequisitionImport
						invoked.SyncRequisitionBOD			= SyncRequisitionBOD
						invoked.PrmInboundTracker			= LocalFSMInboundBODTracker
				else 
				if(FSMInboundBODTracker not entered)
					invoke Create FSMInboundBODTracker
						assign result to NewBODTracker
						invoked.Verb 					= 1
						invoked.Noun 					= "Requisition"
						invoked.Direction				= 2					
						invoked.Company					= LocalReqCompany
						invoked.BODAccountingEntity		= LocalReqCompany
						invoked.BODVariationID			= LocalVariationID
						invoked.BODDocumentID			= LocaldocumentID
						invoked.BODID					= LocalBODID
						invoked.RunGroup				= DerivedRunGroup
						invoked.Status					= 4
						invoked.StartDate				= system current timestamp
						invoked.BODXML					= LocalBODXML
						invoked.CloseDate				= system current timestamp
						invoked.Error					= true			
						invoked.ErrorMessage			= "Sync Requisition Inbound BOD Service is not Enabled"
					LocalFSMInboundBODTracker = NewBODTracker.FSMInboundBODTracker
				else
					LocalFSMInboundBODTracker = FSMInboundBODTracker
					invoke Update FSMInboundBODTrackerRel
						invoked.Company					= LocalReqCompany
						invoked.BODAccountingEntity		= LocalReqCompany
						invoked.BODVariationID			= LocalVariationID
						invoked.BODDocumentID			= LocaldocumentID
						invoked.BODID					= LocalBODID
						invoked.RunGroup				= DerivedRunGroup
						invoked.Status					= 4
						invoked.StartDate				= system current timestamp
						invoked.BODXML					= LocalBODXML
						invoked.CloseDate				= system current timestamp
						invoked.Error					= true			
						invoked.ErrorMessage			= "Sync Requisition Inbound BOD Service is not Enabled"		
		
		CreateRequisitionImport is an Import Action
			restricted
			Parameters
				SyncRequisitionBOD			is XMLDocument
				PrmInboundTracker   		is like FSMInboundBODTracker
			Action Rules
				LocalFSMInboundBODTracker	= PrmInboundTracker
				LocalReqCompany				= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID/@accountingEntity"
				LocalRequester				= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/RequesterParty/PartyIDs/ID"				
				LocalTotalAmount			= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/TotalAmount"
				LocalLogicalID				= SyncRequisitionBOD select "//ApplicationArea/Sender/LogicalID"
				LocalComponentID			= SyncRequisitionBOD select "//ApplicationArea/Sender/ComponentID"
				LocalBODID					= SyncRequisitionBOD select "//ApplicationArea/BODID"
				LocalLineLength				= SyncRequisitionBOD select "count (//DataArea/Requisition/RequisitionLine)"
				
				invoke CreateNoRules RequisitionImport
					resume on error
	               		Error            				= true
	                    ErrorMessage     				= error message
                    invoked.Company						= LocalReqCompany	
                    invoked.RequisitionImport			= DerivedReqReference
                    invoked.RunGroup					= DerivedRunGroup
                    invoked.Requester					= LocalRequester
                    invoked.SenderLogicalID				= LocalLogicalID
                    invoked.SenderComponentID			= LocalComponentID
             		invoked.SenderCreationDateTime		= BODFormattedCurrentTimeStamp
                    invoked.SenderOriginalBOD			= "FROM BOD"
                    invoked.SenderBODID					= LocalBODID
                if(Error)
					invoke Update FSMInboundBODTrackerRel
						invoked.Error 					= Error
						invoked.ErrorMessage 			= ErrorMessage
						invoked.Status					= 2
						invoked.CloseDate				= system current timestamp
				if(LocalLineLength > 0)
					invoke CreateRequisitionImportLine
						invoked.SyncRequisitionBOD		= SyncRequisitionBOD
						invoked.PrmInboundTracker		= LocalFSMInboundBODTracker
				else
       				LocalErrorMessage = "Must have line records to process requisition"
       				invoke Update FSMInboundBODTrackerRel
						invoked.Error 					= true
						invoked.ErrorMessage 			= LocalErrorMessage
						invoked.Status					= 2
						invoked.CloseDate				= system current timestamp
					invoke SyncRequisitionPulseAlert
						invoked.SyncRequisitionBOD		= SyncRequisitionBOD
						invoked.PrmErrorMessage 		= LocalErrorMessage
					
		CreateRequisitionImportLine is an Import Action
			restricted
			Parameters
				SyncRequisitionBOD			is XMLDocument
				PrmInboundTracker   		is like FSMInboundBODTracker
			Local Fields
				LocalReqLine				is XMLDocument	
			Action Rules
				LocalFSMInboundBODTracker	= PrmInboundTracker
	            LocalReqCompany				= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/DocumentID/ID/@accountingEntity"
				LocalRequester				= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/RequesterParty/PartyIDs/ID"				
				LocalTotalAmount			= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionHeader/TotalAmount"       
				LocalLineLength				= SyncRequisitionBOD select "count (//DataArea/Requisition/RequisitionLine)"
				LocalIterator = 1
					
				while(LocalLineLength >= LocalIterator)
					LocalReqLine		= SyncRequisitionBOD select "//DataArea/Requisition/RequisitionLine[<LocalIterator>]"
					LocalItem			= LocalReqLine select "/RequisitionLine/Item/ItemID/ID"
					LocalQuantity		= LocalReqLine select "/RequisitionLine/Quantity"
					LocalUOM			= LocalReqLine select "/RequisitionLine/Quantity/@unitCode"
					LocalUnitCost		= LocalReqLine select "/RequisitionLine/UnitPrice/Amount"
					
					invoke CreateNoRules RequisitionImportLine
						resume on error
		               		Error            				= true
		                    ErrorMessage     				= error message
	                    invoked.Company						= LocalReqCompany	
	                    invoked.RequisitionImport			= DerivedReqReference
	                    invoked.RequisitionImportLine		= LocalIterator
	                    invoked.Item						= LocalItem
	                    invoked.Quantity					= LocalQuantity		
	                    invoked.TransactionUnitCost			= LocalUnitCost
	                if(Error)
						invoke Update FSMInboundBODTrackerRel
							invoked.Error 					= Error
							invoked.ErrorMessage 			= ErrorMessage
							invoked.Status					= 2
							invoked.CloseDate				= system current timestamp
						LocalIterator = LocalLineLength + 1
					else
						LocalIterator = LocalIterator + 1	
						if (LocalIterator%20 = 0)
							commit transaction
				
				if(!FSMInboundBODTrackerRel.Error)
					invoke Update FSMInboundBODTrackerRel
						invoked.Status					= 3
						invoked.CloseDate				= system current timestamp	
					
		SyncRequisitionPulseAlert is an Instance Action
			restricted
			Parameters
				SyncRequisitionBOD	is XMLDocument 
				PrmErrorMessage 	is Alpha 300
			Action Rules	
				LocalBODID					= SyncRequisitionBOD select "//ApplicationArea/Sender/ComponentID"	
				LocalPulseAlertDescription	= "RequisitionImport " + DerivedReqReference  + " failed while processing."
				LocalErrorMessage 			= PrmErrorMessage
				LocalMainUserTemplate 		= "IONSyncRequisitionAlert_ST"	
				if (FSMBODConfigurationPulseAlertRel exists and FSMBODConfigurationPulseAlertRel.Enable)
          			if(FSMBODConfigurationSyncRequisitionRel exists and FSMBODConfigurationSyncRequisitionRel.Enable)
          				if (UserTemplateRel exists)
							invoke TriggerPulseAlert FSMBODConfigurationPulseAlertRel
								invoked.PrmActorGroup 	= "RequisitionFailureGroup" 
								invoked.PrmMainXML 		= SyncRequisitionPulseAlertXML	
								invoked.PrmDescription	= LocalPulseAlertDescription

