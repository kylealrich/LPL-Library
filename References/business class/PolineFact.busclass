PolineFact is a BusinessClass
    owned by procurement
    prefix is PLF

    Patterns
        disable Auditing
        disable EffectiveDated

        implements DynamicCreation

    Persistent Fields
    	PurchasingCompany                
     	PoNumber				is a PurchaseOrder
     	PoRelease				is Numeric size 4
     	PoCode					is AlphaUpper size 4
     	LineNbr					is Numeric size 6
     	LineSeq 				is Numeric size 4

		Quantity				is Decimal size 13.4
		VbuyUnitCst				is an InternationalCost 
		EbuyUomMult				is Decimal size 13.7
		EntUnitCst				is an InternationalCost
		VpriUomMult				is Decimal size 13.7
		ExtendedAmt				is an InternationalAmount

		ItemGroup
			disable surrogates 
		Item					
		VendorGroup
			disable surrogates 
		Vendor
		PurchFrLoc				is like PurchaseFromLocation  
		VendorItem          	is AlphaUpper size 32
		ContractGroup			is AlphaUpper size 4
		CmContract	 			is like Contract
		MfgContract         	is Numeric size 15
		Buyer

		Location				is an InventoryLocation
		RequestingLocation		is like RequestingLocation	
		PoDate					is Date
		Tier					is Alpha size 4
		TierContract			is Numeric size 15
    	ManufacturerCode		is Alpha 4 
    	ManufacturerDivision	is Alpha 4
    	ManufacturerNumber
    	PurchMajcl				is AlphaUpper size 4
    	PurchMincl				is AlphaUpper size 4
		UNSPSCCode
		CommodityCode
		ProcureGroup			is a ProcurementGroup
			disable surrogates
		PoYear					is Numeric size 4
		PoQuarter				is Numeric size 1
		PoMonth					is Numeric size 2
		PoDay					is Numeric size 3
    	
	Context Fields
		UsageDateRange
		ForecastCompany1			is an InventoryCompany
		InventoryLocationArray

	Derived Fields
		DerivedMfgContract is a DerivedField
			type is Numeric size 15
			restricted
			return MfgContract 
			 
		DerivedNumericFromYear is a StringField
			type is Numeric 4
			restricted
			UsageDateRange.UsageFromYear
			
		DerivedNumericToYear is a StringField
			type is Numeric 4
			restricted
			UsageDateRange.UsageToYear
			
		DerivedPoNumber is a DerivedField
			type is Alpha size up to 24
			if (PoCode entered)
				return PoNumber + "-" + PoRelease + "-" + PoCode
			else
				return PoNumber + "-" + PoRelease
				
		DerivedExtendedAmount is a DerivedField
			type is like InternationalAmount
			restricted
			return ((Quantity * EbuyUomMult) * (EntUnitCst / VpriUomMult))
		
		DerivedItemSpendPercentOfTotal is a ComputeField
			type is Percent size 5.2
			(ExtendedAmt)
			
		DerivedPercentOnContract is a DerivedField
			type is Percent size 5.2
			if (OffContract)
				return 0
			else
				return (ExtendedAmt)
	Conditions
		OffContract
			restricted
			when (CmContract		not entered)
		
    Relations
 		VendorRel
 			one-to-one relation to Vendor
 			Field Mapping uses symbolic key
 				related.VendorGroup		= VendorGroup
 				related.Vendor			= Vendor
 				
 		PurchaseOrderLineRel
 			one-to-one relation to PurchaseOrderLine
 			Field Mapping uses symbolic key
				related.Company					= PurchasingCompany
				related.PurchaseOrder			= PoNumber
				related.PurchaseOrderLine		= LineNbr
 				
		RqLocRel
			one-to-one relation to RequestingLocation
			Field Mapping uses symbolic key
				related.Company					= PurchasingCompany
				related.RequestingLocation		= RequestingLocation
				
    Sets
    	PLFSET1
    		primary
    		indexed
    		Sort Order
    			PurchasingCompany
    			PoNumber
    			PoRelease
    			PoCode
    			LineNbr
    			LineSeq
    			
    	ByCompanyItem
    		duplicates
    		indexed
    		Sort Order
    			PurchasingCompany
    			CmContract
    			Item
    			PoDate
    			
    	ByCompLocItem
    		duplicates
    		indexed
    		Sort Order
    			PurchasingCompany
    			Location
    			CmContract
    			Item
    			PoDate
    			
    	ByCmpRqLcItem
    		duplicates
    		indexed
    		Sort Order
    			PurchasingCompany
    			RequestingLocation
    			CmContract
    			Item
    			PoDate
    			
    	ByCompanyCodes
    		duplicates
    		indexed
    		Sort Order
    			PurchasingCompany
 				ManufacturerCode
				CommodityCode.Segment[1]
				PurchMajcl				
				UNSPSCCode.UNSPSCSegment
    			PoDate
    			
    	ByLocationCodes
    		duplicates
    		indexed
    		Sort Order
    			PurchasingCompany
    			Location
 				ManufacturerCode
				CommodityCode.Segment[1]
				PurchMajcl				
				UNSPSCCode.UNSPSCSegment
    			PoDate
    			
    	ByReqLocCodes
    		duplicates
    		indexed
    		Sort Order
    			PurchasingCompany
    			RequestingLocation
 				ManufacturerCode
				CommodityCode.Segment[1]
				PurchMajcl				
				UNSPSCCode.UNSPSCSegment
    			PoDate
    			
    	ByBuyMajItem
    		duplicates
    		indexed
    		Sort Order
    			ProcureGroup
    			Buyer
    			PurchMajcl
    			Item
    			CmContract
    			
    	ByComBuyItem
    		duplicates
    		indexed
    		Sort Order
    			ProcureGroup
    			CommodityCode
    			Buyer
    			Item

    			
    	ByMajMinItem
    		duplicates
    		indexed
    		Sort Order
    			ProcureGroup
    			PurchMajcl
				PurchMincl
    			Item
    			CmContract
				PoDate

		ByManufacturerInformationVendorItem 
			Sort Order 
				ContractGroup
				ManufacturerCode 
				ManufacturerDivision 
				ManufacturerNumber 
				Vendor
				VendorItem 				
   				PurchasingCompany
    			PoNumber
    			LineNbr

		ByItemVendorItem 
			Sort Order 
				ContractGroup
				Item 
				Vendor 
				VendorItem 		
   				PurchasingCompany
    			PoNumber
    			LineNbr

		ByContract
			duplicates
			Sort Order
				CmContract
				MfgContract
				
		ByRqLoc			
			duplicates
			Sort Order
				PurchasingCompany
				RequestingLocation
				
	Field Rules

							
	Actions
		Create is a Create Action
			restricted
			
		Update is an Update Action
			restricted
			
		Delete is a Delete Action
			restricted
			
		Purge is a Purge Action
			restricted
			
		PurgePolineFact is a Set Action
			restricted
			completion message is "PurgePurchaseOrderInformationForTierReportingIsComplete"
			Parameters
				PrmVendorGroup					is a VendorGroup
				PrmBeginDate					is Date
				PrmEndDate                      is Date
				
			Parameter Rules
				PrmVendorGroup
					required
						"VendorGroupRequired"
				
				PrmBeginDate
					required
						"BeginDateIsRequired"
						
				PrmEndDate
					default to current corporate date
					
 		           	constraint (PrmEndDate >= PrmBeginDate)
        		    	"EndDateCannotPrecedeBeginDate"
					
			Instance Selection
				where (VendorGroup			= PrmVendorGroup
				and   (PoDate		  		>= PrmBeginDate
				and    PoDate           	<= PrmEndDate))
				
    		Sort Order
    			PurchasingCompany
    			CmContract
    			Item
    			PoDate
    			PoNumber
    			PoRelease
    			PoCode
    			LineNbr
    			LineSeq

			Action Rules
				Instance Rules
					invoke Purge 			
