JurisdictionResults is a BusinessClass
    owned by tx  
	prefix is JurRs	
	
    Ontology
        symbolic key is JurisdictionResults
		
	Patterns
		implements CRUD

	Persistent Fields		
		TaxDate 					is Date	 						
		TaxAreaId 					is like TaxCode	 	
		LineItemTotalTax 			is an InternationalAmount 	
		Situs 						is Alpha size 50
		TaxCollectedFromParty 		is Alpha size 50 	
		TaxResult 					is Alpha size 50		
		TaxType 					is Alpha size 50	
		Jurisdiction 				is Alpha size 50
		JurisdictionId 				is Alpha size 50		
		JurisdictionLevel 			is Alpha size 50
        CalculatedTax 				is an InternationalAmount 	 
        EffectiveRate 				is a TaxRateValue	
        Taxable 					is an InternationalAmount 	 
        Imposition 					is Alpha size 50
        ImpositionType 				is Alpha size 50
        TaxRuleId 					is Alpha size 50
        ResultsBusclassKey			is Alpha 100
        CallingModuleKey			is BusinessObjectReference 

		IsService					is Boolean
		InvoiceTextCode				is a InvoiceTextCodesArray	 
		SummaryInvoiceText			is Alpha 200	
		SellerRegistrationId		is Alpha 40			
		BuyerRegistrationId			is Alpha 40	

		RecoverableAmount 			is an InternationalAmount
		RecoverablePercent  		is a TaxRateValue	

		UnrecoverableAmount  		is an InternationalAmount
		BlockingRecoverablePercent 	is a TaxRateValue	
		PartialExemptRcvrblPct 		is a TaxRateValue	
		InputOutputType				is Alpha 26
			States	
			   	Input					value is "INPUT       "	 
			   	Import    				value is "IMPORT      "	 
			   	Output    				value is "OUTPUT      "	 
			   	InputOutput				value is "INPUT_OUTPUT"	 

		FilingCurrencyConversion 	is a CurrencyExchangeRate	 			 
		FilingIsoCurrencyName 		is Alpha 50					  
		FilingIsoCurrencyCodeAlpha 	is Alpha 3					 			 
		FilingIsoCurrencyCodeNum 	is Numeric 3				 	 
		FilingCalculatedTax 		is an InternationalAmount
		FilingExempt  				is an InternationalAmount
		FilingNonTaxable 			is an InternationalAmount
		FilingTaxable 				is an InternationalAmount
		FilingRecoverableAmount 	is an InternationalAmount
		FilingUnrecoverableAmount 	is an InternationalAmount	
		RateClassificationText		is a RateClassification
		RequestReference			is Alpha 20

		
	Transient Fields	 
		TotalFilingTaxAmt		is a InternationalAmount				 
			derive value from SumFilingCalculatedTax	 	 
		TaxDateYear				is a Year
			derive value from TaxDate year
			
    Context Fields
		TaxDateRange			is a DateRange
								
	Conditions
		InvoiceTextCodesExist
			when (InvoiceTextCode.InvoiceTextCodeOut[1].InvoiceTextCode entered)		

		WithinTaxDateRange
			restricted
			when (TaxDateRange not entered
			or	 (TaxDateRange entered
			and	  TaxDate within TaxDateRange)
			and  (TaxDateYear = TaxDate year
			or    TaxDateYear not entered))
						
	Derived Fields
		Derived1stInvoiceText is a DerivedField
			type is Alpha 20
			if (InvoiceTextCode.InvoiceTextCodeOut[1].InvoiceTextCode entered)
				return InvoiceTextCode.InvoiceTextCodeOut[1].InvoiceTextCodeDesc	
			else
				return blank

		SumFilingCalculatedTax is a DerivedField
			type is like InternationalAmount
			return (sum JurisdictionResultsRel.FilingCalculatedTax)

		DerivedResultsCount is a DerivedField
			type is Numeric 2
			return 1

		DerivedRelatedObject is a DerivedField
			type is Alpha 20
			restricted
			return com.lawson.apps.sharedfinance.base.StringUtils.trimLeadingSpaces(DerivedRelatedBusinessObject)
		DerivedRelatedBusinessObject is a DerivedField
			type is Alpha 20
			restricted
			return CallingModuleKey	
									
    Relations	
		JurisdictionResultsRel
			one-to-many relation to JurisdictionResults
			Field Mapping uses symbolic key	 
				related.VertexConfig  									= VertexConfig
			Instance Selection
				where (related.JurisdictionResults.LookupKey			= JurisdictionResults.LookupKey
				and    related.JurisdictionResults.ResponseBusclassKey	= JurisdictionResults.ResponseBusclassKey)
							
	Sets
		ByCallingModuleKey
    		duplicates
			Sort Order
				VertexConfig
				CallingModuleKey         

	Actions
		Create is an Action
		Update is an Action
		Delete is an Action 
		Purge is a Purge Action
			restricted
			 
		PurgeJurisdictionResults is a Set Action												 
			completion message is "PurgeProcessComplete:<RecordCount>...RecordsProcessed"
			run in background		 
			Parameters 
				PrmVertexConfig		is a VertexConfig
					default label is "FinanceEnterpriseGroup"
				PrmTaxDateRange is a DateRange
					default label is "TaxDateRange"
				PrmTaxDateYear	is a Year
					default label is "TaxDateYear"	
				PrmCallingModuleKey is Alpha 20
					default label is "Module"					
				PrmLookupKey is Alpha 100					 
					default label is "LookupKey"					
			Parameter Rules
				PrmVertexConfig  
					initial value is actor.context.FinanceEnterpriseGroup	
					required						
			Local Fields
				RecordCount	is Numeric 10				
			Instance Selection			
				where (VertexConfig = PrmVertexConfig			 
				and   (TaxDate within TaxDateRange						 
				or     TaxDateRange not entered)				
				and   (JurisdictionResults.LookupKey = PrmLookupKey						 	
				or     PrmLookupKey not entered) 	
				and   (DerivedRelatedObject = PrmCallingModuleKey						 	
				or     PrmCallingModuleKey not entered) 					
			    and   (PrmTaxDateYear = TaxDate year					      		 
			    or     PrmTaxDateYear not entered))				 
			Sort Order

			Accumulators



				
			Action Rules								
				Empty Set Rules
				
				Set Rules
					Entrance Rules

					Exit Rules
						
				Instance Rules
					increment RecordCount				
					invoke Purge JurisdictionResults



