PerformanceCriteria is a BusinessClass
    owned by procurement
    prefix is PFCT
    sql name is PERCRIT

    Patterns
		implements Resequence on DisplayOrder
			new sequence field is NewDisplayOrder
			set is ByDisplayOrder
    
    Ontology
    	symbolic key is PerformanceCriteria
    	
    Persistent Fields
    	Criteria				is a Description
    	Description				is Text
    	DisplayOrder
    	Active					is Boolean
		DoesNotMeetExpectations	is a Description
		BelowExpectations		is a Description
		MeetsExpectations 		is a Description
		AboveExpectations 		is a Description
		ExceedsExpectations 	is a Description

   	Transient Fields
		NewDisplayOrder			is a DisplayOrder

	Derived Fields
		Expectations1Message is a MessageField
			restricted
			"DoesNotMeetExpectations"
			
		Expectations2Message is a MessageField
			restricted
			"BelowExpectations"
			
		Expectations3Message is a MessageField
			restricted
			"MeetsExpectations"
			
		Expectations4Message is a MessageField
			restricted
			"AboveExpectations"
			
		Expectations5Message is a MessageField
			restricted
			"ExceedsExpectations"
		
		DerivedDoesNotMeetExpectations	is a ConditionalField
			type is Text
			restricted
			if (DoesNotMeetExpectations entered)
				Expectations1Message  + "(" + DoesNotMeetExpectations + ")"
			else
				Expectations1Message

		DerivedBelowExpectations		is a ConditionalField
			type is Text
			restricted
			if (BelowExpectations entered)
				Expectations2Message + "(" + BelowExpectations + ")"
			else
				Expectations2Message

		DerivedMeetsExpectations		is a ConditionalField
			type is Text
			restricted
			if (MeetsExpectations entered)
				Expectations3Message + "(" + MeetsExpectations + ")"
			else
				Expectations3Message

		DerivedAboveExpectations		is a ConditionalField
			type is Text
			restricted
			if (AboveExpectations entered)
				Expectations4Message + "(" + AboveExpectations + ")"
			else
				Expectations4Message

		DerivedExceedsExpectations		is a ConditionalField
			type is Text
			restricted
			if (ExceedsExpectations entered)
				Expectations5Message + "(" + ExceedsExpectations + ")"
			else
				Expectations5Message

	Relations
		DoesNotMeetExpectationsOptionRel
  			one-to-one relation to PerformanceCriteriaOption
            Field Mapping uses symbolic key
            	related.SupplierGroup					= SupplierGroup
            	related.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
            	related.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
            	related.PerformanceCriteria				= PerformanceCriteria
            	related.PerformanceCriteriaOption		= 1

		BelowExpectationsOptionRel
  			one-to-one relation to PerformanceCriteriaOption
            Field Mapping uses symbolic key
            	related.SupplierGroup					= SupplierGroup
            	related.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
            	related.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
            	related.PerformanceCriteria				= PerformanceCriteria
            	related.PerformanceCriteriaOption		= 2

		MeetsExpectationsOptionRel
  			one-to-one relation to PerformanceCriteriaOption
            Field Mapping uses symbolic key
            	related.SupplierGroup					= SupplierGroup
            	related.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
            	related.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
            	related.PerformanceCriteria				= PerformanceCriteria
            	related.PerformanceCriteriaOption		= 3

		AboveExpectationsOptionRel
  			one-to-one relation to PerformanceCriteriaOption
            Field Mapping uses symbolic key
            	related.SupplierGroup					= SupplierGroup
            	related.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
            	related.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
            	related.PerformanceCriteria				= PerformanceCriteria
            	related.PerformanceCriteriaOption		= 4

		ExceedsExpectationsOptionRel
  			one-to-one relation to PerformanceCriteriaOption
            Field Mapping uses symbolic key
            	related.SupplierGroup					= SupplierGroup
            	related.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
            	related.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
            	related.PerformanceCriteria				= PerformanceCriteria
            	related.PerformanceCriteriaOption		= 5

	Sets
 		ByDisplayOrder
 			duplicates
 			Sort Order
 				SupplierGroup
 				PerformanceEvaluationTemplate
 				PerformanceCriteriaGroup
 				DisplayOrder
 				PerformanceCriteria

 	Conditions
		TemplateHasBeenUsedForEvaluations
			restricted
			when (PerformanceEvaluationTemplate.SupplierPerformanceEvaluationRel exists)

		AllowCreation
			restricted
			when (PerformanceEvaluationTemplate.Active
			and	  PerformanceCriteriaGroup.Active
			and	  !TemplateHasBeenUsedForEvaluations)
			
	Field Rules
   		Criteria
   			required
   		
   		DisplayOrder
	 		autosequence using PerformanceCriteriaGroup.LastPerformanceCriteriaDisplayOrder

		Active
			default to true
	 		
	Actions
		Create is an Action
			valid when (AllowCreation)
			
			Exit Rules
				invoke Create PerformanceCriteriaOption
					invoked.SupplierGroup					= SupplierGroup
					invoked.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
					invoked.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
					invoked.PerformanceCriteria 			= PerformanceCriteria
					invoked.PerformanceCriteriaOption		= 1
					invoked.Description						= DerivedDoesNotMeetExpectations

				invoke Create PerformanceCriteriaOption
					invoked.SupplierGroup					= SupplierGroup
					invoked.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
					invoked.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
					invoked.PerformanceCriteria 			= PerformanceCriteria
					invoked.PerformanceCriteriaOption		= 2
					invoked.Description						= DerivedBelowExpectations

				invoke Create PerformanceCriteriaOption
					invoked.SupplierGroup					= SupplierGroup
					invoked.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
					invoked.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
					invoked.PerformanceCriteria 			= PerformanceCriteria
					invoked.PerformanceCriteriaOption		= 3
					invoked.Description						= DerivedMeetsExpectations

				invoke Create PerformanceCriteriaOption
					invoked.SupplierGroup					= SupplierGroup
					invoked.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
					invoked.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
					invoked.PerformanceCriteria 			= PerformanceCriteria
					invoked.PerformanceCriteriaOption		= 4
					invoked.Description						= DerivedAboveExpectations

				invoke Create PerformanceCriteriaOption
					invoked.SupplierGroup					= SupplierGroup
					invoked.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
					invoked.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
					invoked.PerformanceCriteria 			= PerformanceCriteria
					invoked.PerformanceCriteriaOption		= 5
					invoked.Description						= DerivedExceedsExpectations

				invoke Create PerformanceCriteriaOption
					invoked.SupplierGroup					= SupplierGroup
					invoked.PerformanceEvaluationTemplate	= PerformanceEvaluationTemplate
					invoked.PerformanceCriteriaGroup		= PerformanceCriteriaGroup
					invoked.PerformanceCriteria 			= PerformanceCriteria
					invoked.PerformanceCriteriaOption		= 6
					invoked.Description						= "Not Applicable"
					
		Update is an Action
			Exit Rules
				if (DoesNotMeetExpectations changed)
					invoke Update DoesNotMeetExpectationsOptionRel
						invoked.Description						= DerivedDoesNotMeetExpectations

				if (BelowExpectations changed)
					invoke Update BelowExpectationsOptionRel
						invoked.Description						= DerivedBelowExpectations

				if (MeetsExpectations changed)
					invoke Update MeetsExpectationsOptionRel
						invoked.Description						= DerivedMeetsExpectations

				if (AboveExpectations changed)
					invoke Update AboveExpectationsOptionRel
						invoked.Description						= DerivedAboveExpectations

				if (ExceedsExpectations changed)
					invoke Update ExceedsExpectationsOptionRel
						invoked.Description						= DerivedExceedsExpectations

		Delete is an Action
			valid when (!TemplateHasBeenUsedForEvaluations)
