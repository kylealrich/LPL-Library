PurchaseOrderReceipt is a BusinessClass
    owned by po
    prefix is POR
    classic name is PORECEIVE

    Ontology
        symbolic key is PurchaseOrderReceipt
            classic set name is PORSET0
            classic name is REC-NUMBER

    Patterns
        implements StaticJava
        disable AuditIndex
        implements BODId
        implements Archivable

    Persistent Fields
    	PORelease
        POCode
        Reference1		is a Reference
        Reference2		is a Reference


        ReferenceNumber
            classic name is REFERENCE-NO
			scannable
        PurchaseOrder
        ShipToLocation                is an InventoryLocation
            classic name is LOCATION
        PurchaseOrderLocation         is an InventoryLocation
            classic name is PO-LOCATION
        OperatorID                    is an Operator 
        	holds pii
            classic name is OPER-ID
        Buyer
            classic name is BUYER-CODE
        BillOfLading
            classic name is BOL-NBR
        ReceivedDate                  is TimeStamp
            classic name is REC-DATE
        Carrier						  is a Vendor
        Vendor
        PurchaseFromLocation		  is a VendorLocation
            classic name is PURCH-FR-LOC
            context of Vendor
        Status                        is Numeric size 1
            States
                Unreleased     						value is 0
                Released       						value is 1
                CreateInProgress 					value is 2
                	default label is "Create In Progress"
				ReleasedPendingTwoStepReceiving		value is 4
					default label is "Released_/PendingTwoStepReceiving"
                ReadyToArchive 						value is 5
                    default label is "Ready to Archive"
                DropShip       						value is 7
                ReleaseInProgress 					value is 8
                	default label is "Release In Progress"
                ArchivedClosed 						value is 9
                    default label is "Archived / Closed"
        Logged                        is Boolean
            classic name is LOGGED-FLAG
        ReprintReceipt                is Boolean
            classic name is REPRINT-REC-FL
        ERSStatus
        InvoiceReference              is a PayablesReferenceType	
            classic name is INVC-REF-TYPE












		Invoice														
        Comments                      is a CommentX5InPoreceive
            classic name is COMMENT
        PrintCode                     is AlphaUpper size 1
            States
                All             value is "A"
                CheckCheque     value is "C"
                    default label is "Check (Cheque)"
                DisplayAndPrint value is "D"
                    default label is "Display and Print"
                NotationOnly    value is "N"
        ReceiptAmount                 is an InternationalAmount
            classic name is MATCH-AMT
        MatchedAmount                 is an InternationalAmount
            classic name is MATCH-AMT-TOT
        Currency
            classic name is CURRENCY-CODE
        ProcessLevel                  is a PayablesProcessLevel
        ReceiptCurrencyConversionRate is an EnteredCurrencyConversionRate
            classic name is REC-CNV-RATE
        TermCode					  is a TermsCode
            classic name is TERMS-CD
        ShipToArriveDate              is Date
            classic name is SHIP-TO-ARRIVE
        MatchPrepayment               is Boolean
            classic name is MTCH-PRPY-FL
        AddOnChargeTotal              is an InternationalAmount
            classic name is PO-AOC-TOTAL
        HashQuantity
            classic name is HASH-QTY
        HashQuantityMatched           is Decimal size 15.4
            classic name is HASH-QTY-MATCH
        CrossReferenceVendor
            classic name is XREF-VENDOR
            context of Vendor
        RetailFlag                    is Numeric size 1
        CreatedBy                     is an Operator 
        	holds pii
        LastUpdateDate                is TimeStamp
            classic name is LAST-UPDT-DATE
        LastUpdateBy                  is an Operator 
        	holds pii
        ReleasingOperatorID           is an Operator 
        	holds pii
            classic name is REL-OPER-ID
        FreightTotal				  is an InternationalAmount
            classic name is FREIGHT-TOT
            disable Auditing
            protected
        InsuranceTotal				  is an InternationalAmount
            classic name is INSURANCE-TOT
            disable Auditing
            protected
        CustomsTotal				  is an InternationalAmount
            classic name is CSTMS-TOT
            disable Auditing
            protected
        OtherAddOnChargesTotal		  is an InternationalAmount
            classic name is OTHER-AOC-TOT
            disable Auditing
            protected
        GlobalDocumentType
            classic name is GLBL-DOC-TYPE
        TemporaryHold                 is AlphaUpper size 1
            classic name is TEMP-HOLD
            States
                ApprovedByEngine value is "A"
                    default label is "Approved by Engine"
                SentForApproval  value is "S"
                    default label is "Sent for Approval"
				RejectedByEngine value is "R"
					default label is "Rejected by Engine"
		MatchReferenceNumber
		InterfaceInProcess				is Boolean
		OriginatingInterfaceRun			is a PurchaseOrderReceiptInterfaceResult
			delete ignored
		IDMPrinter
        PutawayStatus          is Numeric size 1
            States
                NotForPutaway           	value is 0
			    ForReceivingPutaway     	value is 1
                ConfirmedPutawayFeedback	value is 2
		MSCMReportPrinter			is a MobileSupplyChainPrinter
			default label is "ReportPrinter"
		MSCMLabelPrinter			is a MobileSupplyChainPrinter
			default label is "LabelPrinter"

	Transient Fields
		TransientBillOfLading is AlphaUpper size 22
			derive value from DerivedBillOfLading
			default label is "BillOfLading"

		PackageTrackingNumber is AlphaUpper size 40
			derive value from DerivedPackageTrackingNumber
			default label is "TrackingNumber"

		PackageTrackingLabel is Numeric size 4
			derive value from DerivedPackageTrackingLabel
			default label is "Labels"
			
        TransientInterfaceStatus      is Numeric size 1
            States
                Unreleased     value is 0
                Released       value is 1

		BypassDropshipEdit			  is Boolean

		TransientReceiveAll is Boolean
			default label is "ReceiveAll"

	Context Fields
		PayablesInvoice
		AuditDateRange								is a DateRange
		SearchRequester								is a Requester
		SearchRequesterName							is a PresentationName
		FSMInboundBODTracker
	Local Fields
		LocalAsyncID 								is an AsyncActionRequest
		CurrencyExchange
		LocalCurrencyTable                          is a CurrencyTable
		LocalExchangeDate							is a ExchangeDate			
		LocalFromCurrency							is a FromCurrency			
		LocalTransactionAmount				 		is a CurrencyAmount			
		LocalCompany								is like PayablesCompany
		LocalPurchaseOrder							is like PurchaseOrder
		LocalPurchaseOrderLine						is like PurchaseOrderLine
		LocalShipToLocation							is an InventoryLocation
		LocalShipToLocFilter						is like InventoryLocation
		LocalInterfacedAddOnCharge					is like AddOnCharge

        LocalRecCompany								is like PayablesCompany
        LocalRecPurchaseOrderReceipt				is like PurchaseOrderReceipt
        LocalRecPurchaseOrderReceiptLine			is like PurchaseOrderReceiptLine
        LocalRecAddOnCharge  						is like AddOnCharge

		LocalPAOCompany								is like PayablesCompany
		LocalPAOPurchaseOrder						is like PurchaseOrder
		LocalPAOAddOnCharge							is like AddOnCharge
		LocalReceiptCurrencyConversionRate			is an EnteredCurrencyConversionRate	

		IntrastatProcessing
		LocalTrigger 								is Alpha 1
		LocalCheckCountries							is Alpha 1
		LocalItem									is an Item
		POBlanketOrStandingAgreement				is Boolean
		ActionCode			is Alpha size 1
			States
				Create  value is "C"
				Update	value is "U"
				Delete	value is "D"
		LocalBODCurrentTimeStamp		is a BODCurrentTimeStamp
		LocalInvokedFromBatch			is Boolean
		LocalLimitForBatchInvoke		is Numeric 3
		LocalUseBatchRelease 			is Boolean
		TimeStampInGMT
		LocalPurgeCount					is Numeric 10
		LocalPurgeRecords				is Boolean
		LocalActor						is an Actor
		LocalErrorOccurred				is Boolean
		LocalErrorMessage				is Alpha 150
		LocalCompletionMessage			is Alpha 150
		LocalRunGroup					is like RunGroup
		LocalEnableGLNProcessing		is Boolean
		LocalTitle 				        is Alpha size 255
		CompletionMessage				is Alpha 150
		LocalSupplier                   is like Supplier
		LocalSupplierContact            is like SupplierSourceId
		LoopCounter						is Numeric 2
		ValidReceivedDate				is Boolean
		FutureYearPerOne				is Date
		LocalFromInterface				is Boolean
		LocalReceivedDate				is TimeStamp
		LocalNoReceiptLineRelease		is Boolean
		

		LocalBatchReleaseResult							is a PurchaseOrderResult
		LocalInventoryReportGroup						is like InventoryReportGroup
		LocalInventoryReportGroupLocation				is like InventoryLocation
		LocalHeaderErrorReceived						is Boolean
		LocalSkipNotification							is Boolean
		LocalReceiptLineForLocationFound				is Boolean
		LocalDeliveryAndBackorderDocumentReport			is a PurchaseOrderResult
		LocalPutawayDocumentReport						is a PurchaseOrderResult
		LocalReportCompany								is a Company
		LocalReportFinanceEnterpriseGroup				is like FinanceEnterpriseGroup



		LocalNativeLPLBODTrigger		is Boolean
		LocalCrossReferenceValue 		is Alpha size 100
		LocalCrossAccountingEntity		is Alpha size 100
		NewBODTracker  					is a FSMInboundBODTracker view
		LocalFSMInboundBODTracker		is Numeric 15
		Error            				is Boolean
	    ErrorMessage     				is Alpha 300
	    LocalConfigurationParameter		is Alpha size up to 200
	    LocalAEAlreadyExecuted			is Boolean



		LocalReleaseFromMSCM			is Boolean


	Derived Fields

		DerivedReceivedDate is a DerivedField
			type is Date			
			if (LocalReceivedDate entered)
				TimeStampInGMT.Value = LocalReceivedDate 
			else	
				TimeStampInGMT.Value = ReceivedDate
			return TimeStampInGMT.CorporateDate

		DerivedReceivedTime is a DerivedField
			type is AlphaUpper 30
			return ReceivedDate using "%1$tl:%1$tM:%1$tS %1$tp" 

		DerivedBillOfLading is a DerivedField
			type is AlphaUpper size 22
			restricted
			if (action type.Update)
				return blank
			else
				return BillOfLading

		DerivedSupplierSourceId is a DerivedField
			type is like SupplierSourceId
			restricted
			if (Vendor.SingleSupplier
			and PurchaseFromLocation entered
            and PurchaseFromLocation.SupplierSourceIdRel exists
            and PurchaseFromLocation.NumberOfSupplierContacts = 1)
   				return PurchaseFromLocation.SupplierSourceIdRel.SupplierSourceId         					 
            else
				return blank 	

		DerivedPackageTrackingNumber is a DerivedField
			type is Alpha 40
			restricted
			if (action type.Update)
				return blank
			else
				return PurchaseOrderReceiptTrackingRel.PurchaseOrderReceiptTracking.PackageTrackingNumber

		DerivedPackageTrackingLabel is a DerivedField
			type is Numeric size 4
			if (action type.Update)
				return 0
			else
				return PurchaseOrderReceiptTrackingRel.NumberOfLabels

		ContextMessageEntityType is a StringField
			type is Alpha 30
			restricted
			"InforReceiveDelivery"

		ContextMessageText is a MessageField
			restricted
			"PurchaseOrderReceipt<PurchaseOrderReceipt>ForPurchaseOrder<PurchaseOrder>"

		ZeroFilledReceipt is a ConditionalField
			type is Alpha 10
			restricted
			if (PurchaseOrderReceipt < 10)
				"000000000" + PurchaseOrderReceipt
			else
			if (PurchaseOrderReceipt < 100)
				"00000000" + PurchaseOrderReceipt
			else
			if (PurchaseOrderReceipt < 1000)
				"0000000" + PurchaseOrderReceipt
			else
			if (PurchaseOrderReceipt < 10000)
				"000000" + PurchaseOrderReceipt
			else
			if (PurchaseOrderReceipt < 100000)
				"00000" + PurchaseOrderReceipt
			else
			if (PurchaseOrderReceipt < 1000000)
				"0000" + PurchaseOrderReceipt
			else
			if (PurchaseOrderReceipt < 10000000)
				"000" + PurchaseOrderReceipt
			else
			if (PurchaseOrderReceipt < 100000000)
				"00" + PurchaseOrderReceipt
			else
			if (PurchaseOrderReceipt < 1000000000)
				"0" + PurchaseOrderReceipt
			else
				PurchaseOrderReceipt

        PurchaseOrderReceiptString is a StringField
            type is Alpha size 22
            restricted
            PurchaseOrder
            ZeroFilledReceipt[3:10]

		POLineReceivedQuantity is a DerivedField
			type is like Quantity
			return (sum PurchaseOrderReceiptLine set.EnteredReceivedQuantity)

		CatchWeightItemExistsMessage is a DerivedField
			type is Alpha size 30
            if (PurchaseOrderHasCatchWeight)
                return "Purchase Order has catchweight item"

		ReceiverTabMessage is a DerivedField
			type is Alpha size 30
			if (PurchaseOrder.InvoiceMethod.InvoiceByMail)
				return "Invoice by mail"
			if (PurchaseOrder.InvoiceMethod.InvoiceElectronically)
				return "Invoice electronically"
			if (IsInvoiceMethodNotRequired)
				return "ERS Invoice"

		InvoiceMiscAOCMessage is a DerivedField
			type is Alpha size 30
			if (HeaderReceiptAddOnChargesRel exist)
				return "Invoice misc AOC exists"

		InvoiceHasItemMessage is a DerivedField
			type is Alpha size 25
			if (IsInvoiceMethodNotRequired
			and ReceiptLineAOCRel exist)
				return "Invoice item AOC exists"


		OriginalMinorQuantity is a DerivedField 
			type is like Quantity
			restricted
			return (OriginalMinorQuantity + NonServicePurchaseOrderLinesRel.MatchedNotReceivedQuantity)

		CatchWeightQuantityVendorBuy is a DerivedField	
			type is like UOMMultiplier
			restricted
			return (PurchaseOrderReceiptLine set.CatchWeightQuantity
			/ NonServicePurchaseOrderLinesRel.EnteredBuyUOMMultiplier)


		NetReceiptQuantity is a DerivedField
			type is like Quantity
			restricted
			return ((sum NonServicePurchaseOrderLinesRel.ReceivedQuantity)
			+ (sum NonServicePurchaseOrderLinesRel.ChargebackQuantity)
			+ (sum NonServicePurchaseOrderLinesRel.WriteOffQuantity))

		NetMatchQuantity is a DerivedField
			type is like Quantity
			restricted
			return ((sum NonServicePurchaseOrderLinesRel.MatchedQuantity)
			+ (sum NonServicePurchaseOrderLinesRel.ArchivedQuantity))

		POLineQuantityToProcess	is a DerivedField
			type is like Quantity
			restricted
			return (sum NonServicePurchaseOrderLinesRel.QuantityToProcess)

		POLineMatchedNotReceivedQuantity is a DerivedField
			type is like Quantity
			restricted
			return (sum NonServicePurchaseOrderLinesRel.MatchedNotReceivedQuantity)
		ReceiptAddOnChargePOCurrency is a DerivedField
			type is like InternationalAmount
			restricted
			return (sum HeaderReceiptAddOnChargesRel.AddOnChargeAmountPOCurrency)

		OpenToMatchQuantityTotal is a DerivedField
			type is like Quantity
			return (sum PurchaseOrderReceiptLine set.OpenToMatchQuantity )

		OpenToMatchExtendedAmount is a DerivedField
			type is like InternationalAmount
			return (sum PurchaseOrderReceiptLine set.DerivedOpenToMatchExtendedCost)

		ReceiptLinesIndicator is a DerivedField
			type is Alpha size up to 20
			if (PurchaseOrderReceiptLine set exists)
				return "*"
			else
				return ""

		CommentCount is a DerivedField
            type is Alpha size up to 20
            restricted
            if (PurchaseOrderReceiptComment set exists)
                return "(" + instance count of PurchaseOrderReceiptComment set + ")"
            else
                return ""

		ValidatePurchaseOrder is a DerivedField
			type is Boolean
			if   ((Vendor.ValidatePurchaseOrder.Yes)
			or    (!Vendor.ValidatePurchaseOrder.No
			and     Vendor.VendorClass.ValidatePurchaseOrder.Yes)
			or    (!Vendor.ValidatePurchaseOrder.No
			and    !Vendor.VendorClass.ValidatePurchaseOrder.No
			and     MatchCompanyRel.ValidatePurchaseOrder))
				return true

		RequirePurchaseOrder is a DerivedField
			type is Boolean
			if   ((Vendor.RequirePurchaseOrder.Yes)
			or    (!Vendor.RequirePurchaseOrder.No
			and     Vendor.VendorClass.RequirePurchaseOrder.Yes)
			or    (!Vendor.RequirePurchaseOrder.No
			and    !Vendor.VendorClass.RequirePurchaseOrder.No
			and     MatchCompanyRel.PurchaseOrderRequired))
				return true

		ERSCapable is a DerivedField
			type is Boolean

			if  (Vendor.ERSCapable
			or  (PurchaseFromLocation entered
			and  PurchaseFromLocation.ERSCapable))
				return true

		DerivedTransactionCount is a DerivedField
			type is Numeric 7
			return 1

		DerivedRowCount is a DerivedField	
			type is Numeric 5
			return (instance count of PurchaseOrderReceiptLinesRel)
		
		DerivedPOLineCount is a DerivedField	
			type is Numeric 5
			return PurchaseOrderRel.LineCount
		
		DerivedWidgetVendorName is a DerivedField 
            type is Alpha size 60
            return Vendor.VendorName
		
		DerivedOneYearReplicationData is a DerivedField
        	type is Boolean
            if ((current date - create date) <  360)
                return true
            else
                return false
		
		DerivedSearchRequesterName is a DerivedField
			type is Alpha size up to 231
			restricted
			return SearchRequesterName + "*"

    	ReceiptDisplay						is a LabelField
    		"Receipt:<PurchaseOrderReceipt>"
    	PurchaseOrderDisplay				is a LabelField
    		"PurchaseOrder:<PurchaseOrder>"
    	CompanyDisplay						is a LabelField
    		"<Company>,<Company.Name>"
		VendorDisplay						is a LabelField
			"Vendor:<Vendor>,<Vendor.VendorName>"
    	StatusDisplay						is a LabelField
    		"Status:<Status>"

		DerivedPurchaseOrderReceipt is a DerivedField
			type is Alpha 9
			restricted
			return PurchaseOrderReceipt using "%d"

		DerivedPurchaseFromLocationRepresentativeText is a DerivedField
			type is Text
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.VendorLocation.RepresentativeText
				
		DerivedVendorName is a DerivedField
			type is Text
			default label is "Vendor"
			if (Vendor entered)
				return Vendor.DerivedVendorNameID

		DerivedStatus is a DerivedField	
			type is Alpha size 50
			default label is "Status"
			if (TemporaryHold.SentForApproval)
				return SentToEngineMessage
			else
			if (Status.Unreleased)
				return UnreleasedMessage
			else
			if (Status.Released)
				return ReleasedMessage
			else
			if (Status.ReleasedPendingTwoStepReceiving)
				return ReleasedPendingTwoStepReceivingMessage
			else
			if (Status.CreateInProgress)
				return CreateInProgressMessage
			else
			if (Status.ReadyToArchive)
				return ReadyToArchiveMessage
			else
			if (Status.DropShip)
				return DropShipMessage
			else
			if (Status.ReleaseInProgress)
				return ReleaseInProgressMessage
			else
			if (Status.ArchivedClosed)
				return ArchivedClosedMessage

		UnreleasedMessage is a MessageField	
			restricted
			"Unreleased"
		ReleasedMessage is a MessageField
			restricted
			"Released"
		ReleasedPendingTwoStepReceivingMessage is a MessageField
			restricted
			"Released_/_Pending_\Two_\Step_\Receiving"
		CreateInProgressMessage is a MessageField
			restricted
			"Create_\In_\Progress"
		ReadyToArchiveMessage is a MessageField
			restricted
			"Ready_\To_\Archive"
		DropShipMessage is a MessageField
			restricted
			"Drop_\Ship"
		ReleaseInProgressMessage is a MessageField	
			restricted
			"Release_\In_\Progress"
		ArchivedClosedMessage is a MessageField
			restricted
			"Archived_/_\Closed"
		SentToEngineMessage is a MessageField
			restricted
			"Sent_\To_\Engine"


		MobileCompanyDisplay is a LabelField
			"<Company>_-_<Company.Name>"
		MobileShipToLocationDisplay is a DerivedField
			type is Alpha 100
			default label is "ShipTo"
			if (ShipToLocation entered)
				return ShipToLocation.Name + " (" + ShipToLocation + ")"
			else
				return blank
		MobileVendorDisplay is a LabelField
			"<Vendor>_-_<Vendor.VendorName>"
		BuyerMessagesExistMessage is a LabelField
			"UnreleasedBuyerMessagesExist"

		BuyerMessages is a LabelField
			"UnreleasedBuyerMessages"




		DerivedDelimiter is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "Generic_Delimiter"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "tenantID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "releaseID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "logicalID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "VersionID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedConfigFEG is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IsMultipleFEG"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedConfigDocID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "RequiredCleanDocumentID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedIntegrationApplication is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IntegrationApplication"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					

		DerivedBODCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			DerivedBODCurrentTimeStamp = current timestamp
			return DerivedBODCurrentTimeStamp[1:4] + "-" + DerivedBODCurrentTimeStamp[5:6] + "-" + DerivedBODCurrentTimeStamp[7:8] + "T" + DerivedBODCurrentTimeStamp[9:10] + ":" + DerivedBODCurrentTimeStamp[11:12] + ":" + DerivedBODCurrentTimeStamp[13:14] + "Z"

		DerivedCrossGLC is a DerivedField
			type is Alpha size 22
			restricted
			if (DerivedConfigDocID = "Y")
				if (DerivedConfigFEG = "Y")
					return GeneralLedgerCompanyRel.FinanceEnterpriseGroup + DerivedDelimiter + Company using "%d"
				else
					return Company using "%d"
						
		DerivedAECrossAccountingEntity is a DerivedField
			type is Alpha size 22
			restricted
			if(LocalAEAlreadyExecuted != true)
				LocalAEAlreadyExecuted = true				
				if(FSMBODCrossReferenceDetailRel.DestinationValue entered)
					LocalCrossAccountingEntity = FSMBODCrossReferenceDetailRel.DestinationValue
					return LocalCrossAccountingEntity
				else
					LocalCrossAccountingEntity = DerivedCrossGLC
					return LocalCrossAccountingEntity
			else
				return LocalCrossAccountingEntity 

		DerivedAccountingEntity is a DerivedField
			type is Alpha size 50
			restricted
			if (DerivedConfigDocID = "Y")
				return DerivedAECrossAccountingEntity
			else
				return DerivedFSMGroup + DerivedDelimiter + Company.GeneralLedgerCompany.AccountingEntity
						
		DerivedFSMGroup is a DerivedField
			type is Alpha size 20
			restricted
			return GeneralLedgerCompanyRel.FinanceEnterpriseGroup

		DerivedCompany is a DerivedField
			type is Alpha size 20
			restricted
			return Company using "%d"

		DerivedDocumentID is a DerivedField
			type is Alpha size 50
			restricted
			if (DerivedConfigDocID = "Y")
				return PurchaseOrderReceipt
			else
				return DerivedCompany + DerivedDelimiter + PurchaseOrderReceipt

		DerivedBODVariationID is a DerivedField
			type is Alpha size 60
			restricted
			return bod id.VariationID

		DerivedBODID is a DerivedField
			type is Alpha size 200
			restricted
			if (DerivedConfigDocID = "Y")
				return "infor-nid:" + DerivedTenantID + ":" + DerivedAccountingEntity + ":" + ShipToLocation + ":"+ DerivedDocumentID + ":" + PurchaseFromLocation + "?ReceiveDelivery&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
			else
				return "infor-nid:" + DerivedTenantID + ":" + DerivedAccountingEntity + ":" + DerivedCompany + DerivedDelimiter + ShipToLocation + ":" + DerivedDocumentID + ":" + PurchaseFromLocation + "?ReceiveDelivery&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
						
		DerivedActionCode is a DerivedField
			type is Alpha size 10
			restricted
			if (ActionCode = "C" or ActionCode.Create or action type.Create or action type.Update)
				return "Add"
			if (ActionCode = "D" or ActionCode.Delete or action type.Delete)
				return "Delete"

		DerivedPORStatus is a DerivedField
			type is Alpha size 20
			restricted
			if (Status.Released)
				return "Received"
			else
				return ""

		DerivedRECDATE is a DerivedField
			type is Alpha size 40
			restricted
			DerivedRECDATE = ReceivedDate
			return DerivedRECDATE[1:4] + "-" + DerivedRECDATE[5:6] + "-" + DerivedRECDATE[7:8] + "T" + DerivedRECDATE[9:10] + ":" + DerivedRECDATE[11:12] + ":" + DerivedRECDATE[13:14] + "Z"

		DerivedPartyID is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				return Vendor
			else
				return DerivedFSMGroup + DerivedDelimiter + DerivedBusinessGroup + DerivedDelimiter + Vendor

		DerivedLocation is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				return ShipToLocation
			else
				return DerivedCompany + DerivedDelimiter + ShipToLocation

		DerivedBusinessGroup is a DerivedField
			type is Alpha size 5
			restricted
			return Company.GeneralLedgerCompany.BusinessGroup

		DerivedShipToAddressLine1 is a DerivedField
			type is Alpha size 50
			restricted
			return ShipToLocation.PostalAddress.DeliveryAddress.AddressLine1

		DerivedShipToAddressLine2 is a DerivedField
			type is Alpha size 50
			restricted
			return ShipToLocation.PostalAddress.DeliveryAddress.AddressLine2

		DerivedShipToAddressLine3 is a DerivedField
			type is Alpha size 50
			restricted
			return ShipToLocation.PostalAddress.DeliveryAddress.AddressLine3

		DerivedShipToCity is a DerivedField
			type is Alpha size 30
			restricted
			return ShipToLocation.PostalAddress.Municipality

		DerivedShipToCountry is a DerivedField
			type is Alpha size 30
			restricted
			return ShipToLocation.PostalAddress.Country

		DerivedShipToPostalCode is a DerivedField
			type is Alpha size 10
			restricted
			return ShipToLocation.PostalAddress.PostalCode

		DerivedShipToName is a DerivedField
			type is Alpha size 80
			restricted
			return ShipToLocation.PurchaseOrderBillToName

		DerivedShipToURL is a DerivedField
			type is Alpha size 80
			restricted
			return ShipToLocation.PurchaseOrderBillToEmailAddress

		DerivedPurchaseFromLocation is a DerivedField
			type is Alpha size 100
			restricted
			if (PurchaseFromLocation entered)
				if (DerivedConfigDocID = "Y")
					return PurchaseFromLocation
				else
					return DerivedBusinessGroup + DerivedDelimiter + Vendor + DerivedDelimiter + PurchaseFromLocation
			else
				return ""
		
		DerivedShipFromLocation is a DerivedField
			type is Alpha size 100
			restricted
			if(DerivedIntegrationApplication = "Local.ly" and PurchaseFromLocation.VendorAddress.Country = "PL")
				return DerivedCompany + DerivedDelimiter + PurchaseFromLocation
			else
				return PurchaseFromLocation
				
		DerivedGroupPONumber is a DerivedField
			type is Alpha size 50
			restricted
			if (DerivedConfigDocID = "Y")
				return PurchaseOrder
			else
				return DerivedCompany + DerivedDelimiter + PurchaseOrder

		DerivedCompletionDetailText	is a DerivedField
			type is RichText
			if (LocalPurgeRecords)
				return DerivedPurgeReceiptText
			else
				return DerivedReportPurgeReceiptText

		DerivedPurgeReceiptText is a MessageField
			"PurchaseOrderReceiptPurgeHasBeenCompletedFor<LocalPurgeCount>Records."

		DerivedReportPurgeReceiptText is a MessageField
			"ThereAre<LocalPurgeCount>PurchaseOrderReceiptRecordsWhichCanBePurged."
			
		ReleaseCompletionMessage 		is a MessageField
			restricted
			"TheFollowingAction_\'\Release\'_\completed"
			
		ReleaseAndDeliverCompletionMessage 		is a MessageField
			restricted
			"TheFollowingAction_\'\Release_\And_\Deliver\'_\completed"
			
		ReleaseAndDeliverNoBackordersCompletionMessage 		is a MessageField
			restricted
			"TheFollowingAction_\'\Release_\And_\Deliver_\No_\Backorders\'_\completed"
			
		NewReleaseAndDeliverCompletionMessage 		is a MessageField
			restricted
			"TheFollowingAction_\'\N\E\W_\Release_\And_\Deliver\'_\completed"
			
		NewReleaseAndDeliverNoBackordersCompletionMessage 		is a MessageField
			restricted
			"TheFollowingAction_\'\N\E\W_\Release_\And_\Deliver_\No_\Backorders\'_\completed"
			
		SentToEngineCompletionMessage 	is a MessageField
			restricted
			"ReceiptSentToTaxEngineForApproval"

		PurchaseOrderReceiptLineXML is a DerivedField
			type is XMLDocument
			restricted
			if (PurchaseOrderReceiptLinesRel exist)
				for each PurchaseOrderReceiptLinesRel
					each.LocalDelimiter = DerivedDelimiter
					each.LocalFSMGroup = DerivedFSMGroup
					each.LocalBusinessGroup = DerivedBusinessGroup
					each.LocalAccountingEntity = DerivedAccountingEntity
					each.LocalGroupPONumber = DerivedGroupPONumber
					each.LocalPORStatus = DerivedPORStatus
					each.LocalCrossAccountingEntity = DerivedAECrossAccountingEntity
					PurchaseOrderReceiptLineXML += template.IONSyncReceiveDelivery_PurchaseOrderReceiptLine_ST document for each
				return PurchaseOrderReceiptLineXML
			else
				return ""

		SyncReceiveDeliveryXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			SyncReceiveDeliveryXMLBOD = template.IONSyncReceiveDelivery_PurchaseOrderReceipt_ST document for this instance
			
		BROrderToInvoiceXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			BROrderToInvoiceXMLBOD = template.IONBROrderToInvoice_ST document for this instance

		DerivedForegroundLimit is a DerivedField
			type is Numeric 2
			restricted
			return 50

		BuyerName is a StringField
			type is Alpha size 30
			Buyer.Employee.FirstLastName
			
		DerivedPartyIDPOReceipt is a DerivedField
			type is Alpha 50
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return DerivedFSMGroup + DerivedDelimiter + DerivedBusinessGroup + DerivedDelimiter + Vendor
			else
				return ""
		
		DerivedTaxID is a DerivedField
			type is Alpha 25
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.TaxID
			else
				return ""
				
		DerivedVendorNamePOReceipt is a DerivedField
			type is Alpha 120
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.VendorName
			else
				return ""
		
		DerivedAddressLine1 is a DerivedField
			type is Alpha 40
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine1
			else
				return ""
		
		DerivedAddressLine2 is a DerivedField
			type is Alpha 40
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine2
			else
				return ""
		
		DerivedAddressLine3 is a DerivedField
			type is Alpha 40
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine3
			else
				return ""
		
		DerivedAddressLine4 is a DerivedField
			type is Alpha 40
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine4
			else
				return ""
		
		DerivedCityName is a DerivedField
			type is Alpha 58
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.CurrentAddressRel.PostalAddress.Municipality
			else
				return ""
		
		DerivedStateProvince is a DerivedField
			type is Alpha 3
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.CurrentAddressRel.PostalAddress.StateProvince
			else
				return ""
		
		DerivedCountry is a DerivedField
			type is Alpha 30
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.CurrentAddressRel.PostalAddress.Country
			else
				return ""
		
		DerivedPostalCode is a DerivedField
			type is Alpha 12
			restricted
			if(DerivedIntegrationApplication = "Local.ly")
				return Vendor.CurrentAddressRel.PostalAddress.PostalCode
			else
				return ""


		SpecialHandlingMessageForMultipleLines				is a MessageField
			"ItemsWith_\Special_\HandlingInstructionsExist"

		SpecialHandlingMessageForListMultipleLines			is a MessageField
			"ViewItemsWith_\Special_\Handling"


				

		DerivedLinesPutawayCount is a DerivedField
            type is Numeric size 9
            return (instance count of NumberOfLinesPutawayRel)
		
		DerivedPutawayPercentComplete is a ComputeField
            type is Percent size 5.2
            (DerivedLinesPutawayCount / DerivedRowCount)


        DerivedCarrierTrackingNumber is a DerivedField
			type is like TrackingNumber
			restricted
			if (MobileSupplyChainPurchaseOrderReceiptRel.CarrierTrackingNumber entered)
				return MobileSupplyChainPurchaseOrderReceiptRel.CarrierTrackingNumber
			else
				return PurchaseOrderReceipt


    Conditions
    	PrintPutawayAndDelivery
    		restricted
    		when ((Company.PackageTrackingLevel.EnableMscmRadTracking
			and	   Company.PrintPutawayAndDeliveryTicket)
			or	   Company.PackageTrackingLevel.PackageTrackingNotUsed
			or	   Company.PackageTrackingLevel.HeaderLevel
			or	   Company.PackageTrackingLevel.LineLevel)

		IsMSCMTrackedDoNotPrint
			restricted
			when (Company.PackageTrackingLevel.EnableMscmRadTracking
			and   not Company.PrintPutawayAndDeliveryTicket)

		HasCarrier
			restricted
			when (Carrier entered)

		HasDialogForAPurchaseOrderReceiptExists
			when (BuyerSupplierContactMessageRel exists)

		ForSupplier	
			restricted
			when (GeneralLedgerCompanyRel.BusinessGroup = actor.agent(SupplierSourceId).SupplierGroup)
		
		HasSupplier
			restricted
			when (Vendor.HasSupplier)

		HasSupplierContactForPurchaseFrom
			restricted
			when (DerivedSupplierSourceId entered)

		HasMessageDialog
			restricted
			when (SupplierContactMessageRel exists)

		HasMessageDialogOther
			restricted
			when (SupplierMessageDialogRel exists)

		BuyerCanCreateDialog
			restricted
			when (HasSupplier
			and   SupplierGroupRel.CanCreateDialogWithSupplier
			and   Status > 0)

		SupplierContactHasReceiptAccess
			restricted
			when (SupplierSourceIdValidRel.HasReceiptsAccess)

    	IsPrinted
    		restricted
    		when (DeliveredPurchaseOrderReceiptLinesRel exists)

		IsValidForPrinting
			restricted
			when (not IsPrinted
			and  (Status.ReleasedPendingTwoStepReceiving or Status.Released))

		IsValidForReprinting
			restricted
			when (IsPrinted
			and  (Status.ReleasedPendingTwoStepReceiving or Status.Released))

		ReceiptQuantityOffsets
			restricted
			when (ReceiptQuantityNotOffset
			and   PurchaseOrderReceiptLine set.CatchWeightQuantity > 0
			and   CatchWeightQuantityVendorBuy <= NonServicePurchaseOrderLinesRel.MatchedNotReceivedQuantity)

		ReceiptQuantityNotOffset
			restricted
			when ((NonServicePurchaseOrderLinesRel.MatchedNotReceivedQuantity = 0
			and    PurchaseOrderReceiptLine set exist)
			or    (PurchaseOrderReceiptLine set exist
			and    PurchaseOrderReceiptLine set.BuyUOMQuantity > NonServicePurchaseOrderLinesRel.MatchedNotReceivedQuantity))

    	Localization
    		restricted
    		when (HasShipToLocation
    		and   CountryCodeRel.IsoCountryNumber = 076)

    	PurchaseOrderHasCatchWeight
    		restricted
    		when (PurchaseOrderLineCatchWeightRel exists)

    	PurchaseOrderHasBinTracked
    		restricted
    		when (PurchaseOrderLineBinTrackedRel exists)

    	NoExtraColumns
    		restricted
    		when (!PurchaseOrderHasCatchWeight
    		and   !PurchaseOrderHasBinTracked
    		and   Company.DisplayRemainingQuantity = false
    		and   Status.Unreleased)

    	AllExtraColumns
    		restricted
    		when (PurchaseOrderHasCatchWeight
    		and   PurchaseOrderHasBinTracked
    		and   Company.DisplayRemainingQuantity = true
    		and   Status.Unreleased)

    	BinColumn
    		restricted
    		when (!PurchaseOrderHasCatchWeight
    		and   PurchaseOrderHasBinTracked
    		and   Company.DisplayRemainingQuantity = false
    		and   Status.Unreleased)

    	RemainingColumn
    		restricted
    		when (!PurchaseOrderHasCatchWeight
    		and   !PurchaseOrderHasBinTracked
    		and   Company.DisplayRemainingQuantity = true
    		and   Status.Unreleased)

    	CatchWeightColumn
    		restricted
    		when (PurchaseOrderHasCatchWeight
    		and   !PurchaseOrderHasBinTracked
    		and   Company.DisplayRemainingQuantity = false
    		and   Status.Unreleased)

    	CatchWeightAndBinTracked
    		restricted
    		when (PurchaseOrderHasCatchWeight
    		and   PurchaseOrderHasBinTracked
    		and   Company.DisplayRemainingQuantity = false
    		and   Status.Unreleased)

    	RemainingAndBinTracked
    		restricted
    		when (!PurchaseOrderHasCatchWeight
    		and   PurchaseOrderHasBinTracked
    		and   Company.DisplayRemainingQuantity = true
    		and   Status.Unreleased)

    	RemainingAndCatchWeight
    		restricted
    		when (PurchaseOrderHasCatchWeight
    		and   !PurchaseOrderHasBinTracked
    		and   Company.DisplayRemainingQuantity = true
    		and   Status.Unreleased)

    	PurchaseOrderMatch
    		restricted
    		when ((NetReceiptQuantity >= POLineQuantityToProcess
			and NetMatchQuantity >= NetReceiptQuantity)
			and (POLineMatchedNotReceivedQuantity = 0
			and ReceiptQuantityOffsets)
			or  (OriginalMinorQuantity = 0
			and ReceiptQuantityOffsets))

    	HasReceiptLineTemplate
    		restricted
    		when (POReceiptLineTemplate set exists)

		ValidForReceiveAll
			restricted
			when (not HasReceiptLineTemplate
			and   NonCatchWeightPurchaseOrderLineRel exists)

		HasPicture
			restricted
			when (Vendor.Logo entered)

    	PurchaseOrderLineNoCharge
    		restricted
    		when (NonServicePurchaseOrderLinesRel.CostOption.NoCharge)

    	IsCancelBackOrder
    		restricted
    		when (PurchaseFromLocationRel.UndershipmentToleranceOption.CancelAllBackorders
			or 	 (PurchasingVendorRel.UndershipmentToleranceOption.CancelAllBackorders
			and  (!PurchaseFromLocation entered)))

    	InstrastatDetailExist
    		restricted
    		when (first PurchaseOrderReceiptLine set.IntrastatNumber entered)

    	LineHasBuyerMessageCondition
    		restricted
    		when (any PurchaseOrderReceiptLine set.HasUnreleasedReceiptLineBuyerMessage)

    	HasBuyerMessages
    		restricted
    		when (PurchaseOrderBuyerMessagesRel exists)

		HasMatchPOInvoices
			restricted
			when (MatchPurchaseOrderInvoicesRel exists)

    	HasUnreleasedBuyerMessages
    		restricted
    		when (PurchaseOrderUnreleasedBuyerMessagesRel exists)

    	IsValidForActorContext
    		restricted
			when ((actor.context.FinanceEnterpriseGroup != ""
			and   GeneralLedgerCompanyRel.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
			or   (actor.context.FinanceEnterpriseGroup = ""))

        ReceiptAddOnChargeExists
            classic name is ERS-AOC-EXISTS
        	restricted
            when (first HeaderReceiptAddOnChargesRel exists)

        ERSPending
        	restricted
            when (ERSStatus.InvoicePending)

        HasShipToLocation
            classic name is ICLOCATION
        	restricted
            when (ShipToLocation entered)

        HasInvoice
            classic name is INVOICE-EXISTS
        	restricted
            when (Invoice entered)

        IsOpen
            classic name is OPEN-STATUS
        	restricted
            when (Status.Released
            or    Status = 4)

        HasPONumber
            classic name is PURCHORDER
        	restricted
            when (PurchaseOrder entered)

        HasReferenceNumber
            classic name is REFERENCE-NO
        	restricted
            when (ReferenceNumber entered)

        IsReleased
        	restricted
            when (Status >  blank)

        IsUnreleased
        	restricted
    		when (Status.Unreleased
    		or Status.ReleaseInProgress)
		
		IsUnreleasedAndInProgress
			when (IsUnreleased
			or    Status.CreateInProgress)
    	
		IsRelease
        	restricted
    		when (Status.Released)

		IsCreateInProgress
			restricted
			when (Status.CreateInProgress)

		IsPendingTwoStepReceiving
			restricted
			when (Status.ReleasedPendingTwoStepReceiving)

		HasPendingTwoStepReceivingLines
			restricted
			when (ReceiptLinesPendingTwoStepReceivingRel exists)

		IsReadyToArchive
        	restricted
    		when (Status.ReadyToArchive)

    	IsDropShip
        	restricted
    		when (Status.DropShip)

    	IsArchivedClosed
        	restricted
    		when (Status.ArchivedClosed)

		HasReleasedLinesNeedingInspection
			restricted
			when (IsReleased
			and   ReceiptLinesRequiringInspectionRel exists)

		HasReleasedReceiptLinesPendingInspection
			restricted
			when (IsReleased
			and   ReceiptLinesPendingInspectionNoTSRRel exists)

		HasPOReceiptLine
			restricted
        	when (PurchaseOrderReceiptLine set exist)

		InvoiceMethodRequired
			when (not IsInvoiceMethodNotRequired)

		IsInvoiceMethodNotRequired
			restricted
			when (PurchaseOrder.InvoiceMethod.InvoiceNotRequired)

		DisplayInvoiceAOCHdr
			restricted
			when (HasPOReceiptLine
			and   not ERSStatus.VendorToInvoice)

		HasPOReceiptMessage
			restricted
			when (ReceiverTabMessage entered
			or	InvoiceMiscAOCMessage entered)

		IsValidForPackageTrackingEntry
			restricted
			when (Company.PackageTrackingLevel.HeaderLevel
			or    Company.PackageTrackingLevel.EnableMscmRadTracking)

		IsPackageTrackingMSCMEnabled
			restricted
			when (Company.PackageTrackingLevel.EnableMscmRadTracking)

		LinkedToContextInvoice
			restricted
			when (ContextMatchPurchaseOrderInvoiceRel exists)

		ReceiptExists
			restricted
			when (PurchaseOrderReceipt exists)

		OnlyHasServiceItem
			restricted
			when (all PurchaseOrderReceiptLine set.ItemType.Service)

		CompanyShowsRemainingQuantity
			restricted
			when (Company.DisplayRemainingQuantity = true)

		HasPOLinesToReceive
			restricted
			when (NonServicePurchaseOrderLinesToReceiveRel exists)

		InterfacedFailedToRelease
			restricted
			when (OriginatingInterfaceRun entered
			and   OriginatingInterfaceRun.ReleaseReceipts
			and   Status.Unreleased)

		SearchRequesterFound
			restricted
			when (SearchRequester not entered
			or    PurchaseOrderLineSourceForSearchRequesterRel exists)

		SearchRequesterNameFound
			restricted
			when (SearchRequesterName not entered
			or    PurchaseOrderLineSourceForSearchRequesterNameRel exists)

		HasLineSourceForThisRequester
			restricted
			when (PurchaseOrderLineSourceForRequesterRel exists)

		InspectionsExist
			restricted
			when (POReceiptInspectionsRel exists)

		AdjustmentsExist
			restricted
			when (POReceiptAdjustmentsRel exists)

		ShowTrackPanel
			restricted
			when (PurchaseOrderReceiptTrackingRel exists
			or    Company.PackageTrackingLevel.HeaderLevel)

		WorkPhoneEntered
			restricted
			when(PurchaseOrder.Buyer.EmployeeWorkTelephone entered)

		PurchaseOrderReleased
			restricted
			when (PurchaseOrder.Released
			and PurchaseOrder.PurchaseOrderLifeCycleState.Released)
			
		SupplierShowInvoice
			restricted
			when (MatchPurchaseOrderInvoicesRel exists
			and	  !actor.agent(SupplierSourceId).SupplierGroup.SPDisablePortalInvoices)
			
		SupplierShowPO
			restricted
			when (PurchaseOrder entered
			and	  !actor.agent(SupplierSourceId).SupplierGroup.SPDisablePortalPOs)

		IsValidForRelease
			restricted
			when (not InterfaceInProcess
			and   not Status.DropShip)


		HasLinesWithSpecialHandling
			restricted
			when (ReceiptLinesWithSpecialHandlingCodeRel exists)

		HasBuyerMsgs
    		when (PurchaseOrderBuyerMessagesRel exists)

		IsReceivingPutaway
			restricted
			when (IsPendingTwoStepReceiving
			and   PutawayStatus.ForReceivingPutaway)

		IsConfirmedPutaway
			restricted
			when (PutawayStatus.ConfirmedPutawayFeedback)

		IsValidForReceivingPutaway
			restricted
			when (ShipToLocation.UseAsWarehouseLocation
			and IsReceivingPutaway)

		IsMSCMEnabled
			when (MobileSupplyChainCompanyRel.ActualMobileSupplyChainEnabled)

		IsValidForMSCMPOInspectionCreation
			restricted
			when (LocalReleaseFromMSCM
			and   HasReleasedLinesNeedingInspection)
			
		HasLineWithMultipleLineSources
			when (HasMultipleLineSourcesRel exists)
			
    Relations

		BuyerSupplierContactMessageRel
			one-to-many relation to SupplierContactMessage
			Field Mapping uses ByReceipt
				related.OriginatingCompany			= Company
				related.OriginatingReceipt			= PurchaseOrderReceipt
    	InventoriedReceiptLinesRel
            one-to-many relation to PurchaseOrderReceiptLine
            Field Mapping uses symbolic key
            	related.Company						= Company
            	related.PurchaseOrderReceipt		= PurchaseOrderReceipt
            Instance Selection
                where (related.IsInventoried
                and    related.Status.ReleasedInspected)

		InventoriedReceiptLineForPutawayRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrderReceipt		= PurchaseOrderReceipt
			Instance Selection
				where (related.IsInventoried
				and	  (related.Status.ReleasedInspected or related.Status.ReleasedPendingTwoStepReceiving))

		NonInventoriedReceiptLinesRel
            one-to-many relation to PurchaseOrderReceiptLine
            Field Mapping uses symbolic key
            	related.Company						= Company
            	related.PurchaseOrderReceipt		= PurchaseOrderReceipt
            Instance Selection
                where ((related.ItemType.NonStock
                or 	    related.ItemType.Special)
                and     related.Status.ReleasedInspected)
        
        PurchaseOrderReceiptLinesForBackorderRel
        	one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.Status.ReleasedInspected)

		SupplierContactMessageRel
			one-to-many relation to SupplierContactMessage
			Field Mapping uses symbolic key
				related.SupplierGroup				= actor.agent(SupplierSourceId).SupplierGroup
 				related.Supplier  			 		= actor.agent(SupplierSourceId).Supplier
				related.SupplierSourceId            = actor.agent(SupplierSourceId).SupplierSourceId
			Instance Selection
				where (related.OriginatingCompany			= Company
				and    related.OriginatingReceipt           = PurchaseOrderReceipt) 

		BuyerEmployeeRel
			one-to-one relation to Employee
			Field Mapping uses symbolic key
				related.HROrganization	= actor.context.HROrganization
				related.Employee		= Buyer
		SupplierGroupRel
			one-to-one relation to SupplierGroup
			Field Mapping uses symbolic key
				related.SupplierGroup = GeneralLedgerCompanyRel.BusinessGroup

		SupplierRel
			one-to-many relation to Supplier
			Field Mapping uses ByVendor
				related.SupplierGroup				= SupplierGroupRel.SupplierGroup
 				related.Vendor						= Vendor

		SupplierMessageDialogRel
			one-to-many relation to SupplierMessageDialog

			Field Mapping uses symbolic key
				related.SupplierGroup								= GeneralLedgerCompanyRel.BusinessGroup
			Instance Selection
				where (related.SupplierContactMessage.OriginatingCompany	= Company
				and    related.SupplierContactMessage.OriginatingReceipt   = PurchaseOrderReceipt)







		SupplierSourceIdValidRel
			one-to-one relation to SupplierSourceId
			Field Mapping uses symbolic key
				related.SupplierGroup    = SupplierGroupRel.SupplierGroup
				related.Supplier         = LocalSupplier
				related.SupplierSourceId = LocalSupplierContact 

		PurchaseFromSupplierSourceIdRel   
			one-to-one relation to SupplierSourceId
			Field Mapping uses symbolic key
				related.SupplierGroup    = SupplierGroupRel.SupplierGroup
				related.Supplier         = SupplierRel.Supplier
				related.SupplierSourceId = DerivedSupplierSourceId  

    	ReceiptLinesForLocationRel
    		one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrderReceipt		= PurchaseOrderReceipt
			Instance Selection
				where (related.ShipToLocation   	= LocalShipToLocation)

    	ReceiptLinesWithinLocationGroupRel
    		one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrderReceipt		= PurchaseOrderReceipt
			Instance Selection
				where (related.ShipToLocation   	= LocalInventoryReportGroupLocation)

  		InventoryReportGroupLocationsRel
			one-to-many relation to InventoryReportGroupLocation
			Field Mapping uses symbolic key
				related.Company						= LocalCompany
				related.InventoryReportGroup		= LocalInventoryReportGroup

		ReceiptLinesWithBackorderRel
        	one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
        	Instance Selection
        		where (related.HasBackorders)

    	UndeliveredReceiptLinesRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
    		Instance Selection
    			where (not related.FullyDelivered
    			and    related.Status.ReleasedInspected)

		ReceiptLinesPendingDeliveryRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt 	= PurchaseOrderReceipt
			Instance Selection
				where (not related.FullyDelivered
				and   (related.Status.ReleasedInspected or related.Status.ReleasedPendingTwoStepReceiving))	

		DeliveryAndBackOrderReportRel
            one-to-many relation to PurchaseOrderResult
            Field Mapping uses symbolic key
                related.FinanceEnterpriseGroup      = LocalReportFinanceEnterpriseGroup
            Instance Selection
                where (related.ReportType.DeliveryTicketAndBackorderReport
                and	   related.ParametersPrintDeliveryAndPutaway.Company	= LocalReportCompany)

        PutawayDocumentReportRel
            one-to-many relation to PurchaseOrderResult
            Field Mapping uses symbolic key
                related.FinanceEnterpriseGroup      = LocalReportFinanceEnterpriseGroup
            Instance Selection
                where (related.ReportType.PurchaseOrderPutawayReport
                and	   related.ParametersPrintDeliveryAndPutaway.Company	= LocalReportCompany)

		ProcessRuleSecurityRel
			one-to-many relation to Security
			Field Mapping uses symbolic key
				related.Security.ProductLine		= parentcontext.dataarea
				related.Security.Param				= "1"
			Instance Selection
				where (related.Value				= "PROCESS_RULES")

		ApplicationAdministratorRoleRel
			one-to-one relation to ActorRole
			Field Mapping uses symbolic key
				related.Actor			= actor
				related.ActorRole.Role	= "ApplicationAdministrator_ST"

		BuyerRoleRel
			one-to-one relation to ActorRole
			Field Mapping uses symbolic key
				related.Actor			= actor
				related.ActorRole.Role	= "Buyer_ST"

		SupplyManagementProcessorRoleRel
			one-to-one relation to ActorRole
			Field Mapping uses symbolic key
				related.Actor 			= actor
				related.ActorRole.Role	= "SupplyManagementProcessor_ST"

		PurchasingManagerRoleRel
			one-to-one relation to ActorRole
			Field Mapping uses symbolic key
				related.Actor 			= actor
				related.ActorRole.Role	= "PurchasingManager_ST"

		InventoryManagerRoleRel
			one-to-one relation to ActorRole
			Field Mapping uses symbolic key
				related.Actor 			= actor
				related.ActorRole.Role	= "InventoryManager_ST"

		ReceiverRoleRel
			one-to-one relation to ActorRole
			Field Mapping uses symbolic key
				related.Actor 			= actor
				related.ActorRole.Role	= "Receiver_ST"



		NotReadyForArchiveReceiptLinesRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (not related.ReadyForArchive)

		InventoriedChangedToNonInventoriedPOReceiptLinesRel 
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (not related.ItemLocationInventoryTracked
				and		related.IsInventoried)

		DetailsNotInBalancePOReceiptLinesRel 
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where 	(not related.DetailsInBalance)

		AssetDetailsNotInBalancePOReceiptLineRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (not related.AssetDetailsInBalance)

		ReceivedAssetDetailsNotInBalanceRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (not related.ReceivedAssetDetailsInBalance)

		CancelledAssetDetailsNotInBalanceRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (not related.CancelledAssetDetailsInBalance)

		UnreceivedDetailsPOReceiptLineRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.HasUnreceivedAssetDetails)

        PurchaseOrderTransactionDetailsWithBinRel
            one-to-many relation to PurchaseOrderTransactionDetail
            delete cascades
            Field Mapping uses symbolic key
                related.Company = Company
            Instance Selection
                where (related.PurchaseOrderTransactionDetail.PurchaseTransactionDocumentType.Receiving
                and   related.PurchaseOrderTransactionDetail.DocumentNumberNumeric = PurchaseOrderReceipt
                and   related.Bin entered)

    	PurchaseOrderReceiptLinesRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt

    	DeliveredPurchaseOrderReceiptLinesRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
    		Instance Selection
    			where (related.FullyDelivered)

        MatchCompanyRel
            one-to-one relation to MatchCompany
            Field Mapping uses symbolic key
                related.Company = Company

		ItemLocationRel
            one-to-one relation to ItemLocation
            required
            Field Mapping uses symbolic key
                related.Company           = Company
                related.InventoryLocation = ShipToLocation
                related.Item              = LocalItem

        ReceiptLinesRequiringInspectionRel
        	one-to-many relation to PurchaseOrderReceiptLine
            Field Mapping uses symbolic key
                related.Company              = Company
                related.PurchaseOrderReceipt = PurchaseOrderReceipt
            Instance Selection
                where (related.InspectionRequired = true)

		ReceiptLinesPendingInspectionNoTSRRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt 	= PurchaseOrderReceipt
			Instance Selection
				where (related.InspectionRequired
				and    related.Status.ReleasedRequiresInspection)

        ReceiptLinesForDeletionRel
            one-to-many relation to PurchaseOrderReceiptLine
            delete cascades
            Field Mapping uses symbolic key
                related.Company              = Company
                related.PurchaseOrderReceipt = PurchaseOrderReceipt
            Instance Selection
                where (related.EnteredReceivedQuantity = 0)

        ReceiptLinesForReleasingRel
            one-to-many relation to PurchaseOrderReceiptLine
            delete cascades
            Field Mapping uses symbolic key
                related.Company              = Company
                related.PurchaseOrderReceipt = PurchaseOrderReceipt
            Instance Selection
                where (related.EnteredReceivedQuantity > 0)

        ReceiptLinesForReleaseWithDifferentLocationsRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
        	Instance Selection
        		where (related.ShipToLocation != LocalShipToLocation)

        PurchaseOrderReceiptTrackingRel
            one-to-many relation to PurchaseOrderReceiptTracking
            delete cascades
            Field Mapping uses symbolic key
                related.Company                  = Company
                related.PurchaseOrderReceipt     = PurchaseOrderReceipt
                related.PurchaseOrderReceiptLine = blank

        PurchaseOrderReceiptLineTrackingRel
            one-to-many relation to PurchaseOrderReceiptTracking
            delete cascades
            Field Mapping uses symbolic key
                related.Company                  = Company
                related.PurchaseOrderReceipt     = PurchaseOrderReceipt
            Instance Selection
            	where (related.PurchaseOrderReceiptLine entered)


        PurchaseOrderReceiptLineAOCRel 
            one-to-many relation to PurchaseOrderReceiptLineAOC
            Field Mapping uses symbolic key
                related.Company                  = Company
                related.PurchaseOrderReceipt     = PurchaseOrderReceipt

		InterfacedReceiptAddOnChargeRel
			one-to-many relation to PurchaseOrderReceiptLineAOC
			delete cascades
			Field Mapping uses Set3
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
				related.PurchaseOrderReceipt		= PurchaseOrderReceipt
				related.PurchaseOrderReceiptLine	= blank
				related.AddOnCharge					= LocalInterfacedAddOnCharge

		ReceiptHeaderAddOnChargeRel
			one-to-many relation to PurchaseOrderReceiptLineAOC
			delete cascades
			Field Mapping uses Set3
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where (related.PurchaseOrderReceiptLine not entered
				and    related.AddOnCharge			= LocalInterfacedAddOnCharge)

		PurchaseOrderReceiptAOCWithoutAddOnChargeAmountRel is a PurchaseOrderReceiptLineAOC set
			Instance Selection
				where (not related.ZeroCost
				and    related.TotalAddOnChargeAmount = 0)	

        HeaderReceiptAddOnChargesRel
            one-to-many relation to PurchaseOrderReceiptLineAOC
            Field Mapping uses symbolic key
                related.Company                  = Company
                related.PurchaseOrderReceipt     = PurchaseOrderReceipt
                related.PurchaseOrderReceiptLine = blank

        ReceiptLineAOCRel
        	one-to-many relation to PurchaseOrderReceiptLineAOC
        	Field Mapping uses symbolic key
                related.Company                  	= Company
                related.PurchaseOrderReceipt     	= PurchaseOrderReceipt
            Instance Selection
            	where (related.PurchaseOrderReceiptLine entered)

		DuplicateReferenceRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set11
                related.Company					= Company
                related.ReferenceNumber			= ReferenceNumber
            Instance Selection
                where (related.PurchaseOrderReceipt	!= PurchaseOrderReceipt)

        PayablesInvoiceRel
        	one-to-many relation to PayablesInvoice
        	Field Mapping uses ByCompanyVendorInvoice
        		related.Company			= Company
        		related.Vendor			= Vendor
        		related.Invoice			= Invoice
        		related.Suffix			= blank
        		related.CancelSequence	= blank

 		NonServicePurchaseOrderLinesRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder

 		NonServicePOLinesWithRemainingQtyRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
  			Instance Selection
 				where (related.RemainingQuantity > 0)

 		LinesForCancelBackorderRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
 				where  (related.RemainingQuantity > 0
 				and 	related.IsReceivable)

 		CatchWeightNonServicePurchaseOrderLinesRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
 			Instance Selection
 				where (related.Item.CatchWeightCode.AllTransactionsRequireBoth
				or		related.Item.CatchWeightCode.ReceiptRequiresBoth)

 		NonCatchWeightPurchaseOrderLineRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
  			Instance Selection
 				where (not related.IsCatchWeightItem)

 		NonCatchWeightItemsToReceiveRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
  			Instance Selection
 				where (related.RemainingQuantity > 0
 				and    not related.IsCatchWeightItem)

    	NonServicePurchaseOrderLinesToReceiveRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
 			Instance Selection
 				where (related.RemainingQuantity > 0)

    	PurchaseOrderLineCatchWeightRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
    		Instance Selection
    			where (related.Item exists
    			and    related.Item.IsCatchWeightItem)
    	PurchaseOrderLineBinTrackedRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
    		Instance Selection
    			where (related.ItemLocationRel exists
    			and    related.ItemLocationRel.BinTracked)

 		PurchaseOrderLineSourceForRequesterRel
 			one-to-many relation to PurchaseOrderLineSource
 			Field Mapping uses BySourceDocument
 				related.Company											= Company
 				related.PurchaseOrder									= PurchaseOrder
            Instance Selection
                where (related.Requester = actor.agent(Employee).Employee)

 		PurchaseOrderRequesterLineSourceRel
 			one-to-many relation to PurchaseOrderLineSource
 			Field Mapping uses BySourceDocument
 				related.Company											= Company
 				related.PurchaseOrder									= PurchaseOrder

 		PurchaseOrderLineSourceForSearchRequesterRel
 			one-to-many relation to PurchaseOrderLineSource
 			Field Mapping uses BySourceDocument
 				related.Company											= Company
 				related.PurchaseOrder									= PurchaseOrder
 				related.PurchaseOrderLineSource.SourceDocumentOrigin	= SourceDocumentOrigin.Requisitions
            Instance Selection
                where (related.Requester = SearchRequester)

 		PurchaseOrderLineSourceForSearchRequesterNameRel
 			one-to-many relation to PurchaseOrderLineSource
 			Field Mapping uses BySourceDocument
 				related.Company											= Company
 				related.PurchaseOrder									= PurchaseOrder
 				related.PurchaseOrderLineSource.SourceDocumentOrigin	= SourceDocumentOrigin.Requisitions
            Instance Selection
                where (related.Requester.PresentationNameSnapshot like DerivedSearchRequesterName)

    	UnreleasedPurchaseOrderReceiptsRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
                related.Company					= Company
                related.PurchaseOrder			= PurchaseOrder
            Instance Selection
                where (related.Status.Unreleased
                or     related.Status.CreateInProgress
                or     related.Status.ReleaseInProgress)

    	UnreleasedNotInProcessReceiptsRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
                related.Company					= Company
                related.PurchaseOrder			= PurchaseOrder
            Instance Selection
                where (related.Status.Unreleased
				and   !related.InterfaceInProcess)

		POReceiptAdjustmentAndInspectionRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses Set3
				related.Company					= Company
    			related.PurchaseOrderReceipt	= PurchaseOrderReceipt

		UnreleasedAdjustmentRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses Set3
				related.Company					= Company
    			related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.IsAdjustmentDocument)

		UnreleasedInspectionRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses Set3
				related.Company					= Company
    			related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.IsInspectionDocument)

		POReceiptAdjustmentsRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses ByPurchaseOrder
				related.Company					= Company
			Instance Selection
				where (related.IsAdjustmentDocument
				and    related.PurchaseOrderReceipt.PurchaseOrder 	= PurchaseOrder
				and    related.PurchaseOrderReceipt 				= PurchaseOrderReceipt)

		POReceiptInspectionsRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses ByPurchaseOrder
				related.Company					= Company
			Instance Selection
				where (related.IsInspectionDocument
				and    related.PurchaseOrderReceipt.PurchaseOrder 	= PurchaseOrder
				and    related.PurchaseOrderReceipt 				= PurchaseOrderReceipt)

		IntrastatHeaderRel
			one-to-many relation to IntrastatHeader
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.TaxEntity				= Company.AccountingEntity
			Instance Selection
				where (related.PurchaseOrder  = PurchaseOrder
				and    related.DocumentNumber = PurchaseOrderReceipt
				and	   related.Vendor		  = Vendor)

		VendorRel
			one-to-one relation to Vendor
			Field Mapping uses symbolic key
				related.VendorGroup		= GeneralLedgerCompanyRel.BusinessGroup
				related.Vendor			= Vendor

		PurchasingVendorRel
			one-to-one relation to PurchasingVendor
			Field Mapping uses symbolic key
				related.VendorGroup		= GeneralLedgerCompanyRel.BusinessGroup
				related.Vendor			= Vendor

		CountryCodeRel
			one-to-one relation to Country
			Field Mapping uses symbolic key
				related.Country				= ShipToLocation

        PurchaseOrderAndLineAddOnChargeRel  
            one-to-many relation to PurchaseOrderAndLineAddOnCharge
            Field Mapping uses symbolic key
                related.Company 				= LocalCompany
                related.PurchaseOrder			= LocalPurchaseOrder
                related.PurchaseOrderLine 		= LocalPurchaseOrderLine

        PoreccpdHeaderAOCRel 
            one-to-many relation to PurchaseOrderReceiptLineAOC
            Field Mapping uses Set3
                related.Company 					= LocalPAOCompany
                related.PurchaseOrder				= LocalPAOPurchaseOrder
            Instance Selection
            	where (related.PurchaseOrderReceipt	!= blank
            	or     related.AddOnCharge			= LocalPAOAddOnCharge)

        POReceiptLineAOC2Rel
        	one-to-one relation to PurchaseOrderReceiptLineAOC
        	Field Mapping uses symbolic key
                related.Company                  	= LocalRecCompany
                related.PurchaseOrderReceipt     	= LocalRecPurchaseOrderReceipt
                related.PurchaseOrderReceiptLine	= LocalRecPurchaseOrderReceiptLine
                related.AddOnCharge				    = LocalRecAddOnCharge

       	PurchaseFromLocationRel										
       		one-to-one relation to PurchaseFromLocation
			Field Mapping uses symbolic key
				related.VendorGroup				= GeneralLedgerCompanyRel.BusinessGroup
				related.Vendor					= Vendor
				related.PurchaseFromLocation	= PurchaseFromLocation

		ContextMatchPurchaseOrderInvoiceRel
			one-to-one relation to MatchPurchaseOrderInvoice
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
				related.PayablesInvoice	= PayablesInvoice
				related.Vendor			= Vendor

		MatchPurchaseOrderInvoicesRel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder

		ReceiptLinesForInventoriedItemsRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.IsInventoried)

		PurchaseOrderBuyerMessagesRel
			one-to-many relation to PurchaseOrderBuyerMessage
			Field Mapping uses AllByReceiver
				related.Company         		= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (not related.PurchaseOrderReceipt.IsCreateInProgress)

		AllPurchaseOrderBuyerMessagesRel
			one-to-many relation to PurchaseOrderBuyerMessage
			Field Mapping uses AllByReceiver
				related.Company         		= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt

		PurchaseOrderUnreleasedBuyerMessagesRel
			one-to-many relation to PurchaseOrderBuyerMessage
			Field Mapping uses AllByReceiver
				related.Company         		= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.Status.Unreleased
				and    not related.PurchaseOrderReceipt.IsCreateInProgress)

		PurchaseOrderCommentRel	
			one-to-many relation to PurchaseOrderComment
			Field Mapping uses ByCommentType
				related.Company					= Company
				related.PurchaseOrder			= PurchaseOrder
			Instance Selection
				where (not related.IsSystemGeneratedType
				and    not related.CommentType.NamedPlaceIncoterm
				and    not related.CommentType.Asset)

		WarehouseDemandRel
        	one-to-one relation to WarehouseDemand
        	Field Mapping uses symbolic key
        		related.Company								= Company
        		related.WarehouseDemand.DemandSystemCode	= "PO"
        		related.WarehouseDemand.DemandDocument		= PurchaseOrder
        		related.WarehouseDemand.DemandCompany		= Company


        PayablesInvoiceForIDMChargebackRel
        	one-to-one relation to PayablesInvoice
        	Field Mapping uses symbolic key
        		related.Company			= Company
        		related.PayablesInvoice	= PayablesInvoice









		NonServicePurchaseOrderLineForReceiveAllRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsReceivable
				and   (LocalShipToLocFilter not entered
				or     related.ShipToLocation = LocalShipToLocFilter))

		CatchWeightNonServicePOLineRelForReceiveAll is a PurchaseOrderLine set
			Instance Selection
				where (related.IsReceivable
				and   (LocalShipToLocFilter not entered
				or     related.ShipToLocation = LocalShipToLocFilter)
				and    related.IsCatchWeightItem)

		NonCatchWeightNonServicePOLineRelForReceiveAll is a PurchaseOrderLine set
			Instance Selection
				where (related.IsReceivable
				and   (LocalShipToLocFilter not entered
				or     related.ShipToLocation = LocalShipToLocFilter)
				and    not related.IsCatchWeightItem)

		POReceiptLinesForBackorderRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.CancelBackorder)

		ReceiptLinesFromOrderEntryRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.CancelBackorder
				and    related.IsPartialReceiptLine
				and    related.PurchaseOrderLine.IsCreatedFromOrderEntry)

		ReceiptLinesWithUnmatchedInvoiceRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.CancelBackorder
				and    related.IsPartialReceiptLine
				and    related.PurchaseOrderLine.HasUnmatchedInvoice)

		ReceiptLinesNotEligibleToBeCancelledRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.CancelBackorder
				and    related.IsPartialReceiptLine
				and    !related.PurchaseOrderLine.PurchaseOrderLineEligibleToBeCancelled)

		ReceiptLineForTwoStepReceivingRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.IsInventoried
				and    related.ShipToLocation.TwoStepPurchaseOrderReceiving
				and    related.Status.Entered)

		ReceiptLinesPendingTwoStepReceivingRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.IsInventoried
				and    related.ShipToLocation.TwoStepPurchaseOrderReceiving
				and    related.Status.ReleasedPendingTwoStepReceiving)

		ReceiptInterfaceInputRel
			one-to-many relation to ReceiptInterfaceInput
			Field Mapping uses ByRunGroup
				related.RunGroup						= LocalRunGroup
				related.Company							= Company
			Instance Selection
				where (related.RecordType.ReceiptHeader
				and    related.NewPurchaseOrderReceipt 	= PurchaseOrderReceipt)

		CompanySystemClosingControlForPORel
			one-to-one relation to CompanySystemClosingControl
			Field Mapping uses symbolic key
				related.Company							= Company
				related.GeneralLedgerSystemCode			= "PO"

		PurchaseOrderRel
			one-to-one relation to PurchaseOrder
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder

		PurgeProcurementTransactionDistributionRel
			one-to-many relation to ProcurementTransactionDistribution
			Field Mapping uses symbolic key
				related.Company								= Company
			Instance Selection
				include deleted records
				where ((related.ProcurementDocumentNumber	= PurchaseOrderReceipt.PurchaseOrder.DerivedPurchaseOrder
				and	    related.Location					= PurchaseOrderReceipt.ShipToLocation
				and	    related.SystemCode					= "PO"
				and	    related.DocumentType				= "PO")
				or     (related.ProcurementDocumentNumber	= DerivedPurchaseOrderReceipt
				and     related.Location					= ShipToLocation
				and     related.SystemCode					= "PO"
				and     related.DocumentType				= "PO"))

		InventoryCompanyRel
			one-to-one relation to InventoryCompany
			Field Mapping uses symbolic key
				related.Company			= Company
		
		ICSystemClosingControlRel
			one-to-one relation to CompanySystemClosingControl
			Field Mapping uses symbolic key
				related.Company					= Company
				related.GeneralLedgerSystemCode	= "IC"

 		PurchasingCompanyRel
            one-to-one relation to PurchasingCompany
            Field Mapping uses symbolic key
                related.Company 		= Company

		PurchasingCompanyForIDMRel
			one-to-one relation to PurchasingCompany
			Field Mapping uses symbolic key
				related.Company			= LocalCompany

		PurgePurchaseOrderReceiptTrackingRel
			one-to-many relation to PurchaseOrderReceiptTracking

			Field Mapping uses symbolic key
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				include deleted records

		PurgePurchaseOrderTransactionDetailRel
			one-to-many relation to PurchaseOrderTransactionDetail
			Field Mapping uses symbolic key
				related.Company															= Company
			Instance Selection
				include deleted records
				where (related.PurchaseOrderTransactionDetail.DocumentNumberNumeric		= PurchaseOrderReceipt
				and    related.PurchaseOrderTransactionDetail.PurchaseTransactionDocumentType.Receiving)

		PurgePurchaseOrderReceiptLineAOCRel
			one-to-many relation to PurchaseOrderReceiptLineAOC
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				include deleted records

		PurgePurchaseOrderReceiptLineRel
			one-to-many relation to PurchaseOrderReceiptLine

			Field Mapping uses symbolic key
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				include deleted records

		PurgePOReceiptAdjustmentAndInspectionRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses symbolic key
				related.Company  					= Company
			Instance Selection
				include deleted records
				where (related.PurchaseOrderReceipt	= PurchaseOrderReceipt)

		PurgePurchaseOrderBuyerMessageRel
			one-to-many relation to PurchaseOrderBuyerMessage
			Field Mapping uses symbolic key
				related.Company  					= Company
			Instance Selection
				include deleted records
				where (related.PurchaseOrderReceipt	= PurchaseOrderReceipt)

		PurgePurchaseOrderReceiptCommentRel
			one-to-many relation to PurchaseOrderReceiptComment
			Field Mapping uses part of key
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				include deleted records



		FSMBODConfigurationParameterRel
        	one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
            	related.FSMBODConfigurationParameter 		= LocalConfigurationParameter

		FSMBODConfigurationRel
        	one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
            	related.FSMBODConfiguration.Verb 		= 1
            	related.FSMBODConfiguration.Noun 		= "ReceiveDelivery"
            	related.FSMBODConfiguration.Direction 	= 1

		FSMBODCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "CSFGLC"
            	related.FSMBODCrossReference.DestinationField 	= "DESTAE"
            Instance Selection
				where (related.SourceValue	= DerivedCrossGLC)

		FSMInboundBODTrackerRel
            one-to-one relation to FSMInboundBODTracker
            Field Mapping uses symbolic key
                related.FSMInboundBODTracker	= LocalFSMInboundBODTracker
				


		GeneralLedgerCompanyRel
			one-to-one relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
				related.Company		= Company


		ReceiptLinesWithSpecialHandlingCodeRel is a PurchaseOrderReceiptLine set
			Instance Selection
				where (related.PurchaseOrderLine.SpecialHandlingCode entered)

		MobileSupplyChainConfigurationRel
			one-to-one relation to MobileSupplyChainConfiguration
			Field Mapping uses symbolic key
				related.MobileSupplyChainConfiguration	= Company.FinanceEnterpriseGroup

		MobileSupplyChainCompanyRel
			one-to-one relation to MobileSupplyChainCompany
			Field Mapping uses symbolic key
				related.Company		= Company

		NonDetailTrackedReceiptLinesRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company  				= Company
				related.PurchaseOrderReceipt	= PurchaseOrderReceipt
			Instance Selection
				where (related.IsNonDetailTracked)
		
		ReceiptLineDetailsRel
			one-to-many relation to PurchaseOrderTransactionDetail
			Field Mapping uses symbolic key
				related.Company  														= Company
			Instance Selection
				where (related.PurchaseOrderTransactionDetail.DocumentNumberNumeric				= PurchaseOrderReceipt
				and    related.PurchaseOrderTransactionDetail.PurchaseTransactionDocumentType	= PurchaseTransactionDocumentType.Receiving
				and    not related.IsUDIRequiredAtReceipt)
		
		POTransactionDetailsDifferentLotExpirationRel
			one-to-many relation to PurchaseOrderTransactionDetail
			Field Mapping uses Set2
				related.Company                                                                 = Company
				related.PurchaseOrderReceipt                                                    = PurchaseOrderReceipt
			Instance Selection
				where (related.PurchaseOrderTransactionDetail.PurchaseTransactionDocumentType   = PurchaseTransactionDocumentType.Receiving
				and    not related.IsUDIRequiredAtReceipt
				and    related.HasDifferentLotExpirationDate)

		ReceiptUDIDetailsRel
			one-to-many relation to PurchaseOrderUDIDetail
			Field Mapping uses symbolic key
				related.Company					= Company
			Instance Selection
				where (related.PurchaseOrderUDIDetail.DocumentNumberNumeric				= PurchaseOrderReceipt
				and    related.PurchaseOrderUDIDetail.PurchaseTransactionDocumentType	= PurchaseTransactionDocumentType.Receiving)
		
		MobileSupplyChainPurchaseOrderReceiptRel
			one-to-many relation to MobileSupplyChainPurchaseOrderReceipt
			Field Mapping uses symbolic key
				related.Company                     = Company
			Instance Selection
				where (related.PurchaseOrderReceipt = PurchaseOrderReceipt
				and    related.ErrorMessage not entered)

		POReceiptAdjustmentAndInspectionForMSCMRel
			one-to-one relation to POReceiptAdjustmentAndInspection
			Field Mapping uses Set5
				related.Company								= Company
				related.AdjustmentInspectionDocumentType    = AdjustmentInspectionDocumentType.ReceiptInspection
				related.PurchaseOrderReceipt				= PurchaseOrderReceipt

		POReceiptLineTemplateCancelBackorderRel is a POReceiptLineTemplate set
			Instance Selection
				where (related.PurchaseOrderReceiptLine not entered
				and  ((related.ReceivedQuantity not entered and related.CancelBackorder)
				or     related.CancelRemaining))

		NumberOfLinesPutawayRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set6
				related.Company                  = Company
				related.PurchaseOrderReceipt     = PurchaseOrderReceipt
			Instance Selection
				where (related.SumOfQuantity = related.EnteredReceivedQuantity)

		HasMultipleLineSourcesRel is a PurchaseOrderReceiptLine set
			Instance Selection
				where (related.PurchaseOrderLine.PurchaseOrderLineSourceCount > 1)
    Sets

        Set11
            indexed
            Instance Selection
                where (HasReferenceNumber)
            Sort Order
                Company
                ReferenceNumber
                PurchaseOrderReceipt

        Set2
            indexed
            Sort Order
                Company
                Status
                ReceivedDate
                PurchaseOrderReceipt

        Set3
            indexed
            Sort Order
                Company
                PurchaseOrder
                PurchaseOrderLocation
                PurchaseOrderReceipt

        Set4
            indexed
            Instance Selection
                where (IsUnreleased)
            Sort Order
                Company
                ShipToLocation
                PurchaseOrderReceipt


        Set5
            indexed
            Sort Order
                Company
                PurchaseOrder
                BillOfLading
                OperatorID
                Buyer
                Carrier
                PurchaseOrderReceipt

        Set7
            indexed
            Instance Selection
                where (ERSPending)
            Sort Order
                Company
                Vendor
                PurchaseOrderReceipt

        Set8
            indexed
            Instance Selection
                where (HasInvoice)
            Sort Order
                Company
                Vendor
                Invoice

        Set9
            indexed
            Instance Selection
                where (IsOpen)
            Sort Order
                Company
                Vendor
                PurchaseOrder
                ShipToLocation
                PurchaseOrderReceipt

        Set1
            not indexed
            Sort Order
                Company
                PurchaseOrderReceipt descending

		ByReceivedDate
			not indexed
			Sort Order
				Company
				ReceivedDate
				PurchaseOrderReceipt

		ByPurchaseOrder
			not indexed
			Sort Order
				Company
				PurchaseOrder
				PurchaseOrderReceipt

		ByVendor
			not indexed
			Sort Order
				Vendor
				PurchaseOrderReceipt
				Company

		ByStatus
			not indexed
			Sort Order
				Status
				PurchaseOrderReceipt
				Company

        ByInterfaceRun
            Sort Order
            	OriginatingInterfaceRun
                Company
                PurchaseOrderReceipt

    Field Rules
		PORelease
			default to PurchaseOrder.PORelease
		
		POCode
			default to PurchaseOrder.POCode

		ReferenceNumber
			constraint (!DuplicateReferenceRel	exists)
				"ReferenceNumberUsedOnReceipt<first DuplicateReferenceRel.PurchaseOrderReceipt>"		

		PurchaseOrder
			required
			cannot be changed
				"CannotChangePurchaseOrder"
			if (PurchaseOrder.VendorReturn	entered)
				constraint (!PurchaseOrder.VendorReturn.Status.AuthorizedByVendor)
					"VendorReturn<PurchaseOrder.VendorReturn>HasNotBeenShipped"		
			
			if (PurchaseOrder.Closed.Yes)
				constraint (Company.ReopenPurchaseOrder and Company.ReopenPurchaseOrderLine)
					"CannotOpenAClosedPurchaseOrder"								
			if (PurchaseOrder.LineCount = PurchaseOrder.ClosedLineCount)
				constraint (Company.ReopenPurchaseOrderLine)
					"AllLinesAreClosed,CannotReopenClosedPurchaseOrderLines"
			constraint (!PurchaseOrder.Rejected)
				"CannotReceiveARejectedPurchaseOrder"//"PurchaseOrderIsRejected"		
			constraint (!PurchaseOrder.Canceled)
				"PurchaseOrderIsCancelled"											
			if  (!BypassDropshipEdit)
				constraint (!PurchaseOrder.Dropship)
					"CannotReceiveAgainstDropShipPurchaseOrders"						
			constraint (PurchaseOrder.ApprovalLevel	>= PurchaseOrder.AttainedLevel)
				"CannotReceiveAnUnapprovedPurchaseOrder"//"PurchaseOrderIsNotApproved" 	 
			constraint (!PurchaseOrder.ApprovalStatus.NeedsApproval)
				"CannotReceiveAnUnapprovedPurchaseOrder"							
			constraint (!PurchaseOrder.Closed.Historical)
				"ReceivingNotAllowed;PurchaseOrderIsHistorical"						
			constraint (NonServicePurchaseOrderLinesRel exists)
				"CannotReceivePurchaseOrderWithServiceItemOnly"
			if (PurchaseOrder.SubcontractorPurchaseOrder)
				constraint (PurchaseOrder.Approved)
					"CannotAddOrModifyReceiver;PurchaseOrderNeedsApproval"			
			constraint ((PurchaseOrder.Released and PurchaseOrder.PurchaseOrderLifeCycleState.Released)
			or 			 PurchaseOrder.Closed.Yes)
				"PurchaseOrderIsNotReleased"										

 		ShipToLocation
 			cannot be changed
 				"CannotUpdateOverrideLocationOnAChange" 							

		Buyer
			force default to PurchaseOrder.Buyer

		BillOfLading

			force default to TransientBillOfLading

		ReceivedDate
			default to current timestamp
			constraint (DerivedReceivedDate >= PurchaseOrder.PurchaseOrderDate)
				"ReceivedDateCannotPrecedePurchaseOrderDate"						
			constraint (DerivedReceivedDate <= current corporate date)
				"ReceivedDateCannotBeGreaterThanCurrentDate"						
				
			if (CompanySystemClosingControlForPORel exists 
			and CompanySystemClosingControlForPORel.Control)
				constraint (CompanySystemClosingControlForPORel.ValidEntryDate.Begin <= DerivedReceivedDate)
					"ReceivedDateIsBeforeClosingControlDate"
				constraint (CompanySystemClosingControlForPORel.ValidEntryDate.End >= DerivedReceivedDate)
					"ReceivedDateIsAfterClosingControlDate"

        Vendor
			initial value is PurchaseOrder.Vendor
			force default to PurchaseOrder.Vendor

		PurchaseFromLocation
			initial value is PurchaseOrder.PurchaseFromLocation
			default to PurchaseOrder.PurchaseFromLocation

		ERSStatus
			if (IsInvoiceMethodNotRequired
			or  ERSCapable)
				default to ERSStatus.InvoiceFromReceipt
			else
				default to ERSStatus.VendorToInvoice

		InvoiceReference
			if (ERSStatus.InvoiceFromReceipt)
    			default to PurchaseFromLocation.InvoiceReference
    			default to Vendor.InvoiceReference
			else
			if (ERSStatus.VendorToInvoice)
				cannot be entered
					"CannotEnterInvoiceDataFromNonERSVendor"

		Invoice
			if (ERSStatus.InvoiceFromReceipt)
				if (InvoiceReference.PONumber)
					default to PurchaseOrderReceiptString
				else
				if (InvoiceReference.BillOfLading)
					default to BillOfLading

				if (Invoice entered)
					constraint (not PayablesInvoiceRel exists)
						"Invoice<Invoice>ForVendor<Vendor>AlreadyExists"	

			else
			if (ERSStatus.VendorToInvoice)
				cannot be entered
					"CannotEnterInvoiceDataFromNonERSVendor"	

        PrintCode
            default to PrintCode.All

		Currency
			force default to PurchaseOrder.Currency

		CreatedBy
			default to actor

		OperatorID
			default to actor

		GlobalDocumentType
			initial value is PurchaseOrder.GlobalDocumentType
			force default to PurchaseOrder.GlobalDocumentType

		TermCode
			initial value is PurchaseOrder.TermCode
			force default to PurchaseOrder.TermCode

		ShipToArriveDate
			initial value is PurchaseOrder.ShipToArriveDate
			force default to PurchaseOrder.ShipToArriveDate

		PackageTrackingNumber
			if (Company.PackageTrackingLevel.HeaderLevel
			and OriginatingInterfaceRun = 0) 
				required
			else
			if (Company.PackageTrackingLevel.PackageTrackingNotUsed
			or  Company.PackageTrackingLevel.LineLevel)
				cannot be entered
					"CannotEnterTrackingNumber"

		PackageTrackingLabel
			if (Company.PackageTrackingLevel.HeaderLevel)
				if (Company.DefaultNumberOfLabelsTo1)
					default to 1
				else
				if (not LocalInvokedFromBatch)
					required
			else
				cannot be entered
					"CannotEnterLabels"

		ProcessLevel
			force default to PurchaseOrder.ProcessLevel

		MatchReferenceNumber
			if (Vendor.RequireMatchReference)
				required
					"VendorRequiresMatchReferenceNumber"

		IDMPrinter
			initial value is Company.UserDefaultPrinter
			default to Company.UserDefaultPrinter
			default to PurchaseOrder.IDMPrinter

	Rule Blocks

		CreateReceiptReleaseResult
			invoke Create PurchaseOrderResult
				assign result to SavedBatchReleaseResultView
				invoked.FinanceEnterpriseGroup										= PrmCompany.FinanceEnterpriseGroup
				invoked.ParametersReceiptBatchReleaseResult.Company 				= PrmCompany
				invoked.ParametersReceiptBatchReleaseResult.ReceivingLocationGroup	= PrmInventoryReportGroup
				invoked.ParametersReceiptBatchReleaseResult.ReceivingLocation		= PrmReceivingLocation
				invoked.ParametersReceiptBatchReleaseResult.CurrentUser				= PrmCurrentUser
				invoked.ReportType													= PurchaseOrderResult.ReportType.ReceiptBatchReleaseResult
				invoked.UserId														= actor
				invoked.PrintTimeStamp												= current timestamp
				invoked.Status														= PurchaseOrderResult.Status.Processing


		CreateArrivalRecord
			if(not IsMSCMEnabled)
				if (Company.PackageTrackingLevel.HeaderLevel
				or  Company.PackageTrackingLevel.EnableMscmRadTracking)
					invoke CreateArrival PurchaseOrderReceiptTrackingRel
				else
				if (Company.PackageTrackingLevel.LineLevel)
					invoke CreateLineLevelArrivalRecord PurchaseOrderReceiptLine set

		SetCurrency

			if (PurchaseOrder.ReceiptCurrencyConversionRate entered)
				LocalReceiptCurrencyConversionRate		= PurchaseOrder.ReceiptCurrencyConversionRate

			if (PurchaseOrder.CurrencyExchangeSetPoint.Receiving)
				initialize CurrencyExchange
				initialize LocalTransactionAmount													
				LocalFromCurrency						= Currency									
				CurrencyExchange.ToCurrency   			= Company.Currency
				LocalExchangeDate			 			= ReceivedDate								
				LocalCurrencyTable                      = PurchaseOrder.CurrencyTable
				LocalReceiptCurrencyConversionRate		= CurrencyExchange.CurrencySellRate
			else
				if (PurchaseOrder.CurrencyExchangeSetPoint.Invoicing)
					if (PurchaseOrder.ReceiptCurrencyConversionRate entered)
						LocalReceiptCurrencyConversionRate = ReceiptCurrencyConversionRate
					else
						LocalReceiptCurrencyConversionRate = PurchaseOrder.EnteredCurrencyConversionRate

			ReceiptCurrencyConversionRate = LocalReceiptCurrencyConversionRate




		InventoryTransactionValidations

			if (ICSystemClosingControlRel.Control)
				if (ICSystemClosingControlRel.ValidEntryDate entered)
					constraint (DerivedReceivedDate within ICSystemClosingControlRel.ValidEntryDate)
						"ReceivedDateNotWithinValidEntryDate"//"ReceivedDateNotWithinValidEntryDateForCompany<Company>Of<ICSystemClosingControlRel.ValidEntryDate.Begin>-<ICSystemClosingControlRel.ValidEntryDate.End>"
			

			initialize ValidReceivedDate
			initialize LoopCounter
			
			while (LoopCounter <= InventoryCompanyRel.NumberOfPeriods
			and    not ValidReceivedDate)
				LoopCounter += 1
				
				if (LoopCounter = 1) 	
					if (DerivedReceivedDate > InventoryCompanyRel.LastYearEndDate														
					and DerivedReceivedDate <= InventoryCompanyRel.YearPeriodStatusArray.YearPeriodStatus[LoopCounter].YearPeriod)		
						ValidReceivedDate = true
				else					
					if (DerivedReceivedDate > InventoryCompanyRel.YearPeriodStatusArray.YearPeriodStatus[LoopCounter - 1].YearPeriod	
					and DerivedReceivedDate <= InventoryCompanyRel.YearPeriodStatusArray.YearPeriodStatus[LoopCounter].YearPeriod)		
						ValidReceivedDate = true
				
				if (LoopCounter = InventoryCompanyRel.NumberOfPeriods) 
					FutureYearPerOne = InventoryCompanyRel.YearPeriodStatusArray.YearPeriodStatus[1].YearPeriod + 1 year		
					if (DerivedReceivedDate > InventoryCompanyRel.YearPeriodStatusArray.YearPeriodStatus[LoopCounter].YearPeriod)		
						constraint (FutureYearPerOne >= ReceivedDate)
							"ReceivedDateGreaterThanNextYearFirstPeriodEndDate<FutureYearPerOne>"
						ValidReceivedDate  		 = true

			constraint (ValidReceivedDate)
				"ReceivedDateNotWithinCurrentYearPeriods"
			
			constraint (InventoryCompanyRel.YearPeriodStatusArray.YearPeriodStatus[LoopCounter].Status.Open)
				"InventoryPeriodIsClosedForReceivedDate<ReceivedDate>"

		ValidateReceivedDate 
			constraint (DerivedReceivedDate >= PurchaseOrder.PurchaseOrderDate)
				"ReceivedDateCannotPrecedePurchaseOrderDate"						
			constraint (DerivedReceivedDate <= current corporate date)
				"ReceivedDateCannotBeGreaterThanCurrentDate"						
				
			if (CompanySystemClosingControlForPORel exists 
			and CompanySystemClosingControlForPORel.Control)
				constraint (CompanySystemClosingControlForPORel.ValidEntryDate.Begin <= DerivedReceivedDate)
					"ReceivedDateIsBeforeClosingControlDate"
				constraint (CompanySystemClosingControlForPORel.ValidEntryDate.End >= DerivedReceivedDate)
					"ReceivedDateIsAfterClosingControlDate"

			if (ReceiptLinesForInventoriedItemsRel exists)
				include InventoryTransactionValidations


		ReceiptInterfaceEdits
			if (ValidatePurchaseOrder)
				constraint (PurchaseOrder exists)
					"PurchaseOrderDoesNotExist"

				if (Vendor entered)
					constraint (Vendor = PurchaseOrder.Vendor)
						"VendorDoesNotMatchPurchaseOrderVendor"

				if (Currency entered)
					constraint (Currency = PurchaseOrder.Currency)
						"CurrencyDoesNotMatchPurchaseOrderCurrency"

			else
				constraint (TransientInterfaceStatus.Released)
					"RecordStatusMustBeReleasedWithValidatePurchaseOrderSetToFalse" 

			if (ERSStatus entered)
				if (ValidatePurchaseOrder)
					if (PurchaseOrder.InvoiceMethod.InvoiceNotRequired)
						constraint (not ERSStatus.VendorToInvoice)
							"ERSStatusCannotBeVendorToInvoiceForPurchaseOrderWithInvoiceMethodOfInvoiceNotRequired"  
				else
					if (ERSCapable)
						constraint (not ERSStatus.VendorToInvoice)
							"ERSStatusShouldNotBeVendorToInvoiceForERSVendorWithValidatePurchaseOrderSetToFalse"  
						if (not ERSStatus.InvoiceFromReceipt)
							ERSStatus = ERSStatus.InvoiceFromReceipt
					else
						constraint (ERSStatus.VendorToInvoice)
							"ERSStatusMustBeVendorToInvoiceForNonERSVendorWithValidatePurchaseOrderSetToFalse" 






		ReleaseLogic

			if (LocalUseBatchRelease)
				invoke BatchRelease PurchaseOrderReceiptLine	
					assign async action request id to LocalAsyncID
					invoked.PrmCompany					= Company
					invoked.PrmPurchaseOrderReceipt		= PurchaseOrderReceipt
					invoked.PrmCreateIntrastatDetail	= IntrastatProcessing.DoIntrastatReporting
					invoked.PrmIntrastatNumber			= first IntrastatHeaderRel.IntrastatHeader.IntrastatNumber
					invoked.PrmDestinationCountry		= ShipToLocation.PostalAddressForPurchaseOrder.Country
					invoked.PrmDestinationRegion		= ShipToLocation.PostalAddressForPurchaseOrder.Region
					invoked.PrmOriginCountry			= LocalOriginCountry
					invoked.PrmOriginRegion				= LocalOriginRegion

					invoked.PrmSkipNotification			= LocalSkipNotification
					invoked.PrmBatchReleaseResult		= LocalBatchReleaseResult

					if (ReceiptLinesPendingTwoStepReceivingRel exists)	
						invoked.PrmFinalRelease			= true
				if (IsCancelBackOrder)
					invoke CancelBackorderForUnreceivedLines PurchaseOrderLine
						run after LocalAsyncID
						assign async action request id to LocalAsyncID
						invoked.PrmCompany					= Company
						invoked.PrmPurchaseOrderReceipt		= PurchaseOrderReceipt


				if(IsMSCMEnabled)
					if(Company.PackageTrackingLevel.EnableMscmRadTracking)
						invoke ProcessPurchaseOrderReceiptTracking PurchaseOrderReceiptLine in background
							run after LocalAsyncID
							assign async action request id to LocalAsyncID
							invoked.PrmPurchasingCompany 		= Company
							invoked.PrmPurchaseOrderReceipt 	= PurchaseOrderReceipt














			else
				invoke BatchRelease PurchaseOrderReceiptLine in foreground
					invoked.PrmCompany					= Company
					invoked.PrmPurchaseOrderReceipt		= PurchaseOrderReceipt
					invoked.PrmCreateIntrastatDetail	= IntrastatProcessing.DoIntrastatReporting
					invoked.PrmIntrastatNumber			= first IntrastatHeaderRel.IntrastatHeader.IntrastatNumber
					invoked.PrmDestinationCountry		= ShipToLocation.PostalAddressForPurchaseOrder.Country
					invoked.PrmDestinationRegion		= ShipToLocation.PostalAddressForPurchaseOrder.Region
					invoked.PrmOriginCountry			= LocalOriginCountry
					invoked.PrmOriginRegion				= LocalOriginRegion

					invoked.PrmSkipNotification			= LocalSkipNotification
					invoked.PrmBatchReleaseResult		= LocalBatchReleaseResult

					if (ReceiptLinesPendingTwoStepReceivingRel exists)	
						invoked.PrmFinalRelease			= true

				include ArchivedClosedReceiptHeader
				if (WarehouseDemandRel exists and WarehouseDemandRel.HasNoLines)
					invoke Delete WarehouseDemandRel

				if (IsCancelBackOrder)
					invoke CancelBackorderForUnreceivedLines PurchaseOrderLine in foreground
						invoked.PrmCompany					= Company
						invoked.PrmPurchaseOrderReceipt		= PurchaseOrderReceipt


				if (IsMSCMEnabled)
					if (Company.PackageTrackingLevel.EnableMscmRadTracking)	
						invoke ProcessPurchaseOrderReceiptTracking PurchaseOrderReceiptLine in foreground
							invoked.PrmPurchasingCompany 		= Company
							invoked.PrmPurchaseOrderReceipt 	= PurchaseOrderReceipt

					
















		ArchivedClosedReceiptHeader
			if (not Status.Released 
			and not Status.ArchivedClosed
			and HasPendingTwoStepReceivingLines)
				Status = Status.ReleasedPendingTwoStepReceiving
				if (ShipToLocation.UseAsWarehouseLocation)
					PutawayStatus = PutawayStatus.ForReceivingPutaway
			else											
				if (NotReadyForArchiveReceiptLinesRel exists)
					Status = Status.Released
				else
					Status = Status.ArchivedClosed

		AddReceiveAllActionRules
			if (not Company.AllowMultipleUnreleasedReceipts)
				constraint (UnreleasedPurchaseOrderReceiptsRel not exists)
					"UnreleasedReceiptExistsForPurchaseOrder<PurchaseOrder>"
			if (!Company.AllowReceiveAll)
				confirmation required
					"CompanyDoesNotAllowAddReceiveAll;ContinueAddWithoutReceiving" 
				constraint (HasPOLinesToReceive)
					"PurchaseOrderHasNoLinesToReceive"



		AddReceiveAllExitRules
			if (Company.AllowReceiveAll)
				LocalPOLineCount = instance count of NonCatchWeightItemsToReceiveRel
				if (LocalPOLineCount entered)
					if (LocalPOLineCount > 50)
						make transition to CreateInProgress
						invoke CreateReceiveAll PurchaseOrderLine in background
							invoked.PrmCompany					= Company
							invoked.PrmPurchaseOrderReceipt		= PurchaseOrderReceipt
							invoked.PrmRunInBackground			= true
					else
						invoke CreateReceiveAll PurchaseOrderLine in foreground
							invoked.PrmCompany					= Company
							invoked.PrmPurchaseOrderReceipt		= PurchaseOrderReceipt

		TriggerPurchaseOrderReceiptRules
			trigger "PurchaseOrderReceiptService" PA service
				resume on error
				title is "EG:<GeneralLedgerCompanyRel.FinanceEnterpriseGroup>CO:<Company>POR:<PurchaseOrderReceipt>"
				Criteria
					GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					Company
					Company.GeneralLedgerCompany.AccountingEntity
				Variables
					PurchaseOrderReceipt
						variable name is PurchaseOrderreceipt
					include persistent fields from PurchaseOrderReceipt
					ActionCode
					POBlanketOrStandingAgreement
					bod id.VariationID
						variable name is BODVariationId
					LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
						variable name is CurrentTimeStamp
					Company
						variable name is LawsonCompany
					Company.GeneralLedgerCompany.AccountingEntity
						variable name is Accountingentity

		TriggerBRPurchaseOrderReceipt
			trigger "BRPurchaseOrderReceiptService" PA service
				resume on error
				title is "EG:<GeneralLedgerCompanyRel.FinanceEnterpriseGroup>CO:<Company>POR:<PurchaseOrderReceipt>"
				Criteria
					GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					Company
					Company.GeneralLedgerCompany.AccountingEntity
				Variables
					PurchaseOrderReceipt
						variable name is PurchaseOrderreceipt
					include persistent fields from PurchaseOrderReceipt 
					ActionCode
					bod id.VariationID
						variable name is BODVariationId
					LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
						variable name is CurrentTimeStamp
					Company
						variable name is LawsonCompany
					Company.GeneralLedgerCompany.AccountingEntity
						variable name is Accountingentity		

		ValidateLineDetails
			
			constraint (not POTransactionDetailsDifferentLotExpirationRel exists)
				"CannotEnterSameLotWithDifferentExpiryDate"
			
			constraint (not DetailsNotInBalancePOReceiptLinesRel exists)
				"Receipt<PurchaseOrderReceipt>_Line<first DetailsNotInBalancePOReceiptLinesRel.PurchaseOrderLine.LineNumber>_<first DetailsNotInBalancePOReceiptLinesRel.ReceivingDetailMessage>_<first DetailsNotInBalancePOReceiptLinesRel.QuantityNotEqual>;CannotRelease"

			constraint (not ReceivedAssetDetailsNotInBalanceRel exists)
				"Receipt<PurchaseOrderReceipt>Line<first ReceivedAssetDetailsNotInBalanceRel.PurchaseOrderLine.LineNumber>AssetDetailsReceivedMustMatchTotalReceivedQuantity"
		
			constraint (not CancelledAssetDetailsNotInBalanceRel exists)
				"Receipt<PurchaseOrderReceipt>Line<first CancelledAssetDetailsNotInBalanceRel.PurchaseOrderLine.LineNumber>AssetDetailsCancelledMustMatchTotalQuantity"
			
			if (IsCancelBackOrder or POReceiptLinesForBackorderRel exists)
				constraint (not ReceiptLinesFromOrderEntryRel exists)
					"Receipt<PurchaseOrderReceipt>_Line<first ReceiptLinesFromOrderEntryRel.PurchaseOrderLine.LineNumber>CreatedFrom_\Order_\Entry;CannotReleaseAndCancelBackorder"

				constraint (not ReceiptLinesWithUnmatchedInvoiceRel exists)
					"CannotCancelBackorder-UnmatchedInvoicesExistForPurchaseOrder<PurchaseOrder>"
				
				constraint (not ReceiptLinesNotEligibleToBeCancelledRel exists)
					"Receipt<PurchaseOrderReceipt>Line<first ReceiptLinesNotEligibleToBeCancelledRel.PurchaseOrderLine.LineNumber>IsNotReleased"

		CreateMobileSupplyChainDelivery
			if (IsMSCMEnabled 
			and Company.PackageTrackingLevel.EnableMscmRadTracking)
				if (LocalUseBatchRelease)
					invoke ProcessDelivery MobileSupplyChainPurchaseOrderReceiptTracking
						run after LocalAsyncID
						invoked.PrmPurchasingCompany    = Company
						invoked.PrmPurchaseOrderReceipt = PurchaseOrderReceipt
				else
					invoke ProcessDelivery MobileSupplyChainPurchaseOrderReceiptTracking in foreground
						invoked.PrmPurchasingCompany    = Company
						invoked.PrmPurchaseOrderReceipt = PurchaseOrderReceipt

	Actions

		FinalRelease is an Instance Action
			valid when (HasPendingTwoStepReceivingLines)

			Local Fields
				LocalOriginCountry 	is like Country 
				LocalOriginRegion 	is like Region	

			Entrance Rules
				if (not PutawayStatus.NotForPutaway)
					constraint (PutawayStatus.ConfirmedPutawayFeedback)
						"PutawayIsNot_Confirmed"

			Action Rules
				make transition to ReleaseInProgress
				
				include ReleaseLogic

		MobileReleaseFromWizard is an Instance Action	
			default label is "Release"
			Action Rules
				invoke Unreleased.Release

		PrintDeliveryTicketAndPutawayLPL is an Instance Action
			default label is "NEWPrintDeliveryTicketAndPutaway"
			valid when (IsValidForPrinting)
			Local Fields
				LocalRunBatchID is like IDMPID
			Action Rules
				LocalRunBatchID = current timestamp
				if (DerivedRowCount > 50)
					invoke ReceivingDeliveryAndPutaway
						assign async action request id to LocalAsyncID
						invoked.PrmCompany								= Company
						invoked.PrmPurchaseOrderReceipt					= PurchaseOrderReceipt
						invoked.PrmPrintBackorders						= true
						invoked.PrmPrintDeliveryTicketsAndPutaway		= true
						invoked.PrmInstanceRun							= true
						invoked.PrmRunBatchID							= LocalRunBatchID
					
					if (not Company.UseIDM)
						invoke SendNotificationOrEmail in background
							run after LocalAsyncID
							invoked.PrmCompany								= Company
							invoked.PrmPrintBackorders						= true
							invoked.PrmPrintDeliveryTicketsAndPutaway		= true						
				else
					invoke ReceivingDeliveryAndPutaway in foreground
						invoked.PrmCompany								= Company
						invoked.PrmPurchaseOrderReceipt					= PurchaseOrderReceipt
						invoked.PrmPrintBackorders						= true
						invoked.PrmPrintDeliveryTicketsAndPutaway		= true
						invoked.PrmInstanceRun							= true
						invoked.PrmRunBatchID							= LocalRunBatchID
					
					if (not Company.UseIDM)
						invoke SendNotificationOrEmail
							invoked.PrmCompany								= Company
							invoked.PrmPrintBackorders						= true
							invoked.PrmPrintDeliveryTicketsAndPutaway		= true

			Exit Rules
				include CreateArrivalRecord
				include CreateMobileSupplyChainDelivery
		
		PrintDeliveryTicketAndPutawayNoBackordersLPL is an Instance Action
			default label is "NEWPrintDeliveryTicketAndPutawayNoBackorders"
			valid when (IsValidForPrinting)
			Local Fields
				LocalRunBatchID is like IDMPID
			Action Rules
				LocalRunBatchID = current timestamp
				if (DerivedRowCount > 50)
					invoke ReceivingDeliveryAndPutaway
						assign async action request id to LocalAsyncID
						invoked.PrmCompany								= Company
						invoked.PrmPurchaseOrderReceipt					= PurchaseOrderReceipt
						invoked.PrmPrintBackorders						= false
						invoked.PrmPrintDeliveryTicketsAndPutaway		= true
						invoked.PrmInstanceRun							= true
						invoked.PrmRunBatchID							= LocalRunBatchID
					
					if (not Company.UseIDM)						
						invoke SendNotificationOrEmail in background
							run after LocalAsyncID
							invoked.PrmCompany								= Company
							invoked.PrmPrintBackorders						= false
							invoked.PrmPrintDeliveryTicketsAndPutaway		= true						
				else
					invoke ReceivingDeliveryAndPutaway in foreground
						invoked.PrmCompany								= Company
						invoked.PrmPurchaseOrderReceipt					= PurchaseOrderReceipt
						invoked.PrmPrintBackorders						= false
						invoked.PrmPrintDeliveryTicketsAndPutaway		= true
						invoked.PrmInstanceRun							= true
						invoked.PrmRunBatchID							= LocalRunBatchID
				
					if (not Company.UseIDM)
						invoke SendNotificationOrEmail
							invoked.PrmCompany								= Company
							invoked.PrmPrintBackorders						= false
							invoked.PrmPrintDeliveryTicketsAndPutaway		= true

			Exit Rules
				include CreateArrivalRecord
				include CreateMobileSupplyChainDelivery
				
		PrintDeliveryTicketAndPutaway is an Instance Action
			completion message is "DeliveryAndPutawayTicketPrintCompleted"
			valid when (IsValidForPrinting)
			Action Rules
				if (PrintPutawayAndDelivery)

					invoke ReceivingDeliveryAndPutaway ReceivingDeliveryAndPutaway
						invoked.PrlCompany					= Company
						invoked.FromLocation				= ShipToLocation
						invoked.Receipt						= PurchaseOrderReceipt
						invoked.IDMPrinter					= IDMPrinter
			Exit Rules
				include CreateArrivalRecord
				include CreateMobileSupplyChainDelivery

		PrintDeliveryTicketAndPutawayNoBackOrders is an Instance Action
			completion message is "DeliveryAndPutawayTicketNoBackOrdersPrintCompleted"
			valid when (IsValidForPrinting)
			Action Rules
				if (PrintPutawayAndDelivery)

					invoke ReceivingDeliveryAndPutaway ReceivingDeliveryAndPutaway
						invoked.PrlCompany					= Company
						invoked.FromLocation				= ShipToLocation
						invoked.Receipt						= PurchaseOrderReceipt
						invoked.BoPrintFl					= "N"
						invoked.IDMPrinter					= IDMPrinter
			Exit Rules
				include CreateArrivalRecord
				include CreateMobileSupplyChainDelivery

		Reprint is an Instance Action
			completion message is "DeliveryAndPutawayTicketReprintCompleted"
			valid when (IsValidForReprinting)
			Action Rules
				invoke ReceivingDeliveryAndPutaway ReceivingDeliveryAndPutaway
					invoked.PrlCompany					= Company
					invoked.FromLocation				= ShipToLocation
					invoked.Receipt						= PurchaseOrderReceipt
					invoked.ReprintFlag					= true
					invoked.IDMPrinter					= IDMPrinter


		BatchReleaseAndPrint is a Set Action
			restricted
			Parameters
				ReceivingLocationGroup				is an InventoryReportGroup
				Company								is a PurchasingCompany
				ReceivingLocation					is an InventoryLocation
				CurrentUser							is Boolean
				ReleaseReceivers					is Boolean
				PrintBackorders						is Boolean
				PrintDeliveryAndPutawayTickets		is Boolean
				UpdateArrivalForMSCMTracking		is Boolean
					default label is "UpdateArrivalForMSCMTracking"
				ReceivingDeliveryAndPutawayReportDistributionGroup 	is a ReportDistributionGroup
					default label is "ReceivingDeliveryAndPutawayReport"
				ReceivingDeliveryTicketsDistributionGroup			is a ReportDistributionGroup
					default label is "ReceivingDeliveryTicketsReport"
				PurchaseOrderPutawayReportDistributionGroup			is a ReportDistributionGroup
					default label is "PurchaseOrderPutawayReport"

			Local Fields
				BackgroundGroupAsyncId				is an AsyncActionRequest

			Action Rules
				Set Rules
					Entrance Rules

						if (ReleaseReceivers)
							invoke BatchRelease in background
								assign async background group id to BackgroundGroupAsyncId
								invoked.PrmInventoryReportGroup		= ReceivingLocationGroup
								invoked.PrmCompany					= Company
								invoked.PrmReceivingLocation		= ReceivingLocation
								invoked.PrmCurrentUser				= CurrentUser

						if (UpdateArrivalForMSCMTracking)
							invoke UpdateArrivalForMSCM in background
								run outside of action background group
								run after action background group BackgroundGroupAsyncId
								invoked.PrmInventoryReportGroup				= ReceivingLocationGroup
								invoked.PrmCompany							= Company
								invoked.PrmReceivingLocation				= ReceivingLocation
								invoked.PrmCurrentUser						= CurrentUser

						if (PrintBackorders or PrintDeliveryAndPutawayTickets)
							invoke ReceivingDeliveryAndPutaway in background
								run outside of action background group
								run after action background group BackgroundGroupAsyncId
								assign async background group id to BackgroundGroupAsyncId
								invoked.PrmInventoryReportGroup				= ReceivingLocationGroup
								invoked.PrmCompany							= Company
								invoked.PrmReceivingLocation				= ReceivingLocation
								invoked.PrmCurrentUser						= CurrentUser
								invoked.PrmPrintBackorders					= PrintBackorders
								invoked.PrmPrintDeliveryTicketsAndPutaway	= PrintDeliveryAndPutawayTickets

							invoke SendNotificationOrEmail in background
								run outside of action background group
								run after action background group BackgroundGroupAsyncId
								assign async background group id to BackgroundGroupAsyncId
								invoked.PrmCompany							= Company
								invoked.DeliveryAndPutawayGroup				= ReceivingDeliveryAndPutawayReportDistributionGroup
								invoked.DeliveryTicketGroup					= ReceivingDeliveryTicketsDistributionGroup
								invoked.PutawayReportGroup					= PurchaseOrderPutawayReportDistributionGroup
								invoked.PrmPrintBackorders					= PrintBackorders
								invoked.PrmPrintDeliveryTicketsAndPutaway	= PrintDeliveryAndPutawayTickets



		BatchRelease is a Set Action
			restricted
			Parameters
				PrmInventoryReportGroup					is like InventoryReportGroup
				PrmCompany								is a PurchasingCompany
				PrmReceivingLocation					is like InventoryLocation
				PrmCurrentUser							is Boolean
			Parameter Rules
				PrmInventoryReportGroup
					LocalInventoryReportGroup  	= PrmInventoryReportGroup
				PrmCompany
					LocalCompany			   	= PrmCompany
				PrmReceivingLocation
					LocalShipToLocation			= PrmReceivingLocation
			Local Fields
				SavedBatchReleaseResultView		is a PurchaseOrderResult view
				LocalTransactionErrorMessage	is Alpha 150
				LocalRecordsProcessed			is Numeric 9
				LocalRecordsReleased			is Numeric 9
				LocalRecordsWithError			is Numeric 9
				LocalSetAsyncID 				is an AsyncActionRequest
				LocalActor						is an Actor

			Instance Selection
				where (
				(not PrmCurrentUser or Buyer = actor.agent(Employee).Employee)						
				and (PrmCompany not entered or Company = PrmCompany)								
				and (PrmReceivingLocation not entered or ReceiptLinesForLocationRel exists) 		
				)

			Sort Order is Set4	

			Action Rules
				Empty Set Rules
					include CreateReceiptReleaseResult

					invoke SendCompletedNotification SavedBatchReleaseResultView.PurchaseOrderResult in background

				Set Rules
					Entrance Rules
						include CreateReceiptReleaseResult

						LocalActor 				= actor
						send notification
							to LocalActor
							description is "ReceiptBatchReleaseInitiated.ReceiptReleaseResultID:<SavedBatchReleaseResultView.PurchaseOrderResult>"
							priority is medium
							detail is "ReceiptBatchReleaseStarted.ASeparateNotificationWillBeSentOnceTheRunIsComplete."

					Exit Rules
						invoke SendCompletedNotification SavedBatchReleaseResultView.PurchaseOrderResult in background
							run after LocalSetAsyncID
							invoked.PrmRecordsProcessed 	= LocalRecordsProcessed

				Instance Rules

					if (PrmInventoryReportGroup entered)
						LocalCompany			   	= PrmCompany
						LocalInventoryReportGroup  	= PrmInventoryReportGroup
						for each InventoryReportGroupLocationsRel
							LocalInventoryReportGroupLocation = each.InventoryLocation
							if (ReceiptLinesWithinLocationGroupRel exists)
								LocalReceiptLineForLocationFound = true
								end for each

					if (PrmInventoryReportGroup not entered or LocalReceiptLineForLocationFound)

						initialize LocalTransactionErrorMessage
						initialize LocalHeaderErrorReceived


						LocalBatchReleaseResult					= SavedBatchReleaseResultView.PurchaseOrderResult


						LocalSkipNotification					= true


						invoke Unreleased.Release PurchaseOrderReceipt
							resume on error
								LocalTransactionErrorMessage 	= error message
								LocalHeaderErrorReceived		= true



						if (LocalAsyncID entered)
							LocalSetAsyncID 					= LocalAsyncID

						LocalRecordsProcessed += 1
						if (LocalHeaderErrorReceived)
							invoke Create PurchaseOrderResultDetail
								invoked.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
								invoked.PurchasingCompany		= Company
								invoked.PurchaseOrderResult		= LocalBatchReleaseResult
								invoked.PurchaseOrderReceipt	= PurchaseOrderReceipt
								invoked.PurchaseOrder			= PurchaseOrder
								invoked.ErrorMessage			= LocalTransactionErrorMessage

		ReceivingDeliveryAndPutaway is a Set Action
			restricted
			Parameters
				PrmInventoryReportGroup				is like InventoryReportGroup
				PrmCompany							is a PurchasingCompany
				PrmReceivingLocation				is like InventoryLocation
				PrmPurchaseOrderReceipt				is like PurchaseOrderReceipt
				PrmCurrentUser						is Boolean
				PrmPrintBackorders					is Boolean
				PrmPrintDeliveryTicketsAndPutaway	is Boolean
				PrmInstanceRun						is Boolean
				PrmRunBatchID						is like IDMPID
				
			Parameter Rules
				PrmInventoryReportGroup
					LocalInventoryReportGroup  	= PrmInventoryReportGroup
				PrmCompany
					LocalCompany			   	= PrmCompany
				PrmReceivingLocation
					LocalShipToLocation			= PrmReceivingLocation

			Local Fields
				SavedDeliveryAndBackorderDocumentReport		is a PurchaseOrderResult view
				SavedPutawayDocumentReport					is a PurchaseOrderResult view
				LocalActor									is an Actor
				LocalIDMPrinter								is an IDMPrinter
			Instance Selection
				where (
				    (not PrmCurrentUser or Buyer = actor.agent(Employee).Employee)			
				and (Company = PrmCompany)													
				and (PrmReceivingLocation not entered or ReceiptLinesForLocationRel exists) 
				and (PrmPurchaseOrderReceipt not entered or PurchaseOrderReceipt = PrmPurchaseOrderReceipt)
				and (Status.Released or Status.ReleasedPendingTwoStepReceiving)				
				and (not IsPrinted or (PrmPrintBackorders and ReceiptLinesWithBackorderRel exists))	
				and (PrintPutawayAndDelivery)
				and (not Company.UseIDM or (Company.UseIDM and PrmInstanceRun)))

			Action Rules
				Set Rules
					Entrance Rules
						LocalCompany = PrmCompany
						if (not PurchasingCompanyForIDMRel.UseIDM)
							if (PrmPrintDeliveryTicketsAndPutaway)

								invoke Create PurchaseOrderResult
									assign result to SavedDeliveryAndBackorderDocumentReport
									invoked.FinanceEnterpriseGroup												= PrmCompany.FinanceEnterpriseGroup
									invoked.ParametersPrintDeliveryAndPutaway.Company 							= PrmCompany
									invoked.ParametersPrintDeliveryAndPutaway.ReceivingLocationGroup			= PrmInventoryReportGroup
									invoked.ParametersPrintDeliveryAndPutaway.ReceivingLocation					= PrmReceivingLocation
									invoked.ParametersPrintDeliveryAndPutaway.PrintDeliveryTicketAndPutaway		= PrmPrintDeliveryTicketsAndPutaway
									invoked.ParametersPrintDeliveryAndPutaway.PrintBackorders					= PrmPrintBackorders
									invoked.ParametersPrintDeliveryAndPutaway.CurrentUser						= PrmCurrentUser
									invoked.ReportType							= PurchaseOrderResult.ReportType.DeliveryTicketAndBackorderReport
									invoked.Status								= PurchaseOrderResult.Status.Processing
									invoked.UserId								= actor
									invoked.PrintTimeStamp						= current timestamp
	

								invoke Create PurchaseOrderResult
									assign result to SavedPutawayDocumentReport
									invoked.FinanceEnterpriseGroup												= PrmCompany.FinanceEnterpriseGroup
									invoked.ParametersPrintDeliveryAndPutaway.Company 							= PrmCompany
									invoked.ParametersPrintDeliveryAndPutaway.ReceivingLocationGroup			= PrmInventoryReportGroup
									invoked.ParametersPrintDeliveryAndPutaway.ReceivingLocation					= PrmReceivingLocation
									invoked.ParametersPrintDeliveryAndPutaway.PrintDeliveryTicketAndPutaway		= PrmPrintDeliveryTicketsAndPutaway
									invoked.ParametersPrintDeliveryAndPutaway.PrintBackorders					= PrmPrintBackorders
									invoked.ParametersPrintDeliveryAndPutaway.CurrentUser						= PrmCurrentUser
									invoked.ReportType							= PurchaseOrderResult.ReportType.PurchaseOrderPutawayReport
									invoked.Status								= PurchaseOrderResult.Status.Processing
									invoked.UserId								= actor
									invoked.PrintTimeStamp						= current timestamp
	
		                    if (PrmPrintBackorders)
		                    	if (not PrmPrintDeliveryTicketsAndPutaway)

		                    		invoke Create PurchaseOrderResult
										assign result to SavedDeliveryAndBackorderDocumentReport
										invoked.FinanceEnterpriseGroup												= PrmCompany.FinanceEnterpriseGroup
										invoked.ParametersPrintDeliveryAndPutaway.Company 							= PrmCompany
										invoked.ParametersPrintDeliveryAndPutaway.ReceivingLocationGroup			= PrmInventoryReportGroup
										invoked.ParametersPrintDeliveryAndPutaway.ReceivingLocation					= PrmReceivingLocation
										invoked.ParametersPrintDeliveryAndPutaway.PrintDeliveryTicketAndPutaway		= PrmPrintDeliveryTicketsAndPutaway
										invoked.ParametersPrintDeliveryAndPutaway.PrintBackorders					= PrmPrintBackorders
										invoked.ParametersPrintDeliveryAndPutaway.CurrentUser						= PrmCurrentUser
										invoked.ReportType							= PurchaseOrderResult.ReportType.DeliveryTicketAndBackorderReport
										invoked.Status								= PurchaseOrderResult.Status.Processing
										invoked.UserId								= actor
										invoked.PrintTimeStamp						= current timestamp

	                Exit Rules
	                	if (PurchasingCompanyForIDMRel.UseIDM)
							invoke CreateAndSendReceivingDeliveryAndPutAway PurchasingCompanyForIDMRel
								assign async action request id to LocalAsyncID					
								invoked.PrmRunBatchID = PrmRunBatchID
								invoked.PrmIDMPrinter = LocalIDMPrinter

							invoke DeleteIDMWorkFiles PurchasingCompanyForIDMRel in background
								run after LocalAsyncID
								invoked.PrmRunBatchID = PrmRunBatchID
								invoked.PrmCompany	  = LocalCompany
								
						else
							if (PrmPrintDeliveryTicketsAndPutaway)
								invoke TransitionToCompleted SavedDeliveryAndBackorderDocumentReport.PurchaseOrderResult
								invoke TransitionToCompleted SavedPutawayDocumentReport.PurchaseOrderResult
							else
								if (PrmPrintBackorders)
									invoke TransitionToCompleted SavedDeliveryAndBackorderDocumentReport.PurchaseOrderResult

				Instance Rules
					if (Company.UseIDM)
						LocalIDMPrinter = IDMPrinter

					if (PrmInventoryReportGroup entered)
						LocalCompany			   	= PrmCompany
						LocalInventoryReportGroup  	= PrmInventoryReportGroup
						for each InventoryReportGroupLocationsRel
							LocalInventoryReportGroupLocation = each.InventoryLocation
							if (ReceiptLinesWithinLocationGroupRel exists)
								LocalReceiptLineForLocationFound = true
								end for each

					if (PrmInventoryReportGroup not entered or LocalReceiptLineForLocationFound)
						LocalDeliveryAndBackorderDocumentReport					= SavedDeliveryAndBackorderDocumentReport.PurchaseOrderResult
						LocalPutawayDocumentReport 								= SavedPutawayDocumentReport.PurchaseOrderResult

						if (PrmPrintDeliveryTicketsAndPutaway and not IsPrinted)

	                        for each NonInventoriedReceiptLinesRel
	                            invoke CreateDeliveryTicketDocuments each
	                            	if (Company.UseIDM)
	                                	invoked.PrmRunBatchID = PrmRunBatchID
	                                else
										invoked.PrmDeliveryAndBackorderDocumentReport  	= LocalDeliveryAndBackorderDocumentReport
										

							for each InventoriedReceiptLineForPutawayRel		
								invoke CreatePutawayDocuments each
									if (Company.UseIDM)
	                                	invoked.PrmRunBatchID = PrmRunBatchID
	                                else
										invoked.PrmPutawayDocumentReport				= LocalPutawayDocumentReport

	                    if (PrmPrintBackorders)

	                        for each PurchaseOrderReceiptLinesForBackorderRel
	                            invoke CreateBackOrderDocuments each
	                            	if (Company.UseIDM)
	                                	invoked.PrmRunBatchID = PrmRunBatchID
	                                else
	                            		invoked.PrmDeliveryAndBackorderDocumentReport	= LocalDeliveryAndBackorderDocumentReport

						if  (PrmPrintDeliveryTicketsAndPutaway and not IsPrinted
						and (NonInventoriedReceiptLinesRel exists or InventoriedReceiptLineForPutawayRel exists))
							invoke DeliveryUpdate

		DeliveryUpdate is an Instance Action
			restricted
			Action Rules

				for each ReceiptLinesPendingDeliveryRel
					invoke LineDeliveryUpdate each

		CreateSupplierMessageAndDialog is an Instance Action  
			valid when (ForSupplier)
			Parameters
				ParmDialogMessage       is Alpha size 1000
					default label is "Message"
				ParmDialogAttachment	is an Attachment
					default label is "Attachment"	
				ParmPriority            is Numeric 1
					States
						Low				value is 1
						Normal			value is 2
						High			value is 3					
					default label is "Priority"
				ParmResponseRequested   is Boolean
					default label is "ResponseRequired"
				
			Parameter Rules
				ParmDialogMessage
					required
					
				ParmPriority
					initial value is 2
						
			Local Fields
				LocalSupplierContactMessage        is a SupplierContactMessage view
			
			Action Rules	
					
				invoke Create SupplierContactMessage
					assign result to LocalSupplierContactMessage
					invoked.SupplierGroup  					= actor.agent(SupplierSourceId).SupplierGroup
 					invoked.Supplier    			 		= actor.agent(SupplierSourceId).Supplier
					invoked.SupplierSourceId                = actor.agent(SupplierSourceId).SupplierSourceId
					invoked.MessageTitle					= "Dialog for Receipt for Purchase Order: " + PurchaseOrder
					invoked.MessageText                     = "User Created Message and Dialog for Receipt for Purchase Order " + PurchaseOrder
					invoked.Status							= 1
					invoked.Priority						= ParmPriority
					invoked.ReleaseStatus					= 2
					invoked.MessageOwner                    = Buyer
					invoked.OriginatingCompany              = Company
					invoked.OriginatingPO                   = PurchaseOrder
					invoked.OriginatingReceipt              = PurchaseOrderReceipt
					
				invoke Create SupplierMessageDialog
					invoked.SupplierGroup  					= actor.agent(SupplierSourceId).SupplierGroup
 					invoked.Supplier    			 		= actor.agent(SupplierSourceId).Supplier
					invoked.SupplierSourceId                = actor.agent(SupplierSourceId).SupplierSourceId
					invoked.SupplierContactMessage 			= LocalSupplierContactMessage.SupplierContactMessage
					invoked.Message                 		= ParmDialogMessage
					invoked.MessageAttachment       		= ParmDialogAttachment
					invoked.ResponseRequested       		= ParmResponseRequested						

		CreateMessageAndDialog is an Instance Action  
			default label is "StartASupplierDialog"
			valid when (BuyerCanCreateDialog)
			Parameters
				ParmSupplierGroup       is a SupplierGroup
				ParmSupplier            is a Supplier
					default label is "Supplier"
				ParmSupplierContact     is a SupplierSourceId
					default label is "SupplierContact"
				ParmDialogMessage       is Alpha size 1000
					default label is "Message"
				ParmDialogAttachment	is an Attachment
					default label is "Attachment"
				ParmPriority            is Numeric 1
					States
						Low				value is 1
						Normal			value is 2
						High			value is 3
					default label is "Priority"
				ParmResponseRequested   is Boolean
					default label is "ResponseRequired"

			Parameter Rules
				
				ParmSupplierGroup
					initial value is SupplierGroupRel.SupplierGroup
					
				ParmSupplier
					if (Vendor.SingleSupplier)
						default to Vendor.first SupplierRel.Supplier
				
				ParmSupplierContact
					if (Vendor.SingleSupplier
					and DerivedSupplierSourceId entered)
						default to DerivedSupplierSourceId
					else
					if (Vendor.SingleSupplierAndContact)
						default to Vendor.SupplierRel.PrimaryContact.SupplierSourceId
				
				ParmDialogMessage
					required

				ParmPriority
					initial value is 2

			Local Fields
				LocalSupplierContactMessage        is a SupplierContactMessage view

			Action Rules

				if (!Vendor.SingleSupplier)
					constraint (ParmSupplier entered)
						"MustEnterASupplier"

				if (!Vendor.SingleSupplierAndContact)
					constraint (ParmSupplierContact entered)
						"MustEnterASupplierContact"		

				constraint (ParmSupplier.Vendor = Vendor)
					"SupplierNotValidForVendor"
				
				if (ParmSupplier entered)
					LocalSupplier        = ParmSupplier
				else
					LocalSupplier 		 = Vendor.SupplierRel.Supplier
				LocalSupplierContact = ParmSupplierContact					
				
				constraint (SupplierSourceIdValidRel exists)
					"SupplierContactNotValidForSupplier"
				
				constraint (SupplierContactHasReceiptAccess)
					"SupplierContactDoesNotHaveAccessToReceipts"
				
				invoke Create SupplierContactMessage
					assign result to LocalSupplierContactMessage
					assign result to LocalSupplierContactMessage
					invoked.SupplierGroup  					= ParmSupplierGroup					
 					invoked.Supplier    			 		= ParmSupplier
					invoked.SupplierSourceId                = ParmSupplierContact 
					invoked.MessageTitle					= "Dialog for Purchase Order Receipt For Purchase Order: " + PurchaseOrder.DerivedPurchaseOrder
					invoked.MessageText                     = "User Created Message and Dialog for Purchase Order Receipt For Purchase Order: " + PurchaseOrder.DerivedPurchaseOrder
					invoked.Status							= 1
					invoked.Priority						= ParmPriority
					invoked.ReleaseStatus					= 2
					invoked.MessageOwner                    = actor.agent(Employee).Employee
					invoked.OriginatingCompany              = Company
					invoked.OriginatingPO                   = PurchaseOrder
					invoked.OriginatingReceipt              = PurchaseOrderReceipt

				invoke Create SupplierMessageDialog
					assign result to LocalSupplierContactMessage
					invoked.SupplierGroup  					= ParmSupplierGroup					
 					invoked.Supplier    			 		= ParmSupplier
					invoked.SupplierSourceId                = ParmSupplierContact 
					invoked.SupplierContactMessage 			= LocalSupplierContactMessage.SupplierContactMessage
					invoked.Message                 		= ParmDialogMessage
					invoked.MessageAttachment       		= ParmDialogAttachment
					invoked.ResponseRequested       		= ParmResponseRequested
					invoked.Origin                          = 1

		SendNotificationOrEmail is an Instance Action
			restricted
		    run in background
		    Parameters
		    	PrmCompany						is a PurchasingCompany
		        DeliveryAndPutawayGroup			is a ReportDistributionGroup
		        DeliveryTicketGroup				is a ReportDistributionGroup
		        PutawayReportGroup				is a ReportDistributionGroup
		        ReportName 						is Alpha size 80
		        PrmPrintDeliveryTicketsAndPutaway	is Boolean
		        PrmPrintBackorders					is Boolean

		    Action Rules
		    	LocalReportCompany 					= PrmCompany
		    	LocalReportFinanceEnterpriseGroup	= PrmCompany.FinanceEnterpriseGroup
				LocalActor    = actor
                if (PrmPrintDeliveryTicketsAndPutaway)
                	if (DeliveryAndPutawayGroup entered)
              			invoke DistributeBinaryDocument DeliveryAndPutawayGroup
				            invoked.Report 					= DeliveryAndBackOrderDocumentReportNav as pdf
				            invoked.ReportName 				= "DeliveryTicketsAndPutawayReport"
				            invoked.ReportDistributionGroup = DeliveryAndPutawayGroup

						invoke DistributeBinaryDocument PutawayReportGroup
					            invoked.Report 					= PutawayDocumentReportNav as pdf
					            invoked.ReportName 				= "PurchaseOrderPutawayReport"
					            invoked.ReportDistributionGroup = PutawayReportGroup
				    else
			    		if (DeliveryTicketGroup entered)
							invoke DistributeBinaryDocument DeliveryTicketGroup
					            invoked.Report 					= DeliveryAndBackOrderDocumentReportNav as pdf
					            invoked.ReportName 				= "DeliveryTickets"
					            invoked.ReportDistributionGroup = DeliveryTicketGroup
						else
							invoke SendDeliveryAndBackorderNotification last DeliveryAndBackOrderReportRel.PurchaseOrderResult in background


						if (PutawayReportGroup entered)
							invoke DistributeBinaryDocument PutawayReportGroup
					            invoked.Report 					= PutawayDocumentReportNav as pdf
					            invoked.ReportName 				= "PurchaseOrderPutawayReport"
					            invoked.ReportDistributionGroup = PutawayReportGroup
						else

							invoke SendPutawayNotification last PutawayDocumentReportRel.PurchaseOrderResult in background
                else
				if (PrmPrintBackorders)
					if (DeliveryAndPutawayGroup entered)
				        invoke DistributeBinaryDocument DeliveryAndPutawayGroup
				            invoked.Report 					= DeliveryAndBackOrderDocumentReportNav as pdf
				            invoked.ReportName 				= "DeliveryTicketsAndPutawayReport"
				            invoked.ReportDistributionGroup = DeliveryAndPutawayGroup
				    else
				    	invoke SendDeliveryAndBackorderNotification last DeliveryAndBackOrderReportRel.PurchaseOrderResult in background

		UpdateArrivalForMSCM is a Set Action
			restricted
			Parameters
				PrmInventoryReportGroup				is like InventoryReportGroup
				PrmCompany							is a PurchasingCompany
				PrmReceivingLocation				is like InventoryLocation
				PrmCurrentUser						is Boolean
			Parameter Rules
				PrmInventoryReportGroup
					LocalInventoryReportGroup  	= PrmInventoryReportGroup
				PrmCompany
					LocalCompany			   	= PrmCompany
				PrmReceivingLocation
					LocalShipToLocation			= PrmReceivingLocation
			Instance Selection
				where (
				    (not PrmCurrentUser or Buyer = actor.agent(Employee).Employee)			
				and (Company = PrmCompany)													
				and (PrmReceivingLocation not entered or ReceiptLinesForLocationRel exists) 
				and (Status.Released)														
				and (not IsPrinted)															
				and (PrintPutawayAndDelivery)														
				)

			Action Rules
				Instance Rules

					if (PrmInventoryReportGroup entered)
						LocalCompany			   	= PrmCompany
						LocalInventoryReportGroup  	= PrmInventoryReportGroup
						for each InventoryReportGroupLocationsRel
							LocalInventoryReportGroupLocation = each.InventoryLocation
							if (ReceiptLinesWithinLocationGroupRel exists)
								LocalReceiptLineForLocationFound = true
								end for each

					if (PrmInventoryReportGroup not entered or LocalReceiptLineForLocationFound)

						include CreateArrivalRecord

		CreateFromBatch is a Create Action
			restricted

		UpdateFromPurchaseOrder is an Instance Action
			restricted
			Action Rules
				Vendor			= PurchaseOrder.Vendor
		        LastUpdateDate	= current timestamp
		        LastUpdateBy	= actor
				invoke UpdateReceiptLinesFromReceipt PurchaseOrderReceiptLine set
			        invoked.PrmVendor	= PurchaseOrder.Vendor


		UpdateReceiptAmountFromPORAdjInsp is an Instance Action
			restricted
			Parameters
				PrmReceiptAmount	is an InternationalAmount
				PrmHashQuantity		is Decimal size 15.4
				PrmStatus			is Numeric size 1 
			Parameter Rules
				PrmStatus
					default to Status
			Action Rules
				ReceiptAmount   = PrmReceiptAmount
				HashQuantity    = PrmHashQuantity
				Status		    = PrmStatus
		        LastUpdateDate	= current timestamp
		        LastUpdateBy	= actor

		UpdateFromReceiptLine is an Instance Action
			restricted
			Parameters
				PrmReceiptAmount 		is like InternationalAmount
				PrmHashQuantity     	is Decimal size 15.4
				PrmMatchedAmount		is like InternationalAmount
				PrmHashQuantityMatched	is like Quantity
				PrmStatus         		is Numeric size 1
				PrmReleasing			is Boolean
				PrmArchiving			is Boolean
			Action Rules
				if (PrmReleasing)
					ReceiptAmount   	+= PrmReceiptAmount
					HashQuantity    	+= PrmHashQuantity
					if (not PurchaseOrderMatch)
						MatchedAmount		+= PrmMatchedAmount
						HashQuantityMatched += PrmHashQuantityMatched
				else
					if (PrmArchiving)
						Status			= PrmStatus
						initialize ReceiptAmount
						initialize HashQuantity

		UpdateStatus is an Instance Action
			restricted
			Parameters
				PrmStatus     is Numeric size 1
			Action Rules
		        Status              = PrmStatus
		        LastUpdateDate		= current timestamp
		        LastUpdateBy		= actor


















		UpdateFromMatch is an Update Action
			restricted
			refresh and lock this instance
			bypass field rules
			Action Rules
				include ArchivedClosedReceiptHeader

		UpdateHeaderAmountsFromAddOnCharge is an Instance Action
			restricted
			Parameters
				PrmTotalAddOnChargeAmount						is an InternationalAmount
				PrmTrackType									is a TrackType
			Action Rules
				if (PrmTotalAddOnChargeAmount entered)
					if (PrmTrackType.Freight)
						FreightTotal 			+= PrmTotalAddOnChargeAmount
					else
					if (PrmTrackType.Insurance)
						InsuranceTotal 			+= PrmTotalAddOnChargeAmount
					else
					if (PrmTrackType.CustomsCharges)
						CustomsTotal 			+= PrmTotalAddOnChargeAmount
					else
						OtherAddOnChargesTotal 	+= PrmTotalAddOnChargeAmount

		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmAccountingEntity  is Alpha size 22
					default label is "AccountingEntity"
				PrmLocation          is Alpha size 22
					default label is "Location"
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmRevision          is Alpha size 22
					default label is "Revision"
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"
				PrmVariationID       is Alpha size 22
					default label is "VariationID"
			Action Rules
				if (bod id.AccountingEntity != PrmAccountingEntity)
					bod id.AccountingEntity 	= PrmAccountingEntity
				if (bod id.Location != PrmLocation)
					bod id.Location				= PrmLocation
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.Revision != PrmRevision)
					bod id.Revision				= PrmRevision
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord
				if (bod id.VariationID != PrmVariationID)
					bod id.VariationID			= PrmVariationID

		UpdateHeaderToArchivedClose is an Instance Action	
			restricted										
			Action Rules
				include ArchivedClosedReceiptHeader

		BODDataInitialLoadPurchaseOrderReceiptCriteria is a Set Action
			restricted
			Parameters
				PrmFromCompany					is a PurchasingCompany
				PrmToCompany					is a PurchasingCompany
				PrmFromPurchaseOrderReceipt		is a PurchaseOrderReceipt
					context of PrmFromCompany
				PrmToPurchaseOrderReceipt		is a PurchaseOrderReceipt
					context of PrmFromCompany
				PrmDateRange					is a DateRange

			Parameter Rules
			Instance Selection
				where  (((PrmFromCompany entered
				and		  PrmFromCompany <= Company)
				or		  PrmFromCompany not entered)
				and    ((PrmToCompany entered
				and		  PrmToCompany >= Company)
				or		  PrmToCompany not entered)
				and    ((PrmFromPurchaseOrderReceipt entered
				and		 PrmFromPurchaseOrderReceipt <= PurchaseOrderReceipt)
				or		 PrmFromPurchaseOrderReceipt not entered)
				and    ((PrmToPurchaseOrderReceipt entered
				and		 PrmToPurchaseOrderReceipt >= PurchaseOrderReceipt)
				or		 PrmToPurchaseOrderReceipt not entered)
				and	 	(ReceivedDate date within PrmDateRange
				or	     PrmDateRange not entered)
				and     (Status.Released
				or       Status.ArchivedClosed))

			Sort Order
			Action Rules

				Instance Rules
					if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger)
						ActionCode	= ActionCode.Create
						increment bod id.VariationID
						LocalBODCurrentTimeStamp.CurrentTimeStamp = current timestamp
						include TriggerPurchaseOrderReceiptRules
						include TriggerBRPurchaseOrderReceipt

















		TriggerOrderToInvoiceLPLBOD is an Instance Action
			default label is untranslatable
			restricted
			Action Rules
				if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger)
					if (!action type.Delete)
						if (action != "UpdateBODIdFields") 
							ActionCode = ActionCode.Update
						if (action type.Create)
							ActionCode = ActionCode.Create
					increment bod id.VariationID
					LocalTitle = "EG:"+GeneralLedgerCompanyRel.FinanceEnterpriseGroup+" CO:"+Company+" PO:"+PurchaseOrder
					trigger "BROrderInventoryTransactionService" PA service
						resume on error
						title is "<LocalTitle>"
						Criteria
							GeneralLedgerCompanyRel.FinanceEnterpriseGroup
							Company
						Variables
							ActionCode
							include persistent fields from PurchaseOrder
							include persistent fields from PurchaseOrder.NonServicePurchaseOrderLinesRel
							include persistent fields from PurchaseOrderReceiptLineAOCRel
							GeneralLedgerCompanyRel.FinanceEnterpriseGroup
								variable name is FinanceEnterpriseGroup	
							Company.GeneralLedgerCompany.AccountingEntity
								variable name is Accountingentity
							bod id.VariationID
								variable name is VariationId
							LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
								variable name is CurrentTimeStamp
		

		
		TriggerSyncReceiveDeliveryNativeLPLBOD is an Instance Action
			restricted
			Parameters
				RestartFlag 				is Boolean
				PrmFSMInboundBODTracker		is Numeric 15
			Action Rules
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "ReceiveDelivery"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "PurchaseOrderReceipt"
					invoked.PrmFinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					invoked.PrmCompany					= Company
					invoked.PrmAccountingEntity			= Company.GeneralLedgerCompany.AccountingEntity
					invoked.PrmMainUserTemplate 		= "IONSyncReceiveDelivery_PurchaseOrderReceipt_ST"
				LocalNativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger
				if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
					invoke TriggerSyncReceiveDeliveryNativeLPL
						invoked.RestartFlag							= RestartFlag
						invoked.PrmFSMInboundBODTracker				= PrmFSMInboundBODTracker
		
		TriggerSyncReceiveDeliveryNativeLPL is an Instance Action
			restricted

			Parameters
				RestartFlag 				is Boolean
				PrmFSMInboundBODTracker		is Numeric 15
			Action Rules
				if(RestartFlag)
					LocalFSMInboundBODTracker	= PrmFSMInboundBODTracker
				if(LocalFSMInboundBODTracker not entered)						
					invoke Create FSMInboundBODTracker
						assign result to NewBODTracker
						invoked.Verb 					= 1
						invoked.Noun 					= "ReceiveDelivery"					
						invoked.BODDocumentID			= DerivedDocumentID
						invoked.BODVariationID			= DerivedBODVariationID
						invoked.Status					= 1
						invoked.StartDate				= system current timestamp
						invoked.FinanceEnterpriseGroup	= DerivedFSMGroup
						invoked.Direction				= 1
						invoked.Reference1				= DerivedCompany
						invoked.BODAccountingEntity		= DerivedAccountingEntity
						invoked.Reference2 			= PurchaseOrderReceipt
						initialize invoked.Error			
						initialize invoked.ErrorMessage					
					LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
				else 
					invoke Update FSMInboundBODTrackerRel
						invoked.FinanceEnterpriseGroup	= DerivedFSMGroup
						invoked.BODDocumentID			= DerivedDocumentID
						invoked.BODVariationID			= DerivedBODVariationID
						invoked.Status					= 1
						invoked.StartDate				= system current timestamp
						invoked.Direction				= 1
						invoked.Reference1				= DerivedCompany
						invoked.BODAccountingEntity		= DerivedAccountingEntity
						invoked.Reference2				= PurchaseOrderReceipt
						initialize invoked.Error			
						initialize invoked.ErrorMessage
				invoke SendSyncReceiveDeliveryNativeLPLBOD
					resume on error
                   		Error            							= true
                        ErrorMessage     							= error message
                if(Error)
					invoke Update FSMInboundBODTrackerRel
						invoked.Error 								= Error
						invoked.ErrorMessage 						= ErrorMessage
						invoked.Status								= 2
						invoked.CloseDate							= system current timestamp
						invoked.BODID								= DerivedBODID
						invoked.BODXML								= SyncReceiveDeliveryXMLBOD
				else
					invoke Update FSMInboundBODTrackerRel
						invoked.Status									= 3
						invoked.CloseDate								= system current timestamp
						invoked.BODID									= DerivedBODID
						invoked.BODXML									= SyncReceiveDeliveryXMLBOD
					
	

		SendSyncReceiveDeliveryNativeLPLBOD is an Instance Action
			restricted
			Action Rules
				send ion bod
					bod is SyncReceiveDeliveryXMLBOD
					bod type is "Sync.ReceiveDelivery"
					document id is  DerivedDocumentID
					variation id is DerivedBODVariationID
					accounting entity is DerivedAccountingEntity

		
		
		PurgePurchaseOrderReceipt is a Set Action
			restricted

			Parameters
				PrmCompany						is a PurchasingCompany
				PrmPurgePOReceipt				is AlphaUpper size 1
					States
						PurgePOReceipts			value is "Y"
						ReportOnlyDoNotPurge	value is "R"
				PrmPurgeCutOffDate				is Date
				PrmFromPurgeAll					is Boolean

			Local Fields
				LocalSetPurgeCount				is Numeric 10
				AsyncId							is an AsyncActionRequest

			Parameter Rules
				PrmCompany
					required
					constraint (PrmCompany.FinanceEnterpriseGroup.PurgeCutOffDate entered)
						"PurgeCutOffDateMustBeSetFor_Finance_Enterprise_Group<PrmCompany.FinanceEnterpriseGroup>"
				PrmPurgePOReceipt
					initial value is "R"
					default to "R"
				PrmPurgeCutOffDate
					default to PrmCompany.FinanceEnterpriseGroup.PurgeCutOffDate

			Instance Selection
				include deleted records
				where (Company  		 = PrmCompany
				and    ReceivedDate 	<= PrmPurgeCutOffDate
				and   (Status.DropShip or Status.ArchivedClosed))

			Set Is
				PrmCompany

			Action Rules
				Empty Set Rules
					if (not PrmFromPurgeAll)
						LocalActor = actor
						send notification
							to LocalActor
							description is "NoPurchaseOrderReceiptRecordsFoundToPurge"
							priority is high
							detail is "ThereAreNoPurchaseOrderReceiptRecordsPurged"
				Set Rules
					Entrance Rules
						AsyncId = current async action request id
					Exit Rules
						if (PrmPurgePOReceipt.PurgePOReceipts)
							LocalPurgeRecords = true
						if (not PrmFromPurgeAll)
							LocalActor		= actor
							LocalPurgeCount	= LocalSetPurgeCount

							send notification
								to LocalActor
								description is "PurchaseOrderReceiptPurgeHasBeenCompleted"
								priority is high
								detail is "<DerivedCompletionDetailText>"

				Instance Rules
					if (PurchaseOrderRel not exists
					or (PurchaseOrderRel.Closed.Yes or PurchaseOrderRel.Closed.Historical))
						LocalSetPurgeCount += 1
							if (PrmPurgePOReceipt.PurgePOReceipts)
								invoke PurgeReceiptLineSet PurchaseOrderReceiptLine
									invoked.PrmCompany	= Company
									invoked.PrmReceipt	= PurchaseOrderReceipt

		PurgeReceipt is an Instance Action
			restricted
			Entrance Rules
				invoke Purge PurgePurchaseOrderReceiptTrackingRel
				invoke Purge PurgePurchaseOrderTransactionDetailRel
				invoke Purge PurgePurchaseOrderReceiptLineAOCRel
				invoke Purge PurgeProcurementTransactionDistributionRel
				invoke Purge PurgePOReceiptAdjustmentAndInspectionRel
				invoke Purge PurgePurchaseOrderBuyerMessageRel
				invoke Purge PurgePurchaseOrderReceiptCommentRel

			Action Rules
				invoke Purge

		Purge is a Purge Action
			restricted
			bypass relational integrity rules

		ConfirmPutawayFeedback is an Instance Action
			valid when (IsValidForReceivingPutaway)
			default label is "Confirm"

			Entrance Rules
				include ValidateLineDetails

			Action Rules
				PutawayStatus = PutawayStatus.ConfirmedPutawayFeedback
				invoke FinalRelease
		
		GlobalFastUpdate is an Update Action
			restricted
			bypass field rules
			
	Create Exit Rules
		if (Company.PackageTrackingLevel.HeaderLevel or Company.PackageTrackingLevel.EnableMscmRadTracking)
			invoke Create PurchaseOrderReceiptTracking
				invoked.Company													= Company
				invoked.PurchaseOrderReceipt									= PurchaseOrderReceipt
				if (PackageTrackingNumber entered)
					invoked.PurchaseOrderReceiptTracking.PackageTrackingNumber	= PackageTrackingNumber
				else
					invoked.PurchaseOrderReceiptTracking.PackageTrackingNumber	= PurchaseOrderReceipt
				invoked.NumberOfLabels											= PackageTrackingLabel

		for each PurchaseOrderCommentRel	
			invoke SystemCreate PurchaseOrderReceiptComment
				fill in fields from each
					except invoked.Attachment.FSMAttachmentIDM
				invoked.PurchaseOrderReceipt	= PurchaseOrderReceipt
				invoked.Attachment.File			= each.Attachment.File
				invoked.Attachment.MimeType		= each.Attachment.MimeType
				invoked.Attachment.Title		= each.Attachment.Title


	StateCycles
		PurchaseOrderReceiptLifeCycle is a StateCycle
			state field is Status
			Unreleased is a State
				Create is a Create Action
					Entrance Rules
						if (not Company.AllowMultipleUnreleasedReceipts)
							constraint (UnreleasedPurchaseOrderReceiptsRel not exists)
								"UnreleasedReceiptExistsForPurchaseOrder<PurchaseOrder>"

					Action Rules

					Exit Rules

				MobileCreate is a Create Action
					default label is "Create"
					Entrance Rules
						if (not Company.AllowMultipleUnreleasedReceipts)
							constraint (UnreleasedPurchaseOrderReceiptsRel not exists)
								"UnreleasedReceiptExistsForPurchaseOrder<PurchaseOrder>"

					Action Rules

					Exit Rules

				MobileCreateReceiptWizard is a Create Action
					default label is "CreateReceiptWizard"
					Local Fields
						LocalPOLineCount		is Numeric size 6
					Entrance Rules
						if (not Company.AllowMultipleUnreleasedReceipts)
							constraint (UnreleasedPurchaseOrderReceiptsRel not exists)
								"UnreleasedReceiptExistsForPurchaseOrder<PurchaseOrder>"

					Action Rules
						if (TransientReceiveAll)
							include AddReceiveAllActionRules

					Exit Rules
						if (TransientReceiveAll)
							include AddReceiveAllExitRules

				MobileAddReceiveAll is a Create Action
					default label is "CreateReceiveAll"
					Local Fields
						LocalPOLineCount		is Numeric size 6
					Action Rules
						include AddReceiveAllActionRules
					Exit Rules
						include AddReceiveAllExitRules

				AddReceiveAll is a Create Action
					default label is "CreateReceiveAll"
					Local Fields
						LocalPOLineCount		is Numeric size 6
					Action Rules
						include AddReceiveAllActionRules
					Exit Rules
						include AddReceiveAllExitRules

				CreateFromInterface is a Create Action
					restricted
					Entrance Rules
						if (not Company.AllowMultipleUnreleasedReceipts)
							constraint (UnreleasedNotInProcessReceiptsRel not exists)
								"UnreleasedReceiptExistsForPurchaseOrder<PurchaseOrder>"

						include ReceiptInterfaceEdits
					Exit Rules

						make transition to CreateInProgress

				ReleaseAndPrintLPL is an Instance Action
					default label is "NEWReleaseAndDeliver"
					Local Fields
						LocalRunBatchID is like IDMPID
					Action Rules
						LocalCompletionMessage = NewReleaseAndDeliverCompletionMessage
						LocalRunBatchID = current timestamp
						invoke Unreleased.Release
						
						if (not IsMSCMTrackedDoNotPrint)
							if (LocalUseBatchRelease)
								invoke ReceivingDeliveryAndPutaway
									run after LocalAsyncID
									assign async action request id to LocalAsyncID
									invoked.PrmCompany								= Company
									invoked.PrmPurchaseOrderReceipt					= PurchaseOrderReceipt
									invoked.PrmPrintBackorders						= true
									invoked.PrmPrintDeliveryTicketsAndPutaway		= true
									invoked.PrmInstanceRun							= true
									invoked.PrmRunBatchID							= LocalRunBatchID
								
								if (not Company.UseIDM)
									invoke SendNotificationOrEmail in background
										run after LocalAsyncID
										invoked.PrmCompany								= Company
										invoked.PrmPrintBackorders						= true
										invoked.PrmPrintDeliveryTicketsAndPutaway		= true						
							else
								invoke ReceivingDeliveryAndPutaway in foreground
									invoked.PrmCompany								= Company
									invoked.PrmPurchaseOrderReceipt					= PurchaseOrderReceipt
									invoked.PrmPrintBackorders						= true
									invoked.PrmPrintDeliveryTicketsAndPutaway		= true
									invoked.PrmInstanceRun							= true
									invoked.PrmRunBatchID							= LocalRunBatchID
									
								if (not Company.UseIDM)
									invoke SendNotificationOrEmail
										invoked.PrmCompany								= Company
										invoked.PrmPrintBackorders						= true
										invoked.PrmPrintDeliveryTicketsAndPutaway		= true
					Exit Rules
						include CreateArrivalRecord 
						include CreateMobileSupplyChainDelivery	
						
				ReleaseAndPrintNoBackordersLPL is an Instance Action
					default label is "NEWReleaseAndDeliverNoBackorders"
					Local Fields
						LocalRunBatchID is like IDMPID
					Action Rules
						LocalCompletionMessage = NewReleaseAndDeliverNoBackordersCompletionMessage
						LocalRunBatchID = current timestamp
						invoke Unreleased.Release
						
						if (not IsMSCMTrackedDoNotPrint)
							if (LocalUseBatchRelease)
								invoke ReceivingDeliveryAndPutaway
									run after LocalAsyncID
									assign async action request id to LocalAsyncID
									invoked.PrmCompany								= Company
									invoked.PrmPurchaseOrderReceipt					= PurchaseOrderReceipt
									invoked.PrmPrintBackorders						= false
									invoked.PrmPrintDeliveryTicketsAndPutaway		= true
									invoked.PrmInstanceRun							= true
									invoked.PrmRunBatchID							= LocalRunBatchID
								
								if (not Company.UseIDM)
									invoke SendNotificationOrEmail in background
										run after LocalAsyncID
										invoked.PrmCompany								= Company
										invoked.PrmPrintBackorders						= false
										invoked.PrmPrintDeliveryTicketsAndPutaway		= true						
							else
								invoke ReceivingDeliveryAndPutaway in foreground
									invoked.PrmCompany								= Company
									invoked.PrmPurchaseOrderReceipt					= PurchaseOrderReceipt
									invoked.PrmPrintBackorders						= false
									invoked.PrmPrintDeliveryTicketsAndPutaway		= true
									invoked.PrmInstanceRun							= true
									invoked.PrmRunBatchID							= LocalRunBatchID
									
								if (not Company.UseIDM)
									invoke SendNotificationOrEmail
										invoked.PrmCompany								= Company
										invoked.PrmPrintBackorders						= false
										invoked.PrmPrintDeliveryTicketsAndPutaway		= true
					Exit Rules
						include CreateArrivalRecord	
						include CreateMobileSupplyChainDelivery	

				ReleaseAndPrint is an Instance Action
					default label is "ReleaseAndDeliver"
					Action Rules

						LocalCompletionMessage = ReleaseAndDeliverCompletionMessage
						invoke Unreleased.Release

						if (PrintPutawayAndDelivery)
							if (LocalUseBatchRelease)
								invoke ReceivingDeliveryAndPutaway ReceivingDeliveryAndPutaway
									run after LocalAsyncID
									invoked.PrlCompany					= Company
									invoked.FromLocation				= ShipToLocation
									invoked.Receipt						= PurchaseOrderReceipt
									invoked.IDMPrinter					= IDMPrinter
							else
								invoke ReceivingDeliveryAndPutaway ReceivingDeliveryAndPutaway
									invoked.PrlCompany					= Company
									invoked.FromLocation				= ShipToLocation
									invoked.Receipt						= PurchaseOrderReceipt
									invoked.IDMPrinter					= IDMPrinter

					Exit Rules
						include CreateArrivalRecord
						include CreateMobileSupplyChainDelivery			

				ReleaseAndPrintNoBackorders is an Instance Action
					default label is "ReleaseAndDeliverNoBackorders"
					Action Rules

						LocalCompletionMessage = ReleaseAndDeliverNoBackordersCompletionMessage
						invoke Unreleased.Release

						if (PrintPutawayAndDelivery)
							if (LocalUseBatchRelease)
								invoke ReceivingDeliveryAndPutaway ReceivingDeliveryAndPutaway
									run after LocalAsyncID
									invoked.PrlCompany					= Company
									invoked.FromLocation				= ShipToLocation
									invoked.Receipt						= PurchaseOrderReceipt
									invoked.BoPrintFl					= "N"
									invoked.IDMPrinter					= IDMPrinter
							else
								invoke ReceivingDeliveryAndPutaway ReceivingDeliveryAndPutaway
									invoked.PrlCompany					= Company
									invoked.FromLocation				= ShipToLocation
									invoked.Receipt						= PurchaseOrderReceipt
									invoked.BoPrintFl					= "N"
									invoked.IDMPrinter					= IDMPrinter

					Exit Rules
						include CreateArrivalRecord
						include CreateMobileSupplyChainDelivery	

				ReceiveAll is an Instance Action
					valid when (ValidForReceiveAll)
					Parameters
						PrmShipToLocationFilter	is an InventoryLocation
							default label is "POLineShipToLocationFilter"

					Entrance Rules
						constraint (Company.AllowReceiveAll)
							"CompanyDoesNotAllowAddReceiveAll"
						constraint (HasPOLinesToReceive)
							"PurchaseOrderHasNoLinesToReceive"

					Action Rules
						LocalShipToLocFilter = PrmShipToLocationFilter
						for each NonCatchWeightNonServicePOLineRelForReceiveAll 

							invoke Create POReceiptLineTemplate
								invoked.Company					= Company
								invoked.PurchaseOrderReceipt	= PurchaseOrderReceipt
								invoked.PurchaseOrderLine		= each.PurchaseOrderLine
								invoked.ReceivedQuantity		= each.RemainingQuantity
								invoked.TransientInspectionRequired		= each.InspectionRequired

				Update is an Update Action
				    valid when (!InterfaceInProcess)
					Entrance Rules
						constraint (not TemporaryHold.SentForApproval)
							"CannotUpdateWhileAwaitingApproval"
					Action Rules

						if (not Company.PackageTrackingLevel.LineLevel)
							constraint (PurchaseOrderReceiptLineTrackingRel not exists)
								"CannotEnterLineTrackingNumber"
					Exit Rules
						if (Company.PackageTrackingLevel.LineLevel
						or  Company.PackageTrackingLevel.PackageTrackingNotUsed)
							invoke Delete PurchaseOrderReceiptTrackingRel
						else 
							if (PackageTrackingNumber not = PurchaseOrderReceiptTrackingRel.PurchaseOrderReceiptTracking.PackageTrackingNumber)
								if (PurchaseOrderReceiptTrackingRel exists)
									invoke Delete PurchaseOrderReceiptTrackingRel

								invoke Create PurchaseOrderReceiptTrackingRel
									invoked.PurchaseOrderReceiptTracking.PackageTrackingNumber	= PackageTrackingNumber
									invoked.NumberOfLabels										= PackageTrackingLabel
							else
							if (PackageTrackingLabel not = PurchaseOrderReceiptTrackingRel.NumberOfLabels)
								invoke Update PurchaseOrderReceiptTrackingRel
									invoked.NumberOfLabels	= PackageTrackingLabel

						if (ReceivedDate	changed
						or  ReferenceNumber	changed
						or  ProcessLevel	changed
						or  Vendor			changed
						or  Invoice			changed)
							invoke UpdateReceiptLinesFromReceipt PurchaseOrderReceiptLine set
						        invoked.PrmReceivedDate date	= DerivedReceivedDate
						        invoked.PrmReferenceNumber		= ReferenceNumber
								invoked.PrmProcessLevel			= ProcessLevel
						        invoked.PrmVendor				= Vendor
						        invoked.PrmInvoice				= Invoice

				FastUpdate is an Update Action
					restricted
					bypass field rules
					Entrance Rules
						constraint (not TemporaryHold.SentForApproval)
							"CannotUpdateWhileAwaitingApproval"

				Delete is a Delete Action
					Entrance Rules
						invoke DeleteFromHeader POReceiptLineTemplate set
						if (InterfaceInProcess)
							invoke Delete AllPurchaseOrderBuyerMessagesRel
						constraint (not TemporaryHold.SentForApproval)
							"CannotDeleteWhileAwaitingApproval"

					Action Rules

                ReleaseFromInterface is an Instance Action
                    restricted
                    Parameters
                        PrmRunGroup             is like RunGroup
                        PrmEnableGLNProcessing    is Boolean
                    Action Rules
                        LocalRunGroup                 = PrmRunGroup
                        LocalEnableGLNProcessing    = PrmEnableGLNProcessing

                    Exit Rules
                        invoke Unreleased.Release
                            resume on error
                                LocalErrorOccurred    = true
                                LocalErrorMessage    = error message
                        if (LocalErrorOccurred)
                            invoke CreateErrorRecord ReceiptInterfaceInputRel
                                invoked.PrmFinanceEnterpriseGroup     = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
                                invoked.PrmErrorMessage                = LocalErrorMessage
                                invoked.PrmErrorLevel                = 2 
                                invoked.PrmResult                    = OriginatingInterfaceRun
                                invoked.EnableGLNProcessing            = LocalEnableGLNProcessing
                        else
                            invoke FastDelete ReceiptInterfaceInputRel

				Release is an Instance Action
					valid when (IsValidForRelease)
					completion message is "<CompletionMessage>"
					
					Local Fields
						LocalOriginCountry			is like Country
						LocalOriginRegion			is like Region

					Entrance Rules
						if (POReceiptLineTemplateCancelBackorderRel exists)
							for each POReceiptLineTemplateCancelBackorderRel
								if (not each.CancelRemaining)
									invoke UpdateFromReceiptLine each.PurchaseOrderLine
										invoked.PrmPurchaseOrderReceipt 	= each.PurchaseOrderReceipt
										invoked.PrmPurchaseOrderReceiptLine = each.PurchaseOrderLine
										invoked.PrmIsCancelBackorder		= each.CancelBackorder

							if (PurchaseOrderReceiptLine set not exists)
								include ArchivedClosedReceiptHeader
								LocalNoReceiptLineRelease = true
					Action Rules
						if (not LocalNoReceiptLineRelease)
							if (ReceiptLinesForInventoriedItemsRel exists)
								include InventoryTransactionValidations
						
							constraint (PurchaseOrderReceiptLine set exists)
								"ReceiptHasNoLine;CannotRelease"

							constraint (not TemporaryHold.SentForApproval)
								"ActionNotAllowed;SentToEngine"

							constraint  (Invoice entered
							or			(not IsInvoiceMethodNotRequired
							and			 not Vendor.ERSCapable))
								"InvoiceNumberRequired;CannotRelease"

							constraint (PurchaseOrder.Released)
								"AssociatedPurchaseOrderIsNotReleased;CannotRelease"

							constraint (not HasUnreleasedBuyerMessages)
								"Receipt<PurchaseOrderReceipt>_Line<first PurchaseOrderUnreleasedBuyerMessagesRel.PurchaseOrderReceiptLine.PurchaseOrderLine.LineNumber>_HasOutstandingBuyerMessage"

							constraint (not InventoriedChangedToNonInventoriedPOReceiptLinesRel exists)
								"Receipt<PurchaseOrderReceipt>_Line<first InventoriedChangedToNonInventoriedPOReceiptLinesRel.PurchaseOrderLine.LineNumber>_InventoryItemChangedToNon-InventoryItem;CannotRelease"

							if (not ShipToLocation.UseAsWarehouseLocation)
								include ValidateLineDetails
							
							if (IsMSCMEnabled and Company.PackageTrackingLevel.EnableMscmRadTracking)
								if (NonDetailTrackedReceiptLinesRel exists)
									for each NonDetailTrackedReceiptLinesRel
										if (each.MobileSupplyChainPurchaseOrderReceiptTrackingRel exists and (MobileSupplyChainConfigurationRel.DeliveryInventoryItem or each.IsNonInventory))
											constraint (each.IsTrackingDetailBalanced)
												"TrackDetailQuantityIsOutOfBalanceForReceipt<PurchaseOrderReceipt>Line<each.PurchaseOrderReceiptLine>Item<each.Item>;CannotRelease"
								if (ReceiptLineDetailsRel exists)
									for each ReceiptLineDetailsRel
										if (each.MSCMPurchaseOrderReceiptTrackingRel exists and MobileSupplyChainConfigurationRel.DeliveryInventoryItem)
											constraint (each.IsTrackingDetailBalanced)
												"TrackDetailQuantityIsOutOfBalanceForReceipt<PurchaseOrderReceipt>Line<each.PurchaseOrderTransactionDetail.LineNumber>Item<each.Item>;CannotRelease"
								if (ReceiptUDIDetailsRel exists)
									for each ReceiptUDIDetailsRel
										if (each.MSCMPurchaseOrderReceiptTrackingRel exists and (MobileSupplyChainConfigurationRel.DeliveryInventoryItem or each.PurchaseOrderReceiptLineRel.IsNonInventory))
											constraint (each.IsTrackingDetailBalanced)
												"TrackDetailQuantityIsOutOfBalanceForReceipt<PurchaseOrderReceipt>Line<each.PurchaseOrderUDIDetail.LineNumber>Item<each.Item>;CannotRelease"

							include SetCurrency

							LocalShipToLocation = first ReceiptLinesForReleasingRel.ShipToLocation
							if (ReceiptLinesForReleaseWithDifferentLocationsRel exists)
								constraint ((Vendor.PoolOption.UseCompany
								and 		 not MatchCompanyRel.PoolOption.CompanyVendorPurchaseOrderShipToLocation)
								or          (Vendor.PoolOption.CompanyVendor
								or           Vendor.PoolOption.CompanyVendorPo))
									"CannotHaveMultipleLocationsOnReceiverLinesForPoolOptionCompanyVendorPurchaseOrderShipToLocation"
							else
								ShipToLocation = LocalShipToLocation
									
							if (Company.TaxEntityRel.ThirdParty.TaxEngine
							and !TemporaryHold.ApprovedByEngine)
								TemporaryHold = TemporaryHold.SentForApproval
								invoke PutOnHold PurchaseOrder
								invoke TriggerOrderToInvoiceLPLBOD
								for each PurchaseOrderReceiptLinesRel
									invoke PutOnHold each

								if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger)
									if (!action type.Delete)
										if (action != "UpdateBODIdFields") 
											ActionCode = ActionCode.Update
											if (action type.Create)
												ActionCode = ActionCode.Create
											increment bod id.VariationID
											LocalBODCurrentTimeStamp.CurrentTimeStamp = current timestamp
											include TriggerBRPurchaseOrderReceipt
							else



								if (PurchaseOrderReceiptLineTrackingRel exists) 
									constraint 	(Company.PackageTrackingLevel.LineLevel)
										"CannotEnterLineTrackingNumber"


								if (Company.PackageTrackingLevel.PackageTrackingNotUsed
								or  Company.PackageTrackingLevel.LineLevel)
									constraint (PurchaseOrderReceiptTrackingRel not exists) 
										"TrackingNumberMustBeBlank"
										
									if (Company.PackageTrackingLevel.LineLevel
									and OriginatingInterfaceRun = 0)
										for each PurchaseOrderReceiptLinesRel
											constraint (each.PurchaseOrderReceiptTrackingRel exists)
												"Line<each.PurchaseOrderLine>TrackingNumberIsRequired"
											constraint (each.PurchaseOrderReceiptTrackingWithoutLabelRel not exists)
												"LabelForLine<each.PurchaseOrderLine>TrackingNumberIsRequired"
								else
								if (OriginatingInterfaceRun = 0) 
									if (Company.PackageTrackingLevel.HeaderLevel) 
										constraint (PurchaseOrderReceiptTrackingRel exists)
											"TrackingNumberIsRequired"
										if (PurchaseOrderReceiptTrackingRel.NumberOfLabels not entered)
											invoke Update PurchaseOrderReceiptTrackingRel
									else 
										if (PurchaseOrderReceiptTrackingRel exists)
											constraint (PurchaseOrderReceiptTrackingRel.NumberOfLabels not entered)
													"LabelsMustBeBlank"
										else
											invoke Create PurchaseOrderReceiptTracking
												invoked.Company												= Company
												invoked.PurchaseOrderReceipt                                = PurchaseOrderReceipt
								else
								if (OriginatingInterfaceRun entered)
									if (PurchaseOrderReceiptTrackingRel not exists) 
										invoke Create PurchaseOrderReceiptTracking
											invoked.Company												= Company
											invoked.PurchaseOrderReceipt								= PurchaseOrderReceipt
											invoked.PurchaseOrderReceiptTracking.PackageTrackingNumber	= PackageTrackingNumber
											invoked.NumberOfLabels										= PackageTrackingLabel

								constraint (PurchaseOrderReceiptAOCWithoutAddOnChargeAmountRel not exists)
									"ReceiverHasZeroAddOnChargeAmount;CannotRelease"			

								constraint (PurchaseOrder.Approved
								or          not PurchaseOrder.SubcontractorPurchaseOrder)
									"CannotReleaseReceiver;PurchaseOrderNeedsApproval"				

								if ((IsCancelBackOrder or POReceiptLinesForBackorderRel exists)
								and  OriginatingInterfaceRun not entered)
									confirmation required
										"BackordersWillBeCancelled.Continue?"

								if (ERSStatus.InvoiceFromReceipt)
									ERSStatus = ERSStatus.InvoicePending

								ReleasingOperatorID = actor

								initialize LocalUseBatchRelease
								LocalLimitForBatchInvoke = 50
								if (DerivedRowCount > LocalLimitForBatchInvoke)
									LocalUseBatchRelease = true
									
								make transition to ReleaseInProgress

							for each PurchaseOrder.PurchaseOrderAddOnChargesByVendorRel
								LocalInterfacedAddOnCharge = each.AddOnCharge
								if (ReceiptHeaderAddOnChargeRel not exists)
									invoke CreatefromPorecepd PurchaseOrderReceiptLineAOC
										fill in fields from each
										invoked.Company												= Company
										invoked.PurchaseOrderReceipt    							= PurchaseOrderReceipt
										invoked.AddOnCharge											= each.AddOnCharge
										invoked.ReceivedQuantity									= 1



					Exit Rules
						if (not LocalNoReceiptLineRelease)





							if (Company.TaxEntityRel.ThirdParty.TaxEngine
							and TemporaryHold != "A")
								CompletionMessage = SentToEngineCompletionMessage
							else
								if (LocalCompletionMessage entered)
									CompletionMessage = LocalCompletionMessage
								else
									CompletionMessage = ReleaseCompletionMessage

								if (Company.TaxEntityRel.ThirdParty.TaxEngine
								and TemporaryHold = "A")
									invoke TaxEngineApprove PurchaseOrderRel

								if  (Company.TaxEntityRel.IntrastatUsed
								and (PurchaseFromLocation.VendorAddress.Country entered or Vendor.CurrentAddressRel.PostalAddress.Country entered)
								and	 ShipToLocation.PostalAddressForPurchaseOrder.Country entered)
									initialize IntrastatProcessing
									IntrastatProcessing.InFinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
									IntrastatProcessing.TaxEntity					= Company.AccountingEntity

									if (PurchaseFromLocation entered)
										LocalOriginCountry							= PurchaseFromLocation.VendorAddress.Country
										LocalOriginRegion							= PurchaseFromLocation.VendorAddress.Region

									else
										LocalOriginCountry							= Vendor.VendorAddress.Country
										LocalOriginRegion							= Vendor.VendorAddress.Region

									IntrastatProcessing.DestinationCountry			= ShipToLocation.PostalAddressForPurchaseOrder.Country
									IntrastatProcessing.DestinationRegion			= ShipToLocation.PostalAddressForPurchaseOrder.Region
									IntrastatProcessing.OriginCountry				= LocalOriginCountry
									IntrastatProcessing.OriginRegion				= LocalOriginRegion
									LocalCheckCountries								= IntrastatProcessing.CheckCountries

									if (IntrastatProcessing.OutputErrorMessage entered)
										constraint (IntrastatProcessing.OutputErrorNumber not entered)             
											"<IntrastatProcessing.OutputErrorMessage>"

									if (IntrastatProcessing.DoIntrastatReporting)		
										if (not InstrastatDetailExist)
											IntrastatProcessing.HeaderFc				= IntrastatProcessing.HeaderFc.Delete

										IntrastatProcessing.HeaderFc					= IntrastatProcessing.HeaderFc.Create
										IntrastatProcessing.DeliveryDate				= ReceivedDate
										IntrastatProcessing.TransactionType				= IntrastatProcessing.TransactionType.Purchase
										IntrastatProcessing.SystemCode					= "PO"
										IntrastatProcessing.Vendor						= Vendor
										IntrastatProcessing.VendorGrp					= GeneralLedgerCompanyRel.BusinessGroup
										IntrastatProcessing.PurchaseOrder				= PurchaseOrder
										IntrastatProcessing.InvoiceCompany				= PurchaseOrder.Company
										IntrastatProcessing.DocumentNumber				= PurchaseOrderReceipt
										IntrastatProcessing.NatureOfTransactionCode		= PurchaseOrder.NatureOfTransactionCode
										IntrastatProcessing.InvoiceDate					= ReceivedDate
										IntrastatProcessing.VendorCurrency				= Currency
										IntrastatProcessing.CurrencyRate				= ReceiptCurrencyConversionRate
										IntrastatProcessing.DestinationCountry			= ShipToLocation.PostalAddressForPurchaseOrder.Country
										IntrastatProcessing.DestinationRegion			= ShipToLocation.PostalAddressForPurchaseOrder.Region
										IntrastatProcessing.OriginCountry				= LocalOriginCountry
										IntrastatProcessing.OriginRegion				= LocalOriginRegion
										IntrastatProcessing.UnloadingPort				= PurchaseOrder.UnloadingPort
										IntrastatProcessing.TransportMode				= PurchaseOrder.ShippingMethod
										IntrastatProcessing.DeliveryTerms				= PurchaseOrder.ShipTerm

										if (PurchaseOrder.Dropship)
											IntrastatProcessing.DropShip				= DropShipInd.Yes
										else
											IntrastatProcessing.DropShip				= DropShipInd.No

										IntrastatProcessing.VendorVATRegCountry 	    = Vendor.VATRegistrationCountry
										IntrastatProcessing.VendorVATRegNumber 		    = Vendor.VATRegistrationNumber
										IntrastatProcessing.StatisticalProcedure 		= PurchaseOrder.StatisticalProcedure
										LocalTrigger 									= IntrastatProcessing.MainTrigger





								
								include ReleaseLogic



								invoke FastUpdate PurchaseOrder
									invoked.LastActivityDate				= current corporate date
									invoked.PrintReceipt 					= ReprintReceipt
									if (not invoked.CurrencyExchangeSetPoint.Invoicing)
										invoked.ReceiptCurrencyConversionRate = ReceiptCurrencyConversionRate

								if (PurchaseOrder.VendorReturn entered
								and PurchaseOrder.VendorReturn.ReplaceGoods
								and not PurchaseOrder.VendorReturn.VendorClaimType.CreditMemo
								and PurchaseOrder.LinesWithUnreceivedQuantityRel not exists)
									invoke CloseFromPOReceipt PurchaseOrder.VendorReturn
										
								if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger)
									if (!action type.Delete)
										if (action != "UpdateBODIdFields") 
											ActionCode = ActionCode.Update
											if (action type.Create)
												ActionCode = ActionCode.Create
											if (PurchaseOrder.BlanketOrStandingContract entered)
												POBlanketOrStandingAgreement = "Y"
											else
												POBlanketOrStandingAgreement = "N"

											increment bod id.VariationID
											LocalBODCurrentTimeStamp.CurrentTimeStamp = current timestamp
											include TriggerPurchaseOrderReceiptRules





				TaxEngineApprove is an Instance Action
					restricted
					Action Rules
						TemporaryHold = TemporaryHold.ApprovedByEngine
						invoke TaxEngineApprove PurchaseOrder

				TaxEngineReject is an Instance Action
					restricted
					Action Rules
						TemporaryHold = TemporaryHold.RejectedByEngine
						invoke TaxEngineReject PurchaseOrder

				ReleaseFromMSCM is an Instance Action
					restricted
					Action Rules
						LocalReleaseFromMSCM = true
						invoke Unreleased.ReleaseAndPrintLPL
			
			ReleasedPendingTwoStepReceiving is a State

				UpdateReceivedDate is an Instance Action
					Parameters
						PrmReceivedDate	is TimeStamp
							default label is "NewReceivedDate"

					Parameter Rules
						PrmReceivedDate
							initial value is current timestamp
							default to current timestamp
							
							initialize LocalReceivedDate
							LocalReceivedDate = PrmReceivedDate

							include ValidateReceivedDate

					Action Rules
						ReceivedDate = PrmReceivedDate

					Exit Rules
						invoke UpdateReceiptLinesFromReceipt PurchaseOrderReceiptLine set
							invoked.PrmReceivedDate date	= DerivedReceivedDate



			Released is a State
















				UpdateFromReconciliation is an Instance Action
					restricted
					Action Rules
				        LastUpdateDate			= current timestamp
				        LastUpdateBy			= actor


				UpdateFromERS is an Instance Action
					restricted
					Parameters
						PrmERSStatus	is a ERSStatus

					Action Rules
						ERSStatus		= PrmERSStatus
				        LastUpdateDate	= current timestamp
				        LastUpdateBy	= actor

				ArchiveReceipt is an Instance Action
					restricted
					Action Rules
				        LastUpdateDate		= current timestamp
				        LastUpdateBy		= actor

					Exit Rules
						make transition to ArchivedClosed

				FastUpdate is an Update Action
					restricted
					bypass field rules
					Entrance Rules
						constraint (not TemporaryHold.SentForApproval)
							"CannotUpdateWhileAwaitingApproval"

				UpdateMatchReference is an Instance Action
					Parameters
						PrmMatchReferenceNumber is a MatchReferenceNumber
					Action Rules
						MatchReferenceNumber = PrmMatchReferenceNumber


				Update is an Update Action
					restricted
					bypass field rules
					Entrance Rules
						constraint (not TemporaryHold.SentForApproval)
							"CannotUpdateWhileAwaitingApproval"


				TaxEngineApprove is an Instance Action
					restricted
					Action Rules
						TemporaryHold = TemporaryHold.ApprovedByEngine

				TaxEngineReject is an Instance Action
					restricted
					Action Rules
						TemporaryHold = TemporaryHold.RejectedByEngine

			ReadyToArchive is a State

			DropShip is a State

			ArchivedClosed is a State

			ReleaseInProgress is a State
				TransitionToReleased is an Instance Action
					restricted
					Local Fields
						LocalActor					 is an Actor
					Parameters

						PrmBatchReleaseResult		 is like PurchaseOrderResult
						PrmSkipNotification			 is Boolean
					Action Rules
						include ArchivedClosedReceiptHeader

						if (PrmSkipNotification)

							invoke Create PurchaseOrderResultDetail
								invoked.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
								invoked.PurchaseOrderResult		= PrmBatchReleaseResult
								invoked.PurchasingCompany		= Company
								invoked.PurchaseOrderReceipt	= PurchaseOrderReceipt
								invoked.PurchaseOrder			= PurchaseOrder

						else
							LocalActor = actor
							send notification
								to LocalActor
								description is "Receipt<PurchaseOrderReceipt>HasBeen<Status>ForPurchaseOrder<PurchaseOrder>."
								priority is medium
								detail is "Receipt<PurchaseOrderReceipt>HasBeen<Status>ForPurchaseOrder<PurchaseOrder>."


			CreateInProgress is a State
				TransitionToUnreleased is an Instance Action
					restricted
					Action Rules
						make transition to Unreleased

				TransitionToDropship is an Instance Action 
					restricted
					Action Rules
						InterfaceInProcess = false
						make transition to DropShip

				FastUpdate is an Update Action
					restricted
					bypass field rules

