InventoryReportGroup is a BusinessClass
    owned by ic
    prefix is IRGP

    Ontology
        symbolic key is InventoryReportGroup

    Patterns
        implements StaticJava
        disable AuditIndex

    Persistent Fields
        Name
        AddNewInventoryLocations    is Boolean 

    Local Fields 
        LocalProcurementGroup   is like ProcurementGroup 
        LocalParticipantGroup   is like ParticipantGroup
        LocalCompany            is like InventoryCompany
        LocalLocation           is like InventoryLocation 
    
    Conditions	
		RecordExist
			restricted
			when (InventoryReportGroup exist)

        HasParticipantGroups
            restricted 
            when (ParticipantGroupReportGroupRel exists)

	Relations 

        ParticipantGroupRel 
            one-to-one relation to ParticipantGroup 
            Field Mapping uses symbolic key
                related.ProcurementGroup    = LocalProcurementGroup
                related.ParticipantGroup    = LocalParticipantGroup 

        ParticipantGroupLineRel 
            one-to-many relation to ParticipantGroupLine  
            Field Mapping uses ByLocReqLocSet
                related.ProcurementGroup                                    = LocalProcurementGroup
                related.ParticipantGroup                                    = LocalParticipantGroup 
                related.ParticipantGroupLine.ParticipantLocation.Company    = LocalCompany 
                related.ParticipantGroupLine.ParticipantLocation.Location   = LocalLocation

        ParticipantGroupLineReqLocation
            one-to-many relation to ParticipantGroupLine  
            Field Mapping uses ByLocReqLocSet
                related.ProcurementGroup                                            = LocalProcurementGroup
                related.ParticipantGroup                                            = LocalParticipantGroup 
                related.ParticipantGroupLine.ParticipantLocation.Company            = LocalCompany 
                related.ParticipantGroupLine.ParticipantLocation.Location           = blank 
                related.ParticipantGroupLine.ParticipantLocation.RequestingLocation = LocalLocation
        InventoryReportGroupLocationRel 
            one-to-many relation to InventoryReportGroupLocation
            delete cascades
            Field Mapping uses symbolic key 
                related.Company                 = Company 
                related.InventoryReportGroup    = InventoryReportGroup 

        LocalParticipantGroupReportGroupRel 
            one-to-many relation to ParticipantGroupReportGroup 
            Field Mapping uses ByInventoryReportGroup
                related.Company                  = Company 
                related.InventoryReportGroup     = InventoryReportGroup
                related.ProcurementGroup         = LocalProcurementGroup
                related.ParticipantGroup         = LocalParticipantGroup      

        ParticipantGroupReportGroupRel 
            one-to-many relation to ParticipantGroupReportGroup 
            delete cascades
            Field Mapping uses ByInventoryReportGroup
                related.Company                  = Company 
                related.InventoryReportGroup     = InventoryReportGroup
    Field Rules
		Name
			required
			
	Actions
		Create is a Create Action

		Update is an Update Action
	
        Delete is a Delete Action

        CreateOrUpdateParticipantGroup is an Instance Action 
            Parameters 
                ParmProcurementGroup        is a ProcurementGroup  
                    default label is "ProcurementGroup"
                ParmParticipantGroup        is a ParticipantGroup  
                    default label is "SelectAParticipantGroupHereIfAddingToAnExistingOne"
                ParmNewParticipantGroup     is like ParticipantGroup 
                    default label is "EnterAParticipantGroupHereIfCreatingANewOne"
                ParmNewGroupTitle           is a Description 
                    default label is "EnterATitleHereIfANewGroup"
                ParmNewGroupDescription     is a Description4 
                    default label is "EnterADescriptionHereIfANewGroup"

            Parameter Rules 

                ParmProcurementGroup 
                    initial value is Company.PurchasingCompanyRel.ProcurementGroup

                ParmNewGroupTitle 
                    initial value is Name  

            Action Rules 

                LocalProcurementGroup               = ParmProcurementGroup
                LocalCompany                        = Company 
                if (ParmNewParticipantGroup entered)
                    LocalParticipantGroup           = ParmNewParticipantGroup
                else 
                    LocalParticipantGroup           = ParmParticipantGroup
                if (ParmParticipantGroup entered)
                    constraint (ParmNewParticipantGroup !entered)
                        "CannotEnterBothANewAndExistingParticipantGroup"
                    constraint (ParticipantGroupRel.LocationType)
                        "MustUseAParticipantGroupThatHasLocations"
                    constraint (!ParticipantGroupRel.MemberGroup)
                        "CannotUseAMemberGroup"
                if (ParmParticipantGroup !entered)
                    constraint (ParmNewParticipantGroup entered)
                        "MustEnterEitherANewOrExistingParticipantGroup"
                if (ParmNewParticipantGroup !entered)
                    constraint (ParmParticipantGroup entered)
                        "MustEitherEnterANewOrExistingParticipantGroup"
                if (ParmNewParticipantGroup entered)
                    constraint (ParmNewGroupTitle entered)
                        "MustEnterATitleIfCreatingANewParticipantGroup"
                    constraint (ParmNewGroupDescription entered)
                        "MustEnterADescriptionIfCreatingANewParticipantGroup"
                    constraint (ParticipantGroupRel !exists)
                        "ParticipantGroupAlreadyExists" 
                    invoke Create ParticipantGroup 
                        invoked.ProcurementGroup        = ParmProcurementGroup
                        invoked.ParticipantGroup        = ParmNewParticipantGroup
                        invoked.ParticipantGroupTitle   = ParmNewGroupTitle
                        invoked.Description             = ParmNewGroupDescription
                    invoke Create ParticipantGroupReportGroup 
                        invoked.ProcurementGroup        = ParmProcurementGroup
                        invoked.ParticipantGroup        = ParmNewParticipantGroup
                        invoked.Company                 = Company
                        invoked.InventoryReportGroup    = InventoryReportGroup

                    for each InventoryReportGroupLocationRel
						invoke Create ParticipantGroupLine 
                            invoked.ProcurementGroup													= ParmProcurementGroup
							invoked.ParticipantGroup													= ParmNewParticipantGroup
							invoked.ParticipantGroupLine.ParticipantLocation.Company					= Company	
							invoked.ParticipantGroupLine.ParticipantLocation.Location 					= each.InventoryLocation	
                
                else 
                if (ParmParticipantGroup entered)
                    LocalParticipantGroup       = ParmParticipantGroup
                    if (LocalParticipantGroupReportGroupRel !exists)
                        invoke Create ParticipantGroupReportGroup 
                            invoked.ProcurementGroup        = ParmProcurementGroup
                            invoked.ParticipantGroup        = ParmParticipantGroup
                            invoked.Company                 = Company 
                            invoked.InventoryReportGroup    = InventoryReportGroup
                    for each InventoryReportGroupLocationRel                    
                        LocalLocation = each.InventoryLocation 
                        if (ParticipantGroupLineRel !exists
                        and ParticipantGroupLineReqLocation !exists)
                            invoke Create ParticipantGroupLine 
                                invoked.ProcurementGroup													= ParmProcurementGroup
                                invoked.ParticipantGroup													= ParmParticipantGroup
                                invoked.ParticipantGroupLine.ParticipantLocation.Company					= Company	
                                invoked.ParticipantGroupLine.ParticipantLocation.Location 					= each.InventoryLocation	


                 
                
