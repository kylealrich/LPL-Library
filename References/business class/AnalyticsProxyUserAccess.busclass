AnalyticsProxyUserAccess is a BusinessClass
	owned by filecreation

	prefix is Anpua
	
	Ontology
		symbolic key is AnalyticsProxyUserAccess
		
	
	Patterns
		disable EffectiveDated
		disable AsOfDateProcessing
	
	Persistent Fields
		ProxyUser is Alpha size 500
		UserExpirationDate is Alpha size 100

	Local Fields
		PrmIsProxyFailed is Boolean			
	Derived Fields
		
		DerivedBirstApiUserName is a DerivedField	 
			type is Alpha size 100
			restricted
			return BirstApiUserNameRel.Value
		
		DerivedBirstApiUserPassword is a DerivedField	 
			type is Alpha size 100
			restricted
			return BirstApiUserPasswordRel.Value
			
		DerivedBirstApiURL is a DerivedField	 
			type is Alpha size 100
			restricted
			return BirstApiURLRel.Value

		DerivedBirstApiTenantID is a DerivedField	 
			type is Alpha size 100
			restricted
			return BirstApiTenantIDRel.Value
		
	Relations
	
		BirstApiUserNameRel
			one-to-one relation to AnalyticsConsoleConfigurations
			Field Mapping uses symbolic key
				related.AnalyticsConsoleConfigurations = "BirstApiUserName"
				
		BirstApiUserPasswordRel
			one-to-one relation to AnalyticsConsoleConfigurations
			Field Mapping uses symbolic key
				related.AnalyticsConsoleConfigurations = "BirstApiUserPassword"
					
		BirstApiURLRel
			one-to-one relation to AnalyticsConsoleConfigurations
			Field Mapping uses symbolic key
				related.AnalyticsConsoleConfigurations = "BirstApiURL"
				
		BirstApiTenantIDRel
			one-to-one relation to AnalyticsConsoleConfigurations
			Field Mapping uses symbolic key
				related.AnalyticsConsoleConfigurations = "TenantID"

		AnalyticsConfigurationsRel
			one-to-many relation to AnalyticsConsoleConfigurations
			Field Mapping uses symbolic key	
		
	Actions
		Create is an Action

		Update is an Action
		
		Delete is an Action
		
		AddProxyAccess is a Set Action
			no records message is "ProxyUser/<EmailAddress>/<BirstApiUserNameRel.Value>added"
			run in foreground
			Instance Selection
				where (false)
			Parameters
				EmailAddress 			is EmailAddressField
				ExpirationDate			is Date
				
			Parameter Rules
				ExpirationDate
					required
				EmailAddress
					required
			Action Rules
				Empty Set Rules
					constraint (ExpirationDate > current timestamp)
						"ExpirationDateShouldBeGreaterThanCurrentDate"
					constraint (ExpirationDate - current timestamp <= 60)
						"ProxyAccessCanBeGivenMaxOnlyFor60Days"
					constraint(first AnalyticsConfigurationsRel.BirstLoginStatus)
						"FailedAddingProxyAccess._BirstUsernameAndPassword,BirstApiUrlAndTenantIDMustBeCorrect"	
					invoke GiveProxyAccess
						invoked.EmailAddress=EmailAddress
						invoked.ExpirationDate=ExpirationDate
							
		GiveProxyAccess is an Instance Action
			restricted
			completion message is "ProxyUser/<EmailAddress>/<BirstApiUserNameRel.Value>added"
			Parameters
				EmailAddress 			is EmailAddressField
				ExpirationDate			is Date
			Action Rules


			Exit Rules
				constraint (PrmIsProxyFailed=false)
					"Invalid_email_address._Please_ensure_that_the_email_is_correctly_and_associated_with_a_valid_account_in_the_tenant."
