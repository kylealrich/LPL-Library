Buyer is a BusinessClass
	owned by po
	prefix is BUY
	representative image is Buyer.Employee.ResourcePicture.File
		missing image is random background
			foreground text is "<Buyer.Employee.Name.Initials>"

	Ontology
		symbolic key is Buyer
			classic set name is BUYSET1
			classic name is BUYER-CODE

	Patterns
		implements StaticJava
		disable AuditIndex
		implements BODId

	Context Fields
		FSMInboundBODTracker

	Persistent Fields
		Reference1					is a Reference
		Reference2					is a Reference
		OperatorID					is an Operator 
			holds pii
			restricted
			protected
		ProcurementGroup
			disable surrogates
			classic name is PROCURE-GROUP
		BuyerGroup
			classic name is BUYER-GRP
		LimitPerPurchaseOrder		is an UnsignedInternationalAmount
			classic name is PO-LIMIT
		Active						is Boolean
			classic name is ACTIVE-STATUS
		RestrictPurchasingClasses	is Boolean
			classic name is CLASS-ONLY-FL
		SearchByCost				is Boolean
		SearchByQuantity			is Boolean
		SearchByUOM					is Boolean
		SearchByVendorItem			is Boolean
		SearchByRejectedItem		is Boolean
		SearchByDeliveryDate		is Boolean
		SearchByItemSubstitute		is Boolean
		SearchAcknowledgementAmount	is an UnsignedInternationalAmount
		FilterByBuyer				is Boolean
			classic name is FIL-BUYER-CODE
		FilterByPurchasingClasses	is Boolean
			classic name is FIL-BUY-PUR-CL
		FilterByVendors				is Boolean
			classic name is FIL-BUY-VEN-FL
		FilterByLocation			is Boolean
			classic name is FIL-BUY-LOC-FL
		FilterByRequestingLocation	is Boolean
			classic name is FIL-BUY-RQL-FL
		FilterItemsWithNoVendor		is Boolean
			classic name is FIL-VEN-OPTION
		FilterDeliveryDays			is Numeric size 3
			classic name is FIL-DEL-DAYS
		FilterFromPriority			is Numeric size 2
			classic name is FIL-FRM-PRI
		FilterToPriority			is Numeric size 2
			classic name is FIL-TO-PRI
		FilterItemsWithNoCost		is Boolean
			classic name is FIL-NO-COST
		FilterPOCode				is a POCode
			classic name is FIL-PO-CODE
		FilterManufacturer			is a Manufacturer
			classic name for FilterManufacturer.ManufacturerCode is FIL-MANUF-CODE
			classic name for FilterManufacturer.ManufacturerDivision is FIL-MANUF-DIV
		FilterContract				is a Contract
		FilterItemType				is AlphaUpper size 1
			classic name is FIL-ITEM-TYPE
			States
				Inventory value is "I"
				NonStock  value is "N"
				Special   value is "X"
				Service   value is "S"
		ManualOverrideAllowed		is Boolean
			classic name is MAN-OVER-ALWD
			default label is "ManualCostOverrideAllowed"
		OverrideContractCost		is Boolean
			classic name is OVER-AGRMT
		OverrideLastPOLastCost		is Boolean
			classic name is OVER-LC-LP
		RequireCommodityCode		is Boolean
			classic name is REQ-COMM-CODE
		UseProcurementCard			is Boolean
			classic name is P-CARD-FLAG
		ProcurementCardNumber
			classic name is PCARD-NBR
		OverrideProcurementCard		is Boolean
			classic name is OVER-PCARD
		OverrideSourcingCost		is Boolean
			classic name is OVER-SS
		GlobalLocationNumber
			classic name is GLN-NBR
		PurchaseOrderApprovalType
			classic name is APPROVAL-TYPE
		AllowToReleaseOverLimits	is Boolean
		AllowDisplayOfProcedureInfo	is Boolean
		BuyerPostalAddress			is a PostalAddressV2	
			holds pii
			classic name for BuyerPostalAddress.DeliveryAddress.AddressLine1 is ADDR1
			classic name for BuyerPostalAddress.DeliveryAddress.AddressLine2 is ADDR2
			classic name for BuyerPostalAddress.DeliveryAddress.AddressLine3 is ADDR3
			classic name for BuyerPostalAddress.DeliveryAddress.AddressLine4 is ADDR4
			classic name for BuyerPostalAddress.Municipality is CITY-ADDR5
			classic name for BuyerPostalAddress.StateProvince is STATE-PROV
			classic name for BuyerPostalAddress.PostalCode is POSTAL-CODE
		OverrideDocumentTemplate	is Boolean
			default label is "AllowOverride_ofDocumentTemplate"
		CanCreateCapitatedRequisition    is Boolean
		DefaultCapitatedRequester        is a Requester 
			default label is "DefaultRequester"

	Local Fields
		LocalProcurementGroup		is like ProcurementGroup
		LocalGroup					is like ItemGroup
		LocalPurchasingCompany		is like PurchasingCompany
		LocalMajorPurchasingClass	is like MajorPurchasingClass
		LocalMinorPurchasingClass	is like MinorPurchasingClass
		LocalShipToLocation			is like InventoryLocation
		LocalRequestingLocation		is like RequestingLocation
		LocalVendor					is like Vendor
		LocalPurchaseFromLocation	is like PurchaseFromLocation
		LocalBuyer                  is like Buyer
		LocalAcknowledgementResult	is like PurchaseOrderAcknowledgementResult
		ActionCode							is Alpha size 1
			States
				Create  value is "C"
				Update	value is "U"
				Delete	value is "D"
		LocalTitle 				is Alpha size 255
		NativeLPLBODTrigger							is Boolean			

		LocalNativeLPLBODTrigger		is Boolean
		LocalBodAccountingEntity		is AlphaUpper size 12
		LocalCrossAccountingEntity 		is Alpha 40
		LocalBODFormattedID				is Alpha 100
		LocalCleanDocIDAccountingentity 	is Alpha 40
		ContactMasterCleanDocXMLBOD		is XMLDocument
		NewBODTracker  					is a FSMInboundBODTracker view
		LocalFSMInboundBODTracker		is Numeric 15
		Error            				is Boolean
	    ErrorMessage     				is Alpha 300
	    LocalBODTrigger					is Boolean
	    LocalConfigurationParameter		is Alpha size up to 200
	    LocalSourceValue				is Alpha 30


	Derived Fields
		RepresentativeText is a StringField
			type is Text
			default label is "Buyer"
			Buyer " - " EmployeeRel.Name.PreferredFirstAndLastName

		Reference1CardView						is a LabelField
			"Reference1:<Reference1>"
		Reference1CardViewDisplay				is a DerivedField
			type is MessageField
			if (Reference1 entered)
				return Reference1CardView
			else
				return blank

		Reference2CardView						is a LabelField
			"Reference2:<Reference2>"
		Reference2CardViewDisplay				is a DerivedField
			type is MessageField
			if (Reference2 entered)
				return Reference2CardView
			else
				return blank

		DerivedBuyerIDName						is a MessageField
			default label is "Buyer"
			"<Buyer>_-_<EmployeeRel.Name.PreferredFirstAndLastName>"

		Name									is a DerivedField
			type is Alpha up to 230
			return EmployeeRel.PresentationNameSnapshot

		ContextMessageText is a MessageField
			restricted
			"Buyer<Buyer><Name>"

		NoAcknowledgementFiltersChoseMsg is a MessageField
			"IfNoFilterTypesAreChosenEveryAcknowledgementMessageWillBeDisplayed"

		EmailAddress		is a DerivedField
			type is like EmailAddress
			return EmployeeRel.EmployeeWorkEmailAddress

		PhoneNumber			is a DerivedField
			type is Alpha up to 100
			return EmployeeRel.EmployeeWorkTelephone

		PhoneNumberForPurchaseOrder is a DerivedField
			type is Alpha 100
			if (EmployeeRel.UseForWorkPhone.ContactDetail.Telephone entered)
				return EmployeeRel.UseForWorkPhone.ContactDetail.Telephone.InternationalPrefix + "-" + EmployeeRel.UseForWorkPhone.ContactDetail.Telephone.SubscriberNumber + "-" + EmployeeRel.UseForWorkPhone.ContactDetail.Telephone.Extension
			else
				return blank

		HROrganizationAndBuyer		is a StringField
			type is AlphaUpper 20
			HROrganization
			", "
			Buyer

		ActiveMessage		is a MessageField
			restricted
			"Active"
		InactiveMessage		is a MessageField
			restricted
			"Inactive"
		CreateMessage		is a LabelField
			restricted
			"CreateBuyer"
		BuyerMessage		is a LabelField
			restricted
			"<EmployeeRel.Name.PreferredFirstAndLastName>'sBuyerProfile"
		EmployeeInactiveMessage is a LabelField
			restricted
			"EmployeeInactive"

		DerivedFormTitle	is a DerivedField
			type is MessageField
			if (RecordExists)
				return BuyerMessage
			else
				return CreateMessage

		BuyerStatus			is a DerivedField
			type is Text
			if (Active)
				return ActiveMessage
			else
				return InactiveMessage

		DerivedStatusDisplay is a DerivedField
			type is Alpha size 19
			default label is "Status"
			if (Active)
				if (!Buyer.Employee.IsActive)
					return EmployeeInactiveMessage
				else
					return ActiveMessage
			else
				return InactiveMessage

		BlankField is a DerivedField
			type is Alpha 1
			return blank

		ContextMessageEntityType is a StringField
			type is Alpha 30
			restricted
			"InforPerson"


		BuyerActor is a DerivedField
			type is Actor
			restricted
			return first ActorRel.Actor



		DerivedDelimiter is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "Generic_Delimiter"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "tenantID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "releaseID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "logicalID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "VersionID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedappProdline is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "appProdline"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		BODCurrentTimeStamp is a DerivedField
			type is TimeStamp
			restricted
			BODCurrentTimeStamp = system current timestamp
			return BODCurrentTimeStamp

		AlphaCurrentTimeStamp is a DerivedField
			type is Alpha size 20
			restricted
			return BODCurrentTimeStamp

		BODFormattedCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			return AlphaCurrentTimeStamp[1:4] + "-" + AlphaCurrentTimeStamp[5:6] + "-" + AlphaCurrentTimeStamp[7:8] + "T" + AlphaCurrentTimeStamp[9:10] + ":" + AlphaCurrentTimeStamp[11:12] + ":" + AlphaCurrentTimeStamp[13:14] + "Z"

		DerivedBODFEG is a DerivedField
			type is AlphaUpper size 4
			restricted
			return ProcurementGroup.BusinessGroup.FinanceEnterpriseGroup

		DerivedMultipleFEG is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IsMultipleFEG"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedCleanDocumentID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "RequiredCleanDocumentID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedTriggerBODBasedOnCrossReference is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "TriggerBODBasedOnCrossReference"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedDocumentID is a DerivedField
			type is AlphaUpper size 25
			restricted
			if(DerivedCleanDocumentID = "Y")
				return DerivedBuyer
			else
				return ProcurementGroup + DerivedDelimiter + DerivedBuyer

		DerivedVariationID is a DerivedField
			type is Alpha size 25
			restricted
			return bod id.VariationID

		DerivedBODaccountingEntity is a DerivedField
			type is Alpha size 25
			restricted
			return DerivedBODFEG + DerivedDelimiter + ProcurementGroup

		DerivedBODrevision is a DerivedField
			type is Alpha size 25
			restricted
			return ""

		DerivedBODlocation is a DerivedField
			type is Alpha size 25
			restricted
			return ""

		DerivedbodID is a DerivedField
			type is Alpha size 100
			restricted
			return "infor-nid:"+DerivedTenantID+":"+DerivedBODaccountingEntity+":"+DerivedBODlocation+":"+DerivedDocumentID+":"+DerivedBODrevision+"?ContactMaster&verb=Sync&TrackerID=" + LocalFSMInboundBODTracker

		DerivedBuyer is a DerivedField
			type is Alpha size 13
			restricted
			return Buyer using "%d"

		DerivedstatusCode is a DerivedField
		 	type is Alpha size 10
		 	restricted
			if (action type.Delete or ActionCode.Delete)
				return "Deleted"
			else
		 	if (action type.Create or action type.Update)
		 		if(Active = "true")
		 			return "Open"
		 		else
		 			return "Closed"
		 	else
				return ""

		DerivedBODActionCode is a DerivedField
			type is Alpha 10
			restricted
			if (action type.Create or ActionCode.Create)
				return "Add"
			else
			if (action type.Update or action type.Delete or ActionCode.Update or ActionCode.Delete)
				return "Replace"
			else
				return ""

		DerivedTempEmployeeName is a DerivedField
			type is Alpha size 230
			restricted
			return EmployeeRel.PresentationNameSnapshot

		DerivedInternationalPrefix is a DerivedField
			type is Alpha size 23
			restricted
			return EmployeeRel.UseForWorkPhone.ContactDetail.Telephone.InternationalPrefix

		DerivedSubscriberNumber is a DerivedField
			type is Alpha size 23
			restricted
			return EmployeeRel.UseForWorkPhone.ContactDetail.Telephone.SubscriberNumber

		DerivedExtension is a DerivedField
			type is Alpha size 23
			restricted
			return EmployeeRel.UseForWorkPhone.ContactDetail.Telephone.Extension

		DerivedAddressLine1 is a DerivedField
			type is Alpha size 40
			restricted
			return EmployeeRel.UseForMailing.PostalAddress.DeliveryAddress.AddressLine1

		DerivedAddressLine2 is a DerivedField
			type is Alpha size 40
			restricted
			return EmployeeRel.UseForMailing.PostalAddress.DeliveryAddress.AddressLine2

		DerivedAddressLine3 is a DerivedField
			type is Alpha size 40
			restricted
			return EmployeeRel.UseForMailing.PostalAddress.DeliveryAddress.AddressLine3

		DerivedAddressLine4 is a DerivedField
			type is Alpha size 40
			restricted
			return EmployeeRel.UseForMailing.PostalAddress.DeliveryAddress.AddressLine4

		DerivedMunicipality is a DerivedField
			type is Alpha size 40
			restricted
			return EmployeeRel.UseForMailing.PostalAddress.Municipality

		DerivedStateProvince is a DerivedField
			type is AlphaUpper size 3
			restricted
			return EmployeeRel.UseForMailing.PostalAddress.StateProvince

		DerivedCountry is a DerivedField
			type is AlphaUpper size 3
			restricted
			return EmployeeRel.UseForMailing.PostalAddress.Country

		DerivedPostalCode is a DerivedField
			type is Alpha size 12
			restricted
			return EmployeeRel.UseForMailing.PostalAddress.PostalCode

		DerivedEmailAddress is a DerivedField
			type is Alpha size 300
			restricted
			return	EmployeeRel.UseForWorkEmail.ContactDetail.EmailAddress

		ContactMasterPOXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			ContactMasterPOXMLBOD = template.IONContactMasterPOXML_ST document for this instance

		DerivedBuyerNameID is a DerivedField
			type is Alpha up to 246
			default label is "Buyer"
			return Name + " (" + Buyer + ")"

		DisplayBuyerName is a MessageField
			"<Buyer>_-_<Name>"

		AcknowledgementLinkback	is a MessageField
			restricted
			"<linkback(webapp is Buyer navigation is AcknowledgementNav text is \"here\")>"



		DerivedBODCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			DerivedBODCurrentTimeStamp = current timestamp
			return DerivedBODCurrentTimeStamp[1:4] + "-" + DerivedBODCurrentTimeStamp[5:6] + "-" + DerivedBODCurrentTimeStamp[7:8] + "T" + DerivedBODCurrentTimeStamp[9:10] + ":" + DerivedBODCurrentTimeStamp[11:12] + ":" + DerivedBODCurrentTimeStamp[13:14] + "Z"

		DerivedPersonBodID is a DerivedField
			type is Alpha size 100
			restricted
			return "infor-nid:" + DerivedTenantID + ":" + DerivedBODaccountingEntity + "::" + DerivedDocumentID + ":" + "?Person&verb=Sync&TrackerID=" + LocalFSMInboundBODTracker

		DerivedCurrency is a DerivedField
			type is AlphaUpper size 5
			restricted
			return ProcurementGroup.Currency

		DerivedStatusCode is a DerivedField
			type is Alpha size 7
			restricted
			if (action type.Create or action type.Update)
				return "Open"
			if (action type.Delete)
				return "Deleted"

		SyncPersonXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			SyncPersonXMLBOD = template.IONSyncPerson_Buyer_ST document for this instance
			return SyncPersonXMLBOD

		PurchaseOrdersForBuyerThisMonthCount is a DerivedField
			type is Numeric 4
			return instance count of PurchaseOrdersForBuyerThisMonthRel

		POBuyerMessagesForBuyerCount is a DerivedField
			type is Numeric 4
			return instance count of POBuyerMessagesForBuyerRel

		OpenInvoiceMessagesCount is a DerivedField
			type is Numeric 4
			return instance count of OpenInvoiceMessagesRel


	Conditions
		RecordExists
			restricted
			when (Buyer exists)

		IsActive
			restricted
			when (Active)

		HasBuyerGroup
			restricted
			classic name is BUYERGRP
			when (BuyerGroup entered)

		HasGlobalLocationNumber
			restricted
			classic name is HAS-GLN-NBR
			when (GlobalLocationNumber entered)

		IsInactive
			restricted
			when (not Active)

		HasOperatorID
			restricted
			classic name is OPER-EXISTS
			when (OperatorID entered)

		NeedsACalendar
			restricted
			when (!BasicAnalyticsCalendarsRel exists)

		BypassRuleForTheseFiles
			restricted
			when (parentcontext.name = "MatchInvoiceMessage")

		ActiveEmployee
			restricted
			when (Active
			and	  Buyer.Employee.IsActive)

		POBuyerMessagesForBuyerExist
			restricted
			when (POBuyerMessagesForBuyerRel exists)

		PurchaseOrderInterfaceExists
			restricted
			when (PurchaseOrderInterfaceRel exists)

		PurchaseOrdersForBuyerExists
			restricted
			when (PurchaseOrdersForBuyerRel exists)

		PurchaseOrderLinesForBuyerExists
			restricted
			when (PurchaseOrderLinesForBuyerRel exists)

	Relations
		GlnlocdtlRel
			one-to-one relation to GlobalLocationNumberDetail
			valid when (HasGlobalLocationNumber)
			Field Mapping uses Set3
				related.ItemGroup                                           = ProcurementGroup
				related.GlobalLocationNumberDetail.GlobalLocationNumberType = 12
				related.Buyer                                               = Buyer
				related.GlobalLocationNumber                                = GlobalLocationNumber

		BuyerPurchasingClassesForBuyerRel is a BuyerPurchasingClass set

		AcknowledgementsNeedingActionRel
			one-to-many relation to PurchaseOrderAcknowledgementMessage
			Field Mapping uses ByAcknowledgementResult
				related.AcknowledgementResult         = LocalAcknowledgementResult
			Instance Selection
				where (related.Buyer   = LocalBuyer
				and    related.MessageNeedingAction)

		DuplicateOperatorIDRel
			one-to-many relation to Buyer
			Field Mapping uses Set3
				related.HROrganization	= HROrganization
				related.OperatorID		= OperatorID
			Instance Selection
				where (related.Buyer != Buyer)

		PurchaseOrdersForBuyerRel is a PurchaseOrder set
			Instance Selection
				where (related.IsValidForActorContext)

		PurchaseOrdersForBuyerThisMonthRel is a PurchaseOrder set
			Instance Selection
				where (related.IsValidForActorContext
					and related.PurchaseOrderDate > current date - 30 days)

		PurchaseOrderLinesForBuyerRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsValidForActorContext)

		POBuyerMessagesForBuyerRel is a PurchaseOrderBuyerMessage set

		OpenInvoiceMessagesRel
			one-to-many relation to MatchInvoiceMessage
			Field Mapping uses symbolic key
			Instance Selection
				where (related.Buyer = Buyer
				and !related.PayablesInvoice.InterfaceInProcess
				and related.Status != 9)

		PurchaseOrderInterfaceRel is a PurchaseOrderInterface set
			Instance Selection
				where (related.IsValidForActorContext)

		InventoryCompanyRel
			one-to-one relation to InventoryCompany
			Field Mapping uses symbolic key
				related.Company		= LocalPurchasingCompany

		ValidBuyerPurchasingClassesForBuyerRel
			one-to-many relation to BuyerPurchasingClass
			Field Mapping uses symbolic key
				related.HROrganization								= HROrganization
				related.Buyer										= Buyer
				related.ItemGroup									= LocalGroup
			Instance Selection
				where (related.BuyerPurchasingClass.MajorPurchasingClass  = LocalMajorPurchasingClass
				and    (related.BuyerPurchasingClass.MinorPurchasingClass = blank
				or      related.BuyerPurchasingClass.MinorPurchasingClass = LocalMinorPurchasingClass))

		BuyerLocationsForBuyerRel is a BuyerLocation set

		BuyerLocationsForBuyerAndCompanyRel
			one-to-many relation to BuyerLocation
			Field Mapping uses symbolic key
				related.HROrganization	= HROrganization
				related.Buyer			= Buyer
				related.Company			= LocalPurchasingCompany

		ValidRequestingBuyerLocationsForBuyerAndCompanyRel
			one-to-many relation to BuyerLocation
			Field Mapping uses symbolic key
				related.HROrganization	= HROrganization
				related.Buyer			= Buyer
				related.Company			= LocalPurchasingCompany
			Instance Selection
				where (related.RequestingLocation entered)

		MatchingRequestingBuyerLocationsForBuyerAndCompanyRel
			one-to-many relation to BuyerLocation
			Field Mapping uses symbolic key
				related.HROrganization	= HROrganization
				related.Buyer			= Buyer
				related.Company			= LocalPurchasingCompany
			Instance Selection
				where (related.RequestingLocation = LocalRequestingLocation
				or     (related.RequestingLocation = blank
				and     related.Location = blank))

		PORevisionsForABuyerRel
			one-to-many relation to PurchaseOrderRevision
			Field Mapping uses ByBuyer
				related.Buyer           = Buyer

		ValidShipToBuyerLocationsForBuyerAndCompanyRel
			one-to-many relation to BuyerLocation
			Field Mapping uses symbolic key
				related.HROrganization	= HROrganization
				related.Buyer			= Buyer
				related.Company			= LocalPurchasingCompany
			Instance Selection
				where (related.Location entered)

		MatchingShipToBuyerLocationsForBuyerAndCompanyRel
			one-to-many relation to BuyerLocation
			Field Mapping uses symbolic key
				related.HROrganization	= HROrganization
				related.Buyer			= Buyer
				related.Company			= LocalPurchasingCompany
			Instance Selection
				where (related.Location = LocalShipToLocation
				or     (related.Location = blank
				and     related.RequestingLocation = blank))

		BuyerVendorsForBuyerRel is a BuyerVendor set

		ValidVendorsForBuyerRel
			one-to-many relation to BuyerVendor
			Field Mapping uses symbolic key
				related.HROrganization						= HROrganization
				related.Buyer								= Buyer
				related.VendorGroup							= ProcurementGroup
			Instance Selection
				where (related.BuyerVendor.Vendor			= LocalVendor)

		ValidBuyerVendorsForBuyerRel
			one-to-many relation to BuyerVendor
			Field Mapping uses symbolic key
				related.HROrganization						= HROrganization
				related.Buyer								= Buyer
				related.VendorGroup							= ProcurementGroup
			Instance Selection
				where (related.BuyerVendor.Vendor				 = LocalVendor
				and    (related.BuyerVendor.PurchaseFromLocation = blank
				or      related.BuyerVendor.PurchaseFromLocation = LocalPurchaseFromLocation))

		PurchaseOrderAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PurchaseOrder"

		PurchaseOrderLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PurchaseOrderLine"

		PurchaseOrderLineDistributionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PurchaseOrderLineDistribution"

		VendorReturnAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "VendorReturn"

		VendorReturnLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "VendorReturnLine"

		MatchInvoiceMessageAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "MatchInvoiceMessage"

		RequisitionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "Requisition"

		RequisitionLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "RequisitionLine"

		RequisitionLineDistributionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "RequisitionLineDistribution"

		InventoryTransactionLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "InventoryTransactionLine"

		InventoryUsageHistoryAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "InventoryUsageHistory"

		ItemLocationAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "ItemLocation"

		PayablesInvoiceDistributionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PayablesInvoiceDistribution"

		PayablesInvoicePaymentAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PayablesInvoicePayment"

		BasicAnalyticsCalendarsRel 		is a BasicAnalyticsCalendar set

		EmployeeRel
			one-to-one relation to Employee
			Field Mapping uses symbolic key
				related.HROrganization			= HROrganization
				related.Employee				= Buyer


		ActorRel is an Actor set												
			Instance Selection
				where (related.Actor = Buyer.Employee.agent(Actor).Actor)




		FSMBODConfigurationParameterRel
        	one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
            	related.FSMBODConfigurationParameter 		= LocalConfigurationParameter

		FSMBODConfigurationRel
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 1
				related.FSMBODConfiguration.Noun 		= "ContactMaster"
				related.FSMBODConfiguration.Direction 	= 1

		FSMBODGeneralLedgerCompanyRel
	   		one-to-many relation to GeneralLedgerCompany
	   		Field Mapping uses symbolic key
	   		Instance Selection
				where(related.BusinessGroup  = ProcurementGroup)

		FSMBODAECrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "CSFGLC"
            	related.FSMBODCrossReference.DestinationField 	= "DESTAE"
            Instance Selection
				where (related.SourceValue	= LocalCleanDocIDAccountingentity )
				
		FSMCleanDocIDGLCCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
				related.FSMBODCrossReference.SourceField 		= "CSFGLC"
				related.FSMBODCrossReference.DestinationField 	= "DESTAE"
				
		FSMCleanDocIDGeneralLedgerCompanyRel
            one-to-one relation to GeneralLedgerCompany
            required
            Field Mapping uses symbolic key
                related.Company = LocalBodAccountingEntity


		FSMBODConfigurationSyncPersonRel
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 1
				related.FSMBODConfiguration.Noun 		= "Person"
				related.FSMBODConfiguration.Direction 	= 1

		FSMInboundBODTrackerRel
            one-to-one relation to FSMInboundBODTracker
            Field Mapping uses symbolic key
                related.FSMInboundBODTracker	= LocalFSMInboundBODTracker


	Sets

		Set2
			indexed
			Sort Order
				HROrganization
				BuyerGroup
				Buyer

		Set3
			indexed
			Instance Selection
				where (HasOperatorID)
			Sort Order
				HROrganization
				OperatorID
	Rule Blocks
		TriggerContactMasterPOServiceRules
			LocalTitle = "HO:"+HROrganization+" Buyer:"+Buyer
			increment bod id.VariationID
			trigger "ContactMasterPOService" PA service
				resume on error
				title is "<LocalTitle>"
				Criteria
					HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup
					LocalPurchasingCompany
				Variables
					ActionCode
					include persistent fields from Buyer
					include persistent fields from Buyer.UseForMailing
					include persistent fields from Buyer.UseForWorkPhone
					include persistent fields from Buyer.UseForWorkEmail
					bod id.VariationID
				  		variable name is VariationId
				  	ProcurementGroup.BusinessGroup.FinanceEnterpriseGroup
						variable name is FinanceEnterpriseGroup
					ProcurementGroup.Currency
						variable name is Currency
					EmployeeRel.PresentationNameSnapshot
								variable name is PresentationNameSnapshot

		TriggerPersonServiceRules
			trigger "PersonService" PA service
				resume on error
				title is "<LocalTitle>"
				Criteria
					HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup
					LocalPurchasingCompany
				Variables
					ActionCode
					include persistent fields from Buyer
					include persistent fields from Buyer.UseForMailing
					include persistent fields from Buyer.UseForWorkPhone
					include persistent fields from Buyer.UseForWorkEmail
					bod id.VariationID
				  		variable name is VariationId
				  	ProcurementGroup.BusinessGroup.FinanceEnterpriseGroup
						variable name is FinanceEnterpriseGroup
					ProcurementGroup.Currency
						variable name is Currency
	Field Rules

		ProcurementGroup

			constraint (ProcurementGroup.FinanceEnterpriseGroup.HROrganization = HROrganization)
				"FinanceEnterpriseGroupAssociatedWithProcurementGroupDoesNotUseEnteredHROrganization"

		Active
			initial value is true























		RestrictPurchasingClasses

			constraint (BuyerPurchasingClassesForBuyerRel exists)
				"CannotRestrictPurchasingClasses;PurchasingClassesNotAssigned"


		FilterFromPriority
			if (FilterToPriority entered)
				required
					"MustEnterBothEndsOfThePriorityRange"                     

		FilterToPriority
			if (FilterFromPriority entered)
				required
					"MustEnterBothEndsOfThePriorityRange"                     

			constraint (FilterToPriority > FilterFromPriority)
				"FromPriorityMustBeLessThan_\ToPriority"                   

		CanCreateCapitatedRequisition 
			if (CanCreateCapitatedRequisition)
				constraint (AllowDisplayOfProcedureInfo)
					"If_Can_Create_Capitated_RequisitionIsSelected,_Allow_Display_Of_Procedure_InformationMustAlsoBeSelected"
				if (!Buyer.Employee.RequesterExists)
					constraint (DefaultCapitatedRequester entered)
						"DefaultRequesterIsRequired"
			if (!CanCreateCapitatedRequisition)
				initialize DefaultCapitatedRequester

		PurchaseOrderApprovalType
			if (PurchaseOrderApprovalType.MatrixLineDistribution)
				constraint (HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup.EnableResponsibilityMatrix)
					"CannotSetTo_Matrix_Line_DistributionWhenThe_Finance_Enterprise_GroupDoesNotHaveThe_Responsibility_MatrixTurnedOn"

	Attach Rules
		if (parentcontext.name = "CrossReferenceVendor"
		or  parentcontext.name = "PayablesAuthorizedBuyer"
		or  parentcontext.name = "GlobalLocationNumberDetail"
		or  parentcontext.name = "ItemLocation"
		or  parentcontext.name = "PlannedOrder"
		or  parentcontext.name = "BuyerLocation"
		or  parentcontext.name = "BuyerPurchasingClass"
		or  parentcontext.name = "BuyerVendor"
		or  parentcontext.name = "Contract"
		or  parentcontext.name = "ProcurementTemplate"
		or  parentcontext.name = "PurchaseFromLocation"
		or  parentcontext.name = "PurchaseOrderInterface"
		or  parentcontext.name = "PurchaseOrder"
		or  parentcontext.name = "PurchaseOrderLine"
		or  parentcontext.name = "PurchasingVendor"
		or  parentcontext.name = "RequestingLocation"
		or  parentcontext.name = "Requisition"
		or  parentcontext.name = "RequisitionLine"
		or  parentcontext.name = "SourcingEvent")
			constraint (Active)
				"Buyer<Buyer>MustBeActive"





	Actions
		Create is a Create Action

			Field Rules

				Active
					default to true

		Update is an Update Action

		Delete is a Delete Action
			Entrance Rules
				if (HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup.BODTrigger)
					ActionCode = ActionCode.Delete
					include TriggerContactMasterPOServiceRules





				if (HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup.BODTrigger)
					ActionCode = ActionCode.Delete
					LocalTitle = "HO:"+HROrganization+" Buyer:"+Buyer
					increment bod id.VariationID
			   		include TriggerPersonServiceRules

		
		SendPersonNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				send ion bod
					bod is SyncPersonXMLBOD
					bod type is "Sync.Person"
					document id is  DerivedDocumentID
					variation id is DerivedVariationID
					accounting entity is DerivedBODaccountingEntity
		
		TriggerPersonNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationSyncPersonRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "Person"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "Buyer"
					invoked.PrmFinanceEnterpriseGroup	= ProcurementGroup.BusinessGroup.FinanceEnterpriseGroup
					invoked.PrmMainUserTemplate 		= "IONSyncPerson_Buyer_ST"
				LocalNativeLPLBODTrigger = FSMBODConfigurationSyncPersonRel.NativeLPLBODTrigger
				LocalBODTrigger 		 = true
				if(HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
					if(FSMInboundBODTracker not entered)
						invoke Create FSMInboundBODTracker
							assign result to NewBODTracker
							invoked.Verb 					= 1
							invoked.Noun 					= "Person"					
							invoked.BODDocumentID			= DerivedDocumentID
							invoked.BODVariationID			= DerivedVariationID
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.FinanceEnterpriseGroup	= ProcurementGroup.BusinessGroup.FinanceEnterpriseGroup
							invoked.Direction				= 1
							invoked.BODAccountingEntity		= DerivedBODaccountingEntity
							invoked.Reference1				= HROrganization
							invoked.Reference2				= Buyer
							initialize invoked.Error			
							initialize invoked.ErrorMessage					
						LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
					else 
						LocalFSMInboundBODTracker		= FSMInboundBODTracker
						invoke Update FSMInboundBODTrackerRel
							invoked.FinanceEnterpriseGroup	= ProcurementGroup.BusinessGroup.FinanceEnterpriseGroup
							invoked.BODDocumentID			= DerivedDocumentID
							invoked.BODVariationID			= DerivedVariationID
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.Direction				= 1
							invoked.BODAccountingEntity		= DerivedBODaccountingEntity
							invoked.Reference1				= HROrganization
							invoked.Reference2				= Buyer
							initialize invoked.Error			
							initialize invoked.ErrorMessage
					invoke SendPersonNativeLPL
						resume on error
	                   		Error            							= true
	                        ErrorMessage     							= error message
	                if(Error)
						invoke Update FSMInboundBODTrackerRel
							invoked.Error 								= Error
							invoked.ErrorMessage 						= ErrorMessage
							invoked.Status								= 2
							invoked.CloseDate							= system current timestamp
							invoked.BODID								= DerivedPersonBodID
							invoked.BODXML								= SyncPersonXMLBOD
					else
						invoke Update FSMInboundBODTrackerRel
							invoked.Status								= 3
							invoked.CloseDate							= system current timestamp
							invoked.BODID								= DerivedPersonBodID
							invoked.BODXML								= SyncPersonXMLBOD	

		SendContactMasterPONativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				if(DerivedCleanDocumentID = "Y")
					send ion bod
						bod is ContactMasterCleanDocXMLBOD
						bod type is "Sync.ContactMaster"
						accounting entity is LocalCrossAccountingEntity
						document id is DerivedDocumentID
						variation id is DerivedVariationID
				else
					send ion bod
						bod is ContactMasterPOXMLBOD
						bod type is "Sync.ContactMaster"
						accounting entity is DerivedBODaccountingEntity
						document id is DerivedDocumentID
						variation id is DerivedVariationID
		
		TriggerContactMasterPONativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
				RestartFlag 	is Boolean
			Action Rules
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "ContactMaster"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "Buyer"
					invoked.PrmFinanceEnterpriseGroup	= ProcurementGroup.BusinessGroup.FinanceEnterpriseGroup
					invoked.PrmMainUserTemplate 		= "IONContactMasterPOXML_ST"
				NativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger
				LocalBODTrigger = true
				if (HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup.BODTrigger and NativeLPLBODTrigger )
					if(DerivedCleanDocumentID = "Y")
						if(RestartFlag)
							if (FSMBODGeneralLedgerCompanyRel exist)
								initialize LocalBodAccountingEntity
								initialize LocalCleanDocIDAccountingentity
								initialize ContactMasterCleanDocXMLBOD
								initialize LocalCrossAccountingEntity
								initialize LocalBODFormattedID
								LocalBodAccountingEntity = FSMInboundBODTracker.Reference4	
								if(DerivedMultipleFEG = "Y")
									LocalCleanDocIDAccountingentity = DerivedBODFEG + DerivedDelimiter + LocalBodAccountingEntity
								else
									LocalCleanDocIDAccountingentity = LocalBodAccountingEntity
								if(DerivedTriggerBODBasedOnCrossReference = "Y")
									if (FSMBODAECrossReferenceDetailRel.DestinationValue entered)
										LocalCrossAccountingEntity = FSMBODAECrossReferenceDetailRel.DestinationValue
								else
									LocalCrossAccountingEntity = LocalCleanDocIDAccountingentity
								if(LocalCrossAccountingEntity entered)
									LocalFSMInboundBODTracker		= FSMInboundBODTracker
									invoke Update FSMInboundBODTrackerRel
										invoked.FinanceEnterpriseGroup	= DerivedBODFEG
										invoked.BODDocumentID			= DerivedDocumentID
										invoked.BODVariationID			= DerivedVariationID
										invoked.Status					= 1
										invoked.StartDate				= system current timestamp
										invoked.Direction				= 1
										invoked.BODAccountingEntity		= LocalCrossAccountingEntity
										invoked.Reference1				= HROrganization
										invoked.Reference2				= Buyer
										invoked.Reference3				= "Buyer"
										invoked.Reference4				= LocalBodAccountingEntity
										initialize invoked.Error			
										initialize invoked.ErrorMessage
								LocalBODFormattedID = "infor-nid:"+DerivedTenantID+":"+LocalCrossAccountingEntity+":"+DerivedBODlocation+":"+DerivedDocumentID+":"+DerivedBODrevision+"?ContactMaster&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
								ContactMasterCleanDocXMLBOD = template.IONContactMasterPOXML_CleanDoc_ST document for this instance	
								invoke SendContactMasterPONativeLPLBOD
									resume on error
										Error            							= true
										ErrorMessage     							= error message
								if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 								= Error
										invoked.ErrorMessage 						= ErrorMessage
										invoked.Status								= 2
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= LocalBODFormattedID
										invoked.BODXML								= ContactMasterCleanDocXMLBOD
								else
									invoke Update FSMInboundBODTrackerRel
										invoked.Status								= 3
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= LocalBODFormattedID
										invoked.BODXML								= ContactMasterCleanDocXMLBOD	
						else
						if(DerivedTriggerBODBasedOnCrossReference = "Y")
							if(FSMCleanDocIDGLCCrossReferenceDetailRel exists)
								for each FSMCleanDocIDGLCCrossReferenceDetailRel
									initialize LocalSourceValue
									initialize LocalCrossAccountingEntity
									initialize LocalBODFormattedID
									initialize ContactMasterCleanDocXMLBOD
									initialize LocalBodAccountingEntity
									LocalSourceValue = each.SourceValue
									if (LocalSourceValue entered)
										for each LocalSourceValue split on "<DerivedDelimiter>"
											initialize LocalBodAccountingEntity
											LocalBodAccountingEntity = each
									if(FSMCleanDocIDGeneralLedgerCompanyRel exists)
										LocalCrossAccountingEntity = each.DestinationValue
										if(LocalCrossAccountingEntity entered)
											if(FSMInboundBODTracker not entered)
												invoke Create FSMInboundBODTracker
													assign result to NewBODTracker
													invoked.Verb 					= 1
													invoked.Noun 					= "ContactMaster"					
													invoked.BODDocumentID			= DerivedDocumentID
													invoked.BODVariationID			= DerivedVariationID
													invoked.Status					= 1
													invoked.StartDate				= system current timestamp
													invoked.FinanceEnterpriseGroup	= DerivedBODFEG
													invoked.Direction				= 1
													invoked.BODAccountingEntity		= LocalCrossAccountingEntity
													invoked.Reference1				= HROrganization
													invoked.Reference2				= Buyer
													invoked.Reference3				= "Buyer"
													invoked.Reference4				= LocalBodAccountingEntity
													initialize invoked.Error			
													initialize invoked.ErrorMessage					
												LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
											LocalBODFormattedID = "infor-nid:"+DerivedTenantID+":"+LocalCrossAccountingEntity+":"+DerivedBODlocation+":"+DerivedDocumentID+":"+DerivedBODrevision+"?ContactMaster&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
											ContactMasterCleanDocXMLBOD = template.IONContactMasterPOXML_CleanDoc_ST document for this instance
											invoke SendContactMasterPONativeLPLBOD
												resume on error
													Error            							= true
													ErrorMessage     							= error message
											if(Error)
												invoke Update FSMInboundBODTrackerRel
													invoked.Error 								= Error
													invoked.ErrorMessage 						= ErrorMessage  
													invoked.Status								= 2
													invoked.CloseDate							= system current timestamp
													invoked.BODID								= LocalBODFormattedID
													invoked.BODXML								= ContactMasterCleanDocXMLBOD
											else
												invoke Update FSMInboundBODTrackerRel
													invoked.Status								= 3
													invoked.CloseDate							= system current timestamp
													invoked.BODID								= LocalBODFormattedID
													invoked.BODXML								= ContactMasterCleanDocXMLBOD	
						else
						if(DerivedTriggerBODBasedOnCrossReference = "N")
							if (FSMBODGeneralLedgerCompanyRel exist)
								for each FSMBODGeneralLedgerCompanyRel
									initialize LocalBodAccountingEntity
									initialize LocalCrossAccountingEntity
									initialize ContactMasterCleanDocXMLBOD
									initialize LocalBODFormattedID
									LocalBodAccountingEntity = each.Company
									if(DerivedMultipleFEG = "Y")
										LocalCrossAccountingEntity = DerivedBODFEG + DerivedDelimiter + LocalBodAccountingEntity
									else
										LocalCrossAccountingEntity = LocalBodAccountingEntity
									if(LocalCrossAccountingEntity entered)
										if(FSMInboundBODTracker not entered)
											invoke Create FSMInboundBODTracker
												assign result to NewBODTracker
												invoked.Verb 					= 1
												invoked.Noun 					= "ContactMaster"					
												invoked.BODDocumentID			= DerivedDocumentID
												invoked.BODVariationID			= DerivedVariationID
												invoked.Status					= 1
												invoked.StartDate				= system current timestamp
												invoked.FinanceEnterpriseGroup	= DerivedBODFEG
												invoked.Direction				= 1
												invoked.BODAccountingEntity		= LocalCrossAccountingEntity
												invoked.Reference1				= HROrganization
												invoked.Reference2				= Buyer
												invoked.Reference3				= "Buyer"
												invoked.Reference4				= LocalBodAccountingEntity
												initialize invoked.Error			
												initialize invoked.ErrorMessage					
											LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
										LocalBODFormattedID = "infor-nid:"+DerivedTenantID+":"+LocalCrossAccountingEntity+":"+DerivedBODlocation+":"+DerivedDocumentID+":"+DerivedBODrevision+"?ContactMaster&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
										ContactMasterCleanDocXMLBOD = template.IONContactMasterPOXML_CleanDoc_ST document for this instance
										invoke SendContactMasterPONativeLPLBOD
											resume on error
												Error            							= true
												ErrorMessage     							= error message
										if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage  
												invoked.Status								= 2
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= LocalBODFormattedID
												invoked.BODXML								= ContactMasterCleanDocXMLBOD
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status								= 3
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= LocalBODFormattedID
												invoked.BODXML								= ContactMasterCleanDocXMLBOD	
					else
						if(FSMInboundBODTracker not entered)
							invoke Create FSMInboundBODTracker
								assign result to NewBODTracker
								invoked.Verb 					= 1
								invoked.Noun 					= "ContactMaster"					
								invoked.BODDocumentID			= DerivedDocumentID
								invoked.BODVariationID			= DerivedVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.FinanceEnterpriseGroup	= DerivedBODFEG
								invoked.Direction				= 1
								invoked.BODAccountingEntity		= DerivedBODaccountingEntity
								invoked.Reference1				= HROrganization
								invoked.Reference2				= Buyer
								invoked.Reference3				= "Buyer"
								initialize invoked.Error			
								initialize invoked.ErrorMessage					
							LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
						else
							LocalFSMInboundBODTracker		= FSMInboundBODTracker
							invoke Update FSMInboundBODTrackerRel
								invoked.FinanceEnterpriseGroup	= DerivedBODFEG
								invoked.BODDocumentID			= DerivedDocumentID
								invoked.BODVariationID			= DerivedVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.Direction				= 1
								invoked.BODAccountingEntity		= DerivedBODaccountingEntity
								invoked.Reference1				= HROrganization
								invoked.Reference2				= Buyer
								invoked.Reference3				= "Buyer"
								initialize invoked.Error			
								initialize invoked.ErrorMessage
						invoke SendContactMasterPONativeLPLBOD
							resume on error
								Error            							= true
								ErrorMessage     							= error message
						if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 								= Error
								invoked.ErrorMessage 						= ErrorMessage
								invoked.Status								= 2
								invoked.CloseDate							= system current timestamp
								invoked.BODID								= DerivedbodID
								invoked.BODXML								= ContactMasterPOXMLBOD
						else
							invoke Update FSMInboundBODTrackerRel
								invoked.Status								= 3
								invoked.CloseDate							= system current timestamp
								invoked.BODID								= DerivedbodID
								invoked.BODXML								= ContactMasterPOXMLBOD	


		SendAcknowledgementEmailToBuyers is a Set Action
			restricted

			Parameters
				PurchaseOrderAcknowledgementResult is like PurchaseOrderAcknowledgementResult

			Action Rules

				Instance Rules

					LocalAcknowledgementResult 				= PurchaseOrderAcknowledgementResult
					LocalBuyer                              = Buyer
					if (AcknowledgementsNeedingActionRel exists)

						send email
							to Buyer.EmailAddress
							from config.DefaultFromEmailAddress
							subject "NewPurchaseOrderAcknowledgementsExist"
							Contents
								"YouHaveNewPurchaseOrderAcknowledgementsToView"
								"Click<AcknowledgementLinkback>ToViewTheAcknowledgementDetails"

		UpdateGlobalLocationNumber is an Instance Action
			restricted
			Parameters
				PrmItemGroup			is an ItemGroup
				PrmGlobalLocationNumber	is a GlobalLocationNumber
			Action Rules
				GlobalLocationNumber	=	PrmGlobalLocationNumber

		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmAccountingEntity  is Alpha size 22
					default label is "AccountingEntity"
				PrmLocation          is Alpha size 22
					default label is "Location"
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmRevision          is Alpha size 22
					default label is "Revision"
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"
				PrmVariationID       is Alpha size 22
					default label is "VariationID"
			Action Rules
				if (bod id.AccountingEntity != PrmAccountingEntity)
					bod id.AccountingEntity 	= PrmAccountingEntity
				if (bod id.Location != PrmLocation)
					bod id.Location				= PrmLocation
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.Revision != PrmRevision)
					bod id.Revision				= PrmRevision
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord



		EditValidateMethodsForBuyer is an Instance Action  
			restricted
			refresh and lock this instance
			Parameters
				PrmPurchasingCompany			is a PurchasingCompany
				PrmShipToLocation				is like InventoryLocation
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is like PurchaseFromLocation
				PrmMajorPurchasingClass			is a MajorPurchasingClass
				PrmMinorPurchasingClass			is a MinorPurchasingClass
				PrmItemType						is like ItemType
				PrmRequestingLocation			is like RequestingLocation
				PrmBypassPurchasingClass		is Boolean

			Parameter Rules
				PrmPurchasingCompany
					required

			Action Rules
				LocalPurchasingCompany		= PrmPurchasingCompany
				LocalShipToLocation			= PrmShipToLocation
				LocalVendor					= PrmVendor
				LocalPurchaseFromLocation	= PrmPurchaseFromLocation
				LocalRequestingLocation 	= PrmRequestingLocation

				if (not PrmBypassPurchasingClass)
					invoke ValidatePurchasingClasses
						invoked.PrmMajorPurchasingClass = PrmMajorPurchasingClass
						invoked.PrmMinorPurchasingClass = PrmMinorPurchasingClass
						invoked.PrmItemType				= PrmItemType


				if (LocalPurchasingCompany entered
				and BuyerLocationsForBuyerRel exist)

					if (BuyerLocationsForBuyerAndCompanyRel not exist)

						constraint (LocalShipToLocation entered or LocalRequestingLocation entered)
							"LocationOrRequestingLocationRequired;BuyerLimitsExistAtThatLevel"	


					if (BuyerLocationsForBuyerAndCompanyRel exist)


						if (LocalShipToLocation entered
						and ValidShipToBuyerLocationsForBuyerAndCompanyRel exist)

							constraint (MatchingShipToBuyerLocationsForBuyerAndCompanyRel exist)
								"Company<LocalPurchasingCompany>Location<LocalShipToLocation>NotValidForBuyer<Buyer>"		



						if (LocalRequestingLocation entered
						and ValidRequestingBuyerLocationsForBuyerAndCompanyRel exist)

							constraint (MatchingRequestingBuyerLocationsForBuyerAndCompanyRel exist)
								"Company<LocalPurchasingCompany>RequestingLocation<LocalRequestingLocation>NotValidForBuyer<Buyer>"	


 				if (LocalVendor entered
 				and BuyerVendorsForBuyerRel exist)
 					constraint (ValidVendorsForBuyerRel exist)
 						"Vendor<LocalVendor>NotValidForBuyer<Buyer>"
 					constraint (ValidBuyerVendorsForBuyerRel exist)
 						"Vendor<LocalVendor>PurchasingFromLocation<LocalPurchaseFromLocation>NotValidForBuyer<Buyer>"	

		ValidatePurchasingClasses is an Instance Action
			restricted
			Parameters
				PrmGroup						is like ItemGroup
				PrmMajorPurchasingClass			is like MajorPurchasingClass
				PrmMinorPurchasingClass			is like MinorPurchasingClass
				PrmItemType						is like ItemType

			Parameter Rules
				PrmGroup
					default to ProcurementGroup

			Action Rules
				LocalMajorPurchasingClass	= PrmMajorPurchasingClass
				LocalMinorPurchasingClass	= PrmMinorPurchasingClass
				LocalGroup					= PrmGroup


				if (PrmItemType entered
				and BuyerPurchasingClassesForBuyerRel exist)
					if (RestrictPurchasingClasses)

						constraint ((PrmItemType.Inventoried or PrmItemType.NonStock)
						and			 LocalMajorPurchasingClass entered)
							"CannotPurchaseItemsWithoutASystemAssignedPurchaseClass"	


					if (LocalMajorPurchasingClass entered)
						constraint (ValidBuyerPurchasingClassesForBuyerRel exist)
							"PurchasingMajorClass<LocalMajorPurchasingClass>MinorClass<LocalMinorPurchasingClass>NotValidForBuyer<Buyer>"	

		BODDataInitialLoadContactMasterPOCriteria is a Set Action
			restricted
			Parameters
				PrmHROrganization		is a HROrganization
				PrmFromBuyer			is a Buyer
				PrmToBuyer				is a Buyer
			Parameter Rules

			Instance Selection
				where  (((PrmHROrganization entered
				and		  PrmHROrganization = HROrganization)
				or		  PrmHROrganization not entered)
				and    ((PrmFromBuyer entered
				and		 PrmFromBuyer <= Buyer)
				or		 PrmFromBuyer not entered)
				and    ((PrmToBuyer entered
				and		 PrmToBuyer >= Buyer)
				or		 PrmToBuyer not entered)
				and 	(Active = true))

			Action Rules
				Instance Rules
					if (HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup.BODTrigger)
						ActionCode = ActionCode.Create
						include TriggerContactMasterPOServiceRules





 	Action Exit Rules
		if (HROrganization.FinanceEnterpriseGroupRel.FinanceEnterpriseGroup.BODTrigger and !LocalBODTrigger)
			if (!action type.Delete)
				if (action != "UpdateBODIdFields" and action != "SendAcknowledgementEmailToBuyers" and action != "UpdateGlobalLocationNumber" and action != "EditValidateMethodsForBuyer" and action != "ValidatePurchasingClasses") 
					ActionCode = ActionCode.Update
					if (action type.Create)
						ActionCode = ActionCode.Create
					include TriggerContactMasterPOServiceRules




					LocalTitle = "HO:"+HROrganization+" Buyer:"+Buyer
					increment bod id.VariationID
					include TriggerPersonServiceRules


