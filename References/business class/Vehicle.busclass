Vehicle is a BusinessClass
    owned by wh
    prefix is VHCL

    Ontology
        symbolic key is Vehicle

    Patterns 
        disable AuditIndex
    
    Persistent Fields
        Description
        VehicleType
        Active
        AssignedVehicleGroup        is a VehicleGroup 
            default label is "Vehicle_Group"
        VehicleIdentifier           is a Reference
        Carrier                     is a Vendor
        VehicleClassification       is Numeric 1
            States 
                InternallyOwned value is 0
                Forwarder       value is 1
                Leased          value is 2
        VehicleAttribute
        WeekDaysFlag 
        NonOperatingDateAndDescription 
        Availability                is Numeric size 1  
            States
                Available        value is 0
                NotAvailable     value is 1
    Conditions

        VehicleGroupAssigned
            when (AssignedVehicleGroup entered)

        VehicleGroupChanged
            when (AssignedVehicleGroup changed)

        CarrierVendor
            when (CarrierVendorRel exists
            and   CarrierVendorRel.Carrier)

        RecordExists
            when (Vehicle exists)

        VehicleGroupExists
            when (VehicleGroupRel exists)

        IsVehicleUsed 
            when (ShipmentLoadConsolidationRel exists)

        VehicleIsAvailable
            restricted
            when (Active and Availability.Available)
    
    Context Fields
        VehicleGroup

    Derived Fields
        DerivedVehicleInteriorLength          is a DerivedField  
            type is like LengthDimension    
            return VehicleType.InteriorLength

        DerivedVehicleInteriorWidth           is a DerivedField  
            type is like WidthDimension
            return VehicleType.InteriorWidth

        DerivedVehicleInteriorHeight          is a DerivedField  
            type is like HeightDimension
            return VehicleType.InteriorHeight

        DerivedVehicleExteriorLength          is a DerivedField  
            type is like LengthDimension   
            return VehicleType.ExteriorLength

        DerivedVehicleExteriorWidth           is a DerivedField  
            type is like WidthDimension
            return VehicleType.ExteriorWidth

        DerivedVehicleExteriorHeight          is a DerivedField  
            type is like HeightDimension
            return VehicleType.ExteriorHeight

        DerivedVehicleWeightCapacity          is a DerivedField  
            type is like DimensionSize
            return VehicleType.VehicleWeightCapacity

        DerivedVehicleVolumeCapacity          is a DerivedField  
            type is like DimensionSize
            return VehicleType.VehicleVolumeCapacity

        DerivedFinanceEnterpriseGroup         is a DerivedField 
            type is like FinanceEnterpriseGroup
            return Company.FinanceEnterpriseGroup

        DerivedVehicleOperationMonday    is a DerivedField
            type is Boolean
            default label is "Monday"
            if (VehicleGroupAssigned)
                return VehicleGroupRel.WeekDaysFlag.Monday    
            else   
                return WeekDaysFlag.Monday  

        DerivedVehicleOperationTuesday   is a DerivedField
            type is Boolean
            default label is "Tuesday"
            if (VehicleGroupAssigned)
                return VehicleGroupRel.WeekDaysFlag.Tuesday  
            else   
                return WeekDaysFlag.Tuesday
            
        DerivedVehicleOperationWednesday is a DerivedField
            type is Boolean
            default label is "Wednesday"
            if (VehicleGroupAssigned)
                return VehicleGroupRel.WeekDaysFlag.Wednesday
            else   
                return WeekDaysFlag.Wednesday 

        DerivedVehicleOperationThursday  is a DerivedField
            type is Boolean
            default label is "Thursday"
            if (VehicleGroupAssigned)
                return VehicleGroupRel.WeekDaysFlag.Thursday
            else   
                return WeekDaysFlag.Thursday

        DerivedVehicleOperationFriday    is a DerivedField
            type is Boolean
            default label is "Friday"
            if (VehicleGroupAssigned)
                return VehicleGroupRel.WeekDaysFlag.Friday
            else   
                return WeekDaysFlag.Friday  

        DerivedVehicleOperationSaturday  is a DerivedField
            type is Boolean
            default label is "Saturday"
            if (VehicleGroupAssigned)
                return VehicleGroupRel.WeekDaysFlag.Saturday 
            else   
                return WeekDaysFlag.Saturday    

        DerivedVehicleOperationSunday    is a DerivedField
            type is Boolean
            default label is "Sunday"
            if (VehicleGroupAssigned)
                return VehicleGroupRel.WeekDaysFlag.Sunday 
            else   
                return WeekDaysFlag.Sunday    

        DerivedVehicleNonOperatingDate01 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[1].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[1].NonOperatingDate

        DerivedVehicleNonOperatingDate02 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[2].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[2].NonOperatingDate

        DerivedVehicleNonOperatingDate03 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[3].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[3].NonOperatingDate

        DerivedVehicleNonOperatingDate04 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroup.NonOperatingDateAndDescription.NonOperatingDateGroup[4].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[4].NonOperatingDate

        DerivedVehicleNonOperatingDate05 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[5].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[5].NonOperatingDate

        DerivedVehicleNonOperatingDate06 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[6].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[6].NonOperatingDate

        DerivedVehicleNonOperatingDate07 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[7].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[7].NonOperatingDate

        DerivedVehicleNonOperatingDate08 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[8].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[8].NonOperatingDate

        DerivedVehicleNonOperatingDate09 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[9].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[9].NonOperatingDate

        DerivedVehicleNonOperatingDate10 is a DerivedField
            type is Date
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[10].NonOperatingDate
            else 
                return NonOperatingDateAndDescription.NonOperatingDateGroup[10].NonOperatingDate

        DerivedVehicleNonOperatingDescription01 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[1].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[1].NonOperatingDateDescription
        
        DerivedVehicleNonOperatingDescription02 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[2].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[2].NonOperatingDateDescription

        DerivedVehicleNonOperatingDescription03 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[3].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[3].NonOperatingDateDescription

        DerivedVehicleNonOperatingDescription04 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[4].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[4].NonOperatingDateDescription

        DerivedVehicleNonOperatingDescription05 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[5].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[5].NonOperatingDateDescription

        DerivedVehicleNonOperatingDescription06 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[6].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[6].NonOperatingDateDescription

        DerivedVehicleNonOperatingDescription07 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[7].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[7].NonOperatingDateDescription

        DerivedVehicleNonOperatingDescription08 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[8].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[8].NonOperatingDateDescription

        DerivedVehicleNonOperatingDescription09 is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[9].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[9].NonOperatingDateDescription

        DerivedVehicleNonOperatingDescription10  is a DerivedField
            type is like Description
            if (VehicleGroupAssigned)
                return VehicleGroupRel.NonOperatingDateAndDescription.NonOperatingDateGroup[10].NonOperatingDateDescription
            else    
                return NonOperatingDateAndDescription.NonOperatingDateGroup[10].NonOperatingDateDescription
     

    Relations
        
        VehicleAttributeRel
            one-to-one relation to VehicleAttribute
            Field Mapping uses symbolic key
                related.Company             = Company
                related.VehicleAttribute    = VehicleAttribute
        
        VehicleGroupRel
            one-to-one relation to VehicleGroup
            Field Mapping uses symbolic key
                related.Company             = Company
                related.VehicleGroup        = AssignedVehicleGroup

        VendorRel
            one-to-one relation to Vendor
            Field Mapping uses symbolic key
                related.VendorGroup         = Carrier.VendorGroup
                related.Vendor              = Carrier

        CarrierVendorRel 
            one-to-many relation to Vendor
            Field Mapping uses symbolic key
                related.VendorGroup         = Company.ItemGroup
            Instance Selection
                where (related.Carrier)

        ShipmentLoadConsolidationRel 
            one-to-many relation to ShipmentLoadConsolidation
            Field Mapping uses ByVehicle
                related.Company   = Company
                related.Vehicle   = Vehicle

        VehicleTripManagementRel 
            one-to-many relation to VehicleTrip
            Field Mapping uses symbolic key
                related.Company             = Company
            Instance Selection
                where (related.Vehicle = Vehicle)
    Sets
        ByVehicleGroup    
            indexed
			Sort Order
				Company
				AssignedVehicleGroup
                Vehicle
                VehicleType
                VehicleAttribute
                Carrier

	Field Rules

        Description
            required

        VehicleType
            required

        AssignedVehicleGroup
            constraint (VehicleGroupExists)
                "Entered_Vehicle_GroupDoesNotExist"

        WeekDaysFlag
            if (not VehicleGroupChanged
            and VehicleGroupAssigned)
                cannot be changed
                    "CannotChange_Vehicle_Operating_DaysWhen_Vehicle_GroupIsAssigned"

        WeekDaysFlag.Monday
            if (VehicleGroupAssigned)
                force default to DerivedVehicleOperationMonday 

        WeekDaysFlag.Tuesday
            if (VehicleGroupAssigned)
                force default to DerivedVehicleOperationTuesday

        WeekDaysFlag.Wednesday
            if (VehicleGroupAssigned)
                force default to DerivedVehicleOperationWednesday 

        WeekDaysFlag.Thursday
            if (VehicleGroupAssigned)
                force default to DerivedVehicleOperationThursday

        WeekDaysFlag.Friday
            if (VehicleGroupAssigned)
                force default to DerivedVehicleOperationFriday

        WeekDaysFlag.Saturday
            if (VehicleGroupAssigned)
                force default to DerivedVehicleOperationSaturday

        WeekDaysFlag.Sunday
            if (VehicleGroupAssigned)
                force default to DerivedVehicleOperationSunday 

        Carrier
            constraint (CarrierVendor)
                "VendorIsNotA_Carrier"

	Actions		
        Create is a Create Action

        Update is an Update Action     
            valid when (not IsVehicleUsed)        
            
        Delete is a Delete Action
            valid when (not IsVehicleUsed)
        
        UnAssignToVehicleGroup is an Instance Action
            completion message is "Vehicle<Vehicle>UnassignedFrom_Vehicle_Group<VehicleGroup>"
            
            Entrance Rules
                constraint (not Vehicle.IsVehicleUsed)
                    "CannotUnassign_Vehicle;_VehicleIsInUse"

            Action Rules
                invoke Update
                    invoked.AssignedVehicleGroup = blank

        AssignVehicle is an Instance Action
            restricted
            completion message is "Vehicle<Vehicle>AssignedTo_Vehicle_Group<VehicleGroup>"
            
            Entrance Rules
                constraint (not Vehicle.IsVehicleUsed)
                    "CannotAssign_Vehicle;_VehicleIsInUse"

            Action Rules
                invoke Update
                    invoked.AssignedVehicleGroup    = VehicleGroup
