ServicePropertyHistoryAudit is a BusinessClass
    owned by security
    prefix is SPRPH
    stored in environment
    framework type is Security 

    Ontology
        symbolic key is ServicePropertyHistoryAudit 

    Patterns
        implements CRUD
        implements UpdateStamp
        disable Auditing
        disable EffectiveDated
        disable AsOfDateProcessing

    Persistent Fields
    
		Action is Alpha up to 100
		ActionType is Alpha up to 50
	    UpdateActor is Alpha up to 100
	    	default label is "ChangedBy"
    	BusinessObjectRef is BusinessObjectReference

    Sets	
		ByUpdateTimeStamp
			duplicates
			Sort Order
			    ServicePropertyHistoryAudit.HistoryStamp
        
    Conditions
        ActorIsUpdateActor
            when (authenticated actor = update stamp.actor)
        
        ServiceRelExists
            when (ServiceRel exists)
        
        ServicePropertyRelExists
            when (ServicePropertyRel exists)


        ServicePropertyIsCreated
            when (ActionType like "Create" and BusinessObjectRef.BusinessClassName = "ServiceProperty")

        ServicePropertyIsUpdated
            when (ActionType like "Update" and BusinessObjectRef.BusinessClassName = "ServiceProperty")

        ServicePropertyIsDeleted
            when (ActionType like "Delete" and BusinessObjectRef.BusinessClassName = "ServiceProperty")


    Derived Fields
        AuthenticatedActor is a DerivedField
			type is Alpha size up to 255
            return (authenticated actor)

    Relations
        ServiceRel
            one-to-one relation to Service
            include deleted record
            Field Mapping uses symbolic key
                related.Service = BusinessObjectRef(ServiceProperty).Service
        
        ServicePropertyRel is a ServiceProperty set

			Instance Selection
				where (
                    related.Service = BusinessObjectRef(ServiceProperty).Service and
                    related.ServiceProperty = BusinessObjectRef(ServiceProperty).ServiceProperty)

    Actions

		Create is a Create Action
			restricted
		Delete is a Delete Action
			restricted
	
 		Purge is a Purge Action
		
		PurgeAll is a Set Action
			Action Rules
				Instance Rules
					invoke Purge


