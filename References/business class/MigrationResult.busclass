MigrationResult is a BusinessClass
	owned by sharedfinance
	prefix is MIGR

	Ontology
		symbolic key is MigrationResult

	Patterns
		disable AuditIndex
		disable Auditing 
		disable EffectiveDated
		disable DataTranslations

	Persistent Fields
		RunTime								is TimeStamp
		MigrationJobType
		Status								is Numeric 1
			States
				Running								value is 1
				Completed							value is 2


		POCompany				is like PurchasingCompany
			default label is "PurchasingCompany"


		RQCompany				is like InventoryCompany
			default label is "RequisitionCompany"


		ContractGroup			is like ContractGroup
			default label is "ContractGroup"
		Contract				is like Contract
			default label is "Contract"


		CashManagementGroup		is like CashManagementGroup
			default label is "CashManagementGroup"


		PayablesCompany			is like PayablesCompany
			default label is "PayablesCompany"

	Local Fields

	Derived Fields
		NumCompleteMigrationResultDetailRel is a DerivedField
			type is Numeric size 8
			return instance count of CompleteMigrationResultDetailRel
		NumErrorMigrationResultDetailRel is a DerivedField
			type is Numeric size 8
			return instance count of ErrorMigrationResultDetailRel
						
	Field Rules
		RunTime
			default to current timestamp

		Status
			initial value is 1	
			default to 1
			
	Conditions
		ErrorsExists
			when (ErrorMigrationResultDetailRel exists)
		CompletedExists
			when (CompleteMigrationResultDetailRel exists)
		IsMigratePurchaseOrderCommitments
			when (MigrationJobType.MigratePurchaseOrderCommitments)
		IsMigrateRequisitionCommitments
			when (MigrationJobType.MigrateRequisitionCommitments)
		IsMigrateContractCommitments
			when (MigrationJobType.MigrateContractCommitments)
		IsMigrateContractSpreadCommitments
			when (MigrationJobType.MigrateContractSpreadCommitments)
		IsMigrateCBCommitments
			when (MigrationJobType.MigrateCBCommitments)
		IsMigratePayablesCommitments
			when (MigrationJobType.MigratePayablesCommitments)
		UseBackgroundPurge
			restricted
			when (instance count of MigrationResultDetail set > 50)			
	Rule Blocks

					
    Relations
		CompleteMigrationResultDetailRel is a MigrationResultDetail set
			Instance Selection
				where (related.Status = 1)

		ErrorMigrationResultDetailRel is a MigrationResultDetail set
			Instance Selection
				where (related.Status = 2)

	Sets
    			   				
	Actions

		Create is a Create Action
			restricted

		Update is an Update Action	
			restricted
						
		Purge is a Purge Action
			Action Rules
				if (UseBackgroundPurge)
					invoke PurgeDetailsForResult MigrationResultDetail in background
						invoked.PrmFinanceEnterpriseGroup	= FinanceEnterpriseGroup
						invoked.PrmMigrationResult			= MigrationResult
				else
					invoke Purge MigrationResultDetail set			
			
		SetAsRunning is an Instance Action
			default label is untranslatable
			restricted
			Action Rules
				Status = Status.Running
				
		SetAsCompleted is an Instance Action
			default label is untranslatable
			restricted
			Action Rules
				Status = Status.Completed
								
