MatchingRateInvoice is a BusinessClass
    owned by ma
    prefix is MRtIn

    Ontology
		symbolic key is MatchingRateInvoice

    Patterns
    	disable AuditIndex
    	disable Auditing
    	disable EffectiveDated
		implements CreateStamp	
		implements UpdateStamp	

    Persistent Fields
		FinanceEnterpriseGroup
		VendorGroup
		Invoice
		Suffix
    	Vendor						is like Vendor
    	InvoiceDate					is Date
    	DueDate 					is Date
		InvoiceAmount				is an InternationalAmount
		FunctionalAmount    		is an InternationalAmount
		MatchDate					is Date  
		Year 
		Month 						is Numeric 2

	Transient Fields

	Local Fields
		NextSentence				is Boolean		
		LocalPayablesInvoice		is like PayablesInvoice
		LocalMatchingRate			is like MatchingRate 
		LocalFinanceEnterpriseGroup is like FinanceEnterpriseGroup
		LocalVendorGroup			is like VendorGroup
		
	Context Fields
				
	Derived Fields

	Sets

 		ByVendor
 			Sort Order
			 	FinanceEnterpriseGroup
				VendorGroup  
 				Vendor
				Year descending
				Month descending
 				Invoice
 				Company
 				PayablesInvoice

		ByYearMonth
			Sort Order
			 	FinanceEnterpriseGroup 
				Year descending
				Month descending
				Company
				PayablesInvoice 

 		ByInvoiceAmount
 			Sort Order
			 	FinanceEnterpriseGroup 
				InvoiceAmount
 				Company
 				PayablesInvoice

	Relations

		MatchCompanyRel
			one-to-one relation to MatchCompany
			Field Mapping uses symbolic key
				related.Company = Company

        GeneralLedgerCompanyRel
            one-to-one relation to GeneralLedgerCompany
            Field Mapping uses symbolic key
                related.Company     = Company
				
        VendorRel
            one-to-one relation to Vendor
            Field Mapping uses symbolic key
                related.VendorGroup	 			= VendorGroup
                related.Vendor            		= Vendor

		MatchingRateRel
			one-to-many relation to MatchingRate
			Field Mapping uses YearMonth 
				related.FinanceEnterpriseGroup 	= LocalFinanceEnterpriseGroup
				related.Year					= Year
				related.Month					= Month

		VendorSummaryRel
			one-to-many relation to MatchingRate
			Field Mapping uses ByVendor 
				related.FinanceEnterpriseGroup 	= LocalFinanceEnterpriseGroup
				related.VendorGroup				= LocalVendorGroup
				related.Vendor					= Vendor

	Conditions

	Field Rules

	Rule Blocks
		UpdateValues
			FinanceEnterpriseGroup = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
			VendorGroup 		= Company.VendorGroup
			Vendor 				= PayablesInvoice.Vendor
			Invoice				= PayablesInvoice.Invoice
			Suffix 				= PayablesInvoice.Suffix
			InvoiceDate			= PayablesInvoice.InvoiceDate
			DueDate				= PayablesInvoice.DueDate
			InvoiceAmount 		= PayablesInvoice.InvoiceAmount.CurrencyAmount
			FunctionalAmount 	= PayablesInvoice.InvoiceAmount.FunctionalAmount.EnteredCurrencyAmount
			Year				= PayablesInvoice.MatchDate year 
			Month				= PayablesInvoice.MatchDate month 
			MatchDate			= PayablesInvoice.MatchDate

	Actions
		Create is a Create Action
			restricted

		Update is an Update Action
			restricted

		UpdateSnapshotFields is an Instance Action
			restricted
			Action Rules

				LocalFinanceEnterpriseGroup = Company.FinanceEnterpriseGroup
				LocalVendorGroup = PayablesInvoice.VendorGroup				
				include UpdateValues

		Delete is a Delete Action
			restricted

		FastDelete is a Delete Action
			restricted
			bypass relational integrity rules

		DeleteSet is a Set Action
			restricted
			default label is "SummarizeMatchAging"
			Parameters
				PrmFinanceEnterpriseGroup		is a FinanceEnterpriseGroup

			Sort Order
				Company
				PayablesInvoice
			Instance Selection
				where (PrmFinanceEnterpriseGroup	= Company.FinanceEnterpriseGroup)
			Action Rules
				Empty Set Rules
					invoke DeleteAll MatchingRate 
						invoked.PrmFinanceEnterpriseGroup	= PrmFinanceEnterpriseGroup

				Set Rules
					Exit Rules
						invoke DeleteAll MatchingRate 
							invoked.PrmFinanceEnterpriseGroup	= PrmFinanceEnterpriseGroup
				Instance Rules
					invoke FastDelete


