TaxTable is a BusinessClass
    owned by tx
    prefix is TXT
    classic name is TXTAXTABLE

    Ontology
        symbolic key is TaxTable
            classic set name is TXTSET1
            name for EffectDate is EffectiveDate
            classic name for EffectiveDate is EFFECT-DATE
            classic name for TaxCode is TAX-TABLE

    Patterns
        implements StaticJava
        disable AuditIndex
        implements BODId

    Persistent Fields

        Description
        TaxCode1         is a TaxCode
            classic name is TAX-CODE1
        EffectOnTaxable1 is AlphaUpper size 1
            classic name is FLAG1
            States
                AddToTaxable        value is "+"
                SubtractFromTaxable value is "-"
                NoEffectOnTaxable   value is blank
        TaxCode2         is a TaxCode
            classic name is TAX-CODE2
        EffectOnTaxable2 is AlphaUpper size 1
            classic name is FLAG2
            States
                AddToTaxable        value is "+"
                SubtractFromTaxable value is "-"
                NoEffectOnTaxable   value is blank
        TaxCode3         is a TaxCode
            classic name is TAX-CODE3
        EffectOnTaxable3 is AlphaUpper size 1
            classic name is FLAG3
            States
                AddToTaxable        value is "+"
                SubtractFromTaxable value is "-"
                NoEffectOnTaxable   value is blank
        TaxCode4         is a TaxCode
            classic name is TAX-CODE4
        EffectOnTaxable4 is AlphaUpper size 1
            classic name is FLAG4
            States
                AddToTaxable        value is "+"
                SubtractFromTaxable value is "-"
                NoEffectOnTaxable   value is blank
        TaxCode5         is a TaxCode
            classic name is TAX-CODE5
        EffectOnTaxable5 is AlphaUpper size 1
            classic name is FLAG5
            States
                AddToTaxable        value is "+"
                SubtractFromTaxable value is "-"
                NoEffectOnTaxable   value is blank
        TaxCode6         is a TaxCode
            classic name is TAX-CODE6
        EffectOnTaxable6 is AlphaUpper size 1
            classic name is FLAG6
            States
                AddToTaxable        value is "+"
                SubtractFromTaxable value is "-"
                NoEffectOnTaxable   value is blank
        TaxCode7         is a TaxCode
            classic name is TAX-CODE7
        EffectOnTaxable7 is AlphaUpper size 1
            classic name is FLAG7
            States
                AddToTaxable        value is "+"
                SubtractFromTaxable value is "-"
                NoEffectOnTaxable   value is blank
        TaxCode8         is a TaxCode
            classic name is TAX-CODE8
        EffectOnTaxable8 is AlphaUpper size 1
            classic name is FLAG8
            States
                AddToTaxable        value is "+"
                SubtractFromTaxable value is "-"
                NoEffectOnTaxable   value is blank


	Local Fields

		LocalTaxCode 	is a TaxCode
		LocalTitle 				            is Alpha size 255
		ActionCode							is Alpha size 1
			States
				Create  value is "C"
				Update	value is "U"
				Delete	value is "D"
		LocalEffectiveDate					is like EffectiveDate
		

	Derived Fields

		ValidTaxCodeForTableMessage206 is a MessageField
			restricted
			"TaxCodeMasterMustBeStand-aloneOrTableMemberToBeInTable"

		TaxTableTotalRate is a ComputeField 
			type is Percent size 7.5
			(TaxCode1Rate + TaxCode2Rate + TaxCode3Rate + TaxCode4Rate + TaxCode5Rate + TaxCode6Rate +TaxCode7Rate + TaxCode8Rate)
						
		TaxCode1Rate is a DerivedField										
			type is like ChrgRate
			if (TaxCode1 entered)
				LocalTaxCode = TaxCode1
				LocalEffectiveDate = EffectiveDate    						 
				if (first TaxRatesByEffectDateRel exist)					 
					return first TaxRatesByEffectDateRel.TaxRate.Rate	
				else	
				if (last TaxRatesByEffectDateRel exist)						 
					return last TaxRatesByEffectDateRel.TaxRate.Rate					
				else
					LocalEffectiveDate = "19000101"     					
					return first TaxRatesByEffectDateRel.TaxRate.Rate		

		TaxCode2Rate is a DerivedField										 
			type is like ChrgRate
			if (TaxCode2 entered)
				LocalTaxCode = TaxCode2
				LocalEffectiveDate = EffectiveDate    						 
				if (first TaxRatesByEffectDateRel exist)					 
					return first TaxRatesByEffectDateRel.TaxRate.Rate	
				else	
				if (last TaxRatesByEffectDateRel exist)						 
					return last TaxRatesByEffectDateRel.TaxRate.Rate					
				else
					LocalEffectiveDate = "19000101"     					
					return first TaxRatesByEffectDateRel.TaxRate.Rate		
					
					
		TaxCode3Rate is a DerivedField										 
			type is like ChrgRate
			if (TaxCode3 entered)
				LocalTaxCode = TaxCode3
				LocalEffectiveDate = EffectiveDate    						 
				if (first TaxRatesByEffectDateRel exist)					 
					return first TaxRatesByEffectDateRel.TaxRate.Rate	
				else	
				if (last TaxRatesByEffectDateRel exist)						 
					return last TaxRatesByEffectDateRel.TaxRate.Rate					
				else
					LocalEffectiveDate = "19000101"     					
					return first TaxRatesByEffectDateRel.TaxRate.Rate		

		TaxCode4Rate is a DerivedField										 
			type is like ChrgRate	
			if (TaxCode4 entered)
				LocalTaxCode = TaxCode4
				LocalEffectiveDate = EffectiveDate    						 
				if (first TaxRatesByEffectDateRel exist)					 
					return first TaxRatesByEffectDateRel.TaxRate.Rate	
				else	
				if (last TaxRatesByEffectDateRel exist)						 
					return last TaxRatesByEffectDateRel.TaxRate.Rate					
				else
					LocalEffectiveDate = "19000101"     					
					return first TaxRatesByEffectDateRel.TaxRate.Rate		

		TaxCode5Rate is a DerivedField										 
			type is like ChrgRate
			if (TaxCode5 entered)
				LocalTaxCode = TaxCode5
				LocalEffectiveDate = EffectiveDate    						 
				if (first TaxRatesByEffectDateRel exist)					 
					return first TaxRatesByEffectDateRel.TaxRate.Rate	
				else	
				if (last TaxRatesByEffectDateRel exist)						 
					return last TaxRatesByEffectDateRel.TaxRate.Rate					
				else
					LocalEffectiveDate = "19000101"     					
					return first TaxRatesByEffectDateRel.TaxRate.Rate		

		TaxCode6Rate is a DerivedField										 
			type is like ChrgRate
			if (TaxCode6 entered)
				LocalTaxCode = TaxCode6
				LocalEffectiveDate = EffectiveDate    						 
				if (first TaxRatesByEffectDateRel exist)					 
					return first TaxRatesByEffectDateRel.TaxRate.Rate	
				else	
				if (last TaxRatesByEffectDateRel exist)						 
					return last TaxRatesByEffectDateRel.TaxRate.Rate					
				else
					LocalEffectiveDate = "19000101"     					
					return first TaxRatesByEffectDateRel.TaxRate.Rate		

		TaxCode7Rate is a DerivedField										 
			type is like ChrgRate
			if (TaxCode7 entered)
				LocalTaxCode = TaxCode7
				LocalEffectiveDate = EffectiveDate    						 
				if (first TaxRatesByEffectDateRel exist)					 
					return first TaxRatesByEffectDateRel.TaxRate.Rate	
				else	
				if (last TaxRatesByEffectDateRel exist)						 
					return last TaxRatesByEffectDateRel.TaxRate.Rate					
				else
					LocalEffectiveDate = "19000101"     					
					return first TaxRatesByEffectDateRel.TaxRate.Rate		
					
		TaxCode8Rate is a DerivedField										 
			type is like ChrgRate
			if (TaxCode8 entered)
				LocalTaxCode = TaxCode8
				LocalEffectiveDate = EffectiveDate    						 
				if (first TaxRatesByEffectDateRel exist)					 
					return first TaxRatesByEffectDateRel.TaxRate.Rate	
				else	
				if (last TaxRatesByEffectDateRel exist)						 
					return last TaxRatesByEffectDateRel.TaxRate.Rate					
				else
					LocalEffectiveDate = "19000101"     					
					return first TaxRatesByEffectDateRel.TaxRate.Rate		

    Sets																	


        ByStatus													
            duplicates
            Sort Order
            	FinanceEnterpriseGroup	
				TaxCode.Status 
				EffectiveDate
                TaxCode

        ByEffectiveDate												
            duplicates
            Sort Order
            	FinanceEnterpriseGroup	
				EffectiveDate
                TaxCode
				TaxCode.Status 


  	Field Rules

		FinanceEnterpriseGroup
			default to TaxCode.FinanceEnterpriseGroup 
			
		TaxCode	
			constraint(TaxTable.TaxCode.TaxType = "T")
				"TaxCodeMasterMustBeType_\TToSetupTable"  							
					
		TaxCode1
			required           	

			constraint (TaxCode1.TaxType.StandAlone
			or			TaxCode1.TaxType.TableMember)
				"<ValidTaxCodeForTableMessage206>" 	
 					
		TaxCode2
			constraint (TaxCode1 entered)
				"TaxCodesMustBeEnteredInSequence"  										 	

			constraint (TaxCode2 != TaxCode1) 							
				"CannotHaveDuplicateTaxCodesInTheTable"  						

			constraint (TaxCode2.TaxType.StandAlone
			or			TaxCode2.TaxType.TableMember)
				"<ValidTaxCodeForTableMessage206>" 	 		
				
		TaxCode3
			constraint (TaxCode2 entered)
				"TaxCodesMustBeEnteredInSequence"  								
					
			constraint (TaxCode3 != TaxCode1 			
			and  		TaxCode3 != TaxCode2)						
					"CannotHaveDuplicateTaxCodesInTheTable"  						

			constraint (TaxCode3.TaxType.StandAlone
			or			TaxCode3.TaxType.TableMember)
				"<ValidTaxCodeForTableMessage206>" 	  		
				
		TaxCode4
			constraint (TaxCode3 entered)
				"TaxCodesMustBeEnteredInSequence"
										

			constraint (TaxCode4 != TaxCode1 			
			and 		TaxCode4 != TaxCode2
			and 		TaxCode4 != TaxCode3)								
					"CannotHaveDuplicateTaxCodesInTheTable"  						

			constraint (TaxCode4.TaxType.StandAlone
			or 			TaxCode4.TaxType.TableMember)
				"<ValidTaxCodeForTableMessage206>" 	  			
					
		TaxCode5
			constraint (TaxCode4 entered)
				"TaxCodesMustBeEnteredInSequence"
										

			constraint (TaxCode5 != TaxCode1 			
			and  		TaxCode5 != TaxCode2
			and  		TaxCode5 != TaxCode3
			and  		TaxCode5 != TaxCode4)							
					"CannotHaveDuplicateTaxCodesInTheTable"  						

			constraint (TaxCode5.TaxType.StandAlone
			or			TaxCode5.TaxType.TableMember)
				"<ValidTaxCodeForTableMessage206>" 	  			
										
		TaxCode6
			constraint (TaxCode5 entered)
				"TaxCodesMustBeEnteredInSequence"
										
			constraint (TaxCode6 != TaxCode1 			
			and  		TaxCode6 != TaxCode2
			and  		TaxCode6 != TaxCode3
			and  		TaxCode6 != TaxCode4
			and  		TaxCode6 != TaxCode5)						
					"CannotHaveDuplicateTaxCodesInTheTable"  						

			constraint (TaxCode6.TaxType.StandAlone
			or			TaxCode6.TaxType.TableMember)
				"<ValidTaxCodeForTableMessage206>" 	  			
					
					
		TaxCode7
			constraint (TaxCode6 entered)
				"TaxCodesMustBeEnteredInSequence"
										
			constraint (TaxCode7 != TaxCode1 			
			and 		TaxCode7 != TaxCode2
			and  		TaxCode7 != TaxCode3
			and  		TaxCode7 != TaxCode4
			and  		TaxCode7 != TaxCode5
			and  		TaxCode7 != TaxCode6)							
					"CannotHaveDuplicateTaxCodesInTheTable"  						

			constraint (TaxCode7.TaxType.StandAlone
			or			TaxCode7.TaxType.TableMember)
				"<ValidTaxCodeForTableMessage206>" 	  			
					
		TaxCode8
			constraint (TaxCode7 entered)
				"TaxCodesMustBeEnteredInSequence"
										 	 					
			constraint (TaxCode8.TaxType.StandAlone
			or			TaxCode8.TaxType.TableMember)
				"<ValidTaxCodeForTableMessage206>" 	 		
														 	 					
			constraint (TaxCode8 != TaxCode1 			
			and  		TaxCode8 != TaxCode2
			and  		TaxCode8 != TaxCode3
			and  		TaxCode8 != TaxCode4
			and  		TaxCode8 != TaxCode5
			and  		TaxCode8 != TaxCode6
			and  		TaxCode8 != TaxCode7)							
					"CannotHaveDuplicateTaxCodesInTheTable"  						



            												

	Relations

        TaxRateRel
            one-to-many relation to TaxRate
            Field Mapping uses symbolic key
            Instance Selection
                where (related.TaxRate.TaxCode 	= LocalTaxCode)

		TaxRatesByEffectDateRel
			one-to-many relation to TaxRate
			Field Mapping uses Set4
			Instance Selection
				where (related.FinanceEnterpriseGroup 	= LocalTaxCode.FinanceEnterpriseGroup	
				and    related.TaxRate.TaxCode			= LocalTaxCode

				and    related.EffectiveDate	   	   >= LocalEffectiveDate)	
 
    Conditions
        IsTaxCode1
            restricted
            when (TaxCode1 entered)
            
        IsTaxCode2
            classic name is TAX-CODE2
            restricted
            when (TaxCode2 entered)

        IsTaxCode3
            classic name is TAX-CODE3
            restricted
            when (TaxCode3 entered)

        IsTaxCode4
            classic name is TAX-CODE4
            restricted
            when (TaxCode4 entered)

        IsTaxCode5
            classic name is TAX-CODE5
            restricted
            when (TaxCode5 entered)

        IsTaxCode6
            classic name is TAX-CODE6
            restricted
            when (TaxCode6 entered)

        IsTaxCode7
            classic name is TAX-CODE7
            restricted
            when (TaxCode7 entered)

        IsTaxCode8
            classic name is TAX-CODE8
            restricted
            when (TaxCode8 entered)


    Actions

        Create is a Create Action
 				
        Update is an Update Action

        Delete is a Delete Action
        	Entrance Rules
				if (TaxCode.FinanceEnterpriseGroup.BODTrigger)
					ActionCode = ActionCode.Delete
					LocalTitle = "EG:"+TaxCode.FinanceEnterpriseGroup+"CO:"+TaxCode
					increment bod id.VariationID
					trigger "LawsonTaxTableMasterService" PA service
						resume on error
						title is "<LocalTitle>"
						Criteria
							TaxCode.FinanceEnterpriseGroup
						Variables
							ActionCode
							include persistent fields from TaxTable
							bod id.VariationID
								variable name is VariationId
							TaxCode.FinanceEnterpriseGroup
								variable name is FinanceEnterpriseGroup	


		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmAccountingEntity  is Alpha size 22
					default label is "AccountingEntity"
				PrmLocation          is Alpha size 22
					default label is "Location" 
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmRevision          is Alpha size 22
					default label is "Revision"	
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"
				PrmVariationID       is Alpha size 22
					default label is "VariationID"	
			Action Rules
				if (bod id.AccountingEntity != PrmAccountingEntity)
					bod id.AccountingEntity 	= PrmAccountingEntity
				if (bod id.Location != PrmLocation)
					bod id.Location				= PrmLocation
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.Revision != PrmRevision)
					bod id.Revision				= PrmRevision
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord
				if (bod id.VariationID != PrmVariationID)
					bod id.VariationID			= PrmVariationID				
											
	Action Exit Rules
		if (TaxCode.FinanceEnterpriseGroup.BODTrigger)
			if (!action type.Delete)
				if (action != "UpdateBODIdFields") 
					ActionCode = ActionCode.Update
					if (action type.Create)
						ActionCode = ActionCode.Create
					LocalTitle = "EG:"+TaxCode.FinanceEnterpriseGroup+"CO:"+TaxCode
					increment bod id.VariationID
					trigger "LawsonTaxTableMasterService" PA service
						resume on error
						title is "<LocalTitle>"
						Criteria
							TaxCode.FinanceEnterpriseGroup
						Variables
							ActionCode
							include persistent fields from TaxTable
							bod id.VariationID
								variable name is VariationId
							TaxCode.FinanceEnterpriseGroup
								variable name is FinanceEnterpriseGroup	
