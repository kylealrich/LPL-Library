WarehouseShipment is a BusinessClass
	owned by wh
	prefix is WHS
	classic name is WHSHIPMENT

	Ontology
		symbolic key is WarehouseShipment
			classic set name is WHSSET1
			classic name is SHIPMENT-NBR
			classic name for InventoryLocation is LOCATION

	Patterns
		implements StaticJava
		disable AuditIndex
		implements ContextualParent
		implements BODId
		implements Archivable

	Persistent Fields
		WarehouseDemand
			classic name for WarehouseDemand.DemandSystemCode is SYSTEM-CD
			classic name for WarehouseDemand.DemandDocument is DOC-NBR
			delete ignored
		DemandDocumentType
			classic name is DOC-TYPE
		CustomerShipTo               is a ShipTo
			classic name is CUST-SHIP-TO
		Destination
		ProcessLevel                 is a PayablesProcessLevel
		WarehouseBatch
			classic name is BATCH-NBR
			delete ignored
		Status                       is Numeric size 1
			protected
			States
				Printed  				value is 0
				Picked   				value is 1
				Packed   				value is 2
				Shipped  				value is 3
				Released 				value is 4
				Closed   				value is 5
				ReleaseInProgress 		value is 6
				PickInProgress			value is 7
				PackInProgress			value is 8
				ShipInProgress			value is 9
		OperatorID					 is an Operator 
			holds pii
			classic name is OPR-CODE
		RequirePickingFeedback       is Boolean
			classic name is PICKING-REQ
		RequirePackingFeedback       is Boolean
			classic name is PACKING-REQ
		PrintDate                    is Date
		PickDate                     is Date
		PackDate                     is Date
		ShipDate                     is Date
		GeneralLedgerDate            is Date
			classic name is GL-DATE
			default label is "GlobalLedgerDate"
		RouteHeader
			classic name for RouteHeader.Route is ROUTE
		EstimatedDeliveryDate		 is Date
			classic name is EST-DEL-DATE
		Vendor
		BasedOnPurchaseOrderReceipt  is Boolean
			classic name is PO-FLAG
		RouteStop
			classic name is STOP
		BillOfLading
			classic name is BOL-NBR
			delete ignored
		Carrier                      is a Vendor
		ShippingMethod
			classic name is METHOD
		TransactionId
			classic name is TRANS-ID
		FreightCode 				 is a BillingFreightCode
		RequireFreight               is AlphaUpper size 1
			classic name is FREIGHT-REQ
			States
				Required   value is "R"
				NotAllowed value is "N"
				Optional   value is "O"
		FreightCharges				 is an InternationalAmount
		NumberOfCartons
			classic name is CARTONS
		StockVolume
			classic name is CUBIC-FEET
		CubicAdjustment              is Decimal size 9.3
			classic name is CUBIC-ADJ
		CubicTotal                   is Decimal size 9.3
		StockWeight
			classic name is WEIGHT
		WeightAdjustment             is Decimal size 9.3
			classic name is WEIGHT-ADJ
		WeightTotal                  is Decimal size 9.3
		PackingList                  is Boolean
			classic name is PACK-LIST-FL
		PrintPOD                     is Boolean
			classic name is POD-PRT-FL
		PODReturnDate                is Date
			classic name is POD-RETRN-DT
		InvoicePrefix
		InvoiceNumber
			classic name is INVC-NUMBER



		CompanyAndLocation
			classic name for CompanyAndLocation.RequestingCompany is REQ-COMPANY
			classic name for CompanyAndLocation.RequestingLocation is REQ-LOCATION
		DocumentNumberNumeric
			classic name is DOC-NBR-NUM
		IntrastatNumber
			classic name is INTRASTAT-NBR
		ShipTerm
			classic name is FOB-CODE
		PortCode
			classic name is PORT-CD
		NatureOfTransactionCode
			classic name is NOTC
		StatisticalProcedure			is an IntrastatStatisticalProcedure
			classic name is STAT-PROC
		VATRegistrationNumber
			classic name is VAT-REG-NBR
		BODAccountingEntity
			classic name is EXT-ACCT-ENT
		BODLocation
			classic name is EXT-LOCATION
		BODDocument
			classic name is EXT-SHIP-NBR
		GlobalDocumentType
			classic name is GLBL-DOC-TYPE
		TemporaryHold                is AlphaUpper size 1
			classic name is TEMP-HOLD
			States
				SentForApproval  value is "S"
					default label is "Sent for Approval"
				ApprovedByEngine value is "A"
					default label is "Approved by Engine"
				RejectedByEngine value is "R"
					default label is "Rejected by Engine"
		BillOfLadingIDMDocumentSequence	is Numeric size 3
			protected

		DownloadedByArray
		LastDownloadedTime			is TimeStamp
		MobileLastTimeSubmitted		is TimeStamp
		MobileTimeStarted			is TimeStamp
		IsFullyPicked				is Boolean 
		PickedBy					is an Actor
		TrackingNumber
		MSCMReportPrinter			is a MobileSupplyChainPrinter
			default label is "ReportPrinter"
		MSCMLabelPrinter			is a MobileSupplyChainPrinter
			default label is "LabelPrinter"

		WarehouseWave
			protected
		WarehouseZone
			protected
			
	Context Fields
		AuditDateRange					is a DateRange
		FSMInboundBODTracker
		ShipmentLoadConsolidation
		ReleaseAfterShipped

	Transient Fields
		FromMSCMFlag				  	is Boolean
		FromTaxEngineFlag				is Boolean
		TransientInventoryLocationCountry		is a Country
			default label is "Country/\Jurisdiction"
			derive value from InventoryLocation.PostalAddress.Country
		TransientIntrastatPortCode	  is an IntrastatPortCode
			default label is "LoadingPort"
			derive value from DerivedPortCodeValue

		TransientShipmentStatus 		is Alpha 14
		TransientCarrier				is Alpha 9
		TransientCODOnly				is Alpha 3
		TransientIncludeBackorders		is Alpha 3
		TransientIDMPrinter				is like IDMPrinter

	Local Fields
		LocalInventoryTransaction     is an InventoryTransaction
		NewInventoryTransaction		  is an InventoryTransaction view
		LocalShipment				  is a WarehouseShipment
		LocalShipmentLine			  is like WarehouseShipmentLine
		LocalTitle 				      is Alpha size 255
		ActionCode				      is Alpha size 1
			States
				Create  value is "C"
				Update	value is "U"
				Delete	value is "D"
		IDMGenerateDocument
		IDMJob

		LocalNativeLPLBODTrigger		is Boolean
		LocalEAMWorkOrderActivity		is Numeric size 9
		LocalMainUserTemplate			is Alpha size 100
		LocalWarehouseShipmentLine		is Numeric size 9
		LocalRequisitionLineNum			is Numeric size 9
		Error            				is Boolean
	    ErrorMessage   					is Alpha 300
	    NewBODTracker  					is a FSMInboundBODTracker view
	    LocalFSMInboundBODTracker		is Numeric 15
	    LocalVariationID				is Numeric 9
	    LocalConfigurationParameter		is Alpha size up to 200
	    LocalCrossAE					is Alpha size 100
	    LocalAEAlreadyExecuted			is Boolean	

		LocalPulseAlertTriggerFrom		is Alpha size 100
		LocalBatchNumber 				is Numeric size 12
		CompletionMessage				is Alpha 150
		LocalIDMBatchID					is like IDMPID

		LocalTrackingNumber				is a TrackingNumber

		
	Derived Fields
		NextStatus is a DerivedField
			type is Numeric size 1
			if (Status.PickInProgress)
				return Status.Picked
			else
			if (Status.PackInProgress)
				return Status.Packed
			else
			if (Status.ShipInProgress)
				return Status.Shipped
			else
			if (Status.Printed)
				if (RequirePickingFeedback)
					return Status.Picked
				else
				if (RequirePackingFeedback)
					return Status.Packed
				else
					return Status.Shipped
			else
			if (Status.Picked)
				if (RequirePackingFeedback)
					return Status.Packed
				else
					return Status.Shipped
			else
			if (Status.Packed)
				return Status.Shipped
			else
				return Status.Closed

		WarehouseShipmentTitle is a MessageField
			"WarehouseShipment<WarehouseShipment>"

		ContextMessageEntityType is a StringField
			type is Alpha 30
			restricted
			"InforWarehouseShipment"

		ContextMessageText is a MessageField
			restricted
			"WarehouseShipment<WarehouseShipment>"
						
		ReleaseCompletionMessage 		is a MessageField
			restricted
			"TheFollowingAction_\'\Release\'_\completed"
			
		SentToEngineCompletionMessage 	is a MessageField
			restricted
			"ShipmentSentToTaxEngineForApproval"

		SentToLSPCompletionMessage		is a MessageField
			restricted
			"ShipmentSentToLSPForApproval"

		LastShipmentLine			  is a DerivedField
			type is like WarehouseShipmentLine
			restricted
			return last WarehouseShipmentLinesRel.WarehouseShipmentLine

		PickedMessage 				  is a MessageField
			restricted
			"ToBePicked"

		PackedMessage				  is a MessageField
			restricted
			"ToBePacked"

		ShippedMessage				  is a MessageField
			restricted
			"ToBeShipped"

		DerivedStatus				  is a DerivedField				
			type is Text
			restricted


			if (Status.Printed)
				if (RequirePickingFeedback)
					return PickedMessage
				else
				if (IsOnlyPackingRequired)
					return PackedMessage
				else
					return ShippedMessage
			else
			if (Status.Picked)
				if (RequirePackingFeedback)
					return PackedMessage
				else
					return ShippedMessage
			else
				return ShippedMessage

		DerivedCustomerShipName	is a DerivedField 
			type is like VendorName 
			holds pii
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.Name
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.Name

		DerivedCustomerShipToAdd1	is a DerivedField
			type is Alpha 40
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.ShipToAddress.DeliveryAddress.AddressLine1
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.PostalAddress.DeliveryAddress.AddressLine1

		DerivedCustomerShipToAdd2	is a DerivedField
			type is Alpha 40
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.ShipToAddress.DeliveryAddress.AddressLine2
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.PostalAddress.DeliveryAddress.AddressLine2

		DerivedCustomerShipToAdd3	is a DerivedField
			type is Alpha 40
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.ShipToAddress.DeliveryAddress.AddressLine3
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.PostalAddress.DeliveryAddress.AddressLine3

		DerivedCustomerShipToAdd4	is a DerivedField
			type is Alpha 40
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.ShipToAddress.DeliveryAddress.AddressLine4
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.PostalAddress.DeliveryAddress.AddressLine4

		DerivedCustomerShipToCity	is a DerivedField
			type is Alpha 40
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.ShipToAddress.Municipality
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.PostalAddress.Municipality

		DerivedCustomerShipToState	is a DerivedField
			type is Alpha 40
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.ShipToAddress.StateProvince
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.PostalAddress.StateProvince
				
		DerivedCustomerShipToCountry	is a DerivedField
			type is Alpha 40
			restricted
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.ShipToAddress.Country
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.PostalAddress.Country

		DerivedCustomerShipToZip	is a DerivedField
			type is Alpha 40
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.ShipToAddress.PostalCode
			else
			if (IsRequisition)
				return RequisitionRel.RequestingLocation.PostalAddress.PostalCode

		DerivedCustomerCodFL	is a DerivedField
			type is Alpha 3
			if (IsCustomerOrder
			and CustomerOrderRel.CashOnDelivery entered)
				return "YES"
			else
				return "NO"

		DerivedFileName			is a StringField
			type is Alpha 100
			restricted
			Company
			" "
			InventoryLocation
			" "
			WarehouseShipment
			" "
			BillOfLading
			" "
			BillOfLadingIDMDocumentSequence

		DerivedPortCodeValue is a DerivedField
			type is like IntrastatPortCode
			restricted
			if (action type.Update)
				return blank
			else
				return PortCode

		DerivedIDMBatchNumber is a DerivedField
			type is Numeric 6
			return WarehouseBatch

		DerivedNumberOfLines is a DerivedField
			type is Numeric 3
			return instance count of WarehouseShipmentLinesRel


		MobileCompanyDisplay is a LabelField
			"<Company>_-_<Company.Name>"

		MobileLocationDisplay is a LabelField
			"<InventoryLocation>_-_<InventoryLocation.Name>"

		DerivedIDMCurrentDate is a DerivedField
			type is Date
			return current corporate date

		DerivedIDMCurrentTime is a DerivedField
			type is Time
			return current corporate time

		DerivedIDMFileName is a StringField
			type is  Alpha size 100
			"Warehouse Packing List "
			Company
			"-"
			InventoryLocation
			"-"
			WarehouseShipment

		DerivedBillTo is a DerivedField
			type is Alpha 20
			if (WarehouseDemand.DemandSystemCode.CustomerOrder)
				return CustomerOrderRel.Customer
			else
			if (WarehouseDemand.DemandSystemCode.Requisitions)
				return RequisitionRel.RequestingLocation

		DerivedBillToName is a DerivedField 
			type is like VendorName
			holds pii
			if (WarehouseDemand.DemandSystemCode.CustomerOrder)
				return CustomerOrderRel.BillName
			else
			if (WarehouseDemand.DemandSystemCode.Requisitions)
				return RequisitionRel.DeliverTo

		DerivedShipTo is a DerivedField
			type is like ShipTo
			return CustomerShipTo

		DerivedShipToName is a DerivedField 
			type is like VendorName
			holds pii
			if (WarehouseDemand.Destination = Destination)
				return WarehouseDemand.DestinationName
			else
				return CustomerOrderRel.CustomerShipTo.Name

		DerivedHasPackingListBackorders is a DerivedField
			type is Alpha 3
			if (WarehousePackingListBackorderedLinesRel exists)
				return "Yes"
			return "No"

		DerivedDocumentSource is a DerivedField
			type is Alpha 14
			if (WarehouseDemand.DemandSystemCode.CustomerOrder)
				return "Customer Order"
			else
			if (WarehouseDemand.DemandSystemCode.Requisitions)
				return "Requisition"
			else
			if (WarehouseDemand.DemandSystemCode.WorkOrder)
				return "Work Order"
			else
			if (WarehouseDemand.DemandSystemCode.Intransit)
				return "Intransit"
			else
			if (WarehouseDemand.DemandSystemCode.PurchaseOrder)
				return "Purchase Order"

		DerivedIDMStatus is a DerivedField
			type is Alpha 19
			if (Status.Printed)
				return "Printed"
			else
			if (Status.Picked)
				return "Picked"
			else
			if (Status.Packed)
				return "Packed"
			else
			if (Status.Shipped)
				return "Shipped"
			else
			if (Status.Released)
				return "Released"
			else
			if (Status.Closed)
				return "Closed"
			else
				return "Release In Progress"

		DerivedOrderDate is a DerivedField
			type is Date
			if (WarehouseDemand.DemandSystemCode.CustomerOrder)
				return CustomerOrderRel.OrderDate
			else
			if (WarehouseDemand.DemandSystemCode.Requisitions)
				return RequisitionRel.CreationDate date

		DerivedForegroundLimit is a DerivedField
			type is Numeric 2
			restricted
			return 50



		DerivedDelimiter is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "Generic_Delimiter"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "tenantID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "releaseID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "logicalID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "VersionID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedShipmentOrderType is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "SyncShipment_ShipmentOrderType"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedIntegratingApplication is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IntegratingApplication"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedIntegrationApplication is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IntegrationApplication"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedConfigFEG is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IsMultipleFEG"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedConfigDocID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "RequiredCleanDocumentID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedRequisitionShipment is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "RequisitionShipment"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedSplitShipment is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "SplitShipment"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedRQLocationMigrate is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "RQLocationMigrate"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedDistributionCentre is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "DistributionCentre"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		

		
		DerivedTime is a DerivedField
			type is Alpha size 25
			restricted
			DerivedTime = current timestamp
			if(DerivedTime[9:10]>12)	
				return "PM"
			else
				return "AM"		
		
		DerivedBODCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			DerivedBODCurrentTimeStamp = current timestamp
			return DerivedBODCurrentTimeStamp[1:4] + "-" + DerivedBODCurrentTimeStamp[5:6] + "-" + DerivedBODCurrentTimeStamp[7:8] + "T" + DerivedBODCurrentTimeStamp[9:10] + ":" + DerivedBODCurrentTimeStamp[11:12] + ":" + DerivedBODCurrentTimeStamp[13:14] + "Z"
		

		
		DerivedBODID is a DerivedField
			type is Alpha size 200
			restricted
			return "infor-nid:" + DerivedTenantID + ":" + DerivedAccountingEntity + ":" + DerivedLocation + ":" + DerivedShipmentNbrOut + ":?Shipment&verb=Sync&TrackerID=" + LocalFSMInboundBODTracker

		DerivedBODVariationID is a DerivedField
			type is Alpha size 60
			restricted
			return bod id.VariationID

		DerivedAccountingEntity is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				return DerivedCrossAE
			else
				return DerivedFinanceEnterpriseGroup + DerivedDelimiter + Company.GeneralLedgerCompany.AccountingEntity
			
		DerivedBODAccountingEntity is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return DerivedFinanceEnterpriseGroup + DerivedDelimiter + BODAccountingEntity

		DerivedFinanceEnterpriseGroup is a DerivedField
			type is Alpha size 5
			restricted
			return Company.FinanceEnterpriseGroup

		DerivedLocation is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				return InventoryLocation
			else
				return DerivedCompany + DerivedDelimiter + InventoryLocation

		DerivedShipmentNbrOut is a DerivedField
			type is Alpha size 100
			restricted
			if(DerivedSystemCode = "RQ" and DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y" and DerivedSplitShipment = "Y" )
				if (DerivedConfigDocID = "Y")
					return WarehouseShipment + DerivedDelimiter + "P" + DerivedDelimiter + LocalWarehouseShipmentLine
				else
					return DerivedCompany + DerivedDelimiter + WarehouseShipment + DerivedDelimiter + "P" + DerivedDelimiter + LocalWarehouseShipmentLine
			else
				if (DerivedConfigDocID = "Y")
					return WarehouseShipment + DerivedDelimiter + "P"
				else
					return DerivedCompany + DerivedDelimiter + WarehouseShipment + DerivedDelimiter + "P"
		
		DerivedDocID is a DerivedField
			type is Alpha size 100
			restricted
			if(DerivedSystemCode = "RQ" and DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y" and DerivedEAMWorkOrder entered)
				return DerivedEAMWorkOrder
			else
				return DerivedShipmentNbrOut
					
		DerivedShipmentPurposeCode is a DerivedField
			type is Alpha size 60
			restricted
			if(DerivedSystemCode = "RQ" and DerivedIntegratingApplication = "EAM" and Status.Closed)
				return "IssueItems"
			else
				return ""
		
		DerivedActualDeliveryDateTime is a DerivedField
			type is Alpha size 25
			restricted
			if(DerivedSystemCode = "RQ" and DerivedIntegratingApplication = "EAM" and Status.Closed)
				return DerivedUpdateTimeStamp
			else
				return ""
		
		DerivedCompany is a DerivedField
			type is Alpha size 10
			restricted
			return Company using "%d"

		DerivedActionCode is a DerivedField
			type is Alpha size 10
			restricted
			return "Add"

		DerivedDocDate is a DerivedField
			type is Alpha size 20
			restricted
			DerivedDocDate = PrintDate
			return DerivedDocDate[1:4] + "-" + DerivedDocDate[5:6] + "-" + DerivedDocDate[7:8] + "T00:00:00"

		DerivedBODStatus is a DerivedField
			type is Alpha size 10
			restricted
			if (Status.Closed)
				return "Closed"
			else
				return "Released"

		DerivedRequestCompany is a DerivedField
			type is Alpha size 10
			restricted
			return CompanyAndLocation.RequestingCompany using "%d"

		DerivedBODShipToName is a DerivedField
			type is Alpha size 120
			restricted
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.Name
			else
				if (DerivedConfigDocID = "Y")
					return CompanyAndLocation.RequestingLocation
				else
					return DerivedRequestCompany + DerivedDelimiter + CompanyAndLocation.RequestingLocation
				
		DerivedProcessBODShipToName is a DerivedField
			type is Alpha size 120
			restricted
			if (DerivedDistributionCentre = "Y")
				return DerivedShipToLocation
			else
			if (DerivedConfigDocID = "Y")
				return CompanyAndLocation.RequestingLocation
			else
				return DerivedRequestCompany + DerivedDelimiter + CompanyAndLocation.RequestingLocation
				
		DerivedCustomerShipToName is a DerivedField
			type is Alpha size 120
			restricted
			if (IsCustomerOrder)
				return CustomerOrderRel.CustomerShipTo.Name
			else
				return RequisitionRel.RequestingLocation.Name

		DerivedShiptoAddr1 is a DerivedField
			type is Alpha size 40
			restricted
			return RequisitionRel.RequestingLocation.PostalAddress.DeliveryAddress.AddressLine1

		DerivedShiptoAddr2 is a DerivedField
			type is Alpha size 40
			restricted
			return RequisitionRel.RequestingLocation.PostalAddress.DeliveryAddress.AddressLine2

		DerivedShiptoAddr3 is a DerivedField
			type is Alpha size 40
			restricted
			return RequisitionRel.RequestingLocation.PostalAddress.DeliveryAddress.AddressLine3

		DerivedShiptoAddr4 is a DerivedField
			type is Alpha size 40
			restricted
			return RequisitionRel.RequestingLocation.PostalAddress.DeliveryAddress.AddressLine4

		DerivedShipToCity is a DerivedField
			type is Alpha size 58
			restricted
			return RequisitionRel.RequestingLocation.PostalAddress.Municipality

		DerivedShipToState is a DerivedField
			type is Alpha size 3
			restricted
			return RequisitionRel.RequestingLocation.PostalAddress.StateProvince

		DerivedShipToCountryCode is a DerivedField
			type is Alpha size 3
			restricted
			return RequisitionRel.RequestingLocation.PostalAddress.Country

		DerivedShipToPostal is a DerivedField
			type is Alpha size 12
			restricted
			return RequisitionRel.RequestingLocation.PostalAddress.PostalCode

		DerivedOrderType is a DerivedField
			type is Alpha size 60
			restricted
			if(DerivedSystemCode = "RQ"  and DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y" and DerivedEAMWorkOrder entered)
				return "MaintenanceOrder"
			else
				if (DerivedShipmentOrderType entered and WarehouseDemand.DemandSystemCode.Requisitions)
					return DerivedShipmentOrderType
				else
					return "Shipment"
			
		DerivedTaxID is a DerivedField
			type is AlphaUpper size 25
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return Company.GeneralLedgerCompany.AccountingEntity.TaxEntity.TaxID
		
		DerivedVendorTaxID is a DerivedField
			type is AlphaUpper size 25
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return Carrier.TaxID
				
		DerivedVendor is a DerivedField
			type is Alpha size 9
			restricted
			return Carrier.Vendor
			
		DerivedVendorGroup is a DerivedField
			type is Alpha size 5
			restricted
			return Carrier.VendorGroup 
			
		DerivedVendorName is a DerivedField
			type is Alpha size 120
			restricted
			if (DerivedIntegrationApplication = "Local.ly" and WarehouseShipment.InventoryLocation.PostalAddress.Country = "CL" and IsCustomerOrder and DerivedConfigDocID != "Y"  )
				return Carrier.VendorName
			else
				return ""
		
		DerivedCarrierPartyID is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedIntegrationApplication = "Local.ly" and WarehouseShipment.InventoryLocation.PostalAddress.Country = "CL" and IsCustomerOrder and DerivedConfigDocID != "Y"  )
				return DerivedFinanceEnterpriseGroup + DerivedDelimiter + DerivedVendorGroup + DerivedDelimiter + DerivedVendor
			else
				return ""
				
		DerivedCarrierAE is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedIntegrationApplication = "Local.ly" and WarehouseShipment.InventoryLocation.PostalAddress.Country = "CL" and IsCustomerOrder and DerivedConfigDocID != "Y")
				return DerivedAccountingEntity
			else
				return ""
		
		DerivedRequisitionID is a DerivedField
			type is Alpha size 100
			restricted
			if(DerivedSystemCode = "RQ" and DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y")
				if(DerivedConfigDocID = "Y")
					return WarehouseDemand.DemandDocument
				else
					return DerivedCompany + DerivedDelimiter + WarehouseDemand.DemandDocument
					
		DerivedEAMWorkOrder is a DerivedField
			type is Alpha size 100
			restricted
			if(DerivedSystemCode = "RQ" and DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y"  )
				return RequisitionLineRel.EAMWorkOrder
				
		DerivedCustomerTaxID is a DerivedField
			type is AlphaUpper size 25
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return CustomerOrderRel.Customer.TaxID
			
		DerivedCustomerName is a DerivedField
			type is Alpha size 120
			restricted
			return CustomerOrderRel.Customer.Name
			
		DerivedWarehouseBatch is a DerivedField
			type is Numeric size 12
			restricted
			if (IsCustomerOrder)
				return WarehouseBatch

		DerivedReqDelDate is a DerivedField
			type is Alpha size 20
			restricted
			if (IsCustomerOrder)
				return DerivedShipDate
			else
				if (RequisitionRel.RequestedDeliveryDate entered)
					DerivedReqDelDate = RequisitionRel.RequestedDeliveryDate
					return DerivedReqDelDate[1:4] + "-" + DerivedReqDelDate[5:6] + "-" + DerivedReqDelDate[7:8] + "T00:00:00"
				else
					return ""

		DerivedRefDocNumber is a DerivedField
			type is Alpha size 40
			restricted
			if (IsCustomerOrder)
				if (DerivedConfigDocID = "Y")
					return WarehouseDemand.DemandDocument
				else
					return DerivedCompany + DerivedDelimiter + WarehouseDemand.DemandDocument
			else
				return WarehouseDemand.DemandDocument
				
		DerivedProcessRefDocNumber is a DerivedField
			type is Alpha size 40
			restricted
			if (DerivedConfigDocID = "Y")
				return WarehouseDemand.DemandDocument
			else
				if (WarehouseDemand.DemandSystemCode.Requisitions)
					return DerivedCompany + DerivedDelimiter + WarehouseDemand.DemandDocument
				else
					return WarehouseDemand.DemandDocument

		DerivedUserAreaXML is a DerivedField
			type is XMLDocument
			restricted
			DerivedUserAreaXML = template.IONSyncShipment_WarehouseShipment_UserAreaXML_ST document for this instance
			return DerivedUserAreaXML

		DerivedAccountingEntity1 is a DerivedField
			type is Alpha size 12
			restricted
			if (IsCustomerOrder)
				return Company.GeneralLedgerCompany.AccountingEntity
			else
				if (DerivedConfigDocID = "Y")
					return DerivedCrossAE
				else
					return Company.GeneralLedgerCompany.AccountingEntity

		DerivedRequester is a DerivedField
			type is Alpha size 10
			restricted
			return RequisitionRel.Requester
			
		DerivedRequesterName is a DerivedField
			type is Alpha size 150
			restricted
			return RequisitionRel.Requester.DerivedTempEmployeeName

		DerivedRQLName is a DerivedField
			type is Alpha size 80
			restricted
			return RequisitionRel.RequestingLocation.Name

		DerivedFromCompany is a DerivedField
			type is Alpha size 5
			restricted
			return RequisitionRel.Requisition.FromCompanyLocation.FromCompany using "%d"

		DerivedInventoryCompanyName is a DerivedField
			type is Alpha size 80
			restricted
			return RequisitionRel.Requisition.Company.Name

		DerivedFromCompanyName is a DerivedField
			type is Alpha size 20
			restricted
			return RequisitionRel.RequestingLocation.FromCompanyLocation.FromLocation

		DerivedRequestingLocationCode is a DerivedField
			type is Alpha size 40
			restricted
			if (DerivedConfigDocID = "Y")
				return RequisitionRel.RequestingLocation.RequestingLocation
			else
				return DerivedCompany + DerivedDelimiter + RequisitionRel.RequestingLocation.RequestingLocation
			
		DerivedProcessRequestingLocationCode is a DerivedField
			type is Alpha size 40
			restricted
			return DerivedCompany + DerivedDelimiter + RequisitionRel.RequestingLocation.RequestingLocation

		DerivedInventoryLocationName is a DerivedField
			type is Alpha size 80
			restricted
			return RequisitionRel.FromCompanyLocation.FromLocation.Name

		DerivedRequestingLocationName is a DerivedField
			type is Alpha size 80
			restricted
			return RequisitionRel.RequestingLocation.Name

		DerivedRequestingCompanyName is a DerivedField
			type is Alpha size 80
			restricted
			return RequisitionRel.RequestingLocation.Company.Name

		DerivedRequestingCompany is a DerivedField
			type is Alpha size 5
			restricted
			return RequisitionRel.RequestingLocation.Company

		DerivedUpdateTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			DerivedUpdateTimeStamp = update stamp.timestamp
			return DerivedUpdateTimeStamp[1:4] + "-" + DerivedUpdateTimeStamp[5:6] + "-" + DerivedUpdateTimeStamp[7:8] + "T" + 	DerivedUpdateTimeStamp[9:10] + ":" + DerivedUpdateTimeStamp[11:12] + ":" + DerivedUpdateTimeStamp[13:14] + "Z"

		DerivedUpdateActor is a DerivedField
			type is Alpha size 30
			restricted
			return update stamp.actor

		DerivedShipTime is a DerivedField
			type is Alpha size 100
			restricted
			DerivedShipTime = update stamp.timestamp
			return DerivedShipTime[9:10] + ":" + DerivedShipTime[11:12] + ":" + DerivedShipTime[13:14]

		DerivedShipDate is a DerivedField
			type is Alpha size 25
			restricted
			if (ShipDate = "00000000" or ShipDate not entered)
				return ""
			else
				DerivedShipDate = ShipDate
				return DerivedShipDate[1:4] + "-" + DerivedShipDate[5:6] + "-" + DerivedShipDate[7:8] + "T" + DerivedShipTime + "Z"

		DerivedReturnToShipFromPartyID is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedIntegratingApplication = "GRC")
				return DerivedCompany + DerivedDelimiter + InventoryLocation
			else
				if (DerivedConfigDocID = "Y")
					return InventoryLocation
				else
					return DerivedCompany + DerivedDelimiter + InventoryLocation

		DerivedShipFromPartyID is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return DerivedCompany + DerivedDelimiter + InventoryLocation
			
		DerivedCustomerPartyID is a DerivedField
			type is Alpha size 100
			restricted
			if (IsCustomerOrder)
				if (DerivedConfigDocID = "Y")
					return DerivedCustomer
				else
					return DerivedCompany + DerivedDelimiter + DerivedCustomer
					
		DerivedReqCompany is a DerivedField
			type is Alpha size 4
			restricted
			return CompanyAndLocation.RequestingCompany using "%d"

		DerivedShipToPartyID is a DerivedField
			type is Alpha size 100
			restricted
			if (IsCustomerOrder)
				if (CustomerShipTo not entered)
					return ""
				else
					if (DerivedConfigDocID = "Y")
						return DerivedCustomer + DerivedDelimiter + CustomerShipTo
					else
						return DerivedCompany + DerivedDelimiter + DerivedCustomer + DerivedDelimiter + CustomerShipTo
			else
				if (DerivedConfigDocID = "Y")
					return DerivedRequestingLocation
				else
					return DerivedReqCompany + DerivedDelimiter + DerivedRequestingLocation
					
		DerivedShipFromAddressLine1 is a DerivedField
			type is Alpha size 40
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.PostalAddress.DeliveryAddress.AddressLine1

		DerivedShipFromAddressLine2 is a DerivedField
			type is Alpha size 40
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.PostalAddress.DeliveryAddress.AddressLine2

		DerivedShipFromAddressLine3 is a DerivedField
			type is Alpha size 40
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.PostalAddress.DeliveryAddress.AddressLine3

		DerivedShipFromAddressLine4 is a DerivedField
			type is Alpha size 40
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.PostalAddress.DeliveryAddress.AddressLine4

		DerivedShipFromCity is a DerivedField
			type is Alpha size 58
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.PostalAddress.Municipality

		DerivedShipFromState is a DerivedField
			type is Alpha size 3
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.PostalAddress.StateProvince

		DerivedShipFromCountry is a DerivedField
			type is Alpha size 3
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.PostalAddress.Country
		
		DerivedShipFromName is a DerivedField
			type is Alpha size 120
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.Name

		DerivedShipFromPostalCode is a DerivedField
			type is Alpha size 12
			restricted
			if (DerivedIntegrationApplication = "Local.ly")
				return InventoryLocation.PostalAddress.PostalCode

		WarehouseShipmentLineXML is a DerivedField
			type is XMLDocument
			restricted
			if (WarehouseShipmentLineRel exists)
				for each WarehouseShipmentLineRel
					each.LocalAccountingEntity = DerivedAccountingEntity
					each.LocalRefDocNumber = DerivedRefDocNumber
					WarehouseShipmentLineXML += template.IONSyncShipment_WarehouseShipmentLine_ST document for each
				return WarehouseShipmentLineXML
			else
				return ""
		
		WarehouseShipmentSplitLineXML is a DerivedField
			type is XMLDocument
			restricted
			if (WarehouseShipmentLineRel exists)
				for each WarehouseShipmentLineRel
					each.LocalAccountingEntity = DerivedAccountingEntity
					each.LocalRefDocNumber = DerivedRefDocNumber
					WarehouseShipmentSplitLineXML 	= template.IONSyncShipment_WarehouseSplitShipmentLines_ST document for each
				return WarehouseShipmentSplitLineXML
			else
				return ""

		SyncShipmentOrderXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			SyncShipmentOrderXMLBOD = template.IONSyncShipment_WarehouseShipment_ST document for this instance
			return SyncShipmentOrderXMLBOD
			
		SyncShipmentHeaderXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			SyncShipmentHeaderXMLBOD = template.IONSyncShipment_WarehouseShipmentHeader_ST document for this instance
			return SyncShipmentHeaderXMLBOD


		DerivedDocumentNumber is a DerivedField
			type is Numeric 10
			restricted
			return WarehouseDemand.DemandDocument

		DerivedSystemCode is a DerivedField
			type is AlphaUpper size 2
			restricted
			return WarehouseDemand.DemandSystemCode

		DerivedRequestingLocation is a DerivedField
			type is AlphaUpper size 20
			restricted
			if (CompanyAndLocation.RequestingLocation != "")
				return CompanyAndLocation.RequestingLocation
			else
				return "0"

		DerivedRoute is a DerivedField
			type is Numeric size 4
			restricted
			return RouteHeader.Route

		WHShipmentCreationAlertDescription is a DerivedField
			type is Alpha 200
			restricted
			return "Shipment" + " " + WarehouseShipment +" " + "has been Created."

#ifdef module integration
		DerivedWHShipmentCreationBODID is a DerivedField
			type is Alpha 100
			restricted
			return	"infor-nid:" + DerivedTenantID +":"+ WarehouseShipment +"?WHShipmentCreation&verb=Process"

#endif

		WHShipmentCreationPulseAlertXML is a DerivedField
			type is XMLDocument
			restricted
			WHShipmentCreationPulseAlertXML = template.IONWHShipmentCreation_WarehouseShipment_ST document for this instance


		WHBatchCreationAlertDescription	is a DerivedField
			type is Alpha 200
			restricted
			return "A shipment" + " "+ WarehouseShipment + " "+"batch has been created"

#ifdef module integration
		DerivedWHBatchCreationBODID is a DerivedField
			type is Alpha 100
			restricted
			return	"infor-nid:" + DerivedTenantID +":"+ WarehouseShipment +"?WHBatchCreation&verb=Process"

#endif

		WHBatchCreationPulseAlertXML is a DerivedField
			type is XMLDocument
			restricted
			WHBatchCreationPulseAlertXML = template.IONWHBatchCreation_WarehouseShipment_ST	document for this instance


		DerivedCustomer is a DerivedField
			type is Numeric 9
			restricted
			return	CustomerOrderRel.Customer

		DerivedWHCompany is a DerivedField
			type is Numeric 9
			restricted
			if(DerivedSystemCode = "RQ")
				return Company
			else
				return DerivedCustomer

		DerivedWHLocation is a DerivedField
			type is AlphaUpper size 20
			restricted
			if(DerivedSystemCode = "RQ")
				return DerivedRequestingLocation
			else
				return CustomerShipTo
#ifdef module integration
		DerivedShipmentReleaseBODID is a DerivedField
			type is Alpha 100
			restricted
			return	"infor-nid:" + DerivedTenantID +":"+ WarehouseShipment +"?ShipmentRelease&verb=Process"
#endif
		ShipmentReleaseAlertDescription is a DerivedField
			type is Alpha 200
			restricted
			return "Shipment" + " "+WarehouseShipment +" "+ "has been released."

		ShipmentReleasePulseAlertXML is a DerivedField
			type is XMLDocument
			restricted
			ShipmentReleasePulseAlertXML = template.IONShipmentRelease_WarehouseShipment_ST	document for this instance


		DerivedProcessShipmentBODID is a DerivedField
			type is Alpha size 200
			restricted
			return "infor-nid:" + DerivedTenantID + ":" + DerivedProcessAE + ":" + DerivedProcessLocation + ":" + DerivedProcessShipmentNbrOut + ":?Shipment&verb=Process&TrackerID=" + LocalFSMInboundBODTracker

		DerivedProcessShipmentDocDate is a DerivedField
			type is Alpha size 30
			restricted
			DerivedProcessShipmentDocDate = PrintDate
			return DerivedProcessShipmentDocDate[1:4] + "-" + DerivedProcessShipmentDocDate[5:6] + "-" + DerivedProcessShipmentDocDate[7:8] + "T00:00:00" + "Z"

		DerivedProcessShipmentOrderType is a DerivedField
			type is Alpha size 20
			restricted
			if (WarehouseDemand.DemandSystemCode.Requisitions)
				return "Requisition"
			else
				return "Shipment"

		DerivedProcessShipmentReqDelDate is a DerivedField
			type is Alpha size 30
			restricted
			if (WarehouseDemand.DemandSystemCode.Requisitions)
				if (RequisitionRel.RequestedDeliveryDate != "00000000")
					DerivedProcessShipmentReqDelDate = RequisitionRel.RequestedDeliveryDate
					return DerivedProcessShipmentReqDelDate[1:4] + "-" + DerivedProcessShipmentReqDelDate[5:6] + "-" + DerivedProcessShipmentReqDelDate[7:8] + "T00:00:00" + "Z"
				else
					return ""
			else
				return ""

		ProcessShipmentLineXML is a DerivedField
			type is XMLDocument
			restricted
			if (WarehouseShipmentLineRel exists)
				for each WarehouseShipmentLineRel
					each.LocalDelimiter = DerivedDelimiter
					each.LocalAccountingEntity = DerivedProcessAE
					each.LocalRefDocNumber = DerivedRefDocNumber
					each.LocalFinanceEnterpriseGroup = DerivedFinanceEnterpriseGroup
					ProcessShipmentLineXML += template.IONProcessShipment_WarehouseShipmentLine_ST document for each
				return ProcessShipmentLineXML
			else
				return ""

		ProcessShipmentXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			ProcessShipmentXMLBOD = template.IONProcessShipment_WarehouseShipment_ST document for this instance
			return ProcessShipmentXMLBOD

		ProcessShipToIDXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			if (DerivedConfigDocID = "Y")
				ProcessShipToIDXMLBOD = template.IONProcessShipment_ShipToIDCleanXML_RQL_ST document for this instance
			else
				ProcessShipToIDXMLBOD = template.IONProcessShipment_ShipToIDXML_RQL_ST document for this instance
			return ProcessShipToIDXMLBOD
		
		DerivedProcessAccountingEntity is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				return 	DerivedCrossAE
			else
				return Company.GeneralLedgerCompany.AccountingEntity

		DerivedProcessBODStatus is a DerivedField
			type is Alpha size 10
			restricted
			return "Released"
		
		DerivedProcessAE is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				return 	DerivedCrossAE
			else
				return 	DerivedFinanceEnterpriseGroup + DerivedDelimiter + Company.GeneralLedgerCompany.AccountingEntity
		
		DerivedProcessShipmentNbrOut is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				return WarehouseShipment + DerivedDelimiter + "P"
			else
				return DerivedCompany + DerivedDelimiter + WarehouseShipment + DerivedDelimiter + "P"
				
		DerivedProcessLocation is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				return InventoryLocation
			else
				return DerivedCompany + DerivedDelimiter + InventoryLocation

		DerivedShipToLocation is a DerivedField	
			type is Alpha size 100
			restricted
			if (DerivedRQLocationMigrate = "Y" and DerivedConfigDocID = "Y")
				return "RQL" + DerivedDelimiter + CompanyAndLocation.RequestingLocation
			else
			if (DerivedRQLocationMigrate = "N" and DerivedConfigDocID = "Y")
				return CompanyAndLocation.RequestingLocation
			else
				return DerivedCompany + DerivedDelimiter + CompanyAndLocation.RequestingLocation

		ProcessShipmentPartyIDXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			if (DerivedSystemCode = "RQ")
				if (DerivedRQLocationMigrate = "Y" and DerivedConfigDocID = "Y" and DerivedDistributionCentre = "N")
					ProcessShipmentPartyIDXMLBOD = template.IONProcessShipment_PartyID_ST document for this instance

		DerivedCrossGLC is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigDocID = "Y")
				if (DerivedConfigFEG = "Y")
					return DerivedFinanceEnterpriseGroup + DerivedDelimiter + Company using "%d"
				else
					return Company using "%d"
			else	
				return ""
				
		DerivedCrossAE is a DerivedField
			type is Alpha size 100
			restricted
			if(LocalAEAlreadyExecuted != true)
				LocalAEAlreadyExecuted = true
				if(FSMBODGLCCrossReferenceDetailRel.DestinationValue entered)
					LocalCrossAE = FSMBODGLCCrossReferenceDetailRel.DestinationValue
				else
					LocalCrossAE = DerivedCrossGLC
				return LocalCrossAE
			else
				return LocalCrossAE
		



		SpecialHandlingMessageForMultipleLines				is a MessageField
			"ItemsWith_\Special_\HandlingInstructionsExist"

		SpecialHandlingMessageForListMultipleLines			is a MessageField
			"ViewItemsWith_\Special_\Handling"
		

		DerivedSavedWarehouseShipmentLineCount is a DerivedField
            type is Numeric size 12
            return instance count of MobileSupplyChainSavedWarehouseShipmentRel
		
		DerivedLastTimeSubmitted is a DerivedField
			type is TimeStamp
			if	(MobileLastTimeSubmitted entered)
				return MobileLastTimeSubmitted
			return update stamp
		
		DerivedPickedBy is a DerivedField
			type is Alpha size 60
			if	(PickedBy entered)
				return PickedBy
			return update stamp.actor

		DerivedReportPrinter is a DerivedField
			type is like MobileSupplyChainPrinter
			if (MSCMReportPrinter entered)
				return MSCMReportPrinter
			else
				return MobileSupplyChainLocationRel.DerivedDefaultMobileSupplyChainReportPrinter

		DerivedLabelPrinter is a DerivedField
			type is like MobileSupplyChainPrinter
			if (MSCMLabelPrinter entered)
				return MSCMLabelPrinter
			else
				return MobileSupplyChainLocationRel.DerivedDefaultMobileSupplyChainLabelPrinter
				


		PickActionMessage 			is a MessageField
			restricted
			"Pick"

		PackActionMessage			is a MessageField
			restricted
			"Pack"

		ShipActionMessage			is a MessageField
			restricted
			"Ship"
		
		ReleaseActionMessage		is a MessageField
			restricted
			"Release"

		DerivedNextActionMessage    is a DerivedField
			type is Text
			restricted
			if (Status.Printed)
				if (RequirePickingFeedback)
					return PickActionMessage
				else
				if (RequirePackingFeedback)
					return PackActionMessage
				else
					return ShipActionMessage
			else
			if (Status.Picked)
				if (RequirePackingFeedback)
					return PackActionMessage
				else
					return ShipActionMessage
			else
			if (Status.Packed)
				return ShipActionMessage
			else
			if (Status.Shipped)
				return ReleaseActionMessage

		DerivedDisplayPrefCardDetail is a DerivedField
			type is Boolean
			if (DisplayPreferenceCard)
				return true
			return false

	Conditions
		RecordExists
			restricted
			when (WarehouseShipment exists)

		HasBillOfLading
			restricted
			classic name is BILL-OF-LADING
			when (BillOfLading entered)

		HasCarrier
			restricted
			classic name is CARRIER
			when (Carrier entered)

		IsCustomerOrder
			restricted
			classic name is CUSTORDER
			when (WarehouseDemand.DemandSystemCode.CustomerOrder)

		IsTaxEngineAndShipmentOnHold
			restricted
			when (TaxEntityRel.ThirdParty.TaxEngine
			and   TemporaryHold.SentForApproval)

		IsProcessShipmentBodsAndShipmentOnHold
			restricted
			when (BillingCompanyRel.ProcessShipmentBods
			and   WarehouseDemand.DemandSystemCode.CustomerOrder
			and   TemporaryHold.SentForApproval)

		IsShipmentOnHold
			restricted
			when (IsTaxEngineAndShipmentOnHold
			or	  IsProcessShipmentBodsAndShipmentOnHold)

		CustomerOrderDifferentDestination
			restricted
			classic name is DIFF-DHDR-DEST
			when (WarehouseDemand.DemandSystemCode.CustomerOrder
			and   Destination entered
			and   Destination != WarehouseDemandRel.Destination)

		IsLateShipment
			restricted
			when (ShipDate >  WarehouseDemandRel.RequestedShipDate)

		HasShippingMethod
			restricted
			classic name is METHOD-ENTERED
			when (ShippingMethod entered)

		CustomerOrderNoDestination
			restricted
			classic name is NO-DHDR-DEST
			when (WarehouseDemand.DemandSystemCode.CustomerOrder
			and   Destination not entered
			and   Destination = WarehouseDemandRel.Destination)

		IsOpen
			restricted
			when (Status <  4)

		IsPackingList
			restricted
			classic name is PACKLIST
			when (not PackingList)

		IsReadyToPack
			restricted
			classic name is RDY-TO-PACK
			when (RequirePackingFeedback
			and   (Status.Picked
			or    not RequirePickingFeedback
			and   Status.Printed))

		IsReadyToPick
			restricted
			classic name is RDY-TO-PICK
			when (Status.Printed
			and   RequirePickingFeedback)

		IsReadyToShip
			restricted
			classic name is RDY-TO-SHIP
			when (Status.Packed
			or    not RequirePackingFeedback
			and   Status.Picked
			or    not RequirePackingFeedback
			and   not RequirePickingFeedback
			and   Status.Printed)

		IsReadyToInvoice
			restricted
			classic name is READY-TO-INVC
			when (WarehouseDemand.DemandSystemCode.CustomerOrder
			and   Status.Released)

		IsReleased
			restricted
			when (Status.Released)

		IsReleasedRequisition
			restricted
			classic name is REQ-RELEASED
			when (WarehouseDemand.DemandSystemCode.Requisitions
			and   Status.Released)

		IsRequisition
			restricted
			classic name is REQHEADER
			when (WarehouseDemand.DemandSystemCode.Requisitions)

		HasRouteStop
			restricted
			classic name is ROUTE
			when (RouteStop entered)

		CustomerOrderSameDestination
			restricted
			classic name is SAME-DHDR-DEST
			when (WarehouseDemand.DemandSystemCode.CustomerOrder
			and   Destination entered
			and   Destination = WarehouseDemandRel.Destination)

		IsShipped
			when (Status.Shipped)

		WorkOrderNoDestination
			restricted
			classic name is WO-DHDR-DEST
			when (WarehouseDemand.DemandSystemCode.CustomerOrder
			and   Destination not entered
			and   Destination != WarehouseDemandRel.Destination)

		DemandNotOnHold
			restricted
			when (!WarehouseDemandRel.OnHold)

		HasKitItemOptions
			restricted
			when (WarehouseDemandLineRel.KitType.MakeToOrderKit
			and   !WarehouseDemandLineRel.KitComplete)

		IsPickOrPack
			restricted
			when (RequirePickingFeedback
			or    RequirePackingFeedback)

		IsOnlyPickingRequired
			restricted
			when (RequirePickingFeedback
			and   not RequirePackingFeedback)

		IsOnlyPackingRequired
			restricted
			when (RequirePackingFeedback
			and   not RequirePickingFeedback)

		IsPrintedPickedOrPacked
			restricted
			when (Status.Printed
			or    Status.Picked
			or    Status.Packed)

		IsValidForBillOfLading
			restricted
			when ((Status.Packed
			and   IsPickOrPack)
			or   (Status.Printed
			and  !IsPickOrPack))

		HasProofOfDeliveryRequired
			when (CustomerOrderRel.ProofOfDeliveryRequired)

		IsNotPicked
			when (Status.Printed
			and	  !RequirePickingFeedback)

		IsOnlyPackingNeeded
			when (Status.Printed
			and   !IsOnlyPackingRequired)

		IsPicked
			when (Status.Picked
			and  !RequirePackingFeedback)

		IsToBeShipped
			when (IsNotPicked
			or   IsOnlyPackingNeeded
			or   IsPicked)

		IsCashOnDeliveryShipment
			when (IsCustomerOrder
			and   CustomerOrderRel.CashOnDelivery)

	 	HasAuditRecords
	 		when (WarehouseShipmentLineAuditsRel exists)

		NotClosed
			when (Status != 5)

		HasCatchWeightItem
			when (WarehouseShipmentLinesWithCatchWeightItemRel exists)
			
		IsOnHold
			restricted
			when (TemporaryHold.SentForApproval)

		InventoryTransactionExists
			when (InventoryTransactionsRel exists)

		HasShipmentLineWithExpiredLot
			restricted
			when (WarehouseShipmentLinesWithExpiredLotsRel exists)

		
		IsValidForActorContext
			restricted
			when (GeneralLedgerCompanyRel.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)

		HasLinesWithSpecialHandling
			when (WarehouseShipmentLineWithSpecialHandlingRel exists)

		HasComponentWithSpecialHandling
			when (ComponentsWithSpecialHandlingRel exists)
		

		RequestingLocationIsParLocation
			when (RequisitionRel.Requisition.RequestingLocation.ParLocation)
		
		IsPickedByHandheld
			when (MobileTimeStarted entered)
		
		HasShipmentLineDetailsRecord
			when (WarehouseShipmentLineDetailRel exists)

		HasShipmentDetailTracking
			when (MobileSupplyChainShipmentDetailTrackingRel exists)
		
		HasUDIDetail
			when (InventoryUDIDetailRel exists)
		
		IsValidForDelivery
			when (IsMSCMEnabled
			and	  InventoryLocation.MSCMDelivery
			and   WarehouseDemand.DemandSystemCode.Requisitions 
			and   not IsPickOrPack)
		
		IsTrackedByShipment
            when (IsValidForDelivery
			and   MobileSupplyChainLocationRel.ActualTrackDeliveryOption = MobileSupplyChainLocation.TrackDeliveryOption.Shipment)
		
		IsTrackedByShipmentOnly
			when (MobileSupplyChainLocationRel.ActualTrackDeliveryOption = MobileSupplyChainLocation.TrackDeliveryOption.Shipment)

		IsTrackedByShipmentLineOnly
            when (MobileSupplyChainLocationRel.ActualTrackDeliveryOption = MobileSupplyChainLocation.TrackDeliveryOption.ShipmentLine)
		
		IsTrackedByContainerOnly
            when (MobileSupplyChainLocationRel.ActualTrackDeliveryOption = MobileSupplyChainLocation.TrackDeliveryOption.Container)
		
		IsMSCMEnabled
			when (MobileSupplyChainConfigurationRel.MobileSupplyChainEnabled)

		IsPrintReport
			when (MobileSupplyChainLocationRel.ActualPrintPickingOptions	= MobileSupplyChainPrintingOptions.PrintDeliveryLabelAndDocument
			or    MobileSupplyChainLocationRel.ActualPrintPickingOptions	= MobileSupplyChainPrintingOptions.PrintDeliveryDocumentOnly)

		IsPrintLabel
			when (MobileSupplyChainLocationRel.ActualPrintPickingOptions	= MobileSupplyChainPrintingOptions.PrintDeliveryLabelAndDocument
			or    MobileSupplyChainLocationRel.ActualPrintPickingOptions	= MobileSupplyChainPrintingOptions.PrintDeliveryLabelOnly)

		IsPrintShipment
			when (IsMSCMEnabled
			and  (IsPrintReport
			or	  IsPrintLabel))


		NotAllWarehouseShipmentLinesAreLoaded
			when (ShipmentLoadLineRel not exists
			or   (ShipmentLoadLineRel exists
			and   ShipmentLoadLineTemplateRel exists))
    
		IsValidForDistributionClerk
			restricted
			when (NotAllWarehouseShipmentLinesAreLoaded
			and   DistributionClerkRel not exists      
			or    (DistributionClerkExistForCompany
			and    ((HasWarehouseZone
			and      DistributionClerkZoneRel exists)
			or      (not HasWarehouseZone
			and      DistributionClerkWithoutZoneAssignmentRel exists))) 
			or    (DistributionClerkExistForCompany
            and    DistributionClerkWithoutZoneAssignmentRel not exists)) 
	
		IsValidForPickingForClerk
			restricted
			when (not DistributionClerkRel.DisableShipmentPickingTask
			and   IsReadyToPick)

		IsValidForPackingForClerk
			restricted
			when (not DistributionClerkRel.DisableShipmentPackingTask
			and   IsReadyToPack)
		
		HasWarehouseZone
			restricted
			when (WarehouseZone entered)

		DistributionClerkExistForCompany
			restricted
			when (DistributionClerkRel exists
            and   DistributionClerkRel.Company = Company)

		ShipmentIsForReleaseOrShipping
			restricted
			when (IsReadyToShip
			or    IsShipped)

		IsPreferenceCardInUse
			restricted
			when (RequisitionRel.RequestingLocation.PreferenceCardOption.PreferenceCardsInUse 
			or   (RequisitionRel.RequestingLocation.PreferenceCardOption.DefaultToInventoryCompany and Company.PreferenceCardOption.PreferenceCardsInUse) 
			or   (RequisitionRel.RequestingLocation.PreferenceCardOption.DefaultToInventoryCompany and Company.PreferenceCardOption.DefaultToItemGroup and Company.ItemGroup.PreferenceCardsInUse)) 

		DisplayPreferenceCard
			restricted
			when (RequisitionRel.HasPreferenceCardTransaction
			and   IsPreferenceCardInUse)

	Relations

		WarehousePickListPrintIDMRel
			one-to-many relation to WarehousePickListPrintIDM
			Field Mapping uses symbolic key
				related.Company           = Company
				related.InventoryLocation = InventoryLocation
				related.WarehouseShipment = WarehouseShipment

		WarehousePickListPrintIDMHeaderRel
			one-to-one relation to WarehousePickListPrintIDM
			Field Mapping uses symbolic key
				related.Company           = Company
				related.InventoryLocation = InventoryLocation
				related.WarehouseShipment = WarehouseShipment

		AllWarehouseDemandLinesRel
			one-to-many relation to WarehouseDemandLine
			Field Mapping uses symbolic key
				related.Company                          = Company
				related.WarehouseDemand.DemandSystemCode = WarehouseDemand.DemandSystemCode
				related.WarehouseDemand.DemandDocument   = WarehouseDemand.DemandDocument
				related.WarehouseDemand.DemandCompany	 = WarehouseDemand.DemandCompany
				related.InventoryLocation 				 = InventoryLocation

		WarehouseShipmentLinesRel is a WarehouseShipmentLine set

		WarehouseDemandRel
			one-to-one relation to WarehouseDemand
			Field Mapping uses symbolic key
				related.Company                          = Company
				related.WarehouseDemand.DemandSystemCode = WarehouseDemand.DemandSystemCode
				related.WarehouseDemand.DemandDocument   = WarehouseDemand.DemandDocument
				related.WarehouseDemand.DemandCompany	 = WarehouseDemand.DemandCompany

		WarehouseDemandLineRel
			one-to-many relation to WarehouseDemandLine
			Field Mapping uses symbolic key
				related.Company                          = Company
				related.WarehouseDemand.DemandSystemCode = WarehouseDemand.DemandSystemCode
				related.WarehouseDemand.DemandDocument   = WarehouseDemand.DemandDocument
		 		related.WarehouseDemand.DemandCompany	 = WarehouseDemand.DemandCompany
				related.InventoryLocation 				 = InventoryLocation
			Instance Selection
				where (related.Item entered)
				
		RequisitionLineRel
			one-to-many relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.Requisition				 		 = WarehouseDemand.DemandDocument
				related.RequisitionLine			   	 	 = LocalWarehouseShipmentLine

		InventoryTransactionsRel
			one-to-one relation to InventoryTransaction
			Field Mapping uses ByOriginatingTransaction
				related.OriginatingTransaction 			= reference to this instance

		InventoryTransactionLinesRel
			one-to-many relation to InventoryTransactionLine
			Field Mapping uses symbolic key
				related.Company                          = Company
				related.InventoryLocation 				 = InventoryLocation
				related.InventoryTransaction			 = LocalInventoryTransaction
				related.TransactionSystemCode			 = WarehouseDemand.DemandSystemCode

		OtherWarehouseShipmentsForMergeRel
			one-to-many relation to WarehouseShipment
			Field Mapping uses Set7
				related.Company 						 = Company
				related.WarehouseDemand					 = WarehouseDemand
			Instance Selection
				where (related.WarehouseShipment		!= WarehouseShipment
				and    related.InventoryLocation 		 = InventoryLocation
				and    related.Destination 		 		 = Destination
				and    related.IsPrintedPickedOrPacked)

		OtherWarehouseShipmentLinesRel
			one-to-many relation to WarehouseShipmentLine
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.InventoryLocation				 = InventoryLocation
				related.WarehouseShipment				 = LocalShipment

		WarehouseShipmentLineWithExpiringLotRel
			one-to-many relation to WarehouseShipmentLine
			Field Mapping uses symbolic key
				related.Company							= Company
				related.InventoryLocation				= InventoryLocation
				related.WarehouseShipment				= WarehouseShipment
			Instance Selection
				where (related.HasDetailWithExpiringLot)

		WarehouseShipmentLinesWithExpiredLotsRel
			one-to-many relation to WarehouseShipmentLine
			Field Mapping uses symbolic key
				related.Company							= Company
				related.InventoryLocation				= InventoryLocation
				related.WarehouseShipment				= WarehouseShipment
			Instance Selection
				where (related.HasDetailWithExpiredLot)

		WarehouseShipmentLinesWithCatchWeightItemRel
			one-to-many relation to WarehouseShipmentLine
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.InventoryLocation				 = InventoryLocation
				related.WarehouseShipment				 = WarehouseShipment
			Instance Selection
				where (related.IsCatchWeightItem)

		ShipmentLineCopiedRel
			one-to-one relation to WarehouseShipmentLine
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.InventoryLocation				 = InventoryLocation
				related.WarehouseShipment				 = WarehouseShipment
				related.WarehouseShipmentLine			 = LocalShipmentLine

		BillOfLadingRel
			one-to-one relation to BillOfLading
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.BillOfLading					 = old BillOfLading

		WarehouseShipmentTrackingRel is a WarehouseShipmentTracking set

		WarehouseShipmentTrackingForMergeRel
			one-to-many relation to WarehouseShipmentTracking
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.InventoryLocation			     = InventoryLocation
				related.WarehouseShipment				 = LocalShipment








		RequisitionRel
			one-to-one relation to Requisition
			Field Mapping uses symbolic key
				related.Company                          = CompanyAndLocation.RequestingCompany
				related.Requisition						 = WarehouseDemand.DemandDocument

		CustomerOrderRel
			one-to-one relation to CustomerOrder
			Field Mapping uses symbolic key
				related.Company                          = Company
				related.CustomerOrder					 = WarehouseDemand.DemandDocument

		WarehouseShipmentLineAuditsRel
			one-to-many relation to WarehouseShipmentLineAudit
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.InventoryLocation				 = InventoryLocation
				related.WarehouseShipment				 = WarehouseShipment

		WarehouseShipmentLineAuditsForBackOrderRel
			one-to-many relation to WarehouseShipmentLineAudit
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.InventoryLocation				 = InventoryLocation
				related.WarehouseShipment 				 = WarehouseShipment
			Instance Selection
				where (related.ActionCode.Backorder)

		PartialOrNoBackorderedShipmentLinesRel
			one-to-many relation to WarehouseShipmentLine
			Field Mapping uses symbolic key
				related.Company						 = Company
				related.InventoryLocation				 = InventoryLocation
				related.WarehouseShipment				 = WarehouseShipment
			Instance Selection
				where (related.HasPartialOrNoBackorder)

		IntrastatPortCodeRel
			one-to-one relation to IntrastatPortCode
			Field Mapping uses symbolic key
				related.Country					= InventoryLocation.PostalAddress.Country
				related.IntrastatPortCode		= PortCode

		IntrastatPortCodeForInventoryLocationRel
			one-to-many relation to IntrastatPortCode
			Field Mapping uses symbolic key
				related.Country					= InventoryLocation.PostalAddress.Country 



		PurgeWarehouseShipmentLineRel is a WarehouseShipmentLine set
			Instance Selection
				include deleted records

		PurgeWarehouseShipmentTrackingRel is a WarehouseShipmentTracking set
			Instance Selection
				include deleted records

		WarehousePackingListBackorderedLinesRel
			one-to-many relation to WarehouseDemandLine
			Field Mapping uses symbolic key
				related.Company                          = Company
				related.WarehouseDemand.DemandSystemCode = WarehouseDemand.DemandSystemCode
				related.WarehouseDemand.DemandDocument   = WarehouseDemand.DemandDocument
				related.WarehouseDemand.DemandCompany	 = WarehouseDemand.DemandCompany
				related.InventoryLocation 				 = InventoryLocation
			Instance Selection
				where (related.IsLineFullyBackordered
				and    TransientIncludeBackorders = "Yes")


		FSMBODConfigurationParameterRel
        	one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
            	related.FSMBODConfigurationParameter 		= LocalConfigurationParameter

		FSMBODConfigurationRel
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 1
				related.FSMBODConfiguration.Noun 		= "Shipment"
				related.FSMBODConfiguration.Direction 	= 1
		
		FSMBODConfigurationRelation
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 2
				related.FSMBODConfiguration.Noun 		= "Shipment"
				related.FSMBODConfiguration.Direction 	= 1
		
		FSMInboundBODTrackerRel
            one-to-one relation to FSMInboundBODTracker
            Field Mapping uses symbolic key
                related.FSMInboundBODTracker	= LocalFSMInboundBODTracker
                
		WarehouseShipmentLineRel
			one-to-many relation to WarehouseShipmentLine
			delete cascades
			Field Mapping uses symbolic key
				related.Company							 = Company
				related.InventoryLocation				 = InventoryLocation
				related.WarehouseShipment 			   	 = WarehouseShipment
		
	 	WarehouseShipmentLineRelation
		 	one-to-many relation to WarehouseShipmentLine
		 	delete cascades
		 	Field Mapping uses symbolic key
		 		related.Company							 = Company
		 		related.InventoryLocation				 = InventoryLocation
		 		related.WarehouseShipment 			   	 = WarehouseShipment
		 	Instance Selection
		 		where (related.WarehouseShipmentLine	 = LocalWarehouseShipmentLine)
				
		FSMBODGLCCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "CSFGLC"
            	related.FSMBODCrossReference.DestinationField 	= "DESTAE"
            Instance Selection
				where (related.SourceValue	= DerivedCrossGLC )

#ifdef module integration

		FSMBODConfigurationPulseAlertRel
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 2
				related.FSMBODConfiguration.Noun 		= "PulseAlert"
				related.FSMBODConfiguration.Direction 	= 1

		FSMBODConfigurationDetailPulseAlertRel
			one-to-many relation to FSMBODConfigurationDetail
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 			= 2
				related.FSMBODConfiguration.Noun 			= "PulseAlert"
				related.FSMBODConfiguration.Direction 		= 1
			Instance Selection
				where (related.Alert						= LocalPulseAlertTriggerFrom
				and	   related.Enable)
#endif             		

       	TaxEntityRel				 
        	one-to-one relation to TaxEntity
    		Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= Company.FinanceEnterpriseGroup
        		related.TaxEntity 						= Company.AccountingEntity
                        		
		PickListIDMJobRel
			one-to-many relation to IDMJob
			Field Mapping uses ByBatchID
				related.Actor	  = actor
			Instance Selection
				where (related.BatchID = LocalIDMBatchID)
				
		GeneralLedgerCompanyRel
			one-to-one relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
				related.Company		= Company

		BillingCompanyRel
			one-to-one relation to BillingCompany
			Field Mapping uses symbolic key
				related.Company		= Company

		WarehouseShipmentLineWithSpecialHandlingRel is a WarehouseShipmentLine set
			Instance Selection
				where (related.HasSpecialHandling)

		ComponentsWithSpecialHandlingRel
			one-to-many relation to WarehouseShipmentLineComponent
			Field Mapping uses symbolic key
				related.Company					= Company
				related.InventoryLocation		= InventoryLocation
				related.WarehouseShipment		= WarehouseShipment
			Instance Selection
				where (related.HasSpecialHandling)
		

		MobileSupplyChainConfigurationRel
            one-to-one relation to MobileSupplyChainConfiguration
            Field Mapping uses symbolic key
                related.MobileSupplyChainConfiguration  = Company.FinanceEnterpriseGroup
		
		MobileSupplyChainLocationRel
			one-to-one relation to MobileSupplyChainLocation
			Field Mapping uses symbolic key
				related.Company			            = Company
				related.MobileSupplyChainLocation	= InventoryLocation
		
		WarehouseShipmentLineDetailRel
			one-to-many relation to WarehouseShipmentLineDetail
			Field Mapping uses symbolic key
				related.Company                        = Company
				related.InventoryLocation              = InventoryLocation
				related.WarehouseShipment              = WarehouseShipment
		
		MobileSupplyChainSavedWarehouseShipmentRel
			one-to-many relation to WarehouseShipmentLine
			Field Mapping uses symbolic key
				related.Company               	= Company
				related.InventoryLocation     	= InventoryLocation
				related.WarehouseShipment     	= WarehouseShipment
			Instance Selection
				where (related.MobilePickQuantityUOM entered)
		
		MobileSupplyChainShipmentDetailTrackingRel
			one-to-many relation to MobileSupplyChainShipmentDetailTracking
			Field Mapping uses symbolic key
				related.Company					= Company
				related.InventoryLocation     	= InventoryLocation
				related.WarehouseShipment     	= WarehouseShipment
		
		MobileSupplyChainDeliveryTicketRel
			one-to-many relation to MobileSupplyChainDeliveryTicket
			Field Mapping uses symbolic key
				related.Company						= Company
				related.MobileSupplyChainLocation   = InventoryLocation
			Instance Selection
				where (related.OriginatingTransaction	= reference to this instance)

		InventoryUDIDetailRel
			one-to-many relation to InventoryUDIDetail
			Field Mapping uses symbolic key
				related.Company											= Company
				related.InventoryLocation     							= InventoryLocation
			Instance Selection
				where (related.InventoryUDIDetail.WarehouseShipment		= WarehouseShipment)
			

		ShipmentLoadLineRel
			one-to-many relation to ShipmentLoadLine
			Field Mapping uses ByWarehouseShipmentLine
				related.Company               = Company
				related.InventoryLocation     = InventoryLocation
				related.WarehouseShipment     = WarehouseShipment

		ShipmentLoadLineTemplateRel
			one-to-many relation to ShipmentLoadLineTemplate
			Field Mapping uses ByWarehouseShipmentLine
				related.Company               = Company
                related.InventoryLocation     = InventoryLocation
                related.WarehouseShipment     = WarehouseShipment
			Instance Selection
				where (related.AddShipmentLine = false)

		DistributionClerkRel
			one-to-one relation to DistributionClerk
			Field Mapping uses symbolic key
				related.HROrganization				    = actor.agent(Employee).Employee.HROrganization
				related.DistributionClerk			    = actor.agent(Employee).Employee

		DistributionClerkZoneRel
			one-to-one relation to DistributionClerkZone
			Field Mapping uses symbolic key
				related.Company							= Company
				related.InventoryLocation				= InventoryLocation
				related.DistributionClerk			    = actor.agent(Employee).Employee
				related.WarehouseZone					= WarehouseZone

		ShipmentLineDetailForDistributionClerkRel
			one-to-many relation to WarehouseShipmentLineDetail
			Field Mapping uses symbolic key
				related.Company                        	= Company
				related.InventoryLocation              	= InventoryLocation
				related.WarehouseShipment              	= WarehouseShipment

		DistributionClerkWithoutZoneAssignmentRel
			one-to-many relation to DistributionClerkZone
			Field Mapping uses symbolic key
				related.Company						 		= Company
				related.InventoryLocation					= InventoryLocation
				related.DistributionClerk					= DistributionClerkRel.DistributionClerk

    Sets

		Set10
			indexed
			Instance Selection
				where (IsOpen)
			Sort Order
				Company
				InventoryLocation
				WarehouseShipment descending

		Set2
			indexed
			Instance Selection
				where (HasBillOfLading)
			Sort Order
				Company
				InventoryLocation
				BillOfLading
				WarehouseShipment

		Set3
			indexed
			Sort Order
				Company
				InventoryLocation
				Carrier
				BillOfLading
				WarehouseShipment

		Set4
			indexed
			Instance Selection
				where (IsShipped)
			Sort Order
				Company
				InventoryLocation
				WarehouseBatch
				WarehouseShipment

		Set5
			indexed
			Sort Order
				Company
				InventoryLocation
				WarehouseBatch
				WarehouseShipment

		Set6
			indexed
			Instance Selection
				where (IsReadyToInvoice)
			Sort Order
				Company
				InventoryLocation
				WarehouseDemand.DemandDocument
				WarehouseShipment

		Set7
			indexed
			Sort Order
				Company
				WarehouseDemand
				WarehouseShipment
				InventoryLocation

		Set8
			indexed
			Sort Order
				Company
				InventoryLocation
				WarehouseDemand
				WarehouseShipment

		Set9
			indexed
			Sort Order
				Company
				WarehouseShipment
				InventoryLocation

		DemandSet
			duplicates
			Sort Order
				Company
				InventoryLocation
				WarehouseDemand.DemandSystemCode
				WarehouseDemand.DemandDocument
				WarehouseDemand.DemandCompany

		ByWarehouseZone
			indexed
			Sort Order
				Company
				InventoryLocation
				WarehouseZone
				WarehouseDemand
				WarehouseShipment

	Field Rules
		FreightCode
			if (FreightCharges entered)
				required							


		FreightCharges
			if (FreightCode.BillingFreightCharge.Required)
				required

   			constraint (!FreightCode.BillingFreightCharge.NotAllowed)
   				"FreightIsNotAllowedOnShipment;FreightCodeDoesNotSupportCharges"

   			constraint (!RequireFreight.NotAllowed)
   				"FreightIsNotAllowedOnShipment"




			constraint (FreightCharges > 0)
				"FreightChargeCannotBeNegative"

		PackDate
			constraint (PickDate <= PackDate)
				"PackDateShouldBeAfterPickDate"

		PickDate
			constraint (PrintDate <= PickDate)
				"PickDateShouldBeAfterPrintDate"

		BillOfLading
			if (!IsValidForBillOfLading)
				cannot be entered
					"CannotEnterBillOfLading;ShipmentIn<Status>State;ShipmentShouldBeReadyToBeShipped"		

			if (BillOfLading exists)
				constraint (BillOfLading.Carrier = Carrier)
					"BillOfLadingIsAssignedWithDifferentCarrier"			

				constraint (BillOfLading.Location = InventoryLocation)
					"LocationOfBillOfLadingAndShipmentLocationShouldBeSame"

		Carrier
			constraint (!FreightCode.BillingFreightCarrier.NotAllowed)
				"FreightCodeDoesNotAllowCarrier"

			if (HasBillOfLading)
				required
					"ShipmentCarrierMustBeSuppliedIfAssigningBillOfLading"

		PortCode
			force default to TransientIntrastatPortCode
			if (PortCode entered)
				constraint (IntrastatPortCodeRel exists)
					"LoadingPortCodeDoesNotExist"


		MSCMReportPrinter
			if (action type.Create
			and IsMSCMEnabled)
				default to MobileSupplyChainLocationRel.DerivedDefaultMobileSupplyChainReportPrinter

		MSCMLabelPrinter
			if (action type.Create
			and IsMSCMEnabled)
				default to MobileSupplyChainLocationRel.DerivedDefaultMobileSupplyChainLabelPrinter


	Rule Blocks

		ActionValidCondition
			constraint (DemandNotOnHold)
				"DemandIsOnHold"

		UpdateBillOfLading
			if (old BillOfLading entered and BillOfLading changed)
				invoke UpdateFromWarehouse BillOfLadingRel
					invoked.PrmNumberOfShipments 	 	= -1

			if (BillOfLading entered)
				if (BillOfLading not exist)
					invoke Create BillOfLading
						fill in fields from this instance
						invoked.Location				= InventoryLocation
						invoked.NumberOfShipments		= 1
				else
					invoke UpdateFromWarehouse BillOfLading
						invoked.PrmNumberOfShipments 	= 1

		CreateWarehouseShipmentTracking
			if (not IsMSCMEnabled
			and InventoryLocation.MSCMDelivery
			and WarehouseShipmentTrackingRel not exists
			and not FromMSCMFlag)
				invoke QuickCreate WarehouseShipmentTracking
					fill in fields from this instance
					invoked.WarehouseShipmentTracking = 1
					invoked.PickingSource 			  = 2

	Actions
		FastUpdate is an Update Action
			restricted
			bypass field rules
			
		CreateWarehousePicklistPrintIDM is a Set Action
			restricted
			Parameters
				ParamCompany					is a InventoryCompany
				ParamInventoryLocation			is a InventoryLocation
				ParamWarehouseBatch				is a WarehouseBatch

			Instance Selection
				where (Company 		  = ParamCompany
				and InventoryLocation = ParamInventoryLocation
				and WarehouseBatch    = ParamWarehouseBatch)

			Action Rules
				Instance Rules
					if (WarehousePickListPrintIDMHeaderRel not exists)
						invoke CreatePickListRecord WarehousePickListPrintIDM
							invoked.Company					= Company
							invoked.InventoryLocation		= InventoryLocation
							invoked.WarehouseShipment		= WarehouseShipment


		GenerateWarehousePicklistForAllShipment is a Set Action
			restricted
			Parameters
				ParamCompany					is a InventoryCompany
				ParamInventoryLocation			is a InventoryLocation
				ParamWarehouseBatch				is a WarehouseBatch
				ParamPrintOption				is Numeric size 1
					States
						ByShipmentDocumentLine                 value is 1
							default label is "By Shipment-Document Line"
						ByShipmentBinLotSerial                 value is 2
							default label is "By Shipment-Bin/Lot/Serial"
						ByShipmentBinLotSerialRequisitionBased value is 3
							default label is "By Shipment-Bin/Lot/Serial (Requisition Based)"
						ByBinItemUomLotSerial                  value is 4
							default label is "By Bin-Item/UOM/Lot/Serial"
				ParamIsReprinted				is Boolean
				ParamIncludeCost				is Boolean
		 		ParamDeliveryData				is Boolean
				ParamAllocateDetail				is Boolean
				ParamIncludeBackorders			is AlphaUpper 1
				ParamIncludeKillDetails			is AlphaUpper 1
				ParamExpectedShipDate			is Date
				ParamDocumentSource				is AlphaUpper 2
				ParamAllocationPurpose			is AlphaUpper 1
				ParamForcePreferredBin			is AlphaUpper size 1
				ParamReprintBatch				is Numeric 6
				ParamReprintShipment			is a WarehouseShipment
				ParamSourceDocument1			is like DemandDocument
				ParamSourceDocument2			is like DemandDocument
				ParamSourceDocument3			is like DemandDocument
				ParamSourceDocument4			is like DemandDocument
				ParamSourceDocument5			is like DemandDocument
				ParamSourceDocument6			is like DemandDocument
				ParamSourceDocument7			is like DemandDocument
				ParamSourceDocument8			is like DemandDocument
				ParamSourceDocument9			is like DemandDocument
				ParamSourceDocument10			is like DemandDocument
				ParamSourceDocument11			is like DemandDocument
				ParamSourceDocument12			is like DemandDocument
				ParamRequestingLocation			is like RequestingLocation
				ParamCustomer					is like Customer
				ParamItem						is like Item
				ParamProcessType				is like WarehouseProcessType
				ParamFromAllocationPriority		is Numeric 2
				ParamToAllocationPriority		is Numeric 2
				ParamShipTo						is like CustomerShipTo
				ParamCarrier					is like Vendor
				ParamRouteDay					is like DayOfWeek
				ParamRoute						is like Route
				ParamRouteStop					is Numeric size 4
				ParamAllRoute					is AlphaUpper size 1
				ParamSkipInsufficientDetails	is AlphaUpper size 1
				ParamIDMPrinter					is an IDMPrinter
				ParamPrintRequester				is AlphaUpper size 1
				ParamConsolidateFile			is Boolean

			Local Fields
				LocalBatchID					is an IDMPID
			Instance Selection
				where (Company 		  = ParamCompany
				and InventoryLocation = ParamInventoryLocation
				and WarehouseBatch    = ParamWarehouseBatch)

			Action Rules
				Set Rules
					Entrance Rules
						LocalBatchID	=	 current timestamp
						LocalIDMBatchID	= 	 LocalBatchID
					Exit Rules
						if (ParamConsolidateFile)
							if (not ParamPrintOption.ByBinItemUomLotSerial)
								invoke ConsolidateFile
									invoked.ParamCompany			= ParamCompany
									invoked.ParamInventoryLocation	= ParamInventoryLocation
									invoked.ParamWarehouseBatch		= ParamWarehouseBatch
									invoked.ParamBatchID			= LocalBatchID
									invoked.ParamPrintOption		= ParamPrintOption
									invoked.ParamIDMPrinter			= ParamIDMPrinter							
				Instance Rules
					if(ParamPrintOption.ByShipmentDocumentLine)
						invoke CreateWarehousePickListPrintOne WarehousePickListPrintIDM
							invoked.PrmAllocateDetail		= ParamAllocateDetail
							invoked.PrmIncludeBackorders	= ParamIncludeBackorders
							invoked.PrmIncludeKillDetails	= ParamIncludeKillDetails
							invoked.PrmExpectedShipDate		= ParamExpectedShipDate
							invoked.PrmDocumentSource		= ParamDocumentSource
							invoked.PrmAllocationPurpose	= ParamAllocationPurpose
							invoked.PrmForcePreferredBin	= ParamForcePreferredBin
							invoked.PrmReprintBatch			= ParamReprintBatch
							invoked.PrmReprintShipment		= ParamReprintShipment
							invoked.PrmSourceDocument1		= ParamSourceDocument1
							invoked.PrmSourceDocument2		= ParamSourceDocument2
							invoked.PrmSourceDocument3		= ParamSourceDocument3
							invoked.PrmSourceDocument4		= ParamSourceDocument4
							invoked.PrmSourceDocument5		= ParamSourceDocument5
							invoked.PrmSourceDocument6		= ParamSourceDocument6
							invoked.PrmSourceDocument7		= ParamSourceDocument7
							invoked.PrmSourceDocument8		= ParamSourceDocument8
							invoked.PrmSourceDocument9		= ParamSourceDocument9
							invoked.PrmSourceDocument10		= ParamSourceDocument10
							invoked.PrmSourceDocument11		= ParamSourceDocument11
							invoked.PrmSourceDocument12		= ParamSourceDocument12
							invoked.PrmRequestingLocation	= ParamRequestingLocation
							invoked.PrmCustomer				= ParamCustomer
							invoked.PrmItem					= ParamItem
							invoked.PrmProcessType			= ParamProcessType
							invoked.PrmFromAllocationPriority = ParamFromAllocationPriority
							invoked.PrmToAllocationPriority	= ParamToAllocationPriority
							invoked.PrmShipTo				= ParamShipTo
							invoked.PrmCarrier				= ParamCarrier
							invoked.PrmRouteDay				= ParamRouteDay
							invoked.PrmRoute				= ParamRoute
							invoked.PrmRouteStop			= ParamRouteStop
							invoked.PrmAllRoute				= ParamAllRoute
							invoked.PrmSkipInsufficientDetails = ParamSkipInsufficientDetails
							invoked.PrmPrintOption			= ParamPrintOption
							invoked.PrmIncludeCost			= ParamIncludeCost
							invoked.PrmDeliveryData 		= ParamDeliveryData
							invoked.PrmIDMPrinter			= ParamIDMPrinter
							invoked.PrmPrintRequester		= ParamPrintRequester
							invoked.PrmBatchID				= LocalBatchID
							invoked.PrmConsolidateFile		= ParamConsolidateFile
					else
					if(ParamPrintOption.ByShipmentBinLotSerial)
						invoke CreateWarehousePickListPrintTwo WarehousePickListPrintIDM
							invoked.PrmIncludeBackorders	= ParamIncludeBackorders
							invoked.PrmIncludeKillDetails	= ParamIncludeKillDetails
							invoked.PrmExpectedShipDate		= ParamExpectedShipDate
							invoked.PrmDocumentSource		= ParamDocumentSource
							invoked.PrmAllocationPurpose	= ParamAllocationPurpose
							invoked.PrmForcePreferredBin	= ParamForcePreferredBin
							invoked.PrmReprintBatch			= ParamReprintBatch
							invoked.PrmReprintShipment		= ParamReprintShipment
							invoked.PrmSourceDocument1		= ParamSourceDocument1
							invoked.PrmSourceDocument2		= ParamSourceDocument2
							invoked.PrmSourceDocument3		= ParamSourceDocument3
							invoked.PrmSourceDocument4		= ParamSourceDocument4
							invoked.PrmSourceDocument5		= ParamSourceDocument5
							invoked.PrmSourceDocument6		= ParamSourceDocument6
							invoked.PrmSourceDocument7		= ParamSourceDocument7
							invoked.PrmSourceDocument8		= ParamSourceDocument8
							invoked.PrmSourceDocument9		= ParamSourceDocument9
							invoked.PrmSourceDocument10		= ParamSourceDocument10
							invoked.PrmSourceDocument11		= ParamSourceDocument11
							invoked.PrmSourceDocument12		= ParamSourceDocument12
							invoked.PrmRequestingLocation	= ParamRequestingLocation
							invoked.PrmCustomer				= ParamCustomer
							invoked.PrmItem					= ParamItem
							invoked.PrmProcessType			= ParamProcessType
							invoked.PrmFromAllocationPriority = ParamFromAllocationPriority
							invoked.PrmToAllocationPriority	= ParamToAllocationPriority
							invoked.PrmShipTo				= ParamShipTo
							invoked.PrmCarrier				= ParamCarrier
							invoked.PrmRouteDay				= ParamRouteDay
							invoked.PrmRoute				= ParamRoute
							invoked.PrmRouteStop			= ParamRouteStop
							invoked.PrmAllRoute				= ParamAllRoute
							invoked.PrmSkipInsufficientDetails = ParamSkipInsufficientDetails
							invoked.PrmPrintOption			= ParamPrintOption
							invoked.PrmIncludeCost			= ParamIncludeCost
							invoked.PrmDeliveryData 		= ParamDeliveryData
							invoked.PrmIDMPrinter			= ParamIDMPrinter
							invoked.PrmPrintRequester		= ParamPrintRequester
							invoked.PrmBatchID				= LocalBatchID
							invoked.PrmConsolidateFile		= ParamConsolidateFile
					else
					if(ParamPrintOption.ByShipmentBinLotSerialRequisitionBased)
						invoke CreateWarehousePickListPrintThree WarehousePickListPrintIDM
							invoked.PrmAllocateDetail		= ParamAllocateDetail
							invoked.PrmIncludeCost			= ParamIncludeCost
							invoked.PrmDeliveryData 		= ParamDeliveryData
							invoked.PrmIncludeBackorders	= ParamIncludeBackorders
							invoked.PrmIncludeKillDetails	= ParamIncludeKillDetails
							invoked.PrmExpectedShipDate		= ParamExpectedShipDate
							invoked.PrmDocumentSource		= ParamDocumentSource
							invoked.PrmAllocationPurpose	= ParamAllocationPurpose
							invoked.PrmForcePreferredBin	= ParamForcePreferredBin
							invoked.PrmReprintBatch			= ParamReprintBatch
							invoked.PrmReprintShipment		= ParamReprintShipment
							invoked.PrmSourceDocument1		= ParamSourceDocument1
							invoked.PrmSourceDocument2		= ParamSourceDocument2
							invoked.PrmSourceDocument3		= ParamSourceDocument3
							invoked.PrmSourceDocument4		= ParamSourceDocument4
							invoked.PrmSourceDocument5		= ParamSourceDocument5
							invoked.PrmSourceDocument6		= ParamSourceDocument6
							invoked.PrmSourceDocument7		= ParamSourceDocument7
							invoked.PrmSourceDocument8		= ParamSourceDocument8
							invoked.PrmSourceDocument9		= ParamSourceDocument9
							invoked.PrmSourceDocument10		= ParamSourceDocument10
							invoked.PrmSourceDocument11		= ParamSourceDocument11
							invoked.PrmSourceDocument12		= ParamSourceDocument12
							invoked.PrmRequestingLocation	= ParamRequestingLocation
							invoked.PrmCustomer				= ParamCustomer
							invoked.PrmItem					= ParamItem
							invoked.PrmProcessType			= ParamProcessType
							invoked.PrmFromAllocationPriority = ParamFromAllocationPriority
							invoked.PrmToAllocationPriority	= ParamToAllocationPriority
							invoked.PrmShipTo				= ParamShipTo
							invoked.PrmCarrier				= ParamCarrier
							invoked.PrmRouteDay				= ParamRouteDay
							invoked.PrmRoute				= ParamRoute
							invoked.PrmRouteStop			= ParamRouteStop
							invoked.PrmAllRoute				= ParamAllRoute
							invoked.PrmSkipInsufficientDetails = ParamSkipInsufficientDetails
							invoked.PrmPrintOption			= ParamPrintOption
							invoked.PrmIDMPrinter			= ParamIDMPrinter
							invoked.PrmPrintRequester		= ParamPrintRequester
							invoked.PrmBatchID				= LocalBatchID
							invoked.PrmConsolidateFile		= ParamConsolidateFile


		CreateArrivalFile is an Instance Action
			restricted
			Action Rules
				invoke Create ShipmentArrival
					invoked.Company 		= Company
					invoked.Location 		= InventoryLocation
					invoked.ShipmentNumber	= WarehouseShipment


		UpdateStatusFromBillOfLading is an Instance Action
			restricted
			Parameters
				PrmFinish is Boolean

			Action Rules
				if (PrmFinish)
					if (Status.Printed)
						invoke Printed.Finish
						if (RequirePickingFeedback)
							invoke Picked.Finish
						if (RequirePackingFeedback)
							invoke Packed.Finish
					else
					if (Status.Picked)
						invoke Picked.Finish
						if (RequirePackingFeedback)
							invoke Packed.Finish
					else
						invoke Packed.Finish
				else
					if (Status.Picked)
						invoke Picked.Undo
					else
					if (Status.Packed)
						invoke Packed.Undo
					else
						invoke Shipped.Undo

		UpdateFromBillOfLading is an Instance Action
			restricted
			Parameters
				PrmFreightCharges is an InternationalAmount
				PrmFreightCode    is a BillingFreightCode
			Action Rules
				FreightCharges = PrmFreightCharges
				FreightCode	   = PrmFreightCode

		UnassignShipment is an Instance Action
			valid when (HasBillOfLading)
			Action Rules
				constraint (HasBillOfLading)
					"CannotUnassign;BillOfLadingIsNotEntered"

				constraint (Status.Printed)					
					"UndoAllFeedbackBeforeDeletingShipment"				

				invoke UpdateFromWarehouse BillOfLading
					invoked.PrmNumberOfShipments = -1

				initialize BillOfLading


		UpdateStatus is an Instance Action
			restricted
			Action Rules
				make transition to Closed

#ifdef module integration
		WHShipmentCreationAlert is an Instance Action
			restricted
			Parameters
			Action Rules
				invoke TriggerPulseAlert FSMBODConfigurationPulseAlertRel
					invoked.PrmActorGroup 	= "WAREHOUSEMANAGER"
					invoked.PrmMainXML 		= WHShipmentCreationPulseAlertXML
					invoked.PrmDescription	= WHShipmentCreationAlertDescription
					invoked.PrmBODID		= DerivedWHShipmentCreationBODID

		WHBatchCreationAlert is an Instance Action
			restricted
			Parameters
				PrmBatchNumber is Numeric size 12
			Action Rules
				LocalBatchNumber = PrmBatchNumber
				invoke TriggerPulseAlert FSMBODConfigurationPulseAlertRel
					invoked.PrmActorGroup 	= "WAREHOUSEMANAGER"
					invoked.PrmMainXML 		= WHBatchCreationPulseAlertXML
					invoked.PrmDescription	= WHBatchCreationAlertDescription
					invoked.PrmBODID		= DerivedWHBatchCreationBODID

		ShipmentReleasePulseAlert is an Instance Action
			restricted
			Parameters
			Action Rules
				invoke TriggerPulseAlert FSMBODConfigurationPulseAlertRel
					invoked.PrmActorGroup 	= "ORDERPROCESSINGMANAGER"
					invoked.PrmMainXML 		= ShipmentReleasePulseAlertXML
					invoked.PrmDescription	= ShipmentReleaseAlertDescription
					invoked.PrmBODID		= DerivedShipmentReleaseBODID
#endif
		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmAccountingEntity  is Alpha size 22
					default label is "AccountingEntity"
				PrmLocation          is Alpha size 22
					default label is "Location"
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"
				PrmVariationID       is Alpha size 22
					default label is "VariationID"
			Action Rules
				if (bod id.AccountingEntity != PrmAccountingEntity)
					bod id.AccountingEntity 	= PrmAccountingEntity
				if (bod id.Location != PrmLocation)
					bod id.Location				= PrmLocation
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord
				if (bod id.VariationID != PrmVariationID)
					bod id.VariationID			= PrmVariationID

		UpdateFromShipmentLine is an Instance Action
			restricted
			Parameters
				PrmStockVolume is a StockVolume
				PrmStockWeight is a StockWeight
			Action Rules
				if (PrmStockVolume entered)
					StockVolume += PrmStockVolume

				if (PrmStockWeight entered)
					StockWeight += PrmStockWeight

		Merge is an Instance Action
			valid when (IsPrintedPickedOrPacked)
			Action Rules
				constraint (IsPrintedPickedOrPacked)
					"CannotMerge;ShipmentIsReleased"			

				constraint (!BasedOnPurchaseOrderReceipt)
					"CannotMerge;ShipmentIsPurchaseOrderRelated"		

				constraint (OtherWarehouseShipmentsForMergeRel exists)			
					"NoShipmentsToMerge"

				for each OtherWarehouseShipmentsForMergeRel
					LocalShipment = each.WarehouseShipment

					constraint (Status = each.Status)
						"CannotMerge;ShipmentsMustHaveSameStatus"		

					constraint (WarehouseShipmentTrackingForMergeRel not exists)
						"CannotMerge;TrackingDetailsExistsForShipment"		

				if (WarehouseShipmentLinesRel exist)
					invoke Merge WarehouseShipmentLinesRel					
				else
					initialize LocalShipment
					for each OtherWarehouseShipmentsForMergeRel										
						LocalShipment = each.WarehouseShipment
						for each OtherWarehouseShipmentLinesRel
							LocalShipmentLine = each.WarehouseShipmentLine
							if (ShipmentLineCopiedRel not exists)
								invoke Create WarehouseShipmentLine
									fill in fields from each
									invoked.Company					= Company
									invoked.InventoryLocation		= InventoryLocation
									invoked.WarehouseShipment		= WarehouseShipment
									invoked.WarehouseShipmentLine 	= LocalShipmentLine

					invoke Merge WarehouseShipmentLinesRel

				if (WarehousePickListPrintIDMHeaderRel exists)
					invoke UpdateTotals WarehousePickListPrintIDMHeaderRel

				if (Status.Printed)
					invoke Printed.Delete OtherWarehouseShipmentsForMergeRel
				else
				if (Status.Picked)
					invoke Picked.Delete OtherWarehouseShipmentsForMergeRel
				else
					if (Status.Packed)
						invoke Packed.Delete OtherWarehouseShipmentsForMergeRel

		UpdateStatusFromShipmentAckBOD is an Instance Action 
			restricted
			Parameters
			Action Rules
				include ActionValidCondition

				invoke Finish WarehouseShipmentLinesRel


				include CreateWarehouseShipmentTracking

				make transition to Shipped


		TriggerProcessShipmentOutbound is an Instance Action
			restricted
			Parameters
			Action Rules




				if(WarehouseDemand.DemandSystemCode.Requisitions)
					if (Company.FinanceEnterpriseGroup.BODTrigger)
						LocalTitle = "EG:"+Company.FinanceEnterpriseGroup+" CO:"+Company+" INVL:"+InventoryLocation+" WS:"+WarehouseShipment
						increment bod id.VariationID
						ActionCode = ActionCode.Update
						if (action type.Create)
							ActionCode = ActionCode.Create
						trigger PayablesService.WarehouseShipmentService PA service
							resume on error
							title is "<LocalTitle>"
							Criteria
								Company.FinanceEnterpriseGroup
								Company
							Variables
								ActionCode
								include persistent fields from WarehouseShipment
								include persistent fields from RequisitionRel.Requisition
								include persistent fields from RequisitionRel.Requisition.RequestingLocation
								Company.FinanceEnterpriseGroup
									variable name is FinanceEnterpriseGroup
								RequisitionRel.Requisition.Company.Name
									variable name is InventoryCompanyName
								RequisitionRel.Requisition.FromCompanyLocation.FromLocation.Name
									variable name is InventoryLocationName
								RequisitionRel.Requisition.RequestingLocation.Company.Name
									variable name is RequestingCompanyName
								RequisitionRel.Requisition.RequestingLocation.ProcessLevel.Name
									variable name is ProcessLevelName
								Company.GeneralLedgerCompany.AccountingEntity
									variable name is AccountingEntity





				if(WarehouseDemand.DemandSystemCode.Requisitions or WarehouseDemand.DemandSystemCode.CustomerOrder)
					if (Company.FinanceEnterpriseGroup.BODTrigger)
						LocalTitle = "EG:"+Company.FinanceEnterpriseGroup+" CO:"+Company+" INVL:"+InventoryLocation+" WS:"+WarehouseShipment
						increment bod id.VariationID
						ActionCode = ActionCode.Update
						if (action type.Create)
							ActionCode = ActionCode.Create
						trigger "ShipmentService" PA service
							resume on error
							title is "<LocalTitle>"
							Criteria
								Company.FinanceEnterpriseGroup
								Company
							Variables
								ActionCode
								include persistent fields from WarehouseShipment
								include persistent fields from RequisitionRel.Requisition
								include persistent fields from RequisitionRel.Requisition.RequestingLocation
								include persistent fields from InventoryLocation
								include persistent fields from CustomerOrderRel.CustomerShipTo
								Company.FinanceEnterpriseGroup
									variable name is FinanceEnterpriseGroup
								RequisitionRel.Requisition.Company.Name
									variable name is InventoryCompanyName
								RequisitionRel.Requisition.FromCompanyLocation.FromLocation.Name
									variable name is InventoryLocationName
								RequisitionRel.Requisition.RequestingLocation.Company.Name
									variable name is RequestingCompanyName
								RequisitionRel.Requisition.RequestingLocation.ProcessLevel.Name
									variable name is ProcessLevelName
								Company.GeneralLedgerCompany.AccountingEntity
									variable name is AccountingEntity
								CustomerOrderRel.Customer.Name
									variable name is CustomerName
								CustomerOrderRel.Customer
									variable name is Customer
								Company.GeneralLedgerCompany.AccountingEntity.TaxEntity.TaxID
									variable name is EntityTaxID
								CustomerOrderRel.Customer.TaxID
									variable name is CustomerTaxID
								Carrier.TaxID
									variable name is VendorTaxID
								Carrier.Vendor
									variable name is Vendor
								Carrier.VendorGroup
									variable name is VendorGroup
								Carrier.VendorName
									variable name is VendorName
								CustomerOrderRel.Customer.PostalAddress.StateProvince
									variable name is CustomerStateProvince								
								Company.GeneralLedgerCompany.AccountingEntity.AddressCode.PostalAddress.Country
									variable name is CountryCode
									
		TriggerBROrderToInvoiceOutbound is an Instance Action
			default label is untranslatable
			restricted
			Action Rules
				if(WarehouseDemand.DemandSystemCode.CustomerOrder)
					if (Company.FinanceEnterpriseGroup.BODTrigger)
						LocalTitle = "EG:"+Company.FinanceEnterpriseGroup+" CO:"+Company+" INVL:"+InventoryLocation+" WS:"+WarehouseShipment
						increment bod id.VariationID
						ActionCode = ActionCode.Update
						if (action type.Create)
							ActionCode = ActionCode.Create
						trigger "BROrderWarehouseShipmentService" PA service
							resume on error
							title is "<LocalTitle>"
							Criteria
								Company.FinanceEnterpriseGroup
								Company
							Variables
								ActionCode
								include persistent fields from WarehouseShipment
								include persistent fields from CustomerOrderRel.CustomerShipTo
								include persistent fields from CustomerOrderRel
								Company.FinanceEnterpriseGroup
									variable name is FinanceEnterpriseGroup
								bod id.VariationID
									variable name is VariationId
								Company.GeneralLedgerCompany.AccountingEntity
									variable name is Accountingentity
								Carrier.TaxID
									variable name is VendorTaxID

								
		TriggerWHBatchCreationAlert is an Instance Action
			restricted
			Parameters
				PrmBatchNumber is Numeric size 12

			Action Rules
				if(Company.AllocationMethod.Batch)
					trigger "WHBatchCreationService" PA service
						resume on error
						title is "EG:<Company.FinanceEnterpriseGroup>CO:<Company>"
						Criteria
							Company.FinanceEnterpriseGroup
							Company
						Variables
							Company
								variable name is Company
							InventoryLocation
								variable name is Location
							WarehouseShipment
								variable name is WarehouseShipment
							WarehouseDemand.DemandSystemCode
								variable name is SystemCode
							PrmBatchNumber
								variable name is BatchNumber
							WarehouseDemand.DemandDocument
								variable name is DocNumber
							Destination
								variable name is Destination
							CustomerShipTo
								variable name is CustomerShipTo
							CompanyAndLocation.RequestingCompany
								variable name is RequestingCompany
							CompanyAndLocation.RequestingLocation
								variable name is RequestingLocation
							Carrier
								variable name is Carrier
							RouteHeader
								variable name is RouteHeader
							RouteStop
								variable name is RouteStop
#ifdef module integration
					if (FSMBODConfigurationPulseAlertRel.Enable)
						LocalPulseAlertTriggerFrom = "FSM_ION_WHBatchCreationAlert"
			   			if(FSMBODConfigurationDetailPulseAlertRel.Enable)
			   				invoke WHBatchCreationAlert
			   					invoked.PrmBatchNumber	= PrmBatchNumber
#endif
				else
					if(Company.AllocationMethod.Online)
						trigger "WHShipmentCreationService" PA service
							resume on error
							title is "EG:<Company.FinanceEnterpriseGroup>CO:<Company>"
							Criteria
								Company.FinanceEnterpriseGroup
								Company
							Variables
								Company
									variable name is Company
								InventoryLocation
									variable name is Location
								WarehouseShipment
									variable name is WarehouseShipment
								WarehouseDemand.DemandSystemCode
									variable name is SystemCode
								PrmBatchNumber
									variable name is BatchNumber
								WarehouseDemand.DemandDocument
									variable name is DocNumber
								CompanyAndLocation.RequestingCompany
									variable name is RequestingCompany
								CompanyAndLocation.RequestingLocation
									variable name is RequestingLocation
								RouteHeader
									variable name is RouteHeader
								RouteStop
									variable name is RouteStop
#ifdef module integration
		   				if (FSMBODConfigurationPulseAlertRel.Enable)
		   					LocalPulseAlertTriggerFrom = "FSM_ION_WHShipmentCreationAlert"
		  					if(FSMBODConfigurationDetailPulseAlertRel.Enable)
			   					invoke WHShipmentCreationAlert
#endif

		UpdateIntrastatNumber is an Instance Action
			restricted
			Parameters
				PrmIntrastatNumber is like IntrastatNumber
			Action Rules
				IntrastatNumber = PrmIntrastatNumber

		UpdateBillOfLadingDocumentSequence is an Instance Action
			restricted
			Action Rules
				increment BillOfLadingIDMDocumentSequence by 1


		FinalReleaseShipment is an Instance Action
			restricted
			Action Rules
    			if (not IsMSCMEnabled
				and InventoryLocation.MSCMDelivery 
				and not FromMSCMFlag)
    				if (WarehouseShipmentTrackingRel exists)
    					invoke CreateArrivalFile WarehouseShipment
    					
    			invoke TriggerShipmentReleaseService
    					
    			if (WarehouseDemand.DemandSystemCode.Requisitions)
    				make transition to Closed
    				invoke TriggerProcessShipmentOutbound


					
					if (IsValidForDelivery)
						if (IsTrackedByShipmentOnly or IsTrackedByShipmentLineOnly)
							invoke ProcessDelivery WarehouseShipmentLine in background
								invoked.PrmCompany				= Company
								invoked.PrmInventoryLocation	= InventoryLocation
								invoked.PrmWarehouseShipment	= WarehouseShipment
						else
						if (IsTrackedByContainerOnly)
							invoke ProcessDeliveryByContainer MobileSupplyChainShipmentDetailTracking in background 
								invoked.PrmCompany				= Company
								invoked.PrmInventoryLocation	= InventoryLocation
								invoked.PrmWarehouseShipment	= WarehouseShipment
					
    			else
					if (WarehouseDemand.DemandSystemCode.CustomerOrder)
    					if (WarehouseShipmentLineAuditsForBackOrderRel not exists
    					or  PartialOrNoBackorderedShipmentLinesRel exists)
    						make transition to Released
    					else
							make transition to Closed  
					invoke TriggerProcessShipmentOutbound


		TriggerShipmentReleaseService is an Instance Action
	  		restricted
			Action Rules
				if (Company.FinanceEnterpriseGroup.BODTrigger)
					trigger "ShipmentReleaseService" PA service
						resume on error
						title is "EG:<Company.FinanceEnterpriseGroup>Company:<Company>"
						Criteria
							Company.FinanceEnterpriseGroup
							Company
						Variables
							WarehouseDemand.DemandDocument
								variable name is OrderNumber
							WarehouseShipment
							WarehouseDemand.DemandSystemCode
								variable name is SystemCode
							CompanyAndLocation.RequestingLocation
								variable name is RequestingLocation
							Company
							InventoryLocation
							CustomerShipTo
								variable name is CustomerShipTo
							CustomerOrderRel.Customer
								variable name is Customer
#ifdef module integration
   					if (FSMBODConfigurationPulseAlertRel.Enable)
   						LocalPulseAlertTriggerFrom = "FSM_ION_ShipmentReleaseAlert"
  						if(FSMBODConfigurationDetailPulseAlertRel.Enable)
	   						invoke ShipmentReleasePulseAlert
#endif

		Purge is a Purge Action
			restricted
			bypass relational integrity rules
			Entrance Rules
				invoke Purge PurgeWarehouseShipmentTrackingRel
				invoke Purge PurgeWarehouseShipmentLineRel

		GenerateWarehousePackingListInIDM is an Instance Action
			restricted
			default label is "GenerateWarehousePackingList"
			Parameters

				PrmShipmentStatus 		is Numeric 1
					States
						ToBePicked   value is 0
						ToBePacked   value is 1
						ToBeShipped  value is 2
						ToBeReleased value is 3
						Released     value is 4
						Closed       value is 5
				PrmCarrier				is like Vendor
				PrmCODOnly				is AlphaUpper 1
				PrmIncludeBackorders	is AlphaUpper 1
				PrmIDMPrinter			is an IDMPrinter

			Local Fields
				IDMAttributes

			Action Rules

				if (PrmShipmentStatus.ToBePicked)
					TransientShipmentStatus = "To Be Picked"
				else
				if (PrmShipmentStatus.ToBePacked)
					TransientShipmentStatus = "To Be Packed"
				else
				if (PrmShipmentStatus.ToBeShipped)
					TransientShipmentStatus = "To Be Shipped"
				else
				if (PrmShipmentStatus.ToBeReleased)
					TransientShipmentStatus = "To Be Released"
				else
				if (PrmShipmentStatus.Released)
					TransientShipmentStatus = "Released"
				else
				if (PrmShipmentStatus.Closed)
					TransientShipmentStatus = "Closed"

				if (PrmCarrier > 0)
					TransientCarrier = PrmCarrier

				if (PrmCODOnly = "N")
					TransientCODOnly = "No"
				else
				if (PrmCODOnly = "Y")
					TransientCODOnly = "Yes"

				if (PrmIncludeBackorders = "N")
					TransientIncludeBackorders = "No"
				else
				if (PrmIncludeBackorders = "Y")
					TransientIncludeBackorders = "Yes"

				TransientIDMPrinter = PrmIDMPrinter


				initialize IDMGenerateDocument

				IDMGenerateDocument.IDMXMLDefinition.Busclass											= reference to this instance
				IDMGenerateDocument.IDMXMLDefinition.ListName											= "WarehousePackingListforIDMDoc"
				IDMGenerateDocument.IDMXMLDefinition.DocumentName										= "WarehousePackingList"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].RelationName			= "WarehouseShipmentLinesRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListName 			= "WarehousePackingListLinesForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].LevelSection1		= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListTag				= "ShipmentLines"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ItemTag				= "ShipmentLine"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].RelationName			= "WarehouseShipmentLineDetailsRel" 
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListName 			= "WHPackingListLineDetailForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection1		= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection2		= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListTag				= "ShipmentLineDetails"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ItemTag				= "ShipmentLineDetail"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].RelationName			= "ShipmentLineItemCommentsRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ListName 			= "ItemCommentIDMList"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].LevelSection1		= 1
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].LevelSection2		= 2
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ListTag				= "ShipmentLineItemComments"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ItemTag				= "ShipmentLineItemComment"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].RelationName			= "WarehousePackingListBackorderedLinesRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ListName 			= "WHPackingListBackorderedItemsForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].LevelSection1		= 2
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ListTag				= "BackOrderLines"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ItemTag				= "BackOrderLine"

				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].RelationName			= "WarehouseShipmentLineWithSpecialHandlingRel"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ListName 			= "WarehouseShipmentLineWithSpecialHandlingForIDM"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].LevelSection1		= 3
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ListTag				= "SpecialHandlingItems"
				IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ItemTag				= "SpecialHandlingItem"

				if (DisplayPreferenceCard)
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].RelationName			= "RequisitionLineWithPrefCardTranRel"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ListName 			= "WarehousePackingListPrefCardForIDM"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].LevelSection1		= 1
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].LevelSection2		= 3
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ListTag				= "PrefCardTransactions"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ItemTag				= "PrefCardTransaction"

					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].RelationName			= "WarehousePickListPrintIDMRel"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ListName 			= "WarehousePackingListPrefCardDetailsforIDM"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].LevelSection1		= 4
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ListTag				= "PrefCardDetails"
					IDMGenerateDocument.IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ItemTag				= "PrefCardDetail"

				initialize IDMAttributes
 				IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName  	= "Company"
				IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue  	= Company
				IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeName  	= "InventoryLocation"
				IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeValue  	= InventoryLocation
				IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeName  	= "WarehouseShipment"
				IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeValue  	= WarehouseShipment
				IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeName  	= "Status"
				IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeValue  	= DerivedIDMStatus
				IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeName  	= "DocumentSource"
				IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeValue  	= DerivedDocumentSource
				IDMAttributes.SingleValue.IDMAttribute[6].IDMAttributeName  	= "CompanyName"
				IDMAttributes.SingleValue.IDMAttribute[6].IDMAttributeValue  	= Company.Name

				IDMGenerateDocument.IDMAttributes		= IDMAttributes
				IDMGenerateDocument.TemplateUniqueId	= Company.WarehousePackingListTemplate.IDMUniqueId
				IDMGenerateDocument.DocumentType		= "FSM_WarehousePackingList"
				IDMGenerateDocument.FileName			= DerivedIDMFileName + Company.WarehousePackingListTemplate.DerivedOutputFormat

				if (PrmIDMPrinter entered)
					IDMGenerateDocument.IDMPrinter		= PrmIDMPrinter 

				IDMGenerateDocument.IDMAccessControlList = "CSFDefined"

				invoke CreateFromGenerateDocument IDMJob
					invoked.Actor				= actor
					invoked.Description			= "Warehouse Packing List"
					invoked.IDMGenerateDocument = IDMGenerateDocument


		GenerateWarehousePackingListForShipmentsInIDM is a Set Action
			restricted
			Parameters
				PrmCompany						is like Company
				PrmInventoryLocation			is like InventoryLocation
				PrmShipmentStatus 				is Alpha 1
					States
						ToBePicked   value is "0"
						ToBePacked   value is "1"
						ToBeShipped  value is "2"
						ToBeReleased value is "3"
						Released     value is "4"
						Closed       value is "5"
				PrmCarrier						is like Vendor
				PrmCODOnly						is AlphaUpper 1
				PrmIncludeBackorders			is AlphaUpper 1
				PrmShipmentFilter1				is like WarehouseShipment
				PrmShipmentFilter2				is like WarehouseShipment
				PrmShipmentFilter3				is like WarehouseShipment
				PrmShipmentFilter4				is like WarehouseShipment
				PrmShipmentFilter5				is like WarehouseShipment
				PrmShipmentFilter6				is like WarehouseShipment
				PrmShipmentFilter7				is like WarehouseShipment
				PrmShipmentFilter8				is like WarehouseShipment
				PrmShipmentFilter9				is like WarehouseShipment
				PrmShipmentFilter10				is like WarehouseShipment
				PrmShipmentFilter11				is like WarehouseShipment
				PrmShipmentFilter12				is like WarehouseShipment
				PrmIDMPrinter					is an IDMPrinter
				PrmGenerateUprintedShipments 	is Boolean

			Instance Selection
				where (Company = PrmCompany
				and    InventoryLocation = PrmInventoryLocation
				and   (PrmShipmentStatus not entered or PrmShipmentStatus = Status)
				and   (PrmCarrier not entered or PrmCarrier = Carrier)
				and   (not PrmCODOnly = "Y" or IsCashOnDeliveryShipment)
				and  ((not PackingList and    PrmGenerateUprintedShipments)
				or    (WarehouseShipment = PrmShipmentFilter1
				or     WarehouseShipment = PrmShipmentFilter2
				or     WarehouseShipment = PrmShipmentFilter3
				or     WarehouseShipment = PrmShipmentFilter4
				or     WarehouseShipment = PrmShipmentFilter5
				or     WarehouseShipment = PrmShipmentFilter6
				or     WarehouseShipment = PrmShipmentFilter7
				or     WarehouseShipment = PrmShipmentFilter8
				or     WarehouseShipment = PrmShipmentFilter9
				or     WarehouseShipment = PrmShipmentFilter10
				or     WarehouseShipment = PrmShipmentFilter11
				or     WarehouseShipment = PrmShipmentFilter12)))

			Action Rules
				Instance Rules
					invoke GenerateWarehousePackingListInIDM
						invoked.PrmShipmentStatus 		= PrmShipmentStatus
						invoked.PrmCarrier				= PrmCarrier
						invoked.PrmCODOnly				= PrmCODOnly
						invoked.PrmIncludeBackorders	= PrmIncludeBackorders
						invoked.PrmIDMPrinter			= PrmIDMPrinter

		FinishCompletion is an Instance Action
	  		restricted
			Action Rules
				include CreateWarehouseShipmentTracking

				if (Status.Printed)
					if (RequirePickingFeedback)
						make transition to Picked
					else
					if (IsOnlyPackingRequired)
						make transition to Packed
					else
						make transition to Shipped
				else
				if (Status.Picked)
					if (IsOnlyPickingRequired)
						make transition to Shipped
					else
						make transition to Packed
				else
				if (Status.PickInProgress)
					make transition to Picked
				else
				if (Status.PackInProgress)
					make transition to Packed
				else
					make transition to Shipped

				if (ReleaseAfterShipped
				and Status.Shipped
				and not RequirePickingFeedback
				and not IsOnlyPackingRequired)
					invoke Shipped.Release

		PutOnHold is an Instance Action
			restricted
			Action Rules
				TemporaryHold = "S"

		TriggerShipmentNativeLPLBOD is an Instance Action
			default label is untranslatable
			restricted
			Action Rules
				invoke TriggerShipmentNativeLPLOutBOD

		TriggerShipmentNativeLPLOutBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
				RestartFlag is Boolean
			Action Rules
				if(DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y" and DerivedSplitShipment = "Y")
					LocalMainUserTemplate	= "IONSyncShipment_WarehouseShipmentHeader_ST"
				else
					LocalMainUserTemplate	= "IONSyncShipment_WarehouseShipment_ST"	
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "Shipment"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "WarehouseShipment"
					invoked.PrmFinanceEnterpriseGroup	= Company.AccountingEntity.FinanceEnterpriseGroup
					invoked.PrmCompany					= Company
					invoked.PrmMainUserTemplate 		= LocalMainUserTemplate
				LocalNativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger
				if(Company.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger and DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y" and DerivedSplitShipment = "Y")
					LocalVariationID = bod id.VariationID
					if(RestartFlag)
						LocalWarehouseShipmentLine	 	 	= FSMInboundBODTracker.Reference4
						LocalVariationID					= FSMInboundBODTracker.BODVariationID
						if (WarehouseShipmentLineRelation exists)
							LocalFSMInboundBODTracker			= FSMInboundBODTracker
							invoke Update FSMInboundBODTrackerRel
								invoked.BODDocumentID			= DerivedShipmentNbrOut
								invoked.BODVariationID			= LocalVariationID
								invoked.BODAccountingEntity		= DerivedAccountingEntity
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.Direction				= 1
								invoked.Reference1				= Company
								invoked.Reference2				= InventoryLocation
								invoked.Reference3				= WarehouseShipment
								initialize invoked.Error			
								initialize invoked.ErrorMessage
							invoke SendSyncShipmentNativeLPLBOD
								resume on error
	                   				Error            							= true
	                        		ErrorMessage     							= error message 
							if(Error)
								invoke Update FSMInboundBODTrackerRel
									invoked.Error 								= Error
									invoked.ErrorMessage 						= ErrorMessage
									invoked.Status								= 2
									invoked.CloseDate							= system current timestamp
									invoked.BODID								= DerivedBODID
									invoked.BODXML								= SyncShipmentHeaderXMLBOD		
							else
								invoke Update FSMInboundBODTrackerRel
									invoked.Status								= 3
									invoked.CloseDate							= system current timestamp
									invoked.BODID								= DerivedBODID
									invoked.BODXML								= SyncShipmentHeaderXMLBOD
					else
						if (WarehouseShipmentLineRel exists)
							for each WarehouseShipmentLineRel
								initialize LocalWarehouseShipmentLine
								initialize LocalEAMWorkOrderActivity
								LocalWarehouseShipmentLine	 	 	= each.WarehouseShipmentLine
								LocalEAMWorkOrderActivity 	  		= RequisitionLineRel.EAMWorkOrderActivity
								if(FSMInboundBODTracker not entered)
									LocalVariationID = LocalVariationID+1
									invoke Create FSMInboundBODTracker
										assign result to NewBODTracker
										invoked.Verb 					= 1
										invoked.Noun 					= "Shipment"
										invoked.BODDocumentID			= DerivedShipmentNbrOut
										invoked.BODVariationID			= LocalVariationID
										invoked.BODAccountingEntity		= DerivedAccountingEntity
										invoked.Status					= 1
										invoked.StartDate				= system current timestamp
										invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
										invoked.Direction				= 1
										invoked.Reference1				= Company
										invoked.Reference2				= InventoryLocation
										invoked.Reference3				= WarehouseShipment
										invoked.Reference4				= LocalWarehouseShipmentLine
										invoked.Reference5				= LocalEAMWorkOrderActivity
										initialize invoked.Error			
										initialize invoked.ErrorMessage
									LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
								invoke SendSyncShipmentNativeLPLBOD
									resume on error
	           							Error            							= true
	                					ErrorMessage     							= error message 
								if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 								= Error
										invoked.ErrorMessage 						= ErrorMessage
										invoked.Status								= 2
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= DerivedBODID
										invoked.BODXML								= SyncShipmentHeaderXMLBOD
								else
									invoke Update FSMInboundBODTrackerRel
										invoked.Status									= 3
										invoked.CloseDate								= system current timestamp
										invoked.BODID									= DerivedBODID
										invoked.BODXML									= SyncShipmentHeaderXMLBOD
				else		
					if(Company.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
						if(WarehouseShipmentLineRel exists  and DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y" and DerivedSplitShipment != "Y")
							initialize LocalWarehouseShipmentLine
							initialize LocalEAMWorkOrderActivity
							LocalWarehouseShipmentLine	  = WarehouseShipmentLineRel.WarehouseShipmentLine
							if(DerivedSystemCode = "RQ" and DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y" and DerivedEAMWorkOrder entered)
								LocalEAMWorkOrderActivity  = RequisitionLineRel.EAMWorkOrderActivity
						else
							if(WarehouseShipmentLineRel exists)
								for each WarehouseShipmentLineRel
									initialize LocalRequisitionLineNum
									if(DerivedIntegratingApplication = "EAM")
										LocalRequisitionLineNum = each.WarehouseShipmentLine
									else
										LocalRequisitionLineNum = ""
									
						if(FSMInboundBODTracker not entered)
							invoke Create FSMInboundBODTracker
								assign result to NewBODTracker
								invoked.Verb 					= 1
								invoked.Noun 					= "Shipment"
								invoked.BODDocumentID			= DerivedShipmentNbrOut
								invoked.BODVariationID			= DerivedBODVariationID
								invoked.BODAccountingEntity		= DerivedAccountingEntity
								invoked.BODID					= DerivedBODID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.Direction				= 1
								invoked.Reference1				= Company
								invoked.Reference2				= InventoryLocation
								invoked.Reference3				= WarehouseShipment
								initialize invoked.Error			
								initialize invoked.ErrorMessage
							LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
						else
							LocalFSMInboundBODTracker			= FSMInboundBODTracker
							invoke Update FSMInboundBODTrackerRel
								invoked.BODDocumentID			= DerivedShipmentNbrOut
								invoked.BODVariationID			= DerivedBODVariationID
								invoked.BODAccountingEntity		= DerivedAccountingEntity
								invoked.BODID					= DerivedBODID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.Direction				= 1
								invoked.Reference1				= Company
								invoked.Reference2				= InventoryLocation
								invoked.Reference3				= WarehouseShipment
								initialize invoked.Error			
								initialize invoked.ErrorMessage
						invoke SendSyncShipmentNativeLPLBOD
							resume on error
	   							Error            							= true
	        					ErrorMessage     							= error message
						if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 								= Error
								invoked.ErrorMessage 						= ErrorMessage
								invoked.Status								= 2
								invoked.CloseDate							= system current timestamp
								invoked.BODID								= DerivedBODID
								invoked.BODXML								= SyncShipmentOrderXMLBOD
						else
							invoke Update FSMInboundBODTrackerRel
								invoked.Status									= 3
								invoked.CloseDate								= system current timestamp
								invoked.BODID									= DerivedBODID
								invoked.BODXML									= SyncShipmentOrderXMLBOD
		
		SendSyncShipmentNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				if(DerivedIntegratingApplication = "EAM" and DerivedRequisitionShipment = "Y" and DerivedSplitShipment = "Y")
					send ion bod
						bod is SyncShipmentHeaderXMLBOD
						bod type is "Sync.Shipment"
						document id is  DerivedShipmentNbrOut
						variation id is DerivedBODVariationID
						accounting entity is DerivedAccountingEntity
						location is DerivedLocation
					increment bod id.VariationID
				else
					send ion bod
						bod is SyncShipmentOrderXMLBOD
						bod type is "Sync.Shipment"
						document id is  DerivedShipmentNbrOut
						variation id is DerivedBODVariationID
						accounting entity is DerivedAccountingEntity
						location is DerivedLocation

		TriggerProcessShipmentNativeLPLBOD is an Instance Action
			restricted
			Action Rules
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRelation
					invoked.PrmVerb 					= 2
					invoked.PrmNoun						= "Shipment"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "WarehouseShipment"
					invoked.PrmFinanceEnterpriseGroup	= Company.AccountingEntity.FinanceEnterpriseGroup
					invoked.PrmCompany					= Company
					invoked.PrmMainUserTemplate 		= "IONProcessShipment_WarehouseShipment_ST"
				LocalNativeLPLBODTrigger = FSMBODConfigurationRelation.NativeLPLBODTrigger
				if(Company.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
					if(FSMInboundBODTracker not entered)
						invoke Create FSMInboundBODTracker
							assign result to NewBODTracker
							invoked.Verb 					= 2
							invoked.Noun					= "Shipment"
							invoked.BODDocumentID			= DerivedProcessShipmentNbrOut
							invoked.BODVariationID			= DerivedBODVariationID
							invoked.BODAccountingEntity		= DerivedProcessAE
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
							invoked.Direction				= 1
							invoked.Reference1				= Company
							invoked.Reference2				= InventoryLocation
							invoked.Reference3				= WarehouseShipment
							initialize invoked.Error			
							initialize invoked.ErrorMessage
						LocalFSMInboundBODTracker			= NewBODTracker.FSMInboundBODTracker
					else
						LocalFSMInboundBODTracker			= FSMInboundBODTracker
						invoke Update FSMInboundBODTrackerRel
							invoked.BODDocumentID			= DerivedProcessShipmentNbrOut
							invoked.BODVariationID			= DerivedBODVariationID
							invoked.BODAccountingEntity		= DerivedProcessAE
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
							invoked.Direction				= 1
							invoked.Reference1				= Company
							invoked.Reference2				= InventoryLocation
							invoked.Reference3				= WarehouseShipment
							initialize invoked.Error			
							initialize invoked.ErrorMessage
					invoke SendProcessShipmentNativeLPLBOD	
						resume on error
		                	Error            							= true
		                	ErrorMessage     							= error message
		            if(Error)
						invoke Update FSMInboundBODTrackerRel
							invoked.Error 								= Error
							invoked.ErrorMessage 						= ErrorMessage
							invoked.Status								= 2
							invoked.CloseDate							= system current timestamp
							invoked.BODID								= DerivedProcessShipmentBODID
							invoked.BODXML								= ProcessShipmentXMLBOD	
					else
						invoke Update FSMInboundBODTrackerRel
							invoked.Status								= 3
							invoked.CloseDate							= system current timestamp
							invoked.BODID								= DerivedProcessShipmentBODID
							invoked.BODXML								= ProcessShipmentXMLBOD	
							
		SendProcessShipmentNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules			
				send ion bod
					bod is ProcessShipmentXMLBOD
					bod type is "Process.Shipment"
					document id is  DerivedProcessShipmentNbrOut
					variation id is DerivedBODVariationID
					accounting entity is DerivedProcessAE
					location is DerivedProcessLocation
		
		RefreshFromBatch is an Instance Action		
			restricted
			refresh and lock this instance
			Action Rules
				invoke RefreshLine WarehouseShipmentLineRel
				
		ConsolidateFile is an Instance Action
			restricted
			Parameters
				ParamCompany					is a InventoryCompany
				ParamInventoryLocation			is a InventoryLocation
				ParamWarehouseBatch				is a WarehouseBatch
				ParamBatchID					is an IDMPID
				ParamPrintOption				is Numeric size 1
					States
						ByShipmentDocumentLine                 value is 1
							default label is "By Shipment-Document Line"
						ByShipmentBinLotSerial                 value is 2
							default label is "By Shipment-Bin/Lot/Serial"
						ByShipmentBinLotSerialRequisitionBased value is 3
							default label is "By Shipment-Bin/Lot/Serial (Requisition Based)"
						ByBinItemUomLotSerial                  value is 4
							default label is "By Bin-Item/UOM/Lot/Serial"
				ParamIDMPrinter					is a IDMPrinter
			Local Fields
				ArrayIndex						is Numeric 6					
			Action Rules
				LocalIDMBatchID = ParamBatchID
				for each PickListIDMJobRel											
					if (each.GenerationStatus.Finished
					and each.MDSID entered)
						ArrayIndex += 1
						IDMGenerateDocument.IDMUniqueIDOccurs.IDMPID[ArrayIndex] = each.MDSID
				if (ParamPrintOption.ByShipmentDocumentLine)
					IDMGenerateDocument.FileName =  "Warehouse Pick List "+ParamCompany+"-"+ParamInventoryLocation+"-"+ParamWarehouseBatch+ParamCompany.PickListPrintByShipmentDocumentLineTemplate.DerivedOutputFormat
				else
				if (ParamPrintOption.ByShipmentBinLotSerial)
					IDMGenerateDocument.FileName =  "Warehouse Pick List "+ParamCompany+"-"+ParamInventoryLocation+"-"+ParamWarehouseBatch+ParamCompany.PickListPrintByShipmentBinLotSerialTemplate.DerivedOutputFormat
				else
				if (ParamPrintOption.ByShipmentBinLotSerialRequisitionBased)
					IDMGenerateDocument.FileName =  "Warehouse Pick List "+ParamCompany+"-"+ParamInventoryLocation+"-"+ParamWarehouseBatch+ParamCompany.PickListPrintByShipmentBinLotSerialRQBasedTemplate.DerivedOutputFormat
				IDMGenerateDocument.SourceDocumentType = "FSM_WarehousePickList"										
				IDMGenerateDocument.DocumentType = "FSM_WarehousePickList"
				IDMGenerateDocument.IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName = "Company"
				IDMGenerateDocument.IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue = ParamCompany
				IDMGenerateDocument.IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeName = "InventoryLocation"
				IDMGenerateDocument.IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeValue = ParamInventoryLocation
				IDMGenerateDocument.IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeName = "CompanyName"
				IDMGenerateDocument.IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeValue = ParamCompany.Name
				IDMGenerateDocument.IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeName = "Batch"
				IDMGenerateDocument.IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeValue = ParamWarehouseBatch										

				IDMGenerateDocument.IDMPrinter 		= ParamIDMPrinter										
				
				invoke CreateFromAssemble IDMJob
					invoked.Actor					= actor
					invoked.Description 			= "Warehouse Pick List Print (Consolidated)"
					invoked.IDMGenerateDocument 	= IDMGenerateDocument
					invoked.BatchID					= LocalIDMBatchID
	

		TriggerMSCMDownload is an Instance Action
			restricted
			Local Fields
				Counter is Numeric size 2

			Action Rules
				Counter = 1
				while (Counter <= sizeofarray DownloadedByArray)
					if(DownloadedByArray.DownloadedBy[Counter] entered and DownloadedByArray.DownloadedBy[Counter] = actor)
						end while
					else
					if(DownloadedByArray.DownloadedBy[Counter] not entered)
						DownloadedByArray.DownloadedBy[Counter] = actor
						end while
					Counter += 1
				
				LastDownloadedTime = current timestamp


					
		IncludeWarehouseShipment is an Instance Action
			completion message is "Shipment<WarehouseShipment>IncludedToLoad<ShipmentLoadConsolidation>"
			Action Rules
				invoke Create ShipmentLoad
					invoked.Company                   = Company
					invoked.InventoryLocation         = InventoryLocation
					invoked.ShipmentLoadConsolidation = ShipmentLoadConsolidation
					invoked.WarehouseShipment         = WarehouseShipment
					invoked.OrderType                 = WarehouseDemand.DemandSystemCode
					invoked.OrderNumber               = WarehouseDemand.DemandDocument

				invoke CreateShipmentLineTemplate WarehouseShipmentLine
					invoked.PrmCompany                   = Company
					invoked.PrmInventoryLocation         = InventoryLocation
					invoked.PrmShipmentLoadConsolidation = ShipmentLoadConsolidation
					invoked.PrmWarehouseShipment         = WarehouseShipment
					

	StateCycles

		WarehouseShipmentProcessing is a StateCycle
			state field is Status

			Printed  is a State
				Entrance Rules
					initialize PickDate
					initialize PackDate
					initialize ShipDate

				Create is a Create Action
					restricted
					Exit Rules
						if (IsCustomerOrder)
							invoke UpdateWarehouseShipment WarehouseDemand.CustomerOrderRel
								invoked.PrmWarehouseShipment = WarehouseShipment


				Update is an Update Action
					Action Rules
						include ActionValidCondition
						include UpdateBillOfLading


				Delete is a Delete Action
					Entrance Rules
						invoke Delete WarehouseShipmentLinesRel

				Void is an Instance Action
					Action Rules
						include ActionValidCondition

						invoke Void WarehouseShipmentLinesRel

				Backorder is an Instance Action
					Action Rules
						include ActionValidCondition

						invoke Backorder WarehouseShipmentLinesRel

				Finish is an Instance Action
					Action Rules
						include ActionValidCondition

						GeneralLedgerDate = current corporate date

						constraint (not HasShipmentLineWithExpiredLot)
							"Line<first WarehouseShipmentLinesWithExpiredLotsRel.WarehouseShipmentLine>ContainsAnExpiredLot;CompanyDoesNotAllowExpiredLotsOnTransaction"

						if (IsTrackedByShipment)
							invoke GenerateTrackingNumber MobileSupplyChainConfigurationRel
							LocalTrackingNumber = MobileSupplyChainConfigurationRel.DerivedTrackingNumber
							TrackingNumber = LocalTrackingNumber

						for each WarehouseShipmentLinesRel
							invoke ValidateLineOnFinish each


 						if (instance count of WarehouseShipmentLinesRel > DerivedForegroundLimit)
							if (RequirePickingFeedback)
								make transition to PickInProgress
							else
							if (IsOnlyPackingRequired)
								make transition to PackInProgress
							else
								make transition to ShipInProgress
							invoke FinishLinesSet WarehouseShipmentLine in background
								invoked.PrmCompany					= Company
								invoked.PrmInventoryLocation		= InventoryLocation
								invoked.PrmWarehouseShipment		= WarehouseShipment
								invoked.PrmFromPrinted				= true
								invoked.PrmReleaseAfterShipped		= ReleaseAfterShipped
						else
							invoke FinishLinesSet WarehouseShipmentLine in foreground
								invoked.PrmCompany					= Company
								invoked.PrmInventoryLocation		= InventoryLocation
								invoked.PrmWarehouseShipment		= WarehouseShipment
								invoked.PrmFromPrinted				= true
								invoked.PrmReleaseAfterShipped		= ReleaseAfterShipped














			Picked   is a State
				Entrance Rules
					PickDate = current corporate date
					initialize PackDate
					initialize ShipDate

				Update is an Update Action
					Action Rules
						include ActionValidCondition
						include UpdateBillOfLading


				Delete is a Delete Action
					Entrance Rules
						invoke Delete WarehouseShipmentLinesRel




				Undo is an Instance Action
					Action Rules
						invoke Undo WarehouseShipmentLinesRel


						make transition to Printed

				Backorder is an Instance Action
					Action Rules
						invoke Backorder WarehouseShipmentLinesRel

				Void is an Instance Action
					Action Rules
						invoke Void WarehouseShipmentLinesRel

				Finish is an Instance Action
					Action Rules
						include ActionValidCondition

 						if (instance count of WarehouseShipmentLinesRel > DerivedForegroundLimit)
							if (IsOnlyPickingRequired)
								make transition to ShipInProgress
							else
								make transition to PackInProgress
							invoke FinishLinesSet WarehouseShipmentLine in background
								invoked.PrmCompany					= Company
								invoked.PrmInventoryLocation		= InventoryLocation
								invoked.PrmWarehouseShipment		= WarehouseShipment
						else
							invoke FinishLinesSet WarehouseShipmentLine in foreground
								invoked.PrmCompany					= Company
								invoked.PrmInventoryLocation		= InventoryLocation
								invoked.PrmWarehouseShipment		= WarehouseShipment















			Packed   is a State
				Entrance Rules
					PackDate = current corporate date
					initialize ShipDate

				Update is an Update Action
					Action Rules
						include ActionValidCondition
						include UpdateBillOfLading


				Delete is a Delete Action
					Entrance Rules
						invoke Delete WarehouseShipmentLinesRel

				Undo is an Instance Action
					Action Rules
						invoke Undo WarehouseShipmentLinesRel

						if (RequirePickingFeedback)
							make transition to Picked
						else
							make transition to Printed

				Backorder is an Instance Action
					Action Rules
						invoke Backorder WarehouseShipmentLinesRel

				Void is an Instance Action
					Action Rules
						invoke Void WarehouseShipmentLinesRel

				Finish is an Instance Action
					Action Rules
						include ActionValidCondition

 						if (instance count of WarehouseShipmentLinesRel > DerivedForegroundLimit)
							make transition to ShipInProgress
							invoke FinishLinesSet WarehouseShipmentLine in background
								invoked.PrmCompany					= Company
								invoked.PrmInventoryLocation		= InventoryLocation
								invoked.PrmWarehouseShipment		= WarehouseShipment
						else
							invoke FinishLinesSet WarehouseShipmentLine in foreground
								invoked.PrmCompany					= Company
								invoked.PrmInventoryLocation		= InventoryLocation
								invoked.PrmWarehouseShipment		= WarehouseShipment










			Shipped  is a State
				Entrance Rules
					ShipDate = current corporate date

				Update is an Update Action
					Action Rules
						constraint (FromTaxEngineFlag
							or (!TaxEntityRel.ThirdParty.TaxEngine
							or  !TemporaryHold.SentForApproval))
							"CannotUpdateWhileAwaitingTaxApproval"

						constraint (!IsProcessShipmentBodsAndShipmentOnHold)
							"ChangesAreNotAllowedWhileShipmentIsWaitingForApproval"

				Undo is an Instance Action
					valid when (!IsTaxEngineAndShipmentOnHold)
					Action Rules
						constraint (FromTaxEngineFlag
							or (!TaxEntityRel.ThirdParty.TaxEngine
							or  !TemporaryHold.SentForApproval))
							"CannotUndoWhileAwaitingTaxApproval"

						constraint (!IsProcessShipmentBodsAndShipmentOnHold)
							"ChangesAreNotAllowedWhileShipmentIsWaitingForApproval"

						invoke Undo WarehouseShipmentLinesRel


						if (IsOnlyPickingRequired)
							make transition to Picked
						else
						if (RequirePackingFeedback)
							make transition to Packed
						else
							make transition to Printed

				Release is an Instance Action
						
					completion message is "<CompletionMessage>"
					valid when (!IsOnHold)
					Action Rules
						constraint (!HasKitItemOptions)
							"CannotReleaseKitItemHasOptions"
							
						constraint ((!TaxEntityRel.ThirdParty.TaxEngine
						or !TemporaryHold.SentForApproval)
						and !IsProcessShipmentBodsAndShipmentOnHold)
							"ShipmentAlreadySentForApproval"

						if (HasProofOfDeliveryRequired)
							constraint (PODReturnDate entered)
								"PODReturnDateIsRequired"

						if (IsMSCMEnabled)
							if (IsPrintReport)
								if (IsPrintLabel)
									constraint (MSCMLabelPrinter entered or MSCMReportPrinter entered)
										"PleaseSelectAReportOrLabelPrinter"
								else
									constraint (MSCMReportPrinter entered)
										"PleaseSelectAReportPrinter"
							else
							if (IsPrintLabel)
								constraint (MSCMLabelPrinter entered)
									"PleaseSelectALabelPrinter"


						if (HasCatchWeightItem)
							invoke ValidateCatchWeightLineOnRelease WarehouseShipmentLinesWithCatchWeightItemRel
						
						constraint (not HasShipmentLineWithExpiredLot)
							"Line<first WarehouseShipmentLinesWithExpiredLotsRel.WarehouseShipmentLine>ContainsAnExpiredLot;CompanyDoesNotAllowExpiredLotsOnTransaction"

						if (TaxEntityRel.ThirdParty.TaxEngine
						and !TemporaryHold.ApprovedByEngine)
							invoke PutOnHold
							invoke TriggerBROrderToInvoiceOutbound 
						else
						if (BillingCompanyRel.ProcessShipmentBods
						and WarehouseDemand.DemandSystemCode.CustomerOrder
						and !TemporaryHold.ApprovedByEngine)
							invoke PutOnHold

						else
							invoke Unreleased.Create InventoryTransaction
								assign result to NewInventoryTransaction
								fill in fields from this instance
								invoked.InventoryDocumentType 					 	 = AllWarehouseDemandLinesRel.WarehouseDemandLine.DemandDocumentType
								invoked.FromToCompanyLocation.FromToCompany		 	 = AllWarehouseDemandLinesRel.CompanyAndLocation.RequestingCompany
								if (AllWarehouseDemandLinesRel.WarehouseDemandLine.DemandDocumentType.Issue)
									invoked.FromToCompanyLocation.RequestingLocation = AllWarehouseDemandLinesRel.CompanyAndLocation.RequestingLocation
								else
								if (AllWarehouseDemandLinesRel.WarehouseDemandLine.DemandDocumentType.TransferIssue
								or  AllWarehouseDemandLinesRel.WarehouseDemandLine.DemandDocumentType.DirectTransfer)
									invoked.FromToCompanyLocation.FromToLocation 	 = AllWarehouseDemandLinesRel.CompanyAndLocation.RequestingLocation
									if (AllWarehouseDemandLinesRel.WarehouseDemandLine.DemandDocumentType.TransferIssue)
										invoked.IntransitTransfer                    = true
								invoked.WarehouseShipment							 = WarehouseShipment
								invoked.OriginatingTransaction						 = reference to this instance
	
							LocalInventoryTransaction 							 = NewInventoryTransaction.InventoryTransaction

							if (DerivedNumberOfLines > 50)
								Status = Status.ReleaseInProgress
								invoke BatchRelease WarehouseShipmentLine in background
									invoked.PrmInventoryCompany     = Company
									invoked.PrmInventoryLocation    = InventoryLocation
									invoked.PrmWarehouseShipment    = WarehouseShipment
									invoked.PrmInventoryTransaction = LocalInventoryTransaction
							else
								invoke BatchRelease WarehouseShipmentLine in foreground
									invoked.PrmInventoryCompany     = Company
									invoked.PrmInventoryLocation    = InventoryLocation
									invoked.PrmWarehouseShipment    = WarehouseShipment
									invoked.PrmInventoryTransaction = LocalInventoryTransaction
									
					Exit Rules
						if (TaxEntityRel.ThirdParty.TaxEngine
						or (BillingCompanyRel.ProcessShipmentBods
						and WarehouseDemand.DemandSystemCode.CustomerOrder))
							if (TemporaryHold.ApprovedByEngine)
								CompletionMessage = ReleaseCompletionMessage
								invoke BatchRelease WarehouseShipmentLine in foreground
									invoked.PrmInventoryCompany     = Company
									invoked.PrmInventoryLocation    = InventoryLocation
									invoked.PrmWarehouseShipment    = WarehouseShipment
									invoked.PrmInventoryTransaction = LocalInventoryTransaction
							else
							if (BillingCompanyRel.ProcessShipmentBods
							and WarehouseDemand.DemandSystemCode.CustomerOrder)	
								CompletionMessage = SentToLSPCompletionMessage

							else
								CompletionMessage = SentToEngineCompletionMessage
						else
							CompletionMessage = ReleaseCompletionMessage


			Released is a State

			Closed   is a State
				Purge is a Purge Action
					restricted
					Entrance Rules
						invoke Purge WarehouseShipmentLineRel

			PickInProgress  	is a State
			PackInProgress  	is a State
			ShipInProgress  	is a State

