CurrExchangeRate is a BusinessClass
    owned by currency
    prefix is Cuxr

    Ontology
		symbolic key is CurrExchangeRate

    Patterns
    	disable AsOfDateProcessing
        implements BODId
		        
    Persistent Fields
    	Rate			is a CurrencyExchangeRate

	Transient Fields
		ReverseCurrRelationship is Boolean
		ReverseExchangeRate		is a CurrExchangeRate
			exact version is ExchangeDate
				
	Context Fields

#ifdef module integration
		FSMInboundBODTracker
#endif
		
	Derived Fields
		ContextMessageEntityType is a StringField
			type is Alpha 30
			restricted
			"InforCurrencyExchangeRate"

		ContextMessageText is a MessageField
			restricted
			"CurrExchangeRate<CurrExchangeRate>"
		
		DerivedReversedRate		is a DerivedField
			type is Decimal size 31.15
			restricted
			if (CurrExchangeRate.CurrencyRelationship.AutoGenerate)
				return (1 / Rate)			


#ifdef module integration
		DerivedDelimiter is a DerivedField
			type is Alpha size 2
			restricted
			LocalConfigurationParameter	= "Generic_Delimiter"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "tenantID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "releaseID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "logicalID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "VersionID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedConfigAccountingEntity is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "SyncCurrencyExchangeRateMaster_Out_AccountingEntity"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
		
		DerivedRateType is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "SyncCurrencyExchangeRateMaster_Out_RateType"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
#endif


		
		DerivedUpdatedBy is a DerivedField
			type is Alpha size 60
			restricted
			return update stamp.actor
		
		DerivedlastUpdateTimeStamp is a DerivedField
			type is Alpha size 60
			restricted
			DerivedlastUpdateTimeStamp = update stamp.timestamp
			return DerivedlastUpdateTimeStamp
		
		DerivedBODVariationID is a DerivedField
			type is Alpha size 60
			restricted
			return bod id.VariationID
			
		DerivedBODCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			DerivedBODCurrentTimeStamp = current timestamp
			return DerivedBODCurrentTimeStamp[1:4] + "-" + DerivedBODCurrentTimeStamp[5:6] + "-" + DerivedBODCurrentTimeStamp[7:8] + "T" + DerivedBODCurrentTimeStamp[9:10] + ":" + DerivedBODCurrentTimeStamp[11:12] + ":" + DerivedBODCurrentTimeStamp[13:14] + "Z"
			
		DerivedBODRevision is a DerivedField
			type is Alpha size 25
			restricted
			return ""

#ifdef module integration									
		DerivedAccountingEntity is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedConfigAccountingEntity entered and DerivedConfigDocumentID = "N")
				return FinanceEnterpriseGroup + DerivedDelimiter + DerivedConfigAccountingEntity
			else
			if(DerivedConfigAccountingEntity entered and DerivedConfigDocumentID = "Y")
				return LocalCSFCrossRefValue
			else
			if(DerivedConfigAccountingEntity not entered and DerivedConfigDocumentID = "Y")
				return LocalAccountingEntity
			else
				return ""

		DerivedBODID is a DerivedField
			type is Alpha size 200
			restricted
			if (DerivedConfigAccountingEntity entered and DerivedConfigDocumentID = "Y")
				return "infor-nid:" + DerivedTenantID +":" + ":" + ":" +":"  + DerivedBODRevision +"?CurrencyExchangeRateMaster&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker
			else
				return "infor-nid:" + DerivedTenantID +":" + DerivedAccountingEntity + ":" + ":" + DerivedDocumentID + ":"  + DerivedBODRevision +"?CurrencyExchangeRateMaster&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker

		DerivedDocumentID is a DerivedField
			type is Alpha size 100
			restricted	
			if (DerivedConfigAccountingEntity entered or DerivedConfigDocumentID = "Y")
				return CurrencyTable + DerivedDelimiter + DerivedFromCurrency + DerivedDelimiter + DerivedToCurrency + DerivedDelimiter + DerivedExchangeDate
			else
				return FinanceEnterpriseGroup + DerivedDelimiter + CurrencyTable + DerivedDelimiter + DerivedFromCurrency + DerivedDelimiter + DerivedToCurrency + DerivedDelimiter + DerivedExchangeDate

		DerivedConfigDocumentID is a DerivedField
			type is Alpha size 2
			restricted
			LocalConfigurationParameter	= "RequiredCleanDocumentID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedConfigFEG is a DerivedField
			type is Alpha size 2
			restricted
			LocalConfigurationParameter	= "IsMultipleFEG"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
					
		DerivedTriggerCrossReference is a DerivedField
			type is Alpha size 2
			restricted
			LocalConfigurationParameter	= "TriggerBODBasedOnCrossReference"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value
			
#endif

		DerivedActionCode is a DerivedField	
			type is Alpha size 10
			restricted
			if (ActionCode="C" or ActionCode.Create )
				return "Add"
			else	
				return "Replace"		
		
		DerivedStatusCode is a DerivedField
			type is Alpha size 10
			restricted
			if (ActionCode = "D" or ActionCode.Delete )
				return "Deleted"
			else	
				return "Open"

		DerivedFromCurrency is a DerivedField	
			type is Alpha size 5
			restricted	
			return CurrExchangeRate.CurrencyRelationship.FromCurrency
		
		DerivedToCurrency is a DerivedField	
			type is Alpha size 5
			restricted	
			return CurrExchangeRate.CurrencyRelationship.ToCurrency
		
		DerviedDisplayID is a DerivedField	
			type is Alpha size 50
			restricted	
			return CurrencyTable + "-" + DerivedFromCurrency + "-" + DerivedToCurrency + "-" + DerivedExchangeDate
		
		DerivedExchangeDate is a DerivedField
			type is Alpha size 50
			restricted
			return ExchangeDate
				
		DerivedYear is a DerivedField
			type is Alpha size 10	
			restricted
			return DerivedExchangeDate[1:4]
		
		DerivedStartEffectDate is a DerivedField
			type is Alpha size 30
			restricted
			if (DerivedYear > 0)
				return DerivedExchangeDate[1:4] + "-" + DerivedExchangeDate[5:6] + "-" + DerivedExchangeDate[7:8] + "T" + "00" + ":" + "00" + ":" + "00" + "Z"
			else
				return ""
    	
    	DerivedReverseRate is a DerivedField
			type is Decimal size 31.15
			restricted
			return (1 / Rate)
    					
		DerivedExchangeRate is a DerivedField
			type is Decimal size 31.15
			restricted
			if (CurrExchangeRate.CurrencyRelationship.MultDiv = "1")
				return DerivedReverseRate
			else
				return Rate
	
		DerivedCurrencyTableDescription is a DerivedField
			type is Alpha size 200
			restricted
			return CurrencyTable.Description



		SyncCurrencyExchangeRateMasterXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			SyncCurrencyExchangeRateMasterXMLBOD = template.IONSyncCurrencyExchangeRateMaster_CurrExchangeRate_ST document for this instance


	Local Fields
		PeriodRate 					is Boolean
		Service						is Alpha size 30
		ActionCode
		LocalBODCurrentTimeStamp	is a BODCurrentTimeStamp

		LocalNativeLPLBODTrigger			is Boolean
		LocalCSFCrossRefValue		is Alpha size 30
		LocalAccountingEntity		is Alpha size 30
		LocalBODAccountingEntity  	is Alpha size 30
#ifdef module integration
		NewBODTracker  				is a FSMInboundBODTracker view
#endif
		LocalFSMInboundBODTracker	is Numeric 15
		Error            			is Boolean
	    ErrorMessage     			is Alpha 300
		LocalBODTrigger						is Boolean
		LocalConfigurationParameter			is Alpha size up to 200
		LocalSourceValue					is Alpha 20

	Field Rules
		Rate
			constraint (!CurrExchangeRate.CurrencyRelationship.Triangulate)
				"CannotEnterRatesForTriangulatedCurrencies"
			required
			
	Relations

#ifdef module integration
		FSMBODConfigurationParameterRel
    		one-to-one relation to FSMBODConfigurationParameter
    		Field Mapping uses symbolic key
    			related.FSMBODConfigurationParameter	= LocalConfigurationParameter
		
		FSMBODConfigurationRel
        	one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
            	related.FSMBODConfiguration.Verb		= 1
            	related.FSMBODConfiguration.Noun 		= "CurrencyExchangeRateMaster"
            	related.FSMBODConfiguration.Direction	= 1
		
		FSMBODCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
            	related.FSMBODCrossReference.SourceField 		= "CSFAE"
            	related.FSMBODCrossReference.DestinationField 	= "DESTAE"
            Instance Selection
				where (related.SourceValue	= LocalCSFCrossRefValue)
		
		FSMCleanBODCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
				related.FSMBODCrossReference.SourceField 		= "CSFAE"
				related.FSMBODCrossReference.DestinationField 	= "DESTAE"
		
		BODCrossAccountingEntityRel
			one-to-one relation to AccountingEntity
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup  = FinanceEnterpriseGroup
				related.AccountingEntity 		= LocalBODAccountingEntity
		
		AccountingEntityRel
			one-to-many relation to AccountingEntity
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup = FinanceEnterpriseGroup
		
		FSMInboundBODTrackerRel
			one-to-one relation to FSMInboundBODTracker
			Field Mapping uses symbolic key
				related.FSMInboundBODTracker	= LocalFSMInboundBODTracker	
#endif					
		

	Sets
		ByFromCurrency
			Sort Order
				FinanceEnterpriseGroup
				CurrExchangeRate.CurrencyRelationship.FromCurrency
				CurrExchangeRate.CurrencyRelationship.ToCurrency
				CurrencyTable
				ExchangeDate
				
		ByToCurrency
			Sort Order 
				FinanceEnterpriseGroup
				CurrExchangeRate.CurrencyRelationship.ToCurrency
				CurrExchangeRate.CurrencyRelationship.FromCurrency
				CurrencyTable
				ExchangeDate


	Rule Blocks
		TriggerCurrExchangeRateMasterRules
			Service  = "CurrExchangeRateService"
			LocalBODCurrentTimeStamp.CurrentTimeStamp = current timestamp
			trigger Service PA service
				resume on error
				title is "EG:<FinanceEnterpriseGroup>CU:CurrencyExchangeRate"
				Criteria
					FinanceEnterpriseGroup
					CurrencyTable
				Variables
					ActionCode
					PeriodRate
					include persistent fields from FinanceEnterpriseGroup
					include persistent fields from this instance
					include persistent fields from CurrencyTable
					include persistent fields from CurrExchangeRate.CurrencyRelationship
					LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
						variable name is CurrentTimeStamp
	

				
    Actions
		Create is a Create Action
			completion message is "CurrencyDailyRateCreated"
			Action Rules


			Exit Rules
				if (!ReverseCurrRelationship)			 
					if (CurrExchangeRate.CurrencyRelationship.AutoGenerate)		
						invoke Create
							invoked.FinanceEnterpriseGroup								= FinanceEnterpriseGroup
							invoked.CurrencyTable					  					= CurrencyTable
							invoked.CurrExchangeRate.CurrencyRelationship.FromCurrency	= CurrExchangeRate.CurrencyRelationship.ToCurrency
							invoked.CurrExchangeRate.CurrencyRelationship.ToCurrency	= CurrExchangeRate.CurrencyRelationship.FromCurrency   
							invoked.ExchangeDate										= ExchangeDate

							invoked.Rate												= DerivedReversedRate
							invoked.ReverseCurrRelationship 							= true
				
		Update is an Update Action
			completion message is "CurrencyDailyRateUpdated"		
			Action Rules
				if (ExchangeDate < current corporate date)
					effective date = ExchangeDate			
			Exit Rules 
				if (!ReverseCurrRelationship)			 
					if (CurrExchangeRate.CurrencyRelationship.AutoGenerate)
						ReverseExchangeRate.CurrencyRelationship.FromCurrency	= CurrExchangeRate.CurrencyRelationship.ToCurrency
						ReverseExchangeRate.CurrencyRelationship.ToCurrency		= CurrExchangeRate.CurrencyRelationship.FromCurrency

						if  ((ReverseExchangeRate exists)
						and  (ReverseExchangeRate.ExchangeDate = ExchangeDate))
							invoke Update ReverseExchangeRate

								invoked.Rate					= DerivedReversedRate
								invoked.ReverseCurrRelationship = true
						else
							invoke Create
								invoked.FinanceEnterpriseGroup					 		   = FinanceEnterpriseGroup
								invoked.CurrencyTable					  				   = CurrencyTable
								invoked.CurrExchangeRate.CurrencyRelationship.FromCurrency = CurrExchangeRate.CurrencyRelationship.ToCurrency
								invoked.CurrExchangeRate.CurrencyRelationship.ToCurrency   = CurrExchangeRate.CurrencyRelationship.FromCurrency   
								invoked.ExchangeDate					  				   = ExchangeDate

								invoked.Rate											   = DerivedReversedRate
								invoked.ReverseCurrRelationship 		 				   = true

		Delete is a Delete Action
			completion message is "CurrencyDailyRateDeleted"		
			Entrance Rules
				if (FinanceEnterpriseGroup.BODTrigger)
					PeriodRate 	= false
					ActionCode	= ActionCode.Delete
					increment bod id.VariationID
					include TriggerCurrExchangeRateMasterRules



			Action Rules 
			Exit Rules
				if (CurrExchangeRate.CurrencyRelationship.AutoGenerate)
					ReverseExchangeRate.CurrencyRelationship.FromCurrency = CurrExchangeRate.CurrencyRelationship.ToCurrency
					ReverseExchangeRate.CurrencyRelationship.ToCurrency	  = CurrExchangeRate.CurrencyRelationship.FromCurrency 
					invoke DeleteReverseRelationship ReverseExchangeRate

		DeleteReverseRelationship is a Delete Action
			completion message is "CurrencyDailyRateDeleted"		
			restricted
			Entrance Rules
				if (FinanceEnterpriseGroup.BODTrigger)
					PeriodRate 	= false
					ActionCode	= ActionCode.Delete
					increment bod id.VariationID
					include TriggerCurrExchangeRateMasterRules



		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmAccountingEntity  is Alpha size 22
					default label is "AccountingEntity"
				PrmLocation          is Alpha size 22
					default label is "Location" 
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmRevision          is Alpha size 22
					default label is "Revision"	
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"
			Action Rules
				if (bod id.AccountingEntity != PrmAccountingEntity)
					bod id.AccountingEntity 	= PrmAccountingEntity
				if (bod id.Location != PrmLocation)
					bod id.Location				= PrmLocation
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.Revision != PrmRevision)
					bod id.Revision				= PrmRevision
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord

#ifdef module integration
		SendCurrencyExchangeRateMasterNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				if(DerivedConfigDocumentID = "Y")
					send ion bod
						bod is SyncCurrencyExchangeRateMasterXMLBOD
						bod type is "Sync.CurrencyExchangeRateMaster"
						document id is  DerivedDocumentID
						variation id is DerivedBODVariationID
						accounting entity is LocalAccountingEntity
				else
					send ion bod
						bod is SyncCurrencyExchangeRateMasterXMLBOD
						bod type is "Sync.CurrencyExchangeRateMaster"
						document id is  DerivedDocumentID
						variation id is DerivedBODVariationID
						accounting entity is DerivedAccountingEntity

		TriggerCurrencyExchangeRateMasterNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
				RestartFlag is Boolean
			Action Rules 
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "CurrencyExchangeRateMaster"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "CurrExchangeRate"
					invoked.PrmFinanceEnterpriseGroup	= FinanceEnterpriseGroup
					invoked.PrmMainUserTemplate 		= "IONSyncCurrencyExchangeRateMaster_CurrExchangeRate_ST"
				LocalNativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger
				LocalBODTrigger = true
				if (FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
					if(DerivedConfigDocumentID = "Y" and DerivedConfigAccountingEntity not entered)	
						if(RestartFlag)
							if(AccountingEntityRel exist)
								initialize LocalAccountingEntity
								initialize LocalBODAccountingEntity
								initialize LocalCSFCrossRefValue
								LocalBODAccountingEntity = FSMInboundBODTracker.BODLocation
								if (DerivedConfigFEG = "Y")
									LocalCSFCrossRefValue = FinanceEnterpriseGroup + DerivedDelimiter + LocalBODAccountingEntity
								else
									LocalCSFCrossRefValue = LocalBODAccountingEntity
								
								if(DerivedTriggerCrossReference = "Y")
									if(FSMBODCrossReferenceDetailRel.DestinationValue entered)
										LocalAccountingEntity = FSMBODCrossReferenceDetailRel.DestinationValue
								else
								if(DerivedTriggerCrossReference = "N")
									LocalAccountingEntity = LocalCSFCrossRefValue
								
								if(LocalAccountingEntity entered)
									LocalFSMInboundBODTracker		= FSMInboundBODTracker
									invoke Update FSMInboundBODTrackerRel
										invoked.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
										invoked.BODDocumentID			= DerivedDocumentID
										invoked.BODVariationID			= DerivedBODVariationID
										invoked.BODID					= DerivedBODID
										invoked.Status					= 1
										invoked.StartDate				= system current timestamp
										invoked.Direction				= 1
										invoked.BODAccountingEntity		= DerivedAccountingEntity
										invoked.Reference1				= "CurrExchangeRate"
										invoked.Reference2				= CurrencyTable
										invoked.Reference3				= DerivedFromCurrency
										invoked.Reference4				= DerivedToCurrency
										invoked.Reference5				= DerivedExchangeDate
										invoked.BODLocation				= LocalBODAccountingEntity  
										initialize invoked.Error			
										initialize invoked.ErrorMessage
									invoke SendCurrencyExchangeRateMasterNativeLPLBOD
										resume on error
											Error            							= true
											ErrorMessage     							= error message
									if(Error)
										invoke Update FSMInboundBODTrackerRel
											invoked.Error 								= Error
											invoked.ErrorMessage 						= ErrorMessage
											invoked.Status								= 2
											invoked.BODID								= DerivedBODID
											invoked.CloseDate							= system current timestamp
											invoked.BODXML								= SyncCurrencyExchangeRateMasterXMLBOD
									else
										invoke Update FSMInboundBODTrackerRel
											invoked.Status								= 3
											invoked.BODID								= DerivedBODID
											invoked.CloseDate							= system current timestamp
											invoked.BODXML								= SyncCurrencyExchangeRateMasterXMLBOD
						else
						if(DerivedTriggerCrossReference = "Y")
							if(FSMCleanBODCrossReferenceDetailRel exists)
								for each FSMCleanBODCrossReferenceDetailRel
									initialize LocalSourceValue
									initialize LocalAccountingEntity
									LocalSourceValue = each.SourceValue
									if (LocalSourceValue entered)
										for each LocalSourceValue split on "<DerivedDelimiter>"
											initialize LocalBODAccountingEntity
											LocalBODAccountingEntity = each
									if(BODCrossAccountingEntityRel exists)
										LocalAccountingEntity = each.DestinationValue
							
									if(LocalAccountingEntity entered)
										if(FSMInboundBODTracker not entered)
											invoke Create FSMInboundBODTracker
												assign result to NewBODTracker
												invoked.Verb 					= 1
												invoked.Noun 					= "CurrencyExchangeRateMaster"		
												invoked.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
												invoked.BODDocumentID			= DerivedDocumentID
												invoked.BODVariationID			= DerivedBODVariationID
												invoked.Status					= 1
												invoked.StartDate				= system current timestamp
												invoked.Direction				= 1
												invoked.BODAccountingEntity		= DerivedAccountingEntity
												invoked.Reference1				= "CurrExchangeRate"
												invoked.Reference2				= CurrencyTable
												invoked.Reference3				= DerivedFromCurrency
												invoked.Reference4				= DerivedToCurrency
												invoked.Reference5				= DerivedExchangeDate
												invoked.BODLocation				= LocalBODAccountingEntity  
												initialize invoked.Error			
												initialize invoked.ErrorMessage
											LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
										invoke SendCurrencyExchangeRateMasterNativeLPLBOD
											resume on error
												Error            							= true
												ErrorMessage     							= error message
										if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage
												invoked.Status								= 2
												invoked.BODID								= DerivedBODID
												invoked.CloseDate							= system current timestamp
												invoked.BODXML								= SyncCurrencyExchangeRateMasterXMLBOD
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status								= 3
												invoked.BODID								= DerivedBODID
												invoked.CloseDate							= system current timestamp
												invoked.BODXML								= SyncCurrencyExchangeRateMasterXMLBOD
						else
						if(DerivedTriggerCrossReference = "N")
							if(AccountingEntityRel exist)
								for each AccountingEntityRel
									initialize LocalAccountingEntity
									initialize LocalBODAccountingEntity
									LocalBODAccountingEntity = each.AccountingEntity
									if (DerivedConfigFEG = "Y")
										LocalAccountingEntity = FinanceEnterpriseGroup + DerivedDelimiter + LocalBODAccountingEntity
									else
										LocalAccountingEntity = LocalBODAccountingEntity
									
									if(LocalAccountingEntity entered)
										if(FSMInboundBODTracker not entered)
											invoke Create FSMInboundBODTracker
												assign result to NewBODTracker
												invoked.Verb 					= 1
												invoked.Noun 					= "CurrencyExchangeRateMaster"		
												invoked.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
												invoked.BODDocumentID			= DerivedDocumentID
												invoked.BODVariationID			= DerivedBODVariationID
												invoked.Status					= 1
												invoked.StartDate				= system current timestamp
												invoked.Direction				= 1
												invoked.BODAccountingEntity		= DerivedAccountingEntity
												invoked.Reference1				= "CurrExchangeRate"
												invoked.Reference2				= CurrencyTable
												invoked.Reference3				= DerivedFromCurrency
												invoked.Reference4				= DerivedToCurrency
												invoked.Reference5				= DerivedExchangeDate
												invoked.BODLocation				= LocalBODAccountingEntity  
												initialize invoked.Error			
												initialize invoked.ErrorMessage
											LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
										invoke SendCurrencyExchangeRateMasterNativeLPLBOD
											resume on error
												Error            							= true
												ErrorMessage     							= error message
										if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage
												invoked.Status								= 2
												invoked.BODID								= DerivedBODID
												invoked.CloseDate							= system current timestamp
												invoked.BODXML								= SyncCurrencyExchangeRateMasterXMLBOD
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status								= 3
												invoked.BODID								= DerivedBODID
												invoked.CloseDate							= system current timestamp
												invoked.BODXML								= SyncCurrencyExchangeRateMasterXMLBOD	
					else
						if(DerivedConfigDocumentID = "Y" and DerivedConfigAccountingEntity entered)	
							if(DerivedConfigFEG = "Y")
								LocalCSFCrossRefValue = FinanceEnterpriseGroup + DerivedDelimiter +DerivedConfigAccountingEntity
							else
							if(DerivedConfigFEG = "N")
								LocalCSFCrossRefValue = DerivedConfigAccountingEntity
							
							if(FSMBODCrossReferenceDetailRel.DestinationValue entered)
								LocalCSFCrossRefValue = FSMBODCrossReferenceDetailRel.DestinationValue			
						
						if(FSMInboundBODTracker not entered)
							invoke Create FSMInboundBODTracker
								assign result to NewBODTracker
								invoked.Verb 					= 1
								invoked.Noun 					= "CurrencyExchangeRateMaster"		
								invoked.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
								invoked.BODDocumentID			= DerivedDocumentID
								invoked.BODVariationID			= DerivedBODVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.Direction				= 1
								invoked.BODAccountingEntity		= DerivedAccountingEntity
								invoked.Reference1				= "CurrExchangeRate"
								invoked.Reference2				= CurrencyTable
								invoked.Reference3				= DerivedFromCurrency
								invoked.Reference4				= DerivedToCurrency
								invoked.Reference5				= DerivedExchangeDate
								initialize invoked.Error			
								initialize invoked.ErrorMessage
							LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
						else
							LocalFSMInboundBODTracker		= FSMInboundBODTracker
							invoke Update FSMInboundBODTrackerRel
								invoked.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
								invoked.BODDocumentID			= DerivedDocumentID
								invoked.BODVariationID			= DerivedBODVariationID
								invoked.BODID					= DerivedBODID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.Direction				= 1
								invoked.BODAccountingEntity		= DerivedAccountingEntity
								invoked.Reference1				= "CurrExchangeRate"
								invoked.Reference2				= CurrencyTable
								invoked.Reference3				= DerivedFromCurrency
								invoked.Reference4				= DerivedToCurrency
								invoked.Reference5				= DerivedExchangeDate
								initialize invoked.Error			
								initialize invoked.ErrorMessage
						invoke SendCurrencyExchangeRateMasterNativeLPLBOD
							resume on error
								Error            							= true
								ErrorMessage     							= error message
						if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 								= Error
								invoked.ErrorMessage 						= ErrorMessage
								invoked.Status								= 2
								invoked.BODID								= DerivedBODID
								invoked.CloseDate							= system current timestamp
								invoked.BODXML								= SyncCurrencyExchangeRateMasterXMLBOD
						else
							invoke Update FSMInboundBODTrackerRel
								invoked.Status									= 3
								invoked.BODID									= DerivedBODID
								invoked.CloseDate								= system current timestamp
								invoked.BODXML									= SyncCurrencyExchangeRateMasterXMLBOD
#endif


		BODDataInitialLoadCurrencyExchangeRateCriteria is a Set Action
			restricted
			Parameters
				PrmFEG					is a FinanceEnterpriseGroup
				PrmCurrencyTable        is a CurrencyTable
			Instance Selection			
				where  (((PrmFEG entered
				and		PrmFEG = FinanceEnterpriseGroup)
				or		PrmFEG not entered)
				and    ((PrmCurrencyTable entered
				and		 PrmCurrencyTable = CurrencyTable)
				or		 PrmCurrencyTable not entered))
			Action Rules	
				Instance Rules	
					if (FinanceEnterpriseGroup.BODTrigger)
						ActionCode	= ActionCode.Create		
						increment bod id.VariationID
						include TriggerCurrExchangeRateMasterRules



	Action Exit Rules
		if (FinanceEnterpriseGroup.BODTrigger and !LocalBODTrigger)
			if (!action type.Delete)
				if (action != "UpdateBODIdFields") 
					PeriodRate = false
					ActionCode	= ActionCode.Update
					if (action type.Create)
						ActionCode	= ActionCode.Create				
					else
						if (action type.Delete)
							ActionCode	= ActionCode.Delete
					increment bod id.VariationID
					include TriggerCurrExchangeRateMasterRules



