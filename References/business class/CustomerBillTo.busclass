CustomerBillTo is a BusinessClass
	owned by ar
	prefix is ABS
	classic name is BILLTO
	representative text is "<Name>_(<CustomerBillTo>)"
	representative image is Logo.File
		display as full image
		missing image is random background
			foreground text is "<ShortName>"

	Ontology
		symbolic key is CustomerBillTo
			classic set name is ABSSET1
			classic name is BILL-TO
			classic name for CustomerGroup is CUST-GROUP

	Patterns
		implements StaticJava
		disable AuditIndex
		implements BODId
		
	Context Fields
		FSMInboundBODTracker

	Persistent Fields
		Name			is a VendorName 
			holds pii
		Contact			is a Name	 
			holds pii
		PostalAddress	is a PostalAddressV2	
			holds pii
			classic name for PostalAddress.DeliveryAddress.AddressLine1 is ADDR1
			classic name for PostalAddress.DeliveryAddress.AddressLine2 is ADDR2
			classic name for PostalAddress.DeliveryAddress.AddressLine3 is ADDR3
			classic name for PostalAddress.DeliveryAddress.AddressLine4 is ADDR4
			classic name for PostalAddress.Municipality is CITY
			classic name for PostalAddress.StateProvince is STATE
			classic name for PostalAddress.PostalCode is ZIP
			classic name for PostalAddress.Country is COUNTRY-CODE
			classic name for PostalAddress.Region is REGION
		DefaultBillTo	is Boolean
			classic name is DEFAULT-BILL
		EmailAddress	is an EmailAddressMulti 
			holds pii
			classic name is E-MAIL-ADDRESS
		Logo			is a LogoAttachment
		PhoneNumber		 is a TelephoneNumber 
			holds pii
		MobileNumber		is a MobilePhone 
			holds pii
		FaxNumber 
			holds pii
		TwitterID 
			holds pii
		SocialNetworkID2 
			holds pii
		SocialNetworkID3 
			holds pii
		SocialNetworkID4 
			holds pii
		SocialNetworkID5 
			holds pii


	Local Fields
		MaxLogoSize
		ActionCode							is Alpha size 1
			States
				Create value is "C"
				Update value is "U"
				Delete value is "D"

		LocalAccountingEntity				is Alpha size 20


		LocalNativeLPLBODTrigger			is Boolean
		LocalCompanyFlag					is Boolean
		LocalCompany						is Alpha size 4

		LocalVerb							is Numeric 2 
		LocalMainUserTemplate				is Alpha size 250
		LocalMaxCustomerBillTo	  		is like CustomerBillTo
		LocalBillTo							is like CustomerBillTo
		LocalCustomerBillTo	   			is like CustomerBillTo
		LocalBodAccountingEntity			is AlphaUpper size 12
		LocalCrossAccountingEntity 			is Alpha 40
		LocalBODFormattedID					is Alpha 100
		LocalCleanDocIDAccountingentity 	is Alpha 40
		BillToPartyMasterCleanDocXMLBOD		is XMLDocument
		NewBODTracker  						is a FSMInboundBODTracker view
		LocalFSMInboundBODTracker			is Numeric 15
		Error								is Boolean
		ErrorMessage	 					is Alpha 300
		LocalBODTrigger						is Boolean
		LocalConfigurationParameter			is Alpha size up to 200
		LocalSourceValue					is Alpha 30
		
	Derived Fields
		ShortName is a StringField
			type is AlphaUpper 3
			default label is "Name"
			Name

		ContextMessageEntityType is a StringField
			type is Alpha 30
			restricted
			"InforBillToPartyMaster"

		ContextMessageText is a MessageField
			restricted
			"BillTo<CustomerBillTo>"


		DerivedDelimiter is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter	= "Generic_Delimiter"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "logicalID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedBillToID is a DerivedField
			type is Alpha size 120
			restricted
			return Customer + DerivedDelimiter + CustomerBillTo




		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "tenantID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "releaseID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedVersionID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "VersionID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedAllCompanyFlag is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "BillToPartyMaster_Outbound_AccountingEntity_All"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedConfigAccountingEntity is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "SyncBillToPartyMstr_Outbound_AccountingEntity"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedProcessConfigAccountingEntity is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "ProcessBillToPartyMstr_Outbound_AccountingEntity"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedMultipleFEG is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "IsMultipleFEG"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedCleanDocumentID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "RequiredCleanDocumentID"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedTriggerBODBasedOnCrossReference is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter	= "TriggerBODBasedOnCrossReference"
			if(FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value


		DerivedBODCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			DerivedBODCurrentTimeStamp = current timestamp
			return DerivedBODCurrentTimeStamp[1:4] + "-" + DerivedBODCurrentTimeStamp[5:6] + "-" + DerivedBODCurrentTimeStamp[7:8] + "T" +  DerivedBODCurrentTimeStamp[9:10] + ":" + DerivedBODCurrentTimeStamp[11:12] + ":" + DerivedBODCurrentTimeStamp[13:14] + "Z"

		DerivedBODVariationID is a DerivedField
			type is Alpha size 25
			restricted
			return bod id.VariationID

		DerivedLocation is a DerivedField
			type is Alpha size 10
			restricted
			return ""

		DerivedDocumentID is a DerivedField	
			type is Alpha size 100
			restricted
			return Customer + DerivedDelimiter + CustomerBillTo

		DerivedBODID is a DerivedField	
			type is Alpha size 100
			restricted
			return "infor-nid:" + DerivedTenantID + ":" + LocalBodAccountingEntity + ":" + DerivedLocation + ":" + DerivedDocumentID + ":" + "?BillToPartyMaster&verb=Sync&TrackerID=" + LocalFSMInboundBODTracker

		DerivedActionCode is a DerivedField
			type is Alpha size 20
			restricted
			if (ActionCode.Create or action type.Create)
				return "Add"
			if (ActionCode.Update or action type.Update)
				return "Replace"
			if (ActionCode.Delete or action type.Delete)
				return "Replace"

		DerivedBillToAddressLine1 is a DerivedField
			type is Alpha size 40
			restricted
			return CustomerBillTo.PostalAddress.DeliveryAddress.AddressLine1

		DerivedBillToAddressLine2 is a DerivedField
			type is Alpha size 40
			restricted
			return CustomerBillTo.PostalAddress.DeliveryAddress.AddressLine2

		DerivedBillToAddressLine3 is a DerivedField
			type is Alpha size 40
			restricted
			return CustomerBillTo.PostalAddress.DeliveryAddress.AddressLine3

		DerivedBillToAddressLine4 is a DerivedField
			type is Alpha size 40
			restricted
			return CustomerBillTo.PostalAddress.DeliveryAddress.AddressLine4			

		DerivedBillToCity is a DerivedField
			type is Alpha size 58
			restricted
			return CustomerBillTo.PostalAddress.Municipality

		DerivedBillToStateProvince is a DerivedField
			type is Alpha size 3
			restricted
			return CustomerBillTo.PostalAddress.StateProvince

		DerivedBillToCountry is a DerivedField
			type is Alpha size 3
			restricted
			return CustomerBillTo.PostalAddress.Country

		DerivedBillToPostalCode is a DerivedField
			type is Alpha size 12
			restricted
			return CustomerBillTo.PostalAddress.PostalCode

		DerivedStatusCode is a DerivedField
			type is Alpha size 20
			restricted
			if (ActionCode.Delete or action type.Delete)
				return "Deleted"
			if (ActionCode.Create or action type.Create or ActionCode.Update or action type.Update)
				return "Open"

		DerivedPartyID is a DerivedField
			type is Alpha size 100
			restricted
			if (DerivedCleanDocumentID = "Y")
				return Customer using "%d"
			else
			if (DerivedAllCompanyFlag = "Y")
				return LocalCompany + DerivedDelimiter + Customer
			else
				return CustomerGroup + DerivedDelimiter + Customer

		DerivedCustomerTaxID is a DerivedField
			type is Alpha size 25
			restricted
			return Customer.TaxID

		DerivedCustomerName is a DerivedField
			type is Alpha size 120
			restricted
			return Customer.Name

		DerivedCustomerAddresLine1 is a DerivedField
			type is Alpha size 40
			restricted
			return Customer.PostalAddress.DeliveryAddress.AddressLine1

		DerivedCustomerAddresLine2 is a DerivedField
			type is Alpha size 40
			restricted
			return Customer.PostalAddress.DeliveryAddress.AddressLine2

		DerivedCustomerAddresLine3 is a DerivedField
			type is Alpha size 40
			restricted
			return Customer.PostalAddress.DeliveryAddress.AddressLine3

		DerivedCustomerAddresLine4 is a DerivedField
			type is Alpha size 40
			restricted
			return Customer.PostalAddress.DeliveryAddress.AddressLine4

		DerivedCustomerCity is a DerivedField
			type is Alpha size 58
			restricted
			return Customer.PostalAddress.Municipality

		DerivedCustomerCountry is a DerivedField
			type is Alpha size 3
			restricted
			return Customer.PostalAddress.Country

		DerivedCustomerPostalCode is a DerivedField
			type is Alpha size 12	
			restricted
			return Customer.PostalAddress.PostalCode

		DerivedCustomerContact is a DerivedField
			type is Alpha size 20
			restricted
			return Customer.Contact

		DerivedCustomerInternationPrefix is a DerivedField
			type is Alpha size 6
			restricted
			return Customer.PhoneNumber.InternationalPrefix

		DerivedCustomerPhoneNumber is a DerivedField
			type is Alpha size 15
			restricted
			return Customer.PhoneNumber.SubscriberNumber

		DerivedCustomerExtension is a DerivedField
			type is Alpha size 10
			restricted
			return Customer.PhoneNumber.Extension

		DerivedFinanceEnterpriseGroup is a DerivedField
			type is Alpha size 4
			restricted
			return CustomerBusinessGroupRel.FinanceEnterpriseGroup


		SyncBillToPartyMasterXML is a DerivedField
			type is XMLDocument
			restricted
			SyncBillToPartyMasterXML = template.IONSyncBillToPartyMaster_CustomerBillTo_ST document for this instance
			return SyncBillToPartyMasterXML




		
		DerivedProcessBODID is a DerivedField
			type is Alpha size 100
			restricted
			return "infor-nid:" + DerivedTenantID + ":" + LocalBodAccountingEntity + ":" + DerivedLocation + ":" + DerivedDocumentID + ":" + "?BillToPartyMaster&verb=Process&TrackerID=" + LocalFSMInboundBODTracker

		ProcessBillToPartyMasterXML is a DerivedField
			type is XMLDocument
			restricted
			ProcessBillToPartyMasterXML = template.IONProcessBillToPartyMaster_CustomerBillTo_ST document for this instance
			return ProcessBillToPartyMasterXML

	Conditions
		IsDefaultBillTo
			classic name is ABSSET2
			restricted
			when (DefaultBillTo)

		DefaultBillToRelExists
			restricted
			when (DefaultBillToRel exists)

	Field Rules
		DefaultBillTo
			if (DefaultBillTo != old DefaultBillTo
			and IsDefaultBillTo)
				constraint (!DefaultBillToRelExists)
					"ThereCanOnlyBeOneDefault_Bill_To"

		Logo
			if (Logo changed
			or	CustomerBillTo not exists)
				MaxLogoSize = CustomerGroup.LogoImageMaximumSizeBytes

	Rule Blocks
		TriggerCustomerBillToServiceRules
			trigger PayablesService.CustomerBillToService PA service
				resume on error
				title is "EG:<CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup>CG:<CustomerGroup>CU:<Customer>CBT:<CustomerBillTo>"
				Criteria
					CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup
					CustomerGroup
				Variables
					ActionCode
					include persistent fields from CustomerBillTo
					include persistent fields from Customer
					CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup
						variable name is FinanceEnterpriseGroup

		TriggerProcessCustomerBillToServiceRules
			trigger PayablesService.ProcessCustomerBillToService PA service
				resume on error
				title is "EG:<CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup>CG:<CustomerGroup>CU:<Customer>CBT:<CustomerBillTo>"
				Criteria
					CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup
					CustomerGroup						
				Variables
					ActionCode
					include persistent fields from CustomerBillTo
					include persistent fields from Customer
					CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup
						variable name is FinanceEnterpriseGroup


		CustomerBillToAutosequence
			initialize LocalMaxCustomerBillTo
			LocalMaxCustomerBillTo = last CustomerBillToRel.CustomerBillTo
			if (LocalMaxCustomerBillTo = 9999)
				initialize LocalCustomerBillTo
				for each CustomerBillToRel
					LocalBillTo = each.CustomerBillTo
					LocalCustomerBillTo = LocalCustomerBillTo + 1
					if (LocalBillTo != LocalCustomerBillTo)
						LocalBillTo  = LocalCustomerBillTo
						end for each
					constraint (!LocalCustomerBillTo = 9999)
						"CannotCreate:MaximumCustomerBillToNumberReached"
			else
				LocalBillTo = LocalMaxCustomerBillTo + 1
		
	Relations

		CustomerBusinessGroupRel	
			one-to-one relation to CustomerBusinessGroup
			Field Mapping uses symbolic key
				related.CustomerBusinessGroup = CustomerGroup

		DefaultBillToRel
			one-to-many relation to CustomerBillTo
			Field Mapping uses Set2
				related.CustomerGroup	= CustomerGroup
				related.Customer		= Customer

		CustomerBillToRel
			one-to-many relation to CustomerBillTo
			Field Mapping uses symbolic key
				related.CustomerGroup	   = CustomerGroup
				related.Customer			= Customer


		FSMBODConfigurationParameterRel
			one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
				related.FSMBODConfigurationParameter	= LocalConfigurationParameter



		
		SyncFSMBODConfigurationRel
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 1
				related.FSMBODConfiguration.Noun 		= "BillToPartyMaster"
				related.FSMBODConfiguration.Direction 	= 1
				
		ProcessFSMBODConfigurationRel
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 2
				related.FSMBODConfiguration.Noun 		= "BillToPartyMaster"
				related.FSMBODConfiguration.Direction 	= 1
				
		GeneralLedgerCompanyRel
			one-to-one relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
				related.Company = LocalCompany
				
		FSMBODGeneralLedgerCompanyRel
	   		one-to-many relation to GeneralLedgerCompany
	   		Field Mapping uses symbolic key
	   		Instance Selection
				where(related.CustomerBusinessGroup  = CustomerGroup)
			
		FSMBODAECrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
				related.FSMBODCrossReference.SourceField 		= "CSFGLC"
				related.FSMBODCrossReference.DestinationField 	= "DESTAE"
			Instance Selection
				where (related.SourceValue	= LocalCleanDocIDAccountingentity )
		
		FSMCleanDocIDGLCCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
				related.FSMBODCrossReference.SourceField 		= "CSFGLC"
				related.FSMBODCrossReference.DestinationField 	= "DESTAE"
				
		FSMCleanDocIDGeneralLedgerCompanyRel
			one-to-one relation to GeneralLedgerCompany
			required
			Field Mapping uses symbolic key
				related.Company = LocalBodAccountingEntity
				
		FSMInboundBODTrackerRel
			one-to-one relation to FSMInboundBODTracker
			Field Mapping uses symbolic key
				related.FSMInboundBODTracker	= LocalFSMInboundBODTracker

	Sets
		Set2
			indexed
			Instance Selection
				where (IsDefaultBillTo)
			Sort Order
				CustomerGroup
				Customer
				CustomerBillTo

	Actions
		Create is a Create Action
			Action Rules
			Exit Rules
				invoke TriggerPayFrom Customer
				
		CreateCustomerBillTo is a Create Action
			restricted
			Action Rules
				if (CustomerBillTo not entered)
					include CustomerBillToAutosequence
					CustomerBillTo = LocalBillTo
	
		Update is an Update Action

		Delete is a Delete Action
			Entrance Rules
				if (CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup.BODTrigger)
					if (action != "UpdateBODIdFields") 
						ActionCode = ActionCode.Delete
						increment bod id.VariationID
						include TriggerCustomerBillToServiceRules

						include TriggerProcessCustomerBillToServiceRules

						
		SendSyncBillToPartyMasterNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				if(DerivedCleanDocumentID = "Y")
					send ion bod
						bod is BillToPartyMasterCleanDocXMLBOD
						bod type is "Sync.BillToPartyMaster"
						document id is  DerivedDocumentID
						accounting entity is LocalCrossAccountingEntity
				else
					send ion bod	
						bod is SyncBillToPartyMasterXML
						bod type is "Sync.BillToPartyMaster"
						document id is  DerivedDocumentID
						variation id is DerivedBODVariationID
						accounting entity is LocalBodAccountingEntity
		
		TriggerSyncBillToPartyMasterNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Parameters
				PrmTriggerFrom		is Alpha 100
				RestartFlag 		is Boolean
			Action Rules
				invoke NativeLPLBODTriggerChecks SyncFSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "BillToPartyMaster"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "CustomerBillTo"
					invoked.PrmFinanceEnterpriseGroup	= CustomerBusinessGroupRel.FinanceEnterpriseGroup
					invoked.PrmBusinessGroup			= CustomerGroup
					invoked.PrmMainUserTemplate 		= "IONSyncBillToPartyMaster_CustomerBillTo_ST"
				LocalNativeLPLBODTrigger = SyncFSMBODConfigurationRel.NativeLPLBODTrigger
				LocalBODTrigger		 = true
				if(CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
					if(DerivedCleanDocumentID = "Y")
						if(RestartFlag)
							if (FSMBODGeneralLedgerCompanyRel exists)
								initialize LocalBodAccountingEntity
								initialize LocalCleanDocIDAccountingentity
								initialize BillToPartyMasterCleanDocXMLBOD
								initialize LocalCrossAccountingEntity
								initialize LocalBODFormattedID
								LocalBodAccountingEntity = FSMInboundBODTracker.Reference5
								if(DerivedMultipleFEG = "Y")
									LocalCleanDocIDAccountingentity = DerivedFinanceEnterpriseGroup + DerivedDelimiter + LocalBodAccountingEntity
								else
									LocalCleanDocIDAccountingentity = LocalBodAccountingEntity
								if(DerivedTriggerBODBasedOnCrossReference = "Y")
									if (FSMBODAECrossReferenceDetailRel.DestinationValue entered)
										LocalCrossAccountingEntity = FSMBODAECrossReferenceDetailRel.DestinationValue
								else
									LocalCrossAccountingEntity = LocalCleanDocIDAccountingentity
								if(LocalCrossAccountingEntity entered)
									LocalFSMInboundBODTracker		= FSMInboundBODTracker
									invoke Update FSMInboundBODTrackerRel
										assign result to NewBODTracker
										invoked.Verb 					= 1
										invoked.Noun 					= "BillToPartyMaster"					
										invoked.BODDocumentID			= DerivedDocumentID
										invoked.BODVariationID			= DerivedBODVariationID
										invoked.Status					= 1
										invoked.StartDate				= system current timestamp
										invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
										invoked.Direction				= 1
										invoked.BODAccountingEntity		= LocalCrossAccountingEntity
										invoked.Reference1				= CustomerGroup
										invoked.Reference2				= "CustomerBillTo"
										invoked.Reference3				= Customer
										invoked.Reference4				= CustomerBillTo
										initialize invoked.Error			
										initialize invoked.ErrorMessage
								LocalBODFormattedID = "infor-nid:" + DerivedTenantID + ":" + LocalCrossAccountingEntity + ":" + DerivedLocation + ":" + DerivedDocumentID + ":" + "?BillToPartyMaster&verb=Sync&TrackerID=" + LocalFSMInboundBODTracker
								BillToPartyMasterCleanDocXMLBOD = template.IONSyncBillToPartyMaster_CustomerBillTo_CleanDoc_ST document for this instance
								invoke SendSyncBillToPartyMasterNativeLPL
									resume on error
								   		Error										= true
										ErrorMessage	 							= error message
								if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 								= Error
										invoked.ErrorMessage 						= ErrorMessage
										invoked.Status								= 2
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= LocalBODFormattedID
										invoked.BODXML								= BillToPartyMasterCleanDocXMLBOD
								else
									invoke Update FSMInboundBODTrackerRel
										invoked.Status								= 3
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= LocalBODFormattedID
										invoked.BODXML								= BillToPartyMasterCleanDocXMLBOD
						else
						if(DerivedTriggerBODBasedOnCrossReference = "Y")
							if(FSMCleanDocIDGLCCrossReferenceDetailRel exists)
								for each FSMCleanDocIDGLCCrossReferenceDetailRel
									initialize LocalSourceValue
									initialize LocalCrossAccountingEntity
									initialize LocalBodAccountingEntity
									initialize BillToPartyMasterCleanDocXMLBOD
									initialize LocalBODFormattedID
									LocalSourceValue = each.SourceValue
									if (LocalSourceValue entered)
										for each LocalSourceValue split on "<DerivedDelimiter>"
											initialize LocalBodAccountingEntity
											LocalBodAccountingEntity = each
									if(FSMCleanDocIDGeneralLedgerCompanyRel exists)
										LocalCrossAccountingEntity = each.DestinationValue
										if(LocalCrossAccountingEntity entered)
											if(FSMInboundBODTracker not entered)
												invoke Create FSMInboundBODTracker
													assign result to NewBODTracker
													invoked.Verb 					= 1
													invoked.Noun 					= "BillToPartyMaster"					
													invoked.BODDocumentID			= DerivedDocumentID
													invoked.BODVariationID			= DerivedBODVariationID
													invoked.Status					= 1
													invoked.StartDate				= system current timestamp
													invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
													invoked.Direction				= 1
													invoked.BODAccountingEntity		= LocalCrossAccountingEntity
													invoked.Reference1				= CustomerGroup
													invoked.Reference2				= "CustomerBillTo"
													invoked.Reference3				= Customer
													invoked.Reference4				= CustomerBillTo
													invoked.Reference5				= LocalBodAccountingEntity
													initialize invoked.Error			
													initialize invoked.ErrorMessage					
												LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
											LocalBODFormattedID = "infor-nid:" + DerivedTenantID + ":" + LocalCrossAccountingEntity + ":" + DerivedLocation + ":" + DerivedDocumentID + ":" + "?BillToPartyMaster&verb=Sync&TrackerID=" + LocalFSMInboundBODTracker
											BillToPartyMasterCleanDocXMLBOD = template.IONSyncBillToPartyMaster_CustomerBillTo_CleanDoc_ST document for this instance
											invoke SendSyncBillToPartyMasterNativeLPL
												resume on error
											   		Error										= true
													ErrorMessage	 							= error message
											if(Error)
												invoke Update FSMInboundBODTrackerRel
													invoked.Error 								= Error
													invoked.ErrorMessage 						= ErrorMessage
													invoked.Status								= 2
													invoked.CloseDate							= system current timestamp
													invoked.BODID								= LocalBODFormattedID
													invoked.BODXML								= BillToPartyMasterCleanDocXMLBOD
											else
												invoke Update FSMInboundBODTrackerRel
													invoked.Status								= 3
													invoked.CloseDate							= system current timestamp
													invoked.BODID								= LocalBODFormattedID
													invoked.BODXML								= BillToPartyMasterCleanDocXMLBOD
						else
						if(DerivedTriggerBODBasedOnCrossReference = "N")
							if (FSMBODGeneralLedgerCompanyRel exist)
								for each FSMBODGeneralLedgerCompanyRel
									initialize LocalBodAccountingEntity
									initialize BillToPartyMasterCleanDocXMLBOD
									initialize LocalCrossAccountingEntity
									initialize LocalBODFormattedID
									LocalBodAccountingEntity = each.Company
									if(DerivedMultipleFEG = "Y")
										LocalCrossAccountingEntity = DerivedFinanceEnterpriseGroup + DerivedDelimiter + LocalBodAccountingEntity
									else
										LocalCrossAccountingEntity = LocalBodAccountingEntity
									if(LocalCrossAccountingEntity entered)
										if(FSMInboundBODTracker not entered)
											invoke Create FSMInboundBODTracker
												assign result to NewBODTracker
												invoked.Verb 					= 1
												invoked.Noun 					= "BillToPartyMaster"					
												invoked.BODDocumentID			= DerivedDocumentID
												invoked.BODVariationID			= DerivedBODVariationID
												invoked.Status					= 1
												invoked.StartDate				= system current timestamp
												invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
												invoked.Direction				= 1
												invoked.BODAccountingEntity		= LocalCrossAccountingEntity
												invoked.Reference1				= CustomerGroup
												invoked.Reference2				= "CustomerBillTo"
												invoked.Reference3				= Customer
												invoked.Reference4				= CustomerBillTo
												invoked.Reference5				= LocalBodAccountingEntity
												initialize invoked.Error			
												initialize invoked.ErrorMessage					
											LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
										LocalBODFormattedID = "infor-nid:" + DerivedTenantID + ":" + LocalCrossAccountingEntity + ":" + DerivedLocation + ":" + DerivedDocumentID + ":" + "?BillToPartyMaster&verb=Sync&TrackerID=" + LocalFSMInboundBODTracker
										BillToPartyMasterCleanDocXMLBOD = template.IONSyncBillToPartyMaster_CustomerBillTo_CleanDoc_ST document for this instance
										invoke SendSyncBillToPartyMasterNativeLPL
											resume on error
										   		Error										= true
												ErrorMessage	 							= error message
										if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage
												invoked.Status								= 2
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= LocalBODFormattedID
												invoked.BODXML								= BillToPartyMasterCleanDocXMLBOD
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status								= 3
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= LocalBODFormattedID
												invoked.BODXML								= BillToPartyMasterCleanDocXMLBOD			
					else
					if(DerivedAllCompanyFlag = "Y")
						if(RestartFlag)
							if (Customer.CompanyCustomerRel exists)
								LocalCompany		= FSMInboundBODTracker.Reference5
								if (GeneralLedgerCompanyRel exists)
									LocalAccountingEntity = GeneralLedgerCompanyRel.AccountingEntity
									LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + LocalAccountingEntity
								else
									if (DerivedConfigAccountingEntity entered)
										LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + DerivedConfigAccountingEntity
									else
										LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + CustomerGroup
								if(LocalBodAccountingEntity entered)
									LocalFSMInboundBODTracker		= FSMInboundBODTracker
									invoke Update FSMInboundBODTrackerRel
										invoked.Verb 					= 1
										invoked.Noun 					= "BillToPartyMaster"					
										invoked.BODDocumentID			= DerivedDocumentID
										invoked.BODVariationID			= DerivedBODVariationID
										invoked.Status					= 1
										invoked.StartDate				= system current timestamp
										invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
										invoked.Direction				= 1
										invoked.BODAccountingEntity		= LocalBodAccountingEntity
										invoked.Reference1				= CustomerGroup
										invoked.Reference2				= "CustomerBillTo"
										invoked.Reference3				= Customer
										invoked.Reference4				= CustomerBillTo
										initialize invoked.Error			
										initialize invoked.ErrorMessage	
								invoke SendSyncBillToPartyMasterNativeLPL
									resume on error
								   		Error										= true
										ErrorMessage	 							= error message
								if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 								= Error
										invoked.ErrorMessage 						= ErrorMessage
										invoked.Status								= 2
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= DerivedBODID
										invoked.BODXML								= SyncBillToPartyMasterXML
								else
									invoke Update FSMInboundBODTrackerRel
										invoked.Status								= 3
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= DerivedBODID
										invoked.BODXML								= SyncBillToPartyMasterXML
						else
							if (Customer.CompanyCustomerRel exists)
								for each Customer.CompanyCustomerRel
									LocalCompany		= each.Company
									if (GeneralLedgerCompanyRel exists)
										LocalAccountingEntity = GeneralLedgerCompanyRel.AccountingEntity
										LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + LocalAccountingEntity
									else
										if (DerivedConfigAccountingEntity entered)
											LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + DerivedConfigAccountingEntity
										else
											LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + CustomerGroup
									if(LocalBodAccountingEntity entered)
										if(FSMInboundBODTracker not entered)
											invoke Create FSMInboundBODTracker
												assign result to NewBODTracker
												invoked.Verb 					= 1
												invoked.Noun 					= "BillToPartyMaster"					
												invoked.BODDocumentID			= DerivedDocumentID
												invoked.BODVariationID			= DerivedBODVariationID
												invoked.Status					= 1
												invoked.StartDate				= system current timestamp
												invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
												invoked.Direction				= 1
												invoked.BODAccountingEntity		= LocalBodAccountingEntity
												invoked.Reference1				= CustomerGroup
												invoked.Reference2				= "CustomerBillTo"
												invoked.Reference3				= Customer
												invoked.Reference4				= CustomerBillTo
												invoked.Reference5				= LocalCompany
												initialize invoked.Error			
												initialize invoked.ErrorMessage
											LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
										invoke SendSyncBillToPartyMasterNativeLPL
											resume on error
										   		Error										= true
												ErrorMessage	 							= error message
										if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage
												invoked.Status								= 2
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= DerivedBODID
												invoked.BODXML								= SyncBillToPartyMasterXML
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status									= 3
												invoked.CloseDate								= system current timestamp
												invoked.BODID									= DerivedBODID
												invoked.BODXML									= SyncBillToPartyMasterXML			
					else
						if (DerivedConfigAccountingEntity entered)
							LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + DerivedConfigAccountingEntity
						else
							LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + CustomerGroup
						if(FSMInboundBODTracker not entered)
							invoke Create FSMInboundBODTracker
								assign result to NewBODTracker
								invoked.Verb 					= 1
								invoked.Noun 					= "BillToPartyMaster"					
								invoked.BODDocumentID			= DerivedDocumentID
								invoked.BODVariationID			= DerivedBODVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.Direction				= 1
								invoked.BODAccountingEntity		= LocalBodAccountingEntity
								invoked.Reference1				= CustomerGroup
								invoked.Reference2				= "CustomerBillTo"
								invoked.Reference3				= Customer
								invoked.Reference4				= CustomerBillTo
								initialize invoked.Error			
								initialize invoked.ErrorMessage					
							LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
						else 
							LocalFSMInboundBODTracker		= FSMInboundBODTracker
							invoke Update FSMInboundBODTrackerRel
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.BODDocumentID			= DerivedDocumentID
								invoked.BODVariationID			= DerivedBODVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.Direction				= 1
								invoked.BODAccountingEntity		= LocalBodAccountingEntity
								invoked.Reference1				= CustomerGroup
								invoked.Reference2				= "CustomerBillTo"
								invoked.Reference3				= Customer
								invoked.Reference4				= CustomerBillTo
								initialize invoked.Error			
								initialize invoked.ErrorMessage
						invoke SendSyncBillToPartyMasterNativeLPL
							resume on error
						   		Error										= true
								ErrorMessage	 							= error message
						if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 								= Error
								invoked.ErrorMessage 						= ErrorMessage
								invoked.Status								= 2
								invoked.CloseDate							= system current timestamp
								invoked.BODID								= DerivedBODID
								invoked.BODXML								= SyncBillToPartyMasterXML
						else
							invoke Update FSMInboundBODTrackerRel
								invoked.Status								= 3
								invoked.CloseDate							= system current timestamp
								invoked.BODID								= DerivedBODID
								invoked.BODXML								= SyncBillToPartyMasterXML									

		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmAccountingEntity	is Alpha size 22
					default label is "AccountingEntity"
				PrmLocation			is Alpha size 22
					default label is "Location"
				PrmDocumentID		is Alpha size 100
					default label is "DocumentID"
				PrmRevision			is Alpha size 22
					default label is "Revision"
				PrmSystemOfRecord	is Alpha size 1
					default label is "System_ofRecord"

			Action Rules
				if (bod id.AccountingEntity != PrmAccountingEntity)
					bod id.AccountingEntity = PrmAccountingEntity

				if (bod id.Location != PrmLocation)
					bod id.Location = PrmLocation

				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID = PrmDocumentID

				if (bod id.Revision != PrmRevision)
					bod id.Revision = PrmRevision

				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord = PrmSystemOfRecord

		BODDataInitialLoadCustomerBillToCriteria is a Set Action
			restricted
			Parameters
				PrmFEG							is a FinanceEnterpriseGroup
				PrmCustomerGroup				is a CustomerGroup
				PrmFromCustomer 				is a Customer
				PrmToCustomer 					is a Customer
				PrmFromCustomerBillTo			is a CustomerBillTo
					context of PrmFromCustomer
				PrmToCustomerBillTo				is a CustomerBillTo
					context of PrmFromCustomer

			Parameter Rules

			Instance Selection
				where (((PrmCustomerGroup entered
						and PrmCustomerGroup = CustomerGroup)
					or PrmCustomerGroup not entered)
				and	   ((PrmFromCustomer entered
						and PrmFromCustomer <= Customer)
					or PrmFromCustomer not entered)
				and	   ((PrmToCustomer entered
						and PrmToCustomer >= Customer)
					or PrmToCustomer not entered)
				and	   ((PrmFromCustomerBillTo entered
						and PrmFromCustomerBillTo <= CustomerBillTo)
					or PrmFromCustomerBillTo not entered)
				and	   ((PrmToCustomerBillTo entered
						and PrmToCustomerBillTo >= CustomerBillTo)
					or PrmToCustomerBillTo not entered))

			Action Rules

				Instance Rules
					if (CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup.BODTrigger)
						ActionCode	= ActionCode.Create
						increment bod id.VariationID
						include TriggerCustomerBillToServiceRules

						include TriggerProcessCustomerBillToServiceRules

	
		Anonymize is an Instance Action	
			restricted
			Action Rules
				Name	= Customer
				Contact	= Customer

				initialize PostalAddress
				initialize EmailAddress

			Exit Rules
				invoke Create AnonymizeLog
					invoked.FinanceEnterpriseGroup	= CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup
					invoked.Status					= 1
					invoked.AffectedBusinessClass	= "AR4"
					invoked.CustomerGroup			= CustomerGroup
					invoked.Customer				= Customer
					invoked.CustomerBillTo			= CustomerBillTo

		PurgeAuditLog is an Instance Action	
			restricted
			Action Rules
				invoke purge audit log entries

			Exit Rules
				invoke Create AnonymizeLog
					invoked.FinanceEnterpriseGroup	= CustomerBusinessGroupRel.FinanceEnterpriseGroup
					invoked.Status					= 2
					invoked.AffectedBusinessClass	= "AR4"
					invoked.CustomerGroup			= CustomerGroup
					invoked.Customer				= Customer
					invoked.CustomerBillTo			= CustomerBillTo
	
		SendProcessBillToPartyMasterNativeLPLBOD is an Instance Action
			restricted
			Entrance Rules
			Parameters
			Action Rules
				send ion bod
					bod is ProcessBillToPartyMasterXML
					bod type is "Process.BillToPartyMaster"
					document id is  DerivedDocumentID
					variation id is DerivedBODVariationID
					accounting entity is LocalBodAccountingEntity
		
		TriggerProcessBillToPartyMasterNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Parameters
				RestartFlag	is Boolean
				PrmTriggerFrom is Alpha 50
			Action Rules
				LocalVerb  = 2
				invoke NativeLPLBODTriggerChecks ProcessFSMBODConfigurationRel
					invoked.PrmVerb 					= 2
					invoked.PrmNoun						= "BillToPartyMaster"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "CustomerBillTo"
					invoked.PrmFinanceEnterpriseGroup	= CustomerBusinessGroupRel.FinanceEnterpriseGroup
					invoked.PrmBusinessGroup			= CustomerGroup
					invoked.PrmMainUserTemplate 		= "IONProcessBillToPartyMaster_CustomerBillTo_ST"
				LocalNativeLPLBODTrigger = ProcessFSMBODConfigurationRel.NativeLPLBODTrigger
				LocalBODTrigger			 = true
				if (CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup.BODTrigger and LocalNativeLPLBODTrigger)
					if (DerivedAllCompanyFlag = "Y")
						if(RestartFlag)
							if (Customer.CompanyCustomerRel exists)
								LocalCompany		= FSMInboundBODTracker.Reference2
								if (GeneralLedgerCompanyRel exists)
									LocalAccountingEntity = GeneralLedgerCompanyRel.AccountingEntity
									LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + LocalAccountingEntity
								else
									if (DerivedProcessConfigAccountingEntity entered)
										LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + DerivedProcessConfigAccountingEntity
									else	
										LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + CustomerGroup
								if(LocalBodAccountingEntity entered)
									LocalFSMInboundBODTracker		= FSMInboundBODTracker
									invoke Update FSMInboundBODTrackerRel
										invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
										invoked.BODDocumentID			= DerivedDocumentID
										invoked.BODVariationID			= DerivedBODVariationID
										invoked.Status					= 1
										invoked.StartDate				= system current timestamp
										invoked.Direction				= 1
										invoked.BODAccountingEntity		= LocalBodAccountingEntity
										invoked.Reference1				= CustomerGroup
										invoked.Reference3				= Customer
										invoked.Reference4				= CustomerBillTo
										initialize invoked.Error			
										initialize invoked.ErrorMessage
								invoke SendProcessBillToPartyMasterNativeLPLBOD
									resume on error
										Error										= true
										ErrorMessage	 							= error message
								if(Error)
									invoke Update FSMInboundBODTrackerRel
										invoked.Error 								= Error
										invoked.ErrorMessage 						= ErrorMessage
										invoked.Status								= 2
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= DerivedProcessBODID
										invoked.BODXML								= ProcessBillToPartyMasterXML
								else
									invoke Update FSMInboundBODTrackerRel
										invoked.Status								= 3
										invoked.CloseDate							= system current timestamp
										invoked.BODID								= DerivedProcessBODID
										invoked.BODXML								= ProcessBillToPartyMasterXML
						else
							if (Customer.CompanyCustomerRel exists)   
								for each Customer.CompanyCustomerRel
									LocalCompany = each.Company
									if (GeneralLedgerCompanyRel exists)
										LocalAccountingEntity = GeneralLedgerCompanyRel.AccountingEntity
										LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + LocalAccountingEntity
									else
										if (DerivedProcessConfigAccountingEntity entered)
											LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + DerivedProcessConfigAccountingEntity
										else	
											LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + CustomerGroup
									if(LocalBodAccountingEntity entered)
										if(FSMInboundBODTracker not entered)
											invoke Create FSMInboundBODTracker
												assign result to NewBODTracker
												invoked.Verb 					= 2
												invoked.Noun 					= "BillToPartyMaster"					
												invoked.BODDocumentID			= DerivedDocumentID
												invoked.BODVariationID			= DerivedBODVariationID
												invoked.Status					= 1
												invoked.StartDate				= system current timestamp
												invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
												invoked.Direction				= 1
												invoked.BODAccountingEntity		= LocalBodAccountingEntity
												invoked.Reference1				= CustomerGroup
												invoked.Reference2				= LocalCompany
												invoked.Reference3				= Customer
												invoked.Reference4				= CustomerBillTo
												initialize invoked.Error			
												initialize invoked.ErrorMessage					
											LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker 
										invoke SendProcessBillToPartyMasterNativeLPLBOD
											resume on error
										   		Error										= true
												ErrorMessage	 							= error message
										if(Error)
											invoke Update FSMInboundBODTrackerRel
												invoked.Error 								= Error
												invoked.ErrorMessage 						= ErrorMessage
												invoked.Status								= 2
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= DerivedProcessBODID
												invoked.BODXML								= ProcessBillToPartyMasterXML
										else
											invoke Update FSMInboundBODTrackerRel
												invoked.Status								= 3
												invoked.CloseDate							= system current timestamp
												invoked.BODID								= DerivedProcessBODID
												invoked.BODXML								= ProcessBillToPartyMasterXML 
					else
						if (DerivedProcessConfigAccountingEntity entered)
							LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + DerivedProcessConfigAccountingEntity
						else	
							LocalBodAccountingEntity = CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup + DerivedDelimiter + CustomerGroup		
						if(FSMInboundBODTracker not entered)
							invoke Create FSMInboundBODTracker
								assign result to NewBODTracker
								invoked.Verb 					= 2
								invoked.Noun 					= "BillToPartyMaster"
								invoked.BODDocumentID			= DerivedDocumentID
								invoked.BODVariationID			= DerivedBODVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.Direction				= 1
								invoked.BODAccountingEntity		= LocalBodAccountingEntity
								invoked.Reference1				= CustomerGroup
								invoked.Reference3				= Customer
								invoked.Reference4				= CustomerBillTo
								initialize invoked.Error			
								initialize invoked.ErrorMessage					
							LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
						else 
							LocalFSMInboundBODTracker		= FSMInboundBODTracker
							invoke Update FSMInboundBODTrackerRel
								invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
								invoked.BODDocumentID			= DerivedDocumentID
								invoked.BODVariationID			= DerivedBODVariationID
								invoked.Status					= 1
								invoked.StartDate				= system current timestamp
								invoked.Direction				= 1
								invoked.BODAccountingEntity		= LocalBodAccountingEntity
								invoked.Reference1				= CustomerGroup
								invoked.Reference3				= Customer
								invoked.Reference4				= CustomerBillTo
								initialize invoked.Error			
								initialize invoked.ErrorMessage
						invoke SendProcessBillToPartyMasterNativeLPLBOD
							resume on error
						   		Error										= true
								ErrorMessage	 							= error message
						if(Error)
							invoke Update FSMInboundBODTrackerRel
								invoked.Error 								= Error
								invoked.ErrorMessage 						= ErrorMessage
								invoked.Status								= 2
								invoked.CloseDate							= system current timestamp
								invoked.BODID								= DerivedBODID
								invoked.BODXML								= ProcessBillToPartyMasterXML
						else
							invoke Update FSMInboundBODTrackerRel
								invoked.Status								= 3
								invoked.CloseDate							= system current timestamp
								invoked.BODID								= DerivedBODID
								invoked.BODXML								= ProcessBillToPartyMasterXML

	Action Exit Rules
		if (CustomerGroup.CustomerBusinessGroup.FinanceEnterpriseGroup.BODTrigger and !LocalBODTrigger)
			if (action != "UpdateBODIdFields" and !action type.Delete) 
				ActionCode = ActionCode.Update
				if (action type.Create)
					ActionCode = ActionCode.Create
				increment bod id.VariationID
				include TriggerCustomerBillToServiceRules

				include TriggerProcessCustomerBillToServiceRules

