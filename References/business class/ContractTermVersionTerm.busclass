ContractTermVersionTerm is a BusinessClass
    owned by po
    prefix is CTVTM

    Patterns

	Ontology
		symbolic key is ContractTermVersionTerm
    	
    Persistent Fields
    	ContractArticle				is Numeric 8
    	ContractTermAndCondition	is Numeric 8
    	Title          				is a Description
        HeaderText     				is Alpha 100
        Description    				is Text
    	OriginalTitle          		is a Description
        OriginalHeaderText     		is Alpha 100
        OriginalDescription    		is Text
        DisplayOrder

	Transient Fields
	
	Sets
		ByContractArticle
			Sort Order
				ContractGroup
				Contract
				ContractTermVersion
				ContractArticle
				ContractTermAndCondition
				ContractTermVersionArticle
				ContractTermVersionTerm

		ByDisplayOrder
			duplicates
			Sort Order
				ContractGroup
				Contract
				ContractTermVersion
				ContractTermVersionArticle
				DisplayOrder
				ContractTermVersionTerm

  	Conditions
		UpdatesExistsInThisVersion
			restricted
			when (ContractTermAndConditionUpdateRel exists)
		UpdatesExistInAnyPreviousVersion
			restricted
			when (AllPreviousContractTermAndConditionUpdateRel exists)
		UpdatesInFirstVersion
			restricted
			when (ContractTermAndConditionUpdatesInThisVersionRel exists)
		AttachmentsAdded
			restricted
			when (AttachmentsAddedInThisVersionRel exists)
		AttachmentsDeleted
			restricted
			when (AttachmentsDeletedInThisVersionRel exists)
		AttachmentsToAddInThisVersion
			restricted
			when (AttachmentsToAddInThisVersionRel exists)
		AttachmentsToDeleteInThisVersion
			restricted
			when (AttachmentsToDeleteInThisVersionRel exists)
		AttachmentsAddedInAnyVersion
			restricted
			when (AllAttachmentsAddedRel exists)
		AttachmentsDeletedInAnyVersion
			restricted
			when (AllAttachmentsDeletedRel exists)
		AttachmentsAddedSinceLastActivatedVersion
			restricted
			when (AttachmentsAddedSinceLastActivatedVersionRel exists)
		AttachmentsDeletedSinceLastActivatedVersion
			restricted
			when (AttachmentsDeletedSinceLastActivatedVersionRel exists)
		AllUpdatesSinceLastActivatedVersion
			restricted
			when (AllUpdatesSinceLastActivatedVersionRel exists)
		AttachmentsAddedSinceFirstActivatedVersion
			restricted
			when (AttachmentsAddedSinceFirstActivatedVersionRel exists)
		AttachmentsDeletedSinceFirstActivatedVersion
			restricted
			when (AttachmentsDeletedSinceFirstActivatedVersionRel exists)
		AllUpdatesSinceFirstActivatedVersion
			restricted
			when (AllUpdatesSinceFirstActivatedVersionRel exists)

   	Relations
		ContractTermVersionTermAttachmentNoDeletesRel
			one-to-many relation to ContractTermVersionTermAttachment
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractTermVersion			= ContractTermVersion
				related.ContractTermVersionArticle	= ContractTermVersionArticle
				related.ContractTermVersionTerm		= ContractTermVersionTerm
			Instance Selection
				where (!related.SpecificRequestType.DeleteAttachment)

		ContractTermVersionTermAttachmentNoPendingDeletesRel
			one-to-many relation to ContractTermVersionTermAttachment
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractTermVersion			= ContractTermVersion
				related.ContractTermVersionArticle	= ContractTermVersionArticle
				related.ContractTermVersionTerm		= ContractTermVersionTerm
			Instance Selection
				where (!related.SpecificRequestType.DeleteAttachment
				and	   !related.ContractTermAndConditionUpdatePendingDeletion)

		AttachmentNoAddsOrDeletesRel
			one-to-many relation to ContractTermVersionTermAttachment
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractTermVersion			= ContractTermVersion
				related.ContractTermVersionArticle	= ContractTermVersionArticle
				related.ContractTermVersionTerm		= ContractTermVersionTerm
			Instance Selection
				where (!related.SpecificRequestType.DeleteAttachment
				and	   !related.SpecificRequestType.AddAttachment)

		OriginalContractTermVersionTermRel
			one-to-many relation to ContractTermVersionTerm
			Field Mapping uses symbolic key
				related.ContractGroup		= ContractGroup
				related.Contract			= Contract
				related.ContractTermVersion	= DerivedOriginalVersionNumber	
			Instance Selection
				where (related.ContractArticle = ContractArticle
				and	   related.ContractTermAndCondition = ContractTermAndCondition)

		PreviousActivatedContractTermVersionTermRel
			one-to-many relation to ContractTermVersionTerm
			Field Mapping uses symbolic key
				related.ContractGroup		= ContractGroup
				related.Contract			= Contract
				related.ContractTermVersion	= ContractTermVersion.DerivedPreviousActivatedVersionNumber
			Instance Selection
				where (related.ContractArticle = ContractArticle
				and	   related.ContractTermAndCondition = ContractTermAndCondition)

		OriginalActivatedContractTermVersionTermRel
			one-to-many relation to ContractTermVersionTerm
			Field Mapping uses symbolic key
				related.ContractGroup		= ContractGroup
				related.Contract			= Contract
				related.ContractTermVersion	= ContractTermVersion.DerivedFirstActivatedVersionNumber
			Instance Selection
				where (related.ContractArticle = ContractArticle
				and	   related.ContractTermAndCondition = ContractTermAndCondition)

		ContractTermVersionRel
			one-to-many relation to ContractTermVersion
			Field Mapping uses symbolic key
				related.ContractGroup		= ContractGroup
				related.Contract			= Contract

		ContractTermAndConditionUpdateRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion = ContractTermVersion
				and	   related.ChangesMade
				and	   (related.ApprovalStage.SupplierNegotiation
				or		related.ApprovalStage.SupplierAddendumNegotiation))

		AllPreviousContractTermAndConditionUpdateRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion <= ContractTermVersion
				and	   related.ChangesMade
				and	   (related.ApprovalStage.SupplierNegotiation
				or		related.ApprovalStage.SupplierAddendumNegotiation))

		AllUpdatesSinceLastActivatedVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion <= ContractTermVersion
				and	   related.TermNegotiationVersion > ContractTermVersion.DerivedPreviousActivatedVersionNumber
				and	   related.ChangesMade
				and	   (related.ApprovalStage.SupplierNegotiation
				or		related.ApprovalStage.SupplierAddendumNegotiation))

		AllUpdatesSinceFirstActivatedVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion <= ContractTermVersion
				and	   related.TermNegotiationVersion > ContractTermVersion.DerivedFirstActivatedVersionNumber
				and	   related.ChangesMade
				and	   (related.ApprovalStage.SupplierNegotiation
				or		related.ApprovalStage.SupplierAddendumNegotiation))

		ContractTermAndConditionUpdatesInThisVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion = ContractTermVersion
				and	   related.ChangesApproved)

		AttachmentsAddedInThisVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion = ContractTermVersion
				and	   related.ActionTaken.Approved
				and	   related.SpecificRequestType.AddAttachment)

		AttachmentsDeletedInThisVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion = ContractTermVersion
				and	   related.ActionTaken.Approved
				and	   related.SpecificRequestType.DeleteAttachment)

		AttachmentsToAddInThisVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion = ContractTermVersion
				and	   related.SpecificRequestType.AddAttachment)

		AttachmentsToDeleteInThisVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion = ContractTermVersion
				and	   related.SpecificRequestType.DeleteAttachment)

		AllAttachmentsAddedRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion	<= ContractTermVersion
				and	   related.TermNegotiationVersion	> 1
				and	   related.SpecificRequestType.AddAttachment)

		AttachmentsAddedSinceLastActivatedVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion	<= ContractTermVersion
				and	   related.TermNegotiationVersion	> ContractTermVersion.DerivedPreviousActivatedVersionNumber
				and	   related.SpecificRequestType.AddAttachment)

		AttachmentsAddedSinceFirstActivatedVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion	<= ContractTermVersion
				and	   related.TermNegotiationVersion	> ContractTermVersion.DerivedFirstActivatedVersionNumber
				and	   related.SpecificRequestType.AddAttachment)

		AllAttachmentsDeletedRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion	<= ContractTermVersion
				and	   related.TermNegotiationVersion	> 1
				and	   related.SpecificRequestType.DeleteAttachment)

		AttachmentsDeletedSinceLastActivatedVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion	<= ContractTermVersion
				and	   related.TermNegotiationVersion	> ContractTermVersion.DerivedPreviousActivatedVersionNumber
				and	   related.SpecificRequestType.DeleteAttachment)

		AttachmentsDeletedSinceFirstActivatedVersionRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup  				= ContractGroup
				related.Contract  					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion	<= ContractTermVersion
				and	   related.TermNegotiationVersion	> ContractTermVersion.DerivedFirstActivatedVersionNumber
				and	   related.SpecificRequestType.DeleteAttachment)

		AttachmentsToAddInPreviousVersionsRel
			one-to-many relation to ContractTermAndConditionUpdate
			Field Mapping uses symbolic key
				related.ContractGroup				= ContractGroup
				related.Contract					= Contract
				related.ContractArticle				= ContractArticle
				related.ContractTermAndCondition	= ContractTermAndCondition
			Instance Selection
				where (related.TermNegotiationVersion	< ContractTermVersion
				and	   related.TermNegotiationVersion	> ContractTermVersion.DerivedPreviousActivatedVersionNumber
				and	   related.TermNegotiationVersion	> 1
				and	   related.SpecificRequestType.AddAttachment)

    Context Fields
   			
    Field Groups

   	Local Fields

	Derived Fields
		DerivedCompareCurrentAndOriginalHeaderText is a NativeField
			type is RichText

		DerivedCompareCurrentAndOriginalDescription is a NativeField
			type is RichText

		DerivedCompareCurrentAndPreviousHeaderText is a NativeField
			type is RichText

		DerivedCompareCurrentAndPreviousDescription is a NativeField
			type is RichText

		DerivedCompareCurrentAndPreviousActivatedHeaderText is a NativeField
			type is RichText

		DerivedCompareCurrentAndPreviousActivatedDescription is a NativeField
			type is RichText

		DerivedCompareCurrentAndOriginalActivatedHeaderText is a NativeField
			type is RichText

		DerivedCompareCurrentAndOriginalActivatedDescription is a NativeField
			type is RichText


		DerivedOriginalHeaderText is a DerivedField
			type is Alpha 100
			restricted
			if (OriginalContractTermVersionTermRel exists)
				return first OriginalContractTermVersionTermRel.HeaderText
			else
				return ""


		DerivedOriginalDescription is a DerivedField
			type is Text
			restricted
			if (OriginalContractTermVersionTermRel exists)
				return first OriginalContractTermVersionTermRel.Description
			else
				return ""


		DerivedPreviousActivatedHeaderText is a DerivedField
			type is Alpha 100
			restricted
			if (PreviousActivatedContractTermVersionTermRel exists)
				return first PreviousActivatedContractTermVersionTermRel.HeaderText
			else
				return ""


		DerivedPreviousActivatedDescription is a DerivedField
			type is Text
			restricted
			if (PreviousActivatedContractTermVersionTermRel exists)
				return first PreviousActivatedContractTermVersionTermRel.Description
			else
				return ""


		DerivedOriginalActivatedHeaderText is a DerivedField
			type is Alpha 100
			restricted
			if (OriginalActivatedContractTermVersionTermRel exists)
				return first OriginalActivatedContractTermVersionTermRel.HeaderText
			else
				return ""


		DerivedOriginalActivatedDescription is a DerivedField
			type is Text
			restricted
			if (OriginalActivatedContractTermVersionTermRel exists)
				return first OriginalActivatedContractTermVersionTermRel.Description
			else
				return ""

		DerivedOriginalVersionNumber is a DerivedField
			type is Numeric 4
			restricted
			return first ContractTermVersionRel.ContractTermVersion

		DerivedPreviousVersionNumber is a DerivedField
			type is Numeric 4
			restricted
			return (ContractTermVersion - 1)

    Field Rules
			
	Actions
		Create is a Create Action
			restricted

		Update is an Update Action
			restricted

		Delete is a Delete Action
			restricted
