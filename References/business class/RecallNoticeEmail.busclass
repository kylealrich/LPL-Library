RecallNoticeEmail is a BusinessClass
    owned by recall
    prefix is RMRNE

    Ontology
    	symbolic key is RecallNoticeEmail
    	
    Persistent Fields
    	ToUser			is a RecallUser
    	ToEmail 		is an EmailAddress 
    		holds pii
    		default label is "To"
		FromUser		is a RecallUser
		FromEmail 		is an EmailAddress 
			holds pii
			default label is "From"
		EmailSubject 	is Alpha size up to 250
			default label is "Subject"
		EmailContent	is Text
			default label is "Content"
		EmailAttachment is an Attachment
			default label is "Attachment"
		SentTimeStamp	is TimeStamp
			default label is "Sent"
	
	Field Rules

	Conditions
		HasAttachment
			restricted
			when (EmailAttachment.File entered)
			
		EmailSent
			restricted
			when (SentTimeStamp entered)
			
   	Sets
   		ByNoticeEmailSubject
   			indexed
   			Sort Order
   				RecallNotice
   				ToEmail
   				EmailSubject
   				RecallNoticeEmail
   				
   	Actions
		ComposeEmail is a Create Action
			restricted
		
		ReleaseEmail is an Instance Action
			restricted
			valid when (!EmailSent)
			Action Rules
				SentTimeStamp = current timestamp
			Exit Rules
				send email
					to ToEmail
					from FromEmail
					subject "<EmailSubject>"
					Attachments
						if (EmailAttachment entered)
							attachment EmailAttachment.File
								name is EmailAttachment.Title
								mime type is EmailAttachment.MimeType
					Contents 
						"<EmailContent>"

		CreateEmail is a Create Action
			Action Rules
				SentTimeStamp = current timestamp
			Exit Rules
				send email
					to ToEmail
					from FromEmail
					subject "<EmailSubject>"
					Attachments
						if (EmailAttachment entered)
							attachment EmailAttachment.File
								name is EmailAttachment.Title
								mime type is EmailAttachment.MimeType
					Contents 
						"<EmailContent>"

		Update is an Update Action
			restricted
		
		Delete is a Delete Action
			restricted
		
		Purge is a Purge Action
			restricted
