EAMWorkOrder is a BusinessClass
	owned by eam
	prefix is eWO

	Ontology
		symbolic key is EAMWorkOrder

	Patterns
		disable AuditIndex
		implements BODId
       	disable EffectiveDated
		implements CreateStamp
		implements UpdateStamp
		
	Persistent Fields

		UpdateDate					is Date
		CreateDate					is Date
		Description					is Alpha 80
		Comment						is Alpha 256
		WorkOrderType				is AlphaUpper 20
		Priority					is AlphaUpper 8
		ParentID					is AlphaUpper 30
		ReportedDate				is Date
		RequestedStartDate			is Date
		RequestedEndDate			is Date
		ScheduledStartDate			is Date
		ScheduledEndDate			is Date
		StartDate					is Date
		CompletionDate				is Date
		TargetValue					is an InternationalCost
		EstimatedTotalCost			is an InternationalCost
		ActualTotalCost				is an InternationalCost
		PositionFacility			is Alpha 30
		Sequence					is AlphaUpper 1
		WorkPackage					is Alpha 24
		PreventiveMaintenanceCode	is AlphaUpper 20
		AssignedByPerson			is Alpha 30
		ReportedByPerson			is Alpha 15
		ProjectID					is Alpha 20
		ProjectDescription			is Alpha 80
		ProjectBudgetID				is AlphaUpper 20
		PersonAssignedTo			is Alpha 15
		ProblemCode					is AlphaUpper 8
		Status						is AlphaUpper 1
		StatusCode					is AlphaUpper 4
		StatusDescription			is Alpha 60
		CostCode					is AlphaUpper 30
		JobType						is AlphaUpper 8
		Department					is AlphaUpper 15
		OrderClass					is AlphaUpper 8
		DistributionAccount			is a FinanceCodeBlock

		CreatedBy 					is Alpha 30
		EnteredBy 					is Alpha 30
		Criticality 				is Alpha 8
		Safety						is AlphaUpper 1
		ChangeNotice				is AlphaUpper 24
		Dependent					is AlphaUpper 1
		Reopened					is AlphaUpper 1
		Route						is AlphaUpper 20
		Printed						is AlphaUpper 1
		MultipleEquipment			is AlphaUpper 1




		MaintenancePatternCode  	is AlphaUpper 30
		MaintenancePatternSequence  is Numeric 8
		TypeCode  					is AlphaUpper 4
		ClassOrganization 			is AlphaUpper 15
		ServiceRequest 				is Alpha 30
		Shift 						is AlphaUpper 4
		MeterUOM 					is Alpha 4
		LastMeterReading 			is like InternationalCost
		TriggerEventID 				is AlphaUpper 30
		MSProject 					is AlphaUpper 20
		Print 						is AlphaUpper 1
		CallerName 					is Alpha 80
		CustomerID 					is AlphaUpper 30
		Level 						is Alpha 30
		RejectReason 				is Alpha 240
		FromPoint 					is like InternationalCost
		FromReferenceDescription	is Alpha 80
		FromGeoReference			is Alpha 256
		ToPoint 					is like InternationalCost
		ToReferenceDescription 		is Alpha 80
		ToGeoReference 				is Alpha 256
		Agreement 					is AlphaUpper 30
		DueDate 					is Date
		ProviderID 					is AlphaUpper 30
		ProviderOrganization		is AlphaUpper 15
		ServiceCategory 			is AlphaUpper 30
		ServiceCategoryOrganization	is AlphaUpper 15
		ServiceProblemOrganization	is AlphaUpper 15
		EquipmentUsability 			is AlphaUpper 30
		EquipmentUsabilityOrganization is AlphaUpper 15
		PermanentFixPromiseDate   	is Date
		TemporaryFixPromiseDate  	is Date
		WorkAddress 				is Alpha 256
		Alert 						is Alpha 30
		ProductionRequest 			is Alpha 30
		ProductionRequestRevision 	is Numeric 4
		ProductionPriority  		is Alpha 100
		ProductionStart  			is Date
		ChargeableDays				is Numeric 9
		EquipmentCode				is Alpha 30
		EquipmentDescription		is Alpha 80
		EquipmentType				is Alpha 4
		Asset						is Alpha 80
		EAMCompany					is a GeneralLedgerCompany		

	Local Fields
		LocalPurgeRecords			is Boolean
		LocalRecordsProcessed		is Numeric 10

	Derived Fields
		DerivedCompletionDetailMessage is a DerivedField
			type is RichText
			if (LocalPurgeRecords)
				return DerivedPurgeRecordsMessage
			else
				return DerivedReportOnlyMessage
			
		DerivedPurgeRecordsMessage is a MessageField
			"EAMWorkOrderPurgeHasBeenCompletedFor<LocalRecordsProcessed>Records."
			
		DerivedReportOnlyMessage is a MessageField
			"ThereAre<LocalRecordsProcessed>EAMWorkOrderRecordsToPurge."

	Relations
        EAMWorkOrderUserFieldsRel
            one-to-one relation to EAMWorkOrderUserFields
            Field Mapping uses symbolic key
                related.FinanceEnterpriseGroup	 = FinanceEnterpriseGroup
                related.EAMWorkOrder			 = EAMWorkOrder

		EAMWorkOrderActivityRel
			one-to-many relation to EAMWorkOrderActivity
			delete cascades
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	 = FinanceEnterpriseGroup
				related.EAMWorkOrder			 = EAMWorkOrder

	Actions
		Create is a Create Action
		
		Update is an Update Action
		
		Delete is a Delete Action
	
		EAMWorkOrderPurge is a Set Action
			completion message is "<DerivedCompletionDetailMessage>"
			restricted
			Parameters
				PrmClosedDate			is Date
					default label is "ClosedDate"
				PrmPurgeEAMWorkOrder	is AlphaUpper size 1
					default label is "PurgeEAMWorkOrder"
					States
						PurgeEAMWorkOrder		value is "Y"
						ReportOnlyDoNotPurge	value is "R"
			Parameter Rules
				PrmClosedDate
					required
				PrmPurgeEAMWorkOrder
					initial value is "R"
					default to "R"
			Local Fields
				LocalActor				is an Actor
				LocalRecordCount		is Numeric 10
			Instance Selection
				where (Status = "C"
				and    CompletionDate <= PrmClosedDate)
			Action Rules
				Empty Set Rules
					LocalActor = actor
					send notification
						to LocalActor
						description is "NoEAMWorkOrderRecordsFoundToPurge"
						priority is high
						detail is "EAMWorkOrderPurgeHasBeenCompletedFor<LocalRecordCount>Records"
				Set Rules
					Exit Rules
						if (PrmPurgeEAMWorkOrder.PurgeEAMWorkOrder)
							LocalPurgeRecords = true
						LocalRecordsProcessed	= LocalRecordCount
						LocalActor				= actor
						send notification
							to LocalActor
							description is "EAMWorkOrderPurgeHasBeenCompleted"
							priority is high
							detail is "<DerivedCompletionDetailMessage>"
				Instance Rules
					increment LocalRecordCount
					if (PrmPurgeEAMWorkOrder.PurgeEAMWorkOrder)
						invoke Purge
						
		Purge is a Purge Action
			restricted
			Entrance Rules
				invoke Purge EAMWorkOrderActivityRel
				invoke Purge EAMWorkOrderUserFieldsRel
