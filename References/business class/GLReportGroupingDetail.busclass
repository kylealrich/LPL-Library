GLReportGroupingDetail is a BusinessClass
	owned by GeneralLedger
	
	prefix is GLReD
	
	Ontology
		symbolic key is GLReportGroupingDetail
	
	Patterns
	
	Persistent Fields
	
	Conditions
		HasReportGroupAccess
			when (GLReportGrouping.HasReportGroupAccess)
			
		HasEditAccess
			when (GLReportGrouping.HasEditAccess)
		
		IsFiscalQuarter
			when (GLReport.DerivedIsFiscalQuarter)
		
		ReportIsNotGenerated
			when (GLReport.IntegrationStatus.NotGenerated)
		
		ReportIsOutOfSync
			when (GLReport.IntegrationStatus.OutOfSync)
		
		IsRunReportValid 
			when (GLReport.RunReportIsValid 
			and !(RunReportForActorAsyncActionRequestProcessingRel exists))		

	Derived Fields
		DerivedIsFiscalQuarter is a DerivedField
			type is Boolean
			if(!GLReport.CompositeReport)
				for each GLColumnRel
					if (each.ColumnValue contains "quarter")
						return true
			else
				if (GLReportElementRel exists)
					for each GLColumnCompositeRel 
						if (each.ColumnValue contains "quarter")
							return true
			return false
		
		DerivedIsQuarterOrMonth	is a DerivedField 
			type is Alpha size 10 
			if (GLReport.DerivedIsFiscalQuarter)
				return "Quarter" 
			else 
				return "Month"

	Local Fields 
		LocalGLReportGrouping	is a GLReportGrouping 

	Actions
		Create is an Action
			valid when (HasEditAccess) 
		
		Update is an Action
			valid when (HasEditAccess)
		
		Delete is an Action
			valid when (HasEditAccess)
		
		RunReportForGroup is a Set Action

			Queue Mapping Fields
				PrmGLReportGrouping

			Parameters
				PrmGLReportGrouping			is a GLReportGrouping
				ReportFormat			is Numeric 1
					States
						PDF		value is 1
						Excel	value is 2
						CSV		value is 3
				ReportDistributionGroup
					default label is "DistributionGroup_(Optional)"
				ShowTopNodes 			is Boolean
				FinanceEnterpriseGroup
				BalanceType				is Text
					States
						NaturalBalance			value is "Natural Balance"
						FinancialReportBalance 	value is "Financial Report Balance"
				ReportingBasis
				GeneralLedgerCalendar
				GeneralLedgerCalendarTopNode is like GeneralLedgerCalendarPeriod 
				FiscalYear				is Numeric 4
				FiscalMonth				is Numeric 2
				FiscalQuarter           is Numeric 1
				GLChartAccountTopNode	is a GeneralLedgerChartAccount
					default label is "<FinanceEnterpriseGroup.AccountLabel>Structure"
				GeneralLedgerChartAccount
					default label is "<FinanceEnterpriseGroup.AccountLabel>"
				AccountingEntity
				AccountingUnitStructure
				AccountingUnit
				Currency
				ProjectTopNode			is a Project
					default label is "<FinanceEnterpriseGroup.ProjectLabel>Structure"
				Project
					default label is "<FinanceEnterpriseGroup.ProjectLabel>"
				GeneralLedgerSystemCode
					default label is "System"
				Ledger
				Scenario
				FinanceDimension1TopNode is a FinanceDimension1
					default label is "<FinanceEnterpriseGroup.FinanceDimension1Label>Structure"
				FinanceDimension1
					default label is "<FinanceEnterpriseGroup.FinanceDimension1Label>"
				FinanceDimension2TopNode is a FinanceDimension2
					default label is "<FinanceEnterpriseGroup.FinanceDimension2Label>Structure"
				FinanceDimension2
					default label is "<FinanceEnterpriseGroup.FinanceDimension2Label>"
				FinanceDimension3TopNode is a FinanceDimension3
					default label is "<FinanceEnterpriseGroup.FinanceDimension3Label>Structure"			
				FinanceDimension3
					default label is "<FinanceEnterpriseGroup.FinanceDimension3Label>"
				FinanceDimension4TopNode is a FinanceDimension4
					default label is "<FinanceEnterpriseGroup.FinanceDimension4Label>Structure"			
				FinanceDimension4
					default label is "<FinanceEnterpriseGroup.FinanceDimension4Label>"
				FinanceDimension5TopNode is a FinanceDimension5
					default label is "<FinanceEnterpriseGroup.FinanceDimension5Label>Structure"			
				FinanceDimension5
					default label is "<FinanceEnterpriseGroup.FinanceDimension5Label>"
				FinanceDimension6TopNode is a FinanceDimension6
					default label is "<FinanceEnterpriseGroup.FinanceDimension6Label>Structure"			
				FinanceDimension6
					default label is "<FinanceEnterpriseGroup.FinanceDimension6Label>"
				FinanceDimension7TopNode is a FinanceDimension7
					default label is "<FinanceEnterpriseGroup.FinanceDimension7Label>Structure"
				FinanceDimension7
					default label is "<FinanceEnterpriseGroup.FinanceDimension7Label>"
				FinanceDimension8TopNode is a FinanceDimension8
					default label is "<FinanceEnterpriseGroup.FinanceDimension8Label>Structure"
				FinanceDimension8
					default label is "<FinanceEnterpriseGroup.FinanceDimension8Label>"
				FinanceDimension9TopNode is a FinanceDimension9
					default label is "<FinanceEnterpriseGroup.FinanceDimension9Label>Structure"
				FinanceDimension9
					default label is "<FinanceEnterpriseGroup.FinanceDimension9Label>"
				FinanceDimension10TopNode is a FinanceDimension10
					default label is "<FinanceEnterpriseGroup.FinanceDimension10Label>Structure"
				FinanceDimension10
					default label is "<FinanceEnterpriseGroup.FinanceDimension10Label>"
			

			Instance Selection
				where (GLReportGrouping                = PrmGLReportGrouping)

			Action Rules
				
				Instance Rules
					invoke RunReport GLReport
						invoked.ReportFormat 			= ReportFormat
						invoked.ReportDistributionGroup = ReportDistributionGroup
						invoked.ShowTopNodes			= ShowTopNodes
						invoked.FinanceEnterpriseGroup 	= FinanceEnterpriseGroup
						invoked.BalanceType				= BalanceType
						invoked.ReportingBasis			= ReportingBasis
						invoked.GeneralLedgerCalendar	= GeneralLedgerCalendar
						invoked.GeneralLedgerCalendarTopNode = GeneralLedgerCalendarTopNode
						invoked.FiscalYear					    = FiscalYear
						invoked.FiscalMonth						= FiscalMonth
						invoked.FiscalQuarter                   = FiscalQuarter
						invoked.GLChartAccountTopNode			= GLChartAccountTopNode
						invoked.GeneralLedgerChartAccount		= GeneralLedgerChartAccount
						invoked.AccountingEntity				= AccountingEntity
						invoked.AccountingUnitStructure			= AccountingUnitStructure
						invoked.AccountingUnit					= AccountingUnit
						invoked.Currency						= Currency
						invoked.ProjectTopNode					= ProjectTopNode
						invoked.Project							= Project
						invoked.GeneralLedgerSystemCode			= GeneralLedgerSystemCode
						invoked.Ledger							= Ledger
						invoked.Scenario						= Scenario
						invoked.FinanceDimension1TopNode		= FinanceDimension1TopNode
						invoked.FinanceDimension1				= FinanceDimension1
						invoked.FinanceDimension2TopNode		= FinanceDimension2TopNode
						invoked.FinanceDimension2				= FinanceDimension2
						invoked.FinanceDimension3TopNode		= FinanceDimension3TopNode
						invoked.FinanceDimension3				= FinanceDimension3
						invoked.FinanceDimension4TopNode		= FinanceDimension4TopNode
						invoked.FinanceDimension4				= FinanceDimension4
						invoked.FinanceDimension5TopNode		= FinanceDimension5TopNode
						invoked.FinanceDimension5				= FinanceDimension5
						invoked.FinanceDimension6TopNode		= FinanceDimension6TopNode
						invoked.FinanceDimension6				= FinanceDimension6
						invoked.FinanceDimension7TopNode		= FinanceDimension7TopNode
						invoked.FinanceDimension7				= FinanceDimension7
						invoked.FinanceDimension8TopNode		= FinanceDimension8TopNode
						invoked.FinanceDimension8				= FinanceDimension8
						invoked.FinanceDimension9TopNode		= FinanceDimension9TopNode
						invoked.FinanceDimension9				= FinanceDimension9
						invoked.FinanceDimension10TopNode		= FinanceDimension10TopNode
						invoked.FinanceDimension10				= FinanceDimension10

					commit transaction

				Set Rules 
					Exit Rules
						LocalGLReportGrouping = PrmGLReportGrouping
						invoke Update GLReportGroupingRel 
							invoked.LastReportRunDate = current timestamp

		RunReport is an Instance Action
			run in background
			Queue Mapping Fields
				GLReportGrouping
				GLReport
			
			Parameters
				ReportFormat			is Numeric 1
					States
						PDF		value is 1
						Excel	value is 2
						CSV		value is 3
				ReportDistributionGroup
					default label is "DistributionGroup_(Optional)"
				ShowTopNodes 			is Boolean
				FinanceEnterpriseGroup
				BalanceType				is Text
					States
						NaturalBalance			value is "Natural Balance"
						FinancialReportBalance 	value is "Financial Report Balance"
				ReportingBasis
				GeneralLedgerCalendar
				GeneralLedgerCalendarTopNode is like GeneralLedgerCalendarPeriod 
				FiscalYear				is Numeric 4
				FiscalMonth				is Numeric 2
				FiscalQuarter           is Numeric 1
				GLChartAccountTopNode	is a GeneralLedgerChartAccount
					default label is "<FinanceEnterpriseGroup.AccountLabel>Structure"
				GeneralLedgerChartAccount
					default label is "<FinanceEnterpriseGroup.AccountLabel>"
				AccountingEntity
				AccountingUnitStructure
				AccountingUnit
				Currency
				ProjectTopNode			is a Project
					default label is "<FinanceEnterpriseGroup.ProjectLabel>Structure"
				Project
					default label is "<FinanceEnterpriseGroup.ProjectLabel>"
				GeneralLedgerSystemCode
					default label is "System"
				Ledger
				Scenario
				FinanceDimension1TopNode is a FinanceDimension1
					default label is "<FinanceEnterpriseGroup.FinanceDimension1Label>Structure"
				FinanceDimension1
					default label is "<FinanceEnterpriseGroup.FinanceDimension1Label>"
				FinanceDimension2TopNode is a FinanceDimension2
					default label is "<FinanceEnterpriseGroup.FinanceDimension2Label>Structure"
				FinanceDimension2
					default label is "<FinanceEnterpriseGroup.FinanceDimension2Label>"
				FinanceDimension3TopNode is a FinanceDimension3
					default label is "<FinanceEnterpriseGroup.FinanceDimension3Label>Structure"			
				FinanceDimension3
					default label is "<FinanceEnterpriseGroup.FinanceDimension3Label>"
				FinanceDimension4TopNode is a FinanceDimension4
					default label is "<FinanceEnterpriseGroup.FinanceDimension4Label>Structure"			
				FinanceDimension4
					default label is "<FinanceEnterpriseGroup.FinanceDimension4Label>"
				FinanceDimension5TopNode is a FinanceDimension5
					default label is "<FinanceEnterpriseGroup.FinanceDimension5Label>Structure"			
				FinanceDimension5
					default label is "<FinanceEnterpriseGroup.FinanceDimension5Label>"
				FinanceDimension6TopNode is a FinanceDimension6
					default label is "<FinanceEnterpriseGroup.FinanceDimension6Label>Structure"			
				FinanceDimension6
					default label is "<FinanceEnterpriseGroup.FinanceDimension6Label>"
				FinanceDimension7TopNode is a FinanceDimension7
					default label is "<FinanceEnterpriseGroup.FinanceDimension7Label>Structure"
				FinanceDimension7
					default label is "<FinanceEnterpriseGroup.FinanceDimension7Label>"
				FinanceDimension8TopNode is a FinanceDimension8
					default label is "<FinanceEnterpriseGroup.FinanceDimension8Label>Structure"
				FinanceDimension8
					default label is "<FinanceEnterpriseGroup.FinanceDimension8Label>"
				FinanceDimension9TopNode is a FinanceDimension9
					default label is "<FinanceEnterpriseGroup.FinanceDimension9Label>Structure"
				FinanceDimension9
					default label is "<FinanceEnterpriseGroup.FinanceDimension9Label>"
				FinanceDimension10TopNode is a FinanceDimension10
					default label is "<FinanceEnterpriseGroup.FinanceDimension10Label>Structure"
				FinanceDimension10
					default label is "<FinanceEnterpriseGroup.FinanceDimension10Label>"

			Parameter Rules
				ReportFormat
					initial value is ReportFormat.PDF
					required
				ReportingBasis
					required
				FiscalYear
					required
				FiscalMonth
					if(!DerivedIsFiscalQuarter)
						required
						constraint(FiscalMonth > 0 and FiscalMonth < 13)
							"FiscalMonthRange_1To_12Only"
				FiscalQuarter
					if(DerivedIsFiscalQuarter)
						required
						constraint(FiscalQuarter > 0 and FiscalQuarter < 5)
							"FiscalQuarterRange_1To_4Only"	
					
			Action Rules
				invoke RunReport GLReport
					invoked.ReportFormat 			= ReportFormat
					invoked.ReportDistributionGroup = ReportDistributionGroup
					invoked.ShowTopNodes			= ShowTopNodes
					invoked.FinanceEnterpriseGroup 	= FinanceEnterpriseGroup
					invoked.BalanceType				= BalanceType
					invoked.ReportingBasis			= ReportingBasis
					invoked.GeneralLedgerCalendar	= GeneralLedgerCalendar
					invoked.GeneralLedgerCalendarTopNode = GeneralLedgerCalendarTopNode
					invoked.FiscalYear					    = FiscalYear
					invoked.FiscalMonth						= FiscalMonth
					invoked.FiscalQuarter                   = FiscalQuarter
					invoked.GLChartAccountTopNode			= GLChartAccountTopNode
					invoked.GeneralLedgerChartAccount		= GeneralLedgerChartAccount
					invoked.AccountingEntity				= AccountingEntity
					invoked.AccountingUnitStructure			= AccountingUnitStructure
					invoked.AccountingUnit					= AccountingUnit
					invoked.Currency						= Currency
					invoked.ProjectTopNode					= ProjectTopNode
					invoked.Project							= Project
					invoked.GeneralLedgerSystemCode			= GeneralLedgerSystemCode
					invoked.Ledger							= Ledger
					invoked.Scenario						= Scenario
					invoked.FinanceDimension1TopNode		= FinanceDimension1TopNode
					invoked.FinanceDimension1				= FinanceDimension1
					invoked.FinanceDimension2TopNode		= FinanceDimension2TopNode
					invoked.FinanceDimension2				= FinanceDimension2
					invoked.FinanceDimension3TopNode		= FinanceDimension3TopNode
					invoked.FinanceDimension3				= FinanceDimension3
					invoked.FinanceDimension4TopNode		= FinanceDimension4TopNode
					invoked.FinanceDimension4				= FinanceDimension4
					invoked.FinanceDimension5TopNode		= FinanceDimension5TopNode
					invoked.FinanceDimension5				= FinanceDimension5
					invoked.FinanceDimension6TopNode		= FinanceDimension6TopNode
					invoked.FinanceDimension6				= FinanceDimension6
					invoked.FinanceDimension7TopNode		= FinanceDimension7TopNode
					invoked.FinanceDimension7				= FinanceDimension7
					invoked.FinanceDimension8TopNode		= FinanceDimension8TopNode
					invoked.FinanceDimension8				= FinanceDimension8
					invoked.FinanceDimension9TopNode		= FinanceDimension9TopNode
					invoked.FinanceDimension9				= FinanceDimension9
					invoked.FinanceDimension10TopNode		= FinanceDimension10TopNode
					invoked.FinanceDimension10				= FinanceDimension10
	
	Relations
		GLReportRel is a GLReport set

		GLColumnRel
			one-to-many relation to GLColumn
			Field Mapping uses ByDisplayOrder
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.GLColumnView			= GLReport.ColumnView

		RunReportForActorAsyncActionRequestProcessingRel
			one-to-many relation to AsyncActionRequest
			Field Mapping uses ByClass
				related.ImplementingClass 	= "GLReportGroupingDetail"
				related.AsyncAction 		= "RunReport"
			Instance Selection
				where (related.MappingField1	= GLReportGrouping
				and    related.MappingField2	= GLReport
				and   (related.Actor			= actor)
				and   (related.NonFinishedNotInErrorTriggersExist))
		
		GLReportGroupingRel 
			one-to-many relation to GLReportGrouping
			Field Mapping uses symbolic key
			Instance Selection
				where (related.GLReportGrouping			= LocalGLReportGrouping)
		
		GLReportElementRel
			one-to-many relation to GLReportElement
			Field Mapping uses ByDisplayOrder
				related.FinanceEnterpriseGroup	= FinanceEnterpriseGroup
				related.GLReport				= GLReport

		GLColumnCompositeRel
            one-to-many relation to GLColumn
            Field Mapping uses ByDisplayOrder
                related.FinanceEnterpriseGroup  = FinanceEnterpriseGroup
                related.GLColumnView            = first GLReportElementRel.SubReport.ColumnView

