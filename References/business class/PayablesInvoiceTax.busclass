PayablesInvoiceTax is a BusinessClass
	owned by ap
	
	prefix is PIT
	
	Ontology
		symbolic key is PayablesInvoiceTax
			
	Patterns
		implements DynamicCreation
        implements StaticJava
        implements Archivable
	
	Persistent Fields
		TaxCode						is like TaxCode
        ProductTaxCategory
        EnteredTaxAmount			is a CurrencyAmount
		EnteredTaxableAmount		is a CurrencyAmount
		EnteredInvoiceAmount		is a CurrencyAmount
		EnteredTaxCategory			is a ProductTaxCategory
		TaxSystemTaxAmount			is a CurrencyAmount
		TaxSystemTaxableAmount		is a CurrencyAmount		
        TaxRate						is a ChrgRate
        TaxMethod
		TaxPointDate				is Date
		LinkedToDistributions		is Boolean
        VATReverseCharge			is Boolean
		ShortPaid					is Boolean
		PayablesTaxTolerance
		TaxToleranceOverridden		is Boolean
		TaxResult					is Text
		TaxDetails					is a TaxArrayOutput		
		TotalInvoicedTaxableAmount	is a CurrencyAmount		
		TotalInvoicedTaxAmount		is a CurrencyAmount		
		TotalAccruedTaxableAmount	is a CurrencyAmount		
		TotalAccruedTaxAmount		is a CurrencyAmount		
		PointOfTitleTransfer								

	Local Fields
		LocalPayablesInvoiceDistribution	is like PayablesInvoiceDistribution		
	Field Rules
	

	Derived Fields
		DerivedVariance is a DerivedField
			type is like InternalAmount
			return TaxDetails.TaxTableOutput.Variance

	Relations
		PayablesInvoiceTaxCopyRel
			one-to-one relation to PayablesInvoiceTax
			Field Mapping uses symbolic key
				related.Company							= Company
				related.PayablesInvoice					= PayablesInvoice
				related.PayablesInvoiceDistribution		= LocalPayablesInvoiceDistribution		
		
	Actions
		Create is a Create Action

		Update is an Update Action

		Delete is a Delete Action
		
		Purge is a Purge Action
			restricted
		

		UpdateTotalTaxValues is an Instance Action
			default label is untranslatable
			restricted		
			Parameters
				PrmTotalInvoicedTaxableAmount	is a CurrencyAmount
				PrmTotalInvoicedTaxAmount		is a CurrencyAmount
				PrmTotalAccruedTaxableAmount	is a CurrencyAmount
				PrmTotalAccruedTaxAmount		is a CurrencyAmount
			Action Rules





				TotalInvoicedTaxableAmount	+= PrmTotalInvoicedTaxableAmount
				TotalInvoicedTaxAmount		+= PrmTotalInvoicedTaxAmount
				TotalAccruedTaxableAmount	+= PrmTotalAccruedTaxableAmount
				TotalAccruedTaxAmount		+= PrmTotalAccruedTaxAmount









		CopyPayablesInvoiceTax is an Instance Action	
			default label is untranslatable
			restricted
			Parameters
				PrmLinkToDistribution	is like PayablesInvoiceDistribution
				PrmReverse 				is Boolean
			Parameter Rules
				PrmLinkToDistribution
					required
			Action Rules

				LocalPayablesInvoiceDistribution	= PrmLinkToDistribution			


				invoke Update PayablesInvoiceTaxCopyRel								

					fill in fields from this instance
						except invoked.PayablesInvoiceDistribution						

					if (PrmReverse)
						invoked.EnteredTaxAmount					= EnteredTaxAmount * -1
						invoked.EnteredTaxableAmount				= EnteredTaxableAmount * -1
						invoked.EnteredInvoiceAmount				= EnteredInvoiceAmount * -1
						invoked.TaxSystemTaxAmount					= TaxSystemTaxAmount * -1
						invoked.TaxSystemTaxableAmount				= TaxSystemTaxableAmount * -1
						invoked.TotalInvoicedTaxableAmount			= TotalInvoicedTaxableAmount * -1
						invoked.TotalInvoicedTaxAmount				= TotalInvoicedTaxAmount * -1
						invoked.TotalAccruedTaxableAmount			= TotalAccruedTaxableAmount * -1
						invoked.TotalAccruedTaxAmount				= TotalAccruedTaxAmount * -1
						invoked.EnteredTaxAmount					= EnteredTaxAmount * -1
						invoked.EnteredTaxAmount					= EnteredTaxAmount * -1
						invoked.TaxDetails.TaxableAmount			= TaxDetails.TaxableAmount * -1
						invoked.TaxDetails.ReturnedTaxAmount		= TaxDetails.ReturnedTaxAmount * -1
						invoked.TaxDetails.CalculatedTaxAmount		= TaxDetails.CalculatedTaxAmount * -1
						invoked.TaxDetails.RecoverableAmount		= TaxDetails.RecoverableAmount * -1
						invoked.TaxDetails.UnrecoverableAmount		= TaxDetails.UnrecoverableAmount * -1
						invoked.TaxDetails.TaxTableOutput.Variance	= TaxDetails.TaxTableOutput.Variance * -1 




