TaxDistributionLevel is a BusinessClass	 
    owned by tx
	prefix is TxDlv

    Ontology
        symbolic key is TaxDistributionLevel

    Patterns
        disable Auditing
        disable EffectiveDated
        disable UniqueID

	Persistent Fields

		TaxDistributionLevelValue	is AlphaUpper 50		
			restricted
			default label is "VertexTaxDistributionLevel"
		Description				is Alpha 50
		Country												
		UserOrTaxSystemSpecific is Numeric 1
			States
				UserDefined		value is 0
				VertexSpecific	value is 1
				Required		value is 2
		Reference				is Alpha 40		
 
		
	Relations		
 		ThisTaxDistributionLevelRecordRel
			one-to-one relation to TaxDistributionLevel
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= LocalFinanceEnterpriseGroup
				related.TaxDistributionLevel 	= LocalTaxDistributionLevel 

		TaxDistributionLevelRel
			one-to-many relation to TaxDistributionLevel
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 	= LocalFinanceEnterpriseGroup
								
	Context Fields
	Local Fields
		Idx is Numeric 2
		LocalJurisdictionValue is a TaxDistributionLevel
		LocalTaxDistributionLevel is a TaxDistributionLevel
		LocalFinanceEnterpriseGroup is like FinanceEnterpriseGroup
		
	Field Rules
		TaxDistributionLevelValue
			default to TaxDistributionLevel
			if (Reference = "Vertex"
			and UserOrTaxSystemSpecific.VertexSpecific)
				cannot be changed
			if (Reference = "Default"
			and UserOrTaxSystemSpecific.Required)
				cannot be changed				
		Description	
		Reference

			if (Reference changed
			and old Reference = "Vertex")
				cannot be changed
			if (Reference changed
			and old Reference = "Default")
				cannot be changed				




	Conditions

		ReferenceIsVertex 
			when (Reference = "Vertex")
			
	Derived Fields
		DerivedTaxDistributionLevel is a DerivedField	  
			type is MessageField
			if (Idx = 1)
				return Text1
			if (Idx = 2)	
				return Text2				
			if (Idx = 3)	// "APO" Air Force Post Office box, This value may also be used for Diplomatic Post Office (DPO) box. 
				return Text3	 				
			if (Idx = 4)	// "BOROUGH")	
				return Text4	 			
			if (Idx = 5)	// "CITY") 	
				return Text5				
			if (Idx = 6)	// "COUNTRY")	
				return Text6	 			
			if (Idx = 7)	// "COUNTY") 	
				return Text7				
			if (Idx = 8)	//"DISTRICT") 	
				return Text8			
			if (Idx = 9)	//"FPO")			
				return Text9				
			if (Idx = 10)	//"LOCAL_IMPROVEMENT_DISTRICT") 	
				return Text10	
			if (Idx = 11)	// "PARISH") 	
				return Text11				 
			if (Idx = 12)	//"PROVINCE") 	
				return Text12			 
			if (Idx = 13)	// "SPECIAL_PURPOSE_DISTRICT") 	
				return Text13	
			if (Idx = 14)	// "STATE") 	
				return Text14				
			if (Idx = 15)	// "TERRITORY") 	
				return Text15			
			if (Idx = 16)	// "TOWNSHIP") 		
				return Text16		
			if (Idx = 17)	//"TRADE_BLOCK") 		
				return Text17		
			if (Idx = 18)	// "TRANSIT_DISTRICT") 	
				return Text18	
			return TaxDistributionLevel			
					
		Text1 is a MessageField
			"Blank"
		Text2 is a MessageField
			"Default"			
		Text3 is a MessageField
			"AirForcePostOfficeBox"	//"APO"								
		Text4 is a MessageField
			"Borough"		
		Text5 is a MessageField
			"City" 			
		Text6 is a MessageField
			"Country" 			
		Text7 is a MessageField
			"County" 			
		Text8 is a MessageField
			"District" 		
		Text9 is a MessageField
			"FieldPostOffice" 		//"FPO"				
		Text10 is a MessageField
			"LocalImprovementDistrict" 
		Text11 is a MessageField
			"Parish" 			 
		Text12 is a MessageField
			"Province" 		 
		Text13 is a MessageField
			"SpecialPurposeDistrict" 
		Text14 is a MessageField
			"State" 			
		Text15 is a MessageField
			"Territory" 		
		Text16 is a MessageField
			"Township" 		
		Text17 is a MessageField
			"TradeBlock" 		
		Text18 is a MessageField
			"TransitDistrict" 
			
		VertexText is a MessageField
			"Vertex" 
		DefaultText is a MessageField
			"Default" 
			
		DerivedJurisdictionValue is a DerivedField
			type is AlphaUpper 50
			restricted
			if (Idx = 1)
				return "BLANK"
			else
			if (Idx = 2)
				return "DEFAULT"
			else
			if (Idx = 3)
				return "APO"
			else
			if (Idx = 4)
				return "BOROUGH"
			else
			if (Idx = 5)
				return "CITY"
			else
			if (Idx = 6)
				return "COUNTRY"
			else
			if (Idx = 7)
				return "COUNTY"
			else
			if (Idx = 8)
				return "DISTRICT" 
			else
			if (Idx = 9)
				return "FPO"
			else
			if (Idx = 10)
				return "LOCAL_IMPROVEMENT_DISTRICT"
			else
			if (Idx = 11)
				return "PARISH"
			else
			if (Idx = 12)
				return "PROVINCE" 
			else
			if (Idx = 13)
				return "SPECIAL_PURPOSE_DISTRICT"
			else
			if (Idx = 14)
				return "STATE" 
			else
			if (Idx = 15)
				return "TERRITORY"
			else
			if (Idx = 16)
				return "TOWNSHIP" 
			else
			if (Idx = 17)
				return "TRADE_BLOCK"
			else
			if (Idx = 18)
				return "TRANSIT_DISTRICT"			
			else
				return "UNKNOWN"

		DerivedJurisdictionLabel is a DerivedField	  
			type is Alpha 50
			if (Idx = 1)
				return "Blank"
			if (Idx = 2)
				return "Default"			
			if (Idx = 3)
				return "APO"			
			if (Idx = 4)
				return "Borough"		
			if (Idx = 5)
				return "City" 			
			if (Idx = 6)
				return "Country" 			
			if (Idx = 7)
				return "County" 			
			if (Idx = 8)
				return "District" 		
			if (Idx = 9)
				return "FieldPostOffice"					//FieldPostOffice" 		//"	
			if (Idx = 10)
				return "LocalImprovementDistrict" 			//"LocalImprovementDistrict"
			if (Idx = 11)
				return "Parish" 			 
			if (Idx = 12)
				return "Province" 		 
			if (Idx = 13)
				return "SpecialPurposeDistrict" 			//"SpecialPurposeDistrict"
			if (Idx = 14)
				return "State" 			
			if (Idx = 15)
				return "Territory" 		
			if (Idx = 16)
				return "Township" 		
			if (Idx = 17)
				return "TradeBlock" 		
			if (Idx = 18)
				return "TransitDistrict"
			else	
				return "Unknown"
				
	Actions
		Create is a Create Action
		Update is an Update Action
			Action Rules
				if (UserOrTaxSystemSpecific.UserDefined
				and Reference = "Vertex")
					UserOrTaxSystemSpecific = 1
		Delete is a Delete Action
		Purge is a Purge Action
				

		LoadVertexJurisdictionLevels is a Set Action	  


			completion message is "VertexDefaultValuesSuccessfullyCreated"			
			run in foreground	 

			Parameters
				ParmFinanceEnterpriseGroup is a FinanceEnterpriseGroup
					default label is "FinanceEnterpriseGroup"				
			Parameter Rules
				ParmFinanceEnterpriseGroup
					initial value is actor.context.FinanceEnterpriseGroup 
					default to actor.context.FinanceEnterpriseGroup 
					
			Local Fields
				RecordCount	is Numeric 2

			Sort Order

			Accumulators
				


				
			Action Rules
				Empty Set Rules
					Idx = 1
					while (Idx < 18)
						Idx = Idx + 1	
						LocalTaxDistributionLevel =  DerivedJurisdictionValue 
						LocalJurisdictionValue = DerivedJurisdictionValue
						LocalFinanceEnterpriseGroup = ParmFinanceEnterpriseGroup
						
						if (ThisTaxDistributionLevelRecordRel not exist)
							invoke Create TaxDistributionLevel 
								invoked.FinanceEnterpriseGroup 		= LocalFinanceEnterpriseGroup
								invoked.TaxDistributionLevel		= LocalTaxDistributionLevel 
								invoked.TaxDistributionLevelValue	= LocalJurisdictionValue
								invoked.Description					= DerivedTaxDistributionLevel 
								if (Idx = 2)
									invoked.Reference				= DefaultText
									invoked.UserOrTaxSystemSpecific	= 2
								else	
									invoked.Reference				= VertexText 
									invoked.UserOrTaxSystemSpecific	= 1
							RecordCount += 1			    
					
				Set Rules
					Entrance Rules		
					Exit Rules
						Idx = 1
						while (Idx < 18)
							Idx = Idx + 1	
							LocalTaxDistributionLevel =  DerivedJurisdictionValue  
							LocalJurisdictionValue = DerivedJurisdictionValue
							LocalFinanceEnterpriseGroup = ParmFinanceEnterpriseGroup
							
							if (ThisTaxDistributionLevelRecordRel not exist)
								invoke Create TaxDistributionLevel 
									invoked.FinanceEnterpriseGroup 		= LocalFinanceEnterpriseGroup
									invoked.TaxDistributionLevel		= LocalTaxDistributionLevel  
									invoked.TaxDistributionLevelValue	= LocalJurisdictionValue
									invoked.Description					= DerivedTaxDistributionLevel  
									if (Idx = 2)
										invoked.Reference				= DefaultText
										invoked.UserOrTaxSystemSpecific	= 2
									else	
										invoked.Reference				= VertexText 
										invoked.UserOrTaxSystemSpecific	= 1
								RecordCount += 1			    
												
				Instance Rules
					Idx = 1
					while (Idx < 18)
						Idx = Idx + 1	
						LocalTaxDistributionLevel =  DerivedJurisdictionValue  
						LocalJurisdictionValue = DerivedJurisdictionValue	
						LocalFinanceEnterpriseGroup = ParmFinanceEnterpriseGroup	
						if (ThisTaxDistributionLevelRecordRel not exist)
							invoke Create TaxDistributionLevel 
								invoked.FinanceEnterpriseGroup 		= LocalFinanceEnterpriseGroup
								invoked.TaxDistributionLevel		= LocalTaxDistributionLevel  
								invoked.TaxDistributionLevelValue	= LocalJurisdictionValue
								invoked.Description					= DerivedTaxDistributionLevel  								
								invoked.UserOrTaxSystemSpecific		= 1
								if (Idx = 2)
									invoked.Reference				= DefaultText
									invoked.UserOrTaxSystemSpecific	= 2
								else	
									invoked.Reference				= VertexText 
									invoked.UserOrTaxSystemSpecific	= 1
							



		PurgeDistributionLevels is a Set Action	  

			completion message is "DistributionLevelsSuccessfullyPurged"			
			run in foreground	 

			Parameters
				ParmFinanceEnterpriseGroup is a FinanceEnterpriseGroup
			Parameter Rules
				ParmFinanceEnterpriseGroup
					initial value is actor.context.FinanceEnterpriseGroup  
					default to actor.context.FinanceEnterpriseGroup 
			Local Fields
				
			Action Rules
				Empty Set Rules
					LocalFinanceEnterpriseGroup = ParmFinanceEnterpriseGroup	
					if (TaxDistributionLevelRel exist)
						for each TaxDistributionLevelRel
							invoke Purge TaxDistributionLevelRel	
				Set Rules					
					Entrance Rules		
					Exit Rules
						LocalFinanceEnterpriseGroup = ParmFinanceEnterpriseGroup	
						if (TaxDistributionLevelRel exist)
							for each TaxDistributionLevelRel
								invoke Purge TaxDistributionLevelRel
				Instance Rules
					LocalFinanceEnterpriseGroup = ParmFinanceEnterpriseGroup	
					if (TaxDistributionLevelRel exist)
						for each TaxDistributionLevelRel
							invoke Purge TaxDistributionLevelRel

								
													
























