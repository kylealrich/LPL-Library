BudgetGroupObligationVariance is a BusinessClass
    owned by GeneralLedger
    sql name is "BGOVariance"
    prefix is BGDAV

    Ontology
        symbolic key is BudgetGroupObligationVariance

    Patterns
    	implements DynamicCreation
 		disable Auditing 
 		disable EffectiveDated

    Persistent Fields
        AccountingEntity
            delete ignored
        AccountingUnit
            delete ignored	
        GeneralLedgerChartAccount
            delete ignored
        Project
            delete ignored
        FinanceDimension1
            delete ignored
        FinanceDimension2
            delete ignored
        FinanceDimension3
            delete ignored
        FinanceDimension4
            delete ignored
        FinanceDimension5
            delete ignored
        FinanceDimension6
            delete ignored
        FinanceDimension7
            delete ignored
        FinanceDimension8
            delete ignored
        FinanceDimension9
            delete ignored
        FinanceDimension10
            delete ignored  
        LocalObligationAmount           is a TotalAmount  
        CubeObligationAmount            is a TotalAmount  
        ReleasedJournalAmount           is a TotalAmount
        PendingApprovalJournalAmount    is a TotalAmount
        Currency
    Local Fields
        LocalAsyncId					is an AsyncActionRequest
        BudgetCodeBlock

    Transient Fields

    Derived Fields
        DerivedAmountVariance  is a DerivedField
            type is like TotalAmount
            default label is "Variance"
            return LocalObligationAmount - CubeObligationAmount

        DisplayMessage is a DerivedField
			type is Text
			BudgetCodeBlock.AccountingEntity					= AccountingEntity
			BudgetCodeBlock.AccountingUnit						= AccountingUnit
			BudgetCodeBlock.GeneralLedgerChartAccount			= GeneralLedgerChartAccount
			BudgetCodeBlock.Project								= Project
			BudgetCodeBlock.FinanceDimension1					= FinanceDimension1
			BudgetCodeBlock.FinanceDimension2					= FinanceDimension2
			BudgetCodeBlock.FinanceDimension3					= FinanceDimension3
			BudgetCodeBlock.FinanceDimension4					= FinanceDimension4
			BudgetCodeBlock.FinanceDimension5					= FinanceDimension5
			BudgetCodeBlock.FinanceDimension6					= FinanceDimension6
			BudgetCodeBlock.FinanceDimension7					= FinanceDimension7
			BudgetCodeBlock.FinanceDimension8					= FinanceDimension8
			BudgetCodeBlock.FinanceDimension9					= FinanceDimension9
			BudgetCodeBlock.FinanceDimension10					= FinanceDimension10
			return BudgetCodeBlock

 
        DerivedCurrency  is a DerivedField
            type is like Currency
            restricted
			if (BudgetGroupObligationVarianceRun.BudgetTemplate.UseCurrency.EntityFunctional)
				return AccountingEntity.FunctionalCurrency
			else
			if (BudgetGroupObligationVarianceRun.BudgetTemplate.UseCurrency.Project)
				return Project.Currency
			else
			if (BudgetGroupObligationVarianceRun.BudgetTemplate.UseCurrency.Report1)
				return FinanceEnterpriseGroup.ReportCurrencyOne
			else
			if (BudgetGroupObligationVarianceRun.BudgetTemplate.UseCurrency.Report2)
				return FinanceEnterpriseGroup.ReportCurrencyTwo
			else
			if (BudgetGroupObligationVarianceRun.BudgetTemplate.UseCurrency.Report3)
				return FinanceEnterpriseGroup.ReportCurrencyThree
			else
			if (BudgetGroupObligationVarianceRun.BudgetTemplate.UseCurrency.Report4)
				return FinanceEnterpriseGroup.ReportCurrencyFour
			else
			if (BudgetGroupObligationVarianceRun.BudgetTemplate.UseCurrency.Report5)
				return FinanceEnterpriseGroup.ReportCurrencyFive
    Conditions
        HasVarianceAmount
            restricted
            when (DerivedAmountVariance entered)
    Actions

        Create is a Create Action
    		restricted
            Action Rules
                Currency = DerivedCurrency

        Update is an Update Action
            restricted
            
		UpdateJournalAmount is an Instance Action
			restricted
            default label is untranslatable
            Parameters
                PrmReleasedJournalAmount        is a TotalAmount
                PrmPendingApprovalJournalAmount is a TotalAmount
            Action Rules
                ReleasedJournalAmount        += PrmReleasedJournalAmount
                PendingApprovalJournalAmount += PrmPendingApprovalJournalAmount

 		Purge is a Purge Action
			restricted
			bypass relational integrity rules

        Delete is a Delete Action
            restricted

        DeleteVarianceDetail is a Set Action
 			restricted
			default label is untranslatable 
 			Parameters
                PrmFinanceEnterpriseGroup           is a FinanceEnterpriseGroup
                PrmBudgetGroupObligationVarianceRun is a BudgetGroupObligationVarianceRun 
            Instance Selection
                where (FinanceEnterpriseGroup           = PrmFinanceEnterpriseGroup 
                and    BudgetGroupObligationVarianceRun = PrmBudgetGroupObligationVarianceRun)   
            Action Rules
                Empty Set Rules
                    invoke Delete PrmBudgetGroupObligationVarianceRun
                Set Rules
                    Exit Rules
                        invoke Delete PrmBudgetGroupObligationVarianceRun
                Instance Rules
                    invoke Delete BudgetGroupObligationVariance       

        DeleteZeroVarianceDetail is a Set Action
            restricted
            default label is untranslatable
			Parameters
                PrmFinanceEnterpriseGroup           is a FinanceEnterpriseGroup
                PrmBudgetGroupObligationVarianceRun is a BudgetGroupObligationVarianceRun 
            Instance Selection
                where (FinanceEnterpriseGroup                       = PrmFinanceEnterpriseGroup
                and    BudgetGroupObligationVarianceRun             = PrmBudgetGroupObligationVarianceRun)                
            Action Rules
                Instance Rules
                    if (LocalObligationAmount = CubeObligationAmount)
                        invoke Delete BudgetGroupObligationVariance             
