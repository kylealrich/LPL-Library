AssetTransactionBeginningBalance is a BusinessClass
    owned by am
    prefix is ATSI
	sql name is "AssetBeginningBalance"

    Ontology
        symbolic key is AssetTransactionBeginningBalance


    Patterns
        implements StaticJava
        disable AuditIndex

    Persistent Fields
		SummaryBalanceCodeBlock	is a FinanceCodeBlock
		DimensionCode
        TransactionBalance	   	is an CurrencyAmount
            precision is Book.Currency.NumberOfDecimals
		YearEndDate				is Date


	Transient Fields
		TransientFromCurrency is a FromCurrency
			derive value from Book.Currency

	Derived Fields


	Conditions
    	AccountingUnitIsValid
    		when (actor.context.FinanceEnterpriseGroup.AccountingUnitOrder entered)
        ProjectIsValid
    		when (actor.context.FinanceEnterpriseGroup.ProjectOrder entered)
		FinanceDimension1IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension1Order entered)
		FinanceDimension2IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension2Order entered)
		FinanceDimension3IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension3Order entered)
		FinanceDimension4IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension4Order entered)
		FinanceDimension5IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension5Order entered)
		FinanceDimension6IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension6Order entered)
		FinanceDimension7IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension7Order entered)
		FinanceDimension8IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension8Order entered)
		FinanceDimension9IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension9Order entered)
		FinanceDimension10IsValid
    		when (actor.context.FinanceEnterpriseGroup.FinanceDimension10Order entered)

	Field Rules
		SummaryBalanceCodeBlock
			required
			cannot be changed

		DimensionCode
			initial value is SummaryBalanceCodeBlock.DimensionCode
			default to SummaryBalanceCodeBlock.DimensionCode

		YearEndDate
			initial value is "19000101"
			default to "19000101"
			required
			cannot be changed


	Relations
		BookCalendarRel
			one-to-many relation to BookCalendar
			Field Mapping uses Set2
                related.Book		= Book
              	related.Company		= Company

		YearEndDateBookCalendarRel
			one-to-many relation to BookCalendar
			Field Mapping uses Set2
                related.Book		= Book
              	related.Company		= Company
         	Instance Selection
         		where (related.YearEndDate	= YearEndDate)

		ThisRecordRel
			one-to-one relation to AssetTransactionBeginningBalance
			Field Mapping uses ByTransactionDimensions
                related.Company											= Company
                related.Book											= Book
                related.SummaryBalanceCodeBlock.ToAccountingEntity 		= SummaryBalanceCodeBlock.ToAccountingEntity
                related.SummaryBalanceCodeBlock.AccountingUnit			= SummaryBalanceCodeBlock.AccountingUnit
                related.SummaryBalanceCodeBlock.GeneralLedgerChartAccount = SummaryBalanceCodeBlock.GeneralLedgerChartAccount
				related.SummaryBalanceCodeBlock.Ledger					= SummaryBalanceCodeBlock.Ledger
              	related.SummaryBalanceCodeBlock.Project					= SummaryBalanceCodeBlock.Project
                related.DimensionCode									= DimensionCode
                related.YearEndDate										= YearEndDate

		AssetTransactionSummaryRel
			one-to-many relation to AssetTransactionSummary
			Field Mapping uses Set0
                related.Company										= Company
                related.Book										= Book
                related.AssetTransactionSummary.AccountingEntity 	= SummaryBalanceCodeBlock.ToAccountingEntity
                related.AssetTransactionSummary.AccountingUnit		= SummaryBalanceCodeBlock.AccountingUnit
                related.AssetTransactionSummary.GeneralLedgerChartAccount = SummaryBalanceCodeBlock.GeneralLedgerChartAccount
				related.AssetTransactionSummary.Ledger				= SummaryBalanceCodeBlock.Ledger
              	related.AssetTransactionSummary.Project				= SummaryBalanceCodeBlock.Project
                related.AssetTransactionSummary.DimensionCode		= DimensionCode
            Instance Selection
            	where (related.IsBeginningBalance)

    Sets
		ByTransactionDimensions
			indexed
			Sort Order
				Company
				Book
				SummaryBalanceCodeBlock.ToAccountingEntity
              	SummaryBalanceCodeBlock.AccountingUnit
              	SummaryBalanceCodeBlock.GeneralLedgerChartAccount
				SummaryBalanceCodeBlock.Ledger
              	SummaryBalanceCodeBlock.Project
				DimensionCode
				YearEndDate


	Actions
		Create is a Create Action
			Action Rules
			Exit Rules
				if (AssetTransactionSummaryRel exists)
					invoke Update AssetTransactionSummaryRel
						invoked.TransactionBalance = TransactionBalance	
				else
					invoke CreateBeginningBalance AssetTransactionSummary
						invoked.Company										= Company
						invoked.Book										= Book
						invoked.AssetTransactionSummary.Ledger				= SummaryBalanceCodeBlock.Ledger
						invoked.AssetTransactionSummary.AccountingEntity	= SummaryBalanceCodeBlock.ToAccountingEntity
						invoked.AssetTransactionSummary.AccountingUnit		= SummaryBalanceCodeBlock.AccountingUnit
						invoked.AssetTransactionSummary.GeneralLedgerChartAccount	= SummaryBalanceCodeBlock.GeneralLedgerChartAccount
						invoked.AssetTransactionSummary.Project				= SummaryBalanceCodeBlock.Project
                		invoked.AssetTransactionSummary.DimensionCode		= DimensionCode
						invoked.FinanceDimension1							= SummaryBalanceCodeBlock.FinanceDimension1
						invoked.FinanceDimension2							= SummaryBalanceCodeBlock.FinanceDimension2
						invoked.FinanceDimension3							= SummaryBalanceCodeBlock.FinanceDimension3
						invoked.FinanceDimension4							= SummaryBalanceCodeBlock.FinanceDimension4
						invoked.FinanceDimension5							= SummaryBalanceCodeBlock.FinanceDimension5
						invoked.FinanceDimension6							= SummaryBalanceCodeBlock.FinanceDimension6
						invoked.FinanceDimension7							= SummaryBalanceCodeBlock.FinanceDimension7
						invoked.FinanceDimension8							= SummaryBalanceCodeBlock.FinanceDimension8
						invoked.FinanceDimension9							= SummaryBalanceCodeBlock.FinanceDimension9
						invoked.FinanceDimension10							= SummaryBalanceCodeBlock.FinanceDimension10

						invoked.TransactionBalance = TransactionBalance

		CreateBeginningBalance is a Create Action
			restricted

		Update is an Action
			Exit Rules
				if (AssetTransactionSummaryRel exists)
					invoke Update AssetTransactionSummaryRel
						invoked.TransactionBalance = TransactionBalance
				else
					invoke CreateBeginningBalance AssetTransactionSummary
						invoked.Company										= Company
						invoked.Book										= Book
						invoked.AssetTransactionSummary.Ledger				= SummaryBalanceCodeBlock.Ledger
						invoked.AssetTransactionSummary.AccountingEntity	= SummaryBalanceCodeBlock.ToAccountingEntity
						invoked.AssetTransactionSummary.AccountingUnit		= SummaryBalanceCodeBlock.AccountingUnit
						invoked.AssetTransactionSummary.GeneralLedgerChartAccount	= SummaryBalanceCodeBlock.GeneralLedgerChartAccount
						invoked.AssetTransactionSummary.Project				= SummaryBalanceCodeBlock.Project
                		invoked.AssetTransactionSummary.DimensionCode		= DimensionCode
						invoked.FinanceDimension1							= SummaryBalanceCodeBlock.FinanceDimension1
						invoked.FinanceDimension2							= SummaryBalanceCodeBlock.FinanceDimension2
						invoked.FinanceDimension3							= SummaryBalanceCodeBlock.FinanceDimension3
						invoked.FinanceDimension4							= SummaryBalanceCodeBlock.FinanceDimension4
						invoked.FinanceDimension5							= SummaryBalanceCodeBlock.FinanceDimension5
						invoked.FinanceDimension6							= SummaryBalanceCodeBlock.FinanceDimension6
						invoked.FinanceDimension7							= SummaryBalanceCodeBlock.FinanceDimension7
						invoked.FinanceDimension8							= SummaryBalanceCodeBlock.FinanceDimension8
						invoked.FinanceDimension9							= SummaryBalanceCodeBlock.FinanceDimension9
						invoked.FinanceDimension10							= SummaryBalanceCodeBlock.FinanceDimension10

						invoked.TransactionBalance = TransactionBalance


		UpdateFromTransactionSummary is an Update Action
			restricted

		AssetTransactionBeginningBalancePurge is a Set Action
			restricted
			Parameters
				PrmFinanceEnterpriseGroup   			is a FinanceEnterpriseGroup
				PrmCompany                 				is a Company
				PrmBook									is a Book
				PrmPurgeOption							is Numeric 1
					default label is "ActionOption"
					States
						PurgeRecords 	value is 1
						ReportOnly		value is 2
		        PrmAsset								is like Asset

			Instance Selection
				include deleted records
				where (FinanceEnterpriseGroup				= PrmFinanceEnterpriseGroup
				and    Company								= PrmCompany
				and	   Book									= PrmBook)

			Action Rules
				Set Rules
					Exit Rules
				Instance Rules
					if(PrmPurgeOption.PurgeRecords)
						if (PrmAsset not entered)
							invoke Purge

		Purge is a Purge Action
			default label is "Delete"
			bypass relational integrity rules
			Action Rules
				invoke Purge AssetTransactionSummaryRel

		Delete is a Delete Action
			restricted
			Exit Rules
				invoke Delete AssetTransactionSummaryRel
