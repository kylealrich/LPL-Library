ActorGroup is a BusinessClass
    owned by person
    prefix is ActGp
    stored in environment
    default label is "ActorGroup"

    Ontology
    	symbolic key is ActorGroup

	Patterns
        disable AsOfDateProcessing
        disable EffectiveDated
        disable Auditing

    Persistent Fields
    	Description	is Alpha 30

	Derived Fields
		CurrentActorInGroupOrDescendents is a DerivedField
	        type is Boolean
	
	      	if (CurrentActorMember exists)
	      		return true

	        for each ActorGroup children
	        	if (each.CurrentActorInGroupOrDescendents)
	            	return true
	
			return false

        GroupMemberExpandedRollupCount is a DerivedField
            type is Numeric 9
            return instance count of ActorGroupMemberShadow set

        GroupMemberImmediateCount is a DerivedField
            type is Numeric 9
            return instance count of GroupMemberRel

  	Conditions
		HasActorChildren
			default label is "ActorChildrenExist"
			when (GroupMemberRel exists)
			
		GroupOrDescendentHasActorChildren
			when (ActorGroupMemberShadow (ActorGroup) set exists)		  

	Sets


	Relations
		GroupMemberRel is a ActorGroupMember set
		
		CurrentActorMember
			one-to-one relation to ActorGroupMember
				Field Mapping uses part of key
					related.ActorGroup = ActorGroup
					related.Actor = actor
 
		ActorsNotInGroupRel
			one-to-many relation to Actor
			Field Mapping uses symbolic key
			Instance Selection
				where (related.ContextActorGroupMemberRel not exist)
			
	Actions
	
        Create is a Create Action
        
     	Update is an Update Action
     	
			Exit Rules
				if (old ParentActorGroup != ParentActorGroup)
					invoke ReparentGroupMembers ActorGroupMemberShadow 
						invoked.PrmOldParentActorGroup = old ParentActorGroup
						invoked.PrmReParentedActorGroup = ActorGroup
			     		
		Delete is a Delete Action
			Entrance Rules
				invoke Delete GroupMemberRel

		RebuildGroupMembers is an Instance Action
			run in background
			confirmation required
				"ThisActionRebuildsGroupMembershipInformationForAllActorGroupsAndShouldBeRunWhenThereAreNoUpdatesBeingMadeToActorGroups.ThisActionMayRunForALongTime.AreAreYouSureYouWantToProceedAtThisTime?" 

			Action Rules
				invoke RebuildGroupMembers ActorGroupMemberShadow 

	Field Rules
		ParentActorGroup
			constraint (ParentActorGroup != ActorGroup)
				"ActorGroupCannotParentItself"						
