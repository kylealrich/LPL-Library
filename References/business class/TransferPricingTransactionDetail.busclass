TransferPricingTransactionDetail is a BusinessClass
	owned by transpricing
	sql name is TransferPricingTxnDetail
	
	prefix is TFTXD
	
	Ontology
		symbolic key is TransferPricingTransactionDetail
	
	Persistent Fields
		TransactionAmount			is an InternationalAmount 
			precision is TransferPricingTransaction.Currency.NumberOfDecimals 
			default label is "TotalCalculatedAmount" 
	Transient Fields
		AccountingEntity
			derive value from TransferPricingTransaction.ToCompany.AccountingEntity
		
	Derived Fields
		DerivedSourcePercentage			is a DerivedField
			type is Percent size 6.3
			default label is "SourcePercentage"
			DerivedSourcePercentage 		= AllocationLineRel.SourcePercentage
			if (DerivedSourcePercentage < 0)
				DerivedSourcePercentage 	=  -1 * AllocationLineRel.SourcePercentage
			
		CountErrorMessage is a MessageField
			"ErrorCount:<instance count of AllocationLineSourceValueWithErrorRel>"
			
		DerivedErrorMessage is a DerivedField
			type is Alpha 150	
			if (ErrorExists)
				return CountErrorMessage
		
		DerivedTotalCalculateAmount is a DerivedField
			type is Alpha 30
			default label is "TotalCalculateAmount"
			return TransactionAmount + " " + TransferPricingTransaction.Currency
		
	Conditions
		ErrorExists
			restricted
			when (AllocationLineSourceValueWithErrorRel exist)		
					
	Relations
		AllocationLineSourceValueRel 
			one-to-many relation to AllocationLineSourceValue
			Field Mapping uses ByAllocationLine
				related.FinanceEnterpriseGroup		= FinanceEnterpriseGroup 
				related.AllocationSourceSystem		= TransferPricingTransaction.AllocationSourceSystem
				related.AllocationControl			= TransferPricingTransaction.AllocationControl
				related.AllocationLine				= TransferPricingSource
				related.AllocationRun				= TransferPricingRun.AllocationRun
			Instance Selection
				where (TransferPricingSource.SourceEntity.BillFromEntity 
				or     related.Allocation = TransferPricingTransaction.ToEntity
				or    (TransferPricingRun.AllEntities and related.FinanceAddress.AccountingEntity = TransferPricingTransaction.ToEntity)) 
				
		AllocationTransactionDetailRel
			one-to-many relation to AllocationTransactionDetail
			Field Mapping uses ByAllocationLine
				related.FinanceEnterpriseGroup		= FinanceEnterpriseGroup 
				related.AllocationSourceSystem		= TransferPricingTransaction.AllocationSourceSystem
				related.AllocationControl			= TransferPricingTransaction.AllocationControl
				related.AllocationLine				= TransferPricingSource
				related.AllocationRun				= TransferPricingRun.AllocationRun	
			Instance Selection
				where (related.FinanceCodeBlock.ToAccountingEntity = TransferPricingTransaction.ToEntity)
		
		AllocationLineRel
			one-to-many relation to AllocationLine
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		= FinanceEnterpriseGroup 
				related.AllocationSourceSystem		= TransferPricingTransaction.AllocationSourceSystem
				related.AllocationControl			= TransferPricingTransaction.AllocationControl
			Instance Selection
				where (related.AllocationLine 		= TransferPricingSource
				and   (related.Allocation 			= TransferPricingTransaction.ToEntity 
				or 	   TransferPricingSource.SourceEntity.BillFromEntity
				or     TransferPricingRun.AllEntities))

		AllocationLineTempOverridesRel
			one-to-many relation to AllocationLineTempOverride
			Field Mapping uses ByWOAllocation
				related.FinanceEnterpriseGroup		= FinanceEnterpriseGroup 
				related.AllocationSourceSystem		= TransferPricingTransaction.AllocationSourceSystem
				related.AllocationControl			= TransferPricingTransaction.AllocationControl
				related.AllocationRun				= TransferPricingRun.AllocationRun
				related.AllocationLine				= TransferPricingSource

				
		AllocationLineSourceValueWithErrorRel
			one-to-many relation to AllocationLineSourceValue
			Field Mapping uses ByAllocationLine
				related.FinanceEnterpriseGroup		= FinanceEnterpriseGroup 
				related.AllocationSourceSystem		= TransferPricingTransaction.AllocationSourceSystem
				related.AllocationControl			= TransferPricingTransaction.AllocationControl
				related.AllocationLine				= TransferPricingSource
				related.AllocationRun				= TransferPricingRun.AllocationRun
			Instance Selection
				where ((TransferPricingSource.SourceEntity.BillFromEntity 
				or      related.Allocation = TransferPricingTransaction.ToEntity
				or     (TransferPricingRun.AllEntities and related.FinanceAddress.AccountingEntity = TransferPricingTransaction.ToEntity))
				and related.ErrorMessage entered)
				
		AllocationLineWeightRel
    		one-to-many relation to AllocationLineWeight
    		Field Mapping uses symbolic key
    			related.FinanceEnterpriseGroup		= FinanceEnterpriseGroup
    			related.AllocationSourceSystem		= TransferPricingTransaction.AllocationSourceSystem
    			related.AllocationControl			= TransferPricingTransaction.AllocationControl
    		Instance Selection
				where (related.AllocationLine 		= TransferPricingSource
				and   (related.Allocation 			= TransferPricingTransaction.ToEntity 
				or 	   TransferPricingSource.SourceEntity.BillFromEntity
				or     TransferPricingRun.AllEntities))
		
	Actions
		Create is a Create Action
			restricted
		
		Update is an Update Action
			restricted
			
		Delete is a Delete Action
			restricted
