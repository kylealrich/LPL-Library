RequesterPunchoutVendor is a BusinessClass
	owned by edi
	
	prefix is RPVe
	
	Ontology
		symbolic key is RequesterPunchoutVendor
		
	
	Patterns
        disable AuditIndex
	
	Persistent Fields

	Context Fields
		Company
		Requisition
		PunchoutData

	Derived Fields			
		DateTimestamp1 is a NativeField 
			type is Alpha 20
			restricted
			
		DateTimestamp2 is a NativeField 
			type is Alpha 20
			restricted
		
       	PayloadID is a StringField
			type is Alpha size 100
			restricted
			DateTimestamp2
			"."
			UUID
			"@"
			BuyingOrganizationRel.EmailDomainName
			
		DerivedCompany is a DerivedField
			type is like InventoryCompany
			restricted
			if (RequisitionRel exists)
				return RequisitionRel.Company
			else
				return RequesterRel.Company

		DerivedReqLocation is a DerivedField
			type is like RequestingLocation
			restricted
			if (RequisitionRel exists)
				return RequisitionRel.RequestingLocation
			else
				return RequesterRel.RequestingLocation

		DerivedPunchoutURL is a DerivedField
			type is Alpha size 2000
			restricted
			if (PunchoutVendorRel.EnhancedPunchoutSetupRequest = false)
				invoke GetPunchoutURL RequesterPunchoutVendor
				if LocalPunchoutSetupRequestResponseStatusCode = 200

					return LocalPunchoutURL
				else


					constraint (LocalPunchoutSetupRequestResponseStatusCode = 200)
						"HTTP_\Status_\Code:<LocalPunchoutSetupRequestResponseStatusCode>,_\Error_\Description:<LocalPunchoutSetupRequestResponseStatusText>"
					return ""
			else
				return ""

        DerivedPunchoutVendorLogo is a DerivedField
            type is BinaryDocument
            return PunchoutVendorRel.DerivedPunchoutVendorLogo
		
	Local Fields
		LocalPunchoutURL is Text
		LocalPunchoutDataRecordKey is Alpha 100
		LocalPunchoutSetupRequestResponseStatusCode is Alpha 10
		LocalPunchoutSetupRequestResponseStatusText is Alpha 255
		LocalNewRequisition is like Requisition
		LocalNewRequisitionLine is like RequisitionLine
		MyResponse is a CXML
		Quantity is Alpha 20
        SupplierPartID is Alpha 100
        SupplierPartAuxiliaryID is Alpha 100
        MyRequest is a CXML
        RequisitionCompany             	is an InventoryCompany
        RequestingLocation
		WebServiceURL is Alpha 1000
		PunchoutVendorItemUnitCost is an UnsignedUnitCost
		Execute							is Boolean
		TransactionCostDefault
		ProcurementCostDefault
		LocalDefaultUnitCost			is a UnitCost
		LocalDefaultedContract			is like Contract
        LocalDefaultedContractLine		is like ContractLine                     
		RSSLPLLocalPunchoutURL is Text
		RSSLPLLocalPunchoutDataRecordKey is Alpha 100
		RSSLPLLocalHROrganization is an HROrganization
		RSSLPLLocalRequester is like Requester
		RSSLPLLocalVendorGroup is like VendorGroup
		RSSLPLLocalVendor is like Vendor
		RSSLPLLocalPunchoutVendor is a PunchoutVendor
		RSSLPLLocalEnhancedPunchoutSetupRequest is Boolean
		RSSLPLLocalRequisition is like Requisition
        
 	Transient Fields
		PunchoutURL			is Text
			derive value from LocalPunchoutURL
		PunchoutSetupRequestResponseStatusCode is Alpha 10
			derive value from LocalPunchoutSetupRequestResponseStatusCode
		PunchoutSetupRequestResponseStatusText is Alpha 255
			derive value from LocalPunchoutSetupRequestResponseStatusText
		NewRequisition		is like Requisition
			derive value from LocalNewRequisition
		NewRequisitionLine	is like RequisitionLine
			derive value from LocalNewRequisitionLine
		PunchoutDataRecordKey is Alpha 100
			derive value from LocalPunchoutDataRecordKey
		UUID is Alpha 40
		PunchoutVendorMappingSource is like MappingSource
		PunchoutVendorFromField is a FieldName
		PunchInVendorItem	is Boolean
		SetupRequestExtrinsicCount is Numeric size 5
		ContactName	is Alpha 100
		ContactEmail is Alpha 100
		ContactEmailDomainName is Alpha 50

		POMapRequisitionLineItem is a Item
			default label is untranslatable
		POMapRequisitionLineDistributionCode is a PayablesDistributionCode
			default label is untranslatable
		POMapRequisitionLineAllocationPriority is like AllocationPriority
			default label is untranslatable
		POMapRequisitionLineCommodityCode is a CommCodes
			default label is untranslatable
		POMapRequisitionLineDeliverTo is like DeliverTo
			default label is untranslatable
		POMapRequisitionLineFillOrKill is like FillOrKill
			default label is untranslatable
		POMapRequisitionLineFromCompany is like InventoryCompany
			default label is untranslatable
		POMapRequisitionLineFromLocation is like InventoryLocation
			default label is untranslatable
		POMapRequisitionLineGTIN is like ItemGTIN
			default label is untranslatable
		POMapRequisitionLineLateDeliveryDate is Date
			default label is untranslatable
		POMapRequisitionLineManufacturerCode is a ManufacturerCode
			default label is untranslatable
		POMapRequisitionLineManufacturerDivision is a ManufacturerDivision
			default label is untranslatable
		POMapRequisitionLinePOCode is like POCode
			default label is untranslatable
		POMapRequisitionLinePurchaseFromLocation is a VendorLocation
			default label is untranslatable
		POMapRequisitionLineMajorPurchasingClass is like MajorPurchasingClass
			default label is untranslatable
		POMapRequisitionLineMinorPurchasingClass is like MinorPurchasingClass
			default label is untranslatable
		POMapRequisitionLinePurchaseTaxCode is like TaxCode
			default label is untranslatable
		POMapRequisitionLinePurchaseTaxable is Boolean
			default label is untranslatable
		POMapRequisitionLineRequestedDeliveryDate is Date
			default label is untranslatable
		POMapRequisitionLineSourcingEventRequired is Boolean
			default label is untranslatable
		POMapRequisitionLineVendor is like Vendor
			default label is untranslatable
		POMapRequisitionLineDistributionAccount is like GeneralLedgerChartAccount
			default label is untranslatable
		POMapRequisitionLineDistributionSubAccount is like GeneralLedgerChartAccount
			default label is untranslatable
		POMapRequisitionLineDistributionAccountCategory is AlphaUpper size 5
			default label is untranslatable
		POMapRequisitionLineDistributionAccountUnit is like AccountingUnit
			default label is untranslatable
		POMapRequisitionLineDistributionActivity is like Project
			default label is untranslatable
		POMapRequisitionLineDistributionAsset is like Asset
			default label is untranslatable
		POMapRequisitionLineDistributionAssetTemplate is like AssetTemplate
			default label is untranslatable
		POMapRequisitionLineDistributionAmount is like InternationalAmount 
			default label is untranslatable
		POMapRequisitionLineDistributionPercent is Percent size 6.3
			default label is untranslatable
		POMapRequisitionLineDistributionQuantity is like Quantity
			default label is untranslatable
		POMapRequisitionLinePurchaseOrderUserField2 is like PurchaseOrderUserField2
			default label is untranslatable
		POMapRequisitionLinePurchaseOrderUserField4         is a UserFld2
			default label is untranslatable
		POMapRequisitionLinePurchaseOrderUserField6         is a UserFld3
			default label is untranslatable
		POMapRequisitionLineUserDate3                       is Date
			default label is untranslatable
		POMapRequisitionLineUserDate4                       is Date
			default label is untranslatable
		RSSLPLTransientPunchoutURL is Text
			derive value from RSSLPLLocalPunchoutURL
			default label is untranslatable
		RSSLPLTransientPunchoutDataRecordKey is Alpha 100
			derive value from RSSLPLLocalPunchoutDataRecordKey
			default label is untranslatable
		RSSLPLTransientHROrganization is an HROrganization
			derive value from RSSLPLLocalHROrganization
			default label is untranslatable
		RSSLPLTransientRequester is like Requester
			derive value from RSSLPLLocalRequester
			default label is untranslatable
		RSSLPLTransientVendorGroup is like VendorGroup
			derive value from RSSLPLLocalVendorGroup
			default label is untranslatable
		RSSLPLTransientVendor is like Vendor
			derive value from RSSLPLLocalVendor
			default label is untranslatable
		RSSLPLTransientPunchoutVendor is a PunchoutVendor
			derive value from RSSLPLLocalPunchoutVendor
			default label is untranslatable
		RSSLPLTransientEnhancedPunchoutSetupRequest is Boolean
			derive value from RSSLPLLocalEnhancedPunchoutSetupRequest
			default label is untranslatable
		RSSLPLTransientRequisition is like Requisition
			derive value from RSSLPLLocalRequisition
			default label is untranslatable
			
	Rule Blocks
		GetContractCost
			initialize ProcurementCostDefault
			initialize LocalDefaultedContract
			initialize LocalDefaultedContractLine
			
			ProcurementCostDefault.InProcurementGroup 			= PurchasingCompanyRel.ProcurementGroup
			if (POMapRequisitionLineItem entered)
				ProcurementCostDefault.InItem					= POMapRequisitionLineItem
			else
				ProcurementCostDefault.InItem 					= SupplierPartID
			ProcurementCostDefault.InItemType 					= ItemType.Special
			ProcurementCostDefault.InDate 						= current corporate date
		    ProcurementCostDefault.InSystem						= "RQ"
		    ProcurementCostDefault.InDoContractOnly				= true
		    
			TransactionCostDefault.LocalCreatePurchaseOrder		= true
			ProcurementCostDefault.InVendor						= PunchoutVendorRel.Vendor
			ProcurementCostDefault.InPurchaseFromLocation		= PunchoutVendorRel.PurchaseFromLocation
		    
			ProcurementCostDefault.InRequestingCompany 		= PrmCompany
			ProcurementCostDefault.InRequestingLocation		= PrmRequestingLocation
			ProcurementCostDefault.InStockless 				= PrmRequestingLocation.Stockless
			
			ProcurementCostDefault.InCompany 				= PrmFromCompany
			ProcurementCostDefault.InLocation 				= PrmFromLocation
			
			Execute	= ProcurementCostDefault.DefaultUnitCost

			if (ProcurementCostDefault.InStockless
			and ProcurementCostDefault.OutputContract not entered)
				ProcurementCostDefault.InStockless	= false
				Execute	= ProcurementCostDefault.DefaultUnitCost

			if (ProcurementCostDefault.OutputContract entered)
				LocalDefaultedContract 		= ProcurementCostDefault.OutputContract
				LocalDefaultedContractLine 	= ProcurementCostDefault.OutputContractLine
		
		ClearPOMapPunchoutVendorFields
			initialize POMapRequisitionLineItem
			initialize POMapRequisitionLineDistributionCode
			initialize POMapRequisitionLineAllocationPriority
			initialize POMapRequisitionLineCommodityCode
			initialize POMapRequisitionLineDeliverTo
			initialize POMapRequisitionLineGTIN
			initialize POMapRequisitionLineFillOrKill
			initialize POMapRequisitionLineFromCompany
			initialize POMapRequisitionLineFromLocation
			initialize POMapRequisitionLineLateDeliveryDate
			initialize POMapRequisitionLineManufacturerCode
			initialize POMapRequisitionLineManufacturerDivision
			initialize POMapRequisitionLinePOCode
			initialize POMapRequisitionLinePurchaseFromLocation
			initialize POMapRequisitionLineMajorPurchasingClass
			initialize POMapRequisitionLineMinorPurchasingClass
			initialize POMapRequisitionLinePurchaseTaxCode
			initialize POMapRequisitionLinePurchaseTaxable
			initialize POMapRequisitionLineRequestedDeliveryDate
			initialize POMapRequisitionLineSourcingEventRequired
			initialize POMapRequisitionLineVendor
			initialize POMapRequisitionLineDistributionAccount
			initialize POMapRequisitionLineDistributionSubAccount
			initialize POMapRequisitionLineDistributionAccountCategory
			initialize POMapRequisitionLineDistributionAccountUnit
			initialize POMapRequisitionLineDistributionActivity
			initialize POMapRequisitionLineDistributionAsset
			initialize POMapRequisitionLineDistributionAssetTemplate
			initialize POMapRequisitionLineDistributionAmount
			initialize POMapRequisitionLineDistributionPercent
			initialize POMapRequisitionLineDistributionQuantity
			initialize POMapRequisitionLinePurchaseOrderUserField2
			initialize POMapRequisitionLinePurchaseOrderUserField4
			initialize POMapRequisitionLinePurchaseOrderUserField6
			initialize POMapRequisitionLineUserDate3
			initialize POMapRequisitionLineUserDate4

    Sets
        ByVendor
            indexed
            Sort Order
            	VendorGroup
                Vendor
                PunchoutVendor
            	HROrganization
				Requester

	Conditions
		IsValidForActorContext
			restricted
			when ((actor.context.FinanceEnterpriseGroup != ""
			and	  VendorGroup.BusinessGroup.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
			or   (actor.context.FinanceEnterpriseGroup = ""))
	
		MyRequester
			restricted
			when (Requester = actor.agent(Employee).Employee and IsValidForActorContext)

		DisplayRequisitionDescription
			restricted
			when (RequesterRel.DisplayRequisitionDescription)
			
		DisplayRequestedDeliveryDate
			restricted
			when (RequesterRel.DisplayRequestedDeliveryDate)
		
		DisplayPurchaseFrom
			restricted
			when (RequesterRel.DisplayPurchaseFrom)
	
		RSSLPLAllocationPriorityLevelEnabled
			restricted
            when (RSSLPLConfigurationParameterRel exists)
		
		RSSLPLShowRequiredFields
			restricted
			when (RequesterRel.RequireBuyer
			or RequesterRel.RequirePOCode
			or RequesterRel.RequireCommodityCodeDisplay
			or RequesterRel.RequireDeliverTo
			or RequesterRel.RequireVendor)
		
		RSSLPLDisplayAllocationPriorityLevel
			restricted
			when (RSSLPLAllocationPriorityLevelEnabled
			and RequesterRel.RSSLPLDisplayPriority)
		
		RSSLPLDisplayPriority
			restricted
			when (not RSSLPLAllocationPriorityLevelEnabled
			and RequesterRel.RSSLPLDisplayPriority)
		
		RSSLPLDisplayFromCompany
			restricted
			when (RequesterRel.RSSLPLDisplayFromCompany)
		
		RSSLPLDisplayFromLocation
			restricted
			when (RequesterRel.RSSLPLDisplayFromLocation)
		
		RSSLPLDisplayCompany
			restricted
			when (RequesterRel.RSSLPLDisplayCompany)
		
		RSSLPLDisplayRequestingLocation
			restricted
			when (RequesterRel.RSSLPLDisplayRequestingLocation)
			
	Relations
        PunchoutVendorRel is a PunchoutVendor set
        
		RequesterPunchoutVendorDataRel is a RequesterPunchoutVendorData set
		
		PunchoutVendorDataRel is a PunchoutVendorData set
		
		PunchoutVendorFieldMappingRel is a PunchoutVendorFieldMapping set
			Instance Selection
				where (related.FromField = PunchoutVendorFromField 
				and related.MappingSource = PunchoutVendorMappingSource)
		
		BuyingOrganizationRel
			one-to-one relation to BuyingOrganization
			Field Mapping uses symbolic key
				related.BuyingOrganization	= VendorGroup
        
        RequisitionLinesForOtherVendorsRel
            one-to-many relation to RequisitionLine
            Field Mapping uses symbolic key
                related.Company		= Company
                related.Requisition	= Requisition
        	Instance Selection
        		where (related.Vendor != Vendor)
        		
        RequesterRel
            one-to-one relation to Requester
            Field Mapping uses symbolic key
            	related.HROrganization = actor.agent(Employee).HROrganization
            	related.Requester = actor.agent(Employee).Employee.Requester.Requester
            	
		PunchoutDataRel
			one-to-one relation to PunchoutData
			Field Mapping uses symbolic key
				related.PunchoutData = LocalPunchoutDataRecordKey
				
		PurchasingCompanyRel
            classic name is PO-COMPANY
            one-to-one relation to PurchasingCompany
            Field Mapping uses symbolic key
                related.Company = DerivedCompany
                
        RequisitionRel
			one-to-one relation to Requisition
			Field Mapping uses symbolic key
				related.Company				= RequesterRel.CurrentCompanyForRQC
				related.Requisition			= RequesterRel.CurrentRequisitionForRQC
				
		ContractLineRel
			one-to-one relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup    	= VendorGroup
				related.Contract			= LocalDefaultedContract
				related.ContractLine		= LocalDefaultedContractLine
			
		RSSLPLConfigurationParameterRel
            one-to-many relation to ConfigurationParameter
            Field Mapping uses symbolic key
                related.ConfigurationParameter.ConfigurationID  = "config"
                related.ConfigurationParameter.Name             = "RSS_LPLAllocationPriorityLevel"
			Instance Selection
				where (related.ConfigurationParameter.Value = "true")
		
		RSSLPLAllocationPriorityLevelRel
			one-to-many relation to AllocationPriorityLevel
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= actor.context.FinanceEnterpriseGroup
			Instance Selection
				where (related.UseAsDefault)

	Field Rules
			
	Actions
        Create is a Create Action
        Update is an Update Action
        Delete is a Delete Action
		
		GetReturnWebServiceURLAndRecordKey is an Instance Action
			restricted
			
		GetUUID is an Instance Action
			restricted
			
		GetPunchoutURL is an Instance Action
			restricted
			
			Action Rules

				invoke GetUUID RequesterPunchoutVendor
				invoke GetReturnWebServiceURLAndRecordKey RequesterPunchoutVendor
				
				invoke Create CXML
                    invoked.CXMLDocType = "SYSTEM_http://xml.cXML.org/schemas/cXML/1.2.019/cXML.dtd" 
					invoked.CXML	= "1"
					invoked.CXML0	= PayloadID
					invoked.CXML1	= DateTimestamp1
					
				invoke Create CXMLHeader
					invoked.CXML		= "1"
					invoked.CXMLHeader	= "1"
					
				invoke Create CXMLHeaderFrom
					invoked.CXML			= "1"
					invoked.CXMLHeader		= "1"
					invoked.CXMLHeaderFrom	= "1"
					

				if (PunchoutVendorRel.FromDunsNumber entered)
					invoke Create CXMLHeaderFromCredential
						invoked.CXML						= "1"
						invoked.CXMLHeader					= "1"
						invoked.CXMLHeaderFrom				= "1"
						invoked.CXMLHeaderFromCredential	= "1"
						invoked.CXMLHeaderFromCredential0	= "DUNS"
						invoked.Identity					= PunchoutVendorRel.FromDunsNumber
				else
					if (PunchoutVendorRel.FromNetworkID entered)
						invoke Create CXMLHeaderFromCredential
							invoked.CXML						= "1"
							invoked.CXMLHeader					= "1"
							invoked.CXMLHeaderFrom				= "1"
							invoked.CXMLHeaderFromCredential	= "1"
							invoked.CXMLHeaderFromCredential0	= "NetworkId"
							invoked.Identity					= PunchoutVendorRel.FromNetworkID
				
				invoke Create CXMLHeaderTo
					invoked.CXML			= "1"
					invoked.CXMLHeader		= "1"
					invoked.CXMLHeaderTo	= "1"
				

				if (PunchoutVendorRel.ToDunsNumber entered)
					invoke Create CXMLHeaderToCredential
						invoked.CXML					= "1"
						invoked.CXMLHeader				= "1"
						invoked.CXMLHeaderTo			= "1"
						invoked.CXMLHeaderToCredential	= "1"
						invoked.CXMLHeaderToCredential0	= "DUNS"
						invoked.Identity				= PunchoutVendorRel.ToDunsNumber
				else
					if (PunchoutVendorRel.ToNetworkID entered)
						invoke Create CXMLHeaderToCredential 
							invoked.CXML					= "1"
							invoked.CXMLHeader				= "1"
							invoked.CXMLHeaderTo			= "1"
							invoked.CXMLHeaderToCredential	= "1"
							invoked.CXMLHeaderToCredential0	= "NetworkId"
							invoked.Identity				= PunchoutVendorRel.ToNetworkID
				
				invoke Create CXMLHeaderSender
					invoked.CXML				= "1"
					invoked.CXMLHeader			= "1"
					invoked.CXMLHeaderSender	= "1"
				

				if (PunchoutVendorRel.SenderDunsNumber entered)
					invoke Create CXMLHeaderSenderCredential
						invoked.CXML						= "1"
						invoked.CXMLHeader					= "1"
						invoked.CXMLHeaderSender			= "1"
						invoked.CXMLHeaderSenderCredential	= "1"
						invoked.CXMLHeaderSenderCredential0	= "DUNS"
						invoked.Identity					= PunchoutVendorRel.SenderDunsNumber
						invoked.SharedSecret				= PunchoutVendorRel.SharedSecret
				else
					if (PunchoutVendorRel.SenderNetworkID entered)
						invoke Create CXMLHeaderSenderCredential
							invoked.CXML						= "1"
							invoked.CXMLHeader					= "1"
							invoked.CXMLHeaderSender			= "1"
							invoked.CXMLHeaderSenderCredential	= "1"
							invoked.CXMLHeaderSenderCredential0	= "NetworkId"
							invoked.Identity					= PunchoutVendorRel.SenderNetworkID
							invoked.SharedSecret				= PunchoutVendorRel.SharedSecret
					else
						invoke Create CXMLHeaderSenderCredential
							invoked.CXML						= "1"
							invoked.CXMLHeader					= "1"
							invoked.CXMLHeaderSender			= "1"
							invoked.CXMLHeaderSenderCredential	= "1"
							invoked.SharedSecret				= PunchoutVendorRel.SharedSecret
					
				invoke Create CXMLHeaderSenderUserAgent
					invoked.CXML						= "1"
					invoked.CXMLHeader					= "1"
					invoked.CXMLHeaderSender			= "1"
					invoked.CXMLHeaderSenderUserAgent	= "1"
					invoked.UserAgent					= BuyingOrganizationRel.OrganizationName
				
				invoke Create CXMLRequest
					invoked.CXML			= "1"
					invoked.CXMLRequest		= "1"
					invoked.CXMLRequest0	= PunchoutVendorRel.DeploymentMode
				
				invoke Create CXMLRequestPunchOutSetupRequest
					invoked.CXML								= "1"
					invoked.CXMLRequest							= "1"
					invoked.CXMLRequestPunchOutSetupRequest		= "1"
					invoked.CXMLRequestPunchOutSetupRequest0	= "create"
					invoked.BuyerCookie							= LocalPunchoutDataRecordKey
				


				SetupRequestExtrinsicCount = 1
				for each RequesterPunchoutVendorDataRel
					invoke Create CXMLRequestPunchOutSetupRequestExtrinsic
						invoked.CXML					 					= "1"
						invoked.CXMLRequest									= "1"
						invoked.CXMLRequestPunchOutSetupRequest 			= "1"
						invoked.CXMLRequestPunchOutSetupRequestExtrinsic	= SetupRequestExtrinsicCount
						invoked.Extrinsic = each.FieldValue
						invoked.Extrinsic0 = each.FieldName
					SetupRequestExtrinsicCount = SetupRequestExtrinsicCount + 1
					
				for each PunchoutVendorDataRel
					invoke Create CXMLRequestPunchOutSetupRequestExtrinsic
						invoked.CXML										= "1"
						invoked.CXMLRequest									= "1"
						invoked.CXMLRequestPunchOutSetupRequest 			= "1"
						invoked.CXMLRequestPunchOutSetupRequestExtrinsic	= SetupRequestExtrinsicCount
						invoked.Extrinsic = each.FieldValue
						invoked.Extrinsic0 = each.FieldName
					SetupRequestExtrinsicCount = SetupRequestExtrinsicCount + 1
				
				if (PunchoutVendorRel.EnhancedPunchoutSetupRequest)
					invoke Create CXMLRequestPunchOutSetupRequestExtrinsic
						invoked.CXML										= "1"
						invoked.CXMLRequest									= "1"
						invoked.CXMLRequestPunchOutSetupRequest 			= "1"
						invoked.CXMLRequestPunchOutSetupRequestExtrinsic	= SetupRequestExtrinsicCount
						invoked.Extrinsic									= RequesterRel.EmployeeRel.Name.GivenName
						invoked.Extrinsic0									= "FirstName"
					SetupRequestExtrinsicCount = SetupRequestExtrinsicCount + 1

					invoke Create CXMLRequestPunchOutSetupRequestExtrinsic
						invoked.CXML										= "1"
						invoked.CXMLRequest									= "1"
						invoked.CXMLRequestPunchOutSetupRequest 			= "1"
						invoked.CXMLRequestPunchOutSetupRequestExtrinsic	= SetupRequestExtrinsicCount
						invoked.Extrinsic									= RequesterRel.EmployeeRel.Name.FamilyName
						invoked.Extrinsic0									= "LastName"
					SetupRequestExtrinsicCount = SetupRequestExtrinsicCount + 1				

					invoke Create CXMLRequestPunchOutSetupRequestExtrinsic
						invoked.CXML										= "1"
						invoked.CXMLRequest									= "1"
						invoked.CXMLRequestPunchOutSetupRequest 			= "1"
						invoked.CXMLRequestPunchOutSetupRequestExtrinsic	= SetupRequestExtrinsicCount
						invoked.Extrinsic									= RequesterRel.Name
						invoked.Extrinsic0									= "requester"
					SetupRequestExtrinsicCount = SetupRequestExtrinsicCount + 1

					invoke Create CXMLRequestPunchOutSetupRequestExtrinsic
						invoked.CXML										= "1"
						invoked.CXMLRequest									= "1"
						invoked.CXMLRequestPunchOutSetupRequest 			= "1"
						invoked.CXMLRequestPunchOutSetupRequestExtrinsic	= SetupRequestExtrinsicCount
						invoked.Extrinsic									= DerivedCompany
						invoked.Extrinsic0									= "requestingCompany"
					SetupRequestExtrinsicCount = SetupRequestExtrinsicCount + 1
					
					invoke Create CXMLRequestPunchOutSetupRequestExtrinsic
						invoked.CXML										= "1"
						invoked.CXMLRequest									= "1"
						invoked.CXMLRequestPunchOutSetupRequest 			= "1"
						invoked.CXMLRequestPunchOutSetupRequestExtrinsic	= SetupRequestExtrinsicCount
						invoked.Extrinsic									= DerivedReqLocation
						invoked.Extrinsic0									= "requestingLocation"
					SetupRequestExtrinsicCount = SetupRequestExtrinsicCount + 1
					
					invoke Create CXMLRequestPunchOutSetupRequestExtrinsic
						invoked.CXML										= "1"
						invoked.CXMLRequest									= "1"
						invoked.CXMLRequestPunchOutSetupRequest				= "1"
						invoked.CXMLRequestPunchOutSetupRequestExtrinsic	= SetupRequestExtrinsicCount
						invoked.Extrinsic									= RequesterRel.CurrentRequisitionForRQC
						invoked.Extrinsic0									= "requisitionNumber"
					SetupRequestExtrinsicCount = SetupRequestExtrinsicCount + 1
				
				invoke Create CXMLRequestPunchOutSetupRequestBrowserFormPost
					invoked.CXML											= "1"
					invoked.CXMLRequest										= "1"
					invoked.CXMLRequestPunchOutSetupRequest					= "1"
					invoked.CXMLRequestPunchOutSetupRequestBrowserFormPost	= "1"
					invoked.URL												= WebServiceURL
				
				invoke GetContactNameAndEmail RequesterPunchoutVendor
				
				invoke Create CXMLRequestPunchOutSetupRequestContact
					invoked.CXML									= "1"
					invoked.CXMLRequest								= "1"
					invoked.CXMLRequestPunchOutSetupRequest			= "1"
					invoked.CXMLRequestPunchOutSetupRequestContact	= "1"
					invoked.CXMLRequestPunchOutSetupRequestContact0	= "requester"
					invoked.Name									= ContactName
					invoked.Email									= ContactEmail
				
				invoke Create CXMLRequestPunchOutSetupRequestSupplierSetup
					invoked.CXML											= "1" 
					invoked.CXMLRequest										= "1"
					invoked.CXMLRequestPunchOutSetupRequest					= "1"
					invoked.CXMLRequestPunchOutSetupRequestSupplierSetup	= "1"
					invoked.URL												= PunchoutVendorRel.URL
				
				invoke GetUrl Punchout
					PUNCHOUTWSITIMEOUT	= "120"
					PUNCHOUTWSIWSDL		= PunchoutVendorRel.URL
					PUNCHOUTWSIENDPOINT = PunchoutVendorRel.URL
					invoked.Request		= "1"
					MyResponse			= result.Response
				
				for each(Response) MyResponse.CXMLResponse set
					LocalPunchoutSetupRequestResponseStatusCode = each(Response).Status0
					LocalPunchoutSetupRequestResponseStatusText = each(Response).Status1
					for each(PunchOutSetupResponse) each.CXMLResponsePunchOutSetupResponse set
						for each(StartPage) each.CXMLResponsePunchOutSetupResponseStartPage set
							LocalPunchoutURL = each(StartPage).URL
				
		CheckForPunchoutData is an Instance Action
			restricted
			
			Parameters
				PrmPunchoutDataRecordKey is Alpha 100
				
			Action Rules
				LocalPunchoutDataRecordKey = PrmPunchoutDataRecordKey
				
		DeletePunchoutData is an Instance Action
			restricted
			
			Parameters
				PrmPunchoutDataRecordKey is Alpha 100
				
			Action Rules
				LocalPunchoutDataRecordKey = PrmPunchoutDataRecordKey
				invoke Delete PunchoutDataRel
				
		GetContactNameAndEmail is an Instance Action
			restricted





			
			Action Rules
				if (BuyingOrganizationRel.EmailDomainName entered)
					ContactEmailDomainName = BuyingOrganizationRel.EmailDomainName
				else
					ContactEmailDomainName = "infor.com"
					
				if (RequesterRel.Name entered)
					ContactName = RequesterRel.Name
				else
					ContactName = "Requester"
					
				ContactEmail = ""
				
				for each RequesterPunchoutVendorDataRel
					if (each.FieldName = "UserEmail")
						ContactEmail = each.FieldValue
				
				if (ContactEmail = "")
					for each PunchoutVendorDataRel
						if (each.FieldName = "UserEmail")
							ContactEmail = each.FieldValue
							
				if (ContactEmail = "")
					ContactEmail = RequesterRel.EmailAddress
					
				if (ContactEmail = "")
					if (Requester.Employee.Name.GivenName = "" or Requester.Employee.Name.FamilyName = "")
						ContactEmail = "Requester@" + ContactEmailDomainName
					else
						ContactEmail = Requester.Employee.Name.GivenName + "." + Requester.Employee.Name.FamilyName + "@" + ContactEmailDomainName
						
		MapPunchoutVendorFieldToLocalField is an Instance Action
			restricted
			
			Parameters
				PrmPunchoutVendorMappingSource is like MappingSource
				PrmPunchoutVendorFieldName is Alpha 200
				PrmPunchoutVendorFieldValue is Alpha 200
				
			Action Rules
				PunchoutVendorMappingSource = PrmPunchoutVendorMappingSource
				PunchoutVendorFromField = PrmPunchoutVendorFieldName
				if (PunchoutVendorFieldMappingRel exists) 
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineItem")
						POMapRequisitionLineItem = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionCode")
						POMapRequisitionLineDistributionCode = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineAllocationPriority")
						POMapRequisitionLineAllocationPriority = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineCommodityCode")
						POMapRequisitionLineCommodityCode = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDeliverTo")
						POMapRequisitionLineDeliverTo = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineGTIN")
						POMapRequisitionLineGTIN = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineFillOrKill")
						POMapRequisitionLineFillOrKill = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineFromCompany")
						POMapRequisitionLineFromCompany = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineFromLocation")
						POMapRequisitionLineFromLocation = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineLateDeliveryDate")
						POMapRequisitionLineLateDeliveryDate = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineManufacturerCode")
						POMapRequisitionLineManufacturerCode = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineManufacturerDivision")
						POMapRequisitionLineManufacturerDivision = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLinePOCode")
						POMapRequisitionLinePOCode = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLinePurchaseFromLocation")
						POMapRequisitionLinePurchaseFromLocation = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineMajorPurchasingClass")
						POMapRequisitionLineMajorPurchasingClass = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineMinorPurchasingClass")
						POMapRequisitionLineMinorPurchasingClass = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLinePurchaseTaxCode")
						POMapRequisitionLinePurchaseTaxCode = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLinePurchaseTaxable")
						POMapRequisitionLinePurchaseTaxable = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineRequestedDeliveryDate")
						POMapRequisitionLineRequestedDeliveryDate = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineSourcingEventRequired")
						POMapRequisitionLineSourcingEventRequired = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineVendor")
						POMapRequisitionLineVendor = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionAccount")
						POMapRequisitionLineDistributionAccount = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionSubAccount")
						POMapRequisitionLineDistributionSubAccount = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionAccountCategory")
						POMapRequisitionLineDistributionAccountCategory = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionAccountUnit")
						POMapRequisitionLineDistributionAccountUnit = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionActivity")
						POMapRequisitionLineDistributionActivity = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionAsset")
						POMapRequisitionLineDistributionAsset = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionAssetTemplate")
						POMapRequisitionLineDistributionAssetTemplate = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionAmount")
						POMapRequisitionLineDistributionAmount = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionPercent")
						POMapRequisitionLineDistributionPercent = PrmPunchoutVendorFieldValue
					else
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineDistributionQuantity")
						POMapRequisitionLineDistributionQuantity = PrmPunchoutVendorFieldValue
					else	
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLinePurchaseOrderUserField2")
						POMapRequisitionLinePurchaseOrderUserField2 = PrmPunchoutVendorFieldValue
					else	
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLinePurchaseOrderUserField4")
						POMapRequisitionLinePurchaseOrderUserField4 = PrmPunchoutVendorFieldValue
					else	
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLinePurchaseOrderUserField6")
						POMapRequisitionLinePurchaseOrderUserField6 = PrmPunchoutVendorFieldValue
					else	
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineUserDate3")
						POMapRequisitionLineUserDate3 = PrmPunchoutVendorFieldValue
					else	
					if (PunchoutVendorFieldMappingRel.ToField = "RequisitionLineUserDate4")
						POMapRequisitionLineUserDate4 = PrmPunchoutVendorFieldValue
											
        CreateReqFromRPS is an Instance Action
        	restricted
        	
        	Local Fields
        		LocalRequisitionView is a Requisition view
				LocalRequisitionLineView is a RequisitionLine view
				
        	Parameters
        		PrmCompany             			is an InventoryCompany
        		PrmRequestingLocation			is a RequestingLocation
				PrmFromCompany					is like InventoryCompany
				PrmFromLocation					is like InventoryLocation
				PrmRequestedDeliveryDate		is Date
				PrmDeliverTo					is a DeliverTo
				PrmAllocationPriority			is a AllocationPriority
				PrmRequisitionDescription		is Alpha size 30
				PrmBuyer						is a Buyer
				PrmCommodityCode				is a CommCodes
				PrmPurchaseTaxCode				is a TaxCode
				PrmPurchaseTaxable				is Boolean
				PrmPOCode						is a POCode
				PrmRequisition					is a Requisition
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a VendorLocation
				PrmAllocationPriorityLevel		is an AllocationPriorityLevel
					
        	Parameter Rules
        		PrmCompany	
					default to RequisitionCompany
				PrmAllocationPriority							
					if (RSSLPLConfigurationParameterRel exists)
						default to PrmAllocationPriorityLevel
						default to RSSLPLAllocationPriorityLevelRel.AllocationPriorityLevel
			Action Rules
				if (PrmRequisition = 0)
            		invoke Create Requisition
						assign result to LocalRequisitionView
						invoked.Company                         = PrmCompany
						invoked.RequestingLocation				= PrmRequestingLocation
						invoked.FromCompanyLocation.FromCompany	= PrmFromCompany
						invoked.FromCompanyLocation.FromLocation = PrmFromLocation
						invoked.RequestedDeliveryDate			= PrmRequestedDeliveryDate
						invoked.DeliverTo						= PrmDeliverTo
						invoked.AllocationPriority				 	= PrmAllocationPriority
						if (RSSLPLConfigurationParameterRel exists)
							invoked.TransientAllocationPriorityLevel 	= PrmAllocationPriority
						invoked.Vendor							= PrmVendor
						invoked.PurchaseFromLocation			= PrmPurchaseFromLocation
						invoked.RequisitionDescription			= PrmRequisitionDescription
						invoked.Buyer							= PrmBuyer
						invoked.CommodityCode					= PrmCommodityCode
						invoked.PurchaseTaxCode					= PrmPurchaseTaxCode
						invoked.PurchaseTaxable					= PrmPurchaseTaxable
						invoked.POCode							= PrmPOCode
						invoked.RequisitionSource				= RqSource.RequisitionSelfService
					LocalNewRequisition = LocalRequisitionView.Requisition
					PrmRequisition = LocalNewRequisition 
					


						    		
        GetCartFromRPS is an Instance Action
        	restricted
        	
        	Local Fields
        		LocalRequisitionView is a Requisition view
				LocalRequisitionLineView is a RequisitionLine view
        	
        	Parameters
				PrmCompany             			is an InventoryCompany
				PrmRequestingLocation			is a RequestingLocation
				PrmFromCompany					is like InventoryCompany
				PrmFromLocation					is like InventoryLocation
				PrmRequestedDeliveryDate		is Date
				PrmDeliverTo					is a DeliverTo
				PrmAllocationPriority			is a AllocationPriority
				PrmRequisitionDescription		is Alpha size 30
				PrmBuyer						is a Buyer
				PrmCommodityCode				is a CommCodes
				PrmPurchaseTaxCode				is a TaxCode
				PrmPurchaseTaxable				is Boolean
				PrmPOCode						is a POCode
				PrmRequisition					is a Requisition
	            PrmPunchoutDataRecordKey 		is Alpha 100
	            PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a VendorLocation
	            PrmMajorPurchasingClass         is a MajorPurchasingClass
				PrmMinorPurchasingClass			is a MinorPurchasingClass
				PrmAsset						is an Asset
	            PrmAssetTemplate				is an AssetTemplate
				PrmManufacturer					is AlphaUpper size 9	
				PrmManufacturerNumber			is a ManufacturerNumber
				PrmGLEncumbranceReference		is AlphaUpper size 60
				PrmRSSSourceInformation			is Numeric size 1
					States
            			NotApplicable         	value is 0
            			SearchCatalog    		value is 1
						RecentlyRequestedItem   value is 2
            			ShoppingList    		value is 3
						Punchout				value is 4
						SpecialAndService		value is 5
						CopyRequisitionLine 	value is 6
				PrmAllocationPriorityLevel		is an AllocationPriorityLevel
	                        
	        Parameter Rules
				PrmCompany	
					default to RequisitionCompany
	            
            Action Rules
            	LocalPunchoutDataRecordKey = PrmPunchoutDataRecordKey
            	

            	invoke ParseXML CXMLFieldParser
            		invoked.Data = PunchoutDataRel.TextData
            		MyResponse = result.ParsedCXML
				
                for each(Message) MyResponse.CXMLMessage set
                    for each(PunchOutOrderMessage) each.CXMLMessagePunchOutOrderMessage set
                        for each(Item) each.CXMLMessagePunchOutOrderMessageItemIn set
                        	Quantity = each(Item).CXMLMessagePunchOutOrderMessageItemIn1
                            for each(ItemID) each.CXMLMessagePunchOutOrderMessageItemInItemID set
                                SupplierPartID              = each(ItemID).SupplierPartID
                                SupplierPartAuxiliaryID     = each(ItemID).SupplierPartAuxiliaryID
                            for each(ItemDetail) each.CXMLMessagePunchOutOrderMessageItemInItemDetail set
                            


                            	PunchInVendorItem = false
                            	for each(Extrinsic) each.CXMLMessagePunchOutOrderMessageItemInItemDetailExtrinsic set

                            		if (each(Extrinsic).Name = "PunchInVendor" and each(Extrinsic).Extrinsic = "true")
                            			PunchInVendorItem = true
                            			




                            		invoke MapPunchoutVendorFieldToLocalField RequesterPunchoutVendor
                            			invoked.PrmPunchoutVendorMappingSource = "Extrinsic"
                            			invoked.PrmPunchoutVendorFieldName = each(Extrinsic).Name
                            			invoked.PrmPunchoutVendorFieldValue = each(Extrinsic).Extrinsic
                            			
                            	for each(Classification) each.CXMLMessagePunchOutOrderMessageItemInItemDetailClassification set	




                            		invoke MapPunchoutVendorFieldToLocalField RequesterPunchoutVendor
                            			invoked.PrmPunchoutVendorMappingSource = "Classification"
                            			invoked.PrmPunchoutVendorFieldName = each(Classification).Domain
                            			invoked.PrmPunchoutVendorFieldValue = each(Classification).Classification
                            
                                for each(UnitPrice) each.CXMLMessagePunchOutOrderMessageItemInItemDetailUnitPrice set
									if (PrmRequisition = 0)
										invoke Create Requisition
											assign result to LocalRequisitionView
											invoked.Company                         = PrmCompany
											invoked.RequestingLocation				= PrmRequestingLocation
											invoked.FromCompanyLocation.FromCompany	= PrmFromCompany
											invoked.FromCompanyLocation.FromLocation = PrmFromLocation
											invoked.RequestedDeliveryDate			= PrmRequestedDeliveryDate
											invoked.DeliverTo						= PrmDeliverTo
											invoked.AllocationPriority				 	= PrmAllocationPriority
											if (RSSLPLConfigurationParameterRel exists)
												invoked.TransientAllocationPriorityLevel 	= PrmAllocationPriority
											invoked.Vendor							= PrmVendor
											invoked.PurchaseFromLocation			= PrmPurchaseFromLocation
											invoked.RequisitionDescription			= PrmRequisitionDescription
											invoked.Buyer							= PrmBuyer
											invoked.CommodityCode					= PrmCommodityCode
											invoked.PurchaseTaxCode					= PrmPurchaseTaxCode
											invoked.PurchaseTaxable					= PrmPurchaseTaxable
											invoked.POCode							= PrmPOCode
											invoked.RequisitionSource				= RqSource.RequisitionSelfService
										LocalNewRequisition = LocalRequisitionView.Requisition
										PrmRequisition = LocalNewRequisition 
									
									invoke Create RequisitionLine
										assign result to LocalRequisitionLineView
										include GetContractCost

										invoked.Company						= PrmCompany
										invoked.Requisition					= PrmRequisition
										invoked.Quantity					= Quantity
										invoked.Item						= SupplierPartID
										if (SupplierPartAuxiliaryID not entered)
											invoked.PunchoutId 					= SupplierPartID
										else
											invoked.PunchoutId 					= SupplierPartAuxiliaryID
										if (ProcurementCostDefault.OutputContract not entered
										or  (ProcurementCostDefault.OutputContract entered
										and	ContractLineRel.Contract.UOMSMustMatchForSpecials
										and each(ItemDetail).UnitOfMeasure != ContractLineRel.UOM))
											invoked.Vendor						= PunchoutVendorRel.Vendor
											invoked.PurchaseFromLocation		= PunchoutVendorRel.PurchaseFromLocation
											invoked.MajorPurchasingClass		= PrmMajorPurchasingClass
											invoked.MinorPurchasingClass     	= PrmMinorPurchasingClass
											invoked.Manufacturer				= PrmManufacturer
											invoked.ManufacturerNumber			= PrmManufacturerNumber
										else
										if (ProcurementCostDefault.OutputContract entered
										and	(ContractLineRel.Contract.UOMSMustMatchForSpecials
										and each(ItemDetail).UnitOfMeasure = ContractLineRel.UOM
										or !ContractLineRel.Contract.UOMSMustMatchForSpecials))
											invoked.CostCode					= CostCode.Contract
											invoked.Contract					= ProcurementCostDefault.OutputContract
											invoked.ContractLine				= ProcurementCostDefault.OutputContractLine
											if (ContractLineRel.MajorPurchasingClass not entered)
												invoked.MajorPurchasingClass	= PrmMajorPurchasingClass
												invoked.MinorPurchasingClass    = PrmMinorPurchasingClass
										invoked.RequisitionSource			= RqSource.RequisitionSelfService
										invoked.EnteredAsset				= PrmAsset
										invoked.EnteredAssetTemplate		= PrmAssetTemplate
										invoked.EnteredGLEncumbranceReference	= PrmGLEncumbranceReference 
										if (not (PunchoutVendorRel.Punchin and PunchInVendorItem))


											PunchoutVendorItemUnitCost 			= each(UnitPrice).Money

											invoked.CostOption 					= CostOption.CostRequired
											if (PunchoutVendorItemUnitCost = 0.0)
												invoked.CostOption 				= CostOption.NoCharge

											invoked.ItemType					= ItemType.Special
											invoked.TransactionCurrencyCode		= each(UnitPrice).Money0
											if (ProcurementCostDefault.OutputContract not entered
											or  (ProcurementCostDefault.OutputContract entered
											and	ContractLineRel.Contract.UOMSMustMatchForSpecials
											and each(ItemDetail).UnitOfMeasure != ContractLineRel.UOM))
												invoked.VendorItem					= SupplierPartID
												invoked.CostCode					= CostCode.Punchout
												invoked.UnitCost					= each(UnitPrice).Money
												invoked.TransactionUnitCost			= each(UnitPrice).Money
												invoked.EnteredUOM					= each(ItemDetail).UnitOfMeasure
											else 
											if (ProcurementCostDefault.OutputContract entered
											and	(ContractLineRel.Contract.UOMSMustMatchForSpecials
											and each(ItemDetail).UnitOfMeasure = ContractLineRel.UOM
											or !ContractLineRel.Contract.UOMSMustMatchForSpecials))										
												invoked.EnteredUOM					= ContractLineRel.UOM
											invoked.Description					= each(ItemDetail).Description
											invoked.LongDescription				= each(ItemDetail).Description

											if (PrmManufacturerNumber not entered and ProcurementCostDefault.OutputContract not entered)
												invoked.ManufacturerNumber			= each(ItemDetail).ManufacturerPartID
										

										if (POMapRequisitionLineItem entered)
											invoked.Item = POMapRequisitionLineItem
										if (POMapRequisitionLineDistributionCode entered)
											invoked.DistributionCode = POMapRequisitionLineDistributionCode
										if (POMapRequisitionLineAllocationPriority entered)
											invoked.AllocationPriority = POMapRequisitionLineAllocationPriority
										if (POMapRequisitionLineCommodityCode entered)
											invoked.CommodityCode = POMapRequisitionLineCommodityCode
										if (POMapRequisitionLineDeliverTo entered)
											invoked.DeliverTo = POMapRequisitionLineDeliverTo
										if (POMapRequisitionLineFillOrKill entered)
											invoked.FillOrKill = POMapRequisitionLineFillOrKill
										if (POMapRequisitionLineFromCompany entered)
											invoked.FromCompanyLocationBin.FromCompany = POMapRequisitionLineFromCompany
										if (POMapRequisitionLineFromLocation entered)
											invoked.FromCompanyLocationBin.FromLocation = POMapRequisitionLineFromLocation
										if (POMapRequisitionLineGTIN entered)
											invoked.ItemGTIN = POMapRequisitionLineGTIN
										if (POMapRequisitionLineLateDeliveryDate entered)
											invoked.LateDeliveryDate = POMapRequisitionLineLateDeliveryDate
										if (PrmManufacturer not entered and ProcurementCostDefault.OutputContract not entered)
											if (POMapRequisitionLineManufacturerCode entered)
												invoked.Manufacturer.ManufacturerCode = POMapRequisitionLineManufacturerCode
											if (POMapRequisitionLineManufacturerDivision entered)
												invoked.Manufacturer.ManufacturerDivision = POMapRequisitionLineManufacturerDivision
										if (POMapRequisitionLinePOCode entered)
											invoked.POCode = POMapRequisitionLinePOCode
										if (POMapRequisitionLinePurchaseFromLocation entered and ProcurementCostDefault.OutputContract not entered)
											invoked.PurchaseFromLocation = POMapRequisitionLinePurchaseFromLocation
										if (POMapRequisitionLineMajorPurchasingClass entered and ProcurementCostDefault.OutputContract not entered)
											invoked.MajorPurchasingClass = POMapRequisitionLineMajorPurchasingClass
										if (POMapRequisitionLineMinorPurchasingClass entered and ProcurementCostDefault.OutputContract not entered)
											invoked.MinorPurchasingClass = POMapRequisitionLineMinorPurchasingClass
										if (POMapRequisitionLinePurchaseTaxCode entered)
											invoked.PurchaseTaxCode = POMapRequisitionLinePurchaseTaxCode
										if (POMapRequisitionLinePurchaseTaxable entered)
											invoked.PurchaseTaxable = POMapRequisitionLinePurchaseTaxable
										if (POMapRequisitionLineRequestedDeliveryDate entered)
											invoked.RequestedDeliveryDate = POMapRequisitionLineRequestedDeliveryDate
										if (POMapRequisitionLineSourcingEventRequired entered)
											invoked.SourcingEventRequired = POMapRequisitionLineSourcingEventRequired
										if (POMapRequisitionLineVendor entered and ProcurementCostDefault.OutputContract not entered)
											invoked.Vendor = POMapRequisitionLineVendor
										if (POMapRequisitionLineDistributionAccount entered)
											invoked.EnteredPunchoutDistributionAccount = POMapRequisitionLineDistributionAccount
										if (POMapRequisitionLineDistributionSubAccount entered)
											invoked.EnteredPunchoutDistributionSubAccount = POMapRequisitionLineDistributionSubAccount
										if (POMapRequisitionLineDistributionAccountCategory entered)
											invoked.EnteredPunchoutDistributionAccountCategory = POMapRequisitionLineDistributionAccountCategory
										if (POMapRequisitionLineDistributionAccountUnit entered)
											invoked.EnteredPunchoutDistributionAccountUnit = POMapRequisitionLineDistributionAccountUnit
										if (POMapRequisitionLineDistributionActivity entered)
											invoked.EnteredPunchoutDistributionActivity = POMapRequisitionLineDistributionActivity
										if (POMapRequisitionLineDistributionAsset entered)
											invoked.EnteredPunchoutDistributionAsset = POMapRequisitionLineDistributionAsset
										if (POMapRequisitionLineDistributionAssetTemplate entered)
											invoked.EnteredPunchoutDistributionAssetTemplate = POMapRequisitionLineDistributionAssetTemplate
										if (POMapRequisitionLineDistributionAmount entered)
											invoked.EnteredPunchoutDistributionAmount = POMapRequisitionLineDistributionAmount
										if (POMapRequisitionLineDistributionPercent entered)
											invoked.EnteredPunchoutDistributionPercent = POMapRequisitionLineDistributionPercent
										if (POMapRequisitionLineDistributionQuantity entered)
											invoked.EnteredPunchoutDistributionQuantity = POMapRequisitionLineDistributionQuantity
										if (POMapRequisitionLinePurchaseOrderUserField2 entered)
											invoked.PurchaseOrderUserField2 			= POMapRequisitionLinePurchaseOrderUserField2
										if (POMapRequisitionLinePurchaseOrderUserField4 entered)
											invoked.PurchaseOrderUserField4 			= POMapRequisitionLinePurchaseOrderUserField4
										if (POMapRequisitionLinePurchaseOrderUserField6 entered)
											invoked.PurchaseOrderUserField6 			= POMapRequisitionLinePurchaseOrderUserField6
										if (POMapRequisitionLineUserDate3 entered)
											invoked.UserDate3 							= POMapRequisitionLineUserDate3
										if (POMapRequisitionLineUserDate4 entered)
											invoked.UserDate4 							= POMapRequisitionLineUserDate4
										invoked.RSSSourceInformation = PrmRSSSourceInformation.Punchout	

									include ClearPOMapPunchoutVendorFields
									LocalNewRequisitionLine = LocalRequisitionLineView.RequisitionLine	



										
									invoke Delete PunchoutDataRel


		RSSLPLPreEnhancedPunchoutAction is an Instance Action
			restricted
			default label is "CreateRequisitionForEnhancedPunchout"
			Local Fields
				LocalRequisition				is a Requisition view
				LocalRequisitionLine			is a RequisitionLine view
				LocalInitializeContract			is Boolean
			Parameters
				PrmCompany             			is an InventoryCompany
				PrmRequisition					is a Requisition
				PrmRequestingLocation			is a RequestingLocation
				PrmAddToRequisition				is Numeric size 1
					States
						StartNewRequisition			value is 0
						AddToExistingRequisition	value is 1
				PrmAllocationPriority			is an AllocationPriority
				PrmRequestedDeliveryDate		is Date
				PrmFromCompanyLocation 			is a FromCompanyLocation
				PrmRequisitionDescription		is Alpha size 30
				PrmPunchoutURL					is Text
				PrmPunchoutDataRecordKey		is Alpha 100
				PrmHROrganization 				is an HROrganization
				PrmRequester					is like Requester
				PrmVendorGroup					is like VendorGroup
				PrmVendor						is like Vendor
				PrmPunchoutVendor				is a PunchoutVendor

				PrmEnhancedPunchoutSetupRequest is Boolean
				PrmAllocationPriorityLevel		is an PunchoutAllocationPriorityLevel
				PrmBuyer						is a BuyerGroupField
				PrmCommodityCode				is a CommCodes
				PrmPOCode						is a POCode
				PrmDeliverTo					is a DeliverTo
			Parameter Rules
				PrmCompany
					default to actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
					initial value is actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
					default to actor.agent(Employee).Employee.Requester.Company
					initial value is actor.agent(Employee).Employee.Requester.Company
				PrmRequisition
					if (PrmAddToRequisition.AddToExistingRequisition)
						required
							"FieldIsRequired"
						constraint(PrmRequisition.UpdateAllowed)
							"RequisitionMustBeUnreleased"
						PrmRequestingLocation = PrmRequisition.RequestingLocation
					else
						PrmRequisition = 0
				PrmRequestingLocation
					default to PrmRequisition.RequestingLocation
					initial value is PrmRequisition.RequestingLocation
					default to actor.agent(Employee).Employee.Requester.RequestingLocation
					initial value is actor.agent(Employee).Employee.Requester.RequestingLocation
				PrmAllocationPriorityLevel.PunchoutFinanceEnterpriseGroup
					initial value is actor.context.FinanceEnterpriseGroup
					default to actor.context.FinanceEnterpriseGroup
				PrmAllocationPriority
					if (RSSLPLConfigurationParameterRel exists)
						default to PrmAllocationPriorityLevel.PunchoutAllocationPriorityLevel
						default to RSSLPLAllocationPriorityLevelRel.AllocationPriorityLevel
				PrmRequestedDeliveryDate
					if (RequesterRel.RequireRequestedDeliveryDate
					and PrmAddToRequisition.StartNewRequisition)
						required
							"Field_Requested_Delivery_DateIsRequired"
				PrmRequisitionDescription
					if (RequesterRel.RequireRequisitionDescription
					and PrmAddToRequisition.StartNewRequisition)
						required
							"Field_Requisition_DescriptionIsRequired"
				PrmPOCode
					initial value is PrmRequestingLocation.POCode

					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequirePOCode)
						required
							"Field_PO_CodeIsRequired"
				PrmCommodityCode
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireCommodityCodeDisplay)
						required
							"Field_Commodity_CodeIsRequired"
				PrmDeliverTo
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireDeliverTo)
						required
							"Field_Deliver_ToIsRequired"
				PrmBuyer
					if (PrmAddToRequisition.StartNewRequisition)
						PrmBuyer.InputRequireBuyer = RequesterRel.RequireBuyer
				PrmVendor
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireVendor)
						required
							"Field_VendorIsRequired"
				PrmFromCompanyLocation
					initial value is PrmRequestingLocation.FromCompanyLocation
					default to  PrmRequisition.FromCompanyLocation
						default individual fields
			Entrance Rules

			Action Rules
					if (PrmEnhancedPunchoutSetupRequest = true) 
						invoke CreateReqFromRPS
							invoked.PrmCompany                          = PrmCompany
							invoked.PrmRequestingLocation				= PrmRequestingLocation
							invoked.PrmFromCompany						= PrmFromCompanyLocation.FromCompany
							invoked.PrmFromLocation						= PrmFromCompanyLocation.FromLocation
							invoked.PrmRequestedDeliveryDate			= PrmRequestedDeliveryDate
							invoked.PrmAllocationPriority				= PrmAllocationPriority
							invoked.PrmAllocationPriority				= PrmAllocationPriority
							invoked.PrmVendor							= PrmVendor
							invoked.PrmRequisitionDescription			= PrmRequisitionDescription
							invoked.PrmRequisition 						= PrmRequisition
							invoked.PrmBuyer							= PrmBuyer.Buyer
							invoked.PrmDeliverTo						= PrmDeliverTo
							invoked.PrmPOCode							= PrmPOCode
							invoked.PrmCommodityCode					= PrmCommodityCode
					else
						LocalNewRequisition = 0
			Exit Rules
				RSSLPLLocalHROrganization = PrmHROrganization
				RSSLPLLocalRequester = PrmRequester
				RSSLPLLocalVendorGroup = PrmVendorGroup
				RSSLPLLocalVendor = PrmVendor
				RSSLPLLocalPunchoutVendor = PrmPunchoutVendor
				RSSLPLLocalEnhancedPunchoutSetupRequest = PrmEnhancedPunchoutSetupRequest
				invoke UpdateCurrentRequisitionForRQC this instance.RequesterRel
					invoked.PrmCompany				= PrmCompany
					if (PrmAddToRequisition.AddToExistingRequisition)
						invoked.PrmRequisition		= PrmRequisition
						RSSLPLLocalRequisition 		= PrmRequisition
					else
						invoked.PrmRequisition		= LocalNewRequisition
						RSSLPLLocalRequisition		= LocalNewRequisition
				invoke GetPunchoutURL RequesterPunchoutVendor
				if LocalPunchoutSetupRequestResponseStatusCode = 200

					RSSLPLLocalPunchoutURL = LocalPunchoutURL
					RSSLPLLocalPunchoutDataRecordKey = LocalPunchoutDataRecordKey


					invoke UpdateCurrentPunchoutContextforRQC this instance.RequesterRel
						invoked.PrmPunchoutURL = LocalPunchoutURL
						invoked.PrmPunchoutDataRecordKey = LocalPunchoutDataRecordKey
						invoked.PrmHROrganization = PrmHROrganization
						invoked.PrmRequester = PrmRequester
						invoked.PrmVendorGroup = PrmVendorGroup
						invoked.PrmVendor = PrmVendor
						invoked.PrmPunchoutVendor = PrmPunchoutVendor
						invoked.PrmEnhancedPunchoutSetupRequest = PrmEnhancedPunchoutSetupRequest
						if (PrmAddToRequisition.AddToExistingRequisition)
							invoked.PrmRequisition = PrmRequisition
						else
							invoked.PrmRequisition = LocalNewRequisition
				else


					constraint (LocalPunchoutSetupRequestResponseStatusCode = 200)
						"HTTP_\Status_\Code:<LocalPunchoutSetupRequestResponseStatusCode>,_\Error_\Description:<LocalPunchoutSetupRequestResponseStatusText>"


		RSSLPLPostDataReturnAction is an Instance Action

			restricted
			default label is "AddPunchoutItems_toRequisition"
			completion message is "PunchoutItemsAdded_toRequisition"



			Local Fields
				LocalRequisition				is a Requisition view
				LocalRequisitionLine			is a RequisitionLine view
				LocalInitializeContract			is Boolean
			Parameters
				PrmCompany             			is an InventoryCompany
				PrmRequisition					is a Requisition
				PrmRequestingLocation			is a RequestingLocation
				PrmAddToRequisition				is Numeric size 1
					States
						StartNewRequisition			value is 0
						AddToExistingRequisition	value is 1
				PrmAllocationPriority			is an AllocationPriority
				PrmRequestedDeliveryDate		is Date
				PrmFromCompanyLocation 			is a FromCompanyLocation
				PrmRequisitionDescription		is Alpha size 30
				PrmVendor						is like Vendor
				PrmPunchoutDataRecordKey		is Alpha 100

				PrmEnhancedPunchoutSetupRequest is Boolean
				PrmRSSSourceInformation			is Numeric size 1
					States
            			NotApplicable         	value is 0
            			SearchCatalog    		value is 1
						RecentlyRequestedItem   value is 2
            			ShoppingList    		value is 3
						Punchout				value is 4
						SpecialAndService		value is 5
						CopyRequisitionLine 	value is 6
				PrmAllocationPriorityLevel		is an AllocationPriorityLevel
				PrmBuyer						is a BuyerGroupField
				PrmCommodityCode				is a CommCodes
				PrmPOCode						is a POCode
				PrmDeliverTo					is a DeliverTo
			Parameter Rules
				PrmCompany
					initial value is DerivedCompany
					default to actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
					default to actor.agent(Employee).Employee.Requester.Company

				PrmRequisition
					if (PrmAddToRequisition.AddToExistingRequisition)
						required
							"FieldIsRequired"
						constraint(PrmRequisition.UpdateAllowed)
							"RequisitionMustBeUnreleased"
						PrmRequestingLocation 	= PrmRequisition.RequestingLocation
						PrmFromCompanyLocation	= PrmRequisition.FromCompanyLocation
					else
						PrmRequisition = 0

				PrmRequestingLocation
					initial value is DerivedReqLocation
					default to PrmRequisition.RequestingLocation
					default to actor.agent(Employee).Employee.Requester.RequestingLocation

				PrmAllocationPriority							
					if (RSSLPLConfigurationParameterRel exists)
						default to PrmAllocationPriorityLevel
						default to RSSLPLAllocationPriorityLevelRel.AllocationPriorityLevel

				PrmFromCompanyLocation
					initial value is PrmRequestingLocation.FromCompanyLocation
					default to  PrmRequisition.FromCompanyLocation
						default individual fields
				PrmRequestedDeliveryDate
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireRequestedDeliveryDate)
						required
							"Field_Requested_Delivery_DateIsRequired"
				PrmRequisitionDescription
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireRequisitionDescription)
						required
							"Field_Requisition_DescriptionIsRequired"
				PrmPOCode
					initial value is PrmRequestingLocation.POCode
					
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequirePOCode)
						required
							"Field_PO_CodeIsRequired"
				PrmCommodityCode
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireCommodityCodeDisplay)
						required
							"Field_Commodity_CodeIsRequired"
				PrmDeliverTo
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireDeliverTo)
						required
							"Field_Deliver_ToIsRequired"
				PrmBuyer
					if (PrmAddToRequisition.StartNewRequisition)
						PrmBuyer.InputRequireBuyer = RequesterRel.RequireBuyer
				PrmVendor
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireVendor)
						required
							"Field_VendorIsRequired"

			Entrance Rules
				constraint(Company = PrmCompany)
					"FromRequisitionCompanyMustEqualToRequisitionCompany"
			Action Rules
				LocalPunchoutDataRecordKey = PrmPunchoutDataRecordKey
				if (PunchoutDataRel exists)
					if (PrmEnhancedPunchoutSetupRequest = false)
						invoke GetCartFromRPS
							invoked.PrmCompany = PrmCompany
							invoked.PrmRequestingLocation = PrmRequestingLocation
							invoked.PrmFromCompany = PrmFromCompanyLocation.FromCompany
							invoked.PrmFromLocation = PrmFromCompanyLocation.FromLocation
							invoked.PrmRequestedDeliveryDate = PrmRequestedDeliveryDate
							invoked.PrmAllocationPriority	= PrmAllocationPriority
							invoked.PrmRequisitionDescription = PrmRequisitionDescription
							invoked.PrmVendor = PrmVendor
							invoked.PrmRequisition = PrmRequisition
							invoked.PrmPunchoutDataRecordKey = PrmPunchoutDataRecordKey
							invoked.PrmRSSSourceInformation = PrmRSSSourceInformation.Punchout
							invoked.PrmBuyer = PrmBuyer.Buyer
							invoked.PrmDeliverTo = PrmDeliverTo
							invoked.PrmPOCode = PrmPOCode
							invoked.PrmCommodityCode = PrmCommodityCode
			Exit Rules
				invoke UpdateCurrentRequisitionForRQC this instance.RequesterRel
					invoked.PrmCompany				= PrmCompany
					if (PrmAddToRequisition.AddToExistingRequisition)
						invoked.PrmRequisition		= PrmRequisition
					else
						invoked.PrmRequisition		= LocalNewRequisition


		RSSLPLEnhancedPunchoutPostDataReturnAction is an Instance Action
			restricted
			default label is "AddPunchoutItems_toRequisition<PrmRequisition>"
			completion message is "PunchoutItemsAdded_toRequisition<PrmRequisition>"
			Local Fields
				LocalRequisition				is a Requisition view
				LocalRequisitionLine			is a RequisitionLine view
				LocalInitializeContract			is Boolean
			Parameters
				PrmCompany						is an InventoryCompany
				PrmRequisition					is a Requisition
				PrmRequestingLocation			is a RequestingLocation
				PrmAddToRequisition				is Numeric size 1
					States
						StartNewRequisition			value is 0
						AddToExistingRequisition	value is 1
				PrmAllocationPriority			is an AllocationPriority
				PrmRequestedDeliveryDate		is Date
				PrmFromCompanyLocation 			is a FromCompanyLocation
				PrmRequisitionDescription		is Alpha size 30
				PrmPunchoutURL					is Text
				PrmPunchoutDataRecordKey		is Alpha 100
				PrmHROrganization 				is an HROrganization
				PrmRequester					is like Requester
				PrmVendorGroup					is like VendorGroup
				PrmVendor						is like Vendor
				PrmPunchoutVendor				is a PunchoutVendor
				PrmEnhancedPunchoutSetupRequest is Boolean
				PrmRSSSourceInformation			is Numeric size 1
					States
            			NotApplicable         	value is 0
            			SearchCatalog    		value is 1
						RecentlyRequestedItem   value is 2
            			ShoppingList    		value is 3
						Punchout				value is 4
						SpecialAndService		value is 5
						CopyRequisitionLine 	value is 6
			Parameter Rules
				PrmCompany
					initial value is actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
					default to actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
					default to actor.agent(Employee).Employee.Requester.Company
				PrmRequestingLocation
					initial value is PrmRequisition.RequestingLocation
					default to PrmRequisition.RequestingLocation
					default to actor.agent(Employee).Employee.Requester.RequestingLocation
			Entrance Rules
				constraint(Company = PrmCompany)
					"FromRequisitionCompanyMustEqualToRequisitionCompany"
			Action Rules
				LocalPunchoutDataRecordKey = PrmPunchoutDataRecordKey
				if (PunchoutDataRel exists)
					if (PrmEnhancedPunchoutSetupRequest = true)
						invoke GetCartFromRPS
							invoked.PrmCompany = PrmCompany
							invoked.PrmRequestingLocation = PrmRequestingLocation
							invoked.PrmFromCompany = PrmFromCompanyLocation.FromCompany
							invoked.PrmFromLocation = PrmFromCompanyLocation.FromLocation
							invoked.PrmRequestedDeliveryDate = PrmRequestedDeliveryDate
							invoked.PrmAllocationPriority = PrmAllocationPriority
							invoked.PrmRequisitionDescription = PrmRequisitionDescription
							invoked.PrmRequisition = PrmRequisition
							invoked.PrmPunchoutDataRecordKey = PrmPunchoutDataRecordKey
							invoked.PrmRSSSourceInformation = PrmRSSSourceInformation.Punchout
