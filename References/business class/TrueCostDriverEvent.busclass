TrueCostDriverEvent is a BusinessClass
    owned by truecost
    prefix is TCDEV
	default label is "True\CostDriverEventList"
    Ontology
    	symbolic key is TrueCostDriverEvent
    	
    Patterns

    Persistent Fields

        Amount						is Decimal 20.3	
        	default label is "Value"
        EventDate					is Date
        		
    Relations
    
    	DepartmentAccountingUnitRel
			one-to-one relation to AccountingUnit		
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	    = TrueCostConfiguration
				related.AccountingEntity			= DerivedAccountingEntity
				related.AccountingUnit	   			= DerivedDepartment
    	
		Department1Rel
			one-to-many relation to FinanceDimension1
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration

				related.FinanceDimension1 			= DerivedDepartment
			
    	Department2Rel
			one-to-many relation to FinanceDimension2
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration
				related.FinanceDimension2 			= DerivedDepartment
				
		Department3Rel
			one-to-many relation to FinanceDimension3
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration
				related.FinanceDimension3 			= DerivedDepartment	
			
				
		Department4Rel
			one-to-many relation to FinanceDimension4
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup		= TrueCostConfiguration
				related.FinanceDimension4			= DerivedDepartment
				
		Department5Rel
			one-to-many relation to FinanceDimension5
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup		= TrueCostConfiguration
				related.FinanceDimension5			= DerivedDepartment
				
		Department6Rel
			one-to-many relation to FinanceDimension6
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration
				related.FinanceDimension6			= DerivedDepartment
				
		Department7Rel
			one-to-many relation to FinanceDimension7
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration

				related.FinanceDimension7			= DerivedDepartment
							
		Department8Rel
			one-to-many relation to FinanceDimension8
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension8			= DerivedDepartment
				
		Department9Rel
			one-to-many relation to FinanceDimension9
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup		= TrueCostConfiguration
				related.FinanceDimension9			= DerivedDepartment
				
		Department10Rel
			one-to-many relation to FinanceDimension10
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup		= TrueCostConfiguration
				related.FinanceDimension10			= DerivedDepartment
		
		CostObject1Rel
			one-to-one relation to FinanceDimension1
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension1 			= DerivedCostObject		
		
		CostObject2Rel
			one-to-one relation to FinanceDimension2
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension2 			= DerivedCostObject		
		
		CostObject3Rel
			one-to-one relation to FinanceDimension3
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension3 			= DerivedCostObject
		
		CostObject4Rel
			one-to-one relation to FinanceDimension4
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension4 			= DerivedCostObject
		
		CostObject5Rel
			one-to-one relation to FinanceDimension5
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension5 			= DerivedCostObject
		
		CostObject6Rel
			one-to-one relation to FinanceDimension6
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension6 			= DerivedCostObject		
		
		CostObject7Rel
			one-to-one relation to FinanceDimension7
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension7 			= DerivedCostObject		
		
		CostObject8Rel
			one-to-one relation to FinanceDimension8
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension8 			= DerivedCostObject		
		
		CostObject9Rel
			one-to-one relation to FinanceDimension9
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension9 			= DerivedCostObject		
		
		CostObject10Rel
			one-to-one relation to FinanceDimension10
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension10 			= DerivedCostObject		
		
    	TrueCostDriverEventRel
    		one-to-many relation to TrueCostDriverEvent
    		Field Mapping uses symbolic key
    			related.TrueCostConfiguration				= TrueCostConfiguration
    			related.TrueCostDriver						= TrueCostDriver
    			related.AccountingEntity					= AccountingEntity
    			related.TrueCostDriverEvent.Department		= LocalDepartment
    			related.TrueCostDriverEvent.CostObject		= LocalCostObject
    			related.TrueCostDriverEvent.EventDateJulian	>= JulianStartDate
    		Instance Selection
    			where (related.TrueCostDriverEvent.EventDateJulian <= JulianEndDate)
    		
		GeneralLedgerCalendarPeriodsRel
			one-to-many relation to GeneralLedgerCalendarPeriod
			Field Mapping uses ByTopNodeTypeAndJulianDates
				related.FinanceEnterpriseGroup 						= TrueCostConfiguration
				related.TopNode										= TrueCostConfiguration.Calendar.TopNode
				related.PeriodType									= 3 
				related.EndDateJulian								>= LocalJulianDate
			Instance Selection
				where (related.StartDateJulian						<= LocalJulianDate)

		TrueCostDriverEventCopyRel
			one-to-many relation to TrueCostDriverEvent
			Field Mapping uses symbolic key
    			related.TrueCostConfiguration						= TrueCostConfiguration
    			related.TrueCostDriver								= LocalTrueCostDriver
    			related.AccountingEntity							= LocalAccountingEntity
    			related.TrueCostDriverEvent.Department				= LocalDepartment
    			related.TrueCostDriverEvent.CostObject				= LocalCostObject
    			related.TrueCostDriverEvent.EventDateJulian			>= LocalPeriodStartDateJulian
    		Instance Selection
    			where (related.TrueCostDriverEvent.EventDateJulian	<= LocalPeriodEndDateJulian)
    	
		TrueCostDriverEventTotalRel
			one-to-one relation to TrueCostDriverEventTotal		
			Field Mapping uses symbolic key		
    			related.TrueCostConfiguration 						= TrueCostConfiguration
    			related.TrueCostDriver								= LocalTrueCostDriver
    			related.AccountingEntity							= LocalAccountingEntity
    			related.TrueCostDriverEventTotal.Department			= LocalDepartment
    			related.TrueCostDriverEventTotal.CostObject			= LocalCostObject
    			related.TrueCostDriverEventTotal.EventPeriod		= LocalEventPeriod
    			
		TrueCostDriverEventTotalPurgeRel
			one-to-many relation to TrueCostDriverEventTotal		
			Field Mapping uses symbolic key		
    			related.TrueCostConfiguration 						= TrueCostConfiguration			

		TrueCostConfigurationRel
			one-to-one relation to TrueCostConfiguration
			Field Mapping uses symbolic key
    			related.TrueCostConfiguration 						= TrueCostConfiguration
		
	Sets
		ByEventDateDescending			
			Sort Order
				TrueCostConfiguration
				AccountingEntity
				TrueCostDriverEvent.Department
				TrueCostDriver
				TrueCostDriverEvent.CostObject
				TrueCostDriverEvent.EventDateJulian descending

    Local Fields
		LocalAlphaDay							is Alpha 3
		LocalAlphaYear							is Alpha 4

		LocalCopyDepartment						is a TrueCostDepartment					
		LocalCopyCostObject						is a FinanceDimension8

 
		LocalDepartment							is a TrueCostDepartment
		LocalCostObject							is a TrueCostCostObject
    	LocalSumAmount							is Decimal 31.3

		LocalStartDay							is Alpha 3
		LocalStartYear							is Alpha 4

		LocalEndDay								is Alpha 3
		LocalEndYear							is Alpha 4

		LocalStartDate							is Alpha 8
		LocalEndDate							is Alpha 8
		LocalDate1								is Date
		LocalDate2								is Date

		LocalEventPeriod 						is a GeneralLedgerCalendarPeriod
		LocalCopyEventDate						is Date
		LocalJulianDate							is Alpha 7
		LocalPeriodStartDateJulian				is AlphaUpper 7
		LocalPeriodEndDateJulian				is AlphaUpper 7 
		
		LocalTrueCostDriver						is like TrueCostDriver
		LocalTrueCostDriverEventTotal			is a TrueCostDriverEventTotal
		LocalAccountingEntity					is AlphaUpper 12		

		LocalPreviousAmount								is Decimal 20.3

	Transient Fields
		TransientDepartmentAccountingUnit			is a AccountingUnit
		TransientDepartmentFinanceDimension1		is a FinanceDimension1
		TransientDepartmentFinanceDimension2		is a FinanceDimension2
		TransientDepartmentFinanceDimension3		is a FinanceDimension3
		TransientDepartmentFinanceDimension4		is a FinanceDimension4
		TransientDepartmentFinanceDimension5		is a FinanceDimension5
		TransientDepartmentFinanceDimension6		is a FinanceDimension6
		TransientDepartmentFinanceDimension7		is a FinanceDimension7
		TransientDepartmentFinanceDimension8		is a FinanceDimension8
		TransientDepartmentFinanceDimension9		is a FinanceDimension9
		TransientDepartmentFinanceDimension10		is a FinanceDimension10
		
		TransientCostObjectFinanceDimension1		is a FinanceDimension1
		TransientCostObjectFinanceDimension2		is a FinanceDimension2
		TransientCostObjectFinanceDimension3		is a FinanceDimension3
		TransientCostObjectFinanceDimension4		is a FinanceDimension4
		TransientCostObjectFinanceDimension5		is a FinanceDimension5
		TransientCostObjectFinanceDimension6		is a FinanceDimension6
		TransientCostObjectFinanceDimension7		is a FinanceDimension7
		TransientCostObjectFinanceDimension8		is a FinanceDimension8
		TransientCostObjectFinanceDimension9		is a FinanceDimension9
		TransientCostObjectFinanceDimension10		is a FinanceDimension10

	Derived Fields
		JulianDate is a DerivedField
			type is Alpha 7
			restricted
			LocalAlphaYear = EventDate year
			LocalAlphaDay  = EventDate year day
			JulianDate = LocalAlphaYear
			if (LocalAlphaDay size = 1)
				JulianDate += "00"
			else
			if (LocalAlphaDay size = 2)
				JulianDate += "0"
			JulianDate += LocalAlphaDay
					
		CopyJulianDate is a DerivedField
			type is Alpha 7
			restricted
			LocalAlphaYear			= LocalCopyEventDate year
			LocalAlphaDay			= LocalCopyEventDate year day
			CopyJulianDate	= LocalAlphaYear
			if (LocalAlphaDay size = 1)
				CopyJulianDate += "00"
			else
			if (LocalAlphaDay size = 2)
				CopyJulianDate += "0"
			CopyJulianDate += LocalAlphaDay

		JulianStartDate is a DerivedField
			type is Alpha 7
			restricted
			LocalStartDate	= EventDate period
			LocalStartDate += "01"
			LocalDate1		= LocalStartDate 
			LocalStartYear	= LocalDate1 year
			LocalStartDay	= LocalDate1 year day
			JulianStartDate = LocalStartYear
			if (LocalStartDay size = 1)
				JulianStartDate += "00"
			else
			if (LocalStartDay size = 2)
				JulianStartDate += "0"
			JulianStartDate += LocalStartDay

		JulianEndDate is a DerivedField
			type is Alpha 7
			restricted
			LocalEndDate	= EventDate period
			LocalEndDate	+= EventDate days in month
			LocalDate2		= LocalEndDate 
			LocalEndYear	= LocalDate2 year
			LocalEndDay		= LocalDate2 year day
			JulianEndDate	= LocalEndYear
			if (LocalEndDay size = 1)
				JulianEndDate += "00"
			else
			if (LocalEndDay size = 2)
				JulianEndDate += "0"
			JulianEndDate += LocalEndDay
			
		DerivedAccountingEntity is a DerivedField
			type is like AccountingEntity
			restricted
			if (LocalAccountingEntity entered)
				return LocalAccountingEntity
			else
				return AccountingEntity
			
		DerivedDepartment is a DerivedField
			type is like FinanceDimension7
			restricted
			if(LocalCopyDepartment entered)
				return LocalCopyDepartment
			else
				return TrueCostDriverEvent.Department
				
		DerivedCostObject is a DerivedField
			type is like FinanceDimension8
			restricted
			if(LocalCopyCostObject entered)
				return LocalCopyCostObject
			else
				return TrueCostDriverEvent.CostObject
				
		DepartmentDescription is a DerivedField
			type is like Description
			if (TrueCostConfiguration.DepartmentIsAccountingUnit)
				return DepartmentAccountingUnitRel.Description
			if (TrueCostConfiguration.DepartmentIsDimension1)
				return Department1Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension2)
				return Department2Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension3)
				return Department3Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension4)
				return Department4Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension5)
				return Department5Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension6)
				return Department6Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension7)
				LocalCopyDepartment = TrueCostDriverEvent.Department
				return Department7Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension8)
				return Department8Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension9)
				return Department9Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension10)
				return Department10Rel.Description
			
		CostObjectDescription is a DerivedField
			type is like Description
			if (TrueCostConfiguration.CostObjectIsDimension1)
				return CostObject1Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension2)
				return CostObject2Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension3)
				return CostObject3Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension4)
				return CostObject4Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension5)
				return CostObject5Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension6)
				return CostObject6Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension7)
				return CostObject7Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension8)
				return CostObject8Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension9)
				return CostObject9Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension10)
				return CostObject10Rel.Description

		DeltaAmount is a ComputeField
			type is Decimal 20.3
			restricted
			(Amount - LocalPreviousAmount)

		DepartmentDoesNotExist is a MessageField
			restricted
			"DepartmentDoesNotExist"

	Field Rules
		EventDate
			required
		Amount
			if (Amount not entered 
			or  Amount < 0)
				constraint (Amount >= 0)
					"DriverEventCannotBeNegative"
		TransientDepartmentAccountingUnit
			constraint (TransientDepartmentAccountingUnit.PostingAccountingUnit)
				"<TrueCostConfiguration.AccountingUnitLabel>MustBePosting"
		TransientDepartmentFinanceDimension1
			constraint (TransientDepartmentFinanceDimension1.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension1Label>MustBePosting"
		TransientDepartmentFinanceDimension2
			constraint (TransientDepartmentFinanceDimension2.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension2Label>MustBePosting"
		TransientDepartmentFinanceDimension3
			constraint (TransientDepartmentFinanceDimension3.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension3Label>MustBePosting"
		TransientDepartmentFinanceDimension4
			constraint (TransientDepartmentFinanceDimension4.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension4Label>MustBePosting"
		TransientDepartmentFinanceDimension5
			constraint (TransientDepartmentFinanceDimension5.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension5Label>MustBePosting"
		TransientDepartmentFinanceDimension6
			constraint (TransientDepartmentFinanceDimension6.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension6Label>MustBePosting"
		TransientDepartmentFinanceDimension7
			constraint (TransientDepartmentFinanceDimension7.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension7Label>MustBePosting"
		TransientDepartmentFinanceDimension8
			constraint (TransientDepartmentFinanceDimension8.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension8Label>MustBePosting"
		TransientDepartmentFinanceDimension9
			constraint (TransientDepartmentFinanceDimension9.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension9Label>MustBePosting"
		TransientDepartmentFinanceDimension10
			constraint (TransientDepartmentFinanceDimension10.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension10Label>MustBePosting"
				
		TransientCostObjectFinanceDimension1
			constraint (TransientCostObjectFinanceDimension1.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension1Label>MustBePosting"
		TransientCostObjectFinanceDimension2
			constraint (TransientCostObjectFinanceDimension2.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension2Label>MustBePosting"
		TransientCostObjectFinanceDimension3
			constraint (TransientCostObjectFinanceDimension3.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension3Label>MustBePosting"
		TransientCostObjectFinanceDimension4
			constraint (TransientCostObjectFinanceDimension4.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension4Label>MustBePosting"
		TransientCostObjectFinanceDimension5
			constraint (TransientCostObjectFinanceDimension5.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension5Label>MustBePosting"
		TransientCostObjectFinanceDimension6
			constraint (TransientCostObjectFinanceDimension6.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension6Label>MustBePosting"
		TransientCostObjectFinanceDimension7
			constraint (TransientCostObjectFinanceDimension7.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension7Label>MustBePosting"
		TransientCostObjectFinanceDimension8
			constraint (TransientCostObjectFinanceDimension8.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension8Label>MustBePosting"
		TransientCostObjectFinanceDimension9
			constraint (TransientCostObjectFinanceDimension9.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension9Label>MustBePosting"
		TransientCostObjectFinanceDimension10
			constraint (TransientCostObjectFinanceDimension10.DimensionType.Posting)
				"<TrueCostConfiguration.FinanceDimension10Label>MustBePosting"

	Conditions
		

		IsAcrossDepartment
			restricted
			when (TrueCostDriverEvent.Department not = blank
			and   TrueCostDriverEvent.CostObject     = blank)

		IsWithinDepartment
			restricted
			when (TrueCostDriverEvent.Department not = blank
			and	  TrueCostDriverEvent.CostObject not = blank)

		HasCalendar
			restricted
			when(TrueCostConfiguration.Calendar entered)

	Rule Blocks
		SetDepartment
			if (TransientDepartmentAccountingUnit entered)
				TrueCostDriverEvent.Department			=	TransientDepartmentAccountingUnit
			if (TransientDepartmentFinanceDimension1 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension1
			if (TransientDepartmentFinanceDimension2 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension2
			if (TransientDepartmentFinanceDimension3 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension3
			if (TransientDepartmentFinanceDimension4 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension4
			if (TransientDepartmentFinanceDimension5 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension5
			if (TransientDepartmentFinanceDimension6 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension6
			if (TransientDepartmentFinanceDimension7 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension7
			if (TransientDepartmentFinanceDimension8 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension8
			if (TransientDepartmentFinanceDimension9 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension9
			if (TransientDepartmentFinanceDimension10 entered)
				TrueCostDriverEvent.Department			= TransientDepartmentFinanceDimension10

		SetCostObject
			if (TransientCostObjectFinanceDimension1 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension1
			if (TransientCostObjectFinanceDimension2 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension2
			if (TransientCostObjectFinanceDimension3 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension3
			if (TransientCostObjectFinanceDimension4 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension4
			if (TransientCostObjectFinanceDimension5 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension5
			if (TransientCostObjectFinanceDimension6 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension6
			if (TransientCostObjectFinanceDimension7 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension7
			if (TransientCostObjectFinanceDimension8 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension8
			if (TransientCostObjectFinanceDimension9 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension9
			if (TransientCostObjectFinanceDimension10 entered)
				TrueCostDriverEvent.CostObject			= TransientCostObjectFinanceDimension10

		CheckDriverEventSum
			LocalDepartment = TrueCostDriverEvent.Department
			LocalCostObject = TrueCostDriverEvent.CostObject
			LocalSumAmount	= Amount + sum TrueCostDriverEventRel.Amount
			constraint (LocalSumAmount >= 0)
				"DriverEventCannotBeNegative"
	
	Create Rules
		constraint(TrueCostDriverEvent.Department entered)
			"Field<TrueCostConfiguration.DepartmentLabel>IsRequired"
	
	Create Exit Rules
		if (HasCalendar)
			LocalJulianDate									= JulianDate
			LocalEventPeriod								= GeneralLedgerCalendarPeriodsRel.GeneralLedgerCalendarPeriod
			if (LocalEventPeriod entered)
				LocalTrueCostDriverEventTotal.Department	= TrueCostDriverEvent.Department
				LocalTrueCostDriverEventTotal.CostObject	= TrueCostDriverEvent.CostObject
				LocalTrueCostDriverEventTotal.EventPeriod	= LocalEventPeriod
				invoke Update LocalTrueCostDriverEventTotal
					invoked.TrueCostConfiguration			= TrueCostConfiguration
					invoked.TrueCostDriver					= TrueCostDriver
					invoked.AccountingEntity				= AccountingEntity
					invoked.Amount							+= Amount
			
	Actions
 		Create is an Action
 			restricted
			Entrance Rules
				constraint (EventDate entered)
					"EventDateRequired"
				TrueCostDriverEvent.EventDateJulian	= JulianDate
				include CheckDriverEventSum
			
		CreateWithinDepartment is a Create Action
			default label is "CreateWithin-\DepartmentDriverEvent"
			Entrance Rules
				constraint (EventDate entered)
					"EventDateRequired"
				TrueCostDriverEvent.EventDateJulian	= JulianDate
				include SetDepartment
				include SetCostObject
				constraint (TrueCostDriverEvent.CostObject entered)
					"<TrueCostConfiguration.CostObjectLabel>IsRequiredForWithinDepartmentEvent"
				
				include CheckDriverEventSum
					
		CreateAcrossDepartments is a Create Action
			default label is "CreateCross-\DepartmentDriverEvent"
			Entrance Rules
				constraint (EventDate entered)
					"EventDateRequired"
				TrueCostDriverEvent.EventDateJulian	= JulianDate
				include SetDepartment
				include CheckDriverEventSum
					
    	Update is an Update Action

			Action Rules
				LocalPreviousAmount = old Amount
    		Exit Rules
				include CheckDriverEventSum
				if (HasCalendar)
					LocalJulianDate									= JulianDate
					LocalEventPeriod 								= GeneralLedgerCalendarPeriodsRel.GeneralLedgerCalendarPeriod
					if (LocalEventPeriod entered)
						LocalTrueCostDriverEventTotal.Department	= TrueCostDriverEvent.Department
						LocalTrueCostDriverEventTotal.CostObject	= TrueCostDriverEvent.CostObject
						LocalTrueCostDriverEventTotal.EventPeriod	= LocalEventPeriod
						invoke Update LocalTrueCostDriverEventTotal
							invoked.TrueCostConfiguration			= TrueCostConfiguration
							invoked.TrueCostDriver					= TrueCostDriver
							invoked.AccountingEntity				= AccountingEntity
							invoked.Amount							+= DeltaAmount

    	Delete is a Delete Action
    		Action Rules
    		Exit Rules
				LocalDepartment = TrueCostDriverEvent.Department
				LocalCostObject = TrueCostDriverEvent.CostObject
				LocalSumAmount	= sum TrueCostDriverEventRel.Amount
				constraint (LocalSumAmount >= 0)
					"DriverEventCannotBeNegative"

				if (HasCalendar)
					LocalJulianDate									= JulianDate
					LocalEventPeriod 								= GeneralLedgerCalendarPeriodsRel.GeneralLedgerCalendarPeriod
					if (LocalEventPeriod entered)
						LocalTrueCostDriverEventTotal.Department	= TrueCostDriverEvent.Department
						LocalTrueCostDriverEventTotal.CostObject	= TrueCostDriverEvent.CostObject
						LocalTrueCostDriverEventTotal.EventPeriod	= LocalEventPeriod
						invoke Update LocalTrueCostDriverEventTotal
							invoked.TrueCostConfiguration			= TrueCostConfiguration
							invoked.TrueCostDriver					= TrueCostDriver
							invoked.AccountingEntity				= AccountingEntity
							invoked.Amount							-= Amount
    	

    	CopyRecord is an Instance Action
			run in foreground
    		completion message is "CopySubmitted"
				
			Parameters
				PrmDepartmentAccountingUnit		is a AccountingUnit
					default label is "<TrueCostConfiguration.DepartmentLabel>"
	    		PrmDepartmentDimension1			is a FinanceDimension1
					default label is "<TrueCostConfiguration.DepartmentLabel>"
				PrmDepartmentDimension2			is a FinanceDimension2
					default label is "<TrueCostConfiguration.DepartmentLabel>"
				PrmDepartmentDimension3			is a FinanceDimension3
					default label is "<TrueCostConfiguration.DepartmentLabel>"
	    		PrmDepartmentDimension4			is a FinanceDimension4
					default label is "<TrueCostConfiguration.DepartmentLabel>"
	    		PrmDepartmentDimension5			is a FinanceDimension5
					default label is "<TrueCostConfiguration.DepartmentLabel>"
	    		PrmDepartmentDimension6			is a FinanceDimension6
					default label is "<TrueCostConfiguration.DepartmentLabel>"
	    		PrmDepartmentDimension7			is a FinanceDimension7
					default label is "<TrueCostConfiguration.DepartmentLabel>"
	    		PrmDepartmentDimension8			is a FinanceDimension8
					default label is "<TrueCostConfiguration.DepartmentLabel>"
	    		PrmDepartmentDimension9			is a FinanceDimension9
					default label is "<TrueCostConfiguration.DepartmentLabel>"
	    		PrmDepartmentDimension10			is a FinanceDimension10
					default label is "<TrueCostConfiguration.DepartmentLabel>"

				PrmCostObjectDimension1		 			is a FinanceDimension1    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension2		 			is a FinanceDimension2    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension3		 			is a FinanceDimension3    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension4		 			is a FinanceDimension4    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension5		 			is a FinanceDimension5    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension6		 			is a FinanceDimension6    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension7		 			is a FinanceDimension7    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension8		 			is a FinanceDimension8    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension9		 			is a FinanceDimension9    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
				PrmCostObjectDimension10	 			is a FinanceDimension10    			
	    			default label is "<TrueCostConfiguration.CostObjectLabel>"
	    		
				PrmAmount						is Decimal 20.3
					default label is "Value"	
        		PrmEventDate					is Date
					default label is "EventDate"

			Parameter Rules
				PrmDepartmentAccountingUnit
					if (TrueCostConfiguration.DepartmentIsAccountingUnit) 
						required						
				PrmDepartmentDimension1
					if (TrueCostConfiguration.DepartmentIsDimension1)
						required
				PrmDepartmentDimension2
					if (TrueCostConfiguration.DepartmentIsDimension2)
						required
				PrmDepartmentDimension3
					if (TrueCostConfiguration.DepartmentIsDimension3)
						required
				PrmDepartmentDimension4
					if (TrueCostConfiguration.DepartmentIsDimension4)
						required
				PrmDepartmentDimension5
					if (TrueCostConfiguration.DepartmentIsDimension5)
						required
				PrmDepartmentDimension6
					if (TrueCostConfiguration.DepartmentIsDimension6)
						required
				PrmDepartmentDimension7
					if (TrueCostConfiguration.DepartmentIsDimension7)
						required
				PrmDepartmentDimension8
					if (TrueCostConfiguration.DepartmentIsDimension8)
						required
				PrmDepartmentDimension9
					if (TrueCostConfiguration.DepartmentIsDimension9)
						required
				PrmDepartmentDimension10
					if (TrueCostConfiguration.DepartmentIsDimension10)
						required

				PrmCostObjectDimension1
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension1)
	    				required
				PrmCostObjectDimension2
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension2)
	    				required
				PrmCostObjectDimension3
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension3)
	    				required
				PrmCostObjectDimension4
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension4)
	    				required
				PrmCostObjectDimension5
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension5)
	    				required
				PrmCostObjectDimension6
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension6)
	    				required
				PrmCostObjectDimension7
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension7)
	    				required
				PrmCostObjectDimension8
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension8)
	    				required
				PrmCostObjectDimension9
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension9)
	    				required
				PrmCostObjectDimension10
	    			if (IsWithinDepartment
	    			and TrueCostConfiguration.CostObjectIsDimension10)
	    				required
				PrmAmount
					initial value is Amount
        		PrmEventDate
        			required
			
			Entrance Rules				
				constraint (EventDate entered)
					"EventDateRequired"
				TrueCostDriverEvent.EventDateJulian	= JulianDate				
					
	        Action Rules
        		initialize LocalCopyDepartment
        		initialize LocalCopyCostObject

				if (IsWithinDepartment)
					if (PrmCostObjectDimension1 entered)
						LocalCopyCostObject = PrmCostObjectDimension1
					if (PrmCostObjectDimension2 entered)
						LocalCopyCostObject = PrmCostObjectDimension2
					if (PrmCostObjectDimension3 entered)
						LocalCopyCostObject = PrmCostObjectDimension3
					if (PrmCostObjectDimension4 entered)
						LocalCopyCostObject = PrmCostObjectDimension4
					if (PrmCostObjectDimension5 entered)
						LocalCopyCostObject = PrmCostObjectDimension5
					if (PrmCostObjectDimension6 entered)
						LocalCopyCostObject = PrmCostObjectDimension6
					if (PrmCostObjectDimension7 entered)
						LocalCopyCostObject = PrmCostObjectDimension7
					if (PrmCostObjectDimension8 entered)
						LocalCopyCostObject = PrmCostObjectDimension8
					if (PrmCostObjectDimension9 entered)
						LocalCopyCostObject = PrmCostObjectDimension9
					if (PrmCostObjectDimension10 entered)
						LocalCopyCostObject = PrmCostObjectDimension10
		     
					constraint (LocalCopyCostObject entered)
						"<TrueCostConfiguration.CostObjectLabel>IsRequiredForWithinDepartmentEvent"	
						
	        	if (PrmDepartmentAccountingUnit entered)
	        		LocalCopyDepartment = PrmDepartmentAccountingUnit
					constraint (DepartmentAccountingUnitRel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
	        	if (PrmDepartmentDimension1 entered)
	        		LocalCopyDepartment = PrmDepartmentDimension1
					constraint (Department1Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension2 entered)
					LocalCopyDepartment = PrmDepartmentDimension2
					constraint (Department2Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension3 entered)
					LocalCopyDepartment = PrmDepartmentDimension3
					constraint (Department3Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension4 entered)
					LocalCopyDepartment = PrmDepartmentDimension4
					constraint (Department4Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension5 entered)
					LocalCopyDepartment = PrmDepartmentDimension5
					constraint (Department5Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension6 entered)
					LocalCopyDepartment = PrmDepartmentDimension6
					constraint (Department6Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension7 entered)
					LocalCopyDepartment = PrmDepartmentDimension7
					constraint (Department7Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension8 entered)
					LocalCopyDepartment = PrmDepartmentDimension8
					constraint (Department8Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension9 entered)
					LocalCopyDepartment = PrmDepartmentDimension9
					constraint (Department9Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
				if (PrmDepartmentDimension10 entered)
					LocalCopyDepartment = PrmDepartmentDimension10
					constraint (Department10Rel exists)
						"<TrueCostConfiguration.DepartmentLabel>DoesNotExist"
						
	        	invoke Create TrueCostDriverEvent
	        		invoked.TrueCostConfiguration 	= TrueCostConfiguration
	        		invoked.TrueCostDriver 			= TrueCostDriver
					invoked.AccountingEntity 		= AccountingEntity
					invoked.Department 				= LocalCopyDepartment
					invoked.CostObject 				= LocalCopyCostObject 
	        		invoked.Amount 					= PrmAmount
	        		invoked.EventDate 				= PrmEventDate		
	        		        				        		
		RebuildSummarizedDriverEvents is a Set Action
			restricted
			default label is "RebuildSummarizedDriverEvents"

			Parameters				
				PrmTrueCostConfiguration				is a TrueCostConfiguration
					default label is "Configuration"

			Parameter Rules		
				PrmTrueCostConfiguration
					required

			Local Fields
				LocalActor								is an Actor
				LocalTrueCostConfiguration				is a TrueCostConfiguration
				

			Instance Selection
				where(TrueCostDriverEvent.TrueCostConfiguration = PrmTrueCostConfiguration)
    		Rule Blocks
				UpdateDriverEventTotal
					LocalJulianDate										= JulianDate
					LocalEventPeriod 									= GeneralLedgerCalendarPeriodsRel.GeneralLedgerCalendarPeriod
					if (LocalEventPeriod entered)
						LocalTrueCostDriverEventTotal.Department		= TrueCostDriverEvent.Department
						LocalTrueCostDriverEventTotal.CostObject		= TrueCostDriverEvent.CostObject
						LocalTrueCostDriverEventTotal.EventPeriod		= LocalEventPeriod
						invoke Update LocalTrueCostDriverEventTotal
							invoked.TrueCostConfiguration				= PrmTrueCostConfiguration
							invoked.TrueCostDriver						= LocalTrueCostDriver
							invoked.AccountingEntity					= AccountingEntity
							invoked.Amount								+= Amount
    		Action Rules

				Set Rules

					Entrance Rules
						LocalTrueCostConfiguration = PrmTrueCostConfiguration 
					Exit Rules
   						LocalActor = actor
						send notification
							to LocalActor
							description is "RebuildSummarizedDriverEventsHasBeenCompleted"
							priority is high
							detail is "RebuildSummarizedDriverEventsHasBeenCompleted"

    			Instance Rules
    				LocalTrueCostDriver	= TrueCostDriver
					include UpdateDriverEventTotal
				
