PfiTriggerServiceJSON is a BusinessClass
    owned by pfi
    prefix is PfiTP
    default label is "TriggerService_J\S\O\N"

    Ontology
        symbolic key is PfiTriggerServiceJSON

    Patterns
        disable AsOfDateProcessing
        disable Auditing
        disable EffectiveDated

    Persistent Fields
        GenerationTime       is TimeStamp
        JSON                 is JSONObject
	    LineNumber			 is Numeric size 10
	    LineContext			 is Numeric size 10
	    	default label is "InContextOfLineNumber"
        ServiceDefinition 	 is like PfiServiceDefinition
        	default label is "Service"
        LPL					 is LPL
 		
	Derived Fields
		HasJSON is a NativeField
			type is Boolean
			restricted
			default label is untranslatable
			
		JSONFile is a DerivedField
			type is BinaryDocument  
			default label is "J\S\O\N_File"
			return JSON
			
		LPLSource is a DerivedField
			type is BinaryDocument 
			default label is "L\P\L_Source"
			return LPL	
			
		DerLineContext is a DerivedField
			type is  Numeric size 10
			default label is "<LineContext label>"	
			if (LineContext > 0)
				return LineContext
			return 0
			
	Conditions
		HasLineContext
            default label is "LineContextExists"
			when (LineContext > 0)		
			
	Local Fields
		LocalBusinessView   is like BusinessView
                
    Actions

        Create is a Create Action
       		restricted
       		
       	ScanBusinessView is an Import Action
       		default label is "ScanABusinessView"
       		manual transaction
       		manual update
       		Parameters
				ParamBusinessView is a BusinessView
                	default label is "<BusinessView label>"
                	
            Parameter Rules
            	ParamBusinessView
                	required
                	
                	LocalBusinessView = ParamBusinessView
                	
                	constraint (HasJSON)
                		"<ParamBusinessView>DoesNotContainAny_\Process_\TriggerRulesThatInclude_J\S\O\N_Variables"
            
        Delete is a Purge Action

        DeleteRecords is a Set Action
            Parameters
                ParamBusinessView is a BusinessView
                	default label is "<BusinessView label>"
                ParamGenerationTime is TimeStamp
                	default label is "ThroughGenerationTime"
               
            Parameter Rules
                ParamBusinessView
               
            Instance Selection
                where ((ParamBusinessView not entered or BusinessView = ParamBusinessView)
                and    (ParamGenerationTime not entered or GenerationTime <= ParamGenerationTime))

			Sort Order is primary
			
            Action Rules
				Instance Rules
					invoke Delete
                
