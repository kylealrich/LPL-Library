ExternalUser is a BusinessClass
    owned by person
    prefix is EXUSR
    stored in environment

    Ontology
        symbolic key is ExternalUser

    Patterns
    	implements CreateStamp
        disable AuditIndex
        disable AsOfDateProcessing
        disable EffectiveDated
        disable Auditing
	
	Persistent Fields
		ActionName is Alpha up to 80
		RawText is Text
		ResponseCode is Alpha up to 10
		ResponseMsg is Alpha up to 100
	
	Transient Fields
		EntityId						is Alpha size 50
		UserIdentity					is Alpha size 50
		IdentifierId					is Alpha size 20
		IdentifierValue					is Alpha size 50
		Password						is Password	    
		FirstName						is Alpha size 50
		LastName						is Alpha size 50
		FederatedId						is Alpha size 50
		Language						is Alpha size 30
		Locale							is Alpha size 8
		Timezone						is Alpha size 30
		VerificationId					is Alpha size 100
		VerificationCode				is Alpha size 20
		SlimUserResponse				is Boolean
		NewPassword						is Password	    
		IsPrimary						is Boolean
			default label is "Primary"
		EntityCode						is AlphaUpper size 20
		EntityName						is Alpha size 50
		Description						is Alpha size 50
		IdentifierArray					is a EUIdentifierArray
		
		ApplicationRedirectURL			is Alpha size 150
		RegistrationFromURL				is Alpha size 150
		EnableUserVerification			is Boolean
		DefaultFromEmailAddress			is Alpha size 50
		PolicyURL						is Alpha size 150
		ContactUsURL					is Alpha size 150
		LoginPageColor					is Alpha size 10
		TermsOfUseURL					is Alpha size 150		
		RedirectURL						is Alpha size 150
		AllowMfaRegistrationDuringLogin	is Boolean
		
		Name 							is a PersonName
  		ActorId							is LoginName
		PrimaryContactInfo   			is a ContactInfo 
		Roles							is Alpha size 30
		
		ProviderId						is Alpha size 50
		ProviderName 					is Alpha size 10
			States
        		Email					value is "email"
        		SMS						value is "sms"
				TOTP 					value is "totp"
		
		DeviceId						is Alpha size 50
		DeviceName						is Alpha size 50
		MFAEnable						is Boolean
			default label is "EnableMFA"
		MFAEnforce						is Boolean
			default label is "EnforceMFA"		
		
		MFACode							is Alpha size 50	
		ReferenceId						is Alpha size 50
		
		MassRegisterUsersPayload		is Text
		TransactionID					is Alpha size 50 
		
	Derived Fields
		AccessTokenEndpointExist is a NativeField
			type is Boolean
			default label is "AccessTokenEndpointExists"
						
	Sets
		ByStamp
			Sort Order
				create stamp	
								
	Actions
		Delete is a Delete Action
			valid when (AccessTokenEndpointExist)
			
		GetAccessToken is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				ActionName = "GetAccessToken"
				
				invoke GetAccessToken ExternalUserExecutor
					assign result to RawText 
					
		GetAllExternalEntity is a Create Action
			default label is "GetAllExternalEntities"
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				ActionName = "GetAllExternalEntity"
				
				invoke GetAllExternalEntity ExternalUserExecutor
					assign result to RawText 
					
					invoked.Language = Language

		AddExternalEntity is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Field Rules
				AllowMfaRegistrationDuringLogin
					default to true
					
			Action Rules
				constraint (EntityCode entered)
					"EntityCodeIsRequired"
				constraint (EntityName entered)
					"EntityNameIsRequired"	
				constraint (IdentifierArray entered)
					"AtLeastOneIdentifierIsRequired"
														
				ActionName = "AddExternalEntity"
				
				invoke AddExternalEntity ExternalUserExecutor
					assign result to RawText
					
					invoked.EntityCode = EntityCode
					invoked.EntityName = EntityName
					invoked.Description = Description
					invoked.EnableUserVerification = EnableUserVerification
					invoked.AllowMfaRegistrationDuringLogin = AllowMfaRegistrationDuringLogin
					invoked.Language = Language
					invoked.Locale = Locale
					invoked.Timezone = Timezone
					invoked.MFAEnable = MFAEnable
					invoked.MFAEnforce = MFAEnforce
					invoked.IdentifierArray = IdentifierArray
		
		GetExternalEntity is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
					
				ActionName = "GetExternalEntity"
				
				invoke GetExternalEntity ExternalUserExecutor
					assign result to RawText
					
					invoked.EntityId = EntityId
					invoked.Language = Language

		DeleteExternalEntity is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
					
				ActionName = "DeleteExternalEntity"
				
				invoke DeleteExternalEntity ExternalUserExecutor
					assign result to RawText 
					
					invoked.EntityId = EntityId
					invoked.Language = Language

		GetPasswordPolicy is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
					
				ActionName = "GetPasswordPolicy"
				
				invoke GetPasswordPolicy ExternalUserExecutor
					assign result to RawText 
		
					invoked.EntityId = EntityId	
					invoked.Language = Language			
																
		AdminRegisterUser is a Create Action
			default label is "AdministratorRegisterExternalUser"	
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"				
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
					
				ActionName = "AdminRegisterUser"

				invoke AdminRegisterUser ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.Language = Language
											
		RegisterUser is a Create Action
			default label is "RegisterExternalUser"	
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"				
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
				constraint (Password entered)
					"PasswordIsRequired"
					
				ActionName = "RegisterUser"

				invoke RegisterUser ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.Password = Password
					invoked.FirstName = FirstName
					invoked.LastName = LastName
					invoked.FederatedId = FederatedId
					invoked.Language = Language
					invoked.Locale = Locale
					invoked.Timezone = Timezone
					invoked.EnableUserVerification = EnableUserVerification

		VerifyUser is a Create Action 
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (VerificationId entered)
					"VerificationIdIsRequired"
				constraint (VerificationCode entered)
					"VerificationCodeIsRequired"	
					
				ActionName = "VerifyUser"
				
				invoke VerifyUser ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId					
					invoked.UserIdentity = UserIdentity
					invoked.VerificationId = VerificationId
					invoked.VerificationCode = VerificationCode	
					invoked.SlimUserResponse = SlimUserResponse	
					invoked.Language = Language
		
		ResendVerification is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (VerificationId entered)
					"VerificationIdIsRequired"
					
				ActionName = "ResendVerification"
				
				invoke ResendVerification ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId					
					invoked.UserIdentity = UserIdentity
					invoked.VerificationId = VerificationId
					invoked.Language = Language
					
		GetUser is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"	
				
				ActionName = "GetUser"
					
				invoke GetUser ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId					
					invoked.UserIdentity = UserIdentity	
					invoked.Language = Language
					
		DeleteUser is a Create Action
			valid when (AccessTokenEndpointExist)
		
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"	
				
				ActionName = "DeleteUser"
					
				invoke DeleteUser ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId					
					invoked.UserIdentity = UserIdentity	
					invoked.Language = Language
					
		ChangePassword is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"	
				constraint (Password entered)
					"CurrentPasswordIsRequired"
				constraint (NewPassword entered)
					"NewPasswordIsRequired"
						
				ActionName = "ChangePassword"
					
				invoke ChangePassword ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId					
					invoked.UserIdentity = UserIdentity	
					invoked.Password = Password
					invoked.NewPassword = NewPassword
					invoked.Language = Language

		ResetPassword is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"	
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
				constraint (RedirectURL entered)
					"RedirectURLIsRequired"
						
				ActionName = "ResetPassword"
					
				invoke ResetPassword ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId					
					invoked.UserIdentity = UserIdentity	
					invoked.IdentifierValue = IdentifierValue
					invoked.RedirectURL = RedirectURL
					invoked.Language = Language
					
		AddUserIdentifier is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
				constraint (Password entered)
					"PasswordIsRequired"
					
				ActionName = "AddUserIdentifier"

				invoke AddUserIdentifier ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.IsPrimary = IsPrimary
					invoked.Password = Password
					invoked.Language = Language
					
		RemoveUserIdentifier is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
				constraint (Password entered)
					"PasswordIsRequired"
					
				ActionName = "RemoveUserIdentifier"

				invoke RemoveUserIdentifier ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.IsPrimary = IsPrimary
					invoked.Password = Password
					invoked.Language = Language
					
		UpdateUserIdentifier is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
				constraint (Password entered)
					"PasswordIsRequired"
					
				ActionName = "UpdateUserIdentifier"

				invoke UpdateUserIdentifier ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.IsPrimary = IsPrimary
					invoked.Password = Password
					invoked.Language = Language

		SwapUserIdentifier is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
				constraint (Password entered)
					"PasswordIsRequired"
					
				ActionName = "SwapUserIdentifier"

				invoke SwapUserIdentifier ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.Password = Password
					invoked.Language = Language
								
		AdminUpdateUserIdentifier is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
					
				ActionName = "AdminUpdateUserIdentifier"

				invoke AdminUpdateUserIdentifier ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.Language = Language

		UpdateUserInfo is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
					
				ActionName = "UpdateUserInfo"

				invoke UpdateUserInfo ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.LastName = LastName
					invoked.FirstName = FirstName
					invoked.Language = Language
		
		DisableUser is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
					
				ActionName = "DisableUser"

				invoke DisableUser ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.Language = Language

		EnableUser is a Create Action
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
					
				ActionName = "EnableUser"

				invoke EnableUser ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.Language = Language
																													
		RegisterMFADevice is a Create Action
			default label is "RegisterMFADevice"
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"					
				constraint (ProviderName entered)
					"ProviderNameIsRequired"
					
				ActionName = "RegisterMFADevice"

				invoke RegisterMFADevice ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.ProviderName = ProviderName
					invoked.Language = Language
		
		VerifyMFADevice is a Create Action
			default label is "VerifyMFADevice"
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (IdentifierId entered)
					"IdentifierIdIsRequired"
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"					
				constraint (MFACode entered)
					"MFACodeIsRequired"				
				constraint (ReferenceId entered)
					"ReferenceIdIsRequired"
					
				ActionName = "VerifyMFADevice"

				invoke VerifyMFADevice ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.IdentifierId = IdentifierId
					invoked.IdentifierValue = IdentifierValue
					invoked.MFACode = MFACode
					invoked.ReferenceId = ReferenceId
					invoked.Language = Language
		
		RemoveMFADevice is a Create Action
			default label is "RemoveMFADevice"
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"	
				constraint (IdentifierValue entered)
					"IdentifierValueIsRequired"
				constraint (ProviderId entered)
					"ProviderIdIsRequired"				
				constraint (DeviceId entered)
					"DeviceIdIsRequired"
					
				ActionName = "RemoveMFADevice"

				invoke RemoveMFADevice ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.ProviderId = ProviderId
					invoked.DeviceId = DeviceId
					invoked.IdentifierValue = IdentifierValue
					invoked.Language = Language
		 
		GetRegisteredMFADeviceInfo is a Create Action
			default label is "GetRegisteredMFADeviceInformation"
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"

				ActionName = "GetRegisteredMFADeviceInfo"
				
				invoke GetRegisteredMFADeviceInfo ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.Language = Language

		SetDefaultMFADevice is a Create Action
			default label is "SetDefaultMFADevice"
			valid when (AccessTokenEndpointExist)

			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (DeviceId entered)
					"DeviceIdIsRequired"

				ActionName = "SetDefaultMFADevice"

				invoke SetDefaultMFADevice ExternalUserExecutor
					assign result to RawText

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.DeviceId = DeviceId
					invoked.Language = Language

		UpdateMFADeviceName is a Create Action
			default label is "UpdateMFADeviceName"
			valid when (AccessTokenEndpointExist)

			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"
				constraint (UserIdentity entered)
					"UserIdentityIsRequired"
				constraint (DeviceId entered)
					"DeviceIdIsRequired"
				constraint (DeviceName entered)
					"DeviceNameIsRequired"

				ActionName = "UpdateMFADeviceName"

				invoke UpdateMFADeviceName ExternalUserExecutor
					assign result to RawText

					invoked.EntityId = EntityId
					invoked.UserIdentity = UserIdentity
					invoked.DeviceName = DeviceName
					invoked.DeviceId = DeviceId
					invoked.Language = Language

		MassRegisterUsers is a Create Action
			default label is "MassRegisterUsers"	
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"				
				constraint (MassRegisterUsersPayload entered)
					"MassRegisterUsersPayloadIsRequired"
					
				ActionName = "MassRegisterUsers"

				invoke MassRegisterUsers ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.Language = Language
					invoked.MassRegisterUsersPayload = MassRegisterUsersPayload
					
		GetMassRegisterTransactionStatus is a Create Action
			default label is "GetMassRegisterTransactionStatus"	
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"				
				constraint (TransactionID entered)
					"TransactionIDIsRequired"
					
				ActionName = "GetMassRegisterTransactionStatus"

				invoke GetMassRegisterTransactionStatus ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.Language = Language
					invoked.TransactionID = TransactionID
					
		GetMassRegisterUsersStatus is a Create Action
			default label is "GetMassRegisterUsersStatus"	
			valid when (AccessTokenEndpointExist)
			
			Action Rules
				constraint (EntityId entered)
					"EntityIdIsRequired"				
				constraint (TransactionID entered)
					"TransactionIDIsRequired"
					
				ActionName = "GetMassRegisterUsersStatus"

				invoke GetMassRegisterUsersStatus ExternalUserExecutor
					assign result to RawText 

					invoked.EntityId = EntityId
					invoked.Language = Language
					invoked.TransactionID = TransactionID
