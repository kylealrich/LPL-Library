DunningCSVOutput is a BusinessClass
	owned by ar
	
	prefix is DCSV
	
	Ontology
		symbolic key is DunningCSVOutput
		
	
	Patterns
		implements StaticJava
		disable AuditIndex
	
	Persistent Fields		
		FileName				is AlphaUpper size 50
		CreateDate				is TimeStamp
		CollectionLevel         is AlphaUpper size 1
            States
                Yes 				value is "Y"
                No  				value is "N"
                Collection			value is "C"
                ExcludeCollection	value is "E"
		PrintOption             is AlphaUpper size 1
            States
                No  value is "N"
                Yes value is "Y"        
        UpdateOption            is AlphaUpper size 1
            States
                No  value is "N"
                Yes value is "Y"
        LetterFormat            is AlphaUpper size 2
            States
                Standard value is "00"
                Sweden   value is "01"
		CompanyCollectionID		is AlphaUpper size 20
        IncludeCustomerTaxID	is AlphaUpper size 1
        	States
                Yes value is "Y"
                No  value is "N"
		CSVFile					is an Attachment
		    
    Derived Fields
        CSVFileNameOutputFileName is a StringField
            type is Alpha 100
			FileName
			"-"
			Company
			"-"			

	Conditions
		HasCSVFileAttachment
			restricted
			when (CSVFile entered)
			
    Relations

    Sets
    	ByCreateDate
    		Sort Order
    			CreateDate				descending
    			Company
    			DunningCSVOutput

    Field Rules
        CreateDate
            default to current timestamp
		FileName
			default to "DUNNCSV"

	Actions
		Create is a Create Action
			restricted
		
		Update is an Update Action
			restricted
		
		Delete is a Delete Action
			restricted
		
		Purge is a Purge Action
			restricted

		CreateDunningCSVFile is an Instance Action
			Action Rules
				trigger "DunningCSVFile" PA service
					resume on error
					title is "CreateDunningCSVFile"
					Variables
						Company
						DunningCSVOutput


		PurgeDunningCSVOutputRecords is a Set Action
			run in foreground
			completion message is "PurgeOfDunningCSVOutputRecordsHasCompleted"
			Parameters
				PrmReceivableCompany						is a ReceivableCompany
				PrmCreateDateRange							is a DateRange 
				
			Parameter Rules
				PrmCreateDateRange
					required
				PrmReceivableCompany
					required
			Instance Selection
				where (CreateDate date within PrmCreateDateRange
				and    Company = PrmReceivableCompany)
	
			Action Rules
				Instance Rules
					invoke Purge
						
