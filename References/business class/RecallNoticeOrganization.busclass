RecallNoticeOrganization is a BusinessClass
	owned by recall
	prefix is Reca
	
	Ontology
		symbolic key is RecallNoticeOrganization

	Patterns
		implements DynamicCreation
		
	Persistent Fields
		AssignedUser				is a RecallUser
		FromManualTask           	is Boolean
	
	Context Fields
		RecallNoticeDateRange    	is a DateRange
		RecallNoticeTask
		RecallProduct
		RecallReport
		RecallReportPeriod
	
	Local Fields
		TempReqLoc					is Alpha size 20
		FromProductTransactionQuery is Boolean
		
	Conditions
	
		RecallWithinDateRange
			restricted
			when (RecallNotice.create date within RecallNoticeDateRange)
			
		HasRequisitionLineTaskDetail
			restricted
			when (RequisitionLineTaskTransactionRel exists)
	
		HasPurchaseOrderLineTaskDetail
			restricted
			when (PurchaseOrderLineTaskTransactionRel exists)
	
		HasPolinesrcTaskDetail
			restricted
			when (PolinesrcTaskTransactionRel exists)
	
		HasIssuesTaskDetail
			restricted
			when (IssuesTaskTransactionRel exists)
	
		HasRequisitionLineProductDetail
			restricted
			when (RequisitionLineProductRel exists)
	
		HasPurchaseOrderLineProductDetail
			restricted
			when (PurchaseOrderLineProductRel exists)
	
		HasPolinesrcProductDetail
			restricted
			when (PolinesrcProductRel exists)
	
		HasIssuesProductDetail
			restricted
			when (IssuesProductRel exists)
			
		CanShowTaskQuantities
			restricted
			when (RecallReleased
			and   RecallGroup.EnterQuantitiesByLocation)
			
		CanShowQuantityMessage
			restricted
			when (RecallReleased
			and   !RecallGroup.EnterQuantitiesByLocation)   

		HasTaskItemsWithQuantities
			when (TaskWithQuantities exists)
			
		RecallReleased
			restricted
			when (RecallNotice.Status > 1)

		DoesNotHaveDuplicateNoticeOnList 
			restricted 
			when (DuplicateNoticeForThisListRel !exists)
	
	Relations
	
		TaskRel
			one-to-many relation to RecallNoticeTask
			Field Mapping uses ByOwner
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.Owner            = AssignedUser 			
		
		TaskWithQuantities
			one-to-many relation to RecallNoticeTask
			Field Mapping uses ByOwner
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.Owner            = AssignedUser 
			Instance Selection
				where (related.QuantitiesEntered)			

		DuplicateNoticeForThisListRel 
			one-to-many relation to RecallNoticeOrganization 
			Field Mapping uses symbolic key 
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
			Instance Selection 
				where (related.UniqueID != UniqueID)
		
		RequisitionLineTaskTransactionRel
			one-to-many relation to RecallProductTransactionTask
			Field Mapping uses ByTaskProduct
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.RecallNoticeTask = RecallNoticeTask
				related.RecallProduct	 = RecallProduct
				related.ActivityType	 = 1 
			Instance Selection
				where (related.RecallProductTransaction.RequestingLocationGroup.RequestingCompany		= RecallOrganization.InventoryCompany
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingLocation		= RecallOrganization.RequestingLocation)
	
		PurchaseOrderLineTaskTransactionRel
			one-to-many relation to RecallProductTransactionTask
			Field Mapping uses ByTaskProduct
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.RecallNoticeTask = RecallNoticeTask
				related.RecallProduct	 = RecallProduct
				related.ActivityType	 = 4 
			Instance Selection
				where  (related.RecallProductTransaction.InventoryLocationGroup.InventoryCompany	= RecallOrganization.InventoryCompany
				and     related.RecallProductTransaction.InventoryLocationGroup.InventoryLocation	= RecallOrganization.InventoryLocation)
	
		PolinesrcTaskTransactionRel
			one-to-many relation to RecallProductTransactionTask
			Field Mapping uses ByTaskProduct
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.RecallNoticeTask = RecallNoticeTask
				related.RecallProduct	 = RecallProduct
				related.ActivityType	 = 14 
			Instance Selection
				where (related.RecallProductTransaction.RequestingLocationGroup.RequestingCompany		= RecallOrganization.InventoryCompany
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingLocation		= RecallOrganization.RequestingLocation)
	
		IssuesTaskTransactionRel
			one-to-many relation to RecallProductTransactionTask
			Field Mapping uses ByTaskProduct
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.RecallNoticeTask = RecallNoticeTask
				related.RecallProduct	 = RecallProduct
				related.ActivityType	 = 8 
			Instance Selection
				where (related.RecallProductTransaction.RequestingLocationGroup.RequestingCompany		= RecallOrganization.InventoryCompany
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingLocation		= RecallOrganization.RequestingLocation)
	
		RequisitionLineProductRel
			one-to-many relation to RecallProductTransaction
			Field Mapping uses symbolic key
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.RecallProduct	 = RecallProduct
			Instance Selection
				where (related.ActivityType	 = 1 
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingCompany		= RecallOrganization.InventoryCompany
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingLocation		= RecallOrganization.RequestingLocation)
	
		PurchaseOrderLineProductRel
			one-to-many relation to RecallProductTransaction
			Field Mapping uses symbolic key
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.RecallProduct	 = RecallProduct
			Instance Selection
				where (related.ActivityType	 = 4 
				and     related.RecallProductTransaction.InventoryLocationGroup.InventoryCompany	= RecallOrganization.InventoryCompany
				and     related.RecallProductTransaction.InventoryLocationGroup.InventoryLocation	= RecallOrganization.InventoryLocation)

		PolinesrcProductRel
			one-to-many relation to RecallProductTransaction
			Field Mapping uses symbolic key
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.RecallProduct	 = RecallProduct
			Instance Selection
				where (related.ActivityType	 = 14 
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingCompany		= RecallOrganization.InventoryCompany
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingLocation		= RecallOrganization.RequestingLocation)
	
		QuantitiesEnteredRel 
			one-to-many relation to RecallProductTaskItem
			Field Mapping uses ByOrganization
				related.RecallGroup				= RecallGroup
				related.Company                 = RecallOrganization.InventoryCompany
				related.InventoryLocation       = RecallOrganization.InventoryLocation
				related.RequestingLocation      = RecallOrganization.RequestingLocation
				related.RecallNotice            = RecallNotice
			Instance Selection
				where (related.HasQuantities)
		
		IssuesProductRel
			one-to-many relation to RecallProductTransaction
			Field Mapping uses symbolic key
				related.RecallGroup		 = RecallGroup
				related.RecallNotice	 = RecallNotice
				related.RecallProduct	 = RecallProduct
			Instance Selection
				where (related.ActivityType	 = 8 
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingCompany		= RecallOrganization.InventoryCompany
				and    related.RecallProductTransaction.RequestingLocationGroup.RequestingLocation		= RecallOrganization.RequestingLocation)
	
	Derived Fields
		RecallReceivedDate is a DerivedField
			type is Date
			return RecallNotice.RecallReceivedDate
		
		QuantityForTask is a DerivedField
			type is like Quantity
			return sum QuantitiesEnteredRel.QuantityIdentified 

		NumberOfPurchaseOrderLinesMessage is a LabelField
			"NumberOfPurchaseOrderLines"
		
		TaskPurchaseOrderLineCount is a DerivedField
			type is Numeric 3
			return (instance count of PurchaseOrderLineTaskTransactionRel)
		
		TaskPurchaseOrderLineTotRemQty is a DerivedField		
			type is like Quantity 			
			return (sum PurchaseOrderLineTaskTransactionRel.RecallProductTransaction.PurchaseOrderLineRel.DerivedStockRemainingQuantity)
			 
		TaskPurchaseOrderLineTotRecQty is a DerivedField		
			type is like Quantity 			
			return (sum PurchaseOrderLineTaskTransactionRel.RecallProductTransaction.PurchaseOrderLineRel.DerivedStockReceivedQuantity)
			 
		NumberOfRequisitionPurchaseOrderLinesMessage is a LabelField
			"NumberOfRequisitionPurchaseOrderLines"
			
		TaskPolinesrcCount is a DerivedField
			type is Numeric 3
			return (instance count of PolinesrcTaskTransactionRel)
		
		TaskPolinesrcTotalQuantity is a DerivedField		
			type is like Quantity 			
			return (sum PolinesrcTaskTransactionRel.RecallProductTransaction.PolinesrcRel.DerivedQuantity)
			 
		NumberOfRequisitionLinesMessage is a LabelField
			"NumberOfRequisitionLines"
		
		TaskRequisitionLineCount is a DerivedField
			type is Numeric 3
			return (instance count of RequisitionLineTaskTransactionRel)
		
		TaskRequisitionLineTotalQuantity is a DerivedField		
			type is like Quantity 			
			return (sum RequisitionLineTaskTransactionRel.RecallProductTransaction.ReqLineRel.DerivedStockQuantity)
			 
		NumberOfIssuesMessage is a LabelField
			"NumberOfIssues"
		
		TaskIssuesCount is a DerivedField
			type is Numeric 3
			return (instance count of IssuesTaskTransactionRel)
		
		TaskIssuesTotalQuantity is a DerivedField		
			type is like Quantity 			
			return (sum IssuesTaskTransactionRel.RecallProductTransaction.IssuesRel.DerivedStockIssueQuantity)
			 
		ProductPurchaseOrderLineCount is a DerivedField
			type is Numeric 3
			return (instance count of PurchaseOrderLineProductRel)
		
		ProductPurchaseOrderLineTotRemQty is a DerivedField		
			type is like Quantity 			
			return (sum PurchaseOrderLineProductRel.RecallProductTransaction.PurchaseOrderLineRel.DerivedStockRemainingQuantity)
			 
		ProductPurchaseOrderLineTotRecQty is a DerivedField		
			type is like Quantity 			
			return(sum PurchaseOrderLineProductRel.RecallProductTransaction.PurchaseOrderLineRel.DerivedStockReceivedQuantity)
			 
		ProductPolinesrcCount is a DerivedField
			type is Numeric 3
			return (instance count of PolinesrcProductRel)
		
		ProductPolinesrcTotalQuantity is a DerivedField		
			type is like Quantity 			
			return (sum PolinesrcProductRel.RecallProductTransaction.PolinesrcRel.DerivedQuantity)
			 
		ProductRequisitionLineCount is a DerivedField
			type is Numeric 3
			return (instance count of RequisitionLineProductRel)
		
		ProductRequisitionLineTotalQuantity is a DerivedField		
			type is like Quantity 			
			return (sum RequisitionLineProductRel.RecallProductTransaction.ReqLineRel.DerivedStockQuantity)		 
		ProductIssuesCount is a DerivedField
			type is Numeric 3
			return (instance count of IssuesProductRel)
		
		ProductIssuesTotalQuantity is a DerivedField		
			type is like Quantity 			
			return (sum IssuesProductRel.RecallProductTransaction.IssuesRel.DerivedStockIssueQuantity)
			 
		MultipleLocationsMessage is a MessageField
			"MultipleLocation"
		
		DerivedProductPOReqLoc is a DerivedField
			type is Alpha size 20
			TempReqLoc = first PurchaseOrderLineProductRel.RecallProductTransaction.PolinesrcRqlocRel.RequestingLocation
			for each PurchaseOrderLineProductRel
				for each each.RecallProductTransaction.PolinesrcRqlocRel
					if (each.RequestingLocation != TempReqLoc)
						TempReqLoc = MultipleLocationsMessage
						end for each
			return TempReqLoc
		
		DerivedTaskPOReqLoc is a DerivedField
			type is Alpha size 20
			TempReqLoc = first PurchaseOrderLineTaskTransactionRel.RecallProductTransaction.PolinesrcRqlocRel.RequestingLocation
			for each PurchaseOrderLineTaskTransactionRel
				for each each.RecallProductTransaction.PolinesrcRqlocRel
					if (each.RequestingLocation != TempReqLoc)
						TempReqLoc = MultipleLocationsMessage
						end for each
			return TempReqLoc

	Sets
		ByOrganization
			indexed
			Sort Order
				RecallGroup
				RecallOrganization
				RecallNotice
			
		ByRequestingLocation
			Sort Order
				RecallGroup
				RecallOrganization.RequestingLocation
				RecallOrganization
				RecallNotice
			
		ByInventoryLocation
			Sort Order
				RecallGroup
				RecallOrganization.InventoryLocation
				RecallOrganization
				RecallNotice
				
		ByCompany
			Sort Order
				RecallGroup
				RecallOrganization.InventoryCompany
				RecallOrganization
				RecallNotice
			
	Actions
		Create is a Create Action
			restricted
		
		Update is an Update Action
			restricted
			Action Rules
			
				if (FromProductTransactionQuery = true)
					FromManualTask = false					
		
		Delete is a Delete Action
			restricted
		
		Purge is a Purge Action
			restricted
