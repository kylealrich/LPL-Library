LeaseModificationFund is a BusinessClass
	owned by lm
	prefix is LeasM
	
	Ontology
		symbolic key is LeaseModificationFund
		
	Patterns
		implements StaticJava
		implements Archivable
		
	Persistent Fields
		LeaseFund						is Numeric 3
		Status							is Numeric 1
			States
				Unreleased	value is 1
				Released	value is 2
		ModificationDate				is Date
		Description
		AccountingEntity				
		AccountingUnit					
		Project			
		FinanceDimension1
		FinanceDimension2
		FinanceDimension3
		FinanceDimension4
		FinanceDimension5
		FinanceDimension6
		FinanceDimension7
		FinanceDimension8
		FinanceDimension9
		FinanceDimension10
		PercentContribution				is Percent size 9.6
			
	Transient Fields
			
	Local Fields
		LocalAccountingEntity			is like AccountingEntity
		LocalAccountingUnit				is like AccountingUnit
		LocalTotalPercentContribution	is Percent size 9.6
	
	Derived Fields
		WholeNumberPercent is a DerivedField
			type is Numeric 3		
			return (PercentContribution * 100)

		WholeNumberTotalPercent is a DerivedField
			type is Numeric 3		
			return (LocalTotalPercentContribution * 100)			

		AssetReleased is a DerivedField
			type is Boolean
			restricted
			if (LeaseAssetsRel exists)
				for each LeaseAssetsRel
					if (each.Status.Released)
						return true

	Conditions
			
		AccountingUnitIsFundDimension
			restricted
			when (Company.FinanceEnterpriseGroup.FundDimension = 1)				
        AccountingUnitSelected
        	when (AssetFundControlRel.AccountingUnit)
        ProjectSelected
        	when (AssetFundControlRel.Project)      	
		FinanceDimension1Selected
        	when (AssetFundControlRel.FinanceDimension1)
		FinanceDimension2Selected
        	when (AssetFundControlRel.FinanceDimension2)
		FinanceDimension3Selected
        	when (AssetFundControlRel.FinanceDimension3)
		FinanceDimension4Selected
        	when (AssetFundControlRel.FinanceDimension4)
		FinanceDimension5Selected
        	when (AssetFundControlRel.FinanceDimension5)
		FinanceDimension6Selected
        	when (AssetFundControlRel.FinanceDimension6)
		FinanceDimension7Selected
        	when (AssetFundControlRel.FinanceDimension7)
		FinanceDimension8Selected
        	when (AssetFundControlRel.FinanceDimension8)
		FinanceDimension9Selected
        	when (AssetFundControlRel.FinanceDimension9)
		FinanceDimension10Selected
        	when (AssetFundControlRel.FinanceDimension10)
		
	Relations
		AssetFundControlRel
			one-to-one relation to AssetFundControl
			Field Mapping uses symbolic key
				related.AssetFundControl		= Company.FinanceEnterpriseGroup
							
		LeaseModificationFundsRel
			one-to-many relation to LeaseModificationFund
			Field Mapping uses ByLeaseModificationFund
				related.Company					= Company
				related.Lease					= Lease
				related.LeaseModification	 	= LeaseModification

		LeaseAssetsRel
			one-to-many relation to Asset
            Field Mapping uses Set13
                related.FinanceEnterpriseGroup 	= Company.FinanceEnterpriseGroup
                related.AssetLease.LeaseCompany = Company
                related.AssetLease.Lease 		= Lease  

		OtherLeaseModificationFundsRel
			one-to-many relation to LeaseModificationFund
			Field Mapping uses symbolic key
				related.Company				= Company
				related.Lease				= Lease 
			Instance Selection
				where (related.LeaseModificationFund != LeaseModificationFund)

		LeaseExecutoryCostCodesRel is a LeaseExecutoryCostCode set								
	Sets
		ByLeaseModificationFund
			indexed
			Sort Order
				Company
				Lease
				LeaseModification
				LeaseFund
							
	Field Rules

	Rule Blocks

	Actions
		Create is an Action
			valid when (!AssetReleased)

			Field Rules
				PercentContribution
					required
						"PercentContributionIsRequired"
										
			Action Rules
				if (LeaseExecutoryCostCodesRel exists)  
					for each LeaseExecutoryCostCodesRel
						if (each.HasReleasedLeaseAllocationCode)
							invoke Update each
								invoked.LeaseAllocationCode	= blank
			Exit Rules
				LocalTotalPercentContribution = sum LeaseModificationFundsRel.PercentContribution
				if (WholeNumberTotalPercent > "100")
					constraint (false)
						"TheTotalPercentageForAllLeaseModificationFundsCannotBeMoreThan100.ItIs:<WholeNumberTotalPercent>"
				Status = "1"	
		Update is an Action
			valid when (!AssetReleased)
			Field Rules
				AccountingEntity
					cannot be changed
						"CannotBeChanged"	
				AccountingUnit
					cannot be changed
						"CannotBeChanged"
				Project
					cannot be changed
						"CannotBeChanged"
				FinanceDimension1
					cannot be changed
						"CannotBeChanged"
				FinanceDimension2
					cannot be changed
						"CannotBeChanged"
				FinanceDimension3
					cannot be changed
						"CannotBeChanged"
				FinanceDimension4
					cannot be changed
						"CannotBeChanged"
				FinanceDimension5						
					cannot be changed
						"CannotBeChanged"
				FinanceDimension6						
					cannot be changed
						"CannotBeChanged"
				FinanceDimension7
					cannot be changed
						"CannotBeChanged"
				FinanceDimension8
					cannot be changed
						"CannotBeChanged"
				FinanceDimension9						
					cannot be changed
						"CannotBeChanged"
				FinanceDimension10						
					cannot be changed
						"CannotBeChanged"
				PercentContribution
					required
						"PercentContributionIsRequired"
												
			Action Rules
		
			Exit Rules
				LocalTotalPercentContribution = sum LeaseModificationFundsRel.PercentContribution
				display "LocalTotalPercentContribution=<LocalTotalPercentContribution>"
				if (WholeNumberTotalPercent > "100")
					constraint (false)
						"TheTotalPercentageForAllLeaseModificationFundsCannotBeMoreThan100.ChangeResultsInAPercentageOf::<WholeNumberTotalPercent>"			
																
		RefreshFund is an Instance Action
			restricted
			Action Rules

		Release is an Instance Action
			restricted				
			Action Rules
				Status		= "2"
				
		ResetModification is an Instance Action
			restricted
			Action Rules
				invoke RestrictedCreate LeaseFund
					fill in fields from this instance
					invoked.Company					= Company
					invoked.Lease					= Lease
					invoked.LeaseFund				= LeaseFund
					invoked.AccountingEntity		= AccountingEntity
					invoked.AccountingUnit			= AccountingUnit
					invoked.Project					= Project									
					invoked.FinanceDimension1		= FinanceDimension1
					invoked.FinanceDimension2		= FinanceDimension2
					invoked.FinanceDimension3		= FinanceDimension3
					invoked.FinanceDimension4		= FinanceDimension4
					invoked.FinanceDimension5		= FinanceDimension5
					invoked.FinanceDimension6		= FinanceDimension6
					invoked.FinanceDimension7		= FinanceDimension7
					invoked.FinanceDimension8		= FinanceDimension8
					invoked.FinanceDimension9		= FinanceDimension9
					invoked.FinanceDimension10		= FinanceDimension10			
					invoked.PercentContribution		= PercentContribution				
				invoke DeleteFromAsset

		Delete is an Action
			valid when (!AssetReleased)
			Entrance Rules
			Exit Rules
			
		DeleteFromAsset is a Delete Action
			restricted	

		Purge is a Purge Action
			restricted
