SourceTotalPercentage is a BusinessClass
	owned by truecost
	
	prefix is TCSTP
	
	Ontology
		symbolic key is SourceTotalPercentage
		
	
	Patterns
		disable Auditing
		
	Persistent Fields	
		Ledger		
		AccountingEntity
		Account				is a GeneralLedgerChartAccount
		Department			is a TrueCostDepartment	
		TotalPercentage		is a Percent
 
	Field Rules
	
	Conditions
		IsGreater100
			restricted
			when (TotalPercentage > 1)
			
	Sets
		BySourceDepartment
			Sort Order
				TrueCostConfiguration
				TrueCostAllocationControl
				Ledger
				AccountingEntity
				Account
				Department	
				
		ByPercentage	
			not indexed
			Sort Order
				TrueCostConfiguration
				TrueCostAllocationControl
				TotalPercentage descending				
				Ledger
				AccountingEntity
				Account
				Department
		ByDepartment
			not indexed
			Sort Order
				TrueCostConfiguration
				TrueCostAllocationControl
				Department
				Ledger
				AccountingEntity
				Account
		ByAccount
			not indexed
			Sort Order
				TrueCostConfiguration
				TrueCostAllocationControl
				Account
				Ledger
				AccountingEntity
				Department
				
	Relations
		SourceAllocationLinePercentageRel			
			one-to-many relation to SourceAllocationLinePercentage
			Field Mapping uses symbolic key
				related.TrueCostConfiguration		= TrueCostConfiguration
				related.TrueCostAllocationControl	= TrueCostAllocationControl
				related.SourceTotalPercentage		= SourceTotalPercentage
		SourceAllocationLineRel
			one-to-many relation to SourceAllocationLine
			Field Mapping uses symbolic key
				related.TrueCostConfiguration		= TrueCostConfiguration
				related.TrueCostAllocationControl	= TrueCostAllocationControl
				related.SourceAllocationLine		= SourceAllocationLinePercentageRel.SourceAllocationLine
				
	Actions
		Create is an Action
			restricted
		Update is an Update Action
			restricted
		Delete is a Delete Action
			restricted
		Purge is a Purge Action
			restricted
					
		PurgeAllSourceTotalPercentage is a Set Action
			restricted			
			run in foreground			
			Parameters
				PrmTrueCostConfiguration					is a TrueCostConfiguration
				PrmTrueCostAllocationControl 				is a TrueCostAllocationControl

			Parameter Rules
				PrmTrueCostAllocationControl
					required

			Instance Selection
				where(SourceTotalPercentage.TrueCostConfiguration 	= PrmTrueCostConfiguration
				and SourceTotalPercentage.TrueCostAllocationControl = PrmTrueCostAllocationControl)
			
			Action Rules
				Instance Rules
					invoke Purge
