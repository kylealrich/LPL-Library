PfiWorkunitState is a BusinessClass
    owned by pfi
    prefix is PfiWS
    contains environment data // TODO - This likely can be removed since "disable data area copy" has been added, once that pattern is fully implemented.
    disable data area copy
    default label is "WorkUnitState"

    Patterns
        disable AsOfDateProcessing
        disable EffectiveDated
        disable Auditing

    Ontology
        symbolic key is PfiWorkunitState

    Derived Fields

        WorkunitsInStateCount is a ComputeField
            type is Decimal 10
            default label is "WorkUnitsInState"
            (instance count of PfiWorkunitsInStateRel)

        WorkunitsInStateCountText is a DerivedField
            type is Numeric 10
            default label is "WorkUnitsInStateCountText"
            return WorkunitsInStateCount

    Relations

        PfiWorkunitsInStateRel
            one-to-many relation to PfiWorkunit
            Field Mapping uses ByStatusWorkunitLive
                related.Status = PfiWorkunitState

        PfiWorkunitNotReadyStateRel
            one-to-one relation to PfiWorkunitState
            Field Mapping uses symbolic key
                related.Actor = actor
                related.PfiWorkunitState = PfiWorkunitState.NotReady

        PfiWorkunitReadyStateRel
            one-to-one relation to PfiWorkunitState
            Field Mapping uses symbolic key
                related.Actor = actor
                related.PfiWorkunitState = PfiWorkunitState.Ready

        PfiWorkunitProcessingStateRel
            one-to-one relation to PfiWorkunitState
            Field Mapping uses symbolic key
                related.Actor = actor
                related.PfiWorkunitState = PfiWorkunitState.Processing

        PfiWorkunitFailedStateRel
            one-to-one relation to PfiWorkunitState
            Field Mapping uses symbolic key
                related.Actor = actor
                related.PfiWorkunitState = PfiWorkunitState.Failed

        PfiWorkunitCompletedStateRel
            one-to-one relation to PfiWorkunitState
            Field Mapping uses symbolic key
                related.Actor = actor
                related.PfiWorkunitState = PfiWorkunitState.Completed

        PfiWorkunitCancelingStateRel
            one-to-one relation to PfiWorkunitState
            Field Mapping uses symbolic key
                related.Actor = actor
                related.PfiWorkunitState = PfiWorkunitState.Canceling

        PfiWorkunitCanceledStateRel
            one-to-one relation to PfiWorkunitState
            Field Mapping uses symbolic key
                related.Actor = actor
                related.PfiWorkunitState = PfiWorkunitState.Canceled

    Actions

        Create is a Create Action

        AddStateToChart is a Create Action

        AddAllStatesToChart is a Set Action
            run in foreground

            Rule Blocks
                AddMissingStates
                    if (not PfiWorkunitNotReadyStateRel exists)
                        invoke Create PfiWorkunitState
                            invoked.Actor = actor
                            invoked.PfiWorkunitState = PfiWorkunitState.NotReady

                    if (not PfiWorkunitReadyStateRel exists)
                        invoke Create PfiWorkunitState
                            invoked.Actor = actor
                            invoked.PfiWorkunitState = PfiWorkunitState.Ready

                    if (not PfiWorkunitProcessingStateRel exists)
                        invoke Create PfiWorkunitState
                            invoked.Actor = actor
                            invoked.PfiWorkunitState = PfiWorkunitState.Processing

                    if (not PfiWorkunitFailedStateRel exists)
                        invoke Create PfiWorkunitState
                            invoked.Actor = actor
                            invoked.PfiWorkunitState = PfiWorkunitState.Failed

                    if (not PfiWorkunitCompletedStateRel exists)
                        invoke Create PfiWorkunitState
                            invoked.Actor = actor
                            invoked.PfiWorkunitState = PfiWorkunitState.Completed

                    if (not PfiWorkunitCancelingStateRel exists)
                        invoke Create PfiWorkunitState
                            invoked.Actor = actor
                            invoked.PfiWorkunitState = PfiWorkunitState.Canceling

                    if (not PfiWorkunitCanceledStateRel exists)
                        invoke Create PfiWorkunitState
                            invoked.Actor = actor
                            invoked.PfiWorkunitState = PfiWorkunitState.Canceled

            Action Rules

                Empty Set Rules
                    include AddMissingStates

                Set Rules
                    Entrance Rules
                        include AddMissingStates

        Update is an Update Action

        Delete is a Delete Action

        RemoveStateFromChart is a Delete Action
