IONDocument is a BusinessClass
    owned by la
    prefix is iond
    
    Ontology
        symbolic key is IONDocument

    Patterns
		implements ExtendsExternalData
			using com.lawson.rdtech.framework.ion.IONDocumentStorage
		implements ConfigurationMetadata			
    	
	Persistent Fields
		DocumentName is Alpha size 200
		LogicalId is an IONLogicalId
		Send is Boolean
		SendConfirm is Boolean
    	
    Conditions
    	Import 
    		when (IONDocumentProcessorRel exists)
    		
    	ImportIMS
    		when (ActiveIMSDocumentProcessorRel exists)
    		
    	SendIMS
    		when (Send
    		or   (Replicate and not SchemaRegistrationRequired))
    		
    	Discovery
    		when (ActiveIMSDocumentProcessorRel exists
    		or    Send
    		or    (Replicate and (IncludeUnregisteredReplications or not SchemaRegistrationRequired)))
    		
    	RegisteredReplicate
    		when (IncludeUnregisteredReplications or not SchemaRegistrationRequired)
    	
    Transient Fields
    	InputLogicalId is an IONLogicalId
    		derive value from DerivedLogicalId
    		
    	InputDocumentName is Alpha size 200
    		derive value from DerivedDocumentName
    		
    Derived Fields
    	Implicit is a NativeField
    		type is Boolean
    		
    	Replicate is a NativeField
    		type is Boolean
    		
    	SchemaRegistrationRequired is a NativeField
    		type is Boolean
    		
    	SupportedEncodings is a NativeField
    		type is Alpha size 200
    		
		IncludeUnregisteredReplications is a NativeField
			type is Boolean    
				
		DefaultLogicalId is a NativeField
			type is like IONLogicalId
			
		TransformedLogicalId is a NativeField
			type is like IONLogicalId
			
		DerivedDocumentName is a DerivedField		
			type is Alpha size 100
			if (DocumentName = blank)
				return IONDocument
			else
				return DocumentName	
				
		DerivedLogicalId is a DerivedField			
			type is like IONLogicalId
			if (LogicalId = blank)
				return DefaultLogicalId
			else
				return LogicalId
				
		HasMultipleLogicalIds is a NativeField
			type is Boolean
			default label is "MultipleLogicalIdsExist"
			
		LogicalIdExists is a NativeField
			type is Boolean
			
		DefaultSendConfirm is a NativeField
			type is Boolean
			
		DerivedSendConfirm is a DerivedField
			type is Boolean
			if (DefaultSendConfirm)
				return true
			else
				return SendConfirm
			
	Relations
		IONDocumentProcessorRel
			one-to-many relation to IONDocumentProcessor
			Field Mapping uses symbolic key
			Instance Selection
				where (related.IONDocumentProcessor.IONDocument = IONDocument)
				
		IMSDocumentProcessorRel
			one-to-many relation to IONDocumentProcessor
			Field Mapping uses symbolic key
			Instance Selection
				where (related.IONDocumentProcessor.IONDocument = IONDocument
				and    related.IONDocumentProcessor.DerivedConnection = 2)
			
		ActiveIMSDocumentProcessorRel
			one-to-many relation to IONDocumentProcessor
			Field Mapping uses symbolic key
			Instance Selection
				where (related.IONDocumentProcessor.IONDocument = IONDocument
				and    related.IONDocumentProcessor.DerivedConnection = 2
				and    related.IONDocumentProcessor.Status.Active)
				
		IMSDocumentsRel
			one-to-many relation to IONDocument
			Field Mapping uses symbolic key
			Instance Selection
				where (related.Discovery)
				
		IONDocumentNameRel
			one-to-many relation to IONDocument
			Field Mapping uses symbolic key
			Instance Selection
				where (related.DerivedLogicalId = DerivedLogicalId
				and    related.DerivedDocumentName = DerivedDocumentName)
	
    Actions
    	Create is a Create Action
    		Action Rules
				if (InputLogicalId entered)
					LogicalId = InputLogicalId
					
				LogicalId = TransformedLogicalId
				
				if (LogicalId = DefaultLogicalId)
					LogicalId = blank 
				
				if (InputDocumentName entered)
					DocumentName = InputDocumentName
					
				if (DocumentName = IONDocument)
					DocumentName = blank		
				
	    		constraint (DocumentName size < 101)
	    			"DocumentNameLimitedToALengthOf100"
    			
	    		constraint (DocumentName != blank or IONDocument size < 101)
	    			"DocumentNameLimitedToALengthOf100" 
    		
    			constraint (not IONDocumentNameRel exists)
					"DuplicateDocumentNameForLogicalID"	
			
    	Delete is a Delete Action
    		valid when (not Implicit)
    		
    	Update is an Update Action
    		Action Rules
				if (InputLogicalId entered)
					LogicalId = InputLogicalId
					
				LogicalId = TransformedLogicalId
				
				if (LogicalId = DefaultLogicalId)
					LogicalId = blank 
				
				if (InputDocumentName entered)
					DocumentName = InputDocumentName
					
				if (DocumentName = IONDocument)
					DocumentName = blank		
				
	    		constraint (DocumentName size < 101)
	    			"DocumentNameLimitedToALengthOf100"
    			
	    		constraint (DocumentName != blank or IONDocument size < 101)
	    			"DocumentNameLimitedToALengthOf100" 
    		
    			constraint (not IONDocumentNameRel exists or IONDocumentNameRel.IONDocument = IONDocument)
					"DuplicateDocumentNameForLogicalID"	
  
													
								    			
		
		    		
		
	
