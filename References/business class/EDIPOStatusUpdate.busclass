EDIPOStatusUpdate is a BusinessClass
    owned by edi
    prefix is POSU

    Ontology
        symbolic key is EDIPOStatusUpdate 

    Patterns
        implements StaticJava
        disable StaticTranslations
        disable Auditing
        disable AuditIndex

    Persistent Fields
        Company                 is like InventoryCompany
        PurchaseOrder           is like PurchaseOrder
        PurchaseOrderRevision   is like PurchaseOrderRevision
        DataExchangeId			is like EDIDataExchange
        Commstat                is like ProcessStatus
            default label is "CommunicationStatus"

    Transient Fields

    Derived Fields
        DerivedCommStat is a DerivedField
            type is Numeric size 1
            if (Commstat = ProcessStatus.Success or Commstat = ProcessStatus.Warning)
                return 1
            else 
            if (Commstat = ProcessStatus.Error)
                return 2
            else
                return 0
                
        DerivedTransmissionMessage is a DerivedField
            type is Alpha size 30
            if (Commstat = ProcessStatus.New or Commstat = ProcessStatus.Processing)
                return "Waiting"
            else
            if (Commstat = ProcessStatus.Warning)
                return "Warning"
            else
                return ""
        

    Local Fields
    
    Field Rules
        Commstat
            default to ProcessStatus.New

    Context Fields

    Rule Blocks

    Relations
        PurchaseOrderRevisionRel 	
    		one-to-one relation to PurchaseOrderRevision
    		Field Mapping uses symbolic key
    			related.Company  				= Company
				related.PurchaseOrder 			= PurchaseOrder
				related.PurchaseOrderRevision 	= PurchaseOrderRevision

    Conditions

    Sets
        Set1
			indexed
			Sort Order	
				DataExchangeId
				EDIPOStatusUpdate

    Actions
        Create is a Create Action
            restricted
            Action Rules
                if (PurchaseOrderRevisionRel exists)
                    invoke Update PurchaseOrderRevisionRel
                        invoked.TransmissionDate            = current timestamp
                        invoked.TransmissionStatus          = 0
                        invoked.TransmissionMessage         = "Waiting"
            Exit Rules
            
        Delete is a Delete Action
            restricted
        Update is an Update Action
            restricted
            Action Rules
                if (PurchaseOrderRevisionRel exists)
                    invoke Update PurchaseOrderRevisionRel
                        invoked.TransmissionDate		    = current timestamp
                        invoked.TransmissionStatus		    = DerivedCommStat
                        invoked.TransmissionMessage         = DerivedTransmissionMessage
            Exit Rules
