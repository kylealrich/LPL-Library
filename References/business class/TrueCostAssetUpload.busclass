TrueCostAssetUpload is a BusinessClass
	owned by truecost
	
	prefix is TCAU
	default label is "True\CostAssetInformation"
	Ontology
		symbolic key is TrueCostAssetUpload
		
	Patterns
	
	Persistent Fields
		
		Description
		AccountingUnit							is AlphaUpper 15
		AssetAccountingUnitGroup				is AlphaUpper 10
		
	Derived Fields
	
	Field Rules	

	Conditions
		
			
	Relations
		TrueCostAssetBookPeriodRel
			one-to-many relation to TrueCostAssetBookPeriod
			Field Mapping uses symbolic key
			Instance Selection
				where(related.TrueCostAssetBookPeriod.Company		=	TrueCostAssetUpload.Company
				and related.TrueCostAssetBookPeriod.Asset			=	TrueCostAssetUpload.Asset)
				
		TrueCostAssetUploadRel
			one-to-many relation to TrueCostAssetUpload
			Field Mapping uses symbolic key
			Instance Selection
				where(related.TrueCostAssetUpload.Company		=	TrueCostAssetUpload.Company
				and related.TrueCostAssetUpload.Asset			=	TrueCostAssetUpload.Asset)
				
		TrueCostAssetUploadDeleteRel
			one-to-many relation to TrueCostAssetUpload
			Field Mapping uses symbolic key
			Instance Selection
				where(related.TrueCostAssetUpload.Company		=	LocalCompany
				and related.TrueCostAssetUpload.Asset			=	LocalAsset)
						
	
	Local Fields
		LocalErrorMessage						is Boolean
		LocalCompany							is Alpha 50
		LocalAsset								is Alpha 50
			
	Actions
		Create is a Create Action

		Update is an Action
			restricted
		Delete is a Delete Action
		
			
		Purge is a Purge Action
			restricted
										
		LoadToTrueCostAssetManagementInterface is a Set Action
			default label is "Load_toTrue\CostAssetManagementInterface"




								
			Action Rules

				Instance Rules
					LocalAsset 		= last TrueCostAssetBookPeriodRel.TrueCostAssetBookPeriod.Asset
					LocalCompany	= last TrueCostAssetBookPeriodRel.TrueCostAssetBookPeriod.Company




					for each TrueCostAssetBookPeriodRel
						if (!LocalErrorMessage)
							invoke Create TrueCostAssetManagementInterface
								resume on error
									LocalErrorMessage = error message
								fill in fields from each								

								invoked.TrueCostConfiguration						=	TrueCostAssetUploadRel.TrueCostAssetUpload.FinanceEnterpriseGroup
								invoked.AccountingEntity							=	TrueCostAssetUploadRel.TrueCostAssetUpload.Company

								invoked.AssetAccountingUnitGroup					=	TrueCostAssetUploadRel.AssetAccountingUnitGroup							
								invoked.Asset										=	TrueCostAssetUploadRel.TrueCostAssetUpload.Asset
								invoked.CurrentPeriodDepreciation					=	each.TrueCostAssetBookPeriod.CurrentPeriodDepreciation
								invoked.YearEndDate									=	each.TrueCostAssetBookPeriod.YearEndDate
								invoked.Period										=	each.TrueCostAssetBookPeriod.AssetBookPeriodHistory
								
						if(!LocalErrorMessage)
							invoke Purge TrueCostAssetBookPeriodRel
					if(TrueCostAssetBookPeriodRel not exist)
						invoke Purge TrueCostAssetUploadDeleteRel					
