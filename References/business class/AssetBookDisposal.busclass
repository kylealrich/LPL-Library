AssetBookDisposal is a BusinessClass
    owned by am
    prefix is ABD
    classic name is AMASTBKDSP

    Ontology
        symbolic key is AssetBookDisposal
            classic set name is ABDSET1

    Patterns
    	implements ContextualParent
        implements StaticJava
        disable AuditIndex
        
        implements TemplateDriven by AssetBook
			create instance
				when (AssetBookRel.Book entered)

    Persistent Fields
        CostOfSale                     is an InternationalAmount
            classic name is BOOK-COST-SALE
            precision is DerivedNumberOfDecimals
        CostOfSaleOverride             is an InternationalAmount
            classic name is CST-SALE-OVRRD
			precision is DerivedNumberOfDecimals
        Proceeds                       is an InternationalAmount
            classic name is BOOK-PROCEEDS
            precision is DerivedNumberOfDecimals
        ProceedsOverride               is an InternationalAmount
            classic name is PROCEEDS-OVRRD
			precision is DerivedNumberOfDecimals
        GainOrLoss                     is an InternationalAmount
            classic name is GAIN-LOSS
            precision is DerivedNumberOfDecimals
        GainOrLossOverride             is an InternationalAmount
            classic name is GN-LS-OVERRIDE
        DeferredGainOrLoss             is an InternationalAmount
            classic name is DEFER-GN-LS
            precision is DerivedNumberOfDecimals
        DeferredGainOrLossOverride     is an InternationalAmount
            classic name is DEFER-OVERRIDE
        TaxCreditRecapture             is an InternationalAmount
            classic name is TC-RECAPTURE
        TaxCreditRecaptureOverride     is an InternationalAmount
            classic name is TC-OVERRIDE
        Basis                          is an InternationalAmount
            classic name is BOOK-BASIS
        TransactionNumberOfDecimals    is a CurrencyNumberOfDecimals
            classic name is TRAN-ND
        DepreciationExpense            is an InternationalAmount
            classic name is DSP-DEPR
            precision is DerivedNumberOfDecimals
        DepreciationExpenseOverride    is an InternationalAmount
            classic name is DSP-DEPR-OVRRD
			precision is DerivedNumberOfDecimals
        YearToDateDepreciation         is an InternationalAmount
            classic name is DEPR-YTD
            	precision is AssetBookRel.TransactionNumberOfDecimals
        YearToDateDepreciationAllowed  is an InternationalAmount
            classic name is DEPR-YTD-ALLOW
            	precision is AssetBookRel.TransactionNumberOfDecimals
        YearToDateDepreciationOverride is an InternationalAmount
            classic name is DEPR-YTD-OVRRD
				precision is AssetBookRel.TransactionNumberOfDecimals
        LifeToDateDepreciation         is an InternationalAmount
            classic name is DEPR-LTD
            	precision is AssetBookRel.TransactionNumberOfDecimals
        LifeToDateDepreciationAllowed  is an InternationalAmount
            classic name is DEPR-LTD-ALLOW
            	precision is AssetBookRel.TransactionNumberOfDecimals
        SalvageValue                   is an InternationalAmount
        	precision is AssetBookRel.TransactionNumberOfDecimals
        FirstYearExpenseAmount         is an InternationalAmount
            classic name is YR1-EXP
        TaxCreditPropertyAmount        is an InternationalAmount
            classic name is TC-PROPERTY
        TaxCredit                      is an InternationalAmount
        ActualInsuranceValue           is an InternationalAmount
            classic name is INS-ACT-VAL
        CalculatedInsuranceValue       is an InternationalAmount
            classic name is INS-CMPTD-VAL
        CalculatedReplacementValue     is an InternationalAmount
            classic name is RPL-CMPTD-VAL
        NewAssetBasis                  is an InternationalAmount
            classic name is NEW-AST-BASIS
        CashPaid                       is an InternationalAmount
        OldAssetAdjustedBasis          is an InternationalAmount
            classic name is OLD-AST-ADJ-BS
        AmountRealized                 is an InternationalAmount
            classic name is AMT-REALIZED
        AmountGivenUp                  is an InternationalAmount
            classic name is AMT-GIVEN-UP
        NewAssetAdjustedBasis          is an InternationalAmount
            classic name is NEW-AST-ADJ-BS
        NewAsset                       is an Asset
		AssetDisposal				   is like Sequence 		
		Dispose						   is Boolean
		SelectedForReinstatement	   is Boolean

	Local Fields
		LocalBook						is a Book
		LocalAsset						is an Asset
		LocalBasis						is an InternationalAmount
		LocalNetBasis					is an InternationalAmount
		DeprChg							is an InternationalAmount


		LocalCtrlConsolJEFlag			is Boolean
		LocalAssetACMAmt				is an InternationalAmount
		LocalPurge						is Boolean
		LocalJEExist					is Boolean

		CalcBasis						is an InternationalAmount
		LocalTransactionDate			is Date



		LocalDisposalDate				is Date
		LocalTransactionAmount			is an InternationalAmount
		RevalueEliminationAmount		is an InternationalAmount
		LocalRevalueAmortizationEntries	is an InternationalAmount
		LocalImpairmentAmountForDisposal is an InternationalAmount

		LocalFinanceEnterpriseGroup		is like FinanceEnterpriseGroup
		LocalNetProceeds				is an InternationalAmount		
		LocalPostingDate				is Date	

		
	Transient Fields	
        TransientDisposalDate			is Date
        	derive value from AssetDisposalRel.DisposalDate
			default label is "DisposalDate"
        TransientUpdateFromBatch		is Boolean		
		4797Part						is Numeric 1
			derive value from Derived4797Part
			States
				Part1				value is 1 
				Part2				value is 2        
				Part3 				value is 3

	Field Rules
	
		DeferredGainOrLoss
			if (GainOrLossOverride > 0) 
				constraint (DeferredGainOrLoss <= GainOrLoss)
					"DeferredGainLossCannotExceedGainLoss" 
			
			if (GainOrLossOverride < 0)
				constraint (DeferredGainOrLoss >= GainOrLoss)
					"DeferredGainLossCannotExceedGainLoss" 
			
			if (GainOrLossOverride > 0)
				constraint (DeferredGainOrLoss >= 0)
					"DisposalIsAGain,CannotEnterADeferredLoss"
				
			if (GainOrLossOverride < 0)
				constraint (DeferredGainOrLoss <= 0)
					"DisposalIsALoss,CannotEnterADeferredGain" 
				
			if (AssetAccountGroupRel exists)
				constraint (AssetAccountGroupRel.AssetAccountDGNRel.DistributionAccount entered)
					"DeferredGainAccountNotInAccountGroup" 
					
			if (AssetAccountGroupRel exists)
				constraint (AssetAccountGroupRel.AssetAccountDLSRel.DistributionAccount entered)
					"DeferredLossAccountNotInAccountGroup" 
				

	Context Fields
		DateRangeFilter					is a DateRange
		CompanyGroup					is a GeneralLedgerCompanyGroup		

		
    Derived Fields

        DisposedAsset                     is a StringField
            type is Alpha size 10
            restricted
            classic name is AST-DSP-ASSET
            Asset.DisposedAsset

        AssetTransferAssetGroup           is a StringField
            type is Alpha size 10
            restricted
            classic name is AST-ASSET-GRP
            Asset.AssetGroup

        AssetTagNumber                    is a StringField
            type is Alpha size 12
            restricted
            classic name is AST-TAG-NBR
            Asset.TagNumber

        AssetDescription                  is a StringField
            type is Alpha size 30
            restricted
            classic name is AST-DESCRIP
            Asset.Description

        AssetDisposalDate                 is a StringField
            type is Alpha size 8
            restricted
            classic name is ASD-DSP-DATE
            AssetDisposalRel.DisposalDate

        AssetDisposalFullOrPartial        is a StringField
            type is Alpha size 1
            restricted
            classic name is ASD-FULL-PART
            AssetDisposalRel.FullOrPartial

        AssetDisposalMethod               is a StringField
            type is Alpha size 1
            restricted
            classic name is ASD-DSP-METH
            AssetDisposalRel.DisposalMethod

        AssetDisposalDisposalProperty     is a StringField
            type is Alpha size 10
            restricted
            classic name is ASD-DSP-PROP
            AssetDisposalRel.DisposalProperty

        BookCurrency                      is a StringField
            type is Alpha size 5
            restricted
            Book.Currency

        AssetDisposalCreateDate           is a StringField
            type is Alpha size 8
            restricted
            classic name is DSP-CREAT-DATE
            AssetDisposalRel.CreationDate

        AssetDisposalCreateTime           is a StringField
            type is Alpha size 6
            restricted
            classic name is DSP-CREAT-TIME
            AssetDisposalRel.CreationDate time

        AssetDisposalCreatedBy            is a StringField
            type is Alpha size 10
            restricted
            classic name is DSP-CREATOR-ID
            AssetDisposalRel.CreatedBy

        AssetBookDisposalBookDescription  is a StringField
            type is Alpha size 30
            restricted
            classic name is AMB-DESC
            Book.Description

        AssetBookBasis                    is a StringField
            type is Alpha size 15
            restricted
            classic name is ASB-BOOK-BASIS
            AssetBookRel.Basis

        AssetBookMethod                   is a StringField
            type is Alpha size 10
            restricted
            classic name is ASB-METHOD
            AssetBookRel.Method

        AssetBookLife                     is a StringField
            type is Alpha size 4
            restricted
            classic name is ASB-LIFE
            AssetBookRel.Life

        AssetBookLifeRemaining            is a StringField
            type is Alpha size 7
            restricted
            classic name is ASB-LIFE-REM
            AssetBookRel.LifeRemaining

        AssetBookInServiceDate            is a StringField
            type is Alpha size 8
            restricted
            classic name is ASB-INSRV-DATE
            AssetBookRel.InServiceDate

        AssetBookConvention               is a StringField
            type is Alpha size 2
            restricted
            classic name is ASB-CONVENTION
            AssetBookRel.Convention

        LifeToDateDepreciationCalculation 	is a DerivedField		
            type is like InternationalAmount
            restricted 						
            classic name is CALC-DEPR-LTD


            return (LifeToDateDepreciation + DepreciationExpenseOverride)

        DisposalNetValue					is a DerivedField		
            type is like InternationalAmount
            restricted 						
            classic name is DSP-NET-VALUE
            return (Basis - LifeToDateDepreciationCalculation)
            
 		NetBookValue                 		 is a DerivedField		
            type is like InternationalAmount
            restricted 						
            classic name is DSP-NET-VALUE
            return (Basis - SalvageValue)  
            
        DepreciationLTDOverRide				is a DerivedField		
        	type is like InternationalAmount
        	restricted 						
            classic name is DSP-NET-VALUE


			return (DepreciationExpenseOverride - LifeToDateDepreciation)       

        AssetLocation                    	is a StringField
            type is Alpha size 15
            restricted
            classic name is AST-LOCATION
            Asset.AssetLocation

        AssetDivision                     is a StringField
            type is Alpha size 15
            restricted
            classic name is AST-DIVISION
            Asset.AssetDivision

        AstType                           is a StringField
            type is Alpha size 10
            restricted
            Asset.AssetType.Type

        AssetSubtype                      is a StringField
            type is Alpha size 10
            restricted
            classic name is AST-SUBTYPE
            Asset.AssetType.SubType
        
        AssetTransactionSum				is a DerivedField
        	type is like InternationalAmount
        	restricted
        	if (IsPostingBook)
	        	return sum DisposalAssetTransactionRel.TransactionAmount 
    		else	
    			return sum DisposalAssetBookTransactionsRel.TransactionAmount
    			
    			        
        AssetASTAmt 							is a DerivedField		
        	type is like InternationalAmount
        	restricted 						
            classic name is AMWS-AST-AMT
			if (Basis  entered
			and AssetDisposalRel.DisposalMethod.Purged)
				return (Basis * -1)
			else
				return ((Basis - (AssetTransactionSum * -1))  * -1)

        AssetBKASTAmt 							is a DerivedField		
        	type is like InternationalAmount
        	restricted 						
            classic name is AMWS-AST-AMT
			if (Basis  entered)

				return (Basis * -1)


			
		AssetACMAmt 							is a DerivedField	
        	type is like InternationalAmount
        	restricted 							
            classic name is AMWS-ACM-AMT






			return (LifeToDateDepreciation - DepreciationExpenseOverride + FirstYearExpenseAmount)
			
		AssetEXPAmt 							is a DerivedField	
        	type is like InternationalAmount
        	restricted 							
            classic name is AMWS-EXP-AMT


			return (DepreciationExpenseOverride)
			
		AssetPROAmt								is a DerivedField		
        	type is like InternationalAmount
        	restricted 							
            classic name is AMWS-PRO-AMT
            return (ProceedsOverride * 1)
			
		AssetCOSAmt								is a DerivedField	
        	type is like InternationalAmount
        	restricted 							
            classic name is AMWS-COS-AMT
            return (CostOfSaleOverride * -1)
			
		AssetGANAmt								is a DerivedField
        	type is like InternationalAmount
        	restricted
            classic name is AMWS-GAN-AMT
			if (Basis > 0)
				if (GainOrLoss > 0)
					return GainOrLoss * -1
			else
				if (GainOrLoss < 0)
					return GainOrLoss * -1	
					
		AssetLOSAmt								is a DerivedField 
        	type is like InternationalAmount
        	restricted
            classic name is AMWS-LOS-AMT
			if (Basis > 0)
				if (GainOrLoss < 0)
					return GainOrLoss * -1
			else
				if (GainOrLoss > 0)
					return GainOrLoss * -1	
					
		AssetDGNAmt								is a DerivedField
        	type is like InternationalAmount

            classic name is AMWS-DGN-AMT
            if (Basis > 0)
            	if (DeferredGainOrLoss > 0)
            		return DeferredGainOrLoss * -1
	        else
	            if (DeferredGainOrLoss < 0)
	    	    	return DeferredGainOrLoss * -1
    	       		
		AssetDLSAmt								is a DerivedField 
        	type is like InternationalAmount

            classic name is AMWS-DLS-AMT
            if (Basis > 0)
            	if (DeferredGainOrLoss < 0)
            		return DeferredGainOrLoss * -1
            else
            	if (DeferredGainOrLoss > 0)
    	       		return DeferredGainOrLoss * -1
    	       		
		AssetCLRAmt								is a DerivedField 
			type is like InternationalAmount
			restricted
			classic name is AMWS-CLR-AMT
			if (Basis  entered
			and AssetDisposalRel.DisposalMethod.Purged)
				return Basis

				
	   	DerivedTotalDisposalSelectedQuantity	is a DerivedField 
			type is Numeric 15
			return AssetDisposalRel.TotalDisposalSelectedQuantity
	   		         		 
		DerivedDisposalQuantity					is a DerivedField 
			type is Numeric 15
			return AssetDisposalRel.DisposalQuantity	
			
    	DerivedCurrency						is a DerivedField
    		type is like Currency
    		restricted
   			if (Book.PostCurrency.Book)
				return Book.Currency
			else
				return Asset.Currency 

    	DerivedNumberOfDecimals				is a DerivedField
    		type is like CurrencyNumberOfDecimals
    		restricted
   			if (Book.PostCurrency.Book)
				return Book.Currency.NumberOfDecimals
			else
				return Asset.Currency.NumberOfDecimals
				
		RevalueAmountForDisposal			is a DerivedField
			type is like InternationalAmount
        	if (IsPostingBook)


        		if (AssetDisposalRel.FullDisposal)


        			return (sum RevalueTransactionsRel.TransactionAmount)	
	        	else
	        		return ((sum RevalueTransactionsRel.TransactionAmount) * (1 - (NewAssetBasis / Basis)))
    		else	


        		if (AssetDisposalRel.FullDisposal)
        			return (sum RevalueBookTransactionsRel.TransactionAmount) 
    			else
    				return ((sum RevalueBookTransactionsRel.TransactionAmount) * (1 - (NewAssetBasis / Basis)))				
				
		RevaluationAmountForDisposal			is a DerivedField
			type is like InternationalAmount
        	if (IsPostingBook)
        		if (AssetDisposalRel.FullDisposal)
        			return ((sum RevalueTransactionsRel.TransactionAmount) + (sum RevalueAmortTransactionsRel.TransactionAmount) - LocalRevalueAmortizationEntries)	
	        	else
	        		return ((((sum RevalueTransactionsRel.TransactionAmount) + (sum RevalueAmortTransactionsRel.TransactionAmount)) * (Basis / OriginalAssetBookRel.Basis)) - LocalRevalueAmortizationEntries)
    		else	
        		if (AssetDisposalRel.FullDisposal)
        			return ((sum RevalueBookTransactionsRel.TransactionAmount) + (sum RevalueAmortBookTransactionsRel.TransactionAmount) - LocalRevalueAmortizationEntries)
    			else
    				return ((((sum RevalueBookTransactionsRel.TransactionAmount) + (sum RevalueAmortBookTransactionsRel.TransactionAmount)) * (Basis / OriginalAssetBookRel.Basis)) - LocalRevalueAmortizationEntries)				
		
		ImpairmentAmountForDisposal			is a DerivedField
			type is like InternationalAmount
			if (IsPostingBook)
        		if (AssetDisposalRel.FullDisposal)
        			return ((sum ImpairmentILTransactionsRel.TransactionAmount) + (sum ImpairmentAATransactionsRel.TransactionAmount) - DepreciationExpenseOverride)
	        	else
	        		return ((((sum ImpairmentILTransactionsRel.TransactionAmount) + (sum ImpairmentAATransactionsRel.TransactionAmount)) * (Basis / OriginalAssetBookRel.Basis)) - DepreciationExpenseOverride)
    		else
    			if (AssetDisposalRel.FullDisposal)
        			return ((sum ImpairmentILBookTransactionsRel.TransactionAmount) + (sum ImpairmentAABookTransactionsRel.TransactionAmount) - DepreciationExpenseOverride)
    			else
    				return ((((sum ImpairmentILBookTransactionsRel.TransactionAmount) + (sum ImpairmentAABookTransactionsRel.TransactionAmount)) * (Basis / OriginalAssetBookRel.Basis)) - DepreciationExpenseOverride)				
		
		RevalueAmortizationEntries is a DerivedField
			type is like InternationalAmount
			if (RevaluePriorDisposal)
				if (IsPostingBook)
					if (AssetDisposalRel.FullDisposal)
						return (sum PriorRevalueRATransactionsRel.TransactionAmount)
					else
						return ((sum PriorRevalueRATransactionsRel.TransactionAmount) * (Basis / OriginalAssetBookRel.Basis))
				else
					if (AssetDisposalRel.FullDisposal)
						return (sum PriorRevalueRABookTransactionsRel.TransactionAmount)
					else
						return ((sum PriorRevalueRABookTransactionsRel.TransactionAmount) * (Basis / OriginalAssetBookRel.Basis))
		
		DerivedAssetDisposal is a DerivedField
			type is like Sequence
			if (!IsBookDisposal)
				return AssetDisposalRel.AssetDisposal
	   		else          		 
				return BookTypeAssetDisposalRel.AssetDisposal

		DerivedAssetDisposalCode is a DerivedField
            type is AlphaUpper size 50
			if (!IsBookDisposal)
				return AssetDisposalRel.AssetDisposalCode
	   		else          		 
				return BookTypeAssetDisposalRel.AssetDisposalCode

		DerivedDisposedAsset is a DerivedField
			type is like Asset
			if(AssetDisposalRel.FullDisposal)
				return Asset
			else
				return Asset.DisposedAssetOriginatingAsset
		
		DerivedDisposalMethod is a DerivedField
            type is like DisposalMethod
            if (DisposalRel exists)
            	return first DisposalRel.DisposalMethod
            else
            	return first FullDisposalRel.DisposalMethod
        
        DerivedDisposalStatus is a DerivedField
            type is like DisposalStatus
            if (DisposalRel exists)
            	return first DisposalRel.DisposalStatus
            else
            	return first FullDisposalRel.DisposalStatus
        
        DerivedDisposalDate is a DerivedField
            type is Date
            if (DisposalRel exists)
            	return first DisposalRel.DisposalDate
            else
         		return first FullDisposalRel.DisposalDate
            	
        DerivedAssetDisposalQuantity is a DerivedField
            type is like TotalItemQuantity
            if (DisposalRel exists)
            	return first DisposalRel.DisposalQuantity
            else
            	return first FullDisposalRel.DisposalQuantity
        
        DerivedDisposalFullOrPartial is a DerivedField
            type is like FullOrPartial
            if (DisposalRel exists)
            	return first DisposalRel.FullOrPartial
            else
            	return first FullDisposalRel.FullOrPartial

		Derived4797Part is a DerivedField
			type is Numeric 1
			if (4797Part1)
				return 1
			if (4797Part2)
				return 2
			if (4797Part3)
				return 3		


		1231GainLoss is a DerivedField
			type is like InternationalAmount
			if (Book.IsTaxBook)
				if (4797Part1 or 4797Part3)
					if ((Proceeds - CostOfSale) > (Basis)
					and (4797Part1 or 4797Part3))   
						return ((Proceeds - CostOfSale) - (Basis))
					else 
						return 0
				else 
					if (4797Part2 
					and HeldMoreThan1Year
					and ((Proceeds - CostOfSale) > (Basis)))
						return ((Proceeds - CostOfSale) - (Basis))	
					else 	
						return 0

		OrdinaryGainLoss is a DerivedField
			type is like InternationalAmount
			if (Book.IsTaxBook)			
				if (IsVoluntary)
					if (1231GainLoss = 0)
						return (GainOrLoss)
					else
						if (1231GainLoss > 0)
							return (LifeToDateDepreciation)
				else 
					if (HeldMoreThan1Year
					and 4797Part1 or 4797Part3
					and 1231GainLoss < 0)
						return (GainOrLoss)

				if (4797Part2)
					if (HeldMoreThan1Year)
						if (1231GainLoss = 0)
							return (GainOrLoss)
						else
							if (1231GainLoss > 0)
								return (LifeToDateDepreciation)
					else
						return (GainOrLoss)

        

	Conditions

        CostOfSaleOverriden
        	restricted
            when (CostOfSale != CostOfSaleOverride)

        DeferredGainOrLossOverriden
        	restricted
            when (DeferredGainOrLoss != DeferredGainOrLossOverride)

        Disposed
        	restricted
            when (Asset entered)

		DisposedBookDisposal	
			restricted
			when (Dispose
			or Disposed)





		
        DepreciationExpenseOverriden
        	restricted
            when (DepreciationExpense != DepreciationExpenseOverride)

        IsALikeKindExchange
        	restricted
            when (DeferredGainOrLoss entered
            or    DeferredGainOrLossOverride entered)

        ProceedsOverriden
        	restricted
            when (Proceeds != ProceedsOverride)

        TaxCreditRecaptureOverriden
        	restricted
            when (TaxCreditRecapture != TaxCreditRecaptureOverride)
            
       	GainLossRecalculated
       		restricted
        	when (Proceeds 					changed
        	or	CostOfSale					changed
        	or	DepreciationExpenseOverride changed
        	or 	DeferredGainOrLossOverride	changed
        	or 	TaxCreditRecapture			changed)
        	
        IsPostingBook
        	restricted
        	when (CompanyCurrentPostingBookRel exists)		
        	
        IsRevalued
        	restricted
        	when (AssetRevaluationRel exists)	
        
        RevaluePriorDisposal
        	restricted
        	when (LocalAssetDisposalRel.DisposalDate < CurrentBookCalendarsRel.CurrentPeriodDate)	
        
        RevalueFutureDisposal
        	restricted
        	when (LocalAssetDisposalRel.DisposalDate > CurrentBookCalendarsRel.CurrentPeriodDate)
       
	    FullDisposal
	   		restricted
			when (AssetDisposalRel.FullOrPartial.Full)

		IsCurrentDisposal
			restricted
			when ((AssetDisposal = Asset.LastAssetSequence)
			or (AssetDisposal not entered))
		IsBookDisposal

			when (BookTypeAssetDisposalRel.BookDisposal)

		IsUnreleased
			when (AssetDisposalRel.DisposalStatus.Unreleased)

		IsUpdateable	
			when (AssetDisposalRel.DisposalStatus.Unreleased
			or NewAssetDisposalRel exists)

		IsVoluntary	
			when ((!FullDisposal
			and   (IsBookDisposal and BookTypeAssetDisposalRel.Voluntary.Yes
			or    !IsBookDisposal and first DisposalRel.Voluntary.Yes))	
			or    (FullDisposal and BookTypeAssetDisposalRel.Voluntary.Yes))

		HeldMoreThan1Year
			restricted		
			when ((DerivedDisposalDate - AssetBookRel.InServiceDate) > 365)

		HeldLessThan2Years
			restricted		
			when ((DerivedDisposalDate - AssetBookRel.InServiceDate) <= 730)

		HeldLessThan10Years
			restricted		
			when ((DerivedDisposalDate - AssetBookRel.InServiceDate) < 3650)		

		IsIncludedInSearch
			restricted
			when ((CompanyGroup not entered
			or     CompanyGroupRel exists))

		4797Part1
			restricted		
			when ((HeldMoreThan1Year
			and    GainOrLoss <= 0)
			and  (((AssetBookRel.PropertyType.1245
			or     AssetBookRel.PropertyType.1250
			or 	   Asset.AssetType.Property.Real
			or     Asset.AssetType.Property.Personal)   
			or    (Asset.AssetType.Property.Land
			and    AssetBookRel.Farming)	
			or    (Asset.AssetType.Property.Stock
			and    AssetBookRel.Farming))
			and   (not 4797Part2
			and    not 4797Part3)))  




		4797Part2
			restricted		
			when ((!HeldMoreThan1Year
			or    (!IsVoluntary
			and    GainOrLoss > 0))
			and  ((AssetBookRel.PropertyType.1245
			or    AssetBookRel.PropertyType.1250
			or 	  Asset.AssetType.Property.Real
			or    Asset.AssetType.Property.Personal)
			or   (Asset.AssetType.Property.Land
			and   AssetBookRel.Farming)	
			or   (Asset.AssetType.Property.Stock
			and   AssetBookRel.Farming)))			



        4797Part3
			restricted
           	when ((HeldMoreThan1Year
			and    GainOrLoss > 0
			and    IsVoluntary)    
			and   ((AssetBookRel.PropertyType.1245
           	or     AssetBookRel.PropertyType.1250
			or 	   Asset.AssetType.Property.Real
			or     Asset.AssetType.Property.Personal)
			or    (Asset.AssetType.Property.Stock
			and    AssetBookRel.Farming)
			or    (Asset.AssetType.Property.Land
			and    AssetBookRel.Farming	
			and    HeldLessThan10Years))) 	

		4797All
			restricted		
			when (4797Part1
			or 4797Part2
			or 4797Part3)
   


    Relations

		BookCalendarsRel
			one-to-many relation to BookCalendar
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 			= FinanceEnterpriseGroup
				related.Book							= BookRel.Book
				related.Company							= Asset.Company

		DisposalDateBookCalendarRel		
			one-to-many relation to BookCalendar
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 			= FinanceEnterpriseGroup
				related.Book							= BookRel.Book
				related.Company							= Asset.Company
			Instance Selection
				where (related.YearEndDate >= DerivedDisposalDate
				and related.YearBeginDate <= DerivedDisposalDate)

		CompanyGroupRel
			one-to-one relation to GeneralLedgerCompanyGroupMember
			Field Mapping uses symbolic key
				related.GeneralLedgerCompanyGroup 	= CompanyGroup
				related.Company						= Asset.Company

		NewAssetRel
			one-to-one relation to Asset
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup			= LocalAsset.FinanceEnterpriseGroup
				related.Asset 							= LocalAsset
				
		AssetRel
			one-to-one relation to Asset
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
				related.Asset 							= Asset
				
		AssetCompanyRel
			one-to-one relation to AssetCompany
			Field Mapping uses symbolic key
				related.Company							= Asset.Company
				
		BookRel
			one-to-one relation to Book
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Book							= LocalBook	
				
        AssetDisposalRel
            classic name is AMASSETDSP
            one-to-one relation to AssetDisposal
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
                related.Asset							= Asset
                related.AssetDisposal 					= Asset.LastAssetSequence

        BookTypeAssetDisposalRel
            classic name is AMASSETDSP
            one-to-one relation to AssetDisposal
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
                related.Asset							= Asset
                related.AssetDisposal 					= AssetDisposal

		UnreleasedAssetDisposalRel
			one-to-one relation to AssetDisposal
			Field Mapping uses UnreleasedAssetDisposal
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= Asset
				related.AssetDisposal					= Asset.LastAssetSequence

        AssetDisposalsRel
            one-to-many relation to AssetDisposal
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
                related.Asset							= Asset

        FullDisposalRel
            one-to-many relation to AssetDisposal
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
                related.Asset							= Asset
        
        DisposalRel
            one-to-many relation to AssetDisposal
            Field Mapping uses ByDisposalAsset
            	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
                related.DisposalAsset 					= Asset
                related.Asset							= DerivedDisposedAsset
        
		NewAssetDisposalRel
            classic name is AMASSETDSP
            one-to-many relation to AssetDisposal
            Field Mapping uses ByDisposalAsset
            	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
                related.DisposalAsset					= Asset
			Instance Selection
				where (related.DisposalStatus.Unreleased)

                
        AssetBookRel
            classic name is AMASTBOOK
            one-to-one relation to AssetBook
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
                related.Asset 							= Asset
                related.Book  							= Book
		
		OriginalAssetBookRel
			one-to-one relation to AssetBook
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
				related.Asset 							= DerivedDisposedAsset
				related.Book							= Book
		
        LocalAssetBookRel
            classic name is AMASTBOOK
            one-to-one relation to AssetBook
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
                related.Asset 							= Asset
                related.Book  							= LocalBook
                
        AssetTypeRel
            classic name is AMASTTYPE
            one-to-one relation to AssetType
            Field Mapping uses symbolic key
                related.Company           				= Asset.Company
                related.AssetType.Type    				= Asset.AssetType.Type
                related.AssetType.SubType 				= Asset.AssetType.SubType

        AssetDivisionRel
            classic name is AMDIVISION
            one-to-one relation to AssetDivision
            Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup     
                related.AssetDivision 					= Asset.AssetDivision

        AssetLocationRel
            classic name is AMLOCATION
            one-to-one relation to AssetLocation
            Field Mapping uses symbolic key
               	related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup 
                related.AssetLocation 					= Asset.AssetLocation
                
		CurrentBookCalendarsRel2
			one-to-many relation to BookCalendar
			Field Mapping uses Set5
				related.Book							= LocalBook	
				related.Company							= Asset.Company 
		
		CurrentBookCalendarsRel
			one-to-many relation to BookCalendar
			Field Mapping uses Set5
				related.Book							= Book	
				related.Company							= Asset.Company 
				
		AssetTaxCreditTableRel
			one-to-one relation to AssetTaxCreditTable
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup          = Asset.FinanceEnterpriseGroup
				related.AssetTaxCreditTable				= AssetBookRel.AssetTaxCreditTable 
				
		AssetAccountGroupRel
			one-to-one relation to AssetAccountGroup
			Field Mapping uses symbolic key
				related.Company							= Asset.Company
				related.AssetAccountGroup				= Asset.AssetAccountGroup
		
		CompanyCurrentPostingBookRel	
			one-to-many relation to BookCalendar
			Field Mapping uses CompanyCurrentPostingBook
				related.Company							= Asset.Company
				related.PostingBook 					= true
				related.Book							= BookRel.Book






				
		AssetControlTransactionRel
			one-to-one relation to AssetControlTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= Asset.FinanceEnterpriseGroup
				related.Asset							= Asset
				
		UnreleasedAssetTransactionsRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= Asset
				related.Book							= Book
			Instance Selection
				where (related.AssetTransaction.TransactionStatus.Unreleased)

		UnreleasedAssetBookTransactionsRel		
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= Asset
				related.Book							= Book
			Instance Selection
				where (related.AssetBookTransaction.TransactionStatus.Unreleased)
											
		DisposalAssetTransactionRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= Asset
				related.Book							= Book
			Instance Selection
				where (related.AssetTransaction.AssetProcess.Disposal
				and related.AssetTransaction.TransactionAmount > 0
				and related.AssetTransaction.AssetAccountType.Asset)
				
		DisposalAssetBookTransactionsRel
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= Asset
				related.Book							= Book
			Instance Selection
				where (related.AssetBookTransaction.AssetProcess.Disposal
				and related.AssetBookTransaction.TransactionAmount > 0
				and related.AssetBookTransaction.AssetAccountType.Asset)				

		AssetRevaluationRel
			one-to-many relation to AssetRevaluation
			Field Mapping uses Set1
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= Asset
		
		OriginalAssetRel
			one-to-one relation to Asset
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset 							= DerivedDisposedAsset
		
		LocalAssetDisposalRel
            one-to-one relation to AssetDisposal
            Field Mapping uses symbolic key
            	related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
                related.Asset							= DerivedDisposedAsset
                related.AssetDisposal 					= OriginalAssetRel.LastAssetSequence
		
		RevalueTransactionsRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection
				where ((related.AssetAccountType.RevalueSurplus		
				or related.AssetAccountType.RevalueLoss)
				and related.ProcessSequence	!= Asset.LastAssetSequence)
				
		RevalueBookTransactionsRel
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection
				where (related.AssetAccountType.RevalueSurplus
				or related.AssetAccountType.RevalueLoss)				
		
		RevalueAmortTransactionsRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection
				where (related.AssetAccountType.RevalueAmortization
				and related.ProcessSequence	!= Asset.LastAssetSequence)
		
		RevalueAmortBookTransactionsRel
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection
				where (related.AssetAccountType.RevalueAmortization)	
				
		ImpairmentILTransactionsRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection			
				where (related.AssetAccountType.ImpairmentLoss)
		
		ImpairmentAATransactionsRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection			
				where (related.AssetAccountType.AccumulatedImpairmentLoss)
		
		ImpairmentILBookTransactionsRel
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection			
				where (related.AssetAccountType.ImpairmentLoss)
		
		ImpairmentAABookTransactionsRel
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection			
				where (related.AssetAccountType.AccumulatedImpairmentLoss)
		
		PriorRevalueRATransactionsRel
			one-to-many relation to AssetTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection
				where (related.AssetAccountType.RevalueAmortization
				and related.PostingDate > LocalAssetDisposalRel.DisposalDate
				and related.PostingDate < CurrentBookCalendarsRel.CurrentPeriodDate)
		
		PriorRevalueRABookTransactionsRel
			one-to-many relation to AssetBookTransaction
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= FinanceEnterpriseGroup
				related.Asset							= DerivedDisposedAsset
				related.Book							= Book
			Instance Selection
				where (related.AssetAccountType.RevalueAmortization
				and related.PostingDate > LocalAssetDisposalRel.DisposalDate
				and related.PostingDate < CurrentBookCalendarsRel.CurrentPeriodDate)

		AssetBookPurgeRel
			one-to-many relation to AssetBook
			Field Mapping uses Set2
				related.FinanceEnterpriseGroup		= LocalFinanceEnterpriseGroup
		      	related.Book						= LocalBook
		    Instance Selection
		    	include deleted records

		AssetBookDisposalsRel
			one-to-many relation to AssetBookDisposal
			Field Mapping uses ByAssetDisposal
				related.FinanceEnterpriseGroup		= FinanceEnterpriseGroup
				related.Asset						= Asset
				related.AssetDisposal				= AssetDisposal
	




    Sets
        Set2
            indexed
            Sort Order
                Book
                Asset

		ByAssetDisposal
			indexed	
			Sort Order
				FinanceEnterpriseGroup
				Asset
				AssetDisposal
				Book		








	
	Rule Blocks







					
		CreateJE
			invoke DefaultAccounts AssetBookRel
			LocalDisposalDate					= TransientDisposalDate	
			if (AssetASTAmt entered)
				include CreateAstJE
			
			LocalCtrlConsolJEFlag 				= false	
			if (AssetCompanyRel.ConsolidateDisposalJournalEntry entered)
				LocalCtrlConsolJEFlag 			= true
			
			LocalAssetACMAmt					= AssetACMAmt	
			if (LocalCtrlConsolJEFlag 			= false)
				if (AssetACMAmt entered)
					include CreateAcmJE
			else
				LocalAssetACMAmt 				= AssetBookRel.LifeToDateDepreciation
				if (AssetACMAmt entered)
					include CreateAcmJE

			if (AssetEXPAmt entered)
				include CreateExpJE
			
			if (AssetPROAmt entered)
				include CreateProJE
				
			if (AssetCOSAmt entered)
				include CreateCosJE
			
			if (AssetGANAmt - AssetDGNAmt != 0)
				include CreateGanJE
	
			if (AssetLOSAmt - AssetDLSAmt != 0)
				include CreateLosJE
				
			if (AssetDGNAmt entered)
				include CreateDgnJE
						
			if (AssetDLSAmt entered)
				include CreateDlsJE		
			
			if (RevaluationAmountForDisposal entered)
				LocalRevalueAmortizationEntries	= RevalueAmortizationEntries
				RevalueEliminationAmount = RevaluationAmountForDisposal
				GainOrLoss	= GainOrLoss + RevaluationAmountForDisposal
				include CreateRvlJE
				include RevalueAmortizationBackOff
				
		CreateAstJE
			LocalDisposalDate					= TransientDisposalDate	
			invoke Create AssetTransaction
				LocalTransactionAmount			= AssetASTAmt
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				if (Book.Impairment)
					invoked.AssetAccountType	= "IML"
					invoked.DistributionAccount	= AssetBookRel.TranImpairmentEventDebit				
				else
					invoked.AssetAccountType	= "AST"
					invoked.DistributionAccount	= AssetBookRel.TranAssetAccount		
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
				
		SetUpJe
			LocalDisposalDate					= TransientDisposalDate	
			invoked.Asset						= Asset
			invoked.FinanceEnterpriseGroup		= Asset.FinanceEnterpriseGroup
			invoked.ProcessAsset				= Asset
			invoked.ProcessSequence				= OriginalAssetRel.LastAssetSequence
			invoked.Company						= Asset.Company
			invoked.Book						= LocalBook
			invoked.AssetAccountGroup			= Asset.AssetAccountGroup
			invoked.AssetType					= Asset.AssetType  
			invoked.TransactionAmount			= LocalTransactionAmount
			invoked.TransientBookCurrency		= DerivedCurrency
			invoked.TransactionNumberOfDecimals	= DerivedNumberOfDecimals
			if (LocalBook.Impairment)
				invoked.AssetImpairment			= Asset.LastAssetImpairment  
			if (Book.PostCurrency.Asset
			and Asset.Currency != Book.Currency)
				LocalTransactionDate 			= Asset.LastAssetItemPurchaseDate
			else
				LocalTransactionDate 			= TransientDisposalDate
			invoked.TransactionDate 			= LocalTransactionDate
			invoked.AssetTransactionAmount.ExchangeDate = LocalTransactionDate
			if (Asset.AdjustmentDate entered)
				invoked.ProcessDate				= Asset.AdjustmentDate
			else
				invoked.ProcessDate				= LocalDisposalDate
			invoked.AssetTransactionAmount.TransactionAmount 		= LocalTransactionAmount
			invoked.AssetTransactionAmount.BaseAmount.ToCurrency	= Book.Currency
			if (LocalPostingDate entered)
				invoked.PostingDate				= LocalPostingDate
			else
				invoked.PostingDate				= LocalDisposalDate
			if (TransientUpdateFromBatch = true)
				invoked.Reference				= "Mass Asset Disposal"
			else	
				invoked.Reference				= "Disposal"

			invoked.Description					= "Asset" + " " + Asset + " " + Asset.AssetProcess
			if (LocalPurge)
				invoked.AssetTransaction.TransactionStatus	= "M"
			else
				invoked.AssetTransaction.TransactionStatus	= "U"
			invoked.AssetProcess				= "DSP"
			
		CreateAcmJE	
			if ((AssetDisposalRel.DisposalMethod.Purged
			and AssetEXPAmt entered)
			or (AssetCompanyRel.ConsolidateDisposalJournalEntry
			and AssetACMAmt entered)
			or (!AssetCompanyRel.ConsolidateDisposalJournalEntry
			and (AssetACMAmt + AssetEXPAmt not = 0)))
				invoke Create AssetTransaction
					if (AssetDisposalRel.DisposalMethod.Purged)
						LocalTransactionAmount		= (AssetEXPAmt * -1)
					else	
						if (AssetCompanyRel.ConsolidateDisposalJournalEntry)	
							LocalTransactionAmount		= AssetACMAmt
						else 
							LocalTransactionAmount		= AssetACMAmt + AssetEXPAmt	
					include SetUpJe	
					invoked.OnlineSystemCreate		= true
					if (Book.Impairment)
						invoked.AssetAccountType		= "IMT"
						invoked.DistributionAccount		= AssetBookRel.TranImpairmentEventCredit	
					else
						invoked.AssetAccountType		= "ACM"
						invoked.DistributionAccount		= AssetBookRel.TranAccumulatedDepreciationAccount
					invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
			if (!AssetCompanyRel.ConsolidateDisposalJournalEntry
			and !AssetDisposalRel.DisposalMethod.Purged)
				if (AssetEXPAmt entered)
					invoke Create AssetTransaction
						LocalTransactionAmount		= (AssetEXPAmt * -1)
						include SetUpJe	
						invoked.OnlineSystemCreate		= true
						if (Book.Impairment)
							invoked.AssetAccountType		= "IMT"
						else
							invoked.AssetAccountType		= "ACM"
						if (Asset.AssetType.ExcludeIncremental)	
							invoked.DistributionAccount		= AssetBookRel.TransientIncrementalAccumulatedDepreciation
						else
							if (Book.Impairment)
								invoked.DistributionAccount		= AssetBookRel.TranImpairmentEventCredit							
							else
								invoked.DistributionAccount		= AssetBookRel.TranAccumulatedDepreciationAccount					
						invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
										
		CreateExpJE
			invoke Create AssetTransaction
				LocalTransactionAmount			= AssetEXPAmt
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				if (Book.Impairment)
					invoked.AssetAccountType		= "IMA"
					invoked.DistributionAccount		= AssetBookRel.TranImpairmentAmortization
				else
					invoked.AssetAccountType		= "EXP"
					invoked.DistributionAccount		= AssetBookRel.TranDepreciationExpenseAccount				
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
				
		CreateClrJE
			invoke Create AssetTransaction
				LocalTransactionAmount			= AssetCLRAmt
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				invoked.AssetAccountType		= "CLR"
				invoked.DistributionAccount		= AssetBookRel.TranClearingAccount
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
				
				
		CreateProJE
			invoke Create AssetTransaction
				LocalTransactionAmount			= AssetPROAmt
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				invoked.AssetAccountType		= "PRO"
				invoked.DistributionAccount		= AssetBookRel.TranProceedsAccount
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
				
		CreateCosJE
			invoke Create AssetTransaction
				LocalTransactionAmount			= AssetCOSAmt
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				invoked.AssetAccountType		= "COS"
				invoked.DistributionAccount		= AssetBookRel.TranDisposalExpenseAccount
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
				
		CreateGanJE
			invoke Create AssetTransaction
				LocalTransactionAmount			= (AssetGANAmt - AssetDGNAmt)
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				invoked.AssetAccountType		= "GAN"
				invoked.DistributionAccount		= AssetBookRel.TranGainAccount
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
				
		CreateLosJE
			invoke Create AssetTransaction
				LocalTransactionAmount			= (AssetLOSAmt - AssetDLSAmt)
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				invoked.AssetAccountType		= "LOS"
				invoked.DistributionAccount		= AssetBookRel.TranLossAccount
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
				
		CreateDgnJE
			invoke Create AssetTransaction
				LocalTransactionAmount			= AssetDGNAmt
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				invoked.AssetAccountType		= "DGN"
				invoked.DistributionAccount		= AssetBookRel.TranDeferredGainAccount
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
				
		CreateDlsJE
			invoke Create AssetTransaction
				LocalTransactionAmount			= AssetDLSAmt
				include SetUpJe
				invoked.OnlineSystemCreate		= true
				invoked.AssetAccountType		= "DLS"
				invoked.DistributionAccount		= AssetBookRel.TranDeferredLossAccount
				invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
			
		CreateRvlJE
			if (RevalueEliminationAmount > 0)
				if (IsPostingBook)
					invoke Create AssetTransaction
						LocalTransactionAmount			= RevalueEliminationAmount * -1
						include SetUpJe
						invoked.OnlineSystemCreate		= true
						invoked.AssetAccountType		= "LOS"
						invoked.DistributionAccount		= AssetBookRel.TranLossAccount
						invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
					if (Asset.AssetType.PostToAccount.RevaluationReserve)
						invoke Create AssetTransaction
							LocalTransactionAmount			= RevalueEliminationAmount
							include SetUpJe
							invoked.OnlineSystemCreate		= true
							invoked.AssetAccountType		= "RRA"
							invoked.DistributionAccount		= AssetBookRel.TranRevalueReserve
							invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence				
				
				else
					invoke Create AssetBookTransaction
						LocalTransactionAmount			= RevalueEliminationAmount * -1
						include SetUpBKJe
						invoked.AssetAccountType		= "LOS"
						invoked.DistributionAccount		= AssetBookRel.TranLossAccount
					if (Asset.AssetType.PostToAccount.RevaluationReserve)
						invoke Create AssetBookTransaction
							LocalTransactionAmount			= RevalueEliminationAmount
							include SetUpBKJe
							invoked.AssetAccountType		= "RRA"
							invoked.DistributionAccount		= AssetBookRel.TranRevalueReserve

			else 			
				if (IsPostingBook)
					invoke Create AssetTransaction
						LocalTransactionAmount			= RevalueEliminationAmount * -1
						include SetUpJe
						invoked.OnlineSystemCreate		= true
						invoked.AssetAccountType		= "LOS"
						invoked.DistributionAccount		= AssetBookRel.TranLossAccount
						invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence
					if (Asset.AssetType.PostToAccount.RevaluationReserve)
						invoke Create AssetTransaction
							LocalTransactionAmount			= RevalueEliminationAmount
							include SetUpJe
							invoked.OnlineSystemCreate		= true
							invoked.AssetAccountType		= "RRA"
							invoked.DistributionAccount		= AssetBookRel.TranRevalueReserve
							invoked.ProcessSequence			= OriginalAssetRel.LastAssetSequence						
					
				else
					invoke Create AssetBookTransaction
						LocalTransactionAmount			= RevalueEliminationAmount * -1 
						include SetUpBKJe
						invoked.AssetAccountType		= "LOS"
						invoked.DistributionAccount		= AssetBookRel.TranLossAccount
					if (Asset.AssetType.PostToAccount.RevaluationReserve)
						invoke Create AssetBookTransaction
							LocalTransactionAmount			= RevalueEliminationAmount
							include SetUpBKJe
							invoked.AssetAccountType		= "RRA"
							invoked.DistributionAccount		= AssetBookRel.TranRevalueReserve



										
						
		RecalcGainLoss


			if (TaxCreditRecapture changed
			and AssetBookRel.YearPlacedInService < 61)
				if (AssetTaxCreditTableRel exists)
					LocalBasis		= AssetBookRel.Basis - ((TaxCreditRecapture) * (AssetTaxCreditTableRel.BasisReductionPercentage / 100))
			LocalNetBasis = AssetBookRel.Basis - LifeToDateDepreciation	
			GainOrLossOverride	= Proceeds - CostOfSale - LocalNetBasis - DeferredGainOrLoss
			CalcBasis = ((LocalBasis + TaxCreditRecapture) * (AssetTaxCreditTableRel.BasisReductionPercentage / 100))		
			invoke BalanceUpdate AssetBookRel
				invoked.Basis	= LocalBasis + ((TaxCreditRecapture) * (AssetTaxCreditTableRel.BasisReductionPercentage / 100))		


					
		CreateAbkJE
			if (AssetASTAmt entered)
				include CreateBKAstJE

			LocalCtrlConsolJEFlag 				= false	
			if (AssetCompanyRel.ConsolidateDisposalJournalEntry entered)
				LocalCtrlConsolJEFlag 			= true
			
			LocalAssetACMAmt					= AssetACMAmt	
			if (LocalCtrlConsolJEFlag 			= false)
				if (AssetACMAmt entered)
					include CreateBKAcmJE
			else
				LocalAssetACMAmt 				= AssetBookRel.LifeToDateDepreciation
				if (AssetACMAmt entered)
					include CreateBKAcmJE
									
			if (AssetEXPAmt entered)
				include CreateBKExpJE
				
			if (AssetPROAmt entered)
				include CreateBKProJE
				
			if (AssetCOSAmt entered)
				include CreateBKCosJE
				
			if (AssetGANAmt - AssetDGNAmt != 0)
				include CreateBKGanJE

			if (AssetLOSAmt - AssetDLSAmt != 0)
				include CreateBKLosJE
				
			if (AssetDGNAmt entered)
				include CreateBKDgnJE
				
			if (AssetDLSAmt entered)
				include CreateBKDlsJE	
		
		CreateBKAstJE
			LocalDisposalDate					= TransientDisposalDate
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= AssetASTAmt
				include SetUpBKJe
				invoked.AssetAccountType		= "AST"
				invoked.DistributionAccount		= AssetBookRel.TranAssetAccount

		SetUpBKJe 
			LocalDisposalDate					= TransientDisposalDate	
			invoked.Asset						= Asset.Asset
			invoked.FinanceEnterpriseGroup		= Asset.FinanceEnterpriseGroup
			invoked.Company						= Asset.Company
			invoked.Book						= LocalBook
			invoked.ProcessSequence				= OriginalAssetRel.LastAssetSequence
			if (LocalBook.Impairment)
				invoked.AssetImpairment			= Asset.LastAssetImpairment
			if (Book.PostCurrency.Asset
			and Asset.Currency != Book.Currency)
				LocalTransactionDate 			= Asset.LastAssetItemPurchaseDate
			else
				LocalTransactionDate 			= TransientDisposalDate
			invoked.TransactionDate 			= LocalTransactionDate
			invoked.AssetTransactionAmount.ExchangeDate = LocalTransactionDate		
			if (TransientUpdateFromBatch = true)
				invoked.Reference				= "Mass Asset Disposal"
			else	
				invoked.Reference				= "Disposal"
			invoked.AssetBookTransaction.TransactionStatus	= "U"
			invoked.AssetProcess				= "DSP"
			invoked.TransactionAmount			= LocalTransactionAmount
			invoked.TransientBookCurrency		= DerivedCurrency
			invoked.TransactionNumberOfDecimals	= DerivedNumberOfDecimals
			if (Asset.AdjustmentDate entered)
				invoked.ProcessDate				= Asset.AdjustmentDate
				invoked.AssetTransactionAmount.ExchangeDate	  	= Asset.LastAssetItemPurchaseDate
			else
				invoked.ProcessDate				= LocalDisposalDate
				invoked.AssetTransactionAmount.ExchangeDate	  	= Asset.LastAssetItemPurchaseDate
			invoked.AssetTransactionAmount.TransactionAmount 	 = LocalTransactionAmount
			invoked.AssetTransactionAmount.BaseAmount.ToCurrency = Book.Currency
			if (LocalPostingDate entered)
				invoked.PostingDate				= LocalPostingDate
			else
				invoked.PostingDate				= LocalDisposalDate
						
		CreateBKAcmJE			
			if ((AssetDisposalRel.DisposalMethod.Purged
			and AssetEXPAmt entered)
			or (AssetCompanyRel.ConsolidateDisposalJournalEntry
			and AssetACMAmt entered)
			or (!AssetCompanyRel.ConsolidateDisposalJournalEntry
			and (AssetACMAmt + AssetEXPAmt not = 0)))
				invoke Create AssetBookTransaction
					if (AssetDisposalRel.DisposalMethod.Purged)
						LocalTransactionAmount		= (AssetEXPAmt * -1)
					else	
						if (AssetCompanyRel.ConsolidateDisposalJournalEntry)	
							LocalTransactionAmount		= AssetACMAmt
						else 
							LocalTransactionAmount		= AssetACMAmt + AssetEXPAmt	
					include SetUpBKJe
					invoked.AssetAccountType		= "ACM"
					invoked.DistributionAccount		= AssetBookRel.TranAccumulatedDepreciationAccount

			if (!AssetCompanyRel.ConsolidateDisposalJournalEntry
			and !AssetDisposalRel.DisposalMethod.Purged)
				if (AssetEXPAmt entered)
					invoke Create AssetBookTransaction
						LocalTransactionAmount		= (AssetEXPAmt * -1)
						include SetUpBKJe
						invoked.AssetAccountType		= "ACM"
						if (Asset.AssetType.ExcludeIncremental)	
							invoked.DistributionAccount		= AssetBookRel.TransientIncrementalAccumulatedDepreciation
						else
							invoked.DistributionAccount		= AssetBookRel.TranAccumulatedDepreciationAccount	
		CreateBKExpJE			
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= AssetEXPAmt
				include SetUpBKJe
				invoked.AssetAccountType		= "EXP"
				invoked.DistributionAccount		= AssetBookRel.TranDepreciationExpenseAccount
				
		CreateBKProJE			
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= AssetPROAmt
				include SetUpBKJe
				invoked.AssetAccountType		= "PRO"
				invoked.DistributionAccount		= AssetBookRel.TranProceedsAccount
				
		CreateBKCosJE			
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= AssetCOSAmt
				include SetUpBKJe
				invoked.AssetAccountType		= "COS"
				invoked.DistributionAccount		= AssetBookRel.TranDisposalExpenseAccount
				
		CreateBKGanJE
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= (AssetGANAmt - AssetDGNAmt)
				include SetUpBKJe
				invoked.AssetAccountType		= "GAN"
				invoked.DistributionAccount		= AssetBookRel.TranGainAccount
				
		CreateBKLosJE
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= (AssetLOSAmt - AssetDLSAmt)
				include SetUpBKJe
				invoked.AssetAccountType		= "LOS"
				invoked.DistributionAccount		= AssetBookRel.TranLossAccount
				
		CreateBKDgnJE
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= AssetDGNAmt
				include SetUpBKJe
				invoked.AssetAccountType		= "DGN"
				invoked.DistributionAccount		= AssetBookRel.TranDeferredGainAccount
				
		CreateBKDlsJE
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= AssetDLSAmt
				include SetUpBKJe
				invoked.AssetAccountType		= "DLS"
				invoked.DistributionAccount		= AssetBookRel.TranDeferredLossAccount
				
		CreateBKClrJE
			invoke Create AssetBookTransaction
				LocalTransactionAmount			= AssetCLRAmt
				include SetUpBKJe
				invoked.AssetAccountType		= "CLR"
				invoked.DistributionAccount		= AssetBookRel.TranClearingAccount	
				
		CreateImpairmentTransactions
			invoke Create AssetTransaction
				LocalTransactionAmount		= LocalImpairmentAmountForDisposal * -1
				include SetUpJe
				invoked.AssetAccountType	= "IMD"
				invoked.DistributionAccount = AssetBookRel.TranImpairmentEventDebit
				invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
			invoke Create AssetTransaction
				LocalTransactionAmount		= LocalImpairmentAmountForDisposal
				include SetUpJe
				invoked.AssetAccountType	= "IGL"
				invoked.DistributionAccount = AssetBookRel.TranImpairmentEventCredit
				invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
		
		CreateImpairmentBookTransactions
			invoke Create AssetBookTransaction
				LocalTransactionAmount		= LocalImpairmentAmountForDisposal * -1
				include SetUpBKJe
				invoked.AssetAccountType	= "IMD"
				invoked.DistributionAccount = AssetBookRel.TranImpairmentEventDebit
				invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
			invoke Create AssetBookTransaction
				LocalTransactionAmount		= LocalImpairmentAmountForDisposal
				include SetUpBKJe
				invoked.AssetAccountType	= "IGL"
				invoked.DistributionAccount = AssetBookRel.TranImpairmentEventCredit
				invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
		
		RevalueAmortizationBackOff
			if(RevaluePriorDisposal)
				if(LocalRevalueAmortizationEntries != 0)
					invoke Create AssetTransaction
						LocalTransactionAmount		= LocalRevalueAmortizationEntries
						include SetUpJe
						invoked.AssetAccountType	= "RRA"
						invoked.DistributionAccount = AssetBookRel.TranRevalueReserve
						invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
					invoke Create AssetTransaction
						LocalTransactionAmount		= LocalRevalueAmortizationEntries * -1
						include SetUpJe
						invoked.AssetAccountType	= "RVA"
						invoked.DistributionAccount = AssetBookRel.TranRevalueAmortization
						invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
		
		ImpairmentAmortizationTransactionBackOff
			if (DepreciationExpenseOverride != 0)
				invoke Create AssetTransaction
					LocalTransactionAmount		= DepreciationExpenseOverride * -1
					include SetUpJe
					invoked.AssetAccountType	= "IMT"
					invoked.DistributionAccount = AssetBookRel.TranAccumulatedImpairmentLoss
					invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
				invoke Create AssetTransaction
					LocalTransactionAmount		= DepreciationExpenseOverride
					include SetUpJe
					invoked.AssetAccountType	= "IMA"
					invoked.DistributionAccount = AssetBookRel.TranImpairmentAmortization
					invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
		
		ImpairmentAmortizationBookTransactionBackOff
			if (DepreciationExpenseOverride != 0)
				invoke Create AssetBookTransaction
					LocalTransactionAmount		= DepreciationExpenseOverride * -1
					include SetUpBKJe
					invoked.AssetAccountType	= "IMT"
					invoked.DistributionAccount = AssetBookRel.TranAccumulatedImpairmentLoss
					invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
				invoke Create AssetBookTransaction
					LocalTransactionAmount		= DepreciationExpenseOverride
					include SetUpBKJe
					invoked.AssetAccountType	= "IMA"
					invoked.DistributionAccount = AssetBookRel.TranImpairmentAmortization
					invoked.PostingDate			= LocalAssetDisposalRel.DisposalDate
				
			
	Actions
		Create is a Create Action
			restricted
			Entrance Rules
				LocalDisposalDate			= TransientDisposalDate
			Action Rules
				Dispose = true

			Exit Rules
				if (AssetDisposalRel.PartialDisposal)
					invoke DefaultAccounts AssetBookRel
					invoke CreateJournalEntries AssetBookDisposal
			
		Update is an Update Action
			restricted
			Local Fields
				LocalDisposalDate			is Date
				
			Entrance Rules
				LocalBook 					= Book
				LocalDisposalDate			= TransientDisposalDate	

			Exit Rules

				invoke DefaultAccounts AssetBookRel

				if (Dispose changed)
					display "DisposeChanged"
					if (Dispose = false)

						constraint (any AssetBookDisposalsRel.Dispose)
							"AtLeastOneBookMustBeSelectedForDisposal"
						for each AssetBookDisposalsRel
							LocalBook = each.Book

							if (each.Dispose = false)	





								invoke UpdateDisposedBook
									invoked.PrmBook 	= LocalBook 	
									invoked.PrmDispose 	= 1	
									invoked.PrmYearToDateDepreciation 	= each.YearToDateDepreciation - each.DepreciationExpenseOverride
									invoked.PrmLifeToDateDepreciation 	= each.LifeToDateDepreciation - each.DepreciationExpenseOverride
									invoked.PrmDepreciationExpenseOverride = each.DepreciationExpenseOverride									


							else 



								invoke UpdateDisposedBook  	
									invoked.PrmBook 	= LocalBook
									invoked.PrmDispose 	= 2		
									invoked.PrmYearToDateDepreciation 	= each.YearToDateDepreciation
									invoked.PrmLifeToDateDepreciation 	= each.LifeToDateDepreciation
									invoked.PrmDepreciationExpenseOverride = each.DepreciationExpenseOverride


					else

						if (all AssetBookDisposalsRel.Dispose) 
							for each AssetBookDisposalsRel
								LocalBook = each.Book

								invoke UpdateDisposedBook 
									invoked.PrmBook 	= LocalBook 	
									invoked.PrmDispose 	= 1	
									invoked.PrmYearToDateDepreciation 	= each.YearToDateDepreciation 
									invoked.PrmLifeToDateDepreciation 	= each.LifeToDateDepreciation 
									invoked.PrmDepreciationExpenseOverride = each.DepreciationExpenseOverride									

						else
							invoke UpdateDisposedBook          
								invoked.PrmBook 		= Book
								invoked.PrmDispose 		= 2	
								invoked.PrmYearToDateDepreciation 	= YearToDateDepreciation
								invoked.PrmLifeToDateDepreciation	= LifeToDateDepreciation	
								invoked.PrmDepreciationExpenseOverride = DepreciationExpenseOverride
				if (!AssetDisposalRel.DisposalMethod.Purged)
					if (AssetDisposalFullOrPartial = "F")
						if (DerivedDisposalQuantity = DerivedTotalDisposalSelectedQuantity)
							invoke CreateJournalEntries AssetBookDisposal
					else
						invoke CreateJournalEntries AssetBookDisposal
					
		UpdateBook is an Update Action
			default label is "Update"
			valid when (IsUpdateable)
			Local Fields
				LocalDisposalDate			is Date
				
			Entrance Rules
				LocalBook 					= Book
				LocalDisposalDate			= TransientDisposalDate	
			Action Rules




				LocalNetProceeds	= ProceedsOverride - CostOfSaleOverride
				if (AssetDisposalRel.DisposalMethod.Purged)
					GainOrLoss	= 0
				else
					GainOrLoss	= LocalNetProceeds - ((AssetBookRel.Basis - LifeToDateDepreciation) - AssetBookRel.FirstYearExpenseAmount)
				Proceeds   		= ProceedsOverride
				CostOfSale 		= CostOfSaleOverride 
				DepreciationExpense = DepreciationExpenseOverride

			Exit Rules
				invoke DefaultAccounts AssetBookRel
				if (Dispose changed)

					if (Dispose = false)
						if (!AssetDisposalRel.BookDisposal)
							invoke UpdateBookDisposal AssetDisposalRel
								invoked.BookDisposalPrm = true


						constraint (any AssetBookDisposalsRel.Dispose)
							"AtLeastOneBookMustBeSelectedForDisposal"
						for each AssetBookDisposalsRel
							LocalBook = each.Book

							if (each.Dispose = false)	





								invoke UpdateDisposedBook 
									invoked.PrmBook 	= LocalBook 	
									invoked.PrmDispose 	= 1	
									invoked.PrmYearToDateDepreciation 	= each.YearToDateDepreciation - each.DepreciationExpenseOverride
									invoked.PrmLifeToDateDepreciation 	= each.LifeToDateDepreciation - each.DepreciationExpenseOverride
									invoked.PrmDepreciationExpenseOverride = each.DepreciationExpenseOverride
							else 
								invoke UpdateDisposedBook  	
									invoked.PrmBook 	= LocalBook
									invoked.PrmDispose 	= 2		
									invoked.PrmYearToDateDepreciation 	= YearToDateDepreciation
									invoked.PrmLifeToDateDepreciation 	= LifeToDateDepreciation
									invoked.PrmDepreciationExpenseOverride = DepreciationExpenseOverride

					else

						if (all AssetBookDisposalsRel.Dispose) 
							for each AssetBookDisposalsRel
								LocalBook = each.Book

								invoke UpdateDisposedBook 
									invoked.PrmBook 	= LocalBook 	
									invoked.PrmDispose 	= 1	
									invoked.PrmYearToDateDepreciation 	= each.YearToDateDepreciation - each.DepreciationExpenseOverride
									invoked.PrmLifeToDateDepreciation 	= each.LifeToDateDepreciation - each.DepreciationExpenseOverride
									invoked.PrmDepreciationExpenseOverride = each.DepreciationExpenseOverride
						else

							invoke UpdateDisposedBook          
								invoked.PrmBook 		= Book
								invoked.PrmDispose 		= 2	
								invoked.PrmYearToDateDepreciation 	= YearToDateDepreciation
								invoked.PrmLifeToDateDepreciation	= LifeToDateDepreciation	
								invoked.PrmDepreciationExpenseOverride = DepreciationExpenseOverride



				if (!AssetDisposalRel.DisposalMethod.Purged)
					if (AssetDisposalFullOrPartial = "F")
						if (DerivedDisposalQuantity = DerivedTotalDisposalSelectedQuantity)
							invoke CreateJournalEntries AssetBookDisposal
					else
						invoke CreateJournalEntries AssetBookDisposal

		UpdateDisposedBook is an Instance Action	
			restricted
			Parameters
				PrmBook		is a Book
				PrmDispose 	is Numeric 1
				PrmYearToDateDepreciation is an InternationalAmount
				PrmLifeToDateDepreciation is an InternationalAmount		
				PrmDepreciationExpenseOverride is an InternationalAmount		
			Action Rules
				LocalBook				= PrmBook

				invoke UpdateDisposedBook LocalAssetBookRel
					invoked.PrmDispose 						= PrmDispose



					invoked.PrmYearToDateDepreciation		= PrmYearToDateDepreciation
					invoked.PrmLifeToDateDepreciation 		= PrmLifeToDateDepreciation

		UpdateDisposeFlag is an Instance Action	
			restricted
			Parameters
				PrmBook		is a Book
				PrmDispose 	is Numeric 1

			Action Rules
				LocalBook				= PrmBook
				invoke UpdateDisposedBook LocalAssetBookRel
					invoked.PrmDispose 						= PrmDispose


		UpdatePostingDate is an Instance Action
			Parameters
				NewPostingDate is Date
			Action Rules
				if (UnreleasedAssetTransactionsRel exist)
					for each UnreleasedAssetTransactionsRel
						invoke UpdateTransactionDate each
							invoked.PostingDate = NewPostingDate

				if (UnreleasedAssetBookTransactionsRel exist)
					for each UnreleasedAssetBookTransactionsRel
						invoke UpdateTransactionDate each
							invoked.PostingDate = NewPostingDate
					
		
		Delete is a Delete Action

		
		Purge is a Purge Action
			bypass relational integrity rules
			restricted
		
		CreateJournalEntries is an Instance Action
			restricted
			Entrance Rules
				LocalDisposalDate			= TransientDisposalDate
				LocalPurge	= false
				if (UnreleasedAssetTransactionsRel exists)
					invoke Delete UnreleasedAssetTransactionsRel
				if (UnreleasedAssetBookTransactionsRel exists)
					invoke Delete UnreleasedAssetBookTransactionsRel				
				if (AssetDisposalRel.FullDisposal)
					LocalAsset = Asset
				else
					LocalAsset = Asset.DisposedAsset
				if (AssetDisposalRel.PostingDate entered)
					LocalPostingDate	= AssetDisposalRel.PostingDate
				else
				if (DisposalRel.PostingDate entered)
					LocalPostingDate 	= DisposalRel.PostingDate
					


					
					
			Action Rules
				if (!AssetDisposalRel.DisposalMethod.Purged)
					if ((Book entered
					and !Asset.Simulated)
					and (Basis entered
					or CostOfSale entered
					or Proceeds entered))
						if (TaxCreditRecapture entered
						and TaxCreditRecapture changed
						and AssetBookRel.YearPlacedInService <= 60)
							include RecalcGainLoss
						LocalBook = Book
						LocalImpairmentAmountForDisposal = ImpairmentAmountForDisposal

						if (BookCalendarsRel.PostingBook = "Y")
							if (!Book.Impairment)
								include CreateJE
							else
							if (Book.Impairment)
								include CreateImpairmentTransactions
								include ImpairmentAmortizationTransactionBackOff
	
						if (BookRel exists)
							if (BookCalendarsRel exists)
								if (BookCalendarsRel.PostingBook = "N"
								and !Asset.Simulated)
									if (!Book.Impairment)
										include CreateAbkJE
									else
									if (Book.Impairment)
										include CreateImpairmentBookTransactions
										include ImpairmentAmortizationBookTransactionBackOff

		UpdateFromReinstatement is an Instance Action
			restricted
			Parameters
				PrmBasis					is an InternationalAmount
				PrmLifeRemaining			is an LifeRemaining
				PrmYTDDisposedMonths		is a YearToDateDisposedMonths
				PrmYearToDateDepreciation	is an InternationalAmount
				PrmLifeToDateDepreciation	is an InternationalAmount
				PrmSalvageValue				is an InternationalAmount
			Action Rules
				SelectedForReinstatement = true
				invoke UpdateFromReinstatement AssetBookRel	
					invoked.PrmYearToDateDepreciation		= YearToDateDepreciation
					invoked.PrmLifeToDateDepreciation		= LifeToDateDepreciation	
					invoked.PrmReinstateBookDisposal		= true

				

		ProcessPurge is an Instance Action
			restricted
			Parameters
				PrmBook						is a Book
				
			Action Rules
				LocalBook					= PrmBook
				LocalPurge					= true
				if (BookRel exists)
					if (BookCalendarsRel exists)
						if (BookCalendarsRel.PostingBook = "N")
							if (AssetBKASTAmt entered) 
								include CreateBKAstJE
							if (AssetACMAmt entered)
								include CreateBKAcmJE
							if (AssetEXPAmt entered)
								include CreateBKExpJE 
							if (AssetCLRAmt entered) 
								include CreateBKClrJE
						else
							if (AssetASTAmt entered) 
								include CreateAstJE

							if (AssetACMAmt entered)
								include CreateAcmJE

							if (AssetEXPAmt entered)
								include CreateExpJE 
							if (AssetCLRAmt entered) 
								include CreateClrJE
							LocalJEExist = true
							
		UpdateFromDisposalProcess is an Instance Action
			restricted
			Parameters
				PrmBasis							is an InternationalAmount
				PrmYearToDateDepreciation			is an InternationalAmount
				PrmYearToDateDepreciationOverride	is an InternationalAmount
				PrmYearToDateDepreciationAllowed	is an InternationalAmount
				PrmLifeToDateDepreciation			is an InternationalAmount
				PrmLifeToDateDepreciationAllowed	is an InternationalAmount
				PrmSalvageValue						is an InternationalAmount
				PrmFirstYearExpenseAmount			is an InternationalAmount
				PrmTaxCreditPropertyAmount			is an InternationalAmount
				PrmTaxCredit						is an InternationalAmount
				PrmActualInsuranceValue				is an InternationalAmount
				PrmCalculatedInsuranceValue			is an InternationalAmount
				PrmCalculatedReplacementValue		is an InternationalAmount
				PrmProceeds							is an InternationalAmount
				PrmCostOfSale						is an InternationalAmount
				
			Action Rules
				Basis 								+= PrmBasis							
				YearToDateDepreciation 				+= PrmYearToDateDepreciation			
				YearToDateDepreciationOverride		+= PrmYearToDateDepreciationOverride	
				YearToDateDepreciationAllowed 		+= PrmYearToDateDepreciationAllowed	
				LifeToDateDepreciation 				+= PrmLifeToDateDepreciation
				LifeToDateDepreciationAllowed 		+= PrmLifeToDateDepreciationAllowed	
				SalvageValue 						+= PrmSalvageValue						
				FirstYearExpenseAmount 				+= PrmFirstYearExpenseAmount			
				TaxCreditPropertyAmount 			+= PrmTaxCreditPropertyAmount			
				TaxCredit 							+= PrmTaxCredit						
				ActualInsuranceValue 				+= PrmActualInsuranceValue				
				CalculatedInsuranceValue 			+= PrmCalculatedInsuranceValue			
				CalculatedReplacementValue 			+= PrmCalculatedReplacementValue		
				Proceeds 							+= PrmProceeds							
				CostOfSale 							+= PrmCostOfSale
		
		AssetBookDisposalPurge is a Set Action
			restricted
			Parameters
				PrmFinanceEnterpriseGroup		is a FinanceEnterpriseGroup
				PrmAsset						is an Asset
				PrmBook							is a Book
				PrmPurgeOption					is Numeric 1
					default label is "ActionOption"
					States
						PurgeRecords 	value is 1
						ReportOnly		value is 2
				PrmCompany						is like Company
						
			Parameter Rules
				PrmFinanceEnterpriseGroup
					LocalFinanceEnterpriseGroup 		= PrmFinanceEnterpriseGroup
				PrmBook
					LocalBook 							= PrmBook
				PrmAsset
					LocalAsset = PrmAsset
			Local Fields
				LocalCounter					is Numeric 10
			Instance Selection
				include deleted records
				where(FinanceEnterpriseGroup					= PrmFinanceEnterpriseGroup
				and	  Book										= PrmBook
				and   Asset.Company								= PrmCompany
				and   (PrmAsset not entered 	or Asset		= PrmAsset))
			Action Rules
				Set Rules
					Exit Rules

				Instance Rules

					if(PrmPurgeOption.PurgeRecords)
						invoke Purge

