CustodialAttachment is a BusinessClass
	owned by cam

	prefix is CamAh

	Ontology
		symbolic key is CustodialAttachment

	Patterns

	Persistent Fields
		DocumentId				is Alpha 100
    	Description 			is Alpha size up to 500
    	DocumentURL				is URL
    	Attachment				is an AlternateAttachment

	Field Rules

	Local Fields
		LocalAttributeCtr   is Numeric 2

    Conditions
		HasAttachment
			restricted
			when (Attachment entered)
		HasURL
			restricted
			when (DocumentURL entered)
	
	Create Rules  
		include IDM.CreateRules 
			replace AttachmentField with Attachment
							
	Delete Rules
		include IDM.DeleteNoArchiveRules
			replace AttachmentField with Attachment

	Commit Rules
		include IDM.CommitRules
			replace AttachmentField with Attachment
	
	Actions

		Create is a Create Action

		Update is an Update Action

		Delete is a Delete Action
		
		UploadToIDM is an Instance Action  
			valid when (Attachment.ValidForIDMUpload)
			Action Rules
				include IDM.MoveAttachmentsToIDM
					replace AttachmentField   with Attachment	
						
									
		MoveAttachmentsToIDM is a Set Action
			restricted
			Instance Selection
				where (Attachment.IsLocal)

			Accumulators
				InstanceCount

			Action Rules
				Instance Rules
					increment InstanceCount	

					include IDM.MoveAttachmentsToIDM
						replace AttachmentField   with Attachment			

					commit transaction

					if (InstanceCount = config.IDM_MOVE_ATTACHMENTS_LIMIT)
						end set action instance loop	
