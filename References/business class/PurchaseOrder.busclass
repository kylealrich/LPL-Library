PurchaseOrder is a BusinessClass
	owned by po
	prefix is PCR
	classic name is PURCHORDER

	Ontology
		symbolic key is PurchaseOrder
			classic set name is PCRSET0

	Patterns
		implements ContextualParent
		implements StaticJava
		implements BODId
		disable AuditIndex
		implements AnalyticCube
			disable continuous update
			dynamically calculate totals
			write to base level only
		implements ForceUIRefreshOnStale
		implements Archivable

	Persistent Fields
		PORelease
			protected
		POCode
		Reference1							is a Reference
		Reference2							is a Reference
		PurchaseOrderRevision
			classic name is PO-REVISION
			protected
		VendorReturn
			classic name is RETURN-NUMBER
		Vendor
		PurchaseFromLocation is a VendorLocation
			classic name is PURCH-FR-LOC
		Buyer
			classic name is BUYER-CODE
		BlanketOrStandingContract			is a Contract
		PurchaseOrderDate					is Date
			classic name is PO-DATE
		PurchaseOrderObjectID
			classic name is PO-OBJ-ID
		Currency
			classic name is CURRENCY-CODE
		CurrencyTable
		EnteredCurrencyConversionRate
			classic name is ENT-CNV-RATE
		CurrencyExchangeSetPoint
			classic name is CURR-SET-FLAG
		ReceiptCurrencyConversionRate		is an EnteredCurrencyConversionRate
			classic name is REC-CNV-RATE
		Revalue								is Boolean
			classic name is REVALUE-FLAG
		DefaultDeliveryDate					is Date
			classic name is DFLT-DL-DATE
		ShipToLocation						is an InventoryLocation
			classic name is LOCATION
		Dropship							is Boolean
			classic name is DROPSHIP-FL
		DropshipName						is a VendorName 
			holds pii
			classic name is SH-NAME
		DropshipAddress						is a PostalAddressV2	
			holds pii
			classic name for DropshipAddress.DeliveryAddress.AddressLine1 is SH-ADDR1
			classic name for DropshipAddress.DeliveryAddress.AddressLine2 is SH-ADDR2
			classic name for DropshipAddress.DeliveryAddress.AddressLine3 is SH-ADDR3
			classic name for DropshipAddress.DeliveryAddress.AddressLine4 is SH-ADDR4
			classic name for DropshipAddress.Municipality is SH-CITY-ADDR5
			classic name for DropshipAddress.StateProvince is SH-STATE-PROV
			classic name for DropshipAddress.PostalCode is SH-POST-CODE
			classic name for DropshipAddress.County is SH-COUNTY
			classic name for DropshipAddress.Country is SH-COUNTRY-CD
			classic name for DropshipAddress.Region is DEST-REGION
		DropshipPhoneNumber					is a TelephoneNumber 
			holds pii
			classic name for DropshipPhoneNumber.InternationalPrefix is SH-PHONE-PREF
			classic name for DropshipPhoneNumber.SubscriberNumber is SH-PHONE
			classic name for DropshipPhoneNumber.Extension is SH-PHONE-EXT
		DropshipContact						is an AddressContact
			classic name is SH-CONTACT
		NumberOfLines
			classic name is NBR-LINES
			disable Auditing
		NumberOfClosedLines
			classic name is CLOSED-LINES
			disable Auditing
		PrintReceipt						is Boolean
			classic name is PRT-REC-FLAG
		FaxNumber 
			holds pii
			classic name for FaxNumber.InternationalPrefix is FAX-PREFIX
			classic name for FaxNumber.SubscriberNumber is FAX-NUMBER
			classic name for FaxNumber.Extension is FAX-EXT
		EmailAddress						is an EmailAddressMulti 
			holds pii
		ProcessLevel						is a PayablesProcessLevel
		StockWeight							is Decimal size 12.3
			classic name is WEIGHT
			disable Auditing
		StockVolume							is Decimal size 12.3
			classic name is CUBIC-FEETTOT-PRD-AMT
			disable Auditing
		FreightTerm
			classic name is FREIGHT-TERMS
		ShipTerm
			classic name is FOB-CODE
		ShippingMethod						is a ShipVia
			classic name is SHIP-VIA
		ShippingNotes						is Text
		TermCode							is a TermsCode
		TaxCode
		TotalProductAmount					is an InternationalAmount
			classic name is TOT-PRD-AMT
			disable Auditing
			protected
		TotalTaxableAmount					is an InternationalAmount
			classic name is TOT-TAXBL-AMT
			disable Auditing
			protected
		LetterOfCredit
			classic name is LETTER-OF-CR
		TotalOrderAmount					is an InternationalAmount 
			classic name is TOT-ORDER-AMT
			disable Auditing
			protected
		UserDate1							is Date
		UserDate2							is Date
		LastPurchaseOrderLine				is a LineNumber
			classic name is LAST-LINE-NBR
			disable Auditing
		DefaultTaxable						is Boolean
			classic name is DFLT-TAXBL-FL



		DefaultSourceInformation
			classic name for DefaultSourceInformation.DefaultSourceDocument is DFLT-SRC-DOC
			classic name for DefaultSourceInformation.DefaultDeliverTo is DFLT-DEL-TO
			classic name for DefaultSourceInformation.DefaultOperatingCompany is DFLT-OPER-CO
			classic name for DefaultSourceInformation.DefaultRequestingLocation is DFLT-REQ-LOC
			classic name for DefaultSourceInformation.DefaultRequester is DFLT-REQUESTER
		DefaultAssetTemplate				is an AssetTemplate
			classic name is DFLT-ASSET-TEM
		DefaultAsset						is an Asset
			classic name is DFLT-ASSET-NBR
		Released							is Boolean
			classic name is RELEASED-FL
			protected
		Issued								is Boolean
			classic name is ISSUED-FLAG
			protected
		Revised								is Boolean
			classic name is REVISED-FL
			protected
		Canceled							is Boolean
			classic name is CANCELLED-FL
			protected
		Closed								is AlphaUpper size 1
			classic name is CLOSED-FL
			protected
			States
				Yes			value is "Y"
				No			value is "N"
				Historical	value is "H"
		LastActivityDate					is Date
			classic name is LAST-ACTIVITY
			disable Auditing
		CloseDate							is Date
		PurchaseOrderUserField1
			classic name is PO-USER-FLD-1
		PurchaseOrderUserField3				is a UserField2
			classic name is PO-USER-FLD-3
		PurchaseOrderUserField5				is a UserFld2
			classic name is PO-USER-FLD-5
		InvoiceMethod
			classic name is INVC-MTHD-CODE
		IssueMethod							is a PurchaseOrderIssueMethod
			classic name is ISSUE-METH
		RevisionsInclude					is AlphaUpper size 1
			classic name is REVISIONS-INCL
			States
				RevisionsOnly		value is "O"
				RevisionsComplete	value is "C"
				Reissue				value is "I"
				NotApplicable		value is "N"
				NotRevised			value is blank
		IssuePending						is Boolean
			protected
		UserId								is a User
		AddOnChargeTotal					is an InternationalAmount
			classic name is PO-AOC-TOTAL
			disable Auditing
		TotalTaxAmount						is an InternationalAmount
			classic name is PO-TAX-TOTAL
			disable Auditing
		PrintTotal							is an InternationalAmount
			classic name is PO-PRINT-TOTAL
			disable Auditing
		VendorAddOnChargeAmount				is an InternationalAmount
			classic name is POV-AOC-TOTAL
			disable Auditing
		VendorInvoicedTaxAmount				is an InternationalAmount
			classic name is POV-ITAX-TOTAL
			disable Auditing
		VendorGrandTotal					is an InternationalAmount
			classic name is POV-GRD-TOTAL
			disable Auditing
		OtherVendorAddOnChargeAmount		is an InternationalAmount
			classic name is OV-AOC-TOTAL
			disable Auditing
		OtherVendorInvoicedTaxAmount		is an InternationalAmount
			classic name is OV-ITAX-TOTAL
			disable Auditing
		OtherVendorGrandTotal				is an InternationalAmount
			classic name is OV-GRD-TOTAL
			disable Auditing
		AccruedTaxTotal						is an InternationalAmount
			classic name is ACCR-TAX-TOTAL
			disable Auditing
		OpenPurchaseAmount					is an InternationalAmount
			classic name is OPEN-PO-AMT
			disable Auditing
		UnloadingPort
		NatureOfTransactionCode				is an IntrastatNatureOfTransactionCode
			classic name is NOTC
			default label is "Nature_ofTransactionCode"
		StatisticalProcedure				is an IntrastatStatisticalProcedure
			classic name is STAT-PROC
		PurchaseOrderRecordSource			is Numeric size 2
			restricted
			classic name is RECORD-SOURCE
			States
				Po20  value is 1
					default label is "PO20"
				Po23  value is 2
					default label is "PO23"
				Po27  value is 3
					default label is "PO27"
				Po29  value is 4
					default label is "PO29"
				Po100 value is 5
					default label is "PO100"
				Po101 value is 6
					default label is "PO101"
				Po520 value is 7
					default label is "PO520"
		SubcontractorPurchaseOrder			is Boolean
			classic name is SUBCONTRACT-PO
		Approved							is Boolean
			classic name is PO-APPROVED
		ProcessFlowApprovalLevel
			classic name is PFLOW-APRV-LVL
		ShipToArriveDate					is Date
			classic name is SHIP-TO-ARRIVE
		CrossReferenceVendor
			classic name is XREF-VENDOR
		WarehouseNumber
			classic name is WRHS-NUMBER
		MatchPrepayment						is Boolean
			classic name is MTCH-PRPY-FL
		ImageNumber
		PurchaseOrderBillToName				is a Name	 
			holds pii
			classic name is POB-NAME
		PurchaseOrderBillToAddress			is a PostalAddressV2	
			holds pii
			classic name for PurchaseOrderBillToAddress.DeliveryAddress.AddressLine1 is POB-ADDR1
			classic name for PurchaseOrderBillToAddress.DeliveryAddress.AddressLine2 is POB-ADDR2
			classic name for PurchaseOrderBillToAddress.DeliveryAddress.AddressLine3 is POB-ADDR3
			classic name for PurchaseOrderBillToAddress.DeliveryAddress.AddressLine4 is POB-ADDR4
			classic name for PurchaseOrderBillToAddress.Municipality is POB-CITY-ADDR5
			classic name for PurchaseOrderBillToAddress.StateProvince is POB-STATE-PROV
			classic name for PurchaseOrderBillToAddress.PostalCode is POB-POSTAL-CD
			classic name for PurchaseOrderBillToAddress.County is POB-COUNTY
			classic name for PurchaseOrderBillToAddress.Country is POB-CONTRY-CD
		PurchaseOrderBillToContact			is an AddressContact
			classic name is POB-CONTACT
		UseProcurementCard					is Boolean
			classic name is P-CARD-FLAG
		ProcurementCardNumber
			classic name is PCARD-NBR
		RetainagePercentCompleteTracking	is Numeric size 1
			sql name is RPercentCompleteTracking
			classic name is RET-TRK-PCT-CP
			States
				NoRetainage			value is 0
				PurchaseOrderLevel	value is 1
				LineLevel			value is 2
				Contract			value is 3
		RetainageFirstPercent				is a Pct
			classic name is RET-PCT-1
		RetainageSecondPercent				is a Pct
			classic name is RET-PCT-2
		RetainageUpToPercentComplete		is a Pct
			classic name is RET-UP-TO-PCT
		RetainagePercentComplete			is a Pct
			classic name is RET-PCT-COMP
		RetainageOverridePercentComplete	is a Pct
			sql name is ROverridePercentComplete
			classic name is RET-OVRD-PCT
		RetainageDueDate					is Date
			classic name is RET-DUE-DATE
		PurchaseOrderLineTotal				is an InternationalAmount 
			classic name is PO-EXT-AMT
			disable Auditing
		TotalMatchedAmount					is an InternationalAmount 
			classic name is PO-MATCH-AMT
			disable Auditing
		PurchaseOrderBillToPhoneNumber		is a TelephoneNumber 
			holds pii
			classic name for PurchaseOrderBillToPhoneNumber.InternationalPrefix is POB-PHONE-PREF
			classic name for PurchaseOrderBillToPhoneNumber.SubscriberNumber is POB-PHONE
			classic name for PurchaseOrderBillToPhoneNumber.Extension is POB-PHONE-EXT
		PurchaseOrderBillToEmailAddress		is an EmailAddressMulti 
			holds pii
			sql name is POrderBillToEmailAddress
			classic name is POB-EMAIL-ADDR
		PurchaseOrderUserField7				is a UserFld7
			classic name is PO-USER-FLD-7
		DefaultEAMWorkOrder					is a WorkOrderNumber
			classic name is DFLT-EAM-WO
		ReasonCode
		AttainedLevel						is an ApprovalLevel
			classic name is ATTAIN-LEVEL
		ApprovalLevel
			classic name is APRV-LEVEL
		LastApprovalDate					is Date
			classic name is LAST-APRV-DT
		Rejected							is Boolean
		PurchaseOrderApprovalType
			classic name is APPROVAL-TYPE
		CreatedBy							is an Operator 
			holds pii
		LastUpdateDate						is TimeStamp
			classic name is LAST-UPDT-DATE
		LastUpdateBy						is an Operator 
			holds pii
		FreightTotal						is an InternationalAmount
			classic name is FREIGHT-TOT
			disable Auditing
		InsuranceTotal						is an InternationalAmount
			classic name is INSURANCE-TOT
			disable Auditing
		CustomsTotal						is an InternationalAmount
			classic name is CSTMS-TOT
			disable Auditing
		OtherAddOnChargesTotal				is an InternationalAmount
			classic name is OTHER-AOC-TOT
			disable Auditing
		DefaultProcedureInformation
			restricted
			classic name for DefaultProcedureInformation.DefaultProcedure is DFLT-PROC
			classic name for DefaultProcedureInformation.DefaultProcedureModifier is DFLT-PROC-MOD-
			classic name for DefaultProcedureInformation.DefaultProcedureDate is DFLT-PROC-DATE
			classic name for DefaultProcedureInformation.DefaultPractitioner is DFLT-PHYS-NAME
			classic name for DefaultProcedureInformation.DefaultNurseCoordinator is DFLT-NRS-COORD
			classic name for DefaultProcedureInformation.DefaultSalesRepresentative is DFLT-SALES-REP
			classic name for DefaultProcedureInformation.DefaultSupplierOrderNumber is DFLT-ORD-NBR
			classic name for DefaultProcedureInformation.DefaultRequester is DFLT-REQUESTOR
			classic name for DefaultProcedureInformation.DefaultUserDefined1 is DFLT-USERDEF1
			classic name for DefaultProcedureInformation.DefaultUserDefined2 is DFLT-USERDEF2
		PatientProcedure
			restricted
			delete ignored
		DefaultBillCode						is a ConsignCode
			classic name is DFLT-CN-CODE
		GlobalDocumentType
			classic name is GLBL-DOC-TYPE
		DefaultDistributionAccount			is a FinanceCodeBlock
			classic name for DefaultDistributionAccount.ToAccountingEntity is DFLT-DIST-CO
			classic name for DefaultDistributionAccount.AccountingUnit is DFLT-ACCT-UNIT
			classic name for DefaultDistributionAccount.GeneralLedgerChartAccount is DFLT-ACCOUNT
			classic name for DefaultDistributionAccount.Project is DFLT-ACTIVITY
		PurchaseOrderLifeCycleState			is Numeric size 1
			States
				Unreleased			value is 0
				Released			value is 1
				Canceled			value is 2
				Closed				value is 3
				Historical			value is 4
				ReleaseInProgress	value is 5
				CreateInProgress	value is 6
				Deleted				value is 7
				CancelInProgress	value is 8
				DeleteInProgress	value is 9
		ApprovalStatus						is Numeric size 1
			States
				DoesNotGoThroughApproval	value is 0
				NeedsApproval				value is 1
				Approved					value is 2
		CreateForVendorReturn				is Numeric size 10
		PurchaseOrderDocument
			default label is "DocumentTemplate"
		ProcurementTemplate
		BudgetEditProcessing 				is Numeric size 1
			States
				NotInProcessing	value is 0
				InProcess		value is 1
				Failure			value is 2
				Success			value is 3
		InterfaceInProcess					is Numeric size 1
			States
				NotInProcess	value is 0
				CreateInProcess	value is 1
				UpdateInProcess	value is 2
		OriginatingInterfaceRun				is a PurchaseOrderInterfaceResult
			delete ignored
		PurchaseOrderReleaseMessages		is Numeric size 2
			States
				NoMessage value is blank
				OpenPOAmtExceedPurchFromLocLimit						value is 1
					default label is "OpenPurchaseOrderAmountsExceedLimitForVendorPurchaseFromLocation"
				OpenPOAmtExceedVendorLimit								value is 2
					default label is "OpenPurchaseOrderAmountsExceedLimitSetForVendor"
				POExceedsPurchFromLocPerPOLimit							value is 3
					default label is "PurchaseOrderExceedsPerPurchaseOrderLimitForVendorPurchaseFromLocation"
				POTotalLessThanPurchFromLocMinAmt						value is 4
					default label is "PurchaseOrderTotalIsLessThanPurchaseFromLocationMinimumAmount"
				OrderWeightLessThanPurchFromLocMinimum					 value is 5
					default label is "OrderWeightIsLessThanVendorPurchaseFromLocationMinimum"
				POExceedsVendorPerPOLimit								value is 6
					default label is "PurchaseOrderExceedsPerPurchaseOrderLimitForVendor"
				POTotalLessThanVendorMinAmt								value is 7
					default label is "PurchaseOrderTotalIsLessThanVendorMinimumAmount"
				OrderWeightLessThanVendorMinimum						value is 8
					default label is "OrderWeightIsLessThanVendorMinimum"
				POExceedsBuyerPerPOLimit								value is 9
					default label is "PurchaseOrderExceedsPerPurchaseOrderLimitForBuyer"
				POLimitExceedsPCardTransactionLimit						value is 10
					default label is "PurchaseOrderLimitExceedsP-CardTransactionLimit"
				InvoiceNotRequiredAndNoItemsToInvoice					value is 11
					default label is "CannotRelease,InvoiceMethodSetToNotRequiredAndNoItemsToInvoice"
				RetainageOnLinePOCannotBeContractOrNonRetainage			value is 12
					default label is "RetainageOnLine;PurchaseOrderCannotBeContractRelatedOrNonRetainage"
				ContractRetainageOnLinePOShouldHaveContractRetainage	value is 13
					default label is "ContractRetainageOnLinePurchaseOrderShouldAlsoHaveContractRetainage"
				RetainageFirstPercentIsRequired							value is 14
					default label is "RetainageFirstPercentIsRequired"
				RetainageUpToPercentCompleteIsRequired					value is 15
					default label is "RetainageUpToPercentCompleteIsRequired"
				PONotRetainageDoNotEnterRetainageFirstPercent			value is 16
					default label is "NonRetainagePurchaseOrder;DoNotEnterRetainageFirstPercent"
				PONotRetainageDoNotEnterRetainageSecondPercent			value is 17
					default label is "NonRetainagePurchaseOrder;DoNotEnterRetainageSecondPercent"
				PONotRetainageDoNotEnterRetainageUpToPercentComplete	value is 18
					default label is "NonRetainagePurchaseOrder;DoNotEnterRetainageUpToPercentComplete"
				RetainageDueDateMustBeGreaterThanPurchaseOrderDate		value is 19
					default label is "RetainageDueDateMustBeGreaterThanPurchaseOrderDate"
				RetainageOverridePercentCompleteOnLine					value is 20
					default label is "RetainageAtPurchaseOrderLevel;CannotHaveLineRetainageOverridePercentage"

		LetterOfGuarantee
			classic name is LTR-OF-GUARAN
		EAMWorkOrder
		EAMWorkOrderActivity
		IDMDocumentPID						is an DocumentPID

			restricted
			protected
			disable Auditing
		IDMDocumentSequence					is Numeric size 3
			restricted
			protected
			disable Auditing
		SuppressPOCost						is Boolean
		RequireWO							is Boolean
		RequireAttachment					is Boolean
		BlanketPO							is Boolean
		LegacyPO							is Boolean
		AribaPOType
		EDIOutputOrderAmount				is an InternationalAmount  
			disable Auditing
		IDMJob
			protected
			delete ignored
			disable Auditing
		QuoteNumber							is Alpha size 30
		Confirming							is Boolean
		ExternalRequisition  				is an ExternalReqNbr  
		PurchaseOrderIDMTemplate			is an IDMTemplate
			default label is "DocumentTemplate"
		IDMPrinter
			disable Auditing
		AcknowledgedViaSupplierPortal		is Boolean
    	TemporaryHold                 is AlphaUpper size 1
       	 	classic name is TEMP-HOLD	
       	 	States
         	   	ApprovedByEngine value is "A"
         	       	default label is "Approved by Engine"
          	  	SentForApproval  value is "S"
          	      	default label is "Sent for Approval"
				RejectedByEngine value is "R"
					default label is "Rejected by Engine"
			
		PointOfTitleTransfer
		PurchaseOrderIDMXMLFile 			is an Attachment
		IDMMassPOIssueBatchID				is Alpha 20
		DeliveryMethod

	Transient Fields

		StandardCommentCode
		TransientTemplateDisplaySequence								is Numeric size 1
			States
				Line						value is 1
				Item						value is 2
		TransientTemplateDefaultAccountingUnit							is AlphaUpper size 20
		TransientContactCode											is a VendorContact
		TransientFromMassPOCreateAndRelease                             is Boolean
		TransientCancelOriginationProgram								is Numeric size 2
			States
				PurchaseOrder						value is 0
				Receiving							value is 1
				VendorReturns						value is 2
				Invoicing							value is 3
				PurchaseOrderInterface				value is 4
				Contract    						value is 5
				ReceivingAdjustment					value is 6
		TransientDropShipToInventoryLocationAddress						is Boolean

		TransientReceivingOptions						is Numeric size 1
			default label is "DropshipReceivingOptions"
			derive value from Dropship
			States
				ReceivingRequired			value is 0
				ReceivingNotAllowed			value is 1
		TransientMessage												is Alpha size 75
		TransientReleaseOriginationProgram			is Numeric size 2
			States
				Receiving							value is 1
				Cancel								value is 2
				OnlineAuthorization					value is 3

		TransientOldPOAOCAmount 				is an InternationalAmount 
		TransientOldPOPrtAmount 				is an InternationalAmount 
		TransientOldPOTaxAmount 				is an InternationalAmount 
		TransientOldPOVGrdAmount				is an InternationalAmount 
		TransientOldOVGrdAmount					is an InternationalAmount 
		TransientOldTotOrdAmount				is an InternationalAmount 
		FromInterfaceUpdate                     is Boolean
		PurchaseOrderUpdateFromMatchUnmatchFlag is Boolean


		TransientCopyAllLines		is Boolean
		TransientFromSourcing       is Boolean


		TransientVisitNumber					 is a PatientVisit
			derive value from DerivedTranVisitNumber

		TransientPatientID                       is a Patient
			derive value from DerivedTranPatientID

		TransientCaseNumber						 is a CaseNumber
			derive value from DerivedTranCaseNumber

	   	TransientPatientLastName                 is a LastName
	   		derive value from DerivedTranPatientLastName

		TransientPatientFirstName                is a FirstName	 
			holds pii
			derive value from DerivedTranPatientFirstName

		TransientPatientMiddleName            	 is a MiddleName
			derive value from DerivedTranPatientMiddleName

		TransientBirthdate						 is Date
			derive value from DerivedTranBirthdate

		TransientGender							 is a Gender
			derive value from DerivedTranGender

		TransientSocialSecurityNumber			 is a TaxID 
			holds pii
			derive value from DerivedTranSocialSecurityNumber


		TransientGLCalendarPeriod 				is a GeneralLedgerCalendarPeriod	
			derive value from GeneralLedgerCalendarPeriodXrefRel.GeneralLedgerCalendarPeriod
		TransientMassIssue						is Boolean
		TransientCurrencyMultDiv				is Numeric size 1
			derive value from DerivedCurrencyMultDiv
			States		
				Multiply value is 0
				Divide   value is 1

	Local Fields
		LocalUseBatchRelease									is Boolean
		LocalCopiedPurchaseOrderLineCount						is Numeric size 6
		LocalUpdatedFromLine									is Boolean
		IntrastatProcessing
		LocalForIssueFinal						 				is Boolean
		LocalNumberOfCanceledLines				 				is Numeric size 9
		LocalCashCode							 				is a CashCode
		LocalRequisition            			 				is a Requisition
		LocalRetainagePercentComplete 	is a Pct
		RoundedValue
		LocalVendorChanged										is Boolean
		LocalQuantityAvailableToMatch							is like Quantity
		LocalCurrencyExchange             	 is a CurrencyExchange
		LocalProcurementCardProgram			 is like ProcurementCardProgram
		LocalProcurementCardRequest			 is like ProcurementCardRequest
		LocalFromCurrency					 is a FromCurrency
		LocalTransactionAmount				 is a CurrencyAmount
		LocalExchangeDate					 is a ExchangeDate
		LocalMessageLineCount				 is Numeric size 3
		ActionCode			is Alpha size 1
			States
				Create  value is "C"
				Update	value is "U"
				Delete	value is "D"
		LocalBODCurrentTimeStamp		is a BODCurrentTimeStamp
		LocalDiversityCode              is a PayablesDiversityCode

		LocalFromInterface				is Boolean
		LocalPatientProcedureView       is a PatientProcedure view
		LocalPatientProcedure			is like PatientProcedure
		LocalFromVendorReturn			is Boolean
		LocalDeleteHeader 				is Boolean
		LocalOpenPurchaseAmount			is an InternationalAmount
		LocalOpenTaxAmount				is an InternationalAmount
		LocalContractMaxEditValue       is an InternationalAmount
		LocalGotIDMDocumentURL			is Boolean
		LocalTrigger								is Alpha 1
		LocalAddOnChargeTotalComputed	is Boolean
		LocalAOCTotal					is an InternationalAmount
		LocalProcessLevel               is like PayablesProcessLevel
		LocalCancelFromPO				is Boolean
		LocalPOInterfaceResult			is a POInterfaceResult
		LocalContract                   is like Contract
		LocalCompany					is like Company
		LocalPayablesInvoice			is like PayablesInvoice
		LocalPurchaseOrderLine			is like PurchaseOrderLine
		LocalMimeType					is MimeType
		IDMAttributes
		IDMGenerateDocument
		IDMXMLDefinition
		AttributeCtr					is Numeric 2
		LocalExecute					is Boolean
		RetrievedIDMXML					is Boolean
		LinePreviouslyReleased          is Boolean
		LocalColSequence               	is Numeric size 3
		IDMItem
		NewPOCommentView				is a PurchaseOrderComment view
		LocalFileName					is Alpha size 105
		BypassTermCodeDefaulting		is Boolean
	    LocalCancelRemainingPurchaseOrder	is Boolean		
		LocalAsyncBackgroundGroup       is AlphaUpper up to 200



		NativeLPLBODTrigger				is Boolean
		LocalPurchaseOrderLineXMLBOD	is XMLDocument
		LocalPurchaseOrderLineCounter	is Numeric 9
		NewBODTracker  					is a FSMInboundBODTracker view
		LocalFSMInboundBODTracker		is Numeric 15
		LocalAccountingEntity  			is Alpha 100
		Error            				is Boolean
	    ErrorMessage     				is Alpha 300
		LocalConfigurationParameter		is Alpha size up to 200
		LocalAEAlreadyExecuted			is Boolean



		LocalProcessPurchaseOrderLineXMLBOD	is XMLDocument
		LocalProcessPurchaseOrderLineCounter	is Numeric 9
		LocalProcessFSMInboundBODTracker		is Numeric 15




		LocalIDMEmailSubject			is Alpha 255
			Text Variables
				Company	  				value is Company
				CompanyName				value is Company.Name
				PurchaseOrder  			value is PurchaseOrder
				Buyer		  			value is Buyer
				Vendor					value is Vendor
				VendorName				value is Vendor.VendorName

		LocalIDMPODocumentFileName		is Alpha 255
			Text Variables
				Company	  				value is Company
				CompanyName				value is Company.Name
				PurchaseOrder  			value is PurchaseOrder
				Buyer		  			value is Buyer
				Vendor					value is Vendor
				VendorName				value is Vendor.VendorName
				IssueMethod				value is IssueMethod
				IssueState				value is DerivedIssueState

		LocalForIssueDraft				is Boolean
		LocalIDMAttachmentCtr			is Numeric size 3
		LocalFromBatch					is Boolean
		LocalPurgePurchaseOrder			is Boolean
		LocalPurgeCount					is Numeric 10
		LocalPurgeRecords				is Boolean
		LocalActor						is an Actor
		LocalIDMBatchID					is an IDMPID
		LocalIssueInProgress			is Boolean
		LocalFromUnreleased 			is Boolean
		DoDebug							is Boolean
		IDMBatchOperation
		FailedIDMConnection				is Boolean
		LocalTransactionCount           is Numeric size 6
		LocalTransactionErrorMessage	is Alpha 150
		LocalReleaseError				is Boolean
		LocalMassBODTrigger				is Boolean
		LocalProcessPOTitle				is Alpha up to 255
		LocalSyncPOTitle				is Alpha up to 255
		LocalSupplier                   is like Supplier
		LocalSupplierContact            is like SupplierSourceId
		LocalGeneralLedgerCompanyGroup	is like GeneralLedgerCompanyGroup		
		ValidateBuyer
		LocalCopyComments				is Boolean
		LocalPhoneNumber 				is Alpha 100
		LocalReportFinanceEnterpriseGroup 	is like FinanceEnterpriseGroup
		LocalPurchaseOrderResult			is like PurchaseOrderResult
		CurrencyExchange
		SavedTransactionAmount			is a CurrencyAmount
		SavedExchangeDate				is a ExchangeDate
		SavedFromCurrency				is a FromCurrency
		LocalContractExtendedAmount	 	is an InternationalAmount
        LocalCurrencyRelationship		is a CurrencyRelationship

	Context Fields
		PurchaseOrderDateRange		is a DateRange
		DefaultDeliveryDateRange	is a DateRange2
		PayablesInvoice
		SupplyManagementReport
		AccountingEntity
		AccountingUnit
		Account
		Project
		FinanceDimension1
		FinanceDimension2
		FinanceDimension3
		FinanceDimension4
		FinanceDimension5
		FinanceDimension6
		FinanceDimension7
		FinanceDimension8
		FinanceDimension9
		FinanceDimension10
		AuditDateRange				is a DateRange
		SearchRequester				is a Requester
		SearchRequesterName			is a PresentationName
		ContextVendor				is a Vendor
		FSMInboundBODTracker
		AlternateShipToLocation
		
	Dimensions
		Buyer
			caption is "<Name>"
			Attributes
				BuyerGroup
				Name









		TransientGLCalendarPeriod
			dimension name is Calendar
			caption is "<AlternateCaption>"
			Attributes
				YTDCrossReference
				SamePeriodLastYear
				YTDCrossRefSPLY
				PeriodType
				PeriodTypeName
				NumberOfDays

		Closed
			dimension name is ClosedFlag

		Currency
			dimension name is CurrencyCode

		DerivedDropShipDimension
			dimension name is Dropship

		IssueMethod

		PurchaseOrderLifeCycleState
			dimension name is LifeCycle

		ShipToLocation
 			dimension name is Location
			Attributes
				Company
				Name
				LocationType
				LocationTypeDescription
				PostalAddress
				GlobalLocationNumber

		PurchaseOrder
			dimension name is PONumber
			Attributes
				Company
				PurchaseOrder
				Closed
				Issued
				Released
				Revised
				TaxCode

		ProcessLevel

		Vendor
			caption is representative text
			Attributes
				VendorGroup
				Vendor
				VendorName
				VendorStatus
				VendorClass
				ContactName
				Operator
				Project
			Hierarchies
				VendorClass
					base level included
					Attributes
						VendorGroup
						VendorClass


	Measures
		POCount
		TotalOrderAmount
		TotalProductAmount
		AddOnChargeTotal
		TotalTaxableAmount
		POsTransmittedElectronically
		TotalTaxAmount
		ReceiptHeaderCount


	Rule Blocks

		SetIDMXMLDefinitionValues
			initialize IDMXMLDefinition
			IDMXMLDefinition.Busclass											= reference to this instance
			IDMXMLDefinition.ListName											= "PurchaseOrderForIDM"
			IDMXMLDefinition.DocumentName										= "PurchaseOrder"
			IDMXMLDefinition.OutputFileName										= "Company_" + Company + "_" + "PurchaseOrder_" + PurchaseOrder + "_" + DerivedCurrentTimestamp

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].RelationName			= "PrintLinesRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListName 			= "PurchaseOrderLinesForIDMDoc"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].LevelSection1		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ListTag				= "Lines"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[1].ItemTag				= "Line"

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].RelationName			= "PrintablePurchaseOrderAndLineAddOnChargesForALineRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListName 			= "AOCForPOLineForIDM"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection1		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].LevelSection2		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ListTag				= "LineAddOnCharge"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[2].ItemTag				= "AddOnCharge"

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].RelationName			= "PrintOnPurchaseOrderLineCommentsRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ListName 			= "PurchaseOrderLineCommentsForIDM"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].LevelSection1		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].LevelSection2		= 2
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ListTag				= "LineComment"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[3].ItemTag				= "Comment"

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].RelationName			= "PurchaseOrderLineSourcesRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ListName 			= "PurchaseOrderLineSourcesForIDM"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].LevelSection1		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].LevelSection2		= 3
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ListTag				= "LineSource"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[4].ItemTag				= "Source"

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].RelationName			= "PrintBillOnlyDetailsRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ListName 			= "POLinePatientProcedureInformationForIDMDoc"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].LevelSection1		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].LevelSection2		= 4
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ListTag				= "LinePatientProcedureInformation"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[5].ItemTag				= "PatientProcedureInformation"

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].RelationName			= "ItemCommentToPrintRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ListName 			= "ItemCommentIDMList"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].LevelSection1		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].LevelSection2		= 5
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ListTag				= "LineItemComment"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[6].ItemTag				= "ItemComment"
			
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].RelationName			= "ItemCommentAttachmentRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ListName 			= "ItemCommentAttachmentForIDMList"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].LevelSection1		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].LevelSection2		= 5
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].LevelSection3		= 1
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ListTag				= "LineItemCommentDetail"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[7].ItemTag				= "ItemCommentDetail"			

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[8].RelationName			= "AddOnChargeForPrintingRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[8].ListName 			= "AddOnChargesForIDM"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[8].LevelSection1		= 2
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[8].ListTag				= "HeaderAddOnCharge"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[8].ItemTag				= "AddOnCharge"

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[9].RelationName			= "PrintOnPurchaseOrderCommentsRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[9].ListName 			= "PurchaseOrderCommentsForIDM"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[9].LevelSection1		= 3
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[9].ListTag				= "PurchaseOrderComment"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[9].ItemTag				= "Comment"

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[10].RelationName		= "TrailerCommentsRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[10].ListName 			= "PurchaseOrderCommentsForIDM"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[10].LevelSection1		= 4
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[10].ListTag				= "PurchaseOrderTrailerComment"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[10].ItemTag				= "Comment"

			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[11].RelationName		= "HeaderAddOnChargesForPrintingRel"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[11].ListName 			= "AOCForPOLineForIDM"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[11].LevelSection1		= 5
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[11].ListTag				= "PurchaseOrderHeaderAddOnCharges"
			IDMXMLDefinition.IDMXMLChildren.IDMXMLChild[11].ItemTag				= "PurchaseOrderHeaderAddOnCharge"

		TriggerPurchaseOrderRules
			if(LocalMassBODTrigger)
				LocalSyncPOTitle ="MassBOD:"+MassBODTitleDate+": EG:"+GeneralLedgerCompanyRel.FinanceEnterpriseGroup+" CO:"+Company+" PO:"+PurchaseOrder
			else
				LocalSyncPOTitle ="EG:"+GeneralLedgerCompanyRel.FinanceEnterpriseGroup+" CO:"+Company+" PO:"+PurchaseOrder
			trigger "PurchaseOrderService" PA service
				resume on error
				title is "<LocalSyncPOTitle>"
				Criteria
					GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					Company
					Company.GeneralLedgerCompany.AccountingEntity
				Variables
					include persistent fields from	PurchaseOrder

					ActionCode
					bod id.VariationID
						variable name is BODVariationId
					LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
						variable name is CurrentTimeStamp
					Vendor.VendorGroup
						variable name is VendorGroup
					Company
						variable name is LawsonCompany
					Company.GeneralLedgerCompany.AccountingEntity
						variable name is Accountingentity
					Company.ProcurementGroup
						variable name is ProcurementGroup





		TriggerProcessPurchaseOrderRules
			if(LocalMassBODTrigger)
				LocalProcessPOTitle ="MassBOD:"+MassBODTitleDate+": Process:EG:"+GeneralLedgerCompanyRel.FinanceEnterpriseGroup+" CO:"+Company+" PO:"+PurchaseOrder
			else
				LocalProcessPOTitle ="Process:EG:"+GeneralLedgerCompanyRel.FinanceEnterpriseGroup+" CO:"+Company+" PO:"+PurchaseOrder
			trigger "ProcessPurchaseOrderService" PA service
				resume on error
				title is "<LocalProcessPOTitle>"
				Criteria
					GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					Company
					Company.GeneralLedgerCompany.AccountingEntity
				Variables
					include persistent fields from	PurchaseOrder

					ActionCode
					bod id.VariationID
						variable name is BODVariationId
					LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
						variable name is CurrentTimeStamp
					Vendor.VendorGroup
						variable name is VendorGroup
					Company
						variable name is LawsonCompany
					Company.GeneralLedgerCompany.AccountingEntity
						variable name is Accountingentity


				
		TriggerBRPurchaseOrder 
			trigger "BRPurchaseOrderService" PA service
				resume on error
				title is "BRPO:EG:<GeneralLedgerCompanyRel.FinanceEnterpriseGroup>CO:<Company>POR:<PurchaseOrder>"
				Criteria
					GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					Company
					Company.GeneralLedgerCompany.AccountingEntity
				Variables
					include persistent fields from PurchaseOrder
					ActionCode
					bod id.VariationID
						variable name is BODVariationId
					LocalBODCurrentTimeStamp.OutputBODCurrentTimeStamp
						variable name is CurrentTimeStamp										
					Company
						variable name is LawsonCompany
					Company.GeneralLedgerCompany.AccountingEntity										
						variable name is Accountingentity
					Vendor.VendorGroup	
						variable name is VendorGroup
					PurchaseFromLocation.RemitToCode
						variable name is VenRemitToCode

		SetIDMAttributes
			initialize IDMAttributes
			IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeName  	= "Vendor" 
			IDMAttributes.SingleValue.IDMAttribute[1].IDMAttributeValue  	= Vendor
			IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeName  	= "Buyer"
			IDMAttributes.SingleValue.IDMAttribute[2].IDMAttributeValue  	= Buyer
			IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeName  	= "Reference1"
			IDMAttributes.SingleValue.IDMAttribute[3].IDMAttributeValue  	= Reference1
			IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeName  	= "PurchaseOrderDate"
			IDMAttributes.SingleValue.IDMAttribute[4].IDMAttributeDate  	= PurchaseOrderDate
			IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeName  	= "ExternalRequisition"
			IDMAttributes.SingleValue.IDMAttribute[5].IDMAttributeValue 	= ExternalRequisition
			IDMAttributes.SingleValue.IDMAttribute[6].IDMAttributeName		= "CompanyName"
			IDMAttributes.SingleValue.IDMAttribute[6].IDMAttributeValue		= Company.Name
			IDMAttributes.SingleValue.IDMAttribute[7].IDMAttributeName		= "VendorName"
			IDMAttributes.SingleValue.IDMAttribute[7].IDMAttributeValue		= Vendor.VendorName
			IDMAttributes.SingleValue.IDMAttribute[8].IDMAttributeName		= "BuyerName"
			IDMAttributes.SingleValue.IDMAttribute[8].IDMAttributeValue		= Buyer.Name

			initialize LocalColSequence
			for each distinct ShipToLocation in PrintLinesRel
				if (LocalColSequence < 100)
					LocalColSequence = LocalColSequence + 1
					IDMAttributes.MultiValue1.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.ShipToLocation
				else
					end for each
			IDMAttributes.MultiValue1.IDMAttributeName  = "ShipTo"

			initialize LocalColSequence
			for each distinct CommodityCode in PrintLinesRel
				if (LocalColSequence < 100)
					LocalColSequence = LocalColSequence + 1
					IDMAttributes.MultiValue2.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.CommodityCode
				else
					end for each
			IDMAttributes.MultiValue2.IDMAttributeName = "CommodityCode"

			initialize LocalColSequence
			for each distinct DistributionAccount.Project in PurchaseOrderLineDistributionsRel
				if (LocalColSequence < 100)
					LocalColSequence = LocalColSequence + 1
					IDMAttributes.MultiValue3.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.DistributionAccount.Project
				else
					end for each
			IDMAttributes.MultiValue3.IDMAttributeName = "Project"

			initialize LocalColSequence
			for each distinct Requester in PurchaseOrderRequesterLineSourceRel
				if (LocalColSequence < 100)
					LocalColSequence = LocalColSequence + 1
					IDMAttributes.MultiValue4.IDMAttributeValueOccurs.IDMAttributeValue[LocalColSequence] = each.Requester
				else
					end for each
			IDMAttributes.MultiValue4.IDMAttributeName = "Requester"

		CalculateAOCTotal
			if (not LocalAddOnChargeTotalComputed)
				for each AddOnChargeRel
					LocalAOCTotal += each.DerivedTotalAOCAmount
				LocalAddOnChargeTotalComputed = true

		CreatePurchaseOrderDiversity
			if (ActiveVendorDiversityRel exists)
				for each ActiveVendorDiversityRel
					LocalDiversityCode = each.VendorDiversity.DiversityCode
					if (PurchaseOrderDiversityRel !exists)
						invoke Create PurchaseOrderDiversity
							invoked.Company               = Company
							invoked.PurchaseOrder         = PurchaseOrder
							invoked.PayablesDiversityCode = each.VendorDiversity.DiversityCode

			if (ActiveVendorLocationDiversityRel exists)
				for each ActiveVendorLocationDiversityRel
					LocalDiversityCode = each.VendorDiversity.DiversityCode
					if (PurchaseOrderDiversityRel !exists)
						invoke Create PurchaseOrderDiversity
							invoked.Company               = Company
							invoked.PurchaseOrder         = PurchaseOrder
							invoked.PayablesDiversityCode = each.VendorDiversity.DiversityCode
							invoked.LocalPurchaseFromLocation = PurchaseFromLocation

		UpdateExitRules
			if (PORelease 	changed
			or	POCode		changed
			or	Buyer		changed)
				for each PayablesInvoiceDetailsRel
					invoke UpdateSnapshotFields each

			if (Vendor changed or PurchaseFromLocation changed)
				for each PurchaseOrderSpreadAddOnChargesRel
					invoke UpdateSpreadAddOnChargeVendor each
						invoked.PrmVendor             	= Vendor
						invoked.PrmPurchaseFromLocation = PurchaseFromLocation

			if (Vendor changed or Currency changed)
				for each PurchaseOrderAndLineAddOnChargeRel
					invoke Update each
						initialize invoked.EnteredCurrencyConversionRate
						invoked.TransientByPassHeaderCallback = true
						if (Vendor changed)
							invoked.TransientHeaderVendor 	  = old Vendor
							if (each.Vendor = old Vendor)
								invoked.Vendor   = Vendor
						if (each.Vendor = Vendor)
							invoked.Currency = Currency
							if (CurrencyExchangeSetPoint.Invoicing)
								initialize invoked.ReceiptCurrencyConversionRate

			if ((Vendor changed
			or  Buyer changed
			or  PurchaseFromLocation changed
			or  Currency changed)
			and not LocalUpdatedFromLine)
				if (IsHSNSACCodeEnabled)
					if  (PurchaseFromLocation not entered
					and (Vendor changed))
						confirmation required
							"ChangingVendorChangesTaxCodeInEachLine,Continue?"
					if (PurchaseFromLocation changed)
						confirmation required
							"ChangingPurchaseFromLocationChangesTaxCodeInEachLine,Continue?"

				invoke UpdateLineFromHeader PurchaseOrderLine set
					if (Currency changed)
						invoked.PrmOldHeaderCurrency = old Currency

			if	(AribaPOType entered)
				invoke UpdateEDIOutputLineAmounts PurchaseOrderLine set

			if (PurchaseOrderReceiptsWithDifferentVendorRel exists)
				for each PurchaseOrderReceiptsWithDifferentVendorRel
					invoke UpdateFromPurchaseOrder each

			if (Vendor changed
			or  PurchaseFromLocation changed)
				invoke Delete PurchaseOrderDiversityListRel
				include CreatePurchaseOrderDiversity

			if	(FreightTerm changed
			or	ShipToLocation changed
			or	Vendor changed
			or	PurchaseFromLocation changed)
				include CreateIncotermComment

			if (Dropship changed)
				invoke UpdateMatchProcessType UnmatchedMatchPurchaseOrderInvoicesRel


		UpdateVendorOpenPurchaseAmount
			invoke UpdateOpenPurchaseAmount PurchasingVendorRel
				invoked.PrmOpenPurchaseAmount = LocalOpenPurchaseAmount
			if (PurchaseFromLocationRel exists)
				invoke UpdateOpenPurchaseAmount PurchaseFromLocationRel
					invoked.PrmOpenPurchaseAmount = LocalOpenPurchaseAmount

		UpdateEDIOutputOrderAmount
			initialize EDIOutputOrderAmount
			if (SuppressPOCost)
				EDIOutputOrderAmount	= sum PurchaseOrderLine set.CalculateEDIOutputLineAmount
				PrintTotal				= sum PurchaseOrderLine set.CalculateEDIOutputLineAmount
			else
				EDIOutputOrderAmount	= sum PurchaseOrderLine set.ExtendedAmount
				PrintTotal				= sum PurchaseOrderLine set.ExtendedAmount

		CreateCommentFromCommentCode

		 	invoke SystemCreate PurchaseOrderComment
				fill in fields from this instance
				invoked.CommentTitle 		= StandardCommentCodeRel.CommentName
				invoked.CommentType  		= StandardCommentCodeRel.StandardCommentPrintCode
				invoked.CommentText  		= StandardCommentCodeRel.CommentText
				invoked.Attachment.File   	= StandardCommentCodeRel.Attachment.File
				invoked.Attachment.MimeType = StandardCommentCodeRel.Attachment.MimeType
				invoked.Attachment.Title   	= StandardCommentCodeRel.Attachment.Title
			initialize StandardCommentCode

		CreateIncotermComment

			if (PurchaseOrderIncotermRel exists)
				invoke Delete PurchaseOrderIncotermRel

			if (FreightTerm entered)
				if (FreightTerm.NamedPlaceSource.ShipTo)
					invoke SystemCreate PurchaseOrderComment
						fill in fields from this instance
						invoked.CommentTitle = "Incoterm"
						invoked.CommentType  = "M"
						invoked.CommentText  = 		(ShipToLocation.PostalAddressForPurchaseOrder.DeliveryAddress.AddressLine1
													+ " "
													+ ShipToLocation.PostalAddressForPurchaseOrder.DeliveryAddress.AddressLine2//												+ " "
													+ " "
													+ ShipToLocation.PostalAddressForPurchaseOrder.DeliveryAddress.AddressLine3////)//												+ " "
													+ " "
													+ ShipToLocation.PostalAddressForPurchaseOrder.DeliveryAddress.AddressLine4//												+ " "
													+ " "
													+ ShipToLocation.PostalAddressForPurchaseOrder.Municipality//												+ " "
													+ " "
													+ ShipToLocation.PostalAddressForPurchaseOrder.StateProvince//												+ " "
													+ " "
													+ ShipToLocation.PostalAddressForPurchaseOrder.PostalCode//												+ " "
													+ " "
													+ ShipToLocation.PostalAddressForPurchaseOrder.Country)//												+ " "
				else
				if (FreightTerm.NamedPlaceSource.Vendor)
					if (PurchaseFromLocationRel.NamedPlace entered)
			 			invoke SystemCreate PurchaseOrderComment
							fill in fields from this instance
							invoked.CommentTitle = "Incoterm"
							invoked.CommentType  = "M"
							invoked.CommentText  = PurchaseFromLocationRel.NamedPlace
					else
					if (PurchasingVendorRel.NamedPlace entered)
	 					invoke SystemCreate PurchaseOrderComment
							fill in fields from this instance
							invoked.CommentTitle = "Incoterm"
							invoked.CommentType  = "M"
							invoked.CommentText  = PurchasingVendorRel.NamedPlace

		UpdateRevisions
			if (Issued
			and not Revised)
				Revised = true
				invoke CreatePurchaseOrderRevision

				invoke UpdateRevisionsAndIssueMethodFlag

		UnreleasePurchaseOrder
			initialize Approved
			initialize Released
			Closed   		= Closed.No

			initialize CloseDate
			initialize AttainedLevel
			initialize ApprovalLevel

			include UpdateRevisions

			LocalOpenPurchaseAmount = OpenPurchaseAmount * -1
			if (Vendor not changed and PurchaseFromLocation not changed)
				include UpdateVendorOpenPurchaseAmount
			else
				if (OldPurchasingVendorRel exists)
					invoke UpdateOpenPurchaseAmount OldPurchasingVendorRel
						invoked.PrmOpenPurchaseAmount = LocalOpenPurchaseAmount
				if (OldPurchaseFromLocationRel exists)
					invoke UpdateOpenPurchaseAmount OldPurchaseFromLocationRel
						invoked.PrmOpenPurchaseAmount = LocalOpenPurchaseAmount

			make transition to Unreleased

		DeletePurchaseOrderLine
			for each PurchaseOrderLinesRel
				invoke EditDelete each
			if (instance count of PurchaseOrderLine set > DerivedForegroundLimit)
				make transition to DeleteInProgress
				invoke DeletePurchaseOrderLineSet PurchaseOrderLine in background
					invoked.PrmCompany					= Company
					invoked.PrmPurchaseOrder			= PurchaseOrder
					invoked.PrmFromUnreleased			= LocalFromUnreleased
			else
				make transition to Deleted
				invoke DeletePurchaseOrderLineSet PurchaseOrderLine in foreground
					invoked.PrmCompany					= Company
					invoked.PrmPurchaseOrder			= PurchaseOrder
					invoked.PrmFromUnreleased			= LocalFromUnreleased


		ReleaseLimitsValidation

			initialize PurchaseOrderReleaseMessages
			if (PurchaseFromLocationRel.OpenPurchaseLimit > 0
			and PurchaseFromLocationRel.OpenPurchaseAmount + OpenPurchaseAmount > PurchaseFromLocationRel.OpenPurchaseLimit)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.OpenPOAmtExceedPurchFromLocLimit

			if (PurchaseOrderReleaseMessages not entered
			and PurchasingVendorRel.OpenPurchaseLimit > 0
			and PurchasingVendorRel.OpenPurchaseAmount + OpenPurchaseAmount > PurchasingVendorRel.OpenPurchaseLimit)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.OpenPOAmtExceedVendorLimit

			if (PurchaseOrderReleaseMessages not entered
			and PurchaseFromLocationRel.MinimumOrderWeight != 0
			and StockWeight < PurchaseFromLocationRel.MinimumOrderWeight)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.OrderWeightLessThanPurchFromLocMinimum

			if (PurchaseOrderReleaseMessages not entered
			and PurchaseFromLocationRel.MaximumOrderAmount != 0
			and OpenPurchaseAmount > PurchaseFromLocationRel.MaximumOrderAmount)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.POExceedsPurchFromLocPerPOLimit

			if (PurchaseOrderReleaseMessages not entered
			and PurchaseFromLocationRel.MinimumPurchaseOrderAmount != 0
			and TotalOrderAmount < PurchaseFromLocationRel.MinimumPurchaseOrderAmount)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.POTotalLessThanPurchFromLocMinAmt

			if (PurchaseOrderReleaseMessages not entered
			and PurchasingVendorRel.MaximumOrderAmount != 0
			and OpenPurchaseAmount > PurchasingVendorRel.MaximumOrderAmount)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.POExceedsVendorPerPOLimit

			if (PurchaseOrderReleaseMessages not entered
			and PurchasingVendorRel.MinimumPurchaseOrderAmount ! = 0
			and PurchaseFromLocation not entered
			and TotalOrderAmount < PurchasingVendorRel.MinimumPurchaseOrderAmount)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.POTotalLessThanVendorMinAmt

			if (PurchaseOrderReleaseMessages not entered
			and PurchasingVendorRel.MinimumOrderWeight != 0
			and StockWeight < PurchasingVendorRel.MinimumOrderWeight)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.OrderWeightLessThanVendorMinimum

			if (PurchaseOrderReleaseMessages not entered
			and InvoiceMethod.InvoiceNotRequired and not NonServiceTypePurchaseOrderLinesRel exists)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.InvoiceNotRequiredAndNoItemsToInvoice

			if (PurchaseOrderReleaseMessages not entered
			and Buyer.LimitPerPurchaseOrder > 0
			and VendorReturn not entered
			and TotalOrderAmount > Buyer.LimitPerPurchaseOrder)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.POExceedsBuyerPerPOLimit

			if (PurchaseOrderReleaseMessages not entered
			and UseProcurementCard
			and ProcurementCardRequestRel.SingleTransactionLimit > 0
			and TotalOrderAmount >= ProcurementCardRequestRel.SingleTransactionLimit)
				PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.POLimitExceedsPCardTransactionLimit

			if (PurchaseOrderReleaseMessages not entered
			and AllowRetainageEdit)
				if (HasRetainage)
					if (RetainageFirstPercent not entered)
						PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.RetainageFirstPercentIsRequired

					if (PurchaseOrderReleaseMessages not entered
					and RetainageUpToPercentComplete not entered)
						PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.RetainageUpToPercentCompleteIsRequired

					if (PurchaseOrderReleaseMessages not entered
					and RetainageOverridePercentComplete entered
					and PurchaseOrderLinesWithRetainageOverrideRel exists)
						PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.RetainageOverridePercentCompleteOnLine
				else
					if (first PurchaseOrderLinesRel.Retainage.Yes)
						PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.RetainageOnLinePOCannotBeContractOrNonRetainage

					if (PurchaseOrderReleaseMessages not entered
					and RetainageFirstPercent entered)
						PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.PONotRetainageDoNotEnterRetainageFirstPercent

					if (PurchaseOrderReleaseMessages not entered
					and RetainageSecondPercent entered)
						PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.PONotRetainageDoNotEnterRetainageSecondPercent

					if (PurchaseOrderReleaseMessages not entered
					and RetainageUpToPercentComplete entered)
						PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.PONotRetainageDoNotEnterRetainageUpToPercentComplete

				if (PurchaseOrderReleaseMessages not entered
				and first PurchaseOrderLinesRel.Retainage.RetainageOnContract
				and not RetainagePercentCompleteTracking.Contract)
					PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.ContractRetainageOnLinePOShouldHaveContractRetainage

				if (PurchaseOrderReleaseMessages not entered
				and RetainageDueDate < PurchaseOrderDate)
					PurchaseOrderReleaseMessages = PurchaseOrderReleaseMessages.RetainageDueDateMustBeGreaterThanPurchaseOrderDate

		CheckPHIProcedureInformation
			if (HasPatientProcedureRecord)
				invoke Update PatientProcedure
					invoked.VisitNumber				= TransientVisitNumber
					invoked.PatientID				= TransientPatientID
					invoked.CaseNumber				= TransientCaseNumber
					invoked.PatientLastName			= TransientPatientLastName
					invoked.PatientFirstName		= TransientPatientFirstName
					invoked.PatientMiddleName		= TransientPatientMiddleName
					invoked.Birthdate				= TransientBirthdate
					invoked.Gender					= TransientGender
					invoked.SocialSecurityNumber	= TransientSocialSecurityNumber
			else
			if (HasPHIDefaultProcInfo)
				invoke Create PatientProcedure
					assign result to LocalPatientProcedureView
					invoked.Company					= Company
					invoked.VisitNumber				= TransientVisitNumber
					invoked.PatientID				= TransientPatientID
					invoked.CaseNumber				= TransientCaseNumber
					invoked.PatientLastName			= TransientPatientLastName
					invoked.PatientFirstName		= TransientPatientFirstName
					invoked.PatientMiddleName		= TransientPatientMiddleName
					invoked.Birthdate				= TransientBirthdate
					invoked.Gender					= TransientGender
					invoked.SocialSecurityNumber	= TransientSocialSecurityNumber
					invoked.RecordType		 		= 1

				PatientProcedure = LocalPatientProcedureView.PatientProcedure
	
		InventoryLocationStatusValidation
			constraint (ShipToLocation.Status.Active)
				"InventoryLocation<ShipToLocation>MustBeActive"

		IssueFinalActionRule
			constraint (!IsNeedsApproval)
				"CannotIssueAPurchaseOrderNeedingApproval"
			
			if (PurchaseOrderRevisionsRel not exists)
				constraint (PurchaseOrderLinesWithQuantityToProcessRel exists)
					"CannotIssue;AllPurchaseOrderLinesCancelledWithNoRevisions"
			
			LocalForIssueFinal = true
			IssuePending = false
			Issued = true

			if (PurchaseOrderRevisionsDescendingRel exists)
				invoke Update first PurchaseOrderRevisionsDescendingRel
					invoked.IssueMethod			= IssueMethod
					invoked.IssueDate			= current timestamp
			else
			if (PurchaseOrderRevisionsRel !exists)
				invoke CreateFirst PurchaseOrderRevision
					invoked.Company				= Company
					invoked.PurchaseOrder		= PurchaseOrder
					invoked.IssueMethod			= IssueMethod
					invoked.IssueDate			= current timestamp

			if (Company.UseIDM)
				initialize LocalGotIDMDocumentURL
				Revised = false
				IDMMassPOIssueBatchID = LocalIDMBatchID

				invoke FastUpdate PurchaseOrderLinesForReprintRel
					initialize invoked.IDMReprintStatus		

				if (IssueMethod.DoNotPrint)
					invoke IssueFinalCompletion
				else
					if (Buyer.OverrideDocumentTemplate)
						constraint (Company.PurchaseOrderTemplate entered
						or 		   (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseFromLocation.IDMTemplate entered)
						or 		    PurchasingVendorRel.IDMTemplate entered
						or          PurchaseOrderIDMTemplate entered)
							"<IDMTemplateWithHeaderValidationMessage>"
					else
						constraint (Company.PurchaseOrderTemplate entered
						or 		   (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseFromLocation.IDMTemplate entered)
						or 		    PurchasingVendorRel.IDMTemplate entered)
							"<IDMTemplateValidationMessage>"					

					invoke CreateAndSendPODocToIDM
						invoked.IsIssueFinal  = true
						if (IssueMethod.Paper)
							invoked.PrmIDMPrinter = IDMPrinter

			else

				if (not IssueMethod.DoNotPrint)
					if (Buyer.OverrideDocumentTemplate)
						constraint (Company.PurchaseOrderDocument entered
						or 		   (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseOrderDocument entered)
						or 		    PurchasingVendorRel.PurchaseOrderDocument entered
						or			PurchaseOrderDocument entered)
							"<NonIDMTemplateWithHeaderValidationMessage>"
					else
						constraint (Company.PurchaseOrderDocument entered
						or 		   (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseOrderDocument entered)
						or 		    PurchasingVendorRel.PurchaseOrderDocument entered)
							"<NonIDMTemplateValidationMessage>"
					
					initialize LocalMimeType
					invoke SystemCreate PurchaseOrderComment
						assign result to NewPOCommentView
						invoked.Company					= Company
						invoked.PurchaseOrder			= PurchaseOrder
						invoked.CommentTitle			= "Purchase Order Document For Issue Final"
						invoked.CommentType				= PurchaseOrderComment.CommentType.PurchaseOrderIssue
						if (Buyer.OverrideDocumentTemplate and PurchaseOrderDocument entered)
							invoked.Attachment.File     = PurchaseOrderDocument.PurchaseOrderDocumentTemplate.File document
							invoked.Attachment.MimeType = PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType //"application/rtf"
							LocalMimeType 				= PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
						else
						if (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseOrderDocument entered)
							invoked.Attachment.File		= PurchaseFromLocationRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.File document
							invoked.Attachment.MimeType	= PurchaseFromLocationRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
							LocalMimeType 				= PurchaseFromLocationRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
						else
						if (PurchasingVendorRel.PurchaseOrderDocument entered)
							invoked.Attachment.File		= PurchasingVendorRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.File document
							invoked.Attachment.MimeType	= PurchasingVendorRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
							LocalMimeType 				= PurchasingVendorRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
						else
							invoked.Attachment.File		= Company.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.File document
							invoked.Attachment.MimeType	= Company.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType //"application/rtf"
							LocalMimeType 				= Company.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType

						if (LocalMimeType = "application/rtf")
							invoked.Attachment.Title	= "PurchaseOrderDocument.rtf"
						else
						if (LocalMimeType = "application/pdf")
							invoked.Attachment.Title	= "PurchaseOrderDocument.pdf"

						invoked.IssueType				= 2
						invoked.LatestDocument			= true

				Revised = false

		IssueFinalExitRule
			if (not Company.UseIDM)
				invoke IssueFinalCompletion

		RegenerateIDMDocument
			invoke CreateAndSendPODocToIDM	
				invoked.IsIssueFinal  = true
				
	Derived Fields

		DerivedPOAccountNumber is a DerivedField
			type is like VendorAccount
			if (LocationVendorLocationAccountRel.VendorAccount entered)
				return LocationVendorLocationAccountRel.VendorAccount
			else
			if (CompanyVendorLocationAccountRel.VendorAccount entered)
				return CompanyVendorLocationAccountRel.VendorAccount
			else
			if (PurchaseFromLocation.VendorAccount entered)
				return PurchaseFromLocation.VendorAccount
			else
			if (LocationVendorAccountRel.VendorAccount entered)
				return LocationVendorAccountRel.VendorAccount
			else
			if (CompanyVendorAccountRel.VendorAccount entered)
				return CompanyVendorAccountRel.VendorAccount
			else
				return Vendor.VendorAccount

		DerivedPONumberAndCode is a DerivedField
			type is Alpha 20
			if (POCode entered)
				return (DerivedPurchaseOrder + " - " + POCode)
			else
				return DerivedPurchaseOrder

		DerivedPONumberAndCode2 is a DerivedField
			type is Alpha 20
			restricted
			if (POCode entered)
				return (DerivedPurchaseOrder + " - " + POCode)
			else
				return DerivedPurchaseOrder

		DerivedPurchaseOrderDate is a DerivedField
			type is Date
			restricted
			return PurchaseOrderDate

		DerivedSupplierSourceId is a DerivedField
			type is like SupplierSourceId
			restricted
			if (Vendor.SingleSupplier
			and PurchaseFromLocation entered
            and PurchaseFromLocation.SupplierSourceIdRel exists
            and PurchaseFromLocation.NumberOfSupplierContacts = 1)
   				return PurchaseFromLocation.SupplierSourceIdRel.SupplierSourceId         					 
            else
				return blank 		

		DerivedVendorAddressCityStateCode is a MessageField
			restricted
			"<DerivedVendorAddressCity>_\<DerivedVendorAddressStateProvince>_\<DerivedVendorAddressPostalCode>"

		DerivedShipToAddressCityStateCode is a MessageField
			restricted
			"<ShipToLocation.PostalAddressForPurchaseOrder.Municipality>_\<DerivedShipToAddressStateProvince>_\<ShipToLocation.PostalAddressForPurchaseOrder.PostalCode>"
		
		DerivedDropShipOrAlternateShipToAddressCityStateCode is a MessageField
			restricted
			"<DerivedShipToAddressMunicipality>_\<DerivedShipToAddressStateProvince>_\<DerivedShipToAddressPostalCode>"

		DerivedTemplateAddressCityStateCode is a ConditionalField
			type is Text
			if (DropshipMunicipalityOrStateProvinceOrPostalCodeEntered)
				DerivedDropShipOrAlternateShipToAddressCityStateCode
			else
				DerivedShipToAddressCityStateCode

		DerivedBillToAddressCityStateCode is a MessageField
			restricted
			"<PurchaseOrderBillToAddress.Municipality>_\<PurchaseOrderBillToAddress.StateProvince>_\<PurchaseOrderBillToAddress.PostalCode>"


		UpdateCompletionMessage is a DerivedField
			type is Text
			restricted
			return UpdateMessage + CurrencyCostConversionMessage

		UpdateMessage is a MessageField
			restricted
			"PurchaseOrderUpdated."

		CurrencyHasChangedMessage is a MessageField
			restricted
			"CurrencyHasChanged.PleaseCheckUnitCostsOnTheLine."

		BudgetEditMessage is a MessageField
			"BudgetEditsInProgress"

		BudgetFailureMessage is a MessageField
			"BudgetsExceeded;CouldNotRelease;SeeBudgetErrorsTab"

		LineErrorMessage is a MessageField
			"LineErrorsExist"

		MultipleInvoicesMessage is a MessageField
			"MultipleInvoicesExist"

		CurrencyCostConversionMessage is a DerivedField
			type is Text
			restricted
			if (Currency changed
			and PurchaseOrderLinesRel exists)
				return CurrencyHasChangedMessage
			return blank

		DerivedCurrentTime is a NativeField
			type is Alpha 100
			restricted

		DerivedEmailFrom is a DerivedField 
			type is EmailAddressField
			holds pii
			if (IssueMethod.Email)
				if (Company.PurchaseOrderIDMEmailFrom entered)
					return Company.PurchaseOrderIDMEmailFrom
				else
					return actor.ContactInfo.EmailAddress

		DerivedEmailTo is a DerivedField 
			type is like EmailAddressMulti
			holds pii
			if (IssueMethod.Email)
				return EmailAddress

		DerivedCompanyEmailSubject is a DerivedField
			type is Alpha size 255
			restricted
			LocalIDMEmailSubject = Company.PurchaseOrderIDMEmailSubject
			return LocalIDMEmailSubject text

		DerivedPODocumentFileName is a DerivedField	
			type is Alpha size 255
			restricted
			LocalIDMPODocumentFileName = Company.PODocumentFileName
			return LocalIDMPODocumentFileName text

		DerivedIDMXml is a DerivedField
			type is Boolean
			if (not RetrievedIDMXML)
				include SetIDMXMLDefinitionValues
				constraint (IDMXMLDefinition.GenerateXML)
					"ErrorOccuredInIDMXMLDefinition.GenerateXML"
				RetrievedIDMXML	= true
			return true


		MobilePurchaseOrderDisplay		is a LabelField
			"PurchaseOrder:<PurchaseOrder>"
		MobileTotalWithCurrencyDisplay 	is a LabelField
			"<CalculateTotalAmount>_<Currency>"
		MobileCompanyDisplay			is a LabelField
			"<Company>_-_<Company.Name>"


		MobileShipToDisplay				is a LabelField
			"<ShipToLocation>_-_<ShipToLocation.Name>"




		PurchaseCompanyDisplay			is a LabelField
			"<Company>_-_<Company.Name>"
     	TotalWithCurrencyDisplay		is a LabelField
			"<CalculateTotalAmount>_<Currency>"


		DerivedTimeIDM is a DerivedField
			type is TimeStamp
			return current timestamp

		DerivedTimeStampIDM is a DerivedField
			type is TimeStamp
			return current timestamp

		DerivedTranVisitNumber is a DerivedField
			type is AlphaUpper size 20
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.VisitNumber
		DerivedTranPatientID is a DerivedField
			type is AlphaUpper size 20
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.PatientID
		DerivedTranCaseNumber is a DerivedField
			type is like CaseNumber
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.CaseNumber
		DerivedTranPatientLastName	is a DerivedField 
			type is like LastName
			holds pii
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.PatientLastName
		DerivedTranPatientFirstName	is a DerivedField 
			type is like FirstName
			holds pii
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.PatientFirstName
		DerivedTranPatientMiddleName is a DerivedField 
			type is like MiddleName
			holds pii
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.PatientMiddleName
		DerivedTranBirthdate		is a DerivedField
			type is Date
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.Birthdate
		DerivedTranGender  			is a DerivedField
			type is like Gender
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.Gender
		DerivedTranSocialSecurityNumber is a DerivedField 
			type is like TaxID
			holds pii
			restricted
			if (DisplayOfProcedureInfo)
				if (action type.Update)
					return blank
				else
					return PatientProcedure.SocialSecurityNumber

		IssueDraftCompletionMessage is a DerivedField
			type is MessageField
			restricted
			if (Company.UseIDM)
				return IssueDraftCompletionMessageForIDM
			else
				return IssueDraftCompletionMessageForNonIDM

		IssueFinalCompletionMessage is a DerivedField
			type is MessageField
			restricted
			if (Company.UseIDM and not IssueMethod.DoNotPrint)
				return IssueFinalCompletionMessageForIDM
			else
			if (Issued
			and not LocalIssueInProgress)
				return IssueFinalCompletionMessageForNonIDM
			else
				return IssueFinalCompletionMessageForNonIDMBatch


		PurchaseOrderSummaryLabel is a DerivedField
			type is Alpha 22
			return "Purchase Order Summary"

		AddOnChargeAllowanceSummaryLabel is a DerivedField
			type is Alpha 33
			return "Add On Charge/Allowance Summary"

		GoodsTotalLabel is a DerivedField
			type is Alpha 11
			return "Goods Total"

		OrderTotalLabel is a DerivedField
			type is Alpha 11
			return "Order Total"

		DerivedVendorAddressLine1 is a DerivedField
			type is Alpha 40
			if (PurchaseFromLocation.CurrentAddressRelExists)
				return PurchaseFromLocation.VendorAddressLine1
			else
				return Vendor.VendorAddressLine1

		DerivedVendorAddressLine2 is a DerivedField
			type is Alpha 40
			if (PurchaseFromLocation.CurrentAddressRelExists)
				return PurchaseFromLocation.VendorAddressLine2
			else
				return Vendor.VendorAddressLine2

		DerivedVendorAddressLine3 is a DerivedField
			type is Alpha 40
			if (PurchaseFromLocation.CurrentAddressRelExists)
				return PurchaseFromLocation.VendorAddressLine3
			else
				return Vendor.VendorAddressLine3

		DerivedVendorAddressLine4 is a DerivedField
			type is Alpha 40
			if (PurchaseFromLocation.CurrentAddressRelExists)
				return PurchaseFromLocation.VendorAddressLine4
			else
				return Vendor.VendorAddressLine4

		DerivedVendorAddressCity is a DerivedField
			type is Alpha 40
			if (PurchaseFromLocation.CurrentAddressRelExists)
				return PurchaseFromLocation.VendorCity
			else
				return Vendor.VendorCity

		DerivedVendorAddressStateProvince is a DerivedField
			type is Alpha 40
			if (PurchaseFromLocation.CurrentAddressRelExists)
				return PurchaseFromLocation.VendorStateProvince
			else
				return Vendor.VendorStateProvince

		DerivedVendorAddressPostalCode is a DerivedField
			type is Alpha 40
			if (PurchaseFromLocation.CurrentAddressRelExists)
				return PurchaseFromLocation.VendorPostalCode
			else
				return Vendor.VendorPostalCode

		DerivedIssueState		is a DerivedField
			type is Alpha 5
			if (LocalForIssueFinal)
				return "Final"
			else
				return "Draft"

		DerivedXMLName			is a DerivedField
			type is Alpha 100
			if (LocalForIssueFinal)
				if (Revised
				or  instance count of PurchaseOrderRevisionsRel > 1)
					return "Company " + Company + " PurchaseOrder " + PurchaseOrder + " " + IssueMethod + " " + DerivedIssueState + " Document Revision-" + PurchaseOrderRevision
				else
					return "Company " + Company + " PurchaseOrder " + PurchaseOrder + " " + IssueMethod + " " + DerivedIssueState + " Document"
			else
				return "Company " + Company + " PurchaseOrder " + PurchaseOrder + " " + IssueMethod + " " + DerivedIssueState + " Document-" + IDMDocumentSequence

		IDMStatusMessage is a MessageField
            "IDM_Job_<IDMJob.Status>"                 

		DerivedIDMDocumentLink is a DerivedField
			type is Alpha 2083
			IDMItem.DocumentType = "FSM_PurchaseOrder" 
			if (IDMDocumentPID entered)
				IDMItem.IDMUniqueId	= IDMDocumentPID 
	   			return IDMItem.GetLink
	   		else
			if (IDMJob.MDSID entered)
				IDMItem.IDMUniqueId = IDMJob.MDSID
				return IDMItem.GetLink
			return blank

		RetrieveIDMDocument is a DerivedField
			type is Boolean
			restricted

 			if (IDMDocumentPID entered)	
 				IDMItem.IDMUniqueId  = IDMDocumentPID 
 				IDMItem.DocumentType = "FSM_PurchaseOrder"
				if (IDMItem.RetrieveResource)
					return true
 			else
			if (IDMJob.MDSID entered)
				IDMItem.IDMUniqueId = IDMJob.MDSID
				IDMItem.DocumentType = "FSM_PurchaseOrder" 
				if (IDMItem.RetrieveResource)
					return true
			else
			if (IDMJob.PID entered)
				IDMItem.IDMPID = IDMJob.PID 
				if (IDMItem.RetrieveResource)
					return true
			return false

		DerivedIDMDocumentMimeType is a DerivedField
			type is Alpha size 5
			restricted
			if (IDMItem.RetrievedAttachment entered)
				if (IDMItem.RetrievedAttachment.MimeType = "application/pdf") 
		   			return "pdf"
			   	else
				   	return "docx"
			return blank

		DerivedIDMEmailSubject is a MessageField
			restricted
			"Company<Company.Name>_\Purchase_\Order<PurchaseOrder>"

		DerivedIDMEmailBody is a MessageField
			restricted
			"Purchase_\Order<PurchaseOrder>Attached."

		DerivedTermCode is a DerivedField
			type is AlphaUpper size 10
			if (TermCode entered)
				return TermCode
			else
				return blank

		DerivedDiscountDays is a DerivedField
			type is Alpha size 3
			if (TermCode.TermsDiscountArray.TermsDiscountGroup[1].DaysToCalcDiscount entered)
				return TermCode.TermsDiscountArray.TermsDiscountGroup[1].DaysToCalcDiscount
			else
				return ""

		DerivedDiscountPercent is a DerivedField
			type is Alpha size 8
			if (TermCode.TermsDiscountArray.TermsDiscountGroup[1].DiscountPercent entered)
				return TermCode.TermsDiscountArray.TermsDiscountGroup[1].DiscountPercent
			else
				return ""

		DerivedFirstNetDays is a DerivedField
			type is Alpha size 2
			if (TermCode.FirstNetDays entered)
				return TermCode.FirstNetDays
			else
				return ""

		DerivedShipToName is a DerivedField 
			type is like Name	 
			holds pii
			if (DropshipAddress entered)
				if (DropshipName entered)
					return DropshipName
			else
				return ShipToLocation.NameForPurchaseOrder

		DerivedShipToAddressLine1 is a DerivedField
			type is Alpha size 40
			if (DropshipAddress entered)
				if (DropshipAddress.DeliveryAddress.AddressLine1 entered)
					return DropshipAddress.DeliveryAddress.AddressLine1
			else
				return ShipToLocation.PostalAddressForPurchaseOrder.DeliveryAddress.AddressLine1

		DerivedShipToAddressLine2 is a DerivedField
			type is Alpha size 40
			if (DropshipAddress entered)			
				if (DropshipAddress.DeliveryAddress.AddressLine2 entered)
					return DropshipAddress.DeliveryAddress.AddressLine2
			else
				return ShipToLocation.PostalAddressForPurchaseOrder.DeliveryAddress.AddressLine2

		DerivedShipToAddressLine3 is a DerivedField
			type is Alpha size 40
			if (DropshipAddress entered)
				if (DropshipAddress.DeliveryAddress.AddressLine3 entered)
					return DropshipAddress.DeliveryAddress.AddressLine3
			else
				return ShipToLocation.PostalAddressForPurchaseOrder.DeliveryAddress.AddressLine3

		DerivedShipToAddressLine4 is a DerivedField
			type is Alpha size 40
			if (DropshipAddress entered)
				if (DropshipAddress.DeliveryAddress.AddressLine4 entered)
					return DropshipAddress.DeliveryAddress.AddressLine4
			else
				return ShipToLocation.PostalAddressForPurchaseOrder.DeliveryAddress.AddressLine4

		DerivedShipToAddressMunicipality is a DerivedField
			type is Alpha size 40
			if (DropshipAddress entered)
				if (DropshipAddress.Municipality entered)
					return DropshipAddress.Municipality
			else
				return ShipToLocation.PostalAddressForPurchaseOrder.Municipality

		DerivedShipToAddressStateProvince is a DerivedField
			type is Alpha size 40
			if (DropshipAddress entered)
				if (DropshipAddress.StateProvince entered)
					return DropshipAddress.StateProvince
			else
				return ShipToLocation.PostalAddressForPurchaseOrder.StateProvince

		DerivedShipToAddressPostalCode is a DerivedField
			type is Alpha size 40
			if (DropshipAddress entered)
				if (DropshipAddress.PostalCode entered)
					return DropshipAddress.PostalCode
			else
				return ShipToLocation.PostalAddressForPurchaseOrder.PostalCode

		DerivedAddOnChargeSubTotal is a DerivedField
			type is like InternationalAmount
			return AddOnChargeTotal

		DerivedTaxTotal is a DerivedField
			type is like InternationalAmount
			return (TotalTaxAmount + AccruedTaxTotal)

		DerivedVendor is a DerivedField
			type is like Vendor
			restricted
			if (Vendor changed)
				return old Vendor
			else
				return Vendor

		SupplierPortalPurchaseFromLocation is a DerivedField
			type is Text
			default label is "VendorLocation"
			return PurchaseFromLocation.RepresentativeText

		SupplierPortalShipToLocation is a DerivedField
			type is Text
			default label is "ShipToLocation"
			return ShipToLocation.RepresentativeTextForPO

		SupplierPortalCompanyInformation is a DerivedField
			type is Text
			default label is "Company"
			return Company.RepresentativeText

		BuyerEmail is a DerivedField
			type is EmailAddressField
			return Buyer.Employee.EmployeeWorkEmailAddress

		BuyerPhone is a DerivedField
			type is Alpha 100
			return Buyer.Employee.EmployeeWorkTelephone

		DerivedPurchaseFromLocation is a DerivedField
			type is like PurchaseFromLocation
			restricted
			if (PurchaseFromLocation changed)
				return old PurchaseFromLocation
			else
				return PurchaseFromLocation

		DerivedPurchaseFromLocationRepresentativeText is a DerivedField
			type is Text
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.VendorLocation.RepresentativeText

		DerivedShipToLocationRepresentativeText is a DerivedField
			type is Text
			default label is "ShipTo"
			return ShipToLocation + " - " + ShipToLocationName

		DerivedFreightTermName is a DerivedField
			type is Text
			if (FreightTerm entered)
				return FreightTerm.DerivedFreightTermName

		DerivedVendorContactName is a DerivedField
			type is like VendorName
			holds pii
			if (PurchaseFromLocationRel.ContactName entered)
				return PurchaseFromLocationRel.ContactName
			else
			if (PurchasingVendorRel.ContactName entered)
				return PurchasingVendorRel.ContactName
			else
			if (Vendor.PrimeVendorContactRel.ContactName entered)
				return Vendor.PrimeVendorContactRel.ContactName
			else
				return blank
		
		DerivedVendorPhoneNumber is a DerivedField
			type is Alpha 100
			holds pii
			initialize LocalPhoneNumber
			if (PurchaseFromLocationRel.PhoneNumber.SubscriberNumber entered)
				if (PurchaseFromLocationRel.PhoneNumber.InternationalPrefix entered)
					LocalPhoneNumber = PurchaseFromLocationRel.PhoneNumber.InternationalPrefix + "-"
				LocalPhoneNumber += PurchaseFromLocationRel.PhoneNumber.SubscriberNumber
				if (PurchaseFromLocationRel.PhoneNumber.Extension entered)
					LocalPhoneNumber += "-" + PurchaseFromLocationRel.PhoneNumber.Extension
			else
			if (PurchasingVendorRel.PhoneNumber.SubscriberNumber entered)
				if (PurchasingVendorRel.PhoneNumber.InternationalPrefix entered)
					LocalPhoneNumber = PurchasingVendorRel.PhoneNumber.InternationalPrefix + "-"
				LocalPhoneNumber += PurchasingVendorRel.PhoneNumber.SubscriberNumber
				if (PurchasingVendorRel.PhoneNumber.Extension entered)
					LocalPhoneNumber += "-" + PurchasingVendorRel.PhoneNumber.Extension
			else
			if (Vendor.PrimeVendorContactRel.PhoneNumber.SubscriberNumber entered)
				if (Vendor.PrimeVendorContactRel.PhoneNumber.InternationalPrefix entered)
					LocalPhoneNumber = Vendor.PrimeVendorContactRel.PhoneNumber.InternationalPrefix + "-"
				LocalPhoneNumber += Vendor.PrimeVendorContactRel.PhoneNumber.SubscriberNumber
				if (Vendor.PrimeVendorContactRel.PhoneNumber.Extension entered)
					LocalPhoneNumber += "-" + Vendor.PrimeVendorContactRel.PhoneNumber.Extension
			return LocalPhoneNumber

		DerivedPurchaseFromLocationVendorAccount is a DerivedField
			type is like VendorAccount
			if (CompanyVendorLocationAccountRel.VendorAccount entered)
				return CompanyVendorLocationAccountRel.VendorAccount
			else
			if (LocationVendorAccountRel.VendorAccount entered)
				return LocationVendorAccountRel.VendorAccount
			else
			if (CompanyVendorAccountRel.VendorAccount entered)
				return CompanyVendorAccountRel.VendorAccount

		DerivedFaxNumber is a DerivedField
			type is Alpha 100
			holds pii
			if (FaxNumber.SubscriberNumber entered)
				if (FaxNumber.InternationalPrefix entered)
					if (FaxNumber.Extension entered)
						return FaxNumber.InternationalPrefix + "-" + FaxNumber.SubscriberNumber + "-" + FaxNumber.Extension
					else
						return FaxNumber.InternationalPrefix + "-" + FaxNumber.SubscriberNumber
				else
					if (FaxNumber.Extension entered)
						return FaxNumber.SubscriberNumber + "-" + FaxNumber.Extension
					else
						return FaxNumber.SubscriberNumber
			else
				return blank

		ContextMessageEntityType is a StringField
			type is Alpha 30
			restricted
			"InforPurchaseOrder"

		ContextMessageText is a MessageField
			restricted
			"PurchaseOrderNumber<PurchaseOrder>ForVendor<Vendor.VendorName>"

		ClosedPurchaseOrderUpdatedMessage      is a MessageField
			restricted
			"PurchaseOrderUpdated"

		WarningMessageForLocationChangeAtHeader is a MessageField
			restricted
			"Warning:LocationChangedOnHeaderOnly"

		UpdateClosedPOCompletionMessage is a DerivedField
			type is Text
			restricted
			if (ShipToLocation changed)
				return WarningMessageForLocationChangeAtHeader
			else
				return ClosedPurchaseOrderUpdatedMessage

		ReleaseWithBudgetEditsMessage is a MessageField
			restricted
			"PurchaseOrderWillBeReleasedIfBudgetEditsArePassed"

		ReleaseNoEditsMessage is a MessageField
			restricted
			"ReleaseComplete"

		ReleaseMessage is a DerivedField
			type is Text
			restricted
			if (CommitmentsExist
			and GeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit)
   				return ReleaseWithBudgetEditsMessage
   			else
   				return ReleaseNoEditsMessage


		DerivedDropShipDimension is a DerivedField
			type is like YesOrNo
			restricted
			if (Dropship)
				return "Y"
			else
				return "N"

		POCount is a DerivedField
			type is Numeric 1
			restricted
			return 1

		OpenPOCount is a DerivedField
			type is Numeric 1
			restricted
			if (!Closed.Yes)
				return 1

		DiversityCount													is a DerivedField
			type is Alpha size up to 20
			if (PurchaseOrderDiversityListRel exists)
				return "(" + instance count of PurchaseOrderDiversityListRel + ")"
			else
				return ""

		POsTransmittedElectronically is a DerivedField
			type is Numeric 1
			restricted
			if (IssueMethod.EDI or IssueMethod.Email or IssueMethod.Fax or (!IssueMethod entered))
				return 1

		ReceiptHeaderCount is a DerivedField
			type is Numeric 3
			restricted
			return (instance count of PurchaseOrderReceiptsRel)


		CompanyCardViewDisplay					is a LabelField
			"Company:<Company>,_<Company.Name>"
		PurchaseOrderCardViewDisplay			is a LabelField
			"PurchaseOrder:<PurchaseOrder>,Revision:<PurchaseOrderRevision>"
		PurchaseOrderDateCardViewDisplay		is a LabelField
			"PurchaseOrderDate:<PurchaseOrderDate>"
		BuyerNameCardViewDisplay				is a LabelField
			"Buyer:<Buyer>,_<Buyer.Name>"
		VendorNameCardViewDisplay				is a LabelField
			"Vendor:<Vendor>,_<Vendor.VendorName>"
		PurchaseFromLocationNameCardViewDisplay	is a LabelField
			"PurchaseFromLocation:<PurchaseFromLocation>,_<PurchaseFromLocation.VendorName>"
		ShipToLocationNameCardViewDisplay	is a LabelField
			"ShipToLocation:<ShipToLocation>,_<ShipToLocation.NameForPurchaseOrder>"
		PurchaseOrderTotalCardViewDisplay	is a LabelField
			"PurchaseOrderTotal:<TotalOrderAmount>"
		Reference1CardViewDisplay				is a LabelField
			"Reference1:<Reference1>"
		Reference2CardViewDisplay				is a LabelField
			"Reference2:<Reference2>"

		HasMiscellaneousAddOnCostLabel is a MessageField
			"HasMiscellaneousAddOnCosts"

		TaxIsLanded is a MessageField
			restricted
			"TaxIsLanded"

		PurchaseOrderHasTax is a MessageField
			restricted
			"PurchaseOrderHasTax"

		DerivedSubcontractorPurchaseOrderReceiptMessage is a MessageField
			restricted
			"CannotCancelThisSubcontractorPurchaseOrderBecauseUnreleasedReceiptsExist"

		DerivedRegularPurchaseOrderReceiptMessage is a MessageField
			restricted
			"CannotCancelThisPurchaseOrderBecauseUnreleasedReceiptsExist"

		DerivedCanceledRemainingQuantityOnCertainLinesMessage is a MessageField
			restricted
			"RemainingQuantityCanceledOn<LocalNumberOfCanceledLines>Lines"

		ClosedMessage						is a MessageField
			restricted
			"Closed"
		CanceledReturnPOMessage				is a MessageField
			restricted
			"CanceledReturnPO"
		CanceledMessage						is a MessageField
			restricted
			"Canceled"
		CancelInProgressMessage				is a MessageField
			restricted
			"CancelInProgress"
		ReturnPOReleasedRevisionMessage		is a MessageField
			restricted
			"ReturnPO.ReleasedRevision"
		ReturnPOIssuedMessage				is a MessageField
			restricted
			"ReturnPO.Issued"
		ReturnPOReleasedMessage				is a MessageField
			restricted
			"ReturnPO.Released"
		ReturnPOUnreleasedRevisionMessage	is a MessageField
			restricted
			"ReturnPO.UnreleasedRevision"
		ReturnPOUnreleasedMessage			is a MessageField
			restricted
			"ReturnPO.Unreleased"
		ReleasedRevisionMessage				is a MessageField
			restricted
			"ReleasedRevision"
		PrintedMessage						is a MessageField
			restricted
			"Printed"
		FaxedMessage						is a MessageField
			restricted
			"Faxed"
		TransmittedEDIMessage				is a MessageField
			restricted
			"TransmittedViaEDI"
		IssuedEDIMessage                    is a MessageField                 
            restricted
            "IssuedForEDI"
		TransmittedXMLMessage				is a MessageField
			restricted
			"TransmittedViaXML"
		EmailedMessage						is a MessageField
			restricted
			"Emailed"
		ReleasedMessage						is a MessageField
			restricted
			"Released"
		ReleasedNotIssuedMessage			is a MessageField
			restricted
			"Released.NotIssued"
		UnreleasedRevisionMessage			is a MessageField
			restricted
			"UnreleasedRevision"
		UnreleasedMessage					is a MessageField
			restricted
			"Unreleased"
		CreateInProgressMessage				is a MessageField
			restricted
			"Unreleased.CreationInProgress"
		DeleteInProgressMessage				is a MessageField
			restricted
			"DeleteInProgress"
		InterfaceCreateInProcessMessage		is a MessageField
			restricted
			"Unreleased.CreationInProcessFromInterface"
		UpdateInProcessMessage				is a MessageField
			restricted
			"Unreleased.UpdateInProcess"
		HistoricalMessage					is a MessageField
			restricted
			"Historical"
		RejectedMessage						is a MessageField
			restricted
			"Rejected"
		IssuedMessage						is a MessageField
			restricted
			"Issued"
		NeedsApprovalMessage				is a MessageField
			restricted
			"NeedsApproval"
		DraftMessage						is a MessageField
			restricted
			"Draft"
		OriginalMessage						is a MessageField
			restricted
			"Original"
		RevisionMessage						is a MessageField
			restricted
			"Revision"
		ReprintMessage						is a MessageField
			restricted
			"Reprint"
		IssueDraftCompletionMessageForIDM	is a MessageField
			restricted
			"IssueDraftInitiated.PleaseRefreshTheScreenToSeeTheDocumentLink."
		IssueDraftCompletionMessageForNonIDM	is a MessageField
			restricted
			"IssueDraftCompleted."
		IssueFinalCompletionMessageForIDM			is a MessageField
			restricted
			"IssueFinalInitiated.PleaseRefreshTheScreenToSeeTheDocumentLink."
		IssueFinalCompletionMessageForNonIDM		is a MessageField
			restricted
			"IssueFinalCompleted."
		IssueFinalCompletionMessageForNonIDMBatch	is a MessageField
			restricted
			"IssueFinalInProgress."
		DeleteInProgressCompletionMessage	is a MessageField
			restricted
			"DeleteInProgress."
		ReleaseInProgressMessage			is a MessageField
			restricted
			"ReleaseInProgress"
		TaxEngineMessage is a MessageField
			restricted
			"SentToEngine"
		DerivedLinesAvailableToMatch is a DerivedField
			type is Numeric size 6
			return instance count of PurchaseOrderLinesAvailableToMatchRel

		DerivedQuantityAvailableToMatch is a DerivedField
			type is like Quantity
			initialize LocalQuantityAvailableToMatch
			for each PurchaseOrderLinesAvailableToMatchRel
				LocalQuantityAvailableToMatch += each.DerivedOpenToPayablesInvoiceQuantity
			return LocalQuantityAvailableToMatch

		DerivedDiversity is a DerivedField					
			type is like Description
			if (Vendor.DiversityCode not entered)
				return "Non-Diverse"
			else
				return Vendor.DiversityCode

		TotalForBudgetEditing is a DerivedField
			type is like InternationalAmount
			return sum BudgetTemplateGroupTotalRel.Amount

		ShipToLocationName             is a ConditionalField
			type is like Name	 
			holds pii
			classic name is LOC-NAME-DRV
			if(Dropship)
				DropshipName
			else
				ShipToLocation.Name

		PurchFromLocationName          is a StringField
			type is Alpha size 30
			classic name is PURCH-FR-NAME
			restricted
			PurchaseFromLocation.VendorName

		BuyerName                      is a StringField
			type is Alpha size 30
			classic name is BUYER-NAME-DRV
			Buyer.Employee.FirstLastName

		DisplayFullPurchaseOrder       is a StringField
			type is Alpha size 24
			classic name is DISP-PO-REL-CD
			PurchaseOrder
			"-"
			PORelease
			"-"
			POCode

		DisplayPurchaseOrderAndRelease is a StringField
			type is Alpha size 19
			classic name is DISP-PO-REL
			restricted
			PurchaseOrder
			"-"
			PORelease

		DisplayPurchaseOrderAndRevision	is a StringField
			type is Alpha size 40
			restricted
			Company
			"-"
			PurchaseOrder
			"-"
			PurchaseOrderRevision
			"-"
			current timestamp

		DisplayRelevantPurchaseOrderAndRevision is a ConditionalField
			type is Alpha size 40
			if (HasRevision)
				DisplayShortPurchaseOrderAndRevision
			else
				PurchaseOrder

		DisplayDocumentNumber is a ConditionalField
			type is Alpha size 24
			classic name is DISP-DOC-NBR
			default label is "PurchaseOrder"
			if (HasPOCode)
				DisplayFullPurchaseOrder
			else
			if (HasPORelease)
				DisplayPurchaseOrderAndRelease
			else
				PurchaseOrder

		DisplayEDINumber is a DerivedField
			type is AlphaUpper size 15
			if (HasRevisePOIssue)
				if (PurchaseFromLocationRel.RevisedEDINumber entered)
					return PurchaseFromLocationRel.RevisedEDINumber
				else
				if (PurchasingVendorRel.RevisedEDINumber entered)
					return PurchasingVendorRel.RevisedEDINumber
			else
				if (PurchaseFromLocationRel.EDINumber entered)
					return PurchaseFromLocationRel.EDINumber
				else
				if (PurchasingVendorRel.EDINumber entered)
					return PurchasingVendorRel.EDINumber


		DerivedUnreleasedPurchaseOrderReceiptErrorMessge is a DerivedField
			type is Alpha size 80
			restricted
			if (SubcontractorPurchaseOrder)
				return DerivedSubcontractorPurchaseOrderReceiptMessage
			else
				return DerivedRegularPurchaseOrderReceiptMessage
				
		DerivedStatusDate is a DerivedField               
            type is TimeStamp
            if (PurchaseOrderRevisionsDescendingRel.TransmissionDate entered
            and PurchaseOrderRevisionsDescendingRel.TransmissionDate > PurchaseOrderRevisionsDescendingRel.IssueDate)
                return first PurchaseOrderRevisionsDescendingRel.TransmissionDate
            else
                return first PurchaseOrderRevisionsDescendingRel.IssueDate

		DerivedPurchaseOrderStatus is a DerivedField
			type is Alpha 50
			default label is "PurchaseOrderStatus"
			if (Closed.Historical)
				return HistoricalMessage
			else
			if (Rejected)
				return RejectedMessage
			else
			if (Closed.Yes)
				return ClosedMessage
			else
			if (TemporaryHold.SentForApproval)
				return TaxEngineMessage
			else
			if (Canceled)
				if (PurchaseOrderLifeCycleState.CancelInProgress)
					return CancelInProgressMessage
				else
					return CanceledMessage
			if (VendorReturn entered)
				if (Canceled)
					return CanceledReturnPOMessage
				else
					if (Released)
						if (Revised)
							return ReturnPOReleasedRevisionMessage
						else
							if (Issued)
								return ReturnPOIssuedMessage
							else
								return ReturnPOReleasedMessage
					else
						return ReturnPOUnreleasedMessage
			else
			if (IsDeleteInProgress)
				return DeleteInProgressMessage
			else
			if (Issued
			and Revised
			and not Released)
				return UnreleasedRevisionMessage
			else
			if (Issued
			and Revised
			and Released
			and not IsNeedsApproval)
				return ReleasedRevisionMessage
			else
			if (not Issued
			and not Released)
				if (InterfaceInProcess.CreateInProcess)
					return InterfaceCreateInProcessMessage
				else
				if (InterfaceInProcess.UpdateInProcess)
					return UpdateInProcessMessage
				else
					if (PurchaseOrderLifeCycleState.CreateInProgress)
						return CreateInProgressMessage
					else
						return UnreleasedMessage
			else
			if (IsNeedsApproval)
				return NeedsApprovalMessage
			else
				if (IsReleaseInProgress)
					return ReleaseInProgressMessage
				else
				if (Released
				and not Issued)
					return ReleasedNotIssuedMessage
				else
				if (Issued
				and not Revised
				and not Released)
					return UnreleasedMessage
				else
				if (Issued

				and Released)
					if (IssueMethod entered)
						if (IssueMethod.Paper)
							return PrintedMessage
						else
							if (IssueMethod.Fax)
								return FaxedMessage + " Status: " + FaxDetailRel.FaxPoHeader
							else
								if (IssueMethod.EDI)
									if (PurchaseOrderRevisionsDescendingRel.AcknowledgementDate entered)
										return "Acknowledged: " + PurchaseOrderRevisionsDescendingRel.AcknowledgementType
									else
									    if (PurchaseOrderRevisionsDescendingRel.TransmissionStatus entered) 
                                            return TransmittedEDIMessage + " " + PurchaseOrderRevisionsDescendingRel.TransmissionStatus
                                        else
                                            return IssuedEDIMessage
								else
									if (IssueMethod.XML)
										if (PurchaseOrderRevisionsDescendingRel.TransmissionMessage entered)
											return PurchaseOrderRevisionsDescendingRel.TransmissionMessage
										else
											return TransmittedXMLMessage
									else
										if (IssueMethod.Email)
											return EmailedMessage
										else
											if (IssueMethod.DoNotPrint)
												return ReleasedMessage
					else
						return IssuedMessage

		CommentCount is a DerivedField
			type is Alpha size up to 20
			restricted
			if (PurchaseOrderComment set exists)
				return "(" + instance count of PurchaseOrderComment set + ")"
			else
				return ""

  		DerivedIssueStatus is a DerivedField
  			type is Alpha size 20

  			if (LocalForIssueFinal)
  				if (Issued or Company.UseIDM)

					if (Revised
					or PurchaseOrderRevision > 0)
						return RevisionMessage
					else
						return OriginalMessage



  			if (LocalForIssueDraft)
					return DraftMessage
  			else
  				return DerivedPurchaseOrderStatus

		DerivedTotalProductAmount is a DerivedField
			type is like InternationalAmount
			return TotalProductAmount

		DerivedTotalTaxableAmount is a DerivedField
			type is like InternationalAmount
			return TotalTaxableAmount

		DerivedAddOnChargeTotal is a DerivedField
			type is like InternationalAmount
			return AddOnChargeTotal

		DerivedTotalTaxAmount is a DerivedField
			type is like InternationalAmount
			return TotalTaxAmount

		DerivedPrintTotal is a DerivedField
			type is like InternationalAmount
			return PrintTotal

		DerivedVendorAddOnChargeAmount is a DerivedField
			type is like InternationalAmount
			return VendorAddOnChargeAmount

		DerivedVendorInvoicedTaxAmount is a DerivedField
			type is like InternationalAmount
			return VendorInvoicedTaxAmount

		DerivedOtherVendorAddOnChargeAmount is a DerivedField
			type is like InternationalAmount
			return OtherVendorAddOnChargeAmount

		DerivedOtherVendorInvoicedTaxAmount is a DerivedField
			type is like InternationalAmount
			return OtherVendorInvoicedTaxAmount

		DerivedAccruedTaxTotal is a DerivedField
			type is like InternationalAmount
			return AccruedTaxTotal

		DerivedNumberOfLines is a DerivedField
			type is Numeric 8
			return NumberOfLines

		CalculateTotalAmount is a DerivedField
			type is like InternationalAmount
			return TotalOrderAmount


		CalculateEDIOutputOrderAmount is a DerivedField
			type is like InternationalAmount
			return EDIOutputOrderAmount

		DerivedVendorGrandTotal is a DerivedField
			type is like InternationalAmount
			return VendorGrandTotal

		DerivedOtherVendorGrandTotal is a DerivedField
			type is like InternationalAmount
			return OtherVendorGrandTotal


		DerivedTransactionCount is a DerivedField
			type is Numeric 7
			return 1

		LineCount 				is a DerivedField
			type is Numeric 6
			return instance count of PurchaseOrderLine set

		LineDistributionCount		is a DerivedField
			type is Numeric 6
			return instance count of PurchaseOrderLineDistributionsRel

		ClosedLineCount			is a DerivedField
			type is Numeric 6
			return instance count of PurchaseOrderLinesClosedRel

		CopyFromPOReleaseCreatedMessage			is a MessageField
			restricted
			"PurchaseOrder<PurchaseOrder>HasBeenCreated.PurchaseOrderReleased"

		CopyFromPOReleasedMessage				is a MessageField
			restricted
			"PurchaseOrderHasBeenCreated<PurchaseOrder>"

		CopyFromPOCommentMessage				is a MessageField
			restricted
			"PurchaseOrderCopiedFromPurchaseOrderCompany<Company.Name>.PurchaseOrderCopiedFromPurchaseOrder<PurchaseOrder>"

		CopyFromInactiveLocationMessage			is a MessageField
			restricted
			"PurchaseOrderCreated<PurchaseOrder>;<LocalMessageLineCount>LinesNotCopiedDueToAnInactiveLocation"

		CopyFromInactiveItemMessage				is a MessageField
			restricted
			"PurchaseOrderCreated<PurchaseOrder>;<LocalMessageLineCount>LinesNotCopiedDueToAnInactiveItem"

		CopyFromFullyCanceledLineMessage		is a MessageField
			restricted
			"PurchaseOrderCreated<PurchaseOrder>;<LocalMessageLineCount>LinesNotCopiedDueToLineIsFullyCancelled"

		DerivedDeliveryDays    is a DerivedField
			type is Numeric size 4
			return (DefaultDeliveryDate - current corporate date)

		ExcludeFromReportBasedOnPOCode is a DerivedField
			type is Boolean
			restricted
			for each SupplyManagementReport.ExcludePOCodeArray.ExcludePOCode
				if (each = POCode)
					return true
			return false

		DerivedVendorCurrency is a DerivedField
			type is like Currency
			restricted
			if (PurchaseFromLocation.InvoiceCurrency entered)
				return PurchaseFromLocation.InvoiceCurrency
			else
				if (Vendor.InvoiceCurrency entered)
					return Vendor.InvoiceCurrency
				else
					if (Vendor.VendorClass.Currency entered)
						return Vendor.VendorClass.Currency

		DerivedAppsValue				is a DerivedField
			type is like PfiAppsValue
			restricted
			return "PurchaseOrderApproval" + UniqueID			

		UserActionRoutingAsHtml			is a DerivedField
			type is RichText
			return first PfiWorkunitRel.UserActionRoutingAsHtml

		MatchesProjectSearch		is a DerivedField
			type is Boolean
			if ((Project entered
			and  ProjectCommitmentRel exists)
			or   !Project entered)
				return true

		MatchesFinDim1Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension1 entered
			and  Dimension1CommitmentRel exists)
			or   !FinanceDimension1 entered)
				return true

		MatchesFinDim2Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension2 entered
			and  Dimension2CommitmentRel exists)
			or   !FinanceDimension2 entered)
				return true

		MatchesFinDim3Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension3 entered
			and  Dimension3CommitmentRel exists)
			or   !FinanceDimension3 entered)
				return true

		MatchesFinDim4Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension4 entered
			and  Dimension4CommitmentRel exists)
			or   !FinanceDimension4 entered)
				return true

		MatchesFinDim5Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension5 entered
			and  Dimension5CommitmentRel exists)
			or   !FinanceDimension5 entered)
				return true

		MatchesFinDim6Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension6 entered
			and  Dimension6CommitmentRel exists)
			or   !FinanceDimension6 entered)
				return true

		MatchesFinDim7Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension7 entered
			and  Dimension7CommitmentRel exists)
			or   !FinanceDimension7 entered)
				return true

		MatchesFinDim8Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension8 entered
			and  Dimension8CommitmentRel exists)
			or   !FinanceDimension8 entered)
				return true

		MatchesFinDim9Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension9 entered
			and  Dimension9CommitmentRel exists)
			or   !FinanceDimension9 entered)
				return true

		MatchesFinDim10Search		is a DerivedField
			type is Boolean
			if ((FinanceDimension10 entered
			and  Dimension10CommitmentRel exists)
			or   !FinanceDimension10 entered)
				return true

		MatchesAccountSearch		is a DerivedField
			type is Boolean
			if ((Account entered
			and  AccountCommitmentRel exists)
			or   Account !entered)
				return true

		MatchesAccountingUnitSearch		is a DerivedField
			type is Boolean
			if ((AccountingUnit entered
			and  AccountingUnitCommitmentRel exists)
			or   AccountingUnit !entered)
				return true

		MatchesAccountingEntitySearch	is a DerivedField
			type is Boolean
			if ((AccountingEntity entered
			and  AccountingEntityCommitmentRel exists)
			or   AccountingEntity !entered)
				return true

		BlankField is a DerivedField
			type is Alpha 1
			return blank

		DerivedRowCount is a DerivedField
			type is Numeric 3
			return (instance count of UnreleasedPurchaseOrderLinesRel)

		DerivedRequester is a DerivedField
			type is Alpha size 15
			if (MultipleRequesters)
				return "Multiple"
			if (first PurchaseOrderRequesterLineSourceRel.Requester != 0)
				return first PurchaseOrderRequesterLineSourceRel.Requester

		DerivedRequesterName is a DerivedField
			type is Alpha up to 230
			if (MultipleRequesters)
				return "Multiple"
			if (first PurchaseOrderRequesterLineSourceRel.Requester != 0)
				return first PurchaseOrderRequesterLineSourceRel.Requester.PresentationNameSnapshot

		DerivedSearchRequesterName is a DerivedField
			type is Alpha size up to 231
			restricted
			return SearchRequesterName + "*"

		DerivedPORelease is a DerivedField
			type is Numeric 4
			if (PORelease entered)
				return PORelease

		DerivedInvoiceMethod is a DerivedField
			type is Alpha up to 22
			if (InvoiceMethod.InvoiceElectronically)
				return DerivedInvoiceMethodIEL
			if (InvoiceMethod.InvoiceByMail)
				return DerivedInvoiceMethodIBM
			if (InvoiceMethod.InvoiceNotRequired)
				return DerivedInvoiceMethodINR

		DerivedInvoiceMethodIEL is a MessageField
			"InvoiceElectronically"

		DerivedInvoiceMethodIBM is a MessageField
			"InvoiceByMail"

		DerivedInvoiceMethodINR is a MessageField
			"InvoiceNotRequired"

		DerivedPurchaseFromLocVendorName is a DerivedField
			type is like VendorName
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.VendorName
			else
				return Vendor.VendorName

		DerivedAddressLine1 is a DerivedField
			type is Alpha up to 40
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine1
			else
				return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine1

		DerivedAddressLine2 is a DerivedField
			type is Alpha up to 40
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine2
			else
				return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine2

		DerivedAddressLine3 is a DerivedField
			type is Alpha up to 40
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine3
			else
				return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine3

		DerivedAddressLine4 is a DerivedField
			type is Alpha up to 40
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine4
			else
				return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine4

		DerivedMunicipality is a DerivedField
			type is Alpha up to 58
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.CurrentAddressRel.PostalAddress.Municipality
			else
				return Vendor.CurrentAddressRel.PostalAddress.Municipality

		DerivedStateProvince is a DerivedField
			type is AlphaUpper 3
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.CurrentAddressRel.PostalAddress.StateProvince
			else
				return Vendor.CurrentAddressRel.PostalAddress.StateProvince

		DerivedPostalCode is a DerivedField
			type is Alpha 12
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.CurrentAddressRel.PostalAddress.PostalCode
			else
				return Vendor.CurrentAddressRel.PostalAddress.PostalCode

		DerivedCountry is a DerivedField
			type is Alpha 40
			if (PurchaseFromLocation entered)
				return PurchaseFromLocation.CurrentAddressRel.PostalAddress.Country.Name
			else
				return Vendor.CurrentAddressRel.PostalAddress.Country.Name

		PurchaseOrderDisplay				is a LabelField
			"PurchaseOrder:<PurchaseOrder>"
		CompanyDisplay						is a LabelField
			"Company:<Company>,<Company.Name>"
		VendorDisplay						is a LabelField
			"Vendor:<Vendor>,<Vendor.VendorName>"
		StatusDisplay						is a LabelField
			"Status:<DerivedPurchaseOrderStatus>"
		MobileVendorDisplay					is a LabelField
			"<Vendor>_-_<Vendor.VendorName>"
		MobileTotalOrderAmountDisplay		is a LabelField
			"<TotalOrderAmount>_-_<Currency>"


		DerivedDelimiter is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "Generic_Delimiter"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedTenantID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "tenantID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedReleaseID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "releaseID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedLogicalID is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "logicalID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedVersionID is a DerivedField
			type is Alpha size 60
			LocalConfigurationParameter = "VersionID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedappProdline is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "appProdline"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedPOOutForcetoEAM is a DerivedField
			type is Alpha size 5
			restricted
			LocalConfigurationParameter = "SyncPurchaseOrder_Out_Force_PO_to_EAM"
			if ((FSMBODConfigurationParameterRel exists and FSMBODConfigurationParameterRel.Value = "Y") and ShipToLocation.EAMLocation = "1")
				return "true"
			
		DerivedEAMDatabridge is a DerivedField
			type is Alpha size 20
			restricted
			if (DerivedPOOutForcetoEAM entered)
				return "eam.Databridge"
			else
				return ""

		DerivedPOOutIncludeUDFs is a DerivedField
			type is Boolean
			restricted
			LocalConfigurationParameter = "SyncPurchaseOrder_Out_Include_UDFs"
			if (FSMBODConfigurationParameterRel exists and FSMBODConfigurationParameterRel.Value = "Y")
				return true



		DerivedPurchaseOrderTitle is a DerivedField
			type is MessageField
			restricted
			if (!PurchaseOrder exists)
				return "Purchase Order"
			else
				return PurchaseOrderTitle

		PurchaseOrderTitle is a LabelField
			restricted
			"PurchaseOrder<PurchaseOrder.PurchaseOrder>"

		BODActionCode is a DerivedField
			type is Alpha 10
			restricted
			if (ActionCode = "C" or ActionCode.Create or action type.Create or (BODVariationID <= 1))
				return "Add"
			else
			if (ActionCode = "D" or ActionCode.Delete or PurchaseOrderLifeCycleState.Canceled)
				return "Delete"
			else
				return "Replace"

		DerivedPurchaseOrder is a DerivedField
			type is Alpha 12
			restricted
			return PurchaseOrder using "%d"

		DerivedRevision is a DerivedField
			type is Alpha 5
			restricted
			if (PurchaseOrderRevisionEntered)
				return PurchaseOrderRevision using "%d"
			else
				return ""

		BODVariationID is a DerivedField
			type is Alpha size 25
			restricted
			return bod id.VariationID

		DerivedLocation is a DerivedField
			type is Alpha size 22
			restricted
			if(ShipToLocation entered)
				if(DerivedRequiredCleanDocId = "Y")
					return ShipToLocation
				else
					return Company using "%d" + DerivedDelimiter + ShipToLocation
			else
				return ""

		DerivedFinanceEnterpriseGroup is a DerivedField
			type is AlphaUpper size 4
			restricted
			return GeneralLedgerCompanyRel.FinanceEnterpriseGroup

		DerivedCrossReferenceAccountingEntity is a DerivedField
			type is AlphaUpper size 22
			restricted
			if(DerivedRequiredCleanDocId = "Y")
				if(DerivedConfigFEG="Y")
					return DerivedFinanceEnterpriseGroup + DerivedDelimiter + Company using "%d"
				else
					return Company using "%d"
		
		DerivedCrossAE is a DerivedField
			type is AlphaUpper size 22
			restricted
			if(LocalAEAlreadyExecuted != true)
				LocalAEAlreadyExecuted = true
				if (FSMBODCrossReferenceDetailRel.DestinationValue entered)
					LocalAccountingEntity = FSMBODCrossReferenceDetailRel.DestinationValue
					return LocalAccountingEntity
				else
					LocalAccountingEntity = DerivedCrossReferenceAccountingEntity
					return LocalAccountingEntity
			else
				return LocalAccountingEntity
		
		DerivedAccountingEntity is a DerivedField
			type is AlphaUpper size 22
			restricted
			if(DerivedRequiredCleanDocId = "Y")
				return DerivedCrossAE
			else
				return Company.GeneralLedgerCompany.AccountingEntity
		

		BODAccountingEntity	is a DerivedField
			type is AlphaUpper size 22
			restricted
			if(DerivedRequiredCleanDocId = "Y")
				return DerivedCrossAE
			else
				return DerivedFinanceEnterpriseGroup + DerivedDelimiter + Company.GeneralLedgerCompany.AccountingEntity

		BODDocumentID	is a DerivedField
			type is Alpha size 22
			restricted
			if(DerivedRequiredCleanDocId = "Y")
				return PurchaseOrder
			else
				return Company using "%d" + DerivedDelimiter + PurchaseOrder using "%d"

		BODFormattedId is a DerivedField
			type is Alpha 100
			restricted
			return	"infor-nid:" + DerivedTenantID +":" + BODAccountingEntity +":"+DerivedLocation + ":" + BODDocumentID + ":" + "?PurchaseOrder&verb=Sync&TrackerID="+ LocalFSMInboundBODTracker

		BODCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			BODCurrentTimeStamp = current timestamp
			return BODCurrentTimeStamp

		BODFormattedCurrentTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			return BODCurrentTimeStamp[1:4] + "-" + BODCurrentTimeStamp[5:6] + "-" + BODCurrentTimeStamp[7:8] + "T" + BODCurrentTimeStamp[9:10] + ":" + BODCurrentTimeStamp[11:12] + ":" + BODCurrentTimeStamp[13:14] + "Z"

		MassBODTitleDate is a DerivedField
			type is Alpha size 25
			restricted
			return BODCurrentTimeStamp[7:8]+BODCurrentTimeStamp[5:6]+BODCurrentTimeStamp[1:4]

		BODCreateDate is a DerivedField
			type is Alpha size 25
			restricted
			BODCreateDate =  create stamp.timestamp
			return BODCreateDate

		BODCreateTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			return BODCreateDate[1:4] + "-" + BODCreateDate[5:6] + "-" + BODCreateDate[7:8] + "T" + BODCreateDate[9:10] + ":" + BODCreateDate[11:12] + ":" + BODCreateDate[13:14] + "Z"

		BODUpdateTimeStamp is a DerivedField
			type is Alpha size 25
			restricted
			BODUpdateTimeStamp =  update stamp.timestamp
			return BODUpdateTimeStamp[1:4] + "-" + BODUpdateTimeStamp[5:6] + "-" + BODUpdateTimeStamp[7:8] + "T" + BODUpdateTimeStamp[9:10] + ":" + BODUpdateTimeStamp[11:12] + ":" + BODUpdateTimeStamp[13:14] + "Z"

		BODVendorID	is a DerivedField
			type is Alpha size 25
			restricted
			if(DerivedRequiredCleanDocId = "Y")
				return Vendor
			else
				return GeneralLedgerCompanyRel.FinanceEnterpriseGroup+ DerivedDelimiter + Vendor.VendorGroup + DerivedDelimiter + Vendor using "%d"

		DerivedPOSupplierPartyId is a DerivedField
			type is XMLDocument
			restricted
			if(DerivedRequiredCleanDocId = "Y")
				return template.IONPOSupplierPartyCleanDocYXML_ST document for this instance
			else
				return template.IONPOSupplierPartyCleanDocNoXML_ST document for this instance

		BODVendorGroup is a DerivedField
			type is Alpha size 5
			restricted
			return Vendor.VendorGroup

		BODVendorName is a DerivedField
			type is Alpha size 120
			restricted
			return Vendor.VendorName

		DerivedSPAddressLine1 is a DerivedField
			type is Alpha up to 40
			restricted
			return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine1

		DerivedSPAddressLine2 is a DerivedField
			type is Alpha up to 40
			restricted
			return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine2

		DerivedSPAddressLine3 is a DerivedField
			type is Alpha up to 40
			restricted
			return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine3

		DerivedSPAddressLine4 is a DerivedField
			type is Alpha up to 40
			restricted
			return Vendor.CurrentAddressRel.PostalAddress.DeliveryAddress.AddressLine4

		DerivedVendorMunicipality is a DerivedField
			type is Alpha up to 58
			restricted
			return Vendor.CurrentAddressRel.PostalAddress.Municipality

		DerivedVendorStateProvince is a DerivedField
			type is AlphaUpper 3
			restricted
			return Vendor.CurrentAddressRel.PostalAddress.StateProvince

		DerivedVendorPostalCode is a DerivedField
			type is Alpha 12
			restricted
			return Vendor.CurrentAddressRel.PostalAddress.PostalCode

		DerivedVendorCountry is a DerivedField
			type is AlphaUpper 3
			restricted
			return Vendor.CurrentAddressRel.PostalAddress.Country

		PODropShipAddressLine1	is a DerivedField
			type is Alpha size 40
			restricted
			return DropshipAddress.DeliveryAddress.AddressLine1

		PODropShipAddressLine2	is a DerivedField
			type is Alpha size 40
			restricted
			return DropshipAddress.DeliveryAddress.AddressLine2

		PODropShipAddressLine3	is a DerivedField
			type is Alpha size 40
			restricted
			return DropshipAddress.DeliveryAddress.AddressLine3

		PODropShipAddressLine4	is a DerivedField
			type is Alpha size 40
			restricted
			return DropshipAddress.DeliveryAddress.AddressLine4

		PODropShipMunicipality	is a DerivedField
			type is Alpha size 58
			restricted
			return DropshipAddress.Municipality

		PODropShipStateProvince is a DerivedField
			type is AlphaUpper size 3
			restricted
			return DropshipAddress.StateProvince

		PODropShipCountry	is a DerivedField
			type is AlphaUpper size 3
			restricted
			return DropshipAddress.County

		PODropShipPostalCode	is a DerivedField
			type is Alpha size 12
			restricted
			return DropshipAddress.PostalCode

		POBillToAddressLine1	is a DerivedField
			type is Alpha size 40
			restricted
			return PurchaseOrderBillToAddress.DeliveryAddress.AddressLine1

		POBillToAddressLine2	is a DerivedField
			type is Alpha size 40
			restricted
			return PurchaseOrderBillToAddress.DeliveryAddress.AddressLine2

		POBillToAddressLine3	is a DerivedField
			type is Alpha size 40
			restricted
			return PurchaseOrderBillToAddress.DeliveryAddress.AddressLine3

		POBillToAddressLine4	is a DerivedField
			type is Alpha size 40
			restricted
			return PurchaseOrderBillToAddress.DeliveryAddress.AddressLine4

		POBillToMunicipality	is a DerivedField
			type is Alpha size 58
			restricted
			return PurchaseOrderBillToAddress.Municipality

		POBillToStateProvince is a DerivedField
			type is AlphaUpper size 3
			restricted
			return PurchaseOrderBillToAddress.StateProvince

		POBillToCountry	is a DerivedField
			type is AlphaUpper size 3
			restricted
			return PurchaseOrderBillToAddress.Country

		POBillPostalCode	is a DerivedField
			type is Alpha size 12
			restricted
			return PurchaseOrderBillToAddress.PostalCode

		DerivedBusinessGroup is a DerivedField
			type is AlphaUpper size 12
			restricted
			return Company.GeneralLedgerCompany.BusinessGroup

		AlphaDeliveryTimeStamp is a DerivedField
			type is Alpha size 20
			restricted
			return DefaultDeliveryDate

		DerivedDefaultDeliveryDate is a DerivedField
			type is Alpha size 25
			restricted
			if(DefaultDeliveryDate = "00000000")
				return ""
			else
				return AlphaDeliveryTimeStamp[1:4] + "-" + AlphaDeliveryTimeStamp[5:6] + "-" + AlphaDeliveryTimeStamp[7:8] +"T00:00:00Z"

		DerivedBlanketOrStandingContract is a DerivedField
			type is Alpha size 60
			restricted
			if(BlanketOrStandingContract entered)
				return BlanketOrStandingContract
			else
				return ""

		DerivedInvoiceMethodPO is a DerivedField
			type is Alpha size 25
			restricted
			if(InvoiceMethod entered)
				return "PurchaseOrder"
			else
				return ""

		DerivedPOStatus is a DerivedField
			type is Alpha size 25
			restricted
			if(Closed.Yes)
				return "Closed"
			else
				if(Canceled = true )
					return "Canceled"
				else
					return "Open"

		DerivedPODate is a DerivedField
			type is Alpha size 25
			restricted
			DerivedPODate = PurchaseOrderDate
			return DerivedPODate

		BODPODate is a DerivedField
			type is Alpha size 25
			restricted
			return DerivedPODate[1:4] + "-" + DerivedPODate[5:6] + "-" + DerivedPODate[7:8] + "T" + BODCreateDate[9:10] + ":" + BODCreateDate[11:12] + ":" + BODCreateDate[13:14] + "Z"


		DerivedAribaPOType is a DerivedField
			type is Alpha size 4
			restricted
			if(DerivedPOOutIncludeUDFs)
				return AribaPOType
			else
				return ""

		DerivedShippingNotes is a DerivedField
			type is Text
			restricted
			if(DerivedPOOutIncludeUDFs)
				return ShippingNotes
			else
				return ""

		IsAllowedToReleaseOverLimits is a DerivedField
			type is Boolean
			restricted
			if (ActorBuyerRel exists)
				return ActorBuyerRel.Buyer.AllowToReleaseOverLimits
			else
				return Buyer.AllowToReleaseOverLimits


		PurchaseOrderXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			PurchaseOrderXMLBOD = template.IONPurchaseOrderXML_ST document for this instance



		ProcessBODFormattedId is a DerivedField
			type is Alpha 100
			restricted
			return	"infor-nid:" + DerivedTenantID +":" + ProcessBODAccountingEntity +":"+ShipToLocation + ":" + ProcessBODDocumentID + ":" + "?PurchaseOrder&verb=Process&TrackerID="+ LocalFSMInboundBODTracker

		DerivedProcessAccountingEntity is a DerivedField
			type is AlphaUpper size 12
			restricted
			return Company.GeneralLedgerCompany.AccountingEntity
			
		ProcessBODAccountingEntity	is a DerivedField
			type is AlphaUpper size 22
			restricted
			return DerivedFinanceEnterpriseGroup + DerivedDelimiter + Company.GeneralLedgerCompany.AccountingEntity
			
		ProcessBODDocumentID	is a DerivedField
			type is Alpha size 22
			restricted
			return Company using "%d" + DerivedDelimiter + PurchaseOrder using "%d"
			
		DerivedProcessSPAddressLine1 is a DerivedField
			type is Alpha up to 40
			restricted
			return VendorAddressRel.PostalAddress.DeliveryAddress.AddressLine1

		DerivedProcessSPAddressLine2 is a DerivedField
			type is Alpha up to 40
			restricted
			return VendorAddressRel.PostalAddress.DeliveryAddress.AddressLine2

		DerivedProcessSPAddressLine3 is a DerivedField
			type is Alpha up to 40
			restricted
			return VendorAddressRel.PostalAddress.DeliveryAddress.AddressLine3

		DerivedProcessSPAddressLine4 is a DerivedField
			type is Alpha up to 40
			restricted
			return VendorAddressRel.PostalAddress.DeliveryAddress.AddressLine4

		DerivedProcessVendorMunicipality is a DerivedField
			type is Alpha up to 58
			restricted
			return VendorAddressRel.PostalAddress.Municipality

		DerivedProcessVendorStateProvince is a DerivedField
			type is AlphaUpper 3
			restricted
			return VendorAddressRel.PostalAddress.StateProvince

		DerivedProcessVendorPostalCode is a DerivedField
			type is Alpha 12
			restricted
			return VendorAddressRel.PostalAddress.PostalCode

		DerivedProcessVendorCountry is a DerivedField
			type is AlphaUpper 3
			restricted
			if(VendorAddressRel.PostalAddress.Country ="USA")
				return "US"
			else
				return VendorAddressRel.PostalAddress.Country
		
		ProcessPurchaseOrderXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			ProcessPurchaseOrderXMLBOD = template.IONProcessPurchaseOrder_ST document for this instance

		ProcessPurchaseOrderHeaderAOCXML is a DerivedField
			type is XMLDocument
			restricted
			if(PurchaseOrderAddOnChargesByVendorRel exists)
				for each PurchaseOrderAddOnChargesByVendorRel
					ProcessPurchaseOrderHeaderAOCXML += template.IONPurchaseOrderAOCHeaderXML_ST document for each
			else
				return ""
																		


		BROrderToInvoiceXMLBOD is a DerivedField
			type is XMLDocument
			restricted
			BROrderToInvoiceXMLBOD = template.IONBROrderToInvoice_ST document for this instance
					
		DerivedPurchaseOrderEmailFrom is a DerivedField
			type is Alpha size 255
			if (Company.PurchaseOrderIDMEmailFrom entered)
				return Company.PurchaseOrderIDMEmailFrom
			else
			if (Buyer.EmployeeWorkEmailAddress entered)
				return Buyer.EmployeeWorkEmailAddress
			else
				return config.DefaultFromEmailAddress

		DerivedPurchaseOrderEmailSubject is a DerivedField
			type is Alpha size 255
			restricted
			if (Company.PurchaseOrderIDMEmailSubject entered)
				return DerivedCompanyEmailSubject
			else
				return DerivedIDMEmailSubject

		DerivedCurrentTimestamp is a DerivedField
			type is Alpha size 12
			restricted
			return current date + current time

		DerivedIDMXMLListNoDataMessage is a MessageField
			restricted
			"ThereAreNo_Purchase_Order_XMLFilesYet"
		
		DerivedIDMXMLListNoDataDescriptionMessage is a MessageField
			restricted
			"GenerateOneThroughTheButtonBelow."
		
		DerivedOverwriteIDMXMLConfirmationMessage is a MessageField
			restricted
			"CurrentXML_FileWillBeOverwritten."

		DerivedPurchaseOrderEmailBody is a DerivedField
			type is RichText
			restricted
			if (Company.PurchaseOrderEmailBody entered)
				return Company.PurchaseOrderEmailBody
			else
				return "PurchaseOrder<PurchaseOrder>Attached."


		DerivedCompletionDetailText	is a DerivedField
			type is RichText
			if (LocalPurgeRecords)
				return DerivedPurgePOText
			else
				return DerivedReportPurgePOText

		DerivedPurgePOText is a MessageField
			"PurchaseOrderPurgeHasBeenCompletedFor<LocalPurgeCount>Records."

		DerivedReportPurgePOText is a MessageField
			"ThereAre<LocalPurgeCount>PurchaseOrderRecordsWhichCanBePurged."

		ReleaseErrorMessage				is a MessageField
			"ReleaseError:_"

		DerivedForegroundLimit is a DerivedField
			type is Numeric 2
			restricted
			return 50

		DerivedIDMConnected is a DerivedField
			type is Boolean
			if (IDMConfigurationRel exists)
				invoke BackgroundTestConnection IDMConfigurationRel
					resume on error
						FailedIDMConnection = true
				if (FailedIDMConnection)
					return false
				else
					return true
			else
				return false

	  	DisplayShortPurchaseOrderAndRevision is a StringField
			type is Alpha size 40
			PurchaseOrder
			"-"
			PurchaseOrderRevision

	  	POTotalCurrency is a DerivedField
			type is Alpha size up to 20
			if (Currency entered)
				return TotalOrderAmount + " " + Currency
			else
				return TotalOrderAmount

		DerivedCompany is a DerivedField
			type is Text
			return Company.RepresentativeText


		NewInProcessMessage                    is a MessageField
			restricted
			"Unreleased.CreationInProcessFromInterface"



		DerivedPurchFromLocation is a DerivedField
			type is Alpha size 100
			restricted
			if(PurchaseFromLocation !="")
				if(DerivedRequiredCleanDocId = "Y")
					return Vendor + DerivedDelimiter + PurchaseFromLocation
				else
					return Vendor.VendorGroup + DerivedDelimiter + Vendor + DerivedDelimiter + PurchaseFromLocation
			else
				return ""

		DerivedRequiredCleanDocId is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "RequiredCleanDocumentID"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		DerivedConfigFEG is a DerivedField
			type is Alpha size 60
			restricted
			LocalConfigurationParameter = "IsMultipleFEG"
			if (FSMBODConfigurationParameterRel exists)
				return FSMBODConfigurationParameterRel.Value

		ReceiveAllLine is a LabelField 
			restricted
			"ReceiveAllLines"

		DisplayLineCount is a DerivedField 
			type is Alpha size 30
			if (IsDropship 
			or HasServiceLinesOnly)
				return ""
			else
				return "(" + instance count of NonServiceLinesRel + ")"			

		LineCountNonServiceLine is a DerivedField 
			type is Alpha size 30
			return instance count of NonServiceLinesRel	
			
		DerivedCreateManualAcknowledgement is a DerivedField
			type is MessageField
			restricted
			if (PurchaseOrderEDIManualAcknowledgementRel exists)
				return "Update Manual Acknowledgement"
			else
				return "Create Manual Acknowledgement"

		DerivedNumberOfTaxablePOLines is a DerivedField
			type is Numeric size 6
			restricted
			return instance count of TaxablePurchaseOrderLinesRel

		DerivedNumberOfTaxableHeaderAOCs is a DerivedField
			type is Numeric size 3
			restricted
			return instance count of TaxablePurchaseOrderAddOnChargesRel

		DerivedNumberOfTaxableLineAOCs is a DerivedField
			type is Numeric size 3
			restricted
			return instance count of TaxablePurchaseOrderLineAddOnChargesRel

		DerivedNumberOfTaxLineItems is a DerivedField
			type is Numeric size 3
			restricted
			return (DerivedNumberOfTaxablePOLines + DerivedNumberOfTaxableHeaderAOCs + DerivedNumberOfTaxableLineAOCs)
		
		DerivedOneYearReplicationData is a DerivedField 
        	type is Boolean
            if ((current date - create date) <  360)
                return true
            else
                return false

        DerivedCurrencyMultDiv is a DerivedField
            type is AlphaUpper size 1 
			restricted
			LocalCurrencyRelationship.FromCurrency	= Currency
            LocalCurrencyRelationship.ToCurrency 	= Company.Currency
            return LocalCurrencyRelationship.MultDiv


		SpecialHandlingInstructionMessage				is a MessageField
			"ItemsWith_\Special_\HandlingInstructionsExist"


		SpecialHandlingInstructionListMessage			is a MessageField
			"ViewItemsWith_\Special_\Handling"





		DerivedAlternateShipToLocationBin is a DerivedField
			type is like Bin
			if (AlternateShipToLocationRel exists)
				return AlternateShipToLocationRel.PreferredBin
		
		IDMTemplateValidationMessage is a MessageField
			restricted
			"CannotCreateDocument,_\Purchasing_CompanyIsSetToUse_\I\D\M_Document;NoValid_I\D\M_templateDefinedOn_\CompanyOr_\VendorOr_\PurchaseFromLocation"

		IDMTemplateWithHeaderValidationMessage is a MessageField
			restricted
			"CannotCreateDocument,_\Purchasing_CompanyIsSetToUse_\I\D\M_Document;NoValid_I\D\M_templateDefinedOn_\CompanyOr_\VendorOr_\PurchaseFromLocationOr_\HeaderDetail"
		
		NonIDMTemplateValidationMessage is a MessageField
			restricted
			"CannotCreateDocument,_\Purchasing_CompanyIsSetToUse_Non-\I\D\M_Document;NoValid_Non-\I\D\M_templateDefinedOn_\CompanyOr_\VendorOr_\PurchaseFromLocation"
		
		NonIDMTemplateWithHeaderValidationMessage is a MessageField
			restricted
			"CannotCreateDocument,Purchasing_CompanyIsSetToUse_Non-\I\D\M_Document;NoValid_Non-\I\D\M_templateDefinedOnCompanyOrVendorOrPurchaseFromLocationOrHeaderDetail"

		TotalCanceledAmmount is a DerivedField
			type is like InternationalAmount
			return sum PurchaseOrderLineRel.CanceledAmount
		
		DerivedDeliveryMethodState is a DerivedField
			type is Alpha size 2
			return DeliveryMethod


		DerivedIntrastatProcessing			is a DerivedField
			type is Boolean
			restricted
			if (Company.AccountingEntity.TaxEntity.IntrastatUsed)
				IntrastatProcessing.TaxEntity			    = Company.AccountingEntity
				IntrastatProcessing.PurchaseOrder		    = PurchaseOrder
				IntrastatProcessing.Vendor			        = Vendor
				IntrastatProcessing.DeliveryTerms			= ShipTerm
				IntrastatProcessing.SystemCode				= "PO"
				IntrastatProcessing.DestinationCountry		= ShipToLocation.PostalAddressForPurchaseOrder.Country
				IntrastatProcessing.DestinationRegion		= ShipToLocation.PostalAddressForPurchaseOrder.Region
				if (PurchaseFromLocation entered)
					IntrastatProcessing.OriginCountry		= PurchaseFromLocation.VendorAddress.Country
					IntrastatProcessing.OriginRegion		= PurchaseFromLocation.VendorAddress.Region
				else
					IntrastatProcessing.OriginCountry		= Vendor.VendorAddress.Country
					IntrastatProcessing.OriginRegion		= Vendor.VendorAddress.Region
				LocalTrigger			                    = IntrastatProcessing.CheckCountries
				return IntrastatProcessing.DoIntrastatReporting

	Conditions
		IsHSNSACCodeEnabled
			restricted
			when (Company.GeneralLedgerCompany.RequireHSNSACCode)

		HasReference1
			restricted
			when (Reference1 entered)

		HasReference2
			restricted
			when (Reference2 entered)

		HasSupplierContactForPurchaseFrom
			restricted
			when (DerivedSupplierSourceId entered)
		
		HasMessageDialogOther
			restricted
			when (SupplierMessageDialogRel exists)

		BuyerCanCreateDialog
			restricted
			when (HasSupplier
			and   SupplierGroupRel.CanCreateDialogWithSupplier
			and  (Issued
 			or   (Released
 			and   IssueMethod.DoNotPrint)))
		
		SupplierContactHasOrdersAccess
			restricted
			when (SupplierSourceIdValidRel.HasOrdersAccess)
		
		ContractLinesExist
			restricted
			when (LinesForAContractLineRel exists)

		SupplierShowReceipt
			restricted
			when (PurchaseOrderReceiptExists
			and  !actor.agent(SupplierSourceId).SupplierGroup.SPDisablePortalReceipts)

		SupplierShowRevisions
			restricted
			when (HasRevision
			and  !actor.agent(SupplierSourceId).SupplierGroup.SPDisablePortalAcknowledgments)

		SupplierShowRevisionsManuallyEntered
			restricted
			when (SupplierShowRevisions
			and   AcknowledgedViaSupplierPortal)

		HasSupplier
			restricted
			when (Vendor.HasSupplier)
		
		PurchaseFromLocationContactDetailsExists
			when (PurchasingVendorRel exists
			and   PurchaseFromLocationRel exists
			and	 (PurchaseFromLocationRel.ContactName entered
			or	  PurchaseFromLocationRel.PhoneNumber.SubscriberNumber entered
			or	  PurchaseFromLocationRel.EmailAddress entered))
		
		APVendorLocationContactDetailsExists
			when (PurchasingVendorRel not exists
			and  (PurchaseFromLocation.PrimeVendorLocationContactRel.ContactName entered
			or	  PurchaseFromLocation.PrimeVendorLocationContactRel.PhoneNumber.SubscriberNumber entered
			or	  PurchaseFromLocation.PrimeVendorLocationContactRel.EmailAddress entered))

		PurchasingVendorContactDetailsExists
			when (Vendor.PurchasingVendorRel.ContactName entered
			or	  Vendor.PurchasingVendorRel.PhoneNumber.SubscriberNumber entered
			or	  Vendor.PurchasingVendorRel.EmailAddress entered)

		PurchaseFromLocationVendorAccountEntered
			when (PurchaseFromLocation.VendorAccount entered)

		PurchaseFromLocationVendorAddressEntered
			when (PurchaseFromLocation.CurrentAddressRelExists)

		HasMessageDialog  
			when (SupplierContactMessageRel exists)

		HasDialogForAPurchaseOrderExists
			when (BuyerSupplierContactMessageRel exists)

		IssueMethodPaperAndUsingIDM
			restricted
			when (Company.UseIDM and IssueMethod.Paper)

		HasIDMDocument
			restricted
			when (Company.UseIDM and (IDMJob.Status.Finished
			or IDMDocumentPID entered))

		HasIDMJob
			restricted
			when (Company.UseIDM and IDMJob entered)

		HasIDMJobError
			restricted	
			when (HasIDMJob and (IDMJob.Status.TimedOut or IDMJob.Status.Failed))

		ValidForRegeneration
			restricted
			when (HasIDMJobError 
			and IsIssuedState
			and IssueMethodForRegeneration)

		CanRegenerateForCanceled
			restricted	
			when (HasIDMJobError
			and IsCanceled
			and IsIssuedState)			
			
		HasLineComments
			restricted
			when (PurchaseOrderLineCommentsRel exists)

		InspectionsExist
			restricted
			when (ReceivingInspectionRel exists)

		BuyerMessagesExist
			restricted
			when (ReceivingBuyerMessagesRel exists)

		PurchaseOrderLinesExist
			restricted
			when (PurchaseOrderLinesRel exists)

		PurchaseOrderLinesOpenToReceiveExist
			restricted
			when (PurchaseOrderLinesRel exists
			and PurchaseOrderLinesRel.IsOpenForReceiving)

		PurchaseOrderLinesReceivedNotInvoicedExist
			restricted
			when (PurchaseOrderLinesReceivedNotInvoicedRel exists)

		AdjustmentsExist
			restricted
			when (ReceivingAdjustmentRel exists)
		
		HasReleasedAdjustments
			restricted
			when (ReleasedReceivingAdjustmentRel exists)

		PurchaseOrderCanBeCopied
			restricted
			when (PurchaseOrderLinesForCopyRel exists)

		HasLineToProcess
			restricted
			when (PurchaseOrderLinesToProcessRel exists)

		HasProcessedLine
			restricted
			when (PurchaseOrderLinesProcessedRel exists)

		HasCancellableLine
			restricted
			when (CancellablePurchaseOrderLinesRel exists)

		PurchaseOrderExists
			restricted
			when (PurchaseOrder exists)

		PurchaseOrderHeaderCommentExists
			restricted
			when (PurchaseOrderHeaderCommentRel exists)

		HasWorkunit
			restricted
			when (PfiWorkunitRel exists)

		IsIssuedState
			restricted
			when (Issued
			and not IssuePending)

		HasIssuedDocument
			restricted
			when (not IssueMethod.DoNotPrint)

		NotInterfaceInProcess
			restricted
			when (InterfaceInProcess.NotInProcess)

		InterfacedPurchaseOrderExists
			restricted
			when (InterfacedPurchaseOrderRel exists)

		PurchaseOrderHasCatchWeight
			restricted
			when (PurchaseOrderLineCatchWeightRel exists)

		PurchaseOrderHasBinTracked
			restricted
			when (PurchaseOrderLineBinTrackedRel exists)

		CompanyShowsRemainingQuantity
			restricted
			when (Company.DisplayRemainingQuantity = true)

		AllowDelete
			restricted
			when (not Issued
			and   not BudgetEditInProgress
			and   not AllPurchaseOrderReceiptsRel exists)

		IsUpdateAllowed
			restricted
			when (not BudgetEditInProgress
			and   not Closed.Historical
			and   not IsOnHold)

		RestrictPOHeaderChanges		
			restricted
			when  ((not Company.ReopenPurchaseOrder
			and		PurchaseOrderLifeCycleState.Closed)
			or	   (PurchaseOrderLifeCycleState.Historical
			or		PurchaseOrderLifeCycleState.Canceled)
			or		BudgetEditInProgress)


		HasExistingPODocument
			restricted
			when (not Company.UseIDM and first LatestPODocumentRel.Attachment.File entered)






		HasPurchaseOrderLinesWithActivity
			restricted
			when (PurchaseOrderLinesWithActivityRel exists)

		HasPODocument
			restricted
			when (PurchaseOrderDocument entered
			or	  HasExistingPODocument)

		PurchaseOrderDateWithinRange
			restricted
			when (!PurchaseOrderDateRange entered
			or   (PurchaseOrderDateRange entered
			and   PurchaseOrderDate within PurchaseOrderDateRange))

		DefaultDeliveryDateWithinRange
			restricted
			when (!DefaultDeliveryDateRange entered
			or   (DefaultDeliveryDateRange entered
			and   DefaultDeliveryDate within DefaultDeliveryDateRange))

		PurchaseOrderAndDefaultDeliveryDateWithinRange
			restricted
			when (PurchaseOrderDateWithinRange
			and   DefaultDeliveryDateWithinRange)

		PayablesInvoiceAvailable
			restricted
			when (PayablesInvoice in context
			and  (PayablesInvoice.IsUpdateable
			or    PayablesInvoice.Status.Amended))

		BudgetRebuildExists
			restricted
			when (BudgetRebuildBTGTRel exists)

		RQUsesBudgets
			restricted
			when (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit)

		RQUsesCommitments
			restricted
			when (RQGeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
			or    RQGeneralLedgerSystemCodeRel.EncumbranceOption.Track)

		OpenCommitmentsExist
			restricted
			when (OpenGLCommitDrillRel exists)

		BudgetEditingInformationExists
			restricted
			when (BudgetTemplateGroupTotalRel exists)

		BudgetEditInProgress
			restricted
			when (BudgetEditProcessing = 1)

		BudgetEditFailure
			restricted
			when (BudgetEditProcessing = 2)

		ValidForCreateUpdate
			restricted
			when (not BudgetEditInProgress
			and  (not IsOnHold)
			and  (FromInterfaceUpdate
			or   (not FromInterfaceUpdate and InterfaceInProcess.NotInProcess)))

		CommittedDistributionsExist
			restricted
			when (PurchaseOrderLineDistributionsCommittedRel exists)

		CommitmentSearchFilter
			restricted
			when (MatchesAccountingEntitySearch
			and	  MatchesAccountingUnitSearch
			and	  MatchesProjectSearch
			and	  MatchesFinDim1Search
			and	  MatchesFinDim2Search
			and	  MatchesFinDim3Search
			and	  MatchesFinDim4Search
			and	  MatchesFinDim5Search
			and	  MatchesFinDim6Search
			and	  MatchesFinDim7Search
			and	  MatchesFinDim8Search
			and	  MatchesFinDim9Search
			and	  MatchesFinDim10Search
			and	  MatchesAccountSearch)

		VendorHasValidDiversity
			when (VendorDiversityRel exists)

		HasTerms
			restricted
			when (TermCode entered)

		IssueMethodByPaper
			restricted
			when (IssueMethod.Paper)

		HasBillToAddress
			restricted
			when (PurchaseOrderBillToName entered
			or	  PurchaseOrderBillToAddress entered)

		IsValidForActorContext
			restricted
			when ((actor.context.FinanceEnterpriseGroup != ""
			and   GeneralLedgerCompanyRel.FinanceEnterpriseGroup = actor.context.FinanceEnterpriseGroup)
			or   (actor.context.FinanceEnterpriseGroup = ""))

		HasPORelease
			classic name is BLANKET-ORDER
			restricted
			when (PORelease entered)

		NotClosed
			restricted
			when (Closed.No)

	   	IsClosed
	   		when (Closed.Yes)

		HasComment
			restricted
			when(PurchaseOrderComment set exists)

		IsCanceled
			restricted
			when (Canceled)

		IsDropship
			restricted
			when (Dropship)

		ComingDueShipments
			restricted
 			when (ShipmentNotReceived
 			and	  DueDateWithinAWeek)
		DueDateWithinAWeek
			restricted
			when (DerivedDeliveryDays < 8
			and   DerivedDeliveryDays >= 0
			and   ShipmentNotReceived)
		OverdueShipment
			when (ShipmentNotReceived
			and   current corporate date > DefaultDeliveryDate)
		ReceivedShipment
			restricted
			when (IsMatchable
 			and	  HasLines
 			and	  ReceivedInFull)
		ShipmentNotReceived
			restricted
			when (IsMatchable
 			and	  !Dropship
 			and   DefaultDeliveryDate entered
 			and   HasNonServiceLines
 			and	  !ReceivedInFull)
		OpenOrdersByVendorForDrill
			restricted
			when ((Issued
			or   (Released
			and   IssueMethod.DoNotPrint))
			and   NotClosed)
		OpenOrdersByVendor
			restricted
			when ((Issued
			or   (Released
			and   IssueMethod.DoNotPrint))
			and   NotClosed
			and   ForSupplier)
		ShipmentNotReceivedByVendor
			restricted
 			when (ForSupplier
 			and   ShipmentNotReceived
 			and  (Issued
 			or   (Released
 			and   IssueMethod.DoNotPrint)))
		ClosedByVendor
			restricted
			when (ForSupplier
 			and   IsHistory)
		ForSupplier
			restricted
			when (PayablesCompanyRel.VendorGroup       = actor.agent(SupplierSourceId).SupplierGroup
 			and   Vendor			 				   = actor.agent(SupplierSourceId).Supplier.Vendor)

		SupplierCanView
			restricted
			when (PayablesCompanyRel.VendorGroup       = actor.agent(SupplierSourceId).SupplierGroup
 			and   Vendor			 				   = actor.agent(SupplierSourceId).Supplier.Vendor
			and ((actor.agent(SupplierSourceId).Supplier.ContactLocationDisplay.AllDocuments)
			or  (!actor.agent(SupplierSourceId).Supplier.ContactLocationDisplay.AllDocuments
			and   actor.agent(SupplierSourceId).Supplier.PrimaryContactViewAllDocuments = true
			and   actor.agent(SupplierSourceId).PrimaryContact)
			or  ((actor.agent(SupplierSourceId).Supplier.ContactLocationDisplay.OnlyLocationDocuments
			or    actor.agent(SupplierSourceId).Supplier.ContactLocationDisplay.LocationAndNoLocationDocuments)
			and  (actor.agent(SupplierSourceId).Supplier.PrimaryContactViewAllDocuments = false
			or   !actor.agent(SupplierSourceId).PrimaryContact)
			and   PurchaseFromLocation entered
			and   actor.agent(SupplierSourceId).VendorLocation = PurchaseFromLocation)
			or   (actor.agent(SupplierSourceId).Supplier.ContactLocationDisplay.LocationAndNoLocationDocuments
			and   PurchaseFromLocation !entered)))

		ReceivedInFull
			restricted
			when (!PurchaseOrderLinesNotReceivedInFullRel exists)
		HasShipTerm
			classic name is FOBCODE
			restricted
			when (ShipTerm entered)

		HasLastActivity
			classic name is HAS-ACTIVITY
			restricted
			when (LastActivityDate entered)

		PayablesInvoiceHistoryExists
			classic name is HAS-APAPIHIST
			restricted
			when (first PayablesInvoiceHistoriesRel exists)

		AuditRecordExists
			classic name is HAS-AUDIT-REC
			restricted
			when (first PurchaseOrderAuditsRel exists)

		DistributionExists
			classic name is HAS-DIST
			restricted
			when (first PurchaseOrderLineDistributionsRel exists)






		PayablesInvoiceAddOnChargeExists
			classic name is HAS-MAAOCDTL
			restricted
			when (first PayablesInvoiceAddOnChargesRel exists)

		PayablesInvoiceDetailExists
			classic name is HAS-MAINVDTL
			restricted
			when (first PayablesInvoiceDetailsRel exists)

		PayablesInvoiceDetailByInvoiceExists
			classic name is HAS-MAINVDTL
			restricted
			when (PayablesInvoiceDetailsByInvoiceRel exists)

		MatchAocHistoryExists
			classic name is HAS-MAMAAHIST
			restricted
			when (first PayablesInvoiceAddOnChargeHistoriesRel exists)

		MatchInvoiceDetailHistoryExists
			classic name is HAS-MAMADHIST
			restricted
			when (first PayablesInvoiceDetailHistoriesRel exists)

		MiscellaneousAddOnChargeExists
			classic name is HAS-MISC-AOC
			restricted
			when (first PurchaseOrderAddOnChargesRel exists)

		HasPOCode
			restricted
			when (POCode entered)

		PurchaseOrderReceiptLineExists
			restricted
			when (PurchaseOrderReceiptLinesRel exists)

		PurchaseOrderReceiptExists
			restricted
			when (PurchaseOrderReceiptsRel exists)

		AnyMatchPurchaseOrderInvoicesWithChargebackExists
			restricted
			when (AnyMatchPurchaseOrderInvoicesWithChargebackByPORel exists)

		PurchaseOrderReceiptLineAOCExists
			restricted
			when (PurchaseOrderReceiptLineAOCsRelSet3 exists)

		PurchaseOrderSpreadAddOnChargeExists
			restricted
			when (PurchaseOrderLinesForSpreadAddOnChargesRel exists)

		IsHistory
			restricted
			when (Closed.Yes)

		IsMatchable
			restricted
			when (Released
			and   not Closed.Yes)

		IsNeedsApproval
			restricted
			when (Released
			and	  ApprovalStatus.NeedsApproval)

		NeedsNonMatrixApproval
			restricted
			when (IsNeedsApproval
			and   !PurchaseOrderApprovalType.MatrixLineDistribution)

		NeedsMatrixApproval
			restricted
			when (IsNeedsApproval
			and   PurchaseOrderApprovalType.MatrixLineDistribution)

		IsNeedsApprovalNotCanceled
			restricted
			when (IsNeedsApproval
			and   !Canceled)

		IsApproved
			restricted
			when (ApprovalStatus.Approved)

		HasNoLines
			classic name is NO-LINES
			restricted
			when (first PurchaseOrderLine set not exists)

		PurchaseOrderReceiptDoesNotExist
			classic name is NO-RECEIVER
			restricted
			when (first PurchaseOrderReceiptsRel not exists)

		HasProcessLevel
			classic name is POPROCLEV
			restricted
			when (ProcessLevel entered)

		HasVendor
			restricted
			when (Vendor entered)

		IsToBePrinted
			classic name is PRINT-PO
			restricted
			when (IssuePending
			and   Released
			and   VendorReturn not entered)

		IsReceivable
			restricted
			when (Released
			and   not Dropship
			and   NumberOfLines >  NumberOfClosedLines)

		IsReleased
			when (Released
			and   Closed.No)

		HasRetainage
			classic name is RETAINAGE-PO
			restricted
			when (RetainagePercentCompleteTracking.PurchaseOrderLevel
			or    RetainagePercentCompleteTracking.LineLevel)

		HasRetainageContract
			restricted
			when (RetainagePercentCompleteTracking.Contract)

		FromVendorReturn
			classic name is RETURN-PO
			restricted
			when (VendorReturn entered)

		IsSubcontractorPurchaseOrder
			classic name is SUBCONTRACT-PO
			restricted
			when (SubcontractorPurchaseOrder)

		IsNotIssued
			classic name is UNISSUED
			restricted
			when (not Issued)

		IsUnreleased
			restricted
			when (not Released)

		IsReleaseInProgress
			restricted
			when (PurchaseOrderLifeCycleState.ReleaseInProgress)

		ReleasedButPendingIssue
			restricted
			when (Released
			and   IssuePending)


		CanIssueFinal
			restricted
			when (ReleasedButPendingIssue
			and  (PurchaseOrderRevisionsRel exists or PurchaseOrderLinesWithQuantityToProcessRel exists))

		ValidForIssueFinal
			restricted
			when (CanIssueFinal
			or    ValidForReissue) 

		CanIssueFinalForCanceled
			restricted	
			when (IsCanceled
			and   IssuePending)	

		ValidForIssueDraft
			restricted
			when (IssueMethod.Paper
			and   not Canceled)

		ValidForReissue
			restricted
			when ((Released 																				
			and   (IssuePending or TransientMassIssue))														
			and   (PurchaseOrderRevisionsRel exists or PurchaseOrderLinesWithQuantityToProcessRel exists))	

		ValidForResequence
			restricted
			when (HasLines
			and   not Canceled)

		HasUnreleasedRevision
			restricted
			when (not Issued
			and Revised
			and not Released)

		HasPurchaseFromLocation
			classic name is VENDORLOC
			restricted
			when (PurchaseFromLocation entered)

		ValidForCancel
			restricted
			when (Released
			and   HasLineToProcess
			and   not BudgetEditInProgress
			and  (not IsSubcontractorPurchaseOrder
			or    Approved))

		PurchaseOrderEligibleToBeCancelled
			restricted
			when (ValidForCancel
			and   not HasProcessedLine)

		PurchaseOrderEligibleForCancelRemaining
			restricted
			when (ValidForCancel
			and   HasProcessedLine
			and   HasCancellableLine)

		HasHeaderAddOnCostAndLines
			restricted
			when (PurchaseOrderAddOnChargesRel exists)

		HasLineAddOnCharges 
			restricted
			when (PurchaseOrderLineAddOnChargesSameVendorRel exists)

		HasLineAddOnChargesNotFromSpread 
			restricted
			when (PurchaseOrderLineAddOnChargesSameVendorNoSpreadRel exists)

		HasHeaderAddOnCharges 
			restricted 
			when (PurchaseOrderAddOnChargesByVendorRel exists)

		HasSpreadAddOnCharges 
			restricted 
			when (PurchaseOrderSpreadAddOnChargesForVendorRel exists)
		
		PurchaseOrderInOpenStatus
			restricted
			when (!Released
			and   Closed.No)

		CanceledFromElsewhere
			restricted
			when (TransientCancelOriginationProgram entered)

		HasLines
			restricted
			when (PurchaseOrderLine set exists)

		MatchPurchaseOrderInvoiceExist
			restricted
			when (MatchPurchaseOrderInvoicesByPORel exists)

		MatchPurchaseOrderInvoicesForAPurchaseOrderExist
			restricted
			when (MatchedPurchaseOrderInvoicesRel exists)

		AnyMatchPurchaseOrderInvoiceExists
			restricted
			when (AnyMatchPurchaseOrderInvoicesByPORel exists)

		SupplierCreatedInvoiceExists
			restricted
			when (AnySCMatchPurchaseOrderInvoicesByPORel exists)

		MatchInvoiceNotSupplierCreatedExists
			restricted
			when (AnyMatchPurchaseOrderInvoiceExists
			and   !SupplierCreatedInvoiceExists)

		VendorValidForInvoice
			restricted
			when (PayablesInvoice.Vendor not entered
			or	  PayablesInvoice.Vendor = Vendor)

		InvalidVendorStatus
			restricted
			when (Vendor.VendorStatus.Inactive
			or   (Vendor.VendorStatus.InactiveForPOAdditions and action type.Create))

		CompanyValidForInvoice
			restricted
			when (!PayablesInvoice.Company entered
				or PayablesInvoice.Company = Company)

		HasRevision
			restricted
			when (PurchaseOrderRevisionsRel exists)

		PurchaseOrderRevisionEntered
			restricted
			when (PurchaseOrderRevision entered)

		HasRevisePOIssue
			restricted
			when (PurchaseOrderRevisionEntered
			and  (PurchaseFromLocationRel.RevisedEDINumber entered
			or    PurchasingVendorRel.RevisedEDINumber entered))

		HasLinesAvailableToMatch
			restricted
			when (DerivedQuantityAvailableToMatch entered)

		AllowRetainageEdit
			restricted
			when (TransientReleaseOriginationProgram.Receiving
			or    TransientReleaseOriginationProgram.Cancel
			or    TransientReleaseOriginationProgram.OnlineAuthorization)

		FromBlanketOrStanding
			restricted
			when (BlanketOrStandingContract entered)

		FromBlanket
			restricted
			when (BlanketOrStandingContract.BlanketPurchaseType)

		FromStanding
			restricted
			when (BlanketOrStandingContract.StandingPurchaseType)

		FromBlanketOrTemplate
			restricted
			when (FromBlanketOrStanding
			or    ProcurementTemplate entered)

		FromProcurementTemplate
			restricted
			when (ProcurementTemplate entered)

		SupplierVendorSameAsPOVendor
			restricted
			when (Vendor = actor.agent(SupplierSourceId).Supplier.Vendor)

		SupplierAllowedInvoicesStartedInternally
			restricted
			when (actor.agent(SupplierSourceId).Supplier.AllowMixedEntryOfInvoices)

		HasNonServiceLines
			restricted
			when (NonServiceLinesRel exists)

		HasServiceLinesOnly
			restricted
			when (!NonServiceLinesRel exists)

		HasPOLineItemMasterItems 
			restricted 
			when (ItemMasterOnLineRel exists)

		HasPOSpecialLinesFromContracts
			restricted 
			when (SpecialContractLineOnLineRel exists)

		HasLinesToBackorder 
			restricted 
			when (!HasServiceLinesOnly
			and  (HasPOSpecialLinesFromContracts
			or    HasPOLineItemMasterItems))
		
		HeaderBudgetErrorsExist
			when (HeaderBudgetEditErrorRel exists)

		DistributionBudgetErrorsExist
			when (DistributionBudgetEditErrorRel exists)

		HasBudgetErrors
			when (HeaderBudgetErrorsExist
			or    DistributionBudgetErrorsExist)

		CommitmentsExist
			restricted
			when (GLCommitDrillRel exists)

		SupplierCommentsExist
			restricted
			when (PurchaseOrderCommentDisplayOnPortalRel exists)

		HeaderAddOnChargesForSameVendorExist
			restricted
			when (PurchaseOrderAddOnChargesByVendorRel exists)

		SupplierShowInvoiceLinks
			restricted
			when (InvoicesExist
			and	  !actor.agent(SupplierSourceId).SupplierGroup.SPDisablePortalInvoices)

		InvoicesExist
			restricted
			when (MatchPurchaseOrderInvoice set exists)

		HasLineSource
			restricted
			when (PurchaseOrderLineSourceRel exists)

		IsGroupedByDiversity								
			restricted
			when (PurchaseOrdersByDiversityRel not exists)

		HasExceededPurchaseFromLocationLimit
			restricted
			when (PurchaseFromLocationRel.OpenPurchaseLimit > 0
			and   PurchaseFromLocationRel.OpenPurchaseAmount + OpenPurchaseAmount > PurchaseFromLocationRel.OpenPurchaseLimit)

		HasExceededPurchasingVendorLimit
			restricted
			when (PurchasingVendorRel.OpenPurchaseLimit > 0
			and   PurchasingVendorRel.OpenPurchaseAmount + OpenPurchaseAmount > PurchasingVendorRel.OpenPurchaseLimit)

		HasDiversity
			restricted
			when (PurchaseOrderDiversityListRel exists)

		DiversityNoWithinDates
			restricted
			when (!VendorGroupRel.DiversityValidWhenWithinDates)

		DisplayFaxStatus
			restricted
			when (IssueMethod.Fax
			and   IsIssuedState)

		NeedsACalendar
			restricted
			when (!BasicAnalyticsCalendarsRel exists)

		LineErrorsExist
			restricted
			when (PurchaseOrderLinesInErrorRel exists)

		LineErrorsFromHeaderExists
			restricted
			when (PurchaseOrderLineErrorsRel exists)

		HasNonPHIDefaultProcInfo
			restricted
			when (DefaultProcedureInformation entered)

		HasPHIDefaultProcInfo
			restricted
			when (TransientVisitNumber 			entered
			or	  TransientPatientID 			entered
			or	  TransientCaseNumber 			entered
			or	  TransientPatientLastName 		entered
			or	  TransientPatientFirstName 	entered
			or	  TransientPatientMiddleName 	entered
			or	  TransientBirthdate 			entered
			or	  TransientGender 				entered
			or	  TransientSocialSecurityNumber entered)

		HasDefaultProcedureInformation
			restricted
			when (HasNonPHIDefaultProcInfo
			or    HasPHIDefaultProcInfo)

	   	PHIProcedureInformationChanged
	   		restricted
			when (PatientProcedure entered
			and  (TransientVisitNumber 			changed
			or	  TransientPatientID 			changed
			or	  TransientCaseNumber 			changed
		   	or	  TransientPatientLastName 		changed
			or	  TransientPatientFirstName 	changed
			or	  TransientPatientMiddleName 	changed
			or	  TransientBirthdate 			changed
			or	  TransientGender 				changed
			or	  TransientSocialSecurityNumber changed))

		PatientProcedureInfoExists
			when (PatientProcedure exists
			or    DefaultProcedureInformation entered)

		HasPatientProcedureRecord
			restricted
			when (PatientProcedure exists)

		IsDeletePatientProcAllowed
			when (PurchaseOrder.IsUnreleased
			and   PatientProcedureInfoExists)

		IsMyPurchaseOrder
			restricted
			when (Buyer = actor.agent(Employee).Employee)

		DisplayOfProcedureInfo
			restricted
			when (actor.agent(Employee).Employee.Buyer.AllowDisplayOfProcedureInfo)

		MultipleRequesters
			restricted
			when (PurchaseOrderRequesterLineSourceRel exists
			and   first PurchaseOrderRequesterLineSourceRel.Requester != any PurchaseOrderRequesterLineSourceRel.Requester)

		SearchRequesterFound
			restricted
			when (SearchRequester not entered
			or    PurchaseOrderLineSourceForSearchRequesterRel exists)

		SearchRequesterNameFound
			restricted
			when (SearchRequesterName not entered
			or    PurchaseOrderLineSourceForSearchRequesterNameRel exists)

		POLineNotPrintedOnReceivingDocument
			restricted
			when (PurchaseOrderLineForReceivingDocumentIDMRel exists)

		CanOverrideIDMDocumentTemplate
			restricted
			when (Buyer.OverrideDocumentTemplate and Company.UseIDM)

		CanOverrideDocumentTemplate
			restricted
			when (Buyer.OverrideDocumentTemplate and not Company.UseIDM)

		VendorReturnLinesFound
			restricted
			when (VendorReturnLinesRel exists)

		HasUnreleasedReceipts 
			restricted
			when (UnreleasedPurchaseOrderReceiptsRel exists)


		HasAddOnChargesNotAvailableForClosing
			restricted
			when (OpenAddOnChargesRel exists
			and current corporate date <= LastActivityDate + PurchasingCompanyRel.AddOnChargeCloseDays)

		ForHeaderDeletion
			restricted
			when (PurchaseOrderLifeCycleState.Deleted
			or	  PurchaseOrderLifeCycleState.DeleteInProgress)

		IsDeleteInProgress
			restricted
			when (PurchaseOrderLifeCycleState.DeleteInProgress)

		ShowIDMPrinter
			restricted
			when (IssueMethodPaperAndUsingIDM
			and	PurchaseOrderLifeCycleState.Unreleased
			or (Released
			and not Issued)
			or (Issued
			and Revised
			and Released))

		NotAcknowledged
			restricted
			when (AcknowledgedViaSupplierPortal = false)

		ForSupplierNotAcknowledged
			restricted
			when (ForSupplier
			and   AcknowledgedViaSupplierPortal = false)

		CanAcknowledge
			restricted
			when (ForSupplier
			and   AcknowledgedViaSupplierPortal = false
			and   PurchaseOrderEDIAcknowledgementRel !exists)

		PurchaseOrderEDIAcknowledgementsExist
			restricted
			when (PurchaseOrderEDIAcknowledgementRel exists)
		
		IsVendorOnLease
			restricted
			when (Vendor = ContextVendor)
			
		HasInvoices
			restricted
			when (InvoicesForAPurchaseOrderRel exists)

		MultipleInvoices
			restricted
			when (instance count of InvoicesForAPurchaseOrderRel > 1)


		DefaultOperatingCompanyRequired
			restricted
			when (DefaultSourceInformation.DefaultSourceDocument entered)

		DefaultRequestingLocationRequired
			restricted
			when (DefaultSourceInformation.DefaultOperatingCompany entered
				or DefaultSourceInformation.DefaultSourceDocument entered)
		
		DefaultOperatingCompanyRequestingLocationRequired
			restricted
			when (DefaultSourceInformation.DefaultOperatingCompany entered
				or DefaultSourceInformation.DefaultRequestingLocation entered)

		DefaultSourceDocumentRequired
			restricted
			when (DefaultOperatingCompanyRequestingLocationRequired
				or DefaultSourceInformation.DefaultRequester entered
				or DefaultSourceInformation.DefaultDeliverTo entered)

		DropshipAddressRequired
			restricted
			when ((Dropship
			and  (not ShipToLocation.DefaultDropshipPurchaseOrder
			or   ShipToLocation.PostalAddressForPurchaseOrder not entered))
			or	 (not Dropship
			and  (DropshipName entered
			or	  DropshipContact entered
			or	  DropshipPhoneNumber entered)))

		DropshipNameRequired
			restricted
			when ((Dropship
			and   (not ShipToLocation.DefaultDropshipPurchaseOrder
			or	   ShipToLocation.NameForPurchaseOrder not entered))
			or	  (not Dropship
			and	  (DropshipContact entered
			or	   DropshipPhoneNumber entered)))

		ProcessLevelRequired
			restricted
			when (Company.RequireProcessLevel
				and ((PurchaseOrder exists and PurchaseOrderLifeCycleState.Unreleased)
				or !TransientFromSourcing))

		NatureOfTransactionCodeRequired
			restricted
			when (PurchaseOrderLifeCycleState.Unreleased
			and  (DerivedIntrastatProcessing
			and   PurchaseOrder exists))

		RevisionsIncludeRequired
			restricted
			when (Issued
				and HasRevision
				and not RevisionsInclude.NotApplicable)
		
		HasDefaultDeliveryDate
			restricted
			when (DefaultDeliveryDate entered)
			
		AllowRelease
			restricted
			when (IsUpdateAllowed
			and PurchaseOrderLifeCycleState.Unreleased)

		SmartphoneDisplay
			restricted
			when (display type.smartphone)

			
		IsOnHold
			restricted
			when (TemporaryHold.SentForApproval)
	

		AllowedToFinishAcknowledgement
			restricted
			when (AcknowledgedPurchaseOrderRevisionRel not exists					
			and   PurchaseOrderEDIManualAcknowledgementRel exists)					
		
		ManualAcknowledgementAccepted
			restricted
			when (PurchaseOrderEDIManualAcceptedRel exists)
		
		ManualAcknowledgementWithDetailChange
			restricted
			when (PurchaseOrderEDIManualAcknowledgeWithChangeRel exists)
		
		AllowManualAcknowledgement
			restricted
			when (Company.AllowManualAcknowledgement								
			and   Released and Issued												
			and   not IssuePending
			and   not IssueMethod.EDI												
			and   AcknowledgedPurchaseOrderRevisionRel not exists)					

		DropshipMunicipalityOrStateProvinceOrPostalCodeEntered
			restricted
			when (DropshipAddress.Municipality entered
			or    DropshipAddress.StateProvince entered
			or    DropshipAddress.PostalCode entered)

		IsOneSourceTax										
			restricted				 							
			when (TaxEntityRel.ThirdParty.Sabrix)	
		
		IsOneSourceTaxAndPointOfTitleTransferDestination
			restricted
			when (TaxEntityRel.ThirdParty.Sabrix
			and	  PointOfTitleTransfer.Destination)

		SingleCallToOneSource
			restricted
			when (TaxEntityRel.ThirdParty.Sabrix
			and	  TaxEntityRel.DelayTaxProcessing
			and	  DerivedNumberOfTaxLineItems <= 200)

		SingleCallToVertex  
			restricted
			when (TaxEntityRel.ThirdParty.VertexOSeries
			and   TaxEntityRel.VertexCallMethod.ByTransaction
			and	  DerivedNumberOfTaxLineItems <= 200)

		VertexDelayTaxCall
			when (TaxEntityRel.ThirdParty.VertexOSeries
			and   TaxEntityRel.TaxAttributeCode entered)


		HasLinesWithSpecialHandling
			restricted
			when (PurchaseOrderLinesWithSpecialHandlingRel exists)

		HasAssets								
			when (PurchaseOrderLineAsset set exist)

		ReleasedInvoicesExist 
			restricted 
			when (PurchaseOrderReleasedInvoiceRel exists)	

		AnyAddOnChargesExistForVendor 
			restricted 
			when (PurchaseOrderAndLineAddOnChargesByVendorRel exists)

		BillToDetailsNotEntered
			restricted
			when (PurchaseOrderBillToName not entered
			and PurchaseOrderBillToAddress not entered
			and PurchaseOrderBillToContact not entered
			and PurchaseOrderBillToPhoneNumber not entered
			and PurchaseOrderBillToEmailAddress not entered)		

		HasDistributionAggregation
			restricted
			when (PODistributionAggregationRel exists)

		FromRequisitions
			restricted
			when (PurchaseOrderRequesterLineSourceRel exists)
		
		IDMProceedPOIssue
			restricted
			when (IssueMethod.EDI
			or    IssueMethod.Fax
			or    IssueMethod.XML
			or    IssueMethod.DoNotPrint)

		IsReleasedOrIssued
			restricted
			when (Released
			or    Issued)

		IssueMethodForRegeneration
			restricted
			when (IssueMethod.EDI
			or    IssueMethod.Fax
			or    IssueMethod.XML)			

	Relations
		ActorBuyerRel
			one-to-one relation to Buyer
			Field Mapping uses symbolic key
				related.HROrganization	= actor.agent(Employee).Employee.HROrganization
				related.Buyer			= actor.agent(Employee).Employee

		BuyerEmployeeRel
			one-to-one relation to Employee
			Field Mapping uses symbolic key
				related.HROrganization	= actor.context.HROrganization
				related.Employee		= Buyer

		PurchaseOrderLineCommentsRel is a PurchaseOrderLineComment set

		BuyerSupplierContactMessageRel
			one-to-many relation to SupplierContactMessage
			Field Mapping uses ByPurchaseOrder
				related.OriginatingCompany	= Company
				related.OriginatingPO		= PurchaseOrder

		PurchaseOrderLinesForCopyRel is a PurchaseOrderLine set
			Instance Selection
				where (related.LineCanBeCopied)

		NotCanceledPurchaseOrderLinesForCopyRel is a PurchaseOrderLine set
			Instance Selection
				where	(related.LineCanBeCopied)

		PurchaseOrderLinesToProcessRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsLineToProcess)

		PurchaseOrderLinesProcessedRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsLineProcessed)

		CancellablePurchaseOrderLinesRel is a PurchaseOrderLine set
			Instance Selection
				where (related.CanBeCancelled)

		TaxablePurchaseOrderLinesRel	is a PurchaseOrderLine set
			Instance Selection
				where (related.Taxable)

		LineSourcesRel
			one-to-many relation to PurchaseOrderLineSource
			Field Mapping uses Set1
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder

 		PurchaseOrderRequesterLineSourceRel
 			one-to-many relation to PurchaseOrderLineSource
 			Field Mapping uses BySourceDocument
				related.Company											= Company
				related.PurchaseOrder									= PurchaseOrder
				related.PurchaseOrderLineSource.SourceDocumentOrigin	= SourceDocumentOrigin.Requisitions

		PurchaseOrderLineSourceForSearchRequesterRel
			one-to-many relation to PurchaseOrderLineSource
			Field Mapping uses BySourceDocument
				related.Company											= Company
				related.PurchaseOrder									= PurchaseOrder
				related.PurchaseOrderLineSource.SourceDocumentOrigin	= SourceDocumentOrigin.Requisitions
			Instance Selection
				where (related.Requester = SearchRequester)

		PurchaseOrderLineSourceForSearchRequesterNameRel
			one-to-many relation to PurchaseOrderLineSource
			Field Mapping uses BySourceDocument
				related.Company											= Company
				related.PurchaseOrder									= PurchaseOrder
				related.PurchaseOrderLineSource.SourceDocumentOrigin	= SourceDocumentOrigin.Requisitions
			Instance Selection
				where (related.Requester.PresentationNameSnapshot like DerivedSearchRequesterName)

		PurchaseOrderLinesByContractRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses ByPurchaseOrderContract
				related.Company						= Company
				related.PurchaseOrder 				= PurchaseOrder
			Instance Selection
				where (related.Contract entered)

		PurchaseOrderLinesByContractUnreleasedRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses ByPurchaseOrderContract
				related.Company						= Company
				related.PurchaseOrder 				= PurchaseOrder
			Instance Selection
				where (related.Contract entered
				and    related.Released = false)	

		ReleasedPurchaseOrderLinesRel is a PurchaseOrderLine set
			Instance Selection
				where (related.PurchaseOrderLineEligibleToBeCancelled)

		UnreleasedPurchaseOrderLinesRel is a PurchaseOrderLine set
			Instance Selection
				where (related.PurchaseOrderLineLifeCycleState.Unreleased)

		InterfacedPurchaseOrderRel
			one-to-many relation to InterfacedPurchaseOrder
			Field Mapping uses ByPurchaseOrder
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
				related.POCode			= POCode

		PurchaseOrderLineCatchWeightRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.Item exists
				and    related.Item.IsCatchWeightItem)
		PurchaseOrderLineBinTrackedRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses Set9
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.ItemLocationRel exists
				and    related.ItemLocationRel.BinTracked)

		PurchaseOrderLinesWithActivityRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsLineProcessed)

		PrintOnPurchaseOrderCommentsRel is a PurchaseOrderComment set
			Instance Selection
				where	(related.CommentType.PrintOnPurchaseOrder)

		PrintOnPDFPOCommentsRel 
			one-to-many relation to PurchaseOrderComment
			Field Mapping uses ByCommentType
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where	(related.CommentType.PrintOnPurchaseOrder
				or		 related.CommentType.PrintOnPurchaseOrderTrailer)

		TrailerCommentsRel is a PurchaseOrderComment set
			Instance Selection
				where (related.CommentType.PrintOnPurchaseOrderTrailer)

		GeneralLedgerCalendarPeriodXrefRel
			one-to-one relation to GeneralLedgerCalendarPeriodXref		
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup			= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.GeneralLedgerCalendarPeriodXref	= PurchaseOrderDate

		MatchedPurchaseOrderLinesRel is a PurchaseOrderLine set
			Instance Selection
				where ((related.InventoriedSpecialOrNonstock
				and     related.MatchedQuantity > 0)
				or     (related.ItemType.Service
				and     related.MatchedAmount   > 0))

		PurchaseOrderLineSourceRel
			one-to-many relation to PurchaseOrderLineSource
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder

 		PurchaseOrderLineSourceForRequesterRel
 			one-to-many relation to PurchaseOrderLineSource
 			Field Mapping uses BySourceDocument
 				related.Company											= Company
 				related.PurchaseOrder									= PurchaseOrder
 				related.PurchaseOrderLineSource.SourceDocumentOrigin	= SourceDocumentOrigin.Requisitions
			Instance Selection
				where (related.Requester = actor.agent(Employee).Employee)

		PurchaseOrderLinesToUpdateRel is a PurchaseOrderLine set
			Instance Selection
				where (related.Vendor 				!= Vendor
				or     related.Buyer  				!= Buyer
				or     related.PurchaseFromLocation != PurchaseFromLocation)

		PurchaseOrderReceiptsToUpdateRel	
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder
			Instance Selection
				where (not related.OnlyHasServiceItem
				and    related.Vendor != Vendor)

		PurchaseOrderReceiptsWithDifferentVendorRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder
			Instance Selection
				where (related.Vendor != Vendor)

		NonServicePurchaseOrderLinesRel is a PurchaseOrderLine set
			Instance Selection
				where (related.InventoriedSpecialOrNonstock)

		PurchaseOrderLinesWithChargeApprovedQuantityRel is a PurchaseOrderLine set
			Instance Selection
				where (related.ChargeApprovedQuantity > 0)

		NonServicePurchaseOrderLinesWithReceivedQuantityRel is a PurchaseOrderLine set
			Instance Selection
				where (related.ReceivedQuantity > 0
				and    related.InventoriedSpecialOrNonstock)

		PurchaseOrderLinesWithQuantityToProcessRel is a PurchaseOrderLine set
			Instance Selection
				where (related.QuantityToProcess > 0)

		PurchaseOrderAndLineAddOnChargesByVendorRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set10
				related.Company						= Company
				related.Vendor						= Vendor
				related.PurchaseOrder				= PurchaseOrder

		PurchaseOrderAddOnChargesByVendorRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set10
				related.Company						= Company
				related.Vendor						= Vendor
				related.PurchaseOrder				= PurchaseOrder
				related.PurchaseOrderLine			= blank

		AddOnChargeForPrintingRel
			one-to-many relation to AddOnCharge
			Field Mapping uses symbolic key
				related.Company						= Company
			Instance Selection
				where (related.PurchaseOrderExistsAndForPrinting)

		PurchaseOrderLineCommentsForIDMRel
			one-to-many relation to PurchaseOrderLineComment
			Field Mapping uses ByCommentType
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where	(related.PurchaseOrderLine entered
				and		related.CommentType.PrintOnPurchaseOrder)
		
		IDMAdditionalAttributesLinesRel
			one-to-many relation to IDMAdditionalAttributesLines
			Field Mapping uses symbolic key
				related.IDMAdditionalAttributesHeader = "FSM_PurchaseOrder"
			Instance Selection
				where(related.IDMAdditionalAttributesHeader.ActivateAdditionalAttributes
				and	  related.ActivateAdditionalAttributes.Active)

		PurchaseOrderLineAddOnChargesRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set8
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where (related.PurchaseOrderLine entered)

		PurchaseOrderLineAddOnChargesSameVendorRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set10
				related.Company						= Company
				related.Vendor                      = Vendor
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where (related.PurchaseOrderLine entered)

		PurchaseOrderLineAddOnChargesSameVendorNoSpreadRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set10
				related.Company						= Company
				related.Vendor                      = Vendor
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where (related.PurchaseOrderLine entered
				and    !related.CreatedDuringSpread)

		TaxablePurchaseOrderLineAddOnChargesRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set8
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where (related.PurchaseOrderLine entered
				and	   related.Taxable)

		HeaderAddOnChargesForPrintingRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrder 				= PurchaseOrder
			Instance Selection
				where (not related.LineAddOnCharge
				and	   related.Vendor        = PurchaseOrder.Vendor
				and    related.PrintOnPO     = true)

		PurchaseOrderLinesForSpreadAddOnChargesRel
			one-to-many relation to PurchaseOrderSpreadAddOnCharge
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where (not related.PurchaseOrderAOCLineNotExists
				and	   related.Vendor				= PurchaseOrder.Vendor)
		
		PurchaseOrderSpreadAddOnChargesForVendorRel
			one-to-many relation to PurchaseOrderSpreadAddOnCharge
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where (related.Vendor				= PurchaseOrder.Vendor)

		PurchaseOrderSpreadAddOnChargesRel
			one-to-many relation to PurchaseOrderSpreadAddOnCharge
			delete cascades
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder

		InventoriedPurchaseOrderLinesRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsInventoryType)

		PurchaseOrderLinesWithCostRel is a PurchaseOrderLine set
			Instance Selection
				where (related.EnteredUnitCost 				> 0)

		PurchaseOrderLinesForSpreadRel is a PurchaseOrderLine set
			Instance Selection
				where (related.EnteredUnitCost entered
				and    not related.LineFullyCancelled
				and    not related.ExcludeFromAddOnChargeSpread)

		PurchaseOrderLinesWithEarlierDeliveryDateRel is a PurchaseOrderLine set
			Instance Selection
				where (related.EarlyDeliveryDate entered
				and related.EarlyDeliveryDate < PurchaseOrderDate)

		PurchaseOrderLinesWithInspectionRequiredRel is a PurchaseOrderLine set
			Instance Selection
				where (related.InspectionRequired)

		PurchaseOrderLinesWithContractRetainageRel is a PurchaseOrderLine set
			Instance Selection
				where (related.Retainage.RetainageOnContract)

		LinesWithContractRel is a PurchaseOrderLine set
			Instance Selection
				where (related.Contract entered)

		RetainageLinesRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsRetainageLine
				or     related.IsRetainageContract)

		PurchaseOrderLinesWithConsignCodeRel is a PurchaseOrderLine set
			Instance Selection
				where (related.CnCode entered)









		WarehouseDemandRel
			one-to-one relation to WarehouseDemand
			delete cascades
			Field Mapping uses symbolic key
				related.Company								= Company
				related.WarehouseDemand.DemandSystemCode	= "PO"
				related.WarehouseDemand.DemandDocument		= PurchaseOrder
				related.WarehouseDemand.DemandCompany		= Company

		PrintLinesRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsValidForPrinting)

		BudgetRebuildBTGTRel
			one-to-one relation to BudgetRebuildBTGT
			Field Mapping uses symbolic key
				related.BudgetRebuildBTGT.DocumentID = UniqueID

		AccountingUnitCommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.AccountingUnit = AccountingUnit)

		AccountingEntityCommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.ToAccountingEntity = AccountingEntity)

		AccountCommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.GeneralLedgerChartAccount = Account)

		ProjectCommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.Project = Project)

		Dimension1CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension1 = FinanceDimension1)

		Dimension2CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension2 = FinanceDimension2)

		Dimension3CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension3 = FinanceDimension3)

		Dimension4CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension4 = FinanceDimension4)

		Dimension5CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension5 = FinanceDimension5)

		Dimension6CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension6 = FinanceDimension6)

		Dimension7CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension7 = FinanceDimension7)

		Dimension8CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension8 = FinanceDimension8)

		Dimension9CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension9 = FinanceDimension9)

		Dimension10CommitmentRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where ((related.Status = 0
				or     related.Status = 3)
				and    related.FinanceCodeBlock.FinanceDimension10 = FinanceDimension10)

		GLCommitDocumentRel
			one-to-one relation to GLCommitDocument
			Field Mapping uses ByHeaderObjectReference
				related.HeaderObjectReference		= reference to this instance







		BudgetTemplateGroupTotalRel
			one-to-many relation to BudgetTemplateGroupTotal
			Field Mapping uses ByBudgetGroup
				related.FinanceEnterpriseGroup                    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.BudgetTemplateGroupTotal.BudgetEditGroup  = UniqueID

		PurchaseOrderReceiptLineAOCsRelSet3
			one-to-many relation to PurchaseOrderReceiptLineAOC
			Field Mapping uses Set3
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder

		ProcurementCardCompanyRel
			one-to-many relation to ProcurementCardCompany
			Field Mapping uses symbolic key
				related.ProcurementGroup			= Company.ProcurementGroup
				related.ProcurementCardProgram		= LocalProcurementCardProgram
				related.ProcurementCardRequest		= LocalProcurementCardRequest
				related.Company						= Company

		RequestingLocationRel
			one-to-one relation to RequestingLocation
			Field Mapping uses symbolic key
				related.Company                 = DefaultSourceInformation.DefaultOperatingCompany
				related.RequestingLocation 		= DefaultSourceInformation.DefaultRequestingLocation

		PayablesInvoiceHistoriesRel
			one-to-many relation to PayablesInvoiceHistory
			Field Mapping uses Set9
				related.Company = Company
				related.Vendor  = Vendor
			Instance Selection
				where (related.PurchaseOrder = PurchaseOrder)

		LocalContractRel
			one-to-one relation to Contract
			Field Mapping uses symbolic key
				related.ContractGroup	= PayablesCompanyRel.VendorGroup
				related.Contract        = LocalContract

		BlanketStandingContractRel
			one-to-one relation to Contract
			Field Mapping uses symbolic key
				related.ContractGroup 								= BlanketOrStandingContract.ContractGroup
				related.Contract									= BlanketOrStandingContract

		BlanketContractLinesRel
			one-to-many relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup 								= BlanketOrStandingContract.ContractGroup
				related.Contract									= BlanketOrStandingContract

		ContractParticipantLocationsRel
			one-to-many relation to ContractParticipant
			Field Mapping uses symbolic key
				related.ContractGroup 								= BlanketOrStandingContract.ContractGroup
				related.Contract									= BlanketOrStandingContract
			Instance Selection
				where (related.ContractParticipant.ParticipantLocation.Company  = Company
				and   (related.ContractParticipant.ParticipantLocation.Location not entered
				or 	   related.ContractParticipant.ParticipantLocation.Location = ShipToLocation))

		PayablesInvoiceAddOnChargesRel
			one-to-many relation to PayablesInvoiceAddOnCharge
			Field Mapping uses Set6
				related.Company = Company
				related.PurchaseOrder = PurchaseOrder

		MatchCompanyRel
			one-to-one relation to MatchCompany
			required
			Field Mapping uses symbolic key
				related.Company = Company

		PayablesCompanyRel
			one-to-one relation to PayablesCompany
			required
			Field Mapping uses symbolic key
				related.Company = Company

		PayablesDefaultProcessLevelRel
			one-to-many relation to PayablesProcessLevel
			Field Mapping uses symbolic key
				related.Company 		= Company
			Instance Selection
				where (related.DefaultProcessLevel)

		ProcessLevelRel
			one-to-one relation to PayablesProcessLevel
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PayablesProcessLevel	= LocalProcessLevel

		PayablesInvoiceDetailsRel
			one-to-many relation to PayablesInvoiceDetail
			Field Mapping uses ByPurchaseOrderLine
				related.Company = Company
				related.PurchaseOrder = PurchaseOrder

		PayablesInvoiceDetailsByInvoiceRel
			one-to-many relation to PayablesInvoiceDetail
			Field Mapping uses symbolic key
				related.Company = Company
				related.PayablesInvoice = PayablesInvoice

		LocalInvoiceDetailRel
			one-to-many relation to PayablesInvoiceDetail
			Field Mapping uses symbolic key
				related.Company				= LocalCompany
				related.PayablesInvoice		= LocalPayablesInvoice
				related.PurchaseOrder		= PurchaseOrder
				related.PurchaseOrderLine	= LocalPurchaseOrderLine

		PayablesInvoiceAddOnChargeHistoriesRel
			one-to-many relation to PayablesInvoiceAddOnChargeHistory
			Field Mapping uses Set2
				related.Company = Company
			Instance Selection
				where (related.PurchaseOrder = PurchaseOrder)

		PayablesInvoiceDetailHistoriesRel
			one-to-many relation to PayablesInvoiceDetailHistory
			Field Mapping uses Set2
				related.Company = Company
			Instance Selection
				where (related.PurchaseOrder = PurchaseOrder)

		UnmatchedMatchPurchaseOrderInvoicesRel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.PayablesInvoiceNotMatched)

		UnreleasedMatchPurchaseOrderInvoicesRel
			one-to-many relation to MatchPurchaseOrderInvoice
			delete restricted
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PurchaseOrder        	= PurchaseOrder
		  	Instance Selection
		  		where (related.PayablesInvoice.Status.Unreleased)

		MatchedPurchaseOrderInvoicesRel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (!related.PayablesInvoice.Status.Unreleased)

		PurchaseOrderReleasedInvoiceRel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses symbolic key 
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection 
				where (related.PayablesInvoice.MatchStatus > 1
				and    related.PayablesInvoice.MatchStatus < 7)	

		PayablesInvoiceDetailReleasedInvoiceRel
			one-to-many relation to PayablesInvoiceDetail
			Field Mapping uses ByPurchaseOrderLine
				related.Company 		= Company
				related.PurchaseOrder 	= PurchaseOrder
			Instance Selection 
				where (related.PayablesInvoice.MatchStatus > 1
				and    related.PayablesInvoice.MatchStatus < 7)	

		PurchaseOrderLineDistributionsRel is a PurchaseOrderLineDistribution set	

		PurchaseOrderLineLineDistributionsRel is a PurchaseOrderLineDistribution set
			Instance Selection
				where (related.PurchaseOrderLine entered)

		PurchaseOrderLineDistributionsCommittedRel
			one-to-many relation to PurchaseOrderLineDistribution
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.CommitmentExists
				and    !related.HistoryCommitmentExists)

		PurchaseOrderAddOnChargesRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company				= Company
				related.PurchaseOrder		= PurchaseOrder
				related.PurchaseOrderLine	= blank
		
		TaxablePurchaseOrderAddOnChargesRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company				= Company
				related.PurchaseOrder		= PurchaseOrder
				related.PurchaseOrderLine	= blank
			Instance Selection
				where (related.Taxable)

		PurchaseOrderAuditsRel
			one-to-many relation to PurchaseOrderAudit
			Field Mapping uses Set2
				related.Company = Company
			Instance Selection
				where (related.PurchaseOrder		= PurchaseOrder
				and   related.PurchaseOrderRevision	= PurchaseOrderRevision)

		PurchaseOrderLinesRel is a PurchaseOrderLine set	

		PurchaseOrderLinesReceivedNotInvoicedRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.Closed.No
				and    related.ReceivedNotInvoicedQuantityExists)

		PurchaseOrderLinesClosedRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.Closed.Yes)

		LinesWithUnreceivedQuantityRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (not related.IsFullyReceived)

		PurchaseOrderLinesInErrorRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.LineErrorsExist)

		PurchaseOrderLineErrorsRel
			one-to-many relation to PurchaseOrderLineError
			Field Mapping uses symbolic key
				related.Company					= Company
				related.PurchaseOrder        	= PurchaseOrder
			Instance Selection
				where (related.PurchaseOrderLine not entered)

		PurchaseOrderLinesNotReceivedInFullRel is a PurchaseOrderLine set
			Instance Selection
				where (!related.IsFullyReceived
				and    !related.ItemType.Service)

		PurchaseOrderLinesAvailableToMatchRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PurchaseOrder        	= PurchaseOrder
			Instance Selection
				where (related.AllowMatchCreateDetail)

		NonServiceLinesRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PurchaseOrder        	= PurchaseOrder
			Instance Selection
				where (!related.ItemType.Service)

		SpecialContractLineOnLineRel 
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PurchaseOrder        	= PurchaseOrder
			Instance Selection
				where (related.ContractLine entered
				and    related.ItemType.Special)		

		ItemMasterOnLineRel 
			one-to-many relation to PurchaseOrderLine 
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PurchaseOrder        	= PurchaseOrder
			Instance Selection
				where (related.ItemType.Inventoried
				or     related.ItemType.NonStock) 				

		ServiceLinesRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PurchaseOrder        	= PurchaseOrder
			Instance Selection
				where (related.ItemType.Service)

		LinesForAContractLineRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PurchaseOrder        	= PurchaseOrder
			Instance Selection
				where (related.ContractLine entered)

		LaterPOLineForAContractRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company 				= Company
				related.PurchaseOrder        	= PurchaseOrder
			Instance Selection
				where (related.Contract = LocalContract
				and    related.PurchaseOrderLine > LocalPurchaseOrderLine)

		ReceivingAdjustmentRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses ByPurchaseOrder
				related.Company                 					= Company
			Instance Selection
				where (related.IsAdjustmentDocument
				and    related.PurchaseOrderReceipt.PurchaseOrder = PurchaseOrder)

		ReleasedReceivingAdjustmentRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses ByPurchaseOrder
				related.Company                 					= Company
			Instance Selection
				where (related.IsAdjustmentDocument
				and    related.PurchaseOrderReceipt.PurchaseOrder = PurchaseOrder
				and    related.IsReleasedAdjustment)

		ReceivingInspectionRel
			one-to-many relation to POReceiptAdjustmentAndInspection
			Field Mapping uses ByPurchaseOrder
				related.Company                 = Company
			Instance Selection
				where (related.IsInspectionDocument
				and    related.PurchaseOrderReceipt.PurchaseOrder = PurchaseOrder)

		PurchaseOrderReceiptsRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder
			Instance Selection
				where (not related.OnlyHasServiceItem)

		UnreleasedPurchaseOrderReceiptsRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder
			Instance Selection
				where (related.Status.Unreleased
				or     related.Status.CreateInProgress
				or     related.Status.ReleaseInProgress)

		ReleasedPurchaseOrderReceiptsRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder
			Instance Selection
				where (related.Status.Released)

		AllPurchaseOrderReceiptsRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder

		PurchaseOrderReceiptLinesRel
			one-to-many relation to PurchaseOrderReceiptLine
			Field Mapping uses Set4
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder

		PurchaseOrderRevisionsRel
			one-to-many relation to PurchaseOrderRevision
			delete cascades
			Field Mapping uses symbolic key
				related.Company 		= Company
				related.PurchaseOrder 	= PurchaseOrder

		PurchaseOrderRevisionsDescendingRel
			one-to-many relation to PurchaseOrderRevision
			delete cascades
			Field Mapping uses ByDescending
				related.Company 		= Company
				related.PurchaseOrder 	= PurchaseOrder
		
		NonEDIPurchaseOrderRevisionsRel
			one-to-many relation to PurchaseOrderRevision
			delete cascades
			Field Mapping uses ByDescending
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (not related.IssueMethod.EDI)

		AcknowledgedPurchaseOrderRevisionRel
			one-to-many relation to PurchaseOrderRevision
			delete cascades
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.AcknowledgementType entered)
				
		PurchasingVendorRel
			one-to-one relation to PurchasingVendor
			Field Mapping uses symbolic key
				related.VendorGroup = PayablesCompanyRel.VendorGroup
				related.Vendor 		= Vendor

		OldPurchasingVendorRel
			one-to-one relation to PurchasingVendor
			Field Mapping uses symbolic key
				related.VendorGroup = PayablesCompanyRel.VendorGroup
				related.Vendor		= DerivedVendor

		PurchaseOrderAndLineAddOnChargeRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set9
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder

		ProcurementTemplateLinesRel
			one-to-many relation to ProcurementTemplateLine
			Field Mapping uses symbolic key
				related.ProcurementGroup    	= Company.ProcurementGroup
				related.ProcurementTemplate	    = ProcurementTemplate		

		PrintablePOLineAddOnChargeForVendorRel	
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set9
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.PrintOnPO = true
				and	   related.Vendor	 = Vendor)

		PrintablePOLineAddOnChargeForOtherVendorRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set9
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.PrintOnPO = true
				and	   related.Vendor	!= Vendor)

		PurchaseOrderInterfacesRel
			one-to-many relation to PurchaseOrderInterface
			Field Mapping uses symbolic key

	  	VendorCompanyDefaultRel
	  		one-to-one relation to VendorCompanyDefault
			Field Mapping uses symbolic key
				related.VendorGroup		= PayablesCompanyRel.VendorGroup
				related.Vendor			= Vendor
				related.VendorLocation	= blank
				related.Company			= Company

		MatchPurchaseOrderInvoicesByPORel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses ByPurchaseOrder
				related.Company					= Company
				related.PurchaseOrder			= PurchaseOrder
				related.Vendor					= Vendor
			Instance Selection
				where (related.PayablesInvoice	= PayablesInvoice)

		AnyMatchPurchaseOrderInvoicesByPORel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses ByPurchaseOrder
				related.Company					= Company
				related.PurchaseOrder			= PurchaseOrder
				related.Vendor					= Vendor

		AnyMatchPurchaseOrderInvoicesWithChargebackByPORel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses ByPurchaseOrder
				related.Company					= Company
				related.PurchaseOrder			= PurchaseOrder
				related.Vendor					= Vendor
			Instance Selection
				where (related.HasChargeback
				and    not related.PayablesInvoice.MatchStatus.POCancel)

		AnySCMatchPurchaseOrderInvoicesByPORel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses ByPurchaseOrder
				related.Company					= Company
				related.PurchaseOrder			= PurchaseOrder
				related.Vendor					= Vendor
			Instance Selection
				where (related.PayablesInvoice.CreatedBySupplier)

		StandardCommentCodeRel
			one-to-many relation to StandardCommentCode
			Field Mapping uses Set1
				related.ProcurementGroup    = Company.ProcurementGroup
				related.StandardCommentCode = StandardCommentCode
			Instance Selection
				where (related.IsoLocale not entered)

		PurchaseOrderLineSourceByRequisitionRel
			one-to-many relation to PurchaseOrderLineSource
			Field Mapping uses BySourceDocument
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder

		ReceivingBuyerMessagesRel
			one-to-many relation to PurchaseOrderBuyerMessage
			Field Mapping uses ByPurchaseOrder
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (not related.PurchaseOrderReceipt.IsCreateInProgress)

		NonServiceTypePurchaseOrderLinesRel is a PurchaseOrderLine set
			Instance Selection
				where (related.IsNonService)

		PurchaseOrderLinesWithRetainageOverrideRel is a PurchaseOrderLine set
			Instance Selection
				where (related.RetainageOverridePercentComplete entered)

		ProcurementCardRequestRel
			one-to-many relation to ProcurementCardRequest
			Field Mapping uses Set2
				related.ProcurementCardNumber = ProcurementCardNumber

		PurchaseOrderAddOnChargeForCancelRel
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses Set9
				related.Company		= Company
				related.PurchaseOrder	= PurchaseOrder

		PurchaseFromLocationRel										
			one-to-one relation to PurchaseFromLocation
			Field Mapping uses symbolic key
				related.VendorGroup				= Vendor.VendorGroup
				related.Vendor					= Vendor
				related.PurchaseFromLocation	= PurchaseFromLocation

		OldPurchaseFromLocationRel
			one-to-one relation to PurchaseFromLocation
			Field Mapping uses symbolic key
				related.VendorGroup				= Vendor.VendorGroup
				related.Vendor					= DerivedVendor
				related.PurchaseFromLocation	= DerivedPurchaseFromLocation

		LatestPODocumentRel is a PurchaseOrderComment set
			Instance Selection
				where (related.IsLatestDocument)

		PurchaseOrderCommentDisplayOnPortalRel is a PurchaseOrderComment set
			Instance Selection
				where (related.SupplierCanView)







		GeneralLedgerSystemCodeRel
			one-to-many relation to GeneralLedgerSystemCode
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.GeneralLedgerSystemCode	= "PO"

		RQGeneralLedgerSystemCodeRel
			one-to-many relation to GeneralLedgerSystemCode
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.GeneralLedgerSystemCode	= "RQ"

		CompanySystemClosingControlRel
			one-to-one relation to CompanySystemClosingControl
			Field Mapping uses BySystemCode
				related.GeneralLedgerSystemCode		= "PO"
				related.Company						= Company
				
		LocalGLCompanyGroupMemberRel													
			one-to-one relation to GeneralLedgerCompanyGroupMember
			Field Mapping uses symbolic key
				related.GeneralLedgerCompanyGroup	= LocalGeneralLedgerCompanyGroup
				related.Company						= Company				

		HeaderBudgetEditErrorRel
			one-to-many relation to BudgetEditError
			Field Mapping uses ByBudgetGroup
				related.FinanceEnterpriseGroup              = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.BudgetEditError.BudgetEditGroup     = UniqueID

		DistributionBudgetEditErrorRel
			one-to-many relation to BudgetEditError
			Field Mapping uses ByHeaderUniqueID
				related.FinanceEnterpriseGroup              = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID                      = UniqueID

		BudgetEditBatchRel
			one-to-many relation to BudgetEditBatch
			Field Mapping uses ByDocumentID
				related.DocumentID                          = UniqueID

		GLCommitDrillRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID            = UniqueID

		OpenGLCommitDrillRel
			one-to-many relation to GLCommit
			Field Mapping uses BySystemAndHeaderUniqueID
				related.FinanceEnterpriseGroup    = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.HeaderUniqueID 			  = UniqueID
			Instance Selection
				where (related.Status != 1)

		RequisitionAddOnChargesRel
			one-to-many relation to RequisitionLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company       		= Company
				related.Requisition			= LocalRequisition
				related.RequisitionLine		= blank

		AddOnChargeRel
			one-to-many relation to AddOnCharge
			Field Mapping uses symbolic key
				related.Company       = Company
			Instance Selection
				where (related.PurchaseOrderExists)

		TaxEntityRel
			one-to-one relation to TaxEntity
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.TaxEntity 				= Company.AccountingEntity

		CompanyTaxCodeRel
			one-to-one relation to EntityTaxCode
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
				related.TaxEntity				= Company.AccountingEntity
				related.TaxCode					= TaxCode

		ProcurementTemplateParticipantsByBuyerRel
			one-to-many relation to ProcurementTemplateParticipant
			Field Mapping uses Set3
				related.ProcurementGroup	= ProcurementTemplate.ProcurementGroup
				related.Buyer				= Buyer
				related.ProcurementTemplate	= ProcurementTemplate

		ProcurementTemplateParticipantsByCompanyRel
			one-to-many relation to ProcurementTemplateParticipant
			Field Mapping uses Set4
				related.ProcurementGroup	= ProcurementTemplate.ProcurementGroup
				related.Company				= Company
				related.ProcurementTemplate	= ProcurementTemplate

		ProcurementTemplateParticipantsByBuyerGroupRel
			one-to-many relation to ProcurementTemplateParticipant
			Field Mapping uses Set2
				related.ProcurementGroup	= ProcurementTemplate.ProcurementGroup
				related.BuyerGroup			= Buyer.BuyerGroup
				related.ProcurementTemplate	= ProcurementTemplate

		PurchaseOrdersByDiversityRel					
			one-to-many relation to PurchaseOrder
			Field Mapping uses symbolic key
				related.Company = Company
			Instance Selection
				where (related.Vendor.DiversityCode = Vendor.DiversityCode
				and related.UniqueID < UniqueID)

		PurchaseOrdersWithSameDiversityRel				
			one-to-many relation to PurchaseOrder
			Field Mapping uses symbolic key
				related.Company = Company
			Instance Selection
				where (related.Vendor.DiversityCode = Vendor.DiversityCode)

		VendorGroupRel
			one-to-one relation to VendorGroup
			Field Mapping uses symbolic key
				related.VendorGroup = PayablesCompanyRel.VendorGroup

		SupplierGroupRel
			one-to-one relation to SupplierGroup
			Field Mapping uses symbolic key
				related.SupplierGroup = PayablesCompanyRel.VendorGroup

		PurchaseFromSupplierSourceIdRel   
			one-to-one relation to SupplierSourceId
			Field Mapping uses symbolic key
				related.SupplierGroup    = SupplierGroupRel.SupplierGroup
				related.Supplier         = SupplierRel.Supplier
				related.SupplierSourceId = DerivedSupplierSourceId  			

		SupplierSourceIdValidRel
			one-to-one relation to SupplierSourceId
			Field Mapping uses symbolic key
				related.SupplierGroup    = SupplierGroupRel.SupplierGroup
				related.Supplier         = LocalSupplier
				related.SupplierSourceId = LocalSupplierContact 			

		SupplierRel
			one-to-many relation to Supplier
			Field Mapping uses ByVendor
				related.SupplierGroup				= SupplierGroupRel.SupplierGroup
 				related.Vendor						= Vendor

		VendorDiversityRel
			one-to-many relation to VendorDiversity
			Field Mapping uses symbolic key
				related.VendorGroup    = PayablesCompanyRel.VendorGroup
				related.Vendor 		   = Vendor
				related.VendorLocation = blank
			Instance Selection
				where (((related.DiversityEffectiveDate  <= PurchaseOrderDate
				and    related.DiversityExpirationDate >= PurchaseOrderDate)
				or     DiversityNoWithinDates = true)
				and    related.CanUseForDocument = true)
		
		ActiveVendorDiversityRel
			one-to-many relation to VendorDiversity
			Field Mapping uses symbolic key
				related.VendorGroup    = PayablesCompanyRel.VendorGroup
				related.Vendor 		   = Vendor
				related.VendorLocation = blank
			Instance Selection
				where (related.IsActive
				and  ((related.DiversityEffectiveDate  <= PurchaseOrderDate
				and    related.DiversityExpirationDate >= PurchaseOrderDate)
				or     DiversityNoWithinDates)
				and    related.CanUseForDocument)

		VendorLocationDiversityRel
			one-to-many relation to VendorDiversity
			Field Mapping uses ByDateDescending
				related.VendorGroup    = PayablesCompanyRel.VendorGroup
				related.Vendor 		   = Vendor
				related.VendorLocation = PurchaseFromLocation
			Instance Selection
				where (((related.DiversityEffectiveDate  <= PurchaseOrderDate
				and    related.DiversityExpirationDate >= PurchaseOrderDate)
				or     DiversityNoWithinDates = true)
				and    related.CanUseForDocument = true
				and    PurchaseFromLocation entered)
		
		ActiveVendorLocationDiversityRel
			one-to-many relation to VendorDiversity
			Field Mapping uses ByDateDescending
				related.VendorGroup    = PayablesCompanyRel.VendorGroup
				related.Vendor 		   = Vendor
				related.VendorLocation = PurchaseFromLocation
			Instance Selection
				where (related.IsActive
				and	 ((related.DiversityEffectiveDate  <= PurchaseOrderDate
				and    related.DiversityExpirationDate >= PurchaseOrderDate)
				or     DiversityNoWithinDates)
				and    related.CanUseForDocument
				and    PurchaseFromLocation entered)

		PurchaseOrderDiversityRel
			one-to-one relation to PurchaseOrderDiversity
			Field Mapping uses symbolic key
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder
				related.PayablesDiversityCode   = LocalDiversityCode

		PurchaseOrderDiversityListRel
			one-to-many relation to PurchaseOrderDiversity
			Field Mapping uses symbolic key
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder

		AllPurchaseOrdersRel				
			one-to-many relation to PurchaseOrder
			Field Mapping uses symbolic key
				related.Company = Company

		PfiWorkunitRel
			one-to-many relation to PfiWorkunit
			Field Mapping uses ByAppsKeyAppsValueWorkunit
				related.AppsKey		= "PURCHASEORDER"			
				related.AppsValue	= DerivedAppsValue

		FaxDetailRel
			one-to-one relation to FaxDetail
			Field Mapping uses ByFaxPORev
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
				related.PurchaseOrderRevision		= PurchaseOrderRevision

		AllSuccesfulFaxesForPORel
			one-to-many relation to FaxDetail
			Field Mapping uses ByFaxPORev
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where (related.Classification 		= "\"Success\"")

		AllPendingFaxesForPORel
			one-to-many relation to FaxDetail
			Field Mapping uses ByFaxPORev
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where	(related.ErrorMessage 			not 	entered
				and		 related.Classification 		not 	entered
				and      								not FaxDetailRel.StaleTransmission)

		AllUnsuccessfulFaxesForPORel
			one-to-many relation to FaxDetail
			Field Mapping uses ByFaxPORev
				related.Company						= Company
				related.PurchaseOrder				= PurchaseOrder
			Instance Selection
				where	(related.StaleTransmission
				or       related.Busy
				or       related.CallPlacementError
				or       related.NoAnswer
				or       related.NoDialTone
				or       related.Busy
				or       related.SystemError
				or       related.FaxTransmissionFailed
				or       related.UserDefined
				or       related.RemoteHangUp
				or       related.UnspecifiedFailure
				or       related.HasErrorMessage)

		PurchaseOrderAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PurchaseOrder"

		PurchaseOrderLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PurchaseOrderLine"

		PurchaseOrderLineDistributionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PurchaseOrderLineDistribution"

		VendorReturnAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "VendorReturn"

		VendorReturnLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "VendorReturnLine"

		MatchInvoiceMessageAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "MatchInvoiceMessage"

		RequisitionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "Requisition"

		RequisitionLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "RequisitionLine"

		RequisitionLineDistributionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "RequisitionLineDistribution"

		InventoryTransactionLineAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "InventoryTransactionLine"

		InventoryUsageHistoryAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "InventoryUsageHistory"

		ItemLocationAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "ItemLocation"

		PayablesInvoiceDistributionAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PayablesInvoiceDistribution"

		PayablesInvoicePaymentAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PayablesInvoicePayment"

		PayablesInvoiceAnalyticCubeRel
			one-to-one relation to AnalyticCube
			Field Mapping uses AnalyticCubeSet
				related.BusinessClass = "PayablesInvoice"

		BasicAnalyticsCalendarsRel 		is a BasicAnalyticsCalendar set

		PatientProcedureRel
			one-to-one relation to PatientProcedure
			Field Mapping uses symbolic key
				related.Company             = Company
				related.PatientProcedure	= LocalPatientProcedure

		PurchaseOrderEDIAcknowledgementRel
			one-to-many relation to PurchaseOrderEDIAcknowledgement
			Field Mapping uses ByCompanyPurchaseOrderAcknowledgement
				related.Company 						= Company
				related.PurchaseOrder 					= PurchaseOrder
				
		PurchaseOrderEDIManualAcknowledgementRel
			one-to-many relation to PurchaseOrderEDIAcknowledgement
			Field Mapping uses ByRunGroup
				related.RunGroup		= PurchaseOrder
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
				
		PurchaseOrderEDIManualAcceptedRel
			one-to-many relation to PurchaseOrderEDIAcknowledgement
			Field Mapping uses ByRunGroup
				related.RunGroup		= PurchaseOrder
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.AcknowledgementType = "MT")
		
		PurchaseOrderEDIManualAcknowledgeWithChangeRel
			one-to-many relation to PurchaseOrderEDIAcknowledgement
			Field Mapping uses ByRunGroup
				related.RunGroup		= PurchaseOrder
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.AcknowledgementType = "MC")

		PurchaseOrderEDIOutputRel
			one-to-many relation to PurchaseOrderEDIOutput
			Field Mapping uses symbolic key
				related.Company 						= Company
			Instance Selection
				where  (related.PurchaseOrder 			= PurchaseOrder
				and    	related.RecordType				= "H"
				and 	related.PurchaseOrderRevision	= PurchaseOrderRevision)

		FaxConfigurationInUseRel
			one-to-many relation to FaxConfiguration
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup		= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
			Instance Selection
				where (related.Default)

		InventoryLocationForReceivingDocumentIDMRel
			one-to-many relation to InventoryLocation
			Field Mapping uses symbolic key
				related.Company 			= Company
				related.InventoryLocation 	= PurchaseOrderLineForReceivingDocumentIDMRel.ShipToLocation

		PurchaseOrderLineForReceivingDocumentIDMRel is a PurchaseOrderLine set
			Instance Selection
				where (not related.PrintedOnReceivingDocument
				and    not related.ItemType.Service
				and    related.PurchaseOrderLineLifeCycleState.Released
				and    not related.IsDropship
				and	   related.DerivedOpenQty > 0
				and   (Company.LocalFrEarlyDlDate not entered or related.EarlyDeliveryDate >= Company.LocalFrEarlyDlDate)
				and   (Company.LocalToEarlyDlDate not entered or related.EarlyDeliveryDate <= Company.LocalToEarlyDlDate)
				and   (Company.LocalShipToLocation not entered or related.ShipToLocation = Company.LocalShipToLocation))

		VendorCompanyDefaultsRel
			one-to-one relation to VendorCompanyDefault
			Field Mapping uses symbolic key
				related.VendorGroup 	= Vendor.VendorGroup
				related.Vendor 			= Vendor
				related.VendorLocation 	= blank
				related.Company 		= Company

		PurchaseFromCompanyDefaultsRel
			one-to-one relation to VendorCompanyDefault
			Field Mapping uses symbolic key
				related.VendorGroup 	= Vendor.VendorGroup
				related.Vendor 			= Vendor
				related.VendorLocation 	= PurchaseFromLocation
				related.Company 		= Company

		CompanyVendorAccountRel
			one-to-one relation to PurchasingVendorAccount
			Field Mapping uses symbolic key
				related.VendorGroup			= PayablesCompanyRel.VendorGroup
				related.Vendor				= Vendor
				related.VendorLocation		= blank
				related.Company				= Company
				related.InventoryLocation	= blank

		LocationVendorAccountRel
			one-to-one relation to PurchasingVendorAccount
			Field Mapping uses symbolic key
				related.VendorGroup			= PayablesCompanyRel.VendorGroup
				related.Vendor				= Vendor
				related.VendorLocation		= blank
				related.Company				= Company
				related.InventoryLocation	= ShipToLocation

		CompanyVendorLocationAccountRel
			one-to-one relation to PurchasingVendorAccount
			Field Mapping uses symbolic key
				related.VendorGroup			= PayablesCompanyRel.VendorGroup
				related.Vendor				= Vendor
				related.VendorLocation		= PurchaseFromLocation
				related.Company				= Company
				related.InventoryLocation	= blank

		LocationVendorLocationAccountRel
			one-to-one relation to PurchasingVendorAccount
			Field Mapping uses symbolic key
				related.VendorGroup			= PayablesCompanyRel.VendorGroup
				related.Vendor				= Vendor
				related.VendorLocation		= PurchaseFromLocation
				related.Company				= Company
				related.InventoryLocation	= ShipToLocation

		IDMPrinterRel
			one-to-many relation to IDMPrinter
			Field Mapping uses symbolic key

		UserDefaultPrinterRel
			one-to-one relation to UserDefaultPrinter
			Field Mapping uses symbolic key
				related.UserDefaultPrinter.Actor = actor


		FSMBODConfigurationParameterRel
        	one-to-one relation to FSMBODConfigurationParameter
			Field Mapping uses symbolic key
            	related.FSMBODConfigurationParameter 		= LocalConfigurationParameter

		PurchaseOrderLineRel
 			one-to-many relation to PurchaseOrderLine
 			Field Mapping uses symbolic key
 				related.Company			= Company
 				related.PurchaseOrder	= PurchaseOrder

 		FSMBODConfigurationRel
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 1
				related.FSMBODConfiguration.Noun 		= "PurchaseOrder"
				related.FSMBODConfiguration.Direction 	= 1


		FSMInboundBODTrackerRel
			one-to-one relation to FSMInboundBODTracker
			Field Mapping uses symbolic key
				related.FSMInboundBODTracker				= LocalFSMInboundBODTracker



		FSMBODConfigurationRelProcessPO
			one-to-one relation to FSMBODConfiguration
			Field Mapping uses symbolic key
				related.FSMBODConfiguration.Verb 		= 2
				related.FSMBODConfiguration.Noun 		= "PurchaseOrder"
				related.FSMBODConfiguration.Direction 	= 1


		VendorAddressRel
			one-to-one relation to VendorAddress
			Field Mapping uses symbolic key
				related.VendorGroup					 	= Vendor.VendorGroup
				related.Vendor						  	= Vendor
				related.VendorLocation				 	= PurchaseFromLocation
				related.VendorContact.VendorContactCode = "PRIME"
				related.VendorContact.ContactLevel	  	= blank
		
		PrintOnPOContractCommentRel
			one-to-many relation to ContractComment
			Field Mapping uses Contract part of key
				related.ContractGroup						= Company.ProcurementGroup
				related.Contract							= BlanketOrStandingContract
			Instance Selection
				where (related.CommentUsedFor				= "2" 
				or     related.CommentUsedFor               = "3") 

		SendToVendorPOCommentAttachmentsRel is a PurchaseOrderComment set
			Instance Selection
				where ((related.CommentType.PrintOnPurchaseOrder
				or      related.CommentType.PrintOnPurchaseOrderTrailer)
				and     related.SendToVendor
				and     related.HasAttachment
				and   ((RevisionsInclude.NotRevised
				or      RevisionsInclude.Reissue
				or      RevisionsInclude.RevisionsComplete)
				or     (RevisionsInclude.RevisionsOnly and not related.AttachmentSent)))

		VendorReturnLinesRel
			one-to-many relation to VendorReturnLine
			Field Mapping uses Set3
				related.Company					= Company
				related.OriginalPurchaseOrder	= PurchaseOrder

		PurchaseOrderHeaderCommentRel
			one-to-many relation to PurchaseOrderComment
			Field Mapping uses part of key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder


		PurgeProcurementTransactionDistributionRel
			one-to-many relation to ProcurementTransactionDistribution
			Field Mapping uses Set4
				related.Company	= Company
			Instance Selection
				include deleted records
				where (related.ProcurementDocumentNumber	= DerivedPurchaseOrder
				and   related.DocumentNumberNumeric			= PORelease
				and   related.POCode						= POCode
				and   related.SystemCode					= "PO"
				and   related.DocumentType					= "PT")

		PurgePurchaseOrderAddOnChargesRel is a PurchaseOrderAndLineAddOnCharge set
			Instance Selection
				include deleted records

		PurgePurchaseOrderLineRel is a PurchaseOrderLine set
			Instance Selection
				include deleted records

		PurgePurchaseOrderCommentRel
			one-to-many relation to PurchaseOrderComment
			Field Mapping uses part of key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				include deleted records

		PurchaseOrderIncotermRel
			one-to-many relation to PurchaseOrderComment
			Field Mapping uses part of key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.CommentType = "M")

		PurgePurchaseOrderSpreadAddOnChargeRel is a PurchaseOrderSpreadAddOnCharge set
			Instance Selection
				include deleted records

		PurgePurchaseOrderRevisionsRel is a PurchaseOrderRevision set
			Instance Selection
				include deleted records

		OpenAddOnChargesRel 
			one-to-many relation to PurchaseOrderAndLineAddOnCharge
			Field Mapping uses symbolic key
				related.Company			= Company
				related.PurchaseOrder	= PurchaseOrder
			Instance Selection
				where (related.Open)

		PurchasingCompanyRel  
			one-to-one relation to PurchasingCompany
			Field Mapping uses symbolic key
				related.Company = Company

		IDMConfigurationRel
			one-to-one relation to IDMConfiguration
			Field Mapping uses symbolic key
				related.IDMConfiguration = actor.context.FinanceEnterpriseGroup

		SupplierContactMessageRel
			one-to-many relation to SupplierContactMessage
			Field Mapping uses symbolic key
				related.SupplierGroup				= actor.agent(SupplierSourceId).SupplierGroup
 				related.Supplier  			 		= actor.agent(SupplierSourceId).Supplier
				related.SupplierSourceId            = actor.agent(SupplierSourceId).SupplierSourceId
			Instance Selection
				where (related.OriginatingCompany			= Company
				and    related.OriginatingPO                = PurchaseOrder)

		SupplierMessageDialogRel
			one-to-many relation to SupplierMessageDialog

			Field Mapping uses symbolic key
				related.SupplierGroup								= Company.ProcurementGroup
			Instance Selection
				where (related.SupplierContactMessage.OriginatingCompany	= Company
				and    related.SupplierContactMessage.OriginatingPO			= PurchaseOrder)



		InvoicesForAPurchaseOrderRel
			one-to-many relation to MatchPurchaseOrderInvoice
			Field Mapping uses ByPurchaseOrder
				related.Company			= Company
				related.PurchaseOrder 	= PurchaseOrder
				related.Vendor			= Vendor


		FSMBODCrossReferenceDetailRel
			one-to-many relation to FSMBODCrossReferenceDetail
			Field Mapping uses symbolic key
				related.FSMBODCrossReference.SourceField 		= "CSFGLC"
				related.FSMBODCrossReference.DestinationField 	= "DESTAE"
			Instance Selection
				where (related.SourceValue	= DerivedCrossReferenceAccountingEntity)
				
		ActivePurchaseOrderDocumentsRel
			one-to-many relation to PurchaseOrderDocument
			Field Mapping uses symbolic key
			Instance Selection
				where ((related.Company							= Company
				or	  (related.VendorGroup						= Vendor.VendorGroup
				and    related.Vendor							= Vendor))
				and	   related.Active)
		
		GeneralLedgerCompanyRel
			one-to-one relation to GeneralLedgerCompany
			Field Mapping uses symbolic key
				related.Company		= Company
				

		PurchaseOrderLinesWithSpecialHandlingRel is a PurchaseOrderLine set
			Instance Selection
				where (related.SpecialHandlingCode entered)
		
		PurchasingMassPOIssueErrorReportRel
            one-to-many relation to PurchaseOrderResult
            Field Mapping uses symbolic key
                related.FinanceEnterpriseGroup      = LocalReportFinanceEnterpriseGroup
				related.PurchaseOrderResult			= LocalPurchaseOrderResult
            Instance Selection
                where (related.ReportType.MassPOIssueResult)

		DropShipPurchaseOrderReceiptsRel
			one-to-many relation to PurchaseOrderReceipt
			Field Mapping uses Set3
				related.Company                 = Company
				related.PurchaseOrder           = PurchaseOrder
			Instance Selection
				where (related.Status.DropShip)

		PODistributionAggregationRel is a PODistributionAggregation set

		AlternateShipToLocationRel
			one-to-one relation to InventoryLocation
			Field Mapping uses symbolic key
				related.Company 		  = Company
				related.InventoryLocation = AlternateShipToLocation

		PurchaseOrderLinesForReprintRel
			one-to-many relation to PurchaseOrderLine
			Field Mapping uses symbolic key
				related.Company						= Company
				related.PurchaseOrder 				= PurchaseOrder
			Instance Selection
				where (related.IDMReprintStatus.ForReprint)						

	Sets
		Set10
			indexed
			Instance Selection
				where (IsSubcontractorPurchaseOrder)
			Sort Order
				Company
				Vendor
				PurchaseFromLocation
				PurchaseOrder

		Set11
			indexed
			Instance Selection
				where (IsMatchable)
			Sort Order
				Company
				Vendor
				PurchaseOrder

		Set2
			indexed
			Sort Order
				Company
				Vendor
				PurchaseFromLocation
				PurchaseOrderDate descending
				PurchaseOrder descending

		Set3
			indexed
			Sort Order
				Company
				Buyer
				PurchaseOrderDate descending
				PurchaseOrder descending

		Set4
			indexed
			Instance Selection
				where (IsToBePrinted)
			Sort Order
				Company
				IssueMethod
				Buyer
				ShipToLocation
				Vendor
				PurchaseFromLocation
				PurchaseOrder

		Set5
			indexed
			Instance Selection
				where (IsUnreleased)
			Sort Order
				Company
				Buyer
				PurchaseOrder

		Set6
			indexed
			Instance Selection
				where (IsMatchable)
			Sort Order
				Company
				Vendor
				PurchaseFromLocation
				PurchaseOrder

		Set7
			indexed
			Sort Order
				Company
				PurchaseOrderDate descending
				PurchaseOrder descending

		Set8
			indexed
			Sort Order
				Company
				POCode
				PurchaseOrderDate descending
				PurchaseOrder descending
				PORelease descending

		Set9
			indexed
			Instance Selection
				where (IsReceivable)
			Sort Order
				Company
				Vendor
				PurchaseFromLocation
				PurchaseOrderDate descending
				PurchaseOrder descending

















		ByBlanketStandingContract
			Instance Selection
				where (FromBlanketOrStanding)
			Sort Order
				BlanketOrStandingContract
				Company
				PurchaseOrder

		ByVendor
			not indexed
			Sort Order
				Company
				Vendor
				PurchaseOrder

		ByVendorBeforeCompany
			not indexed
			Sort Order
				Vendor
				Company
				PurchaseOrder

		ByCompanyVendorOnly
			duplicates
			Sort Order
				Company
				Vendor

		ByShipToLocation
			not indexed
			Sort Order
				Company
				ShipToLocation
				PurchaseOrder

		ByCompanyPurchaseOrderRevision
			indexed
			Sort Order
				Company
				PurchaseOrder
				PurchaseOrderRevision

		ByInterfaceRun
			Sort Order
				OriginatingInterfaceRun
				Company
				PurchaseOrder

		ByProcurementTemplate
			Sort Order
				ProcurementTemplate
				Company
				PurchaseOrder

		ByProcurementCardNumber
			Sort Order
				Company
				ProcurementCardNumber
				PurchaseOrder

	Field Rules

		POCode
			if (!InterfacedPurchaseOrderExists)
				if (Company.POCodeDefaultMethod.InventoryLocation)
					default to ShipToLocation.POCode
				else
				if (Company.POCodeDefaultMethod.RequestingLocation)
					default to RequestingLocationRel.POCode
				else
		  		if (Company.POCodeDefaultMethod.VendorOrVendorLocation)
		  			default to PurchaseFromLocationRel.POCode
		  			default to PurchasingVendorRel.POCode
				else
				if (Company.POCodeDefaultMethod.BuyerGroup)
					default to Buyer.BuyerGroup.POCode
				else
				if (Company.POCodeDefaultMethod.System)
					if (TransientFromSourcing)
						default to Company.StrategicSourcingDefaultPOCode
					else
						default to Company.PurchaseOrderDefaultPOCode

			if (BlanketOrStandingContract not entered
			and Company.ManualPOCodeAllowed.No
			and old POCode entered)
				cannot be changed
					"ManualEntryOfPOCodeNotAllowed" 

			if (InterfacedPurchaseOrderExists)
				cannot be changed
					"CannotChangePOCode;PurchaseOrderHasBeenInterfacedFromAnotherSystem"

		DefaultBillCode
			default to POCode.ConsignCode

		PurchaseOrderDocument
			if (not CanOverrideDocumentTemplate)
				initialize

		DefaultAssetTemplate
			if (DefaultAsset entered)
				cannot be entered
					"CanOnlyEnterAssetTemplateOrAsset,NotBoth" 
					
		DefaultAsset
			if (DefaultAsset.AssetProcess.Disposal
			or DefaultAsset.Status.Disposed)
				cannot be entered
					"CannotUse;Asset<DefaultAsset>IsDisposed"

		IssueMethod
			if (Vendor changed
			or  PurchaseFromLocation changed)
				initialize IssueMethod

			if (not Issued)
				default to PurchaseFromLocationRel.IssueMethod
				default to PurchasingVendorRel.IssueMethod
				default to IssueMethod.Paper
			else
				default to PurchaseFromLocationRel.RevisedIssueMethod
				default to PurchasingVendorRel.RevisedIssueMethod
				default to IssueMethod.Paper

			constraint (not IssueMethod.Fax
			or			FaxNumber entered)
				"FaxNumberMustBeEnteredIfIssueMethodIsFax" 

			constraint (not IssueMethod.Email
			or			EmailAddress entered)
				"EmailMustBeEnteredIfIssueMethodIsEmail" 

			constraint (not IssueMethod.EDI
			or			PurchaseFromLocationRel.EDINumber entered
			or			PurchasingVendorRel.EDINumber entered
			or			PurchaseFromLocationRel.RevisedEDINumber entered
			or			PurchasingVendorRel.RevisedEDINumber entered)
				"CannotIssueAsEDI,NoEDINumberFound" 

		RevisionsInclude
			if (Issued)
				if (HasRevision
				and not RevisionsInclude.NotApplicable)
					constraint (RevisionsInclude entered)
						"MustEnterRevisionsIncludeFlagForRevisedPurchaseOrder" 

				if (Vendor changed
				or  PurchaseFromLocation changed)
					if (IssueMethod.DoNotPrint)
						force default to RevisionsInclude.NotApplicable
					else
						force default to RevisionsInclude.Reissue
			else
				cannot be entered
					"CannotSetRevisionsIncludeFlagUntilPurchaseOrderIsIssued" 

			if (RevisionsInclude.NotApplicable)
				constraint (IssueMethod.DoNotPrint)
					"NotApplicableIsInvalidUnlessPurchaseOrderIsDoNotPrint" 

			if (IssueMethod.DoNotPrint)
				constraint (RevisionsInclude.NotApplicable)
					"CannotSetRevisionsIncludeFieldWhenPurchaseOrderIsDoNotPrint" 

		ProcessLevel
			if (Company.RequireProcessLevel
			and !TransientFromSourcing)
				required
					"ProcessLevelIsRequired"

			if (ProcessLevel changed)
				constraint (NonServicePurchaseOrderLinesWithReceivedQuantityRel not exists
				and         MatchedPurchaseOrderLinesRel not exists)
					"CannotChangeProcessLevelWhenPurchaseOrderHasActivity" 
			if ((action type.Create														
			or   ProcessLevel	changed)
			and  Vendor.VendorRestrictions.RestrictedProcessLevel entered)									
				constraint (ProcessLevel = Vendor.VendorRestrictions.RestrictedProcessLevel)
					"VendorIsRestrictedToProcessLevel<Vendor.VendorRestrictions.RestrictedProcessLevel>"

		InvoiceMethod
			if (PurchaseFromLocation entered)
				if (PurchaseFromLocation.ERSCapable)
					default to InvoiceMethod.InvoiceNotRequired
				else
					if (PurchaseFromLocation.EDINumber entered)
						default to InvoiceMethod.InvoiceElectronically
					else
						default to InvoiceMethod.InvoiceByMail

			if (Vendor.ERSCapable)
				default to InvoiceMethod.InvoiceNotRequired
			else
				if (Vendor.EDINumber entered)
					default to InvoiceMethod.InvoiceElectronically
				else
					default to InvoiceMethod.InvoiceByMail

			if (InvoiceMethod.InvoiceNotRequired)
				if (PurchaseFromLocation entered)
					constraint (Vendor.ERSCapable
					or          PurchaseFromLocation.ERSCapable)
						"VendorOrPurchaseFromLocationMustBeERSCapable" 
				else
					constraint (Vendor.ERSCapable)
						"VendorMustBeERSCapable" 

			constraint (not InvoiceMethod.InvoiceNotRequired
			or			not Dropship)
				"DropShipmentCannotBeInvoiceNotRequiredInvoiceMethod" 

			if (UseProcurementCard changed)
				if (NonServicePurchaseOrderLinesWithReceivedQuantityRel exists)
					cannot be changed
						"CannotChangeInvoiceMethod;ReceivedQuantitiesExist" 

				if (PurchaseOrderLinesWithChargeApprovedQuantityRel exists)
					cannot be changed
						"CannotChangeInvoiceMethod;PurchaseOrderHasBeenInvoiced" 






			if (InvoiceMethod changed or action type.Create)
				include ReleaseLimitsValidation

		PrintReceipt
			initial value is true

		Dropship
			if (action type.Create)
				default to ShipToLocation.DefaultDropshipPurchaseOrder

			if (TransientDropShipToInventoryLocationAddress)
				constraint (ShipToLocation.NameForPurchaseOrder entered
				and         ShipToLocation.PostalAddressForPurchaseOrder entered)
					"ShipToLocationNameAndAddressMustBeEnteredWhenDropShippingToShipToLocation"
				DropshipName 	= ShipToLocation.NameForPurchaseOrder
				DropshipAddress = ShipToLocation.PostalAddressForPurchaseOrder

			constraint (InventoriedPurchaseOrderLinesRel not exists)
				"MustRequireReceivingOnTypeInventoryLines" 

			constraint (PurchaseOrderLinesWithInspectionRequiredRel not exist)
				"DropShipmentsCannotRequireInspection" 

			constraint (NonServicePurchaseOrderLinesWithReceivedQuantityRel not exist
			and			UnreleasedPurchaseOrderReceiptsRel not exist)
				"CannotDropShip,ReceivingsExist" 

			if (Dropship changed)
				constraint (MatchedPurchaseOrderLinesRel not exist)
					"CannotChangeDropShipFlag,InvoicesExist" 
				if (not Dropship)	
					constraint (DropShipPurchaseOrderReceiptsRel not exists)
						"CannotChangeToNon-\Drop_\Ship;\Drop_\ShipReceipt(s)AlreadyExist."

		DropshipName
			if (IsDropship)
				if (ShipToLocation.DefaultDropshipPurchaseOrder)
					default to ShipToLocation.NameForPurchaseOrder
				constraint (DropshipName entered)
					"MustEnterNameToPerformDropship"
			else
				if (DropshipAddress.Country entered
				or  DropshipContact entered
				or  DropshipPhoneNumber entered)
					required
						"NameAndAddressIsRequiredForAlternateShipToAddress"

		DropshipAddress
			if (IsDropship)
				if (ShipToLocation.DefaultDropshipPurchaseOrder)
					default to ShipToLocation.PostalAddressForPurchaseOrder
				constraint (DropshipAddress.Country entered
				and   		DropshipAddress.DeliveryAddress.AddressLine1 entered)
					"MustEnterAddressToPerformDropship"
			else
				if (DropshipName entered
				or	DropshipContact entered
				or	DropshipPhoneNumber entered)
					required
						"NameAndAddressIsRequiredForAlternateShipToAddress"

		TransientDropShipToInventoryLocationAddress
			constraint (Dropship)
				"CannotUseShipToInventoryLocationAddressForDropshipAddress;PurchaseOrderIsNotADropship"

		Vendor
			required
			if (Vendor.VendorStatus entered)
				constraint(Vendor.VendorStatus != "D" or Vendor.VendorStatus != "I")
					"TheVendorIsInactive"

			constraint (not InvalidVendorStatus)
				"ShouldNotAllowWithThePO_Vendor/_LocationInactive"

			if (MatchedPurchaseOrderLinesRel exists)
				cannot be changed
					"CannotChangeVendorAsMatchedInvoiceForVendorExists" 

			if (UnmatchedMatchPurchaseOrderInvoicesRel exists)
				cannot be changed
					"CannotChangeVendorAsUnmatchedInvoice(s)Exist" 

			if (VendorReturn entered)
				cannot be changed
					"CannotChangeVendor,VendorReturnExists" 

			if (PORelease entered)
				cannot be changed
					"CannotChangeVendorOnBlanket/StandingOrder" 
			if (Vendor changed)
				initialize FaxNumber
				initialize EmailAddress
				initialize TermCode
				initialize UseProcurementCard
				initialize ProcurementCardNumber
				if (Currency not changed)
					if (DerivedVendorCurrency entered)
						if (Currency != DerivedVendorCurrency)
							initialize Currency
					else



						if (Currency != Company.Currency)
							initialize Currency

		Currency
			default to DerivedVendorCurrency
			default to Company.Currency

			if (DerivedVendorCurrency entered)
				constraint (Currency = DerivedVendorCurrency)
					"EnteredCurrencyMustBeEqualToVendorCurrency"

			if (Vendor changed
			or  PurchaseFromLocation changed
			or  Currency changed
			or  PurchaseOrderDate changed)
				initialize EnteredCurrencyConversionRate

		Buyer
			required
			initial value is actor.agent(Employee).Employee
			default to actor.agent(Employee).Employee
			default to PurchaseFromLocationRel.Buyer
			default to PurchasingVendorRel.Buyer

            if (action type.Create
            or (action type.Update
            and (Buyer changed
            or   ShipToLocation changed
            or   Vendor changed
            or   PurchaseFromLocation changed)))
				initialize ValidateBuyer
				ValidateBuyer.InPurchasingCompany		= Company
				ValidateBuyer.InShipToLocation			= ShipToLocation
				ValidateBuyer.InVendor					= Vendor
				ValidateBuyer.InPurchaseFromLocation	= PurchaseFromLocation
				constraint (ValidateBuyer.IsValidBuyer)
					"<ValidateBuyer.ErrorMessage>"
					
		DefaultDeliveryDate
			constraint (DefaultDeliveryDate >= PurchaseOrderDate)
				"DefaultDeliveryDateIsLessThanPurchaseOrderDate"

		PurchaseOrderDate
			initial value is current corporate date
			default to current corporate date

	 		if (BlanketOrStandingContract.LastInvoiceAllowedDate entered)
				constraint (PurchaseOrderDate <= BlanketOrStandingContract.LastInvoiceAllowedDate)
					"CannotUse,PurchaseOrderDateLaterThanContractLastInvoiceAllowedDate"
			else
				if (BlanketOrStandingContract.ExpirationDate entered)
					constraint (PurchaseOrderDate < BlanketOrStandingContract.ExpirationDate)
						"CannotUse,PurchaseOrderDateLaterThanContractExpirationDate"

			constraint (BlanketOrStandingContract.EffectiveDate <= PurchaseOrderDate
			or 			BlanketOrStandingContract.FirstInvoiceAllowedDate not entered)
				"CannotUse,PurchaseOrderDatePriorToContractEffectiveDate"

			if (PurchaseOrderDate changed
			and Company.ProcurementGroup.PurchaseOrderEncumbranceDate.PurchaseOrderDate
			and CommitmentsExist)
				BudgetEditProcessing = 0
				for each PurchaseOrderLineDistributionsRel
					invoke UpdateGLCommitmentIndirect each
						invoked.PerformBudgetEdit = true
						invoked.FromDateChange    = true

			if (PurchaseOrderDate changed)
				constraint (PurchaseOrderLinesWithEarlierDeliveryDateRel not exists)
					"CannotChangePurchaseOrderDateToLaterThanDeliveryDate" 

		ShipToLocation
			required

		PurchaseFromLocation        
			default to Vendor.NormalPurchaseFromLocation
			constraint (!PurchaseFromLocation.LocationType.RemitTo)		
				"PurchaseFromLocationTypeIsRemit-to,NotPurchase-from"	
			if (PurchaseFromLocation changed)
				initialize FaxNumber
				initialize EmailAddress
				initialize UseProcurementCard
				initialize ProcurementCardNumber
				if (Currency not changed
				and DerivedVendorCurrency entered)
					initialize Currency

		TermCode
			if  (action type.Create
			or  (action type.Update
			and (Vendor changed))
			and  not BypassTermCodeDefaulting)
				default to BlanketOrStandingContract.TermsCode
				default to PurchaseFromCompanyDefaultsRel.TermsCode
				default to PurchaseFromLocation.TermsCode
				default to VendorCompanyDefaultsRel.TermsCode
				default to Vendor.TermsCode

		TaxCode
			if (DefaultTaxable)
				default to ShipToLocation.PurchaseOrderTaxCode
				default to PurchaseFromLocation.TaxCode
				default to Vendor.VendorCompanyDefaultRel.TaxCode
				default to Vendor.TaxCode







			if (DefaultTaxable
			and TaxCode entered
			and TaxEntityRel.UseTaxCodeAccounts)		
				constraint (CompanyTaxCodeRel exists)
					"TaxCode<TaxCode>NotSetupForEntity<Company.AccountingEntity>"	

		ShipTerm
			default to PurchaseFromLocationRel.ShipTerm
			default to PurchasingVendorRel.ShipTerm

		FaxNumber
			default to PurchaseFromLocationRel.FaxNumber
			default to PurchasingVendorRel.FaxNumber
			default to Vendor.FaxNumber

		EmailAddress
			default to PurchaseFromLocationRel.EmailAddress
			default to PurchasingVendorRel.EmailAddress
			default to Vendor.EmailAddress

		ShippingMethod
			default to PurchaseFromLocationRel.ShipVia
			default to PurchasingVendorRel.ShipVia

		Closed
			default to Closed.No

		TransientContactCode
			constraint (TransientContactCode exists)
				"ContactCodeDoesNotExist"

			constraint (TransientContactCode.ContactLevel entered)
				"ContactLevelMustBeEnteredForContactCodeWhenAContactCodeIsUsed"


		FreightTerm
			default to PurchaseFromLocationRel.FreightTerm
			default to PurchasingVendorRel.FreightTerm
			default to Company.FreightTerm
			required 

		PurchaseOrderApprovalType
			if (Buyer changed
			or  ShipToLocation changed)
				initialize PurchaseOrderApprovalType

			default to Buyer.PurchaseOrderApprovalType
			default to ShipToLocation.PurchaseOrderApprovalType
			default to Company.PurchaseOrderApprovalType

		CurrencyTable
			default to CompanySystemClosingControlRel.CurrencyTable
			default to GeneralLedgerCompanyRel.FinanceEnterpriseGroup.CurrencyTable

		EnteredCurrencyConversionRate										
			if (Currency entered)
				LocalFromCurrency  = Currency
				initialize LocalTransactionAmount
				LocalExchangeDate = PurchaseOrderDate
				LocalCurrencyExchange.ToCurrency	= Company.Currency

				constraint (LocalCurrencyExchange.IsRateDefined)
					"CurrencyRateDoesNotExistBetween<Currency>To<Company.Currency>"
				default to LocalCurrencyExchange.OutputCurrencyRate

			if (NonServicePurchaseOrderLinesWithReceivedQuantityRel exist
			or  MatchedPurchaseOrderLinesRel exist)
				cannot be changed
					"CannotChangeExchangeRateWhenPurchaseOrderHasActivity" 

			if (Currency = Company.Currency
			and EnteredCurrencyConversionRate != 1
			and EnteredCurrencyConversionRate != 0)
				cannot be entered
					"CannotEnterExchangeRateOtherThan1ForBaseCurrency" 

		CurrencyExchangeSetPoint
			if (Currency entered and EnteredCurrencyConversionRate != 0)
				default to MatchCompanyRel.CurrencyExchangeSetPoint

			if (EnteredCurrencyConversionRate changed
			and Currency not changed)
				CurrencyExchangeSetPoint	= CurrencyExchangeSetPoint.Entry

			if (NonServicePurchaseOrderLinesWithReceivedQuantityRel exist
			or  MatchedPurchaseOrderLinesRel exist)
				cannot be changed
					"CannotChangeSetRatePointWhenPurchaseOrderHasActivity" 

		ReceiptCurrencyConversionRate
			if (CurrencyExchangeSetPoint.Entry
			or  CurrencyExchangeSetPoint.Receiving)
				ReceiptCurrencyConversionRate = EnteredCurrencyConversionRate

			if (CurrencyExchangeSetPoint.Invoicing)
				initialize ReceiptCurrencyConversionRate

		Revalue
			if (EnteredCurrencyConversionRate != 0)
				default to PurchaseFromLocation.RevalueCurrency
				default to Vendor.RevalueCurrency							

		ShipToArriveDate
			constraint (DefaultDeliveryDate not entered
			or 			ShipToArriveDate >= DefaultDeliveryDate)
				"ShipToArriveDateIsLessThanDefaultDeliveryDate" 

			constraint (ShipToArriveDate >= PurchaseOrderDate)
				"ShipToArriveDateIsLessThanPurchaseOrderDate" 

		UseProcurementCard
			if (action type.Create
			or  Vendor changed
			or  PurchaseFromLocation changed)
				default to PurchaseFromLocation.UseProcurementCard
				default to Vendor.UseProcurementCard

		ProcurementCardNumber
			if (UseProcurementCard)
				default to PurchaseFromLocation.ProcurementCardNumber
				default to Vendor.ProcurementCardNumber

			constraint (UseProcurementCard)
				"CannotUseProcurementCardNumberWhenProcurementCardFlagIsFalse" 


			LocalProcurementCardProgram	= first ProcurementCardRequestRel.ProcurementCardProgram
			LocalProcurementCardRequest	= first ProcurementCardRequestRel.ProcurementCardRequest

			display "Program:<LocalProcurementCardProgram>"
			constraint (ProcurementCardCompanyRel exists)
				"CompanyNotAssociatedWithProcurementCard" 

			constraint (ProcurementCardNumber exists)
				"ProcurementCardNumberNotFound" 

			constraint (ProcurementCardRequestRel.IsActivated)
				"ProcurementCardNumberIsNotActivated" 

			constraint (PurchaseOrderDate >= ProcurementCardRequestRel.ProcurementCardRequestEffectiveDate
			and         PurchaseOrderDate <= ProcurementCardRequestRel.ProcurementCardRequestExpirationDate)
				"PurchaseOrderDateMustBeWithinProcurementCardEffectiveDate" 

			if (NonServicePurchaseOrderLinesWithReceivedQuantityRel exists)
				cannot be changed
					"CannotChangeProcurementCardNumber;ReceivedQuantitiesExist" 

			if (PurchaseOrderLinesWithChargeApprovedQuantityRel exists)
				cannot be changed
					"CannotChangeProcurementCardNumber;PurchaseOrderHasBeenInvoiced" 

		SubcontractorPurchaseOrder
			if (SubcontractorPurchaseOrder changed
			and IsSubcontractorPurchaseOrder)
				constraint (InventoriedPurchaseOrderLinesRel not exists)
					"CannotUpdateThePurchaseOrderToSubcontractorPurchaseOrderIfThereAreLinesThatHaveInventoriedTypeOfItems" 

				constraint (not Released)
					"CannotChangePurchaseOrderIntoASubcontractorPurchaseOrderOnceThePurchaseOrderIsReleased"

		DefaultSourceInformation
			constraint (DefaultSourceInformation.DefaultRequestingLocation entered
			or 			DefaultSourceInformation.DefaultOperatingCompany not entered)
				"DefaultRequestingLocationRequiredIfDefaultOperatingCompanyEntered" 

			constraint ((DefaultSourceInformation.DefaultRequestingLocation not entered
			and			DefaultSourceInformation.DefaultRequester not entered
			and			DefaultSourceInformation.DefaultDeliverTo not entered)
			or 			DefaultSourceInformation.DefaultSourceDocument entered)
				"MustEnterSourceDocumentIfEnteringSourceData" 


		RetainagePercentCompleteTracking
			if (RetainagePercentCompleteTracking changed)
				constraint (not HasRetainageContract)
					"RetainageContractTrackingDefaultsFromContractRetainageLines"
				constraint (not old HasRetainageContract)
					"ContractRetainageOnLine;CannotRemoveHeaderContractRetainage"

				if (RetainagePercentCompleteTracking.NoRetainage)
					constraint (RetainageLinesRel not exists)
						"RetainageOnLineExists;CannotRemoveHeaderPurchaseOrderRetainage"

					initialize RetainageFirstPercent
					initialize RetainageSecondPercent
					initialize RetainageUpToPercentComplete
					initialize RetainageOverridePercentComplete

			if ((RetainagePercentCompleteTracking changed or action type.Create) and AllowRetainageEdit)
				include ReleaseLimitsValidation

		RetainageFirstPercent
			if (RetainagePercentCompleteTracking.PurchaseOrderLevel)
				required
					"RetainagePurchaseOrder.FirstRetainagePercentCannotBeZeros"
			else
			if (HasRetainageContract
			or  RetainagePercentCompleteTracking.NoRetainage)
				cannot be entered
					"RetainageMustBeOnHeaderOrLineToHaveRetainagePercent"

		RetainageUpToPercentComplete
			if (RetainagePercentCompleteTracking.PurchaseOrderLevel)
				required
					"RetainagePurchaseOrder.MustHaveAnUpToRetainagePercent"
			else
			if (HasRetainageContract
			or  RetainagePercentCompleteTracking.NoRetainage)
				cannot be entered
					"RetainageMustBeOnHeaderOrLineToHaveRetainagePercent"

		RetainageSecondPercent
			if (not HasRetainage)
				cannot be entered
					"RetainageMustBeOnHeaderOrLineToHaveRetainagePercent"

		RetainageOverridePercentComplete
			if (not RetainagePercentCompleteTracking.PurchaseOrderLevel)
				cannot be entered
					"RetainageMustBeOnHeaderToHaveHeaderOverridePercentage"

		RetainageDueDate
			if ((RetainageDueDate changed or action type.Create) and AllowRetainageEdit)
				include ReleaseLimitsValidation

		SuppressPOCost
			if (AribaPOType entered)
				SuppressPOCost = AribaPOType.SuppressPOCost
			else
				if (AribaPOType changed)
					SuppressPOCost = AribaPOType.SuppressPOCost
		RequireWO
			if (AribaPOType entered)
				RequireWO = AribaPOType.RequireWO
			else
				if (AribaPOType changed)
					RequireWO = AribaPOType.RequireWO
		RequireAttachment
			if (AribaPOType entered)
				RequireAttachment = AribaPOType.RequireAttachment
			else
				if (AribaPOType changed)
					RequireAttachment = AribaPOType.RequireAttachment
		BlanketPO
			if (AribaPOType entered)
				BlanketPO = AribaPOType.BlanketPO
			else
				if (AribaPOType changed)
					BlanketPO = AribaPOType.BlanketPO

		PurchaseOrderIDMTemplate
			if (not CanOverrideIDMDocumentTemplate)
				initialize
			else
				constraint (PurchaseOrderIDMTemplate.IDMDocumentType.PurchaseOrder)
					"InvalidTemplate"

		IDMPrinter
			initial value is Company.UserDefaultPrinter
				when (IssueMethodPaperAndUsingIDM)
				
			if (IssueMethodPaperAndUsingIDM
			and	PurchaseOrderLifeCycleState.Unreleased)
				default to Company.UserDefaultPrinter
			
			if (!IssueMethodPaperAndUsingIDM)
				initialize
			

		TransientPatientID
			if (TransientVisitNumber exists)
				force default to TransientVisitNumber.Patient
		TransientPatientLastName
			if (TransientPatientID exists)
				force default to TransientPatientID.LastName
		TransientPatientFirstName
			if (TransientPatientID exists)
				force default to TransientPatientID.FirstName
		TransientPatientMiddleName
			if (TransientPatientID exists)
				force default to TransientPatientID.MiddleInitial
		TransientBirthdate
			if (TransientPatientID exists)
				force default to TransientPatientID.BirthDate
		TransientSocialSecurityNumber
			if (TransientPatientID exists)
				force default to TransientPatientID.FicaNbr


 		EDIOutputOrderAmount
			force default to CalculateEDIOutputOrderAmount

		PointOfTitleTransfer
			if (IsOneSourceTax)
				default to PointOfTitleTransfer.Destination
			else
				initialize PointOfTitleTransfer

	Create Rules
		if (Vendor.VendorRestrictions.RestrictedCompany entered)									
			constraint (Company = Vendor.VendorRestrictions.RestrictedCompany)
				"VendorIsRestrictedToCompany<Vendor.VendorRestrictions.RestrictedCompany>"
		if (Vendor.VendorRestrictions.RestrictedCompanyGroup entered)								
			LocalGeneralLedgerCompanyGroup = Vendor.VendorRestrictions.RestrictedCompanyGroup
			constraint (LocalGLCompanyGroupMemberRel exists)
				"VendorIsRestrictedToCompanyGroup<Vendor.VendorRestrictions.RestrictedCompanyGroup>;Company<Company>IsNotAMemberOfGroup"	
		if (Company.HasManualPORange)
			if (PurchaseOrder entered)
				constraint (PurchaseOrder within Company.ManualPurchaseOrderRange)
					"IfPurchaseOrderEntered,NeedsToBeWithinManualRange"
		else
			constraint (PurchaseOrder not entered)			
				"DoNotEnterPurchaseOrder"

		constraint (MatchCompanyRel exists)
			"MatchCompany<Company>DoesNotExist"


		if (BlanketStandingContractRel.ProcessLevelGroup.ProcessLevel entered)
			ProcessLevel = BlanketStandingContractRel.ProcessLevelGroup.ProcessLevel

		if (Company.DefaultProcessLevelFromHeaderLocation
		and ProcessLevel not entered)
			ProcessLevel = ShipToLocation.ProcessLevel

		if  (ProcessLevel not entered)
			ProcessLevel = PayablesDefaultProcessLevelRel.PayablesProcessLevel

		if (not LocalFromInterface) 
			if (BillToDetailsNotEntered)
				if (ShipToLocation.PurchaseOrderBillToName entered
				and ShipToLocation.PurchaseOrderBillToAddress.DeliveryAddress.AddressLine1 entered)
					PurchaseOrderBillToName    		= ShipToLocation.PurchaseOrderBillToName
					PurchaseOrderBillToAddress 		= ShipToLocation.PurchaseOrderBillToAddress
					PurchaseOrderBillToContact 		= ShipToLocation.PurchaseOrderBillToContact
					PurchaseOrderBillToPhoneNumber 	= ShipToLocation.PurchaseOrderBillToPhoneNumber
					PurchaseOrderBillToEmailAddress = ShipToLocation.PurchaseOrderBillToEmailAddress
				else
					PurchaseOrderBillToName    		= Company.PurchaseOrderBillToName
					PurchaseOrderBillToAddress 		= Company.PurchaseOrderBillToAddress
					PurchaseOrderBillToContact 		= Company.PurchaseOrderBillToContact
					PurchaseOrderBillToPhoneNumber 	= Company.PurchaseOrderBillToPhoneNumber
					PurchaseOrderBillToEmailAddress = Company.PurchaseOrderBillToEmailAddress

	Create Exit Rules
		log untranslatable:"Company<Company>;PurchaseOrder<PurchaseOrder>;PurchaseOrderDate<PurchaseOrderDate>;IssueMethod<this instance(locale of blank).IssueMethod>."			
		include CreatePurchaseOrderDiversity
		if (StandardCommentCode entered)
			if (StandardCommentCode.StandardCommentPrintCode.NamedPlaceIncoterm)
				if (PurchaseOrderIncotermRel not exists)
					include CreateCommentFromCommentCode
				else
					initialize StandardCommentCode
					constraint (PurchaseOrderIncotermRel not exists)
						"CannotHaveMultipleIncotermComments"
			else
				include CreateCommentFromCommentCode
		else
			if (FreightTerm entered)
				include CreateIncotermComment

		if (not LocalCopyComments and Company.POStandardCode entered)
			for each Company.POStandardCode.StandardCommentCode
				if (each entered)
					invoke SystemCreate PurchaseOrderComment
						fill in fields from this instance
						invoked.CommentTitle 		= each.CommentName
						invoked.CommentType  		= each.StandardCommentPrintCode
						invoked.CommentText  		= each.CommentText
						invoked.Attachment.File   	= each.Attachment.File
						invoked.Attachment.MimeType = each.Attachment.MimeType
						invoked.Attachment.Title   	= each.Attachment.Title

		if (DisplayOfProcedureInfo)
			include CheckPHIProcedureInformation
			
	Delete Rules
		if (not LocalPurgePurchaseOrder)
			constraint (not PurchaseOrderReceiptExists)
				"CannotDeletePurchaseOrder;ReceiverExists"

		if (not LocalPurgePurchaseOrder)
			if (VendorReturn exists)
				constraint (VendorReturn.Status.Closed and !VendorReturn.Canceled)
					"CannotDeletePurchaseOrder;ReturnNumberExists"




	StateCycles
		PurchaseOrderLifeCycle is a StateCycle

			state field is PurchaseOrderLifeCycleState

			Unreleased is a State
				Create is a Create Action
					Action Rules
						constraint (PORelease not entered
						or			BlanketOrStandingContract entered)
							"CannotEnterPurchaseOrderReleaseNumber"

						if (PurchaseOrder entered)							
							constraint (not PurchaseOrderReceiptExists)
								"CannotCreatePO;ReceiverExists"

						constraint (not HasRetainageContract)
							"RetainageContractTrackingDefaultsFromContractRetainageLines"

						if (DefaultSourceInformation.DefaultRequestingLocation entered
						and DefaultSourceInformation.DefaultOperatingCompany entered)
							constraint (RequestingLocationRel exists)
								"InvalidRequestingLocation<DefaultSourceInformation.DefaultRequestingLocation>"

					Exit Rules 

						if (BlanketOrStandingContract entered)  
							for each PrintOnPOContractCommentRel
								invoke Create PurchaseOrderComment
									invoked.Company				= Company
									invoked.PurchaseOrder		= PurchaseOrder
									invoked.CommentTitle		= each.CommentTitle
									if (each.CommentUsedFor = 2)
										invoked.CommentType		= "P"
									else 
									if (each.CommentUsedFor = 3)
										invoked.CommentType     = "N"
									invoked.CommentText		= each.Description
									invoked.Attachment		= each.Attachment


				CreateFromBatch is a Create Action
					restricted
					Parameters
						PrmPurchaseOrderImport is like PurchaseOrderImport
					Action Rules
						invoke Create this instance
						if (PrmPurchaseOrderImport entered)
							invoke Create InterfacedPurchaseOrder
								invoked.Company             = Company
								invoked.PurchaseOrderImport = PrmPurchaseOrderImport
								invoked.PurchaseOrder       = PurchaseOrder
								invoked.POCode              = POCode


				QuickCreate is a Create Action

				CreateFromInterface is a Create Action
					restricted
					Action Rules

				CreateFromBlanket is a Create Action
		 			Field Rules
		 				Company
		 					constraint (BlanketOrStandingContract.ContractGroup = Company.ProcurementGroup)
		 						"Company<Company>IsInvalidForProcurementGroup<BlanketOrStandingContract.ContractGroup>"

						BlanketOrStandingContract
							required
							constraint (BlanketOrStandingContract.BlanketPurchaseType)
								"CannotProcess,NotABlanketTypeContract"
							constraint (BlanketOrStandingContract.ContractStatus.Active)
								"BlanketContractMustBeInActiveStatusToCreatePurchaseOrder"


						Buyer
							default to BlanketOrStandingContract.Buyer

						ProcessLevel
							default to BlanketOrStandingContract.ProcessLevelGroup.ProcessLevel

						ShipToLocation
							if (BlanketOrStandingContract.ContractParticipantsExist)
								constraint (ContractParticipantLocationsRel exists)
									"CannotAdd,LocationDoesNotParticipateInBlanketContract"

						TermCode
							default to BlanketOrStandingContract.TermsCode

						FreightTerm
							default to BlanketOrStandingContract.FreightTerm

						ShipTerm
							default to BlanketOrStandingContract.ShipTerm

						PurchaseOrderUserField1
							default to BlanketOrStandingContract.PoUserField1
						PurchaseOrderUserField3
							default to BlanketOrStandingContract.PoUserField3
						PurchaseOrderUserField5
							default to BlanketOrStandingContract.PoUserField5

		 			Action Rules
		 				invoke FastUpdate BlanketOrStandingContract
		 					invoked.LastPORelease			+= 1
		 				PORelease 							= BlanketOrStandingContract.LastPORelease
		 				POCode								= BlanketOrStandingContract.POCode
						Vendor 								= BlanketOrStandingContract.Vendor
						if (BlanketOrStandingContract.ApPoPurchaseFrom.PurchaseFromLocation entered)
							PurchaseFromLocation			= BlanketOrStandingContract.ApPoPurchaseFrom.PurchaseFromLocation
						else
							PurchaseFromLocation			= BlanketOrStandingContract.ApPoPurchaseFrom.VendorLocation

					Exit Rules
						for each PrintOnPOContractCommentRel
							invoke Create PurchaseOrderComment
								invoked.Company				= Company
								invoked.PurchaseOrder		= PurchaseOrder
								invoked.CommentTitle		= each.CommentTitle
								if (each.CommentUsedFor = 2)
									invoked.CommentType		= "P"
								else 
								if (each.CommentUsedFor = 3)
									invoked.CommentType     = "N"
								invoked.CommentText		= each.Description
								invoked.Attachment		= each.Attachment

				CreateFromTemplate is a Create Action
					Field Rules
						ProcurementTemplate
							required
						DefaultDeliveryDate
							required
					Exit Rules
						constraint (ProcurementTemplateParticipantsByBuyerRel exists
						or 			ProcurementTemplateParticipantsByCompanyRel exists
						or 			ProcurementTemplateParticipantsByBuyerGroupRel exists)
								"NotAValidParticipantForProcurementTemplate"

						if (ProcurementTemplate entered
						and TransientCopyAllLines)
							for each ProcurementTemplate.ValidProcurementTemplateLinesRel	
								invoke CreateFromTemplateLine PurchaseOrderLine
									invoked.PrmCompany					= Company
									invoked.PrmPurchaseOrder			= PurchaseOrder
									invoked.PrmProcurementGroup			= Company.ProcurementGroup
									invoked.PrmProcurementTemplate		= ProcurementTemplate
									invoked.PrmProcurementTemplateLine	= each.ProcurementTemplateLine
									invoked.PrmVendor                   = Vendor
									invoked.PrmCopyAllLines				= TransientCopyAllLines

		 		CreateFromPurchaseOrder is a Create Action
					Parameters
						PrmCompany						is a PurchasingCompany
						PrmCopyFromPurchaseOrder        is a PurchaseOrder
						PrmBuyer			   			is a Buyer
							default label is "Buyer"
						PrmDefaultDeliveryDate  		is Date
							default label is "DefaultDeliveryDate"
						PrmVendor						is a Vendor
						PrmPurchaseFromLocation			is a VendorLocation
						PrmShipToLocation				is an InventoryLocation
						PrmPurchaseOrderDate			is Date
						PrmIsReleased					is Boolean
						PrmCopyUnitCost					is Boolean
						PrmCopyIgnoreCancelQuantity		is Boolean
						PrmCopyDistributions			is Boolean
						PrmCopyComments					is Boolean
						PrmCopyAddOnCosts				is Boolean
						PrmCopyTaxData					is Boolean
						PrmCopySourceRecords			is Boolean
						PrmNewDefaultTaxCode			is a TaxCode
						PrmNewRequestingLocation		is a RequestingLocation
						PrmRequester					is a Requester
						PrmSourceDocument				is a DefaultSourceDocument
						PrmUsePOVendor					is Boolean
						PrmUsePOPurchaseFromLocation	is Boolean
					Parameter Rules
						PrmCompany
							required
							default to PrmCopyFromPurchaseOrder.Company
						PrmCopyFromPurchaseOrder
							required
							constraint (PrmCopyFromPurchaseOrder exists)
								"PurchaseOrderDoesNotExist"
							constraint (not PrmCopyFromPurchaseOrder.IsUnreleased)
								"CannotCopyUnreleasedPurchaseOrder"
							constraint (not PrmCopyFromPurchaseOrder.Closed.Historical) 
								"ProcessLevelDoesNotExistOnPurchaseOrder"
							if (PrmCopyFromPurchaseOrder.ProcessLevel entered)
								constraint(PrmCopyFromPurchaseOrder.ProcessLevel.Active)
									"CannotAdd,ProcessLevel<PrmCopyFromPurchaseOrder.ProcessLevel>_IsInactive"
						PrmBuyer
							required
							initial value is PrmCopyFromPurchaseOrder.Buyer
						PrmDefaultDeliveryDate
							required
							if (PrmPurchaseOrderDate entered)
								constraint(PrmDefaultDeliveryDate >= PrmPurchaseOrderDate)
									"DeliveryDateMustBeGreaterThanPurchaseOrderDate"
							else
								constraint(PrmDefaultDeliveryDate >= current corporate date)
									"DefaultDeliveryDateIsLessThanPurchaseOrderDate"
						PrmVendor
							default to PrmCopyFromPurchaseOrder.Vendor
							constraint(PrmVendor.IsActiveVendor)
								"A/PVendor<PrmVendor>StatusIsInactive"
						PrmPurchaseFromLocation
							if (PrmVendor = PrmCopyFromPurchaseOrder.Vendor)
						   		default to PrmCopyFromPurchaseOrder.PurchaseFromLocation
						PrmUsePOVendor
							initial value is false
							if (PrmVendor = PrmCopyFromPurchaseOrder.Vendor)
								PrmUsePOVendor = true
						PrmUsePOPurchaseFromLocation
							initial value is false
							if (PrmPurchaseFromLocation = PrmCopyFromPurchaseOrder.PurchaseFromLocation)
								PrmUsePOPurchaseFromLocation = true
						PrmShipToLocation
							default to PrmCopyFromPurchaseOrder.ShipToLocation
					   	PrmCopyUnitCost
				   			initial value is true
				   		PrmCopyIgnoreCancelQuantity
				   			initial value is true
						PrmCopyDistributions
				   			initial value is true
						PrmCopyComments
				   			initial value is true
						PrmCopyAddOnCosts
				   			initial value is true
						PrmCopyTaxData
				   			initial value is true
						PrmCopySourceRecords
				   			initial value is true
						PrmNewDefaultTaxCode
							if (PrmCopyTaxData)
								cannot be entered
									"CannotEnterDefaultTaxCodeIfCopyingTaxCodes"
						PrmSourceDocument
							if (PrmCopySourceRecords)
								cannot be entered
									"CannotEnterSourceDataIfCopyingSourceRecords"
						PrmNewRequestingLocation
							if (PrmCopySourceRecords)
								cannot be entered
									"CannotEnterSourceDataIfCopyingSourceRecords"
						PrmRequester
							if (PrmCopySourceRecords)
								cannot be entered
									"CannotEnterSourceDataIfCopyingSourceRecords"
						PrmPurchaseOrderDate
							default to current corporate date
					Local Fields
						LocalPurchaseOrder		is a PurchaseOrder view
						LocalNumberOfLines		is Numeric size 6
						AsyncId					is an AsyncActionRequest

					Action Rules
						if (PrmCopyFromPurchaseOrder.Canceled)
							if (PrmCopyIgnoreCancelQuantity)
								LocalNumberOfLines = PrmCopyFromPurchaseOrder.LineCount
							else
								initialize LocalNumberOfLines
						else
							if (PrmCopyIgnoreCancelQuantity)
								LocalNumberOfLines = PrmCopyFromPurchaseOrder.LineCount
							else
								LocalNumberOfLines = instance count of PrmCopyFromPurchaseOrder.NotCanceledPurchaseOrderLinesForCopyRel

						constraint (LocalNumberOfLines > 0)
							"PurchaseOrderNotCopied.NoLinesCouldBeCopied"

						invoke Create this instance
							fill in fields from PrmCopyFromPurchaseOrder
								except invoked.PurchaseOrder
								except invoked.NumberOfLines
								except invoked.NumberOfClosedLines
								except invoked.Released
								except invoked.Issued
								except invoked.Revised
								except invoked.Canceled
								except invoked.Closed
								except invoked.LastActivityDate
								except invoked.CloseDate
								except invoked.RevisionsInclude
								except invoked.IssuePending
								except invoked.UserId
								except invoked.Approved
								except invoked.ShipToArriveDate
								except invoked.LastApprovalDate
								except invoked.Rejected
								except invoked.PurchaseOrderApprovalType
								except invoked.CreatedBy
								except invoked.LastUpdateDate
								except invoked.LastUpdateBy
								except invoked.PurchaseOrderLifeCycleState
								except invoked.ApprovalStatus
								except invoked.PurchaseOrderDocument
								except invoked.PurchaseOrderRevision
								except invoked.BudgetEditProcessing
								except invoked.AccruedTaxTotal
								except invoked.VendorAddOnChargeAmount
								except invoked.TotalTaxAmount
								except invoked.PrintTotal
								except invoked.VendorInvoicedTaxAmount
								except invoked.VendorGrandTotal
								except invoked.OtherVendorAddOnChargeAmount
								except invoked.OtherVendorInvoicedTaxAmount
								except invoked.OtherVendorGrandTotal
								except invoked.TotalOrderAmount
								except invoked.OpenPurchaseAmount
								except invoked.PurchaseOrderLineTotal
								except invoked.TotalProductAmount
								except invoked.TotalTaxableAmount
								except invoked.StockWeight
								except invoked.StockVolume
								except invoked.AddOnChargeTotal
								except invoked.FreightTotal
								except invoked.InsuranceTotal
								except invoked.CustomsTotal
								except invoked.OtherAddOnChargesTotal
								except invoked.IssueMethod
								except invoked.PatientProcedure
								except invoked.IDMDocumentSequence
								except invoked.FaxNumber
								except invoked.EmailAddress
								except invoked.CreateForVendorReturn
								except invoked.TransientVisitNumber
								except invoked.TransientPatientID
								except invoked.TransientCaseNumber
								except invoked.TransientPatientLastName
								except invoked.TransientPatientFirstName
								except invoked.TransientPatientMiddleName
								except invoked.TransientBirthdate
								except invoked.TransientGender
								except invoked.TransientSocialSecurityNumber
								except invoked.DefaultProcedureInformation
								except invoked.IDMDocumentPID
								except invoked.IDMJob
								except invoked.Currency
								except invoked.EnteredCurrencyConversionRate
								except invoked.RetainagePercentComplete
								except invoked.TotalMatchedAmount
								except invoked.AcknowledgedViaSupplierPortal
								except invoked.IDMPrinter
								except invoked.TemporaryHold
								except invoked.MatchPrepayment
								except invoked.PurchaseOrderIDMXMLFile
							invoked.Company 				= PrmCompany
							invoked.Buyer				 	= PrmBuyer
							invoked.DefaultDeliveryDate 	= PrmDefaultDeliveryDate
							invoked.Vendor 					= PrmVendor
							invoked.PurchaseOrderDate 		= PrmPurchaseOrderDate
							invoked.PurchaseFromLocation 	= PrmPurchaseFromLocation
							invoked.ShipToLocation			= PrmShipToLocation
							invoked.PrintReceipt			= true
							invoked.LocalCopyComments		= PrmCopyComments
							initialize invoked.LastPurchaseOrderLine
							initialize invoked.DefaultSourceInformation.DefaultDeliverTo
							initialize invoked.TemporaryHold

							if (PrmCopyFromPurchaseOrder.HasRetainageContract)
								initialize invoked.RetainagePercentCompleteTracking
								initialize invoked.RetainageFirstPercent
								initialize invoked.RetainageSecondPercent
								initialize invoked.RetainageUpToPercentComplete
								initialize invoked.RetainageOverridePercentComplete

							if (PrmCopySourceRecords)
								initialize invoked.DefaultSourceInformation.DefaultSourceDocument
								initialize invoked.DefaultSourceInformation.DefaultOperatingCompany
								initialize invoked.DefaultSourceInformation.DefaultRequester
								initialize invoked.DefaultSourceInformation.DefaultRequestingLocation
							else
								if (PrmSourceDocument entered)
									invoked.DefaultSourceInformation.DefaultSourceDocument		= PrmSourceDocument
									invoked.DefaultSourceInformation.DefaultOperatingCompany    = PrmCompany				
									invoked.DefaultSourceInformation.DefaultRequester 			= PrmRequester
									invoked.DefaultSourceInformation.DefaultRequestingLocation 	= PrmNewRequestingLocation
						if (PrmCopyComments)
							for each PrmCopyFromPurchaseOrder.PurchaseOrderComment set
								if (PurchaseOrderIncotermRel exists)
									invoke Delete PurchaseOrderIncotermRel
								if (not each.IsSystemGeneratedType)
									invoke SystemCreate PurchaseOrderComment
										fill in fields from each
											except invoked.AttachmentSent
											except invoked.Attachment.FSMAttachmentIDM
										invoked.PurchaseOrder	= PurchaseOrder
										invoked.CommentTitle 	= each.CommentTitle
										invoked.CommentType  	= each.CommentType
										invoked.CommentText  	= each.CommentText
										invoked.Attachment.File		= each.Attachment.File
										invoked.Attachment.MimeType	= each.Attachment.MimeType
										invoked.Attachment.Title	= each.Attachment.Title
						LocalCopiedPurchaseOrderLineCount = PrmCopyFromPurchaseOrder.NumberOfLines

						LocalPurchaseOrder = PurchaseOrder

					Exit Rules

						initialize LocalUseBatchRelease

						if (LocalNumberOfLines > LocalPurchaseOrder.PurchaseOrder.DerivedForegroundLimit)
							LocalUseBatchRelease = true

						if (LocalUseBatchRelease)
							invoke TransitionToCreateInProgress LocalPurchaseOrder.PurchaseOrder
							invoke CopyPurchaseOrderLineSet PurchaseOrderLine in background
								assign async action request id to AsyncId
								invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
								invoked.PrmCompany 							= PrmCompany
								invoked.PrmPurchaseOrder  					= LocalPurchaseOrder.PurchaseOrder
								invoked.PrmCopyUnitCost						= PrmCopyUnitCost
								invoked.PrmCopyIgnoreCancelQuantity			= PrmCopyIgnoreCancelQuantity
								invoked.PrmCopyComments						= PrmCopyComments
								invoked.PrmCopyTaxData						= PrmCopyTaxData
								invoked.PrmCopyAddOnCosts					= PrmCopyAddOnCosts
								invoked.PrmNewDefaultTaxCode				= PrmNewDefaultTaxCode
								invoked.PrmBuyer							= PrmBuyer
								invoked.PrmVendor							= PrmVendor
								invoked.PrmPurchaseFromLocation				= PrmPurchaseFromLocation
								invoked.PrmCopyDistributions				= PrmCopyDistributions
								invoked.PrmUsePOVendor        				= PrmUsePOVendor
								invoked.PrmUsePOPurchaseFromLocation        = PrmUsePOPurchaseFromLocation
								invoked.PrmShipToLocation					= PrmShipToLocation
								invoked.PrmSourceDocument					= PrmSourceDocument
								invoked.PrmNewRequestingLocation 			= PrmNewRequestingLocation
								invoked.PrmRequester						= PrmRequester
								invoked.PrmPurchaseOrderDate				= PrmPurchaseOrderDate
								initialize invoked.PrmIsReleased
							if (PrmCopyComments
							and PrmCopyFromPurchaseOrder.HasLineComments)
								invoke BatchCopyPurchaseOrderLineComment PurchaseOrderLineComment in background
									run after AsyncId
									assign async action request id to AsyncId
									invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
									invoked.PrmCompany 							= PrmCompany
									invoked.PrmPurchaseOrder					= LocalPurchaseOrder.PurchaseOrder
									invoked.PrmCopyIgnoreCancelQuantity			= PrmCopyIgnoreCancelQuantity
							if (PrmCopyAddOnCosts
							and PrmCopyFromPurchaseOrder.PurchaseOrderLineAddOnChargesRel exist)
								invoke BatchCopyPurchaseOrderLineAddOnCharge PurchaseOrderAndLineAddOnCharge in background
									run after AsyncId
									assign async action request id to AsyncId
									invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
									invoked.PrmCompany							= PrmCompany
									invoked.PrmPurchaseOrder					= LocalPurchaseOrder.PurchaseOrder
									invoked.PrmShipToLocation					= PrmShipToLocation
									invoked.PrmCopyIgnoreCancelQuantity			= PrmCopyIgnoreCancelQuantity
							if (PrmCopyDistributions
							and PrmCopyFromPurchaseOrder.DistributionExists)
								invoke BatchCopyPurchaseOrderLineDistribution PurchaseOrderLineDistribution in background
									run after AsyncId
									assign async action request id to AsyncId
									invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
									invoked.PrmCompany							= PrmCompany
									invoked.PrmPurchaseOrder					= LocalPurchaseOrder.PurchaseOrder
									invoked.PrmTransactionDate					= PrmCopyFromPurchaseOrder.PurchaseOrderDate
									invoked.PrmCopyIgnoreCancelQuantity			= PrmCopyIgnoreCancelQuantity
							if (PrmCopySourceRecords
							and PrmCopyFromPurchaseOrder.HasLineSource)
								invoke BatchCopyPurchaseOrderLineSource PurchaseOrderLineSource in background
									run after AsyncId
									assign async action request id to AsyncId
									invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
									invoked.PrmCompany							= PrmCompany
									invoked.PrmPurchaseOrder					= LocalPurchaseOrder.PurchaseOrder

							if (PrmCopyAddOnCosts)
								if (PrmCopyFromPurchaseOrder.PurchaseOrderSpreadAddOnCharge set exists)
									invoke BatchCopySpreadAddOnCharge PurchaseOrderSpreadAddOnCharge in background
										run after AsyncId
										assign async action request id to AsyncId
										invoked.PrmCopyFromPurchaseOrder		= PrmCopyFromPurchaseOrder
										invoked.PrmCompany						= PrmCompany
										invoked.PrmPurchaseOrder				= LocalPurchaseOrder.PurchaseOrder

								if (PrmCopyFromPurchaseOrder.PurchaseOrderAddOnChargesRel exists)
									invoke BatchCopyPurchaseOrderAddOnCharge PurchaseOrderAndLineAddOnCharge in background
										run after AsyncId
										assign async action request id to AsyncId
										invoked.PrmCopyFromPurchaseOrder		= PrmCopyFromPurchaseOrder
										invoked.PrmCompany						= PrmCompany
										invoked.PrmPurchaseOrder				= LocalPurchaseOrder.PurchaseOrder
										invoked.PrmShipToLocation				= PrmShipToLocation

							invoke TransitionToUnreleased LocalPurchaseOrder.PurchaseOrder in background
								run after AsyncId
								assign async action request id to AsyncId

							if (PrmIsReleased)
								invoke Unreleased.Release in background
									run after AsyncId

						else
							invoke CopyPurchaseOrderLineSet PurchaseOrderLine in foreground
								invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
								invoked.PrmCompany 							= PrmCompany
								invoked.PrmPurchaseOrder  					= LocalPurchaseOrder.PurchaseOrder
								invoked.PrmCopyUnitCost						= PrmCopyUnitCost
								invoked.PrmCopyIgnoreCancelQuantity			= PrmCopyIgnoreCancelQuantity
								invoked.PrmCopyComments						= PrmCopyComments
								invoked.PrmCopyTaxData						= PrmCopyTaxData
								invoked.PrmCopyAddOnCosts					= PrmCopyAddOnCosts
								invoked.PrmNewDefaultTaxCode				= PrmNewDefaultTaxCode
								invoked.PrmBuyer							= PrmBuyer
								invoked.PrmVendor							= PrmVendor
								invoked.PrmPurchaseFromLocation				= PrmPurchaseFromLocation
								invoked.PrmCopyDistributions				= PrmCopyDistributions
								invoked.PrmUsePOVendor        				= PrmUsePOVendor
								invoked.PrmUsePOPurchaseFromLocation        = PrmUsePOPurchaseFromLocation
								invoked.PrmShipToLocation					= PrmShipToLocation
								invoked.PrmSourceDocument					= PrmSourceDocument
								invoked.PrmNewRequestingLocation 			= PrmNewRequestingLocation
								invoked.PrmRequester						= PrmRequester
								invoked.PrmPurchaseOrderDate				= PrmPurchaseOrderDate
								initialize invoked.PrmIsReleased
							if (PrmCopyComments
							and PrmCopyFromPurchaseOrder.HasLineComments)
								invoke BatchCopyPurchaseOrderLineComment PurchaseOrderLineComment in foreground
									invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
									invoked.PrmCompany 							= PrmCompany
									invoked.PrmPurchaseOrder					= LocalPurchaseOrder.PurchaseOrder
									invoked.PrmCopyIgnoreCancelQuantity			= PrmCopyIgnoreCancelQuantity
							if (PrmCopyAddOnCosts
							and PrmCopyFromPurchaseOrder.PurchaseOrderLineAddOnChargesRel exist)
								invoke BatchCopyPurchaseOrderLineAddOnCharge PurchaseOrderAndLineAddOnCharge in foreground
									invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
									invoked.PrmCompany							= PrmCompany
									invoked.PrmPurchaseOrder					= LocalPurchaseOrder.PurchaseOrder
									invoked.PrmShipToLocation					= PrmShipToLocation
									invoked.PrmCopyIgnoreCancelQuantity			= PrmCopyIgnoreCancelQuantity
							if (PrmCopyDistributions
							and PrmCopyFromPurchaseOrder.DistributionExists)
								invoke BatchCopyPurchaseOrderLineDistribution PurchaseOrderLineDistribution in foreground
									invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
									invoked.PrmCompany							= PrmCompany
									invoked.PrmPurchaseOrder					= LocalPurchaseOrder.PurchaseOrder
									invoked.PrmTransactionDate					= PrmCopyFromPurchaseOrder.PurchaseOrderDate
									invoked.PrmCopyIgnoreCancelQuantity			= PrmCopyIgnoreCancelQuantity
							if (PrmCopySourceRecords
							and PrmCopyFromPurchaseOrder.HasLineSource)
								invoke BatchCopyPurchaseOrderLineSource PurchaseOrderLineSource in foreground
									invoked.PrmCopyFromPurchaseOrder			= PrmCopyFromPurchaseOrder
									invoked.PrmCompany							= PrmCompany
									invoked.PrmPurchaseOrder					= LocalPurchaseOrder.PurchaseOrder

							if (PrmCopyAddOnCosts)
								if (PrmCopyFromPurchaseOrder.PurchaseOrderSpreadAddOnCharge set exists)
									invoke BatchCopySpreadAddOnCharge PurchaseOrderSpreadAddOnCharge in foreground
										invoked.PrmCopyFromPurchaseOrder		= PrmCopyFromPurchaseOrder
										invoked.PrmCompany						= PrmCompany
										invoked.PrmPurchaseOrder				= LocalPurchaseOrder.PurchaseOrder

								if (PrmCopyFromPurchaseOrder.PurchaseOrderAddOnChargesRel exists)
									invoke BatchCopyPurchaseOrderAddOnCharge PurchaseOrderAndLineAddOnCharge in foreground
										invoked.PrmCopyFromPurchaseOrder		= PrmCopyFromPurchaseOrder
										invoked.PrmCompany						= PrmCompany
										invoked.PrmPurchaseOrder				= LocalPurchaseOrder.PurchaseOrder
										invoked.PrmShipToLocation				= PrmShipToLocation

							invoke TransitionToUnreleased LocalPurchaseOrder.PurchaseOrder in foreground

							if (PrmIsReleased)
								invoke Unreleased.Release in foreground

				Update is an Update Action
					valid when 	(ValidForCreateUpdate)
					completion message is "<UpdateCompletionMessage>"
					Field Rules
						Company
							constraint (not Closed.Yes
							or 			Company.ReopenPurchaseOrder)
								"CompanyDoesNotAllowChangesToAClosedPurchaseOrder" 

							constraint (not Closed.Historical
							or			Company.ReopenPurchaseOrder)
								"HistoricalPurchaseOrdersCannotBeReopenedAndChanged" 

						Vendor
							if (Vendor changed
							and LinesWithContractRel exists)
								confirmation required
									"ChangingTheVendorWillRedefaultLineContracts.Continue?"
					
					Entrance Rules
						include InventoryLocationStatusValidation
							
					Action Rules
						constraint (not Closed.Historical)
							"HistoricalPO'sCannotBeReopenedAndChanged" 

						constraint (not Canceled)
							"CannotChange;POHasBeenCanceled" 

						if(DefaultSourceInformation.DefaultRequestingLocation entered and DefaultSourceInformation.DefaultOperatingCompany entered)
							constraint (RequestingLocationRel exists)
								"InvalidRequestingLocation<DefaultSourceInformation.DefaultRequestingLocation>"

						if (VendorReturn exists
						and HasNoLines)
							constraint (VendorReturn.ShippedStatus)
								"CannotChangeVendorReturnPurchaseOrderUntilTheVendorReturnIsShipped"

						constraint (DefaultEAMWorkOrder not entered
						or			ShipToLocation.EAMLocation.EAMLocation)
							"E\A\M\_WorkOrderNumberisInvalidForThisLocation" 



						IntrastatProcessing.TaxEntity			    = Company.AccountingEntity
						IntrastatProcessing.PurchaseOrder			= PurchaseOrder
						IntrastatProcessing.Vendor					= Vendor
						IntrastatProcessing.DeliveryTerms			= ShipTerm
						IntrastatProcessing.SystemCode				= "PO"
						IntrastatProcessing.DestinationCountry		= ShipToLocation.PostalAddressForPurchaseOrder.Country
						IntrastatProcessing.DestinationRegion		= ShipToLocation.PostalAddressForPurchaseOrder.Region
						if (PurchaseFromLocation entered)
							IntrastatProcessing.OriginCountry		= PurchaseFromLocation.VendorAddress.Country
							IntrastatProcessing.OriginRegion		= PurchaseFromLocation.VendorAddress.Region
						else
							IntrastatProcessing.OriginCountry		= Vendor.VendorAddress.Country
							IntrastatProcessing.OriginRegion		= Vendor.VendorAddress.Region

						LocalTrigger			= IntrastatProcessing.CheckCountries
						if (IntrastatProcessing.DoIntrastatReporting)
							if (UnloadingPort not entered)
								if (PurchaseFromLocationRel exists)
									UnloadingPort	= PurchaseFromLocationRel.UnloadingPort
								else
									UnloadingPort	= PurchasingVendorRel.UnloadingPort
							constraint (NatureOfTransactionCode entered)
								"NatureOfTransactionRequiredForIntrastatVendors" 

						if (StandardCommentCode entered)
							if (StandardCommentCode.StandardCommentPrintCode.NamedPlaceIncoterm)
								if (PurchaseOrderIncotermRel not exists)
									include CreateCommentFromCommentCode
								else
									initialize StandardCommentCode
									constraint (PurchaseOrderIncotermRel not exists)
										"CannotHaveMultipleIncotermComments"
							else
								include CreateCommentFromCommentCode

					Exit Rules
						if (DisplayOfProcedureInfo)
							include CheckPHIProcedureInformation
						include UpdateExitRules

				Delete is an Instance Action
					valid when (AllowDelete)
					completion message is "<DeleteInProgressCompletionMessage>"
					Entrance Rules
						confirmation required
							"AreYouSureYouWantToPerformTheFollowingAction:_\Delete?"
						LocalFromUnreleased = true
						include DeletePurchaseOrderLine
														
				Release is an Instance Action
					completion message is "<ReleaseMessage>"
					valid when (IsUpdateAllowed)
					
					Local Fields
						LocalContract				is a Contract
						LocalOrderAmount			is an InternationalAmount
						LocalAvailableAmount		is an UnsignedInternationalAmount
						LocalTotalAmountPerContract	is an UnsignedInternationalAmount
						LocalCheckCountries			is Alpha size 1
						LocalFESEnabled				is Boolean 
						TransactionError			is Boolean
						TransactionErrorMessage		is Alpha 300
						FESFundingSourceTable
						FESCounter					is Numeric 4

					Action Rules
						constraint (PurchaseOrderLine set exist)
							"PurchaseOrderMustHaveAtLeastOneLine"									

						if (Company.RequireProcessLevel)
							constraint (ProcessLevel entered)
								"ProcessLevelIsRequired"

						if (UseProcurementCard)
							constraint (ProcurementCardNumber entered)
								"CannotRelease,NoProcurementCardNumberEntered"

						constraint (TotalTaxAmount >= 0)
							"CannotRelease,PurchaseOrderTaxTotalIsNegative"							

						if (TaxEntityRel.ThirdParty.TaxEngine)
							constraint (GlobalDocumentType entered)
								"CannotRelease,NoGlobalDocumentTypeEntered"	

						if (PurchaseOrderApprovalType.MatrixLineDistribution
						and !FromStanding
						and !FromRequisitions)
							constraint (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.EnableResponsibilityMatrix)
								"CannotUse_Responsibility_MatrixApprovalsWhenThe_Finance_Enterprise_GroupDoesNotHaveThe_Responsibility_MatrixTurnedOn._PleaseContactYourSystemAdministratorForFurtherAssistance."

						if (Company.AccountingEntity.TaxEntity.IntrastatUsed)
							IntrastatProcessing.TaxEntity			    = Company.AccountingEntity
							IntrastatProcessing.PurchaseOrder			= PurchaseOrder
							IntrastatProcessing.Vendor					= Vendor
							IntrastatProcessing.DeliveryTerms			= ShipTerm
							IntrastatProcessing.SystemCode				= "PO"
							IntrastatProcessing.DestinationCountry		= ShipToLocation.PostalAddressForPurchaseOrder.Country
							IntrastatProcessing.DestinationRegion		= ShipToLocation.PostalAddressForPurchaseOrder.Region
							if (PurchaseFromLocation entered)
								IntrastatProcessing.OriginCountry		= PurchaseFromLocation.VendorAddress.Country
								IntrastatProcessing.OriginRegion		= PurchaseFromLocation.VendorAddress.Region
							else
								IntrastatProcessing.OriginCountry		= Vendor.VendorAddress.Country
								IntrastatProcessing.OriginRegion		= Vendor.VendorAddress.Region

							LocalCheckCountries							= IntrastatProcessing.CheckCountries

							if (IntrastatProcessing.DoIntrastatReporting)
								if (UnloadingPort not entered)
									if (PurchaseFromLocationRel exists)
										UnloadingPort	= PurchaseFromLocationRel.UnloadingPort
									else
										UnloadingPort	= PurchasingVendorRel.UnloadingPort
								constraint (NatureOfTransactionCode entered)
									"CannotRelease,NatureOfTransactionCodeIsRequired"

						include ReleaseLimitsValidation
						if (not IsAllowedToReleaseOverLimits)
							constraint (PurchaseOrderReleaseMessages not entered)
								"<PurchaseOrderReleaseMessages>"
						else
							if (PurchaseOrderReleaseMessages entered)
								confirmation required
									"<PurchaseOrderReleaseMessages>.\Continue?"

						if (PurchaseOrderLinesByContractRel exists)
							for each PurchaseOrderLinesByContractRel
								if  (LocalContract not entered
								or  (LocalContract entered
								and  LocalContract != each.Contract))

									constraint (LocalOrderAmount not entered
									or          LocalContract.PerOrderMinimumAmount not entered
									or          LocalOrderAmount > LocalContract.PerOrderMinimumAmount)
										"PurchaseOrderLessThanContract<LocalContract>PerOrderMinimumAmount"

									initialize LocalOrderAmount
									LocalContract 					= each.Contract
									LocalAvailableAmount 			= each.Contract.PerOrderMaximumAmount

								if (LocalContract = each.Contract)
									if (each.ContractHasPerOrderMaximumAmount)
										LocalAvailableAmount -= each.ExtendedAmount
										constraint (LocalAvailableAmount >= 0)
											"PurchaseOrderExceedsContract<LocalContract>PerOrderMaximumAmount"

									if (each.ContractHasPerOrderMinimumAmount)
										LocalOrderAmount			+= each.ExtendedAmount

							constraint (LocalOrderAmount not entered
							or          LocalContract.PerOrderMinimumAmount not entered
							or          LocalOrderAmount >= LocalContract.PerOrderMinimumAmount)
								"PurchaseOrderLessThanContract<LocalContract>PerOrderMinimumAmount"

						if (PurchaseOrderLinesByContractUnreleasedRel exists)
							for each PurchaseOrderLinesByContractUnreleasedRel
								LinePreviouslyReleased = false
								if (each.Contract.MaximumAmount > 0)
									LinePreviouslyReleased = each.PreviouslyReleased 
									if (each.Contract.LifetimeEdit = 2
									or  !each.FromRequisitions
									or (each.Contract.LifetimeEdit = 1
									and each.FromRequisitions
									and (LinePreviouslyReleased
									or  each.LineSourcesFromRQRel.RequisitionLineRel.ApprovalValue < each.ContractLineMaxEditValue)))
										if  (LocalContract not entered
										or  (LocalContract entered
										and  LocalContract != each.Contract))

											LocalContract 					= each.Contract

										if (LocalContract = each.Contract)
											if (each.Contract.LifetimeEdit = 1
											and each.FromRequisitions
											and each.LineSourcesFromRQRel.RequisitionLineRel.ApprovalValue < each.ContractLineMaxEditValue
											and LinePreviouslyReleased = false)
												LocalContractMaxEditValue = (each.ContractLineMaxEditValue - each.LineSourcesFromRQRel.RequisitionLineRel.ApprovalValue)
											else 
												LocalContractMaxEditValue = each.ContractLineMaxEditValue
											if (each.Contract.CurrencyCode != PurchaseOrder.Currency)
												initialize CurrencyExchange
												SavedFromCurrency						= PurchaseOrder.Currency
												CurrencyExchange.ToCurrency				= each.Contract.CurrencyCode
												SavedExchangeDate						= PurchaseOrder.PurchaseOrderDate
												SavedTransactionAmount					= LocalContractMaxEditValue
												CurrencyExchange.EnteredCurrencyRate    = PurchaseOrder.EnteredCurrencyConversionRate
												LocalContractExtendedAmount 			= CurrencyExchange.OutputCurrencyAmount
											else
												LocalContractExtendedAmount = LocalContractMaxEditValue
											LocalTotalAmountPerContract		+= LocalContractExtendedAmount
											constraint (LocalTotalAmountPerContract <= each.Contract.AmountRemaining)
												"PurchaseOrderAmountOf<LocalTotalAmountPerContract>ForContract<each.Contract>ExceedsMaximumAmountRemaining<each.Contract.AmountRemaining>ForThisContract"

						if (TaxEntityRel.ThirdParty.Sabrix
						and TaxEntityRel.DelayTaxProcessing)
							for each PurchaseOrderAddOnChargesRel
								invoke CalculateOneSourceLandedUnitCost each

						LocalFESEnabled = GeneralLedgerCompanyRel.FinanceEnterpriseGroup.FrontEndSplits
						for each UnreleasedPurchaseOrderLinesRel
							if (IntrastatProcessing.DoIntrastatReporting)
								constraint (each.ICNCode entered)
									"CannotRelease,MissingICNCodeForLine<each.LineNumber>"
							invoke Unreleased.EditRelease each

							if(LocalFESEnabled)
								invoke Unreleased.FrontEndSplitDistributions each
									resume on error
										TransactionError		= true
										TransactionErrorMessage	= error message
								constraint(not TransactionError)
									"POFES:\Front_\End_\Split<TransactionErrorMessage>"

						if (LocalFESEnabled
						and GeneralLedgerCompanyRel.FinanceEnterpriseGroup.UseFundedAmounts
						and !LocalCancelRemainingPurchaseOrder)
							for each PurchaseOrderLineDistributionsRel
								if (each.DistributionAccount.Project entered
								and each.DistributionAccount.FinanceDimension2 entered
								and each.ProjectFundingSourceRel exists
								and each.UncommittedProjectAmount entered
								and (each.PurchaseOrderLine.PurchaseOrderLineLifeCycleState.Unreleased
								or  each.PurchaseOrderLine.PurchaseOrderLineLifeCycleState.Released))
									FESCounter = 1
									while (FESCounter < 1000)
										if (FESFundingSourceTable.FESFundingSource[FESCounter] not entered)
											FESFundingSourceTable.FESFundingSource[FESCounter].ProjectContract   = each.ProjectFundingSourceRel.ProjectContract
											FESFundingSourceTable.FESFundingSource[FESCounter].FinanceDimension2 = each.ProjectFundingSourceRel.FinanceDimension2
											FESFundingSourceTable.FESFundingSource[FESCounter].RemainingAmount	 = each.ProjectFundingSourceRel.RemainingFESAmount - each.UncommittedProjectAmount
											FESCounter = 1000
										else
										if (FESFundingSourceTable.FESFundingSource[FESCounter].ProjectContract   = each.ProjectFundingSourceRel.ProjectContract
										and	FESFundingSourceTable.FESFundingSource[FESCounter].FinanceDimension2 = each.ProjectFundingSourceRel.FinanceDimension2)
											FESFundingSourceTable.FESFundingSource[FESCounter].RemainingAmount  -= each.UncommittedProjectAmount
											FESCounter = 1000
										else
											FESCounter += 1
							FESCounter = 1
							while (FESCounter < 1000)
								if (FESFundingSourceTable.FESFundingSource[FESCounter] not entered)
									FESCounter = 1000
								else
									constraint (FESFundingSourceTable.FESFundingSource[FESCounter].RemainingAmount >= 0)
										"POFES:\Front_\End_\SplitAmountExceedsRemainingFundedAmountFor<FESFundingSourceTable.FESFundingSource[FESCounter].FinanceDimension2>"
								FESCounter += 1



						if  (GeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
						and  CommitmentsExist)

			 				if (!TransientFromMassPOCreateAndRelease)
			 					invoke Delete HeaderBudgetEditErrorRel
								invoke Delete DistributionBudgetEditErrorRel
			 				BudgetEditProcessing = 1
			 				make transition to ReleaseInProgress
							invoke EditTotalsRoute BudgetTemplateGroupTotal
								invoked.PrmFinanceEnterpriseGroup    											= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
								invoked.PrmBudgetEditGroup           											= UniqueID
								invoked.PrmBudgetEditCallBack.BudgetEditCallBackPurchaseOrder.PurchasingCompany	= Company
								invoked.PrmBudgetEditCallBack.BudgetEditCallBackPurchaseOrder.PurchaseOrder		= PurchaseOrder
								if (TransientFromMassPOCreateAndRelease)
									invoked.PrmIsBatch 															= true
								invoked.PrmBusinessClassName                									= "PurchaseOrder"
								invoked.PrmEditContext                      									= "Release"
						else
						if  (GeneralLedgerSystemCodeRel.EncumbranceOption.Track)
							if (!TransientFromMassPOCreateAndRelease)

				 				invoke Delete HeaderBudgetEditErrorRel
								invoke Delete DistributionBudgetEditErrorRel
							BudgetEditProcessing = 3
							invoke EditTotalsRoute BudgetTemplateGroupTotal
								invoked.PrmFinanceEnterpriseGroup    											= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
								invoked.PrmBudgetEditGroup           											= UniqueID
								invoked.PrmMode																	= BudgetEditMode.UpdateOnly
								if (TransientFromMassPOCreateAndRelease)
									invoked.PrmIsBatch 															= true
								invoked.PrmBusinessClassName                									= "PurchaseOrder"
								invoked.PrmEditContext                      									= "Release"
							invoke FinalRelease
						else
							invoke FinalRelease

				MatchUpdate is an Instance Action
					restricted
					Parameters
						LinesClosed	is Numeric 2
						Amount is like InternationalAmount
					Action Rules
						NumberOfClosedLines	-= LinesClosed
						OpenPurchaseAmount	-= Amount

			Released is a State
				Entrance Rules
					if  (PurchaseOrderApprovalType.ApprovalRequired
					and  Closed not changed
					and  not LocalCancelRemainingPurchaseOrder)
						ApprovalStatus = ApprovalStatus.NeedsApproval
						initiate PurchaseOrderApproval process
							title is "ApprovalRequest.PurchaseOrder<PurchaseOrder>|Vendor:<Vendor.VendorName>|Total:<CalculateTotalAmount>_<Currency>"
							Variables
								Company
								PurchaseOrder
							URLs
								"<linkback(webapp is Approver navigation is PFIViewPO text is \"ViewPurchaseOrder\")>"
					else
					if (PurchaseOrderApprovalType.MatrixLineDistribution
					and !FromStanding
					and !FromRequisitions)
						ApprovalStatus = ApprovalStatus.NeedsApproval
						for each PurchaseOrderLineLineDistributionsRel
							invoke UpdateFast each
								invoked.DistributionAggregation = blank
						if (PODistributionAggregationRel exists)
							invoke Purge PODistributionAggregationRel
						for each PurchaseOrderLineLineDistributionsRel
							invoke CalculateDistributionAggregation each
						for each PODistributionAggregationRel 
							invoke SubmitForApproval each

					if (GeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
					or  GeneralLedgerSystemCodeRel.EncumbranceOption.Track)
						LocalExecute = false 
						for each PurchaseOrderLineRel
							if (each.PreviouslyReleased)
								LocalExecute = true 
								end for each 

						if (LocalExecute) 

							for each UnmatchedMatchPurchaseOrderInvoicesRel 
								for each each.PayablesInvoice.BudgetTemplateGroupTotalRel 

									invoke Delete each 

								invoke Delete each.PayablesInvoice.HeaderBudgetEditErrorRel
								invoke Delete each.PayablesInvoice.DistributionBudgetEditErrorRel

								for each each.PayablesInvoice.PayablesInvoiceDetailRel 
									if (!each.ItemType.Inventoried)
										invoke RecalculateUnreleasedObligations each

								for each each.PayablesInvoice.DistributionTypeIsDistributionRel 
									if (!each.IsNonLandedTaxDistribution)
										invoke RecreateBudgetTemplateGroupTotals each.GLCommitRel 
										invoke PerformBudgetEdit each
											invoked.PrmActionType = "C"


				Approve is an Instance Action
					restricted
					Action Rules
						ApprovalStatus = ApprovalStatus.Approved
						Approved = true
						Rejected = false

						if (PurchaseOrderApprovalType.MatrixLineDistribution)
							send email
								to PurchaseOrder.Buyer.EmployeeWorkEmailAddress
								from config.DefaultFromEmailAddress
								subject "PurchaseOrder<PurchaseOrder>HasBeenApproved"
								Contents
									"PurchaseOrder<PurchaseOrder>ForCompany<Company.Name>AndVendor<Vendor><Vendor.VendorName>HasBeenApproved"

				Reject is an Instance Action
					restricted
					Action Rules
						Rejected = true

						invoke CancelPurchaseOrder

				Unrelease is an Instance Action
					restricted
					Action Rules
						invoke ManualAndPFIUnrelease

				ManualApprove is an Instance Action
					valid when (IsNeedsApproval)
					Action Rules
						ApprovalStatus = ApprovalStatus.Approved
						Approved = true
						Rejected = false

						if (!PurchaseOrderApprovalType.MatrixLineDistribution)
							cancel PurchaseOrderApproval process

						if (PurchaseOrderApprovalType.MatrixLineDistribution)
							for each PODistributionAggregationRel
								invoke ManualApprove each
							send email
								to PurchaseOrder.Buyer.EmployeeWorkEmailAddress
								from config.DefaultFromEmailAddress
								subject "PurchaseOrder<PurchaseOrder>HasBeenApproved"
								Contents
									"PurchaseOrder<PurchaseOrder>ForCompany<Company.Name>AndVendor<Vendor><Vendor.VendorName>HasBeenApproved"


				ManualReject is an Instance Action
					valid when (NeedsNonMatrixApproval) 
					Action Rules
						Rejected = true

						invoke CancelPurchaseOrder
						cancel PurchaseOrderApproval process


				MatrixManualReject is an Instance Action
					default label is "ManualReject"
					valid when (NeedsMatrixApproval)
					subject is RejectPurchaseOrder
					reason code required
					action comment required
					Action Rules
						Rejected = true

						invoke CancelPurchaseOrder

						for each PODistributionAggregationRel
							invoke ManualReject each
								invoked.PrmActionReason		= reason code
								invoked.PrmComment			= action comment

						send email
							to PurchaseOrder.Buyer.EmployeeWorkEmailAddress
							from config.DefaultFromEmailAddress
							subject "PurchaseOrderHasBeenRejected"
							Contents
								"PurchaseOrder<PurchaseOrder>ForCompany<Company.Name>AndVendor<Vendor><Vendor.VendorName>HasBeen_Rejected"
								"PleaseTakeAppropriateAction"
								"_"
								"ReasonCode:<reason code>"
								"ReasonComment:<action comment>"
								"_"
								"ThankYou"

				ManualUnrelease is an Instance Action
					valid when (NeedsNonMatrixApproval) 
					Action Rules
						invoke ManualAndPFIUnrelease

				MatrixManualUnrelease is an Instance Action
					default label is "ManualUnrelease"
					valid when (NeedsMatrixApproval)
					subject is UnreleasePurchaseOrder
					reason code required
					action comment required
					Action Rules
						for each PODistributionAggregationRel
							invoke ManualUnrelease each
								invoked.PrmActionReason		= reason code
								invoked.PrmComment			= action comment

						send email
							to PurchaseOrder.Buyer.EmployeeWorkEmailAddress
							from config.DefaultFromEmailAddress
							subject "PurchaseOrderHasBeenUnreleased"
							Contents
								"PurchaseOrder<PurchaseOrder>ForCompany<Company.Name>AndVendor<Vendor><Vendor.VendorName>HasBeen_Unreleased"
								"PleaseTakeAppropriateAction"
								"_"
								"ReasonCode:<reason code>"
								"ReasonComment:<action comment>"
								"_"
								"ThankYou"

						invoke ManualAndPFIUnrelease

				ManualAndPFIUnrelease is an Instance Action
					restricted

					Action Rules
						if (NeedsNonMatrixApproval) 
							cancel PurchaseOrderApproval process

						if (LocalUpdatedFromLine
						and NeedsMatrixApproval)
							for each PODistributionAggregationRel
								invoke CancelApproval each

						include UnreleasePurchaseOrder

				InvokeCancelPurchaseOrder is an Instance Action	
					restricted
					Parameters
						PrmOriginatingInterfaceRun	is a PurchaseOrderInterfaceResult  
					Action Rules
						OriginatingInterfaceRun 	= PrmOriginatingInterfaceRun
						invoke CancelPurchaseOrder

				CancelPurchaseOrder is an Instance Action
					valid when (PurchaseOrderEligibleToBeCancelled)
					Action Rules
						invoke Released.PerformCancelPurchaseOrder
						if (VendorReturn entered
						and not VendorReturn.VendorClaimType.CreditMemo)
							invoke CancelVendorReturn VendorReturn
								invoked.PrmIsCancelFromPO	= true
						if (NeedsNonMatrixApproval and not Rejected) 
							cancel PurchaseOrderApproval process
						else
						if (NeedsMatrixApproval and not Rejected)
							for each PODistributionAggregationRel
								invoke CancelApproval each
						initialize ApprovalStatus

				PerformCancelPurchaseOrder is an Instance Action
					restricted
					Local Fields
						LocalNumberOfLinesToProcess is like NumberOfLines
					Action Rules
						if (not LocalFromVendorReturn)
							confirmation required
								"PurchaseOrderWillBeCanceled.Continue?"
						constraint (UnreleasedPurchaseOrderReceiptsRel not exists)
							"<DerivedUnreleasedPurchaseOrderReceiptErrorMessge>"    								
						constraint (UnmatchedMatchPurchaseOrderInvoicesRel not exists)
							"CannotCancelPurchaseOrderWhenUnmatchedPurchaseOrderInvoicesExist"						

						if (Issued)
							invoke CreatePurchaseOrderRevision

						LastActivityDate				= current corporate date
						Canceled						= true


							if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger)
								ActionCode = ActionCode.Delete
								increment bod id.VariationID
								include TriggerPurchaseOrderRules

								include TriggerProcessPurchaseOrderRules
								include TriggerBRPurchaseOrder



						if (BudgetEditingInformationExists)
							if (GeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
							or  GeneralLedgerSystemCodeRel.EncumbranceOption.Track)
								invoke EditTotalsRoute BudgetTemplateGroupTotal
									invoked.PrmFinanceEnterpriseGroup    											= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
									invoked.PrmBudgetEditGroup           											= UniqueID
									invoked.PrmMode																	= BudgetEditMode.UpdateOnly
									invoked.PrmBusinessClassName                									= "PurchaseOrder"
									invoked.PrmEditContext                      									= "Cancel"
					Exit Rules
						LocalCancelFromPO = true
						for each PurchaseOrderAddOnChargeForCancelRel 
							invoke CancelPurchaseOrderAddOnCharge each

						LocalNumberOfLinesToProcess = instance count of PurchaseOrderLinesToProcessRel
						if (LocalNumberOfLinesToProcess > DerivedForegroundLimit)

							make transition to CancelInProgress

							invoke BatchCancelPurchaseOrderLine PurchaseOrderLine in background
								invoked.PrmCompany					= Company
								invoked.PrmPurchaseOrder			= PurchaseOrder
								invoked.PrmCancelFromPurchaseOrder	= true
								invoked.PrmFromVendorReturn			= LocalFromVendorReturn
						else
							invoke BatchCancelPurchaseOrderLine PurchaseOrderLine in foreground
								invoked.PrmCompany					= Company
								invoked.PrmPurchaseOrder			= PurchaseOrder
								invoked.PrmCancelFromPurchaseOrder	= true
								invoked.PrmFromVendorReturn			= LocalFromVendorReturn

				CancelRemainingPurchaseOrder is an Instance Action
					valid when (PurchaseOrderEligibleForCancelRemaining)
					Action Rules
						LocalCancelRemainingPurchaseOrder = true
						confirmation required
							"AllRemainingLinesWillBeCanceled.Continue?"

						constraint (UnreleasedPurchaseOrderReceiptsRel not exists)
							"<DerivedUnreleasedPurchaseOrderReceiptErrorMessge>"
						constraint (UnmatchedMatchPurchaseOrderInvoicesRel not exists)
							"CannotCancelPurchaseOrderWhenUnmatchedPurchaseOrderInvoicesExist"

						for each ReleasedPurchaseOrderLinesRel
							invoke Released.CancelLineRemaining each
								invoked.CancelFromPurchaseOrder = true




						LastActivityDate				= current corporate date


						if (PurchaseOrderLifeCycleState.Released)
							if (Issued)
								invoke Released.Update PurchaseOrder
							else
								invoke Released.Unrelease PurchaseOrder

						if (PurchaseOrderLifeCycleState.Unreleased)
							invoke Unreleased.Release PurchaseOrder


				Update is an Update Action
					completion message is "<UpdateCompletionMessage>"
					Entrance Rules
						include InventoryLocationStatusValidation
					Action Rules
						constraint (!IsOnHold)
							"CannotUpdate\;SentForApproval"
						if (Vendor changed
						and LinesWithContractRel exists)
							confirmation required
								"ChangingTheVendorWillRedefaultLineContracts.Continue?"

						constraint (not Closed.Historical)
							"HistoricalP\O'sCannotBeReopenedAndChanged" 

						constraint (not Canceled)
							"CannotChange;P\OHasBeenCanceled" 

						if (PurchaseOrderApprovalType.ApprovalRequired)
							constraint (Approved
							or          not IsSubcontractorPurchaseOrder)
								"CannotUpdateSubcontractorPurchaseOrderUntilItGoesThroughApproval" 

						if (StandardCommentCode entered)
							if (StandardCommentCode.StandardCommentPrintCode.NamedPlaceIncoterm)
								if (PurchaseOrderIncotermRel not exists)
									include CreateCommentFromCommentCode
								else
									initialize StandardCommentCode
									constraint (PurchaseOrderIncotermRel not exists)
										"CannotHaveMultipleIncotermComments"
							else
								include CreateCommentFromCommentCode

						include UpdateRevisions

					Exit Rules
						if (DisplayOfProcedureInfo)
							include CheckPHIProcedureInformation
						include UpdateExitRules
						if (PurchaseOrderLifeCycleState.Released)
							invoke Released.Unrelease

				Delete is an Instance Action
					valid when (AllowDelete)
					completion message is "<DeleteInProgressCompletionMessage>"
					Entrance Rules
						confirmation required
							"AreYouSureYouWantToPerformTheFollowingAction:_\Delete?"
 						LocalOpenPurchaseAmount = OpenPurchaseAmount * -1
						include UpdateVendorOpenPurchaseAmount

 						include DeletePurchaseOrderLine

				MatchUpdate is an Instance Action  
					restricted
					Parameters
						LinesClosed	is Numeric 2
						Amount is like InternationalAmount
					Action Rules
						NumberOfClosedLines			-= LinesClosed
						OpenPurchaseAmount			-= Amount

				IssueFinalBatch is an Instance Action
					restricted
					Parameters
						PrmIDMBatchID is an IDMPID
					Action Rules
						LocalFromBatch = true
						LocalIDMBatchID	= PrmIDMBatchID
						invoke IssueFinal

				IssueFinal is an Instance Action
					valid when (ValidForIssueFinal)
					completion message is "<IssueFinalCompletionMessage>"

					Action Rules
						include IssueFinalActionRule
					Exit Rules
						include IssueFinalExitRule

				RegenerateDocument is an Instance Action
					valid when (ValidForRegeneration)
					completion message is "RegenerateDocumentInitiated.PleaseRefreshTheScreenToSeeTheDocumentLink."
					
					Action Rules
						include RegenerateIDMDocument

			Canceled is a State
				IssueFinal is an Instance Action
					valid when (CanIssueFinalForCanceled)
					completion message is "<IssueFinalCompletionMessage>"

					Action Rules
						include IssueFinalActionRule
					Exit Rules
						include IssueFinalExitRule

				RegenerateDocument is an Instance Action
					valid when (CanRegenerateForCanceled)
					completion message is "RegenerateDocumentInitiated.PleaseRefreshTheScreenToSeeTheDocumentLink."
					
					Action Rules
						include RegenerateIDMDocument			

			Closed is a State
				ClosedPOUpdate is an Update Action										
					valid when (Company.ReopenPurchaseOrder)
					completion message is "<UpdateCompletionMessage>"
					Entrance Rules
						include InventoryLocationStatusValidation
					Action Rules
						constraint (Company.ReopenPurchaseOrder)
							"CompanyDoesNotAllowChangesToAClosedPurchaseOrderHeader"
						invoke ReopenHeader												

				ReopenHeader is an Instance Action
					restricted
					completion message is "<UpdateClosedPOCompletionMessage>"         

					Parameters
						PrmUpdatedFromLine is Boolean

					Action Rules
						constraint (Company.ReopenPurchaseOrder)
							"PurchasingCompany<Company>DoesNotAllowReopenOfClosedPurchaseOrder."

						LocalUpdatedFromLine = PrmUpdatedFromLine

					Exit Rules
						include UpdateExitRules
						include UnreleasePurchaseOrder

			Historical is a State

			ReleaseInProgress is a State

			CreateInProgress is a State

			Deleted is a State

			CancelInProgress is a State

			DeleteInProgress is a State
	Actions
		UpdatePointOfTitleTransferToOrigin is an Instance Action
			valid when (IsOneSourceTaxAndPointOfTitleTransferDestination)
			Action Rules
				PointOfTitleTransfer = PointOfTitleTransfer.Origin
				for each TaxablePurchaseOrderLinesRel
					invoke FastUpdate each
						invoked.PointOfTitleTransfer = PointOfTitleTransfer.Origin
			
		AcknowledgeManually is an Instance Action
			disable multiple instance selection
			valid when (AllowManualAcknowledgement)
			Parameters
				PrmAcknowledgementType		is Alpha size 2
					default label is "AcknowledgementType"
					States
						Accepted						value is "MT"
						AcknowledgedWithDetailChange	value is "MC"
				PrmAcknowledgementDate		is Date
					default label is "AcknowledgementDate"
				PrmAcknowledgementPOShipDate	is Date
					default label is "PO Ship Date"
				PrmAcknowledgementMessage	is Alpha size 100
					default label is "AcknowledgementMessage"
			Parameter Rules
				PrmAcknowledgementType
					initial value is PrmAcknowledgementType.Accepted
					default to PrmAcknowledgementType.Accepted
				
				PrmAcknowledgementDate
					initial value is current corporate date
					default to current corporate date
					constraint (PrmAcknowledgementDate >= PurchaseOrderDate)
						"AcknowledgementDateCannotBeLessThanPurchaseOrderDate"
				
                PrmAcknowledgementPOShipDate
					constraint (PrmAcknowledgementPOShipDate >= PurchaseOrderDate)
						"ShipDateCannotBeLessThanPurchaseOrderDate"
				
				PrmAcknowledgementMessage
					required
						"AcknowledgementMessageIsRequired"
			Action Rules
				invoke Update first NonEDIPurchaseOrderRevisionsRel 
					invoked.AcknowledgementDate 	= PrmAcknowledgementDate
					invoked.TransmissionMessage		= PrmAcknowledgementMessage
					
				for each PurchaseOrderLine set
					invoke GenerateLineAcknowledgements each
						invoked.PrmAcknowledgementType = PrmAcknowledgementType
                        invoked.PrmAcknowledgementPOShipDate = PrmAcknowledgementPOShipDate


		FinishAcknowledgement is an Instance Action
			valid when (AllowedToFinishAcknowledgement)
			Action Rules
				invoke ProcessPurchaseOrderEDIAcknowledgement PurchaseOrderEDIAcknowledgement
					invoked.ManualProcessing			= true
					invoked.PrmRunGroup					= PurchaseOrder
					invoked.PrmCompany					= Company
					invoked.PrmPurchaseOrder			= PurchaseOrder
					invoked.PrmVendor        			= Vendor
					invoked.EnableGLNProcessing 		= true
					invoked.SendEmailToBuyers   		= true
					invoked.PrmAcknowledgementFromPO	= true

		CreateAcknowledgements is an Instance Action  
			valid when (CanAcknowledge)
			Action Rules

				for each PurchaseOrderLine set
					invoke ManuallyCreateLineAcknowledgements each

		UpdateRevisionsAndIssueMethodFlag is an Instance Action
			restricted
			Action Rules
				if  (PurchaseOrderRevision  = 1
				and  RevisionsInclude not entered
				and  IssueMethod not changed)
					if (PurchaseFromLocationRel.RevisionsInclude entered)
						RevisionsInclude = PurchaseFromLocationRel.RevisionsInclude
					else
					if (PurchasingVendorRel.RevisionsInclude entered)
						RevisionsInclude = PurchasingVendorRel.RevisionsInclude
					else
					if (Company.RevisionsInclude entered)
						RevisionsInclude = Company.RevisionsInclude
					else
						RevisionsInclude = RevisionsInclude.NotApplicable


					if (RevisionsInclude = RevisionsInclude.NotApplicable)
						IssueMethod = IssueMethod.DoNotPrint
					else
					if (PurchaseFromLocationRel.RevisedIssueMethod entered)
						IssueMethod = PurchaseFromLocationRel.RevisedIssueMethod
					else
					if (PurchasingVendorRel.RevisedIssueMethod entered)
						IssueMethod = PurchasingVendorRel.RevisedIssueMethod

		StoreIDMXML is an Instance Action 
			restricted

		CreateIDMXML is a Set Action
			completion message is "Generated_XMLFileFor_Purchase_Order<PrmPurchaseOrder>"
			default label is "Generate_XMLFile"
			run in foreground
			Parameters
				PrmCompany is a PurchasingCompany
					default label is "Company"
				PrmPurchaseOrder is a PurchaseOrder
					default label is "PurchaseOrder"

			Parameter Rules
				PrmCompany
					required
				
				PrmPurchaseOrder
					required

			Local Fields
				LocalExecute is Boolean
				
			Instance Selection
				where (Company 				= PrmCompany
				and    PurchaseOrder 		= PrmPurchaseOrder)

			Action Rules
				Instance Rules
					include SetIDMXMLDefinitionValues

					LocalExecute = IDMXMLDefinition.GenerateXML

					if (IDMXMLDefinition.OutputAttachment entered)
						invoke FastUpdate
							invoked.PurchaseOrderIDMXMLFile = IDMXMLDefinition.OutputAttachment

		DeleteIDMXML is an Instance Action
			valid when (PurchaseOrderIDMXMLFile entered)
			completion message is "Deleted_XMLFileFor_Purchase_Order<PurchaseOrder>"
			confirmation required
			default label is "Delete_XMLFile"
			Action Rules
				invoke FastUpdate
					initialize invoked.PurchaseOrderIDMXMLFile

		IssueFromBatchInstance is an Instance Action
			restricted
			Parameters
				PrmCompany          is a PurchasingCompany
                PrmIssueDraft       is Boolean
                PrmShipToLocation   is an InventoryLocation
                PrmVendorClass      is a VendorClass
                PrmVendor           is a Vendor
                PrmPurchaseFrom     is a VendorLocation
                PrmBuyerGroup       is a BuyerGroup
                PrmBuyer            is a Buyer
                PrmPOCode           is a POCode
                PrmPurchaseOrder1   is a PurchaseOrder
                PrmPurchaseOrder2   is a PurchaseOrder
                PrmPurchaseOrder3   is a PurchaseOrder
                PrmPurchaseOrder4   is a PurchaseOrder
                PrmPurchaseOrder5   is a PurchaseOrder
                PrmPurchaseOrder6   is a PurchaseOrder
                PrmPurchaseOrder7   is a PurchaseOrder
                PrmPurchaseOrder8   is a PurchaseOrder
                PrmPaperIssue       is Boolean
                PrmFaxIssue         is Boolean
                PrmEDIIssue         is Boolean
                PrmEmailIssue       is Boolean
                PrmXMLIssue         is Boolean
                PrmCommentCode1     is a StandardCommentCode
                PrmCommentCode2     is a StandardCommentCode
                PrmCommentCode3     is a StandardCommentCode
                PrmCommentCode4     is a StandardCommentCode
                PrmCommentCode5     is a StandardCommentCode
                PrmCommentCode6     is a StandardCommentCode
                PrmCommentCode7     is a StandardCommentCode
                PrmCommentCode8     is a StandardCommentCode
            Action Rules
				invoke IssueFromBatch PurchaseOrder
					invoked.PrmCompany	          = PrmCompany
					invoked.PrmIssueDraft         = PrmIssueDraft
					invoked.PrmShipToLocation     = PrmShipToLocation
					invoked.PrmVendorClass	      = PrmVendorClass
					invoked.PrmVendor	          = PrmVendor
					invoked.PrmPurchaseFrom	      = PrmPurchaseFrom
					invoked.PrmBuyerGroup	      = PrmBuyerGroup
					invoked.PrmBuyer	          = PrmBuyer
					invoked.PrmPOCode	          = PrmPOCode
					invoked.PrmPurchaseOrder1	  = PrmPurchaseOrder1
					invoked.PrmPurchaseOrder2	  = PrmPurchaseOrder2
					invoked.PrmPurchaseOrder3	  = PrmPurchaseOrder3
					invoked.PrmPurchaseOrder4	  = PrmPurchaseOrder4
					invoked.PrmPurchaseOrder5	  = PrmPurchaseOrder5
					invoked.PrmPurchaseOrder6	  = PrmPurchaseOrder6
					invoked.PrmPurchaseOrder7	  = PrmPurchaseOrder7
					invoked.PrmPurchaseOrder8	  = PrmPurchaseOrder8
					invoked.PrmPaperIssue	      = PrmPaperIssue
					invoked.PrmFaxIssue	          = PrmFaxIssue
					invoked.PrmEDIIssue	          = PrmEDIIssue
					invoked.PrmEmailIssue	      = PrmEmailIssue
					invoked.PrmXMLIssue	          = PrmXMLIssue
					invoked.PrmCommentCode1	      = PrmCommentCode1
					invoked.PrmCommentCode2	      = PrmCommentCode2
					invoked.PrmCommentCode3	      = PrmCommentCode3
					invoked.PrmCommentCode4	      = PrmCommentCode4
					invoked.PrmCommentCode5	      = PrmCommentCode5
					invoked.PrmCommentCode6	      = PrmCommentCode6
					invoked.PrmCommentCode7	      = PrmCommentCode7
					invoked.PrmCommentCode8	      = PrmCommentCode8
					
		IssueFromBatch is a Set Action
			restricted
            Local Fields
            	LocalBatchID 						is an IDMPID
				LocalSetMassIssue					is Boolean
				LocalErrorMessage					is Alpha 150
				LocalHasError						is Boolean
				LocalErrorCounter					is Numeric 9
				SavedPurchaseOrderResultResultView  is a PurchaseOrderResult view
				LocalBegin                          is Boolean
				LocalBatchIDArray                   is an IDMUniqueIDOccurs
				LocalIDMBatchIDLimit				is Numeric 4
				LocalUseIDM						    is Boolean
				LocalPurchaseOrderRange 		    is like PurchaseOrderRange		
						
            Parameters
                PrmCompany          is a PurchasingCompany
                PrmIssueDraft       is Boolean
                PrmShipToLocation   is an InventoryLocation
                PrmVendorClass      is a VendorClass
                PrmVendor           is a Vendor
                PrmPurchaseFrom     is a VendorLocation
                PrmBuyerGroup       is a BuyerGroup
                PrmBuyer            is a Buyer
                PrmPOCode           is a POCode
                PrmPurchaseOrder1   is a PurchaseOrder
                PrmPurchaseOrder2   is a PurchaseOrder
                PrmPurchaseOrder3   is a PurchaseOrder
                PrmPurchaseOrder4   is a PurchaseOrder
                PrmPurchaseOrder5   is a PurchaseOrder
                PrmPurchaseOrder6   is a PurchaseOrder
                PrmPurchaseOrder7   is a PurchaseOrder
                PrmPurchaseOrder8   is a PurchaseOrder
                PrmPaperIssue       is Boolean
                PrmFaxIssue         is Boolean
                PrmEDIIssue         is Boolean
                PrmEmailIssue       is Boolean
                PrmXMLIssue         is Boolean
                PrmCommentCode1     is a StandardCommentCode 
                PrmCommentCode2     is a StandardCommentCode 
                PrmCommentCode3     is a StandardCommentCode 
                PrmCommentCode4     is a StandardCommentCode 
                PrmCommentCode5     is a StandardCommentCode 
                PrmCommentCode6     is a StandardCommentCode 
                PrmCommentCode7     is a StandardCommentCode 
                PrmCommentCode8     is a StandardCommentCode 

			Parameter Rules
				PrmCompany
					required

            Instance Selection
                where   (Company            = PrmCompany
                and     (PrmShipToLocation not entered
                or       ShipToLocation = PrmShipToLocation)
                and     (PrmVendorClass not entered
                or       Vendor.VendorClass = PrmVendorClass)
                and     (PrmVendor not entered
                or       Vendor = PrmVendor)
                and     (PrmPurchaseFrom not entered
                or       PurchaseFromLocation   = PrmPurchaseFrom)
                and     (PrmBuyerGroup not entered
                or       Buyer.BuyerGroup   = PrmBuyerGroup)
                and     (PrmBuyer not entered
                or       Buyer = PrmBuyer)
                and     (PrmPOCode not entered
                or       POCode = PrmPOCode)
				and    ((PrmPurchaseOrder1 not entered
				and 	 PrmPurchaseOrder2 not entered
				and 	 PrmPurchaseOrder3 not entered
				and 	 PrmPurchaseOrder4 not entered
				and 	 PrmPurchaseOrder5 not entered
				and 	 PrmPurchaseOrder6 not entered
				and 	 PrmPurchaseOrder7 not entered
				and 	 PrmPurchaseOrder8 not entered
				and		 IsToBePrinted)
				or	   ((PrmPurchaseOrder1 entered and PurchaseOrder = PrmPurchaseOrder1)
				or		(PrmPurchaseOrder2 entered and PurchaseOrder = PrmPurchaseOrder2)
				or		(PrmPurchaseOrder3 entered and PurchaseOrder = PrmPurchaseOrder3)
				or		(PrmPurchaseOrder4 entered and PurchaseOrder = PrmPurchaseOrder4)
				or		(PrmPurchaseOrder5 entered and PurchaseOrder = PrmPurchaseOrder5)
				or		(PrmPurchaseOrder6 entered and PurchaseOrder = PrmPurchaseOrder6)
				or		(PrmPurchaseOrder7 entered and PurchaseOrder = PrmPurchaseOrder7)
				or		(PrmPurchaseOrder8 entered and PurchaseOrder = PrmPurchaseOrder8)))
                and    ((PrmPaperIssue and IssueMethod.Paper)
                or      (PrmFaxIssue and IssueMethod.Fax)
                or      (PrmEDIIssue and IssueMethod.EDI)
                or      (PrmEmailIssue and IssueMethod.Email)
                or      (PrmXMLIssue and IssueMethod.XML))
				and		(PurchaseOrderLifeCycleState.Unreleased
				or		PurchaseOrderLifeCycleState.Released)
				and		(not ApprovalStatus.NeedsApproval))

			Accumulators
				POCounter
				BatchIDCounter

            Action Rules
            	Set Rules
            		Entrance Rules
        				LocalBatchID = current timestamp

						if (PrmCompany.UseIDM)
							LocalUseIDM = true
							BatchIDCounter = 1
							LocalBatchIDArray.IDMPID[BatchIDCounter] = LocalBatchID
							LocalBegin = true

							if (config.PURCHASEORDER_IDMBATCHID_LIMIT > 0)
								LocalIDMBatchIDLimit = config.PURCHASEORDER_IDMBATCHID_LIMIT
							else 
								LocalIDMBatchIDLimit = 50

						if (PrmPurchaseOrder1 entered 
						or  PrmPurchaseOrder2 entered 
						or  PrmPurchaseOrder3 entered 
						or  PrmPurchaseOrder4 entered 
						or  PrmPurchaseOrder5 entered 
						or  PrmPurchaseOrder6 entered 
						or  PrmPurchaseOrder7 entered 
						or  PrmPurchaseOrder8 entered)
							LocalSetMassIssue = true

						invoke Create PurchaseOrderResult
							assign result to SavedPurchaseOrderResultResultView
							invoked.FinanceEnterpriseGroup				= PrmCompany.FinanceEnterpriseGroup
							invoked.ReportType							= PurchaseOrderResult.ReportType.MassPOIssueResult
							invoked.PrintTimeStamp						= current timestamp
							invoked.Status								= PurchaseOrderResult.Status.Processing				
					Exit Rules
						if (LocalUseIDM)
							for each LocalBatchIDArray.IDMPID
								LocalAsyncBackgroundGroup = "IDMJobGetStatusByBatch_" + each
								if (each entered) 
									invoke GetStatusByBatchID IDMJob in background group (LocalAsyncBackgroundGroup)
										invoked.PrmActor   	  = actor
										invoked.PrmIDMBatchID = each
										
									if (not PrmIssueDraft)
										invoke IssueFinalCompletionSet in background
											run after background group (LocalAsyncBackgroundGroup)
											invoked.PrmCompany            = PrmCompany
											invoked.PrmPurchaseOrderRange = LocalPurchaseOrderRange					
											invoked.PrmActor   	          = actor
											invoked.PrmIDMBatchID         = each
								else
									end for each

						if (LocalErrorCounter > 0)
							LocalReportFinanceEnterpriseGroup	= PrmCompany.FinanceEnterpriseGroup
							LocalPurchaseOrderResult			= SavedPurchaseOrderResultResultView.PurchaseOrderResult
							invoke SendPOMassIssueErrorNotification last PurchasingMassPOIssueErrorReportRel.PurchaseOrderResult in background
								invoked.PrmRecordsWithError = LocalErrorCounter
						else
							invoke TransitionToCompleted SavedPurchaseOrderResultResultView.PurchaseOrderResult
				
                Instance Rules
					initialize LocalHasError
					initialize LocalErrorMessage

					if (LocalUseIDM)
						POCounter += 1
						if (POCounter > LocalIDMBatchIDLimit)		
							LocalBatchID = current timestamp	
							BatchIDCounter += 1		
							LocalBatchIDArray.IDMPID[BatchIDCounter] = LocalBatchID
							POCounter = 1
							
						if (LocalBegin)
							LocalPurchaseOrderRange.Begin = PurchaseOrder
							LocalBegin = false

						LocalPurchaseOrderRange.End = PurchaseOrder

                    if (PrmCommentCode1 entered)
                        StandardCommentCode = PrmCommentCode1
                        include CreateCommentFromCommentCode
                    if (PrmCommentCode2 entered)
                        StandardCommentCode = PrmCommentCode2
                        include CreateCommentFromCommentCode
                    if (PrmCommentCode3 entered)
                        StandardCommentCode = PrmCommentCode3
                        include CreateCommentFromCommentCode
                    if (PrmCommentCode4 entered)
                        StandardCommentCode = PrmCommentCode4
                        include CreateCommentFromCommentCode
                    if (PrmCommentCode5 entered)
                        StandardCommentCode = PrmCommentCode5
                        include CreateCommentFromCommentCode
                    if (PrmCommentCode6 entered)
                        StandardCommentCode = PrmCommentCode6
                        include CreateCommentFromCommentCode
                    if (PrmCommentCode7 entered)
                        StandardCommentCode = PrmCommentCode7
                        include CreateCommentFromCommentCode
                    if (PrmCommentCode8 entered)
                        StandardCommentCode = PrmCommentCode8
                        include CreateCommentFromCommentCode
                        
                    if (PrmIssueDraft)
                        invoke IssueDraftBatch
							resume on error
								LocalErrorMessage 		  = error message
								LocalHasError			  = true
							invoked.PrmIDMBatchID = LocalBatchID
                    else
						TransientMassIssue	= LocalSetMassIssue

                        if (ValidForIssueFinal)
                            invoke Released.IssueFinalBatch
								resume on error
									LocalErrorMessage 		  = error message
									LocalHasError			  = true
                            	invoked.PrmIDMBatchID = LocalBatchID
					
					if (LocalHasError)
						LocalErrorCounter 							+= 1
						invoke Create PurchaseOrderResultHeading
							invoked.FinanceEnterpriseGroup			= PrmCompany.FinanceEnterpriseGroup
		                    invoked.PurchaseOrderResult				= SavedPurchaseOrderResultResultView.PurchaseOrderResult
		                    invoked.PurchasingCompany				= PrmCompany
							invoked.PurchaseOrder					= PurchaseOrder
							invoked.ErrorMessage					= LocalErrorMessage				
                            
        IDMJobGetStatusFromBatch  is a Set Action
			restricted
        	Parameters
        		PrmIDMBatchID is an IDMPID
				PrmIssueDraft is Boolean
        	
        	Instance Selection
                where (IDMJob.BatchID = PrmIDMBatchID
                and IDMJob.Actor = actor)	
            
            Action Rules
            	Instance Rules
            		invoke GetStatusFromBatch
						if (not PrmIssueDraft)
            				invoked.IsIssueFinal = true

		CreateAndSendPODocToIDM is an Instance Action
			restricted
			Parameters
				IsIssueFinal				is Boolean
				PrmIDMPrinter				is an IDMPrinter
				PrmBatchID					is an IDMPID

			Local Fields
				LocalIDMJob					is an IDMJob view
				LocalUseRichText			is Boolean

			Action Rules
				initialize IDMGenerateDocument

				include SetIDMAttributes
				IDMAttributes.SingleValue.IDMAttribute[9].IDMAttributeName		= "Company"
				IDMAttributes.SingleValue.IDMAttribute[9].IDMAttributeValue		= Company
				IDMAttributes.SingleValue.IDMAttribute[10].IDMAttributeName		= "PurchaseOrder"
				IDMAttributes.SingleValue.IDMAttribute[10].IDMAttributeValue	= PurchaseOrder

				if (IDMAdditionalAttributesLinesRel exists)
					AttributeCtr = 11
					include IDM.IDMAdditionalAttributes

				LocalForIssueFinal = IsIssueFinal

				include SetIDMXMLDefinitionValues
				IDMGenerateDocument.IDMXMLDefinition 	= IDMXMLDefinition
				IDMGenerateDocument.IDMAttributes		= IDMAttributes

				if (Buyer.OverrideDocumentTemplate and PurchaseOrderIDMTemplate entered)
					IDMGenerateDocument.TemplateUniqueId  = PurchaseOrderIDMTemplate.IDMUniqueId
					if (PurchaseOrderIDMTemplate.UseRichText)
						LocalUseRichText = true
					if (Company.PODocumentFileName entered)
						IDMGenerateDocument.FileName 	  = DerivedPODocumentFileName + PurchaseOrderIDMTemplate.DerivedOutputFormat
					else
						IDMGenerateDocument.FileName	  = DerivedXMLName + PurchaseOrderIDMTemplate.DerivedOutputFormat
				else
				if (PurchaseFromLocation entered and PurchaseFromLocationRel.IDMTemplate entered)
					IDMGenerateDocument.TemplateUniqueId  = PurchaseFromLocationRel.IDMTemplate.IDMUniqueId
					if (PurchaseFromLocationRel.IDMTemplate.UseRichText)
						LocalUseRichText = true
					if (Company.PODocumentFileName entered)
						IDMGenerateDocument.FileName 	  = DerivedPODocumentFileName + PurchaseFromLocationRel.IDMTemplate.DerivedOutputFormat
					else
						IDMGenerateDocument.FileName	  = DerivedXMLName + PurchaseFromLocationRel.IDMTemplate.DerivedOutputFormat
				else
				if (PurchasingVendorRel.IDMTemplate entered)
					IDMGenerateDocument.TemplateUniqueId  = PurchasingVendorRel.IDMTemplate.IDMUniqueId
					if (PurchasingVendorRel.IDMTemplate.UseRichText)
						LocalUseRichText = true
					if (Company.PODocumentFileName entered)
						IDMGenerateDocument.FileName 	  = DerivedPODocumentFileName + PurchasingVendorRel.IDMTemplate.DerivedOutputFormat 
					else
						IDMGenerateDocument.FileName	  = DerivedXMLName + PurchasingVendorRel.IDMTemplate.DerivedOutputFormat
				else
					IDMGenerateDocument.TemplateUniqueId  = Company.PurchaseOrderTemplate.IDMUniqueId
					if (Company.PurchaseOrderTemplate.UseRichText)
						LocalUseRichText = true
					if (Company.PODocumentFileName entered)
						IDMGenerateDocument.FileName 	  = DerivedPODocumentFileName + Company.PurchaseOrderTemplate.DerivedOutputFormat
					else
						IDMGenerateDocument.FileName	  = DerivedXMLName + Company.PurchaseOrderTemplate.DerivedOutputFormat
					
				IDMGenerateDocument.DocumentType		= "FSM_PurchaseOrder"
				IDMGenerateDocument.BatchID				= LocalIDMBatchID


				if (IssueMethod.Email)
					IDMGenerateDocument.IDMEmail.To						= EmailAddress


					IDMGenerateDocument.IDMEmail.From					= DerivedPurchaseOrderEmailFrom


					if (Company.PurchaseOrderIDMEmailTemplate entered)
						IDMGenerateDocument.EmailTemplateUniqueID		= Company.PurchaseOrderIDMEmailTemplate.IDMUniqueId
					else
						IDMGenerateDocument.IDMEmail.Body				= DerivedIDMEmailBody


					IDMGenerateDocument.IDMEmail.Subject				= DerivedPurchaseOrderEmailSubject

					LocalIDMAttachmentCtr = 1
					for each SendToVendorPOCommentAttachmentsRel
						if (LocalIDMAttachmentCtr > 100)
							end for each
						IDMGenerateDocument.IDMEmail.IDMAttachments.IDMAttachment[LocalIDMAttachmentCtr] = each.Attachment
						LocalIDMAttachmentCtr+=1

					for each PrintLinesRel
						if (LocalIDMAttachmentCtr > 100)
							end for each
						for each each.SendToVendorPOLineCommentAttachmentsRel
							IDMGenerateDocument.IDMEmail.IDMAttachments.IDMAttachment[LocalIDMAttachmentCtr] = each.Attachment
							LocalIDMAttachmentCtr+=1


				if (PrmIDMPrinter entered)
   					IDMGenerateDocument.IDMPrinter	 = PrmIDMPrinter 

				if (IsIssueFinal)
					IDMGenerateDocument.IDMAccessControlList = "CSFDefined"
				else
					IDMGenerateDocument.IDMAccessControlList = "CSFDefault"

				if (LocalUseRichText)
					IDMGenerateDocument.DocumentTemplateType = IDMDocumentTemplate.PurchaseOrder
					include IDM.CheckRichTextIDMOption

				invoke CreateFromGenerateDocument IDMJob
					assign result to LocalIDMJob
					invoked.Actor				= actor
					invoked.Description			= "Purchase Order Issue"
					invoked.IDMGenerateDocument = IDMGenerateDocument
					invoked.BypassGetStatus     = LocalFromBatch

				IDMJob = LocalIDMJob.IDMJob

				if (not LocalFromBatch)
					invoke UpdateIDMUniqueID in background
						run after IDMJob.AsyncId

					if (IsIssueFinal)					
						invoke IssueFinalCompletion in background
							run after IDMJob.AsyncId

		CreateSupplierMessageAndDialog is an Instance Action
			valid when (ForSupplier)
			Parameters
				ParmDialogMessage       is Alpha size 1000
					default label is "Message"
				ParmDialogAttachment	is an Attachment
					default label is "Attachment"
				ParmPriority            is Numeric 1
					States
						Low				value is 1
						Normal			value is 2
						High			value is 3
					default label is "Priority"
				ParmResponseRequested   is Boolean
					default label is "ResponseRequired"

			Parameter Rules
				ParmDialogMessage
					required

				ParmPriority
					initial value is 2

			Local Fields
				LocalSupplierContactMessage        is a SupplierContactMessage view

			Action Rules

				invoke Create SupplierContactMessage
					assign result to LocalSupplierContactMessage
					invoked.SupplierGroup  					= actor.agent(SupplierSourceId).SupplierGroup
 					invoked.Supplier    			 		= actor.agent(SupplierSourceId).Supplier
					invoked.SupplierSourceId                = actor.agent(SupplierSourceId).SupplierSourceId
					invoked.MessageTitle					= "Dialog for Purchase Order: " + DerivedPurchaseOrder
					invoked.MessageText                     = "User Created Message and Dialog for Purchase Order: " + DerivedPurchaseOrder
					invoked.Status							= 1
					invoked.Priority						= ParmPriority
					invoked.ReleaseStatus					= 2
					invoked.MessageOwner                    = Buyer
					invoked.OriginatingCompany              = Company
					invoked.OriginatingPO                   = PurchaseOrder

				invoke Create SupplierMessageDialog
					invoked.SupplierGroup  					= actor.agent(SupplierSourceId).SupplierGroup
 					invoked.Supplier    			 		= actor.agent(SupplierSourceId).Supplier
					invoked.SupplierSourceId                = actor.agent(SupplierSourceId).SupplierSourceId
					invoked.SupplierContactMessage 			= LocalSupplierContactMessage.SupplierContactMessage
					invoked.Message                 		= ParmDialogMessage
					invoked.MessageAttachment       		= ParmDialogAttachment
					invoked.ResponseRequested       		= ParmResponseRequested

		CreateMessageAndDialog is an Instance Action  
			default label is "StartASupplierDialog"
			valid when (BuyerCanCreateDialog)
			Parameters
				ParmSupplierGroup       is a SupplierGroup
				ParmSupplier            is a Supplier
					default label is "Supplier"
				ParmSupplierContact     is a SupplierSourceId
					default label is "SupplierContact"
				ParmDialogMessage       is Alpha size 1000
					default label is "Message"
				ParmDialogAttachment	is an Attachment
					default label is "Attachment"
				ParmPriority            is Numeric 1
					States
						Low				value is 1
						Normal			value is 2
						High			value is 3
					default label is "Priority"
				ParmResponseRequested   is Boolean
					default label is "ResponseRequired"

			Parameter Rules
				
				ParmSupplierGroup
					initial value is SupplierGroupRel.SupplierGroup
					
				ParmSupplier
					if (Vendor.SingleSupplier)
						default to Vendor.first SupplierRel.Supplier
				
				ParmSupplierContact
					if (Vendor.SingleSupplier
					and DerivedSupplierSourceId entered)
						default to DerivedSupplierSourceId
					else
					if (Vendor.SingleSupplierAndContact)
						default to Vendor.SupplierRel.PrimaryContact.SupplierSourceId
				
				ParmDialogMessage
					required

				ParmPriority
					initial value is 2

			Local Fields
				LocalSupplierContactMessage        is a SupplierContactMessage view

			Action Rules

				if (!Vendor.SingleSupplier)
					constraint (ParmSupplier entered)
						"MustEnterASupplier"

				if (!Vendor.SingleSupplierAndContact)
					constraint (ParmSupplierContact entered)
						"MustEnterASupplierContact"		

				constraint (ParmSupplier.Vendor = Vendor)
					"SupplierNotValidForVendor"
				
				if (ParmSupplier entered)
					LocalSupplier        = ParmSupplier
				else
					LocalSupplier 		 = Vendor.SupplierRel.Supplier
				LocalSupplierContact = ParmSupplierContact					
				
				constraint (SupplierSourceIdValidRel exists)
					"SupplierContactNotValidForSupplier"
				
				constraint (SupplierContactHasOrdersAccess)
					"SupplierContactDoesNotHaveAccessToPurchaseOrders"
				
				invoke Create SupplierContactMessage
					assign result to LocalSupplierContactMessage
					invoked.SupplierGroup  					= ParmSupplierGroup					
 					invoked.Supplier    			 		= ParmSupplier
 					invoked.SupplierSourceId                = ParmSupplierContact
					invoked.MessageTitle					= "Dialog for Purchase Order: " + DerivedPurchaseOrder
					invoked.MessageText                     = "User Created Message and Dialog for Purchase Order: " + DerivedPurchaseOrder
					invoked.Status							= 1
					invoked.Priority						= ParmPriority
					invoked.ReleaseStatus					= 2
					invoked.MessageOwner                    = actor.agent(Employee).Employee
					invoked.OriginatingCompany              = Company
					invoked.OriginatingPO                   = PurchaseOrder

				invoke Create SupplierMessageDialog
					invoked.SupplierGroup  					= ParmSupplierGroup					
 					invoked.Supplier    			 		= ParmSupplier
 					invoked.SupplierSourceId                = ParmSupplierContact
					invoked.SupplierContactMessage 			= LocalSupplierContactMessage.SupplierContactMessage
					invoked.Message                 		= ParmDialogMessage
					invoked.MessageAttachment       		= ParmDialogAttachment
					invoked.ResponseRequested       		= ParmResponseRequested
					invoked.Origin                          = 1

		RebuildCommitmentTotals is an Instance Action
			restricted
			Parameters
				IsBatch        is Boolean

			Action Rules

				invoke Delete HeaderBudgetEditErrorRel
				invoke Delete DistributionBudgetEditErrorRel
				invoke Delete BudgetTemplateGroupTotalRel
				for each PurchaseOrderLineDistributionsRel
					invoke RecalculateCommitmentAmounts each
					increment LocalTransactionCount
					if (LocalTransactionCount > 50)
						commit transaction
						initialize LocalTransactionCount
				invoke EditTotalsRoute BudgetTemplateGroupTotal
					invoked.PrmFinanceEnterpriseGroup    											= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					invoked.PrmBudgetEditGroup           											= UniqueID
					invoked.PrmBudgetEditCallBack.BudgetEditCallBackPurchaseOrder.PurchasingCompany	= Company
					invoked.PrmBudgetEditCallBack.BudgetEditCallBackPurchaseOrder.PurchaseOrder		= PurchaseOrder
					invoked.PrmIsBatch 																= IsBatch
					invoked.PrmBusinessClassName                									= "PurchaseOrder"
					invoked.PrmEditContext                      									= "Release"

		GetStatusFromBatch is an Instance Action
			restricted
			Parameters
				IsIssueFinal				is Boolean
			Action Rules
				LocalFromBatch	= true
				invoke GetStatus IDMJob
					invoked.PrmFromGenerateDocument = true
				IDMDocumentPID = IDMJob.MDSID

				if (IsIssueFinal)
					invoke IssueFinalCompletion


		UpdateIDMUniqueID is an Instance Action
			restricted
			Action Rules
				invoke FastUpdate
					invoked.IDMDocumentPID = IDMJob.MDSID


		IssueFinalCompletionSet is a Set Action
			restricted
            Parameters
                PrmCompany             is a PurchasingCompany
				PrmPurchaseOrderRange  is a PurchaseOrderRange
				PrmActor	  	       is an Actor
				PrmIDMBatchID	       is Alpha 20	
				
			Instance Selection
	        	where (Company = PrmCompany
				and   PurchaseOrder within PrmPurchaseOrderRange
				and   IDMMassPOIssueBatchID = PrmIDMBatchID
				and   IDMJob.Actor = PrmActor
				and   not IssueMethod.DoNotPrint
				and   Issued)

			Action Rules

				Instance Rules	
					invoke IssueFinalCompletion


		IssueFinalCompletion is an Instance Action
			restricted
			Action Rules																

				if (not (Company.UseIDM or IssueMethod.DoNotPrint))
					trigger "PurchaseOrderOutput" PA service
						resume on error 
						title is "PurchaseOrderOutput"
						Variables
							NewPOCommentView.Company
							NewPOCommentView.PurchaseOrder
							NewPOCommentView.SequenceNumber






				if (IssueMethod.Paper
				or IssueMethod.Email
				or IssueMethod.Fax)
					if (SuppressPOCost)
						PrintTotal					= EDIOutputOrderAmount



				if (IssueMethod.Email)
					if (not Company.UseIDM)
						send email
							to EmailAddress
							from DerivedPurchaseOrderEmailFrom
							subject "<DerivedPurchaseOrderEmailSubject>"
							Attachments
								attachment first LatestPODocumentRel.Attachment.File
									name is first LatestPODocumentRel.Attachment.Title
									mime type is first LatestPODocumentRel.Attachment.MimeType
								for each SendToVendorPOCommentAttachmentsRel
									attachment each.Attachment.File
										name is each.Attachment.Title
										mime type is each.Attachment.MimeType

								for each PrintLinesRel
									for each each.SendToVendorPOLineCommentAttachmentsRel
										attachment each.Attachment.File
											name is each.Attachment.Title
											mime type is each.Attachment.MimeType
							Contents
								"<DerivedPurchaseOrderEmailBody>"

					for each SendToVendorPOCommentAttachmentsRel
						invoke FastUpdate each
							invoked.AttachmentSent = true

				else
				if (IssueMethod.EDI
				or  IssueMethod.XML)
					invoke Create PurchaseOrderEDIOutput
						fill in fields from this instance
						invoked.Company												= Company
						invoked.PurchaseOrder										= PurchaseOrder
						invoked.RecordType											= "H"
						invoked.VendorPurchaseFromLocation							= PurchaseFromLocation
						invoked.FreightTerm											= FreightTerm
						invoked.ShipTerm											= ShipTerm
						invoked.ShipTermDescription									= ShipTerm.Description
						invoked.RequestingCompany									= first LineSourcesRel.PurchaseOrderLineSource.OperatingCompany
						invoked.RequestingLocation									= first LineSourcesRel.RequestingLocation
						invoked.Requester                                           = first LineSourcesRel.Requester
						invoked.Buyer												= Buyer
						if (IssueMethod.EDI)
							invoked.IssueMethod                                 	= IssueMethod.EDI
						else
							invoked.IssueMethod                                 	= IssueMethod.XML
						if (PurchaseOrderLinesWithConsignCodeRel exists)
							invoked.PurchaseOrderType								= "CN"
						invoked.LegacyPO											= LegacyPO
						invoked.EAMWorkOrder										= EAMWorkOrder
						invoked.Confirming									 		= Confirming
						invoked.QuoteNumber									 		= QuoteNumber
						invoked.Reference1											= Reference1
						if (IssueMethod.XML)
							invoked.ShippingNotes									= ShippingNotes
						else
							invoked.ShippingNotes									= blank
						if (SuppressPOCost)																	
							invoked.PrintTotal										= EDIOutputOrderAmount	

					for each PurchaseOrderAddOnChargesRel
						invoke Create PurchaseOrderEDIOutput
							fill in fields from this instance
							invoked.Company											= Company
							invoked.PurchaseOrder									= PurchaseOrder
							invoked.RecordType										= "HA"
							invoked.AddOnCharge										= each.AddOnCharge
							invoked.AddOnChargeAmount								= each.TotalAddOnChargeAmount
							invoked.Summary											= each.Summarize
							invoked.Vendor											= each.Vendor
							invoked.VendorPurchaseFromLocation						= each.PurchaseFromLocation
							invoked.TaxCode											= each.TaxCode
							invoked.TaxAmount										= (each.AccruedTaxAmount + each.InvoicedTaxAmount)
							if (IssueMethod.EDI)
								invoked.IssueMethod                                 = IssueMethod.EDI
							else
								invoked.IssueMethod                                 = IssueMethod.XML

					for each PrintOnPurchaseOrderCommentsRel
						invoke Create PurchaseOrderEDIOutput
							fill in fields from this instance
							invoked.Company											= Company
							invoked.PurchaseOrder									= PurchaseOrder
							invoked.RecordType										= "HC"
							invoked.CommentTitle									= each.CommentTitle
							invoked.CommentText										= each.CommentText
							invoked.Vendor											= Vendor
							invoked.VendorPurchaseFromLocation						= PurchaseFromLocation
							if (IssueMethod.EDI)
								invoked.IssueMethod                                 = IssueMethod.EDI
							else
								invoked.IssueMethod                                 = IssueMethod.XML

				else
				if (IssueMethod.Fax)
					if (FaxConfigurationInUseRel exists)
						if (FaxDetailRel not exists)
							invoke Create FaxDetail
								invoked.Company												= 	Company
								invoked.PurchaseOrder 										=	PurchaseOrder
								invoked.PurchaseOrderRevision 								= 	PurchaseOrderRevision
								invoked.POCommentSequenceNumber								= 	NewPOCommentView.SequenceNumber
								invoked.TransmissionID  									=   DisplayPurchaseOrderAndRevision
						invoke 	SendFax		FaxDetailRel

				if ((Company.UseIDM and not IssueMethod.DoNotPrint)
				or   LocalFromBatch
				or   instance count of PrintLinesRel <= DerivedForegroundLimit)
					invoke IssuePurchaseOrderLines PurchaseOrderLine in foreground 
						invoked.PrmCompany			= Company
						invoked.PrmPurchaseOrder	= PurchaseOrder
				else
					LocalIssueInProgress = true
					invoke IssuePurchaseOrderLines PurchaseOrderLine in background 
						invoked.PrmCompany			= Company
						invoked.PrmPurchaseOrder	= PurchaseOrder


		UpdateToIssued is an Instance Action
			restricted
			Action Rules
				if (IssueMethod.EDI
				or  IssueMethod.XML)
					for each TrailerCommentsRel
						invoke Create PurchaseOrderEDIOutput
							fill in fields from this instance
							invoked.Company											= Company
							invoked.PurchaseOrder									= PurchaseOrder
							invoked.RecordType										= "TC"
							invoked.CommentTitle									= each.CommentTitle
							invoked.CommentText										= each.CommentText
							invoked.Vendor											= Vendor
							invoked.VendorPurchaseFromLocation						= PurchaseFromLocation
							if (IssueMethod.EDI)
								invoked.IssueMethod                                 = IssueMethod.EDI
							else
								invoked.IssueMethod                                 = IssueMethod.XML

					invoke Update PurchaseOrderEDIOutputRel
						fill in fields from this instance
						invoked.IssuedFlag = true
						
				if (Company.UseIDM)
					if ((IDMJob.Status.Finished 
					and  IDMJob.MDSID entered)
					or   IDMProceedPOIssue)
						IDMDocumentPID = IDMJob.MDSID
						Issued = true
						Revised = false
					else
						Issued = false
						IssuePending = true		
						IDMDocumentPID = blank
						if (PurchaseOrderRevisionsDescendingRel exists)
							invoke Update first PurchaseOrderRevisionsDescendingRel
								invoked.IssueMethod			= blank
								invoked.IssueDate			= blank				

				if (Issued)
					LocalActor = actor
					send notification
						to LocalActor
						description is "PurchaseOrder<PurchaseOrder>HasBeenIssuedToVendor<Vendor.VendorName>."
						priority is medium
						detail is "PurchaseOrder<PurchaseOrder>HasBeenIssuedToVendor<Vendor.VendorName>."
						linkback(webapp is Buyer navigation is ViewPO text is "PurchaseOrder<PurchaseOrder>HasBeenIssuedToVendor<Vendor.VendorName>.")

		UpdateIDMAttributes is an Instance Action
			run in background
			restricted
			Parameters
				PID									is an IDMPID
				AttrsSearch							is an IDMAttributeOccurs
   				Result								is Boolean
   				LocalColSequence               		is Numeric size 3

			Action Rules

				include SetIDMAttributes

				if (IDMAdditionalAttributesLinesRel exists)
					AttributeCtr = 9
					include IDM.IDMAdditionalAttributes

				if (PID entered)
					IDMAttributes.PID = PID
					Result = IDMAttributes.ExecuteUpdateAttributeByPID
				else
					if (AttrsSearch entered)
						IDMAttributes.IDMDocumentType = "FSM_PurchaseOrder"
						IDMAttributes.AttributeSearch = AttrsSearch
						Result = IDMAttributes.ExecuteUpdateAttribute



















		TriggerPurchaseOrder is an Instance Action
	  	 	restricted
			Action Rules
				if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger)
					if (!action type.Delete)
						if (action != "UpdateBODIdFields") 
							ActionCode = ActionCode.Update
							if (action type.Create)
								ActionCode = ActionCode.Create				
																																		
							increment bod id.VariationID
							include TriggerPurchaseOrderRules

							invoke TriggerProcessPurchaseOrder
							include TriggerBRPurchaseOrder	
							
		TriggerProcessPurchaseOrder is an Instance Action  
	  	 	restricted
			Action Rules
				include TriggerProcessPurchaseOrderRules




		TriggerPurchaseOrderNativeLPLBOD is an Instance Action
			restricted
			Parameters
				RestartFlag 			is Boolean
				PrmFSMInboundBODTracker	is Numeric 15
			Entrance Rules
			Action Rules
				initialize LocalFSMInboundBODTracker
				if(RestartFlag)
					LocalFSMInboundBODTracker	= PrmFSMInboundBODTracker 
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRel
					invoked.PrmVerb 					= 1
					invoked.PrmNoun						= "PurchaseOrder"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "PurchaseOrder"
					invoked.PrmFinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					invoked.PrmCompany 					= Company
					invoked.PrmAccountingEntity 		= Company.GeneralLedgerCompany.AccountingEntity
					invoked.PrmMainUserTemplate 		= "IONPurchaseOrderXML_ST"
				NativeLPLBODTrigger = FSMBODConfigurationRel.NativeLPLBODTrigger
				if(GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger and NativeLPLBODTrigger)
					if(LocalFSMInboundBODTracker not entered)
						invoke Create FSMInboundBODTracker
							assign result to NewBODTracker
							invoked.Verb 					= 1
							invoked.Noun 					= "PurchaseOrder"					
							invoked.BODDocumentID			= BODDocumentID
							invoked.BODVariationID			= BODVariationID
							invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
							invoked.BODAccountingEntity		= BODAccountingEntity
							invoked.Direction				= 1
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.Reference1				= Company
							invoked.Reference2				= PurchaseOrder
							initialize invoked.Error			
							initialize invoked.ErrorMessage					
						LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
					
					else 
						invoke Update FSMInboundBODTrackerRel
							invoked.BODDocumentID			= BODDocumentID
							invoked.BODVariationID			= BODVariationID
							invoked.BODID					= BODFormattedId
							invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
							invoked.BODAccountingEntity		= BODAccountingEntity
							invoked.Direction				= 1
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.Reference1				= Company
							invoked.Reference2				= PurchaseOrder
							initialize invoked.Error			
							initialize invoked.ErrorMessage
							initialize invoked.BODXML
					if(PurchaseOrderLineRel exists)
						LocalPurchaseOrderLineCounter = 0
						for each PurchaseOrderLineRel
							each.LocalPOLCurrency = Currency
							LocalPurchaseOrderLineCounter += 1
							LocalPurchaseOrderLineXMLBOD += template.IONPurchaseOrderLineXML_ST document for each
							if(LocalPurchaseOrderLineCounter = 500)
								invoke Update FSMInboundBODTrackerRel
									invoked.BODXML += LocalPurchaseOrderLineXMLBOD
								initialize LocalPurchaseOrderLineXMLBOD
								initialize LocalPurchaseOrderLineCounter
								commit transaction
						if(FSMInboundBODTrackerRel exists)
							invoke Update FSMInboundBODTrackerRel
								invoked.BODXML += LocalPurchaseOrderLineXMLBOD
							LocalPurchaseOrderLineXMLBOD = FSMInboundBODTrackerRel.BODXML
					invoke SendSyncPurchaseOrderBODNativeLPL
						resume on error
		                   	Error            							= true
		                    ErrorMessage     							= error message
	                if(Error)
						invoke Update FSMInboundBODTrackerRel
							invoked.Error 								= Error
							invoked.ErrorMessage 						= ErrorMessage
							invoked.Status								= 2
							invoked.CloseDate							= system current timestamp
							invoked.BODID								= BODFormattedId
							invoked.BODXML								= PurchaseOrderXMLBOD
					else
						invoke Update FSMInboundBODTrackerRel
							invoked.Status									= 3
							invoked.CloseDate								= system current timestamp
							invoked.BODID									= BODFormattedId
							invoked.BODXML									= PurchaseOrderXMLBOD
	
		SendSyncPurchaseOrderBODNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Action Rules
				send ion bod
					bod is PurchaseOrderXMLBOD
					bod type is "Sync.PurchaseOrder"
					accounting entity is BODAccountingEntity
					document id is BODDocumentID
					variation id is BODVariationID
					location is DerivedLocation


		TriggerProcessPurchaseOrderNativeLPLBOD is an Instance Action
			restricted
			Parameters
				RestartFlag 			is Boolean
				PrmFSMInboundBODTracker	is Numeric 15
			Entrance Rules
			Action Rules
				initialize LocalFSMInboundBODTracker
				if(RestartFlag)
					LocalFSMInboundBODTracker	= PrmFSMInboundBODTracker 
				invoke NativeLPLBODTriggerChecks FSMBODConfigurationRelProcessPO
					invoked.PrmVerb 					= 2
					invoked.PrmNoun						= "PurchaseOrder"
					invoked.PrmDirection				= 1
					invoked.PrmTriggerFrom				= "PurchaseOrder"
					invoked.PrmFinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
					invoked.PrmCompany 					= Company
					invoked.PrmAccountingEntity 		= Company.GeneralLedgerCompany.AccountingEntity
					invoked.PrmMainUserTemplate 		= "IONProcessPurchaseOrder_ST"
				NativeLPLBODTrigger = FSMBODConfigurationRelProcessPO.NativeLPLBODTrigger
				if(GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger and NativeLPLBODTrigger)
					if(LocalFSMInboundBODTracker not entered)
						invoke Create FSMInboundBODTracker
							assign result to NewBODTracker
							invoked.Verb 					= 2
							invoked.Noun 					= "PurchaseOrder"					
							invoked.BODDocumentID			= ProcessBODDocumentID
							invoked.BODVariationID			= BODVariationID
							invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
							invoked.BODAccountingEntity		= ProcessBODAccountingEntity
							invoked.Direction				= 1
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.Reference1				= Company
							invoked.Reference2				= PurchaseOrder
							initialize invoked.Error			
							initialize invoked.ErrorMessage					
						LocalFSMInboundBODTracker	= NewBODTracker.FSMInboundBODTracker
					else 
						invoke Update FSMInboundBODTrackerRel
							invoked.BODDocumentID			= ProcessBODDocumentID
							invoked.BODVariationID			= BODVariationID
							invoked.BODID					= ProcessBODFormattedId
							invoked.FinanceEnterpriseGroup	= DerivedFinanceEnterpriseGroup
							invoked.BODAccountingEntity		= ProcessBODAccountingEntity
							invoked.Direction				= 1
							invoked.Status					= 1
							invoked.StartDate				= system current timestamp
							invoked.Reference1				= Company
							invoked.Reference2				= PurchaseOrder
							initialize invoked.Error			
							initialize invoked.ErrorMessage
							initialize invoked.BODXML
					if(PurchaseOrderLineRel exists)
						LocalPurchaseOrderLineCounter = 0
						for each PurchaseOrderLineRel
							each.LocalPOLCurrency = Currency
							LocalPurchaseOrderLineCounter += 1
							LocalProcessPurchaseOrderLineXMLBOD += template.IONProcessPurchaseOrderLineXML_ST document for each
							if(LocalPurchaseOrderLineCounter = 500)
								invoke Update FSMInboundBODTrackerRel
									invoked.BODXML += LocalProcessPurchaseOrderLineXMLBOD
								initialize LocalProcessPurchaseOrderLineXMLBOD
								initialize LocalPurchaseOrderLineCounter
								commit transaction
						if(FSMInboundBODTrackerRel exists)
							invoke Update FSMInboundBODTrackerRel
								invoked.BODXML += LocalProcessPurchaseOrderLineXMLBOD
							LocalProcessPurchaseOrderLineXMLBOD = FSMInboundBODTrackerRel.BODXML
					invoke SendProcessPurchaseOrderBODNativeLPL
						resume on error
							Error            							= true
							ErrorMessage     							= error message
					if(Error)
						invoke Update FSMInboundBODTrackerRel
							invoked.Error 								= Error
							invoked.ErrorMessage 						= ErrorMessage
							invoked.Status								= 2
							invoked.CloseDate							= system current timestamp
							invoked.BODID								= ProcessBODFormattedId
							invoked.BODXML								= ProcessPurchaseOrderXMLBOD
					else
						invoke Update FSMInboundBODTrackerRel
							invoked.Status									= 3
							invoked.CloseDate								= system current timestamp
							invoked.BODID									= ProcessBODFormattedId
							invoked.BODXML									= ProcessPurchaseOrderXMLBOD
	
		SendProcessPurchaseOrderBODNativeLPL is an Instance Action
			restricted
			Entrance Rules
			Action Rules
				send ion bod
					bod is ProcessPurchaseOrderXMLBOD
					bod type is "Process.PurchaseOrder"
					accounting entity is ProcessBODAccountingEntity
					document id is ProcessBODDocumentID
					variation id is BODVariationID
					location is ShipToLocation

		UpdateBODIdFields is an Instance Action
			restricted
			Parameters
				PrmAccountingEntity  is Alpha size 22
					default label is "AccountingEntity"
				PrmLocation          is Alpha size 22
					default label is "Location"
				PrmDocumentID        is Alpha size 100
					default label is "DocumentID"
				PrmRevision          is Alpha size 22
					default label is "Revision"
				PrmSystemOfRecord    is Alpha size 1
					default label is "SystemOfRecord"


			Action Rules
				if (bod id.AccountingEntity != PrmAccountingEntity)
					bod id.AccountingEntity 	= PrmAccountingEntity
				if (bod id.Location != PrmLocation)
					bod id.Location				= PrmLocation
				if (bod id.DocumentID != PrmDocumentID)
					bod id.DocumentID			= PrmDocumentID
				if (bod id.Revision != PrmRevision)
					bod id.Revision				= PrmRevision
				if (bod id.SystemOfRecord != PrmSystemOfRecord)
					bod id.SystemOfRecord		= PrmSystemOfRecord



		RecalculatePurchaseOrderAmounts is a Set Action
			restricted
			Parameters
				PrmPurchasingCompany      	is a PurchasingCompany
					default label is "Company"
				PrmPurchaseOrder			is a PurchaseOrder
					default label is "PurchaseOrder"
			Local Fields
				OldLocalOpenPurchaseAmount 	is an InternationalAmount
			Parameter Rules
				PrmPurchasingCompany
					required
					PrmPurchasingCompany = PrmPurchaseOrder.Company
				PrmPurchaseOrder
					constraint (PrmPurchaseOrder.IsUnreleased)
						"PurchaseOrderMustBeUnreleased"
			Instance Selection
				where (PrmPurchasingCompany	= Company
				and   (PrmPurchaseOrder not entered
				or     PrmPurchaseOrder 	= PurchaseOrder)
				and    PrmPurchaseOrder.IsUnreleased)
			Action Rules
				Set Rules
					Entrance Rules
						OldLocalOpenPurchaseAmount 	= TotalOrderAmount
					Exit Rules
						LocalOpenPurchaseAmount 	= TotalOrderAmount - OldLocalOpenPurchaseAmount
						if (LocalOpenPurchaseAmount entered)
							include UpdateVendorOpenPurchaseAmount
				Instance Rules
					invoke ResetPurchaseOrderTotals

					for each PurchaseOrderLine set
						NumberOfLines			    		+= 1
						PurchaseOrderLineTotal				+= each.ExtendedAmount
						TotalProductAmount					+= each.ExtendedAmount
						TotalTaxableAmount					+= each.ExtendedTaxableAmount
						StockWeight							+= each.StockWeight
						StockVolume							+= each.StockVolume
						AccruedTaxTotal						+= each.AccruedTaxAmount
						TotalTaxAmount						+= each.InvoicedTaxAmount
						OpenPurchaseAmount					+= each.OpenPurchaseAmount
						PrintTotal							+= each.ExtendedAmount + each.InvoicedTaxAmount
						VendorInvoicedTaxAmount				+= each.InvoicedTaxAmount
						VendorGrandTotal					+= each.ExtendedAmount + each.InvoicedTaxAmount
						TotalOrderAmount					+= each.ExtendedAmount + each.InvoicedTaxAmount + each.AccruedTaxAmount
						if (PurchaseOrder.AribaPOType entered)
							if (SuppressPOCost)
								EDIOutputOrderAmount		+= each.EDIOutputLineAmount
							else
								EDIOutputOrderAmount		+= each.ExtendedAmount


					for each PurchaseOrderAndLineAddOnCharge set
						if (each.TrackType entered)
							if (each.TrackType.Freight)
								FreightTotal 				+= each.AddOnChargeAmountPOCurrency
							else
							if (each.TrackType.Insurance)
								InsuranceTotal 				+= each.AddOnChargeAmountPOCurrency
							else
							if (each.TrackType.CustomsCharges)
								CustomsTotal 				+= each.AddOnChargeAmountPOCurrency
							else
								OtherAddOnChargesTotal 		+= each.AddOnChargeAmountPOCurrency
						AccruedTaxTotal						+= each.AccruedTaxAmountPOCurrency
						if (each.Vendor = Vendor)
							VendorAddOnChargeAmount 		+= each.AddOnChargeAmountPOCurrency
							VendorInvoicedTaxAmount			+= each.InvoicedTaxAmountPOCurrency
							VendorGrandTotal				+= each.AddOnChargeAmountPOCurrency + each.InvoicedTaxAmountPOCurrency
						else
							OtherVendorAddOnChargeAmount	+= each.AddOnChargeAmountPOCurrency
							OtherVendorInvoicedTaxAmount	+= each.InvoicedTaxAmountPOCurrency
							OtherVendorGrandTotal			+= each.AddOnChargeAmountPOCurrency + each.InvoicedTaxAmountPOCurrency
						if (each.PrintOnPO)
							TotalTaxAmount					+= each.InvoicedTaxAmountPOCurrency
							PrintTotal						+= each.AddOnChargeAmountPOCurrency + each.InvoicedTaxAmountPOCurrency
							AddOnChargeTotal				+= each.AddOnChargeAmountPOCurrency
						display "PO:NewOtherAddOnChargesTotal:<OtherAddOnChargesTotal>"
						display "PO:NewTotalOrderAmount:<TotalOrderAmount>"
						TotalOrderAmount					+= each.AddOnChargeAmountPOCurrency + each.InvoicedTaxAmountPOCurrency + each.AccruedTaxAmountPOCurrency


		RecalculateInterfacedPurchaseOrderAmounts is a Set Action
			restricted
			Parameters
				PrmPurchasingCompany      is a PurchasingCompany
					default label is "Company"
				OnOrAfterDate             is Date

			Parameter Rules
				PrmPurchasingCompany
					required

			Instance Selection

				where (PrmPurchasingCompany   = Company
				and    InterfacedPurchaseOrderExists
				and   (OnOrAfterDate !entered
				or    (OnOrAfterDate entered
				and    PurchaseOrderDate >= OnOrAfterDate)))

			Action Rules

				Instance Rules

					initialize NumberOfLines
					initialize NumberOfClosedLines
					initialize PurchaseOrderLineTotal
					initialize TotalProductAmount
					initialize TotalTaxableAmount
					initialize StockWeight
					initialize StockVolume
					initialize AccruedTaxTotal
					initialize TotalTaxAmount
					initialize OpenPurchaseAmount
					initialize PrintTotal
					initialize VendorInvoicedTaxAmount
					initialize VendorGrandTotal
					initialize TotalOrderAmount
					initialize EDIOutputOrderAmount  

					NumberOfLines			    = instance count of PurchaseOrderLine set
					NumberOfClosedLines		    = instance count of PurchaseOrderLinesClosedRel
					PurchaseOrderLineTotal		= sum PurchaseOrderLine set.ExtendedAmount
					TotalProductAmount			= sum PurchaseOrderLine set.ExtendedAmount
					TotalTaxableAmount			= sum PurchaseOrderLine set.ExtendedTaxableAmount
					StockWeight					= sum PurchaseOrderLine set.StockWeight
					StockVolume					= sum PurchaseOrderLine set.StockVolume
					AccruedTaxTotal				= sum PurchaseOrderLine set.AccruedTaxAmount
					TotalTaxAmount				= sum PurchaseOrderLine set.InvoicedTaxAmount
					OpenPurchaseAmount			= sum PurchaseOrderLine set.OpenPurchaseAmount
					PrintTotal					= sum PurchaseOrderLine set.DerivedPrintTotal
					VendorInvoicedTaxAmount		= sum PurchaseOrderLine set.InvoicedTaxAmount
					VendorGrandTotal			= sum PurchaseOrderLine set.DerivedPrintTotal
					TotalOrderAmount			= sum PurchaseOrderLine set.DerivedTotalOrderAmount
					if (SuppressPOCost)
						EDIOutputOrderAmount	= sum PurchaseOrderLine set.DerivedEDIOutputOrderAmount
					else
						EDIOutputOrderAmount	= sum PurchaseOrderLine set.ExtendedAmount

		UpdateHeaderAmountsFromPurchaseOrderLine is an Instance Action
			restricted
			Local Fields
				LocalStockWeight				is Decimal size 22.7
				LocalStockVolume				is Decimal size 22.7

			Parameters
				PrmExtendedAmount				is an InternationalAmount
				PrmExtendedTaxableAmount		is an InternationalAmount
				PrmStockWeight					is a StockWeight
				PrmStockVolume					is a StockVolume
				PrmAccruedTaxAmount				is an InternationalAmount
				PrmInvoicedTaxAmount			is an InternationalAmount
				PrmNumberOfLines				is a NumberOfLines
				PrmNumberOfClosedLines			is a NumberOfClosedLines
				PrmOpenPurchaseAmount			is an InternationalAmount
				PrmBypassVendorUpdate			is Boolean
				PrmEDIOutputLineAmount			is an InternationalAmount  
				PrmUpdateAmountsOnly			is Boolean
				PrmFromBatch					is Boolean

			Action Rules
				if (DoDebug)
					display "POL:UpdateHeaderAmountsFromPurchaseOrderLine"
					display "POL:PrmExtendedAmount:<PrmExtendedAmount>"
					display "POL:PrmExtendedTaxableAmount:<PrmExtendedTaxableAmount>"
					display "POL:PrmStockWeight:<PrmStockWeight>"
					display "POL:PrmStockVolume:<PrmStockVolume>"
					display "POL:PrmAccruedTaxAmount:<PrmAccruedTaxAmount>"
					display "POL:PrmInvoicedTaxAmount:<PrmInvoicedTaxAmount>"
					display "POL:PrmNumberOfLines:<PrmNumberOfLines>"
					display "POL:PrmNumberOfClosedLines:<PrmNumberOfClosedLines>"
					display "POL:PrmOpenPurchaseAmount:<PrmOpenPurchaseAmount>"
					display "POL:PrmBypassVendorUpdate:<PrmBypassVendorUpdate>"
					display "POL:PrmEDIOutputLineAmount:<PrmEDIOutputLineAmount>"
					display "POL:PrmUpdateAmountsOnly:<PrmUpdateAmountsOnly>"
				if (not PrmUpdateAmountsOnly and not PrmFromBatch)
					LocalStockWeight			= StockWeight + PrmStockWeight
					if (LocalStockWeight > 999999.999)
						confirmation required
							"Warning:_\Stock_\WeightExceedsAllottedSizeOf999,999.999"
					LocalStockVolume			= StockVolume + PrmStockVolume
					if (LocalStockVolume > 999999.999)
						confirmation required
							"Warning:_\Stock_\VolumeExceedsAllottedSizeOf999,999.999"
				NumberOfLines			    += PrmNumberOfLines
				NumberOfClosedLines		    += PrmNumberOfClosedLines
				PurchaseOrderLineTotal		+= PrmExtendedAmount
				TotalProductAmount			+= PrmExtendedAmount
				TotalTaxableAmount			+= PrmExtendedTaxableAmount
				StockWeight					+= PrmStockWeight
				StockVolume					+= PrmStockVolume
				AccruedTaxTotal				+= PrmAccruedTaxAmount
				TotalTaxAmount				+= PrmInvoicedTaxAmount

				LocalOpenPurchaseAmount 	= PrmOpenPurchaseAmount
				OpenPurchaseAmount			+= LocalOpenPurchaseAmount

				PrintTotal					+= PrmExtendedAmount + PrmInvoicedTaxAmount
				VendorInvoicedTaxAmount		+= PrmInvoicedTaxAmount
				VendorGrandTotal			+= PrmExtendedAmount + PrmInvoicedTaxAmount
				TotalOrderAmount			+= PrmExtendedAmount + PrmInvoicedTaxAmount + PrmAccruedTaxAmount
				if (PurchaseOrder.AribaPOType entered)
					if (SuppressPOCost)
						EDIOutputOrderAmount	+= PrmEDIOutputLineAmount
					else
						EDIOutputOrderAmount	+= PrmExtendedAmount

				if (not PrmUpdateAmountsOnly)
					if (HasRetainageContract and PurchaseOrderLinesWithContractRetainageRel not exists)
						initialize RetainagePercentCompleteTracking

					include ReleaseLimitsValidation

			Exit Rules
				if (not PrmUpdateAmountsOnly)
					if (PurchaseOrderLineTotal changed)
						for each PurchaseOrderAddOnChargesRel
							if (not each.Canceled)	
								invoke Update each

					if (not PrmBypassVendorUpdate)
						include UpdateVendorOpenPurchaseAmount

		UpdateHeaderAmountsFromAddOnCharge is an Instance Action
			restricted
			Parameters
				PrmTotalAddOnChargeAmount						is an InternationalAmount
				PrmAccruedTaxAmount								is an InternationalAmount
				PrmInvoicedTaxAmount							is an InternationalAmount
				PrmTrackType									is a TrackType
				PrmVendor										is like Vendor
				PrmPrintOnPO									is Boolean
			Action Rules
				if (PrmTotalAddOnChargeAmount entered)
					if (PrmTrackType.Freight)
						FreightTotal += PrmTotalAddOnChargeAmount
					else
					if (PrmTrackType.Insurance)
						InsuranceTotal += PrmTotalAddOnChargeAmount
					else
					if (PrmTrackType.CustomsCharges)
						CustomsTotal += PrmTotalAddOnChargeAmount
					else
						OtherAddOnChargesTotal += PrmTotalAddOnChargeAmount

				AccruedTaxTotal							+= PrmAccruedTaxAmount

				if (PrmVendor = Vendor)
					VendorAddOnChargeAmount 			+= PrmTotalAddOnChargeAmount
					VendorInvoicedTaxAmount				+= PrmInvoicedTaxAmount
					VendorGrandTotal					+= PrmTotalAddOnChargeAmount + PrmInvoicedTaxAmount
				else
					OtherVendorAddOnChargeAmount		+= PrmTotalAddOnChargeAmount
					OtherVendorInvoicedTaxAmount		+= PrmInvoicedTaxAmount
					OtherVendorGrandTotal				+= PrmTotalAddOnChargeAmount + PrmInvoicedTaxAmount


				if (PrmPrintOnPO)
					TotalTaxAmount			+= PrmInvoicedTaxAmount
					PrintTotal				+= PrmTotalAddOnChargeAmount + PrmInvoicedTaxAmount
					AddOnChargeTotal		+= PrmTotalAddOnChargeAmount

				TotalOrderAmount			+= PrmTotalAddOnChargeAmount + PrmInvoicedTaxAmount + PrmAccruedTaxAmount

		UpdateReferenceField is an Instance Action
			restricted
			Parameters
				ParmReference1            is a Reference

			Action Rules
				Reference1    = ParmReference1

		IssueDraftBatch is an Instance Action
			restricted
			Parameters
				PrmIDMBatchID is an IDMPID
			Action Rules
				LocalFromBatch	= true
				LocalIDMBatchID	= PrmIDMBatchID
				invoke IssueDraft

		IssueDraft is an Instance Action
			valid when (ValidForIssueDraft)
			completion message is "<IssueDraftCompletionMessage>"
			Local Fields
				NewPOCommentView	is a PurchaseOrderComment view

			Action Rules
				if (Company.UseIDM)
					if (Buyer.OverrideDocumentTemplate)
						constraint (Company.PurchaseOrderTemplate entered
						or 		   (PurchaseFromLocation entered and PurchaseFromLocationRel.IDMTemplate entered)
						or 		    PurchasingVendorRel.IDMTemplate entered
						or          PurchaseOrderIDMTemplate entered)
							"<IDMTemplateWithHeaderValidationMessage>"
					else
						constraint (Company.PurchaseOrderTemplate entered
						or 		   (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseFromLocation.IDMTemplate entered)
						or 		    PurchasingVendorRel.IDMTemplate entered)
							"<IDMTemplateValidationMessage>"

					if (not Revised
					and PurchaseOrderRevisionsRel not exists)
						increment IDMDocumentSequence by 1

					LocalForIssueDraft = true
					invoke CreateAndSendPODocToIDM
				else
					if (Buyer.OverrideDocumentTemplate)
						constraint (Company.PurchaseOrderDocument entered
						or 		   (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseOrderDocument entered)
						or 		    PurchasingVendorRel.PurchaseOrderDocument entered
						or			PurchaseOrderDocument entered)
							"<NonIDMTemplateWithHeaderValidationMessage>"
					else
						constraint (Company.PurchaseOrderDocument entered
						or 		   (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseOrderDocument entered)
						or 		    PurchasingVendorRel.PurchaseOrderDocument entered)
							"<NonIDMTemplateValidationMessage>"

					initialize LocalMimeType
					invoke SystemCreate PurchaseOrderComment
						assign result to NewPOCommentView
						invoked.Company					= Company
						invoked.PurchaseOrder			= PurchaseOrder
						invoked.CommentTitle			= "Purchase Order Document For Issue Draft"
						invoked.CommentType				= PurchaseOrderComment.CommentType.PurchaseOrderIssue
						if (Buyer.OverrideDocumentTemplate and PurchaseOrderDocument entered)
							invoked.Attachment.File	    = PurchaseOrderDocument.PurchaseOrderDocumentTemplate.File document
							invoked.Attachment.MimeType = PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
							LocalMimeType  				= PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
						else
						if (PurchaseFromLocation entered and PurchaseFromLocationRel.PurchaseOrderDocument entered)
							invoked.Attachment.File		= PurchaseFromLocationRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.File document
							invoked.Attachment.MimeType	= PurchaseFromLocationRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
							LocalMimeType				= PurchaseFromLocationRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
						else
						if (PurchasingVendorRel.PurchaseOrderDocument entered)
							invoked.Attachment.File		= PurchasingVendorRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.File document
							invoked.Attachment.MimeType	= PurchasingVendorRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
							LocalMimeType			    = PurchasingVendorRel.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType
						else
							invoked.Attachment.File		= Company.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.File document
							invoked.Attachment.MimeType	= Company.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType		//"application/rtf"
							LocalMimeType				= Company.PurchaseOrderDocument.PurchaseOrderDocumentTemplate.MimeType

						if (LocalMimeType = "application/rtf")
							invoked.Attachment.Title	= "PurchaseOrderDocument.rtf"
						else
						if (LocalMimeType = "application/pdf")
							invoked.Attachment.Title	= "PurchaseOrderDocument.pdf"
						invoked.LatestDocument			= true
						invoked.IssueType				= 1

			Exit Rules
				if (not Company.UseIDM)
					trigger "PurchaseOrderDraftOutput" PA service
						resume on error 
						title is "PurchaseOrderDraftOutput"
						Variables
							NewPOCommentView.Company
							NewPOCommentView.PurchaseOrder
							NewPOCommentView.SequenceNumber

		UpdateBudgetResults is an Instance Action
			restricted
			Parameters
				ParmSuccess    is Boolean
			Action Rules
				if (ParmSuccess)
					BudgetEditProcessing = BudgetEditProcessing.Success 
					invoke FinalRelease
						invoked.CalledFromBackground = true
				else
					BudgetEditProcessing = BudgetEditProcessing.Failure 
					make transition to Unreleased

		UpdateFromInterface is an Instance Action
			restricted
			Parameters
				SetInterfaceInProcessFalse is Boolean
				ReleasePurchaseOrder       is Boolean
				SetInterfaceInProcessTrue  is Boolean
				SetUpdateInProcessTrue     is Boolean
				PrmOriginatingInterfaceRun is like PurchaseOrderInterfaceResult
				PrmTransientFromMassPOCreateAndRelease is Boolean
			Local Fields
				TransactionError					is Boolean
				TransactionErrorMessage				is Alpha size up to 300

			Action Rules
				if (SetInterfaceInProcessFalse = true)
					InterfaceInProcess = 0
				if (SetInterfaceInProcessTrue = true)
					InterfaceInProcess = 1
				if (SetUpdateInProcessTrue = true)
					InterfaceInProcess = 2
				if (PrmOriginatingInterfaceRun entered)
					OriginatingInterfaceRun = PrmOriginatingInterfaceRun
				LastPurchaseOrderLine = last PurchaseOrderLine set.PurchaseOrderLine

			Exit Rules
				if (ReleasePurchaseOrder = true)
					if (IsUnreleased)
						TransientFromMassPOCreateAndRelease = PrmTransientFromMassPOCreateAndRelease
						invoke Unreleased.Release
							resume on error
								TransactionError		= true
								TransactionErrorMessage	= error message
						if(GeneralLedgerCompanyRel.FinanceEnterpriseGroup.FrontEndSplits
						and TransactionError
						and TransactionErrorMessage[1:5] = "POFES")
							invoke Create PurchaseOrderLineError
								fill in fields from this instance
								invoked.ErrorType 		= PurchaseOrderLineError.ErrorType.FES
								invoked.ErrorMessage	= TransactionErrorMessage

		CreateInvoicePurchaseOrder is an Instance Action
			valid when (PayablesInvoiceAvailable)
			default label is "AddPOToInvoice"
			Parameters
				Company
				PrmPayablesInvoice	is a PayablesInvoice
					default label is "PayablesInvoice"

			Action Rules
				constraint (!MatchPurchaseOrderInvoicesByPORel exist)
					"CreateFailedInvoicePurchaseOrdersExists"

				invoke Create MatchPurchaseOrderInvoice
					invoked.Company						= Company
					invoked.PayablesInvoice				= PrmPayablesInvoice
					invoked.PurchaseOrder				= PurchaseOrder
					invoked.Vendor						= Vendor

		FastUpdate is an Update Action
			restricted
			refresh and lock this instance
			bypass field rules


 		UpdateClosed is an Instance Action
 			restricted
 			Parameters
 				PrmClosed is like Closed
 			Action Rules
 			 	Closed = PrmClosed

		FinishInterface is an Instance Action
			restricted
			Parameters
				PrmReleasePurchaseOrder 	is Boolean
				PrmPOInterfaceResult		is a POInterfaceResult
			Exit Rules
				invoke RecalculatePurchaseOrderAmounts in foreground
					invoked.PrmPurchasingCompany 	= Company
					invoked.PrmPurchaseOrder		= PurchaseOrder
				InterfaceInProcess = InterfaceInProcess.NotInProcess
				if (PrmReleasePurchaseOrder)
					invoke Unreleased.Release PurchaseOrder
						resume on error
							LocalTransactionErrorMessage 	= error message
							LocalReleaseError				= true
					if (LocalReleaseError)
						invoke Create POInterfaceResultDetail
							invoked.FinanceEnterpriseGroup	= GeneralLedgerCompanyRel.FinanceEnterpriseGroup
							invoked.Company					= Company
							invoked.POInterfaceResult		= PrmPOInterfaceResult
							invoked.RecordType				= POInterfaceResultDetail.RecordType.Error
							invoked.PurchaseOrder			= PurchaseOrder
							invoked.ErrorMessage			= ReleaseErrorMessage + LocalTransactionErrorMessage

 		CreateCommentLog is an Instance Action
 			restricted
			Parameters
				PrmCompany			is a PurchasingCompany
				PrmPurchaseOrder is a PurchaseOrder
				PrmComment is Alpha size 50
			Local Fields
				LocalAppendComment					  is Boolean
			Action Rules
				LocalAppendComment = false
				if(PrmPurchaseOrder.HasComment)
					for each PrmPurchaseOrder.PurchaseOrderComment set
						if(each.CommentTitle="PO29" and each.CommentType="E")
							LocalAppendComment = true
							invoke Update each
								invoked.CommentText			+= PrmComment
							end for each
				if(not LocalAppendComment)
					invoke SystemCreate PurchaseOrderComment
						invoked.Company			= PrmCompany
						invoked.PurchaseOrder	= PrmPurchaseOrder
						invoked.CommentTitle	= "PO29"
						invoked.CommentType		= "E"
						invoked.CommentText		= PrmComment

		Resequence is an Instance Action
			valid when (ValidForResequence)


			Local Fields
				LocalLineCounter is Numeric size 6

			Action Rules
				initialize LocalLineCounter

				for each PurchaseOrderLine set
					LocalLineCounter += 1
					if (LocalLineCounter != each.LineNumber)
						invoke FastUpdate each
							invoked.LineNumber = LocalLineCounter


		UpdateFromMatch is an Instance Action	
			restricted
			Parameters
				PrmMatchObjID is Numeric size 12

				PrmLastActivityDate is Date

				PrmConversionRate is a Baserate

				PrmVendorBuyMatchedQuantity is like Quantity

				PrmPOLineVendorBuyUnitCost is an InternationalCost



			Action Rules
				if (PrmMatchObjID entered)
					PurchaseOrderUpdateFromMatchUnmatchFlag = true
				if (PrmLastActivityDate entered)
					LastActivityDate = PrmLastActivityDate
				if (ReceiptCurrencyConversionRate not entered)
					ReceiptCurrencyConversionRate = PrmConversionRate


				if (PurchaseOrderUpdateFromMatchUnmatchFlag)
					initialize CloseDate

					TotalMatchedAmount = TotalMatchedAmount - (PrmVendorBuyMatchedQuantity * PrmPOLineVendorBuyUnitCost)

				if (TotalMatchedAmount < 0)
					initialize TotalMatchedAmount




























				if (HasRetainage)


					initialize TotalMatchedAmount
					for each PurchaseOrderLinesRel
					    if (each.ServiceCode.Amount)
							TotalMatchedAmount	+= each.MatchedAmount
						else
							TotalMatchedAmount	+= (each.MatchedQuantity * each.EnteredUnitCost)
					
					if (PurchaseOrderLineTotal > 0)
						LocalRetainagePercentComplete = TotalMatchedAmount / PurchaseOrderLineTotal
						initialize RoundedValue
						RoundedValue.RoundInput			= LocalRetainagePercentComplete
						RoundedValue.RoundingType		= RoundedValue.RoundingType.Normal
						RoundedValue.RoundTo			= .0001
						RoundedValue.RoundingMethodFW	= RoundedValue.RoundingMethodFW.MultipleOf
						RetainagePercentComplete		= RoundedValue.RoundResult
					else
						initialize RetainagePercentComplete

		FinishCommitmentFromMatch is an Instance Action
			restricted

			Action Rules
				for each PurchaseOrderLineDistributionsCommittedRel
					invoke UpdateGLCommitmentIndirect each
						invoked.PrmFromInvoice = true

		LoadOpenPurchorderDetails is a Set Action 
			restricted
			Parameters
				PrmCashManagementGroup	 	is a CashManagementGroup
				PrmCompany				 	is a GeneralLedgerCompany
				PrmLoadDate				 	is Date
				PrmRunForGroup			 	is Boolean
				PrmIncludeUnreleasedRecords is Boolean

			Parameter Rules
				PrmCashManagementGroup	required
				PrmCompany
					if (!PrmRunForGroup)
						required
				PrmLoadDate				required

			Instance Selection
				where (Company = PrmCompany
				and    OpenPurchaseAmount entered
				and	  ((PrmIncludeUnreleasedRecords
				and   (IsUnreleased
				or     Released)
				and    !Closed.Yes
				and    !Canceled)
				or   (!PrmIncludeUnreleasedRecords
				and	   Released
				and    !Closed.Yes
				and    !Canceled)))

			Sort Order
				Company

			Action Rules
				Empty Set Rules

					increment PrmCashManagementGroup.DirectForecastProcessesCompleted

					if (PrmCashManagementGroup.NumberOfForecastProcessesLeft !entered)
						invoke SummarizeDirectForecastDetail DirectForecastDetail
							if (PrmRunForGroup)
								invoked.PrmCashManagementGroup	= PrmCashManagementGroup
							else
								invoked.PrmCompany = PrmCompany

				Set Rules
					Exit Rules
						increment PrmCashManagementGroup.DirectForecastProcessesCompleted

						if (PrmCashManagementGroup.NumberOfForecastProcessesLeft !entered)
							invoke SummarizeDirectForecastDetail DirectForecastDetail
								if (PrmRunForGroup)
									invoked.PrmCashManagementGroup	= PrmCashManagementGroup
								else
									invoked.PrmCompany = PrmCompany

				Instance Rules

					if (VendorCompanyDefaultRel.CashCode entered)
						LocalCashCode = VendorCompanyDefaultRel.CashCode
					else
					if (Vendor.CashCode exists)
						LocalCashCode = Vendor.CashCode
					else
					if (Vendor.VendorClass.CashCode exists)
						LocalCashCode = Vendor.VendorClass.CashCode
					else
					if (ProcessLevel.CashCode exists)
						LocalCashCode = ProcessLevel.CashCode
					else
					if (Company.CashCode exists)
						LocalCashCode = Company.CashCode
					else
					if (Company.PayGroup.CashCode exists)
						LocalCashCode = Company.PayGroup.CashCode


					initialize LocalOpenTaxAmount
					if (VendorInvoicedTaxAmount entered)
						for each PurchaseOrderLine set
							LocalOpenTaxAmount				+= (each.InvoicedTaxAmount * (each.OpenPurchaseAmount / each.ExtendedAmount))

						for each PurchaseOrderAndLineAddOnCharge set
							LocalOpenTaxAmount				+= (each.InvoicedTaxAmountPOCurrency * (each.DerivedQuantity / each.Quantity))

					invoke Create DirectForecastDetail
						invoked.Company						 = Company
						invoked.DueDate						 = PurchaseOrderDate
						invoked.LoadDate					 = PrmLoadDate
						invoked.SystemCode					 = "PO"
						invoked.Vendor						 = Vendor
						invoked.Name						 = Vendor.VendorName		
						invoked.PurchaseOrder				 = PurchaseOrder
						invoked.PORelease					 = PORelease
						invoked.POCode						 = POCode
						invoked.CashCode		 			 = LocalCashCode
						invoked.CashManagementAccount		 = LocalCashCode.BankAccountNumber
						invoked.ProcessLevel				 = ProcessLevel
						invoked.TransactionCurrency			 = Currency
						invoked.Amount.TransactionAmount	 = ((OpenPurchaseAmount + LocalOpenTaxAmount) * -1)
						invoked.OriginatingTransaction 		 = reference to this instance

		SendRequesterPOCreateNotification is an Instance Action
			restricted
			Local Fields
				LocalActor			is an Actor
			Action Rules
				LocalActor = actor
				send notification
					to LocalActor
					description is "Purchase_\OrderCreationCompleted._\PO<PurchaseOrder>"
					priority is high
					detail is "Purchase_\OrderCreationCompleted._\PO<PurchaseOrder>"
					linkback(webapp is Buyer navigation is ViewPO text is "Purchase_\OrderCreationCompleted._\PO<PurchaseOrder>")

		SendRequesterPOLineAddNotification is an Instance Action
			restricted
			Local Fields
				LocalActor			is an Actor
			Action Rules
				LocalActor = actor
				send notification
					to LocalActor
					description is "LineSuccessfullyAddedTo_\Purchase_Order<PurchaseOrder>"
					priority is high
					detail is "LineSuccessfullyAddedTo_\Purchase_Order<PurchaseOrder>"
					linkback(webapp is Buyer navigation is ViewPO text is "LineSuccessfullyAddedTo_\Purchase_Order<PurchaseOrder>")


































		UpdateFromVendorReturn is an Instance Action
			restricted
			Parameters
				PrmVendorReturn			is a VendorReturn
			Action Rules
				if (PrmVendorReturn entered)
					CreateForVendorReturn	= PrmVendorReturn

		CreatePurchaseOrderRevision is an Instance Action
			restricted
			Action Rules
				increment PurchaseOrderRevision

				invoke Create PurchaseOrderRevision
					invoked.Company					= Company
					invoked.PurchaseOrder			= PurchaseOrder
					invoked.PurchaseOrderRevision	= PurchaseOrderRevision

		UpdatePurchaseOrderFromInterface is an Update Action
			restricted
			Action Rules
				if(PurchaseOrderLifeCycleState.Unreleased)
					invoke Unreleased.Update PurchaseOrder
				else
					if(PurchaseOrderLifeCycleState.Released)
						invoke Released.Update PurchaseOrder

		CancelFromVendorReturn is an Instance Action	
			restricted
			Parameters
				PrmCancelPOFromVendorReturn		is Boolean
			Action Rules
				LocalFromVendorReturn = PrmCancelPOFromVendorReturn
				invoke Released.PerformCancelPurchaseOrder

		UpdateFromPOHeaderComments is an Instance Action
			restricted
			Action Rules
				if (PurchaseOrder.Released)
					invoke Released.Unrelease





		TriggerPOApproveService is an Instance Action
	  	 	restricted
			Action Rules
				if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger and PurchaseOrderApprovalType.ApprovalRequired)
					trigger "BuyerPOApproveService" PA service
						resume on error
						title is "EG:<GeneralLedgerCompanyRel.FinanceEnterpriseGroup>Company:<Company>PO:<PurchaseOrder>"
						Criteria
							GeneralLedgerCompanyRel.FinanceEnterpriseGroup
							Company
						Variables
							Company
							PurchaseOrder
							PORelease
							POCode
							TotalOrderAmount
							Buyer.EmailAddress
								variable name is BuyerEmailAddress





		RefreshBuyerCubes is a Set Action
			restricted
			Parameters
				UpdatePurchaseOrder					is Boolean
				UpdatePurchaseOrderLine				is Boolean
				UpdatePurchaseOrderLineDistribution	is Boolean
				UpdateVendorReturn					is Boolean
				UpdateVendorReturnLine				is Boolean
				UpdateMatchInvoiceMessage			is Boolean
			Parameter Rules
				UpdatePurchaseOrder
					initial value is true
				UpdatePurchaseOrderLine
					initial value is true
				UpdatePurchaseOrderLineDistribution
					initial value is true
				UpdateVendorReturn
					initial value is true
				UpdateVendorReturnLine
					initial value is true
				UpdateMatchInvoiceMessage
					initial value is true

			Action Rules
				Set Rules
					Entrance Rules
						constraint (BasicAnalyticsCalendarsRel exists)
							"YouMustCreateABasicAnalyticsCalendarToUpdateBuyerCubes"

					Exit Rules
						if (UpdatePurchaseOrder)
							invoke Refresh PurchaseOrderAnalyticCubeRel in background

						if (UpdatePurchaseOrderLine)
							invoke Refresh PurchaseOrderLineAnalyticCubeRel in background

						if (UpdatePurchaseOrderLineDistribution)
							invoke Refresh PurchaseOrderLineDistributionAnalyticCubeRel in background

						if (UpdateVendorReturn)
							invoke Refresh VendorReturnAnalyticCubeRel in background

						if (UpdateVendorReturnLine)
							invoke Refresh VendorReturnLineAnalyticCubeRel in background

						if (UpdateMatchInvoiceMessage)
							invoke Refresh MatchInvoiceMessageAnalyticCubeRel in background

		UpdateBuyerCubes is a Set Action
			restricted
			Parameters
				UpdatePurchaseOrder					is Boolean
				PurchaseOrderOption					is a CubeUpdateOption
				UpdatePurchaseOrderLine				is Boolean
				PurchaseOrderLineOption				is a CubeUpdateOption
				UpdatePurchaseOrderLineDistribution	is Boolean
				PurchaseOrderLineDistributionOption is a CubeUpdateOption
				UpdateVendorReturn					is Boolean
				VendorReturnOption					is a CubeUpdateOption
				UpdateVendorReturnLine				is Boolean
				VendorReturnLineOption				is a CubeUpdateOption
				UpdateMatchInvoiceMessage			is Boolean
				MatchInvoiceMessageOption			is a CubeUpdateOption
				UpdateRequisition					is Boolean
				RequisitionOption					is a CubeUpdateOption
				UpdateRequisitionLine				is Boolean
				RequisitionLineOption				is a CubeUpdateOption
				UpdateRequisitionLineDistribution	is Boolean
				RequisitionLineDistributionOption 	is a CubeUpdateOption
				UpdateInventoryTransactions			is Boolean
				InventoryTransactionsOption			is a CubeUpdateOption
				UpdateInventoryUsageHistory			is Boolean
				InventoryUsageHistoryOption			is a CubeUpdateOption
				UpdateItemLocation					is Boolean
				ItemLocationOption					is a CubeUpdateOption
				UpdatePayablesInvoice				is Boolean
				PayablesInvoiceOption				is a CubeUpdateOption
				UpdatePayablesInvoicePayment		is Boolean
				PayablesInvoicePaymentOption		is a CubeUpdateOption
				UpdatePayablesInvoiceDistribution	is Boolean
				PayablesInvoiceDistributionOption	is a CubeUpdateOption
			Parameter Rules
				UpdatePurchaseOrder
					initial value is true
				PurchaseOrderOption
					initial value is 1 
				UpdatePurchaseOrderLine
					initial value is true
				PurchaseOrderLineOption
					initial value is 1 
				UpdatePurchaseOrderLineDistribution
					initial value is true
				PurchaseOrderLineDistributionOption
					initial value is 1 
				UpdateVendorReturn
					initial value is true
				VendorReturnOption
					initial value is 1 
				UpdateVendorReturnLine
					initial value is true
				VendorReturnLineOption
					initial value is 1 
				UpdateMatchInvoiceMessage
					initial value is true
				MatchInvoiceMessageOption
					initial value is 1 
				UpdateRequisition
					initial value is true
				RequisitionOption
					initial value is 1 
				UpdateRequisitionLine
					initial value is true
				RequisitionLineOption
					initial value is 1 
				UpdateRequisitionLineDistribution
					initial value is true
				RequisitionLineDistributionOption
					initial value is 1 
				UpdateInventoryTransactions
					initial value is true
				InventoryTransactionsOption
					initial value is 1 
				UpdateInventoryUsageHistory
					initial value is true
				InventoryUsageHistoryOption
					initial value is 1 
				UpdateItemLocation
					initial value is true
				ItemLocationOption
					initial value is 1 
				UpdatePayablesInvoice
					initial value is true
				PayablesInvoiceOption
					initial value is 1 
				UpdatePayablesInvoicePayment
					initial value is true
				PayablesInvoicePaymentOption
					initial value is 1 
				UpdatePayablesInvoiceDistribution
					initial value is true
				PayablesInvoiceDistributionOption
					initial value is 1 

			Action Rules
				Set Rules
					Entrance Rules
						constraint (BasicAnalyticsCalendarsRel exists)
							"YouMustCreateABasicAnalyticsCalendarToUpdateBuyerCubes"

					Exit Rules
						if (UpdatePurchaseOrder)
							if (PurchaseOrderOption.Refresh)
								invoke Refresh PurchaseOrderAnalyticCubeRel in background
							else
								invoke Reload PurchaseOrderAnalyticCubeRel in background
						if (UpdatePurchaseOrderLine)
							if (PurchaseOrderLineOption.Refresh)
								invoke Refresh PurchaseOrderLineAnalyticCubeRel in background
							else
								invoke Reload PurchaseOrderLineAnalyticCubeRel in background
						if (UpdatePurchaseOrderLineDistribution)
							if (PurchaseOrderLineDistributionOption.Refresh)
								invoke Refresh PurchaseOrderLineDistributionAnalyticCubeRel in background
							else
								invoke Reload PurchaseOrderLineDistributionAnalyticCubeRel in background
						if (UpdateVendorReturn)
							if (VendorReturnOption.Refresh)
								invoke Refresh VendorReturnAnalyticCubeRel in background
							else
								invoke Reload VendorReturnAnalyticCubeRel in background
						if (UpdateVendorReturnLine)
							if (VendorReturnLineOption.Refresh)
								invoke Refresh VendorReturnLineAnalyticCubeRel in background
							else
								invoke Reload VendorReturnLineAnalyticCubeRel in background
						if (UpdateMatchInvoiceMessage)
							if (MatchInvoiceMessageOption.Refresh)
								invoke Refresh MatchInvoiceMessageAnalyticCubeRel in background
							else
								invoke Reload MatchInvoiceMessageAnalyticCubeRel in background
						if (UpdateRequisition)
							if (RequisitionOption.Refresh)
								invoke Refresh RequisitionAnalyticCubeRel in background
							else
								invoke Reload RequisitionAnalyticCubeRel in background
						if (UpdateRequisitionLine)
							if (RequisitionLineOption.Refresh)
								invoke Refresh RequisitionLineAnalyticCubeRel in background
							else
								invoke Reload RequisitionLineAnalyticCubeRel in background
						if (UpdateRequisitionLineDistribution)
							if (RequisitionLineDistributionOption.Refresh)
								invoke Refresh RequisitionLineDistributionAnalyticCubeRel in background
							else
								invoke Reload RequisitionLineDistributionAnalyticCubeRel in background
						if (UpdateInventoryTransactions)
							if (InventoryTransactionsOption.Refresh)
								invoke Refresh InventoryTransactionLineAnalyticCubeRel in background
							else
								invoke Reload InventoryTransactionLineAnalyticCubeRel in background
						if (UpdateInventoryUsageHistory)
							if (InventoryUsageHistoryOption.Refresh)
								invoke Refresh InventoryUsageHistoryAnalyticCubeRel in background
							else
								invoke Reload InventoryUsageHistoryAnalyticCubeRel in background
						if (UpdateItemLocation)
							if (ItemLocationOption.Refresh)
								invoke Refresh ItemLocationAnalyticCubeRel in background
							else
								invoke Reload ItemLocationAnalyticCubeRel in background
						if (UpdatePayablesInvoice)
							if (PayablesInvoiceOption.Refresh)
								invoke Refresh PayablesInvoiceAnalyticCubeRel in background
							else
								invoke Reload PayablesInvoiceAnalyticCubeRel in background
						if (UpdatePayablesInvoicePayment)
							if (PayablesInvoicePaymentOption.Refresh)
								invoke Refresh PayablesInvoicePaymentAnalyticCubeRel in background
							else
								invoke Reload PayablesInvoicePaymentAnalyticCubeRel in background
						if (UpdatePayablesInvoiceDistribution)
							if (PayablesInvoiceDistributionOption.Refresh)
								invoke Refresh PayablesInvoiceDistributionAnalyticCubeRel in background
							else
								invoke Reload PayablesInvoiceDistributionAnalyticCubeRel in background

		DeletePatientProcedure is an Instance Action
			restricted
			Action Rules
				if (PatientProcedure entered)
					LocalPatientProcedure = PatientProcedure
					initialize PatientProcedure
				if (not LocalDeleteHeader)
					initialize DefaultProcedureInformation
				initialize LocalDeleteHeader
			Exit Rules
				if (LocalPatientProcedure entered)
					invoke Delete PatientProcedureRel

		ResetPurchaseOrderTotals is an Instance Action
			restricted
			Action Rules

				initialize NumberOfLines
				initialize NumberOfClosedLines
				initialize PurchaseOrderLineTotal
				initialize TotalProductAmount
				initialize TotalTaxableAmount
				initialize StockWeight
				initialize StockVolume
				initialize AccruedTaxTotal
				initialize TotalTaxAmount
				initialize OpenPurchaseAmount
				initialize PrintTotal
				initialize VendorInvoicedTaxAmount
				initialize VendorGrandTotal
				initialize TotalOrderAmount

				initialize FreightTotal
				initialize InsuranceTotal
				initialize CustomsTotal
				initialize OtherAddOnChargesTotal
				initialize VendorAddOnChargeAmount
				initialize OtherVendorAddOnChargeAmount
				initialize OtherVendorInvoicedTaxAmount
				initialize OtherVendorGrandTotal
				initialize AddOnChargeTotal

		ProcessPOUpdate is an Instance Action		
			restricted
			Parameters
				PrmCompany			is a PayablesCompany
				PrmPayablesInvoice 	is a PayablesInvoice
			Action Rules

				LocalCompany				= PrmCompany
				LocalPayablesInvoice		= PrmPayablesInvoice
				for each PurchaseOrderLinesRel				
					LocalPurchaseOrderLine	= each.PurchaseOrderLine
					if (LocalInvoiceDetailRel exists)
						invoke ReopenLine each
							invoked.PrmCompany		   = Company
							invoked.PrmPayablesInvoice = PayablesInvoice

				LastActivityDate	= current corporate date

				for each PurchaseOrderAndLineAddOnChargeRel		
					invoke UpdateAOCInvoiceOnCancel each


		FinalRelease is an Instance Action
			restricted
			Parameters
				CalledFromBackground		is Boolean

			Action Rules
				Released		= true
				Closed			= Closed.No

				if (!IssueMethod.DoNotPrint)
					if ((Canceled
					or   PurchaseOrderLinesWithQuantityToProcessRel not exists)
					and (IsNotIssued
					and PurchaseOrderRevision = 0))
						IssuePending = false
					else
						IssuePending = true
				else
					Issued 			= true
					IssuePending	= true






				LocalOpenPurchaseAmount = OpenPurchaseAmount

				if (DerivedRowCount > DerivedForegroundLimit 
				or SingleCallToOneSource)

					make transition to ReleaseInProgress
					invoke BatchRelease PurchaseOrderLine	
						invoked.PrmCompany			= Company
						invoked.PrmPurchaseOrder	= PurchaseOrder
				else
					invoke Release UnreleasedPurchaseOrderLinesRel
					if (SingleCallToVertex)
						invoke ProcessVertexForPOLines PurchaseOrderLine
							invoked.PrmCompany				= Company
							invoked.PrmPurchaseOrder 		= PurchaseOrder
					else 
					if  (VertexDelayTaxCall)
						for each PurchaseOrder.TaxablePurchaseOrderAddOnChargesRel
							invoke CalculateVertexLandedUnitCost each 





					make transition to Released


			Exit Rules
				if (PatientProcedureInfoExists)
					LocalDeleteHeader = true
					invoke DeletePatientProcedure


				include UpdateVendorOpenPurchaseAmount

				if	(AribaPOType entered)
					include UpdateEDIOutputOrderAmount

				if (GeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
				or  GeneralLedgerSystemCodeRel.EncumbranceOption.Track)
					invoke UpdateToReleased GLCommit
						run outside of action background group
						invoked.PrmFinanceEnterpriseGroup           = GeneralLedgerCompanyRel.FinanceEnterpriseGroup
						invoked.PrmUniqueID                         = UniqueID
						invoked.PrmAccountingEntity                 = Company.AccountingEntity



				invoke NotifyPOContract BlanketOrStandingContract
					invoked.PrmTotalContractAmount = sum PurchaseOrderLinesRel.ContractAmount
					invoked.PrmCompany			   = Company
					invoked.PrmPurchaseFromLocation= ShipToLocation

				if (ContractLinesExist)
					for each LinesForAContractLineRel
						LocalContract          = each.Contract
						LocalPurchaseOrderLine = each.PurchaseOrderLine
						if (LaterPOLineForAContractRel !exists
						and LocalContractRel.UseCommitments)
							invoke FinishUpdateContractAmounts LocalContractRel

				invoke TriggerPurchaseOrder
				invoke TriggerPOApproveService

				if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.IDMConfiguration.UpdatePurchaseOrderAttributes)
					invoke UpdateIDMAttributes
						invoked.AttrsSearch.IDMAttribute[1].IDMAttributeName	= "Company"
						invoked.AttrsSearch.IDMAttribute[1].IDMAttributeValue 	= Company
						invoked.AttrsSearch.IDMAttribute[2].IDMAttributeName  	= "PurchaseOrder"
						invoked.AttrsSearch.IDMAttribute[2].IDMAttributeValue  	= PurchaseOrder

		TransitionToReleased is an Instance Action
			restricted
			Local Fields
				LocalActor					 is an Actor
			Action Rules
				if (PurchaseOrderLifeCycleState.Closed)
					Closed = Closed.No
				else
					LocalActor = actor
					send notification
						to LocalActor
						description is "Purchase_Order<PurchaseOrder>HasBeenReleased."
						priority is medium
						detail is "Purchase_Order<PurchaseOrder>HasBeenReleased."
						linkback(webapp is Buyer navigation is ViewPO text is "PurchaseOrder<PurchaseOrder>HasBeenReleased.")
				make transition to Released

		TransitionToUnreleased is an Instance Action
			restricted
			Action Rules
				LastPurchaseOrderLine = last PurchaseOrderLine set.PurchaseOrderLine
				make transition to Unreleased

		TransitionToCreateInProgress is an Instance Action
			restricted
			Action Rules
				make transition to CreateInProgress

		TransitionReleaseInProgress is an Instance Action
			restricted
			Action Rules
				if (PurchaseOrderLifeCycleState.Closed)
					Closed = Closed.No
					make transition to ReleaseInProgress

		TransitionToCanceled is an Instance Action
			restricted
			Action Rules
				make transition to Canceled

		DeletePurchaseOrder is a Delete Action
			restricted
			Parameters
				PrmFromUnreleased is Boolean

			Entrance Rules
				if (IsDeleteInProgress)
					make transition to Deleted

				if (PatientProcedureInfoExists)
					LocalDeleteHeader = true
					invoke DeletePatientProcedure

				if (PrmFromUnreleased
				and VendorReturn entered
				and not VendorReturn.VendorClaimType.CreditMemo)
					invoke WaitingForVendorAction.Cancel VendorReturn

				if (GeneralLedgerSystemCodeRel.EncumbranceOption.TrackAndEdit
				or  GeneralLedgerSystemCodeRel.EncumbranceOption.Track)
					invoke Delete BudgetRebuildBTGTRel
					invoke Delete HeaderBudgetEditErrorRel
					invoke Delete DistributionBudgetEditErrorRel
					invoke Delete BudgetEditBatchRel
					invoke Delete BudgetTemplateGroupTotalRel
					invoke Purge  GLCommitDrillRel
				invoke Delete PurchaseOrderDiversityListRel
				invoke Delete InterfacedPurchaseOrderRel

		BODDataInitialLoadPurchaseOrderCriteria is a Set Action
			restricted
			Parameters
				PrmFromCompany					is a PurchasingCompany
				PrmToCompany					is a PurchasingCompany
				PrmFromPurchaseOrder			is a PurchaseOrder
					context of PrmFromCompany
				PrmToPurchaseOrder				is a PurchaseOrder
					context of PrmFromCompany
				PrmDateRange					is a DateRange

			Parameter Rules
			Instance Selection
				where  (((PrmFromCompany entered
				and		  PrmFromCompany <= Company)
				or		  PrmFromCompany not entered)
				and		((PrmToCompany entered
				and		  PrmToCompany >= Company)
				or		  PrmToCompany not entered)
				and    ((PrmFromPurchaseOrder entered
				and		 PrmFromPurchaseOrder <= PurchaseOrder)
				or		 PrmFromPurchaseOrder not entered)
				and    ((PrmToPurchaseOrder entered
				and		 PrmToPurchaseOrder >= PurchaseOrder)
				or		 PrmToPurchaseOrder not entered)
				and	 	(PurchaseOrderDate within PrmDateRange
				or	     PrmDateRange not entered)
				and     (PurchaseOrderLifeCycleState.Released
				or		PurchaseOrderLifeCycleState.Closed
				or		PurchaseOrderLifeCycleState.Canceled))

			Sort Order
				PurchaseOrder

			Local Fields

			Action Rules

				Instance Rules
					if (GeneralLedgerCompanyRel.FinanceEnterpriseGroup.BODTrigger)
						ActionCode	= ActionCode.Create
						increment bod id.VariationID
						LocalMassBODTrigger = true
						include TriggerPurchaseOrderRules
						invoke TriggerProcessPurchaseOrder
						include TriggerBRPurchaseOrder		

		PurgeClosedPurchaseOrder is a Set Action
			restricted
			Parameters
				PrmCompany						is a PurchasingCompany
				PrmPurgePO						is AlphaUpper size 1
					States
						PurgePurchaseOrders		value is "Y"
						ReportOnlyDoNotPurge	value is "R"
				PrmPurgeCutOffDate				is Date
				PrmFromPurgeAll					is Boolean

			Local Fields
				LocalSetPurgeCount				is Numeric 10
				AsyncId							is a AsyncActionRequest
				LocalIDMConnection				is Boolean
				
			Parameter Rules
				PrmCompany
					required
					constraint (PrmCompany.FinanceEnterpriseGroup.PurgeCutOffDate entered)
						"PurgeCutOffDateMustBeSetFor_Finance_Enterprise_Group<PrmCompany.FinanceEnterpriseGroup>"
					
				PrmPurgePO
					initial value is "R"
					default to "R"
				PrmPurgeCutOffDate
					default to PrmCompany.FinanceEnterpriseGroup.PurgeCutOffDate


			Instance Selection
				include deleted records
				where (Company    =  PrmCompany
				and   (CloseDate <= PrmPurgeCutOffDate
				and    not Closed.No))

			Set Is
				PrmCompany
				
			Action Rules
				Empty Set Rules
					if (not PrmFromPurgeAll)
						LocalActor = actor
						send notification
							to LocalActor
							description is "NoPurchaseOrderRecordsFoundToPurge"
							priority is high
							detail is "ThereAreNoPurchaseOrderRecordsPurged"

				Set Rules
					Entrance Rules
						AsyncId = current async action request id
						if (DerivedIDMConnected)
							LocalIDMConnection = true

					Exit Rules
						if (PrmPurgePO.PurgePurchaseOrders)
							LocalPurgeRecords = true
						if (not PrmFromPurgeAll)
							LocalActor = actor
							LocalPurgeCount = LocalSetPurgeCount
							send notification
								to LocalActor
								description is "PurchaseOrderPurgeHasBeenCompleted"
								priority is high
								detail is "<DerivedCompletionDetailText>"

                Instance Rules
                    if (VendorReturnLinesRel not exists)
                        LocalSetPurgeCount +=1
                        if (PrmPurgePO.PurgePurchaseOrders)
                            if (instance count of PurgePurchaseOrderLineRel > DerivedForegroundLimit)
                                invoke PurgePurchaseOrderLineSet PurchaseOrderLine in background
                                    assign async action request id to AsyncId
                                    invoked.PrmCompany                  = Company
                                    invoked.PrmPurchaseOrder            = PurchaseOrder
                                invoke PurgePurchaseOrder in background
                                    run after AsyncId
                                    assign async action request id to AsyncId
                                    invoked.PrmIDMConnection = LocalIDMConnection
                            else
                                invoke PurgePurchaseOrderLineSet PurchaseOrderLine in foreground
                                    invoked.PrmCompany                  = Company
                                    invoked.PrmPurchaseOrder            = PurchaseOrder
                                invoke PurgePurchaseOrder in foreground
                                    invoked.PrmIDMConnection = LocalIDMConnection
 
								
		PurgePurchaseOrder is an Instance Action
			restricted
			Parameters
				PrmIDMConnection is Boolean
			Entrance Rules
				LocalPurgePurchaseOrder = true

				if (PatientProcedureInfoExists)
					LocalDeleteHeader = true
					invoke DeletePatientProcedure

				invoke Purge PurgeProcurementTransactionDistributionRel
				invoke Purge PurgePurchaseOrderAddOnChargesRel
				invoke Purge PurgePurchaseOrderCommentRel
				invoke Purge PurgePurchaseOrderSpreadAddOnChargeRel
				invoke Purge PurgePurchaseOrderRevisionsRel

				if (PrmIDMConnection and not archiving enabled)
					invoke ArchivePurchaseOrderIDMDocument
						resume on error

			Action Rules
				invoke Purge

		ArchivePurchaseOrderIDMDocument is an Instance Action
			restricted
			Local Fields
				LocalExecute			is Boolean
				AttrSearch				is an IDMAttributeOccurs
			Action Rules
				AttrSearch.IDMAttribute[1].IDMAttributeName		= "Company"
				AttrSearch.IDMAttribute[1].IDMAttributeValue	= Company
				AttrSearch.IDMAttribute[2].IDMAttributeName		= "PurchaseOrder"
				AttrSearch.IDMAttribute[2].IDMAttributeValue	= PurchaseOrder

				IDMBatchOperation.AttributeSearch				= AttrSearch
				IDMBatchOperation.IDMDocumentType				= "FSM_PurchaseOrder"
				LocalExecute									= IDMBatchOperation.ArchiveByAttributes

		Purge is a Purge Action
			restricted
			bypass relational integrity rules

		ClosePurchaseOrderHeader is a Set Action 
			restricted
			Parameters
				PrmCompany                 	is a PurchasingCompany
					default label is "Company"
				PrmCompanyGroup       	is a GeneralLedgerCompanyGroup
					default label is "CompanyGroup"
				PrmFromDate               	is Date
					default label is "FromDate"
				PrmToDate                  	is Date
					default label is "ToDate"
				PrmRunDate					is TimeStamp

			Local Fields
				LocalAsyncID				is an AsyncActionRequest

			Instance Selection
				where 	(Company = PrmCompany
					and  Closed.No
					and ((LastActivityDate not entered
					and ((PrmFromDate not entered or PurchaseOrderDate >= PrmFromDate)
					and (PurchaseOrderDate <= PrmToDate)))
					or  ((PrmFromDate not entered or LastActivityDate >= PrmFromDate)
					and (LastActivityDate <= PrmToDate)))
					and (IsReleased or (Canceled and HasLines))
					and NumberOfClosedLines = NumberOfLines 
					and not HasAddOnChargesNotAvailableForClosing
					and not HasUnreleasedReceipts
					and not IsNeedsApproval)

			Sort Order
				Company

			Action Rules
				Empty Set Rules
					LocalActor = actor
					send notification
						to LocalActor
						description is "NoPurchaseOrderHeadersClosed."
						priority is low

				Set Rules
					Entrance Rules
						LocalAsyncID = current async action request id

					Exit Rules
						invoke BatchAOCCloseAndAdjust PurchaseOrderAndLineAddOnCharge
							run after LocalAsyncID
							invoked.PrmCompany 			= PrmCompany

				Instance Rules

					make transition to Closed
					Closed = Closed.Yes
					CloseDate = current corporate date
					invoke TriggerPurchaseOrder

					invoke Create POCloseResult 
						invoked.GeneralLedgerCompanyGroup 			= PrmCompanyGroup
						invoked.PurchasingCompany					= Company
						invoked.PurchaseOrder						= PurchaseOrder
						invoked.RunDate								= PrmRunDate
						
		PutOnHold is an Instance Action
			restricted
			Action Rules
				TemporaryHold = TemporaryHold.SentForApproval
				for each PurchaseOrderLineRel
					invoke PutOnHold each
					
		TaxEngineApprove is an Instance Action 
			restricted
			Action Rules
				TemporaryHold = TemporaryHold.ApprovedByEngine
				for each PurchaseOrderLineRel
					invoke TaxEngineApprove each
					
		TaxEngineReject is an Instance Action
			restricted
			Action Rules
				TemporaryHold = TemporaryHold.RejectedByEngine
				for each PurchaseOrderLineRel
					invoke TaxEngineReject each

		FinishManualProcess is an Instance Action
			valid when (ForSupplierNotAcknowledged)
			Action Rules
				invoke FastUpdate
					invoked.AcknowledgedViaSupplierPortal = true
				invoke ProcessPurchaseOrderEDIAcknowledgement PurchaseOrderEDIAcknowledgement
					invoked.ManualProcessing	= true
					invoked.PrmRunGroup			= PurchaseOrder
					invoked.PrmCompany			= Company
					invoked.PrmPurchaseOrder	= PurchaseOrder
					invoked.PrmVendor        	= Vendor
					invoked.EnableGLNProcessing = true
					invoked.SendEmailToBuyers   = true

		MobileQuickRelease is an Instance Action
			restricted
			completion message is "<ReleaseMessage>"
			valid when (AllowRelease)
			Action Rules
				invoke Unreleased.Release
FileCreationLogic.PurchaseOrder is a BusinessClass

	Persistent Fields
	
	Local Fields
					
	Relations
		
	Derived Fields
				
	Actions
	
		GeneratePreviewRecordsForRunGroup is a Set Action
			restricted
			synchronized on untranslatable:"PurchaseOrder_GeneratePreviewRecordsForRunGroup_<FinanceEnterpriseGroupPrm>_<PrmRunGroup>"

			Parameters
				FinanceEnterpriseGroupPrm		is a FinanceEnterpriseGroup
				FileCreationSetupPrm	is a FileCreationSetup
				BeginTimeStamp			is TimeStamp
				EndTimeStamp			is TimeStamp
				AllRecords				is Boolean
				PrmNumberOfRunGroups	is Numeric 3
				PrmRunGroup				is Numeric 3
				
			Local Fields
				LocalPurchaseOrderGroupSelection		is a PurchaseOrder group in subject FileCreationPurchaseOrder

			Instance Selection
				where (GeneralLedgerCompanyRel.FinanceEnterpriseGroup = FinanceEnterpriseGroupPrm
				and    (PrmNumberOfRunGroups <= 1
				or      PurchaseOrder % PrmNumberOfRunGroups = PrmRunGroup)
				and	   (AllRecords
				or	    (update stamp > BeginTimeStamp
				and	     update stamp <= EndTimeStamp)))

			Action Rules
				Instance Rules
					LocalPurchaseOrderGroupSelection = FileCreationSetupPrm.EligibilityGroup
					if (LocalPurchaseOrderGroupSelection not entered
					or	PurchaseOrder within LocalPurchaseOrderGroupSelection)
						invoke Create FileCreationRecord
							invoked.FinanceEnterpriseGroup		= FinanceEnterpriseGroupPrm
							invoked.FileCreationSetup	= FileCreationSetupPrm
							invoked.Key1				= Company
                            invoked.Key2		        = PurchaseOrder
							invoked.SystemTimeStamp		= EndTimeStamp
							invoked.EffectiveDate		= system current corporate date
							invoked.Status				= 1
