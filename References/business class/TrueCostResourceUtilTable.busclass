TrueCostResourceUtilTable is a BusinessClass
	owned by truecost
	
	prefix is TCRUT
	default label is "True\CostResource_byCostObject"
	Ontology
		symbolic key is TrueCostResourceUtilTable
		
	
	Patterns
		disable Auditing
		disable EffectiveDated
		disable AsOfDateProcessing
		
	Persistent Fields
		Count					is Numeric 5
		TrueCostWeight
		AveProcedureTime		is Decimal 5.3
			default label is "AverageProcedureTimeInMinutes"
		SerialNo				is Alpha 25
		
	Field Rules
		Count
			required
		TrueCostWeight
			required
		AveProcedureTime
			required

	Relations
		ResourceRateRel
			one-to-many relation to TrueCostResourceRateTable
			Field Mapping uses symbolic key
				related.TrueCostConfiguration 								= LocalTrueCostConfiguration
				related.TrueCostResourceRateTable.AccountingEntity 			= TrueCostResourceUtilTable.AccountingEntity
				related.TrueCostResourceRateTable.Department 				= TrueCostResourceUtilTable.Department
				related.TrueCostResourceRateTable.ResourceName 				= TrueCostResourceUtilTable.ResourceUsed
				related.TrueCostResourceRateTable.EffectivePeriod 			= LocalEffectivePeriod

		TrueCostWeightDataInterfaceRel
			one-to-many relation to TrueCostWeightDataInterface
			Field Mapping uses symbolic key
				related.TrueCostConfiguration								= LocalTrueCostConfiguration
			Instance Selection
				where (related.TrueCostWeightDataInterface.TrueCostWeight	= LocalTrueCostWeight
				and    related.TrueCostWeightDataInterface.AccountingEntity	= ResourceRateRel.TrueCostResourceRateTable.AccountingEntity
				and    related.TrueCostWeightDataInterface.Department		= TrueCostResourceUtilTable.Department
				and    related.TrueCostWeightDataInterface.CostObject		= TrueCostResourceUtilTable.CostObject
				and    related.TrueCostWeightDataInterface.StartDate		= TrueCostResourceUtilTable.UseDate)
		
		TrueCostWeightDataInterfaceItemsRel
			one-to-many relation to TrueCostWeightDataInterface
			Field Mapping uses symbolic key
				related.TrueCostConfiguration								= LocalTrueCostConfiguration
			Instance Selection
				where (related.TrueCostWeightDataInterface.TrueCostWeight	= LocalTrueCostWeight
				and    related.TrueCostWeightDataInterface.RunGroup			= LocalRunGroup
				and    related.TrueCostWeightDataInterface.Department		= TrueCostResourceUtilTable.Department
				and    related.TrueCostWeightDataInterface.StartDate		= TrueCostResourceUtilTable.UseDate)
		
		TrueCostWeightRel
			one-to-many relation to TrueCostWeight
			Field Mapping uses symbolic key
				related.TrueCostConfiguration							= LocalTrueCostConfiguration
				related.TrueCostWeight									= LocalTrueCostWeight
				
		TrueCostResourceListRel
			one-to-many relation to TrueCostResourceList
			Field Mapping uses symbolic key
				related.TrueCostConfiguration							= LocalTrueCostConfiguration
				related.TrueCostResourceList.ResourceName				= TrueCostResourceUtilTable.ResourceUsed
				
		TrueCostResourceUtilRel
			one-to-many relation to TrueCostResourceUtilTable
			Field Mapping uses symbolic key
				related.TrueCostConfiguration							= LocalTrueCostConfiguration
			Instance Selection
				where ((related.TrueCostResourceUtilTable.UseDate month	= LocalEffectivePeriod month)
				and		(related.TrueCostResourceUtilTable.UseDate year	= LocalEffectivePeriod year))

   		DepartmentAccountingUnitRel
			one-to-one relation to AccountingUnit		
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	    = TrueCostConfiguration
				related.AccountingEntity			= TrueCostResourceUtilTable.AccountingEntity
				related.AccountingUnit	   			= TrueCostResourceUtilTable.Department
    	
		Department1Rel
			one-to-many relation to FinanceDimension1
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration
				related.FinanceDimension1 			= TrueCostResourceUtilTable.Department
			
    	Department2Rel
			one-to-many relation to FinanceDimension2
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration
				related.FinanceDimension2 			= TrueCostResourceUtilTable.Department
				
		Department3Rel
			one-to-many relation to FinanceDimension3
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration
				related.FinanceDimension3 			= TrueCostResourceUtilTable.Department	
			
				
		Department4Rel
			one-to-many relation to FinanceDimension4
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup		= TrueCostConfiguration
				related.FinanceDimension4			= TrueCostResourceUtilTable.Department
				
		Department5Rel
			one-to-many relation to FinanceDimension5
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup		= TrueCostConfiguration
				related.FinanceDimension5			= TrueCostResourceUtilTable.Department
				
		Department6Rel
			one-to-many relation to FinanceDimension6
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration
				related.FinanceDimension6			= TrueCostResourceUtilTable.Department
				
		Department7Rel
			one-to-many relation to FinanceDimension7
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension7			= TrueCostResourceUtilTable.Department	
				
		Department8Rel
			one-to-many relation to FinanceDimension8
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration				
				related.FinanceDimension8			= TrueCostResourceUtilTable.Department
				
		Department9Rel
			one-to-many relation to FinanceDimension9
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup		= TrueCostConfiguration
				related.FinanceDimension9			= TrueCostResourceUtilTable.Department
				
		Department10Rel
			one-to-many relation to FinanceDimension10
			Field Mapping uses symbolic key	
				related.FinanceEnterpriseGroup		= TrueCostConfiguration
				related.FinanceDimension10			= TrueCostResourceUtilTable.Department
		
		CostObject1Rel
			one-to-one relation to FinanceDimension1
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension1 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject2Rel
			one-to-one relation to FinanceDimension2
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension2 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject3Rel
			one-to-one relation to FinanceDimension3
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension3 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject4Rel
			one-to-one relation to FinanceDimension4
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension4 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject5Rel
			one-to-one relation to FinanceDimension5
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension5 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject6Rel
			one-to-one relation to FinanceDimension6
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension6 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject7Rel
			one-to-one relation to FinanceDimension7
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension7 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject8Rel
			one-to-one relation to FinanceDimension8
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension8 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject9Rel
			one-to-one relation to FinanceDimension9
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension9 			= TrueCostResourceUtilTable.CostObject		
		
		CostObject10Rel
			one-to-one relation to FinanceDimension10
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup 		= TrueCostConfiguration	
				related.FinanceDimension10 			= TrueCostResourceUtilTable.CostObject		
		
				
	Local Fields

		LocalTrueCostConfiguration		is like TrueCostConfiguration
		LocalEffectivePeriod			is Date
		LocalTrueCostWeight				is Alpha 25
		LocalRunGroup					is Alpha 30

	Derived Fields
		ComputedWeight			is a ComputeField
			type is Decimal 19.3
			(ResourceRateRel.AverageResourceRate * Count * AveProcedureTime)
			







		DepartmentDescription is a DerivedField
			type is like Description
			if(TrueCostConfiguration.DepartmentIsAccountingUnit)
				return DepartmentAccountingUnitRel.Description
			if (TrueCostConfiguration.DepartmentIsDimension1)
				return Department1Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension2)
				return Department2Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension3)
				return Department3Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension4)
				return Department4Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension5)
				return Department5Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension6)
				return Department6Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension7)
				return Department7Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension8)
				return Department8Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension9)
				return Department9Rel.Description
			if (TrueCostConfiguration.DepartmentIsDimension10)
				return Department10Rel.Description
			
		CostObjectDescription is a DerivedField
			type is like Description
			if (TrueCostConfiguration.CostObjectIsDimension1)
				return CostObject1Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension2)
				return CostObject2Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension3)
				return CostObject3Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension4)
				return CostObject4Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension5)
				return CostObject5Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension6)
				return CostObject6Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension7)
				return CostObject7Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension8)
				return CostObject8Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension9)
				return CostObject9Rel.Description
			if (TrueCostConfiguration.CostObjectIsDimension10)
				return CostObject10Rel.Description
		
	Actions
		Create is a Create Action
		
		Update is an Update Action
			Entrance Rules
				
			Exit Rules
					
		Delete is a Delete Action
		
		GenerateWeightData		is a Set Action
			Parameters
				PrmTCConfig						is a TrueCostConfiguration
					default label is "True\CostConfiguration"
					
				PrmRunGroup				is AlphaUpper 30
					default label is "RunGroup"
					
				PrmTCWeight				is a TrueCostWeight
					default label is "True\CostWeight"
					
				PrmEffectiveDate		is Date
					default label is "EffectivePeriod"
					
			Parameter Rules
				PrmTCConfig
					required
					LocalTrueCostConfiguration = PrmTCConfig
				PrmRunGroup
					required
				PrmTCWeight
					LocalTrueCostWeight = PrmTCWeight
					required
						constraint (TrueCostWeightRel.ResourceRate)
							"True\CostWeightMustBeResourceRate"
				PrmEffectiveDate
					required
					IsFirstIteration = true
					LocalEffectivePeriod = PrmEffectiveDate
						constraint(TrueCostResourceUtilRel exists)
							"NoResource_available_for_the_selected_period."
							
			Instance Selection
				where (LocalTrueCostConfiguration = PrmTCConfig
				and    TrueCostWeight = PrmTCWeight)
				
			Local Fields
				IsFirstIteration is Boolean
				LastDayDateContainer is Date	
			
			Action Rules
				Instance Rules
					LocalRunGroup = PrmRunGroup
					LocalTrueCostConfiguration = PrmTCConfig
					LocalTrueCostWeight = PrmTCWeight
					if (IsFirstIteration)
						LocalEffectivePeriod = PrmEffectiveDate
						if (!LocalEffectivePeriod is last day in month)
							while(!LocalEffectivePeriod is last day in month)
								LocalEffectivePeriod += 1 day
						LastDayDateContainer = LocalEffectivePeriod
						if(TrueCostWeightDataInterfaceItemsRel exists)
							for each TrueCostWeightDataInterfaceItemsRel
								invoke Update each
									invoked.Weight = 0
						IsFirstIteration = false
					LocalEffectivePeriod = LastDayDateContainer
					if (TrueCostResourceUtilTable.UseDate = LocalEffectivePeriod)
						if (ResourceRateRel exists)
							if (TrueCostResourceListRel exists)
								if (!TrueCostWeightDataInterfaceRel exists)
									invoke Create TrueCostWeightDataInterface
										invoked.TrueCostWeightDataInterface.RunGroup					= LocalRunGroup
										invoked.TrueCostWeightDataInterface.TrueCostConfiguration		= LocalTrueCostConfiguration
										invoked.TrueCostWeightDataInterface.TrueCostWeight				= LocalTrueCostWeight
										invoked.TrueCostWeightDataInterface.AccountingEntity			= ResourceRateRel.TrueCostResourceRateTable.AccountingEntity
										invoked.TrueCostWeightDataInterface.Department					= TrueCostResourceUtilTable.Department
										invoked.TrueCostWeightDataInterface.CostObject					= TrueCostResourceUtilTable.CostObject
										invoked.TrueCostWeightDataInterface.StartDate					= TrueCostResourceUtilTable.UseDate
										invoked.TrueCostWeightDataInterface.Weight						= ComputedWeight
										
								else
									invoke Update TrueCostWeightDataInterfaceRel
										invoked.TrueCostWeightDataInterface.Weight						+= ComputedWeight
					
