PurchaseOrderLineSourceComment is a BusinessClass
	owned by po
	prefix is PSCMT
	
	Ontology
		part of PurchaseOrderLineSource
			delete cascades
			relative key is SequenceNumber
			
	Patterns
		implements StaticJava
			
	Persistent Fields
		CommentTitle					is a CommentName
    	CommentType						is AlphaUpper size 1
    		States
                PrintOnDeliveryTicket		value is "D"
    	CommentText
		Attachment						is an AlternateAttachment
	
	Field Rules
		SequenceNumber
			autosequence
				minimize contention
			
		CommentType
			required

		CommentTitle
			required

	Local Fields
		LocalAttributeCtr   is Numeric 2

    Conditions
    	HasAttachment
    		restricted
    		when (Attachment entered)
    	
    	IsSourceOriginPurchaseOrder
    		restricted
    		when (PurchaseOrderLineSource.SourceDocumentOrigin.PurchaseOrder)
		
	Relations
	
	Sets
		ByCommentType
			Sort Order
				Company	
				PurchaseOrder
				PurchaseOrderLine
				PurchaseOrderLineSource
				CommentType
				SequenceNumber

	Create Rules  
		include IDM.CreateRules 
			replace AttachmentField with Attachment
							
	Delete Rules
		include IDM.DeleteRules
			replace AttachmentField with Attachment

	Commit Rules
		include IDM.CommitRules
			replace AttachmentField with Attachment

	Actions
		SystemCreate is a Create Action
			restricted
	
		Create is a Create Action
			valid when (IsSourceOriginPurchaseOrder)

		Update is an Update Action
			valid when (IsSourceOriginPurchaseOrder)
			
		Delete is a Delete Action
			valid when (IsSourceOriginPurchaseOrder)			
	
		UploadToIDM is an Instance Action  
			valid when (Attachment.ValidForIDMUpload)
			Action Rules
				include IDM.MoveAttachmentsToIDM
					replace AttachmentField with Attachment						

		MoveAttachmentsToIDM is a Set Action
			default label is untranslatable
			restricted
			
			Instance Selection
				where (Attachment.IsLocal)

			Accumulators
				InstanceCount

			Action Rules
				Instance Rules
					increment InstanceCount	

					include IDM.MoveAttachmentsToIDM
						replace AttachmentField with Attachment			

					commit transaction

					if (InstanceCount = config.IDM_MOVE_ATTACHMENTS_LIMIT)
						end set action instance loop
