ProcurementTemplateLine is a BusinessClass
    owned by po
    prefix is POE
    classic name is PROCTEMPLN

    Ontology
        symbolic key is ProcurementTemplateLine
            classic set name is POESET1
            classic name is LINE-NBR
            classic name for ProcurementGroup is PROCURE-GROUP
            classic name for ProcurementTemplate is TEMPLATE-REF

    Patterns
        implements ContextualParent
        implements StaticJava
        disable AuditIndex
        
		implements Resequence on DisplayOrder
			new sequence field is NewDisplayOrder
			set is ByDisplayOrder
 
    Persistent Fields
		DisplayOrder				  is Numeric 6
			disable Auditing
        Contract
        ContractLine
        Item
        SpecialItem					  is Boolean
        ServiceDescription            is a Description
            classic name is SERVICE-DESC
        ServiceCode
        UnitOfMeasure
            classic name is UOM
        Quantity
        UseRequestingLocationAcctUnit is Boolean
        	default label is "UseRequestingLocationAccount"
            classic name is ACCT-UNIT-FL

        FromCompanyLocation
        CommodityCode				  is a CommCodes
        SpecialItemDescription        is a Description
            classic name is SPECIAL-DESC
        TemplateDocumentNumber        is a SourceDocumentNumeric
            classic name is TEMPLT-DOC-NBR
        
        DistributionAccount           is a FinanceCodeBlock
            classic name for DistributionAccount.ToAccountingEntity is DIST-COMPANY
            classic name for DistributionAccount.AccountingUnit is ACCT-UNIT
            classic name for DistributionAccount.GeneralLedgerChartAccount is ACCOUNT
            classic name for DistributionAccount.Project is ACTIVITY
		Manufacturer
		ManufacturerNumber
		TextSearch						is Text
			text searchable
            disable Auditing
		TemplateTextSearch				is Text
			text searchable
            disable Auditing
	
	Transient Fields
		NewDisplayOrder					is Numeric size 6
		TransientQuantity				is a Quantity
			derive value from Quantity		
		TransientUnitOfMeasure			is a UnitOfMeasure
			derive value from UnitOfMeasure	
		TransientUnitCost				is an InternationalCost
		NewLineNumber 					is Numeric size 6
		TransientDistributionAccount	is a TransactionCodeBlock
		TransientCopyLine				is Boolean
		SpecialVendorItem				is a VendorItem
			derive value from ServiceDescription		
        NewRequisition                  is like Requisition
        NewRequisitionLine              is like RequisitionLine 
        TransientItemType				is Numeric 1
 			default label is "TypeOfItem"
 			States
 				FromContractLine		value is 1
 				SpecialItem             value is 2
 				ItemMasterItem          value is 3
 				Service                 value is 4
 			derive value from DerivedItemType

     	TransientRequisition			is a RequisitionGroup
		  	derive value from actor.agent(Employee).Employee.Requester.CompanyAndRequestingLocation
        TransientFromCompanyLocation	is a FromCompanyLocation
			derive value from actor.agent(Employee).Employee.Requester.RequestingLocation.FromCompanyLocation
		TransientRequestedDeliveryDate	is Date
	    TransientAllocationPriority		is like AllocationPriority
	    TransientAllocationPriorityLevel is an AllocationPriorityLevelGroup
			derive value from DerivedFAlocationPriorityLevelGroup
		TransientRequisitionDescription	is Alpha size 30
		TransientEnteredQuantity		is a UnsignedQuantity
			precision is NumberOfDecimalsQuantity
				round to precision
			derive value from DerivedQuantity		
		TransientCostUOM				is a UnitOfMeasure
			derive value from DerivedUOM
		TransientDefaultUnitCost		is like UnsignedUnitCost
			precision is NumberOfDecimalsCost
				round to precision
			derive value from DefaultUnitCost
		TransientAddToRequisition		is Numeric size 1
			States
				AddToExistingRequisition	value is 0
				StartNewRequisition			value is 1				
		TransientQuantityMultiplier		is an UnsignedQuantity
			derive value from "1"		
		TransientBuyer					is a BuyerGroupField 
			derive value from ProcurementGroup + "^" + RequestingLocationRel.Buyer		
		TransientDeliverTo				is a DeliverTo
		TransientCommodityCode			is a CommCodes
			derive value from Item.CommodityCode
		TransientPOCode					is a POCode
			derive value from RequestingLocationRel.POCode		
		TransientVendor					is a VendorGroupField

 					 		  
	Local Fields
		LocalOperatingCompany	is an OperatingCompany
		LocalPurchasingCompany	is like PurchasingCompany
		LocalVendor				is a Vendor
		LocalUOM				is a UnitOfMeasure
		LocalContract			is like Contract
		LocalContractLine		is like ContractLine
		LocalFromContract       is Boolean
		TransactionCostDefault
		ProcurementCostDefault
		Execute					is Boolean
		LocalQuantity			is a Quantity
		UOMCalculation
		LocalCostCode			is a CostCode
		LocalCostOption			is a CostOption
		LocalVendorItem         is a VendorItem
		LocalPurchaseFromLocation is a PurchaseFromLocation
		LocalManufacturer		is a Manufacturer 
		LocalManufacturerNumber is a ManufacturerNumber
		LocalCostTranUOM		is a UnitOfMeasure
		LocalDefaultUnitCost	is a UnitCost
        LocalCreatePurchaseOrder is Boolean
        CreateErrorMessage		is Alpha size 200
        LocalWarehouseLocationRuleDetailLocation 	is an InventoryLocation
        LocalLocationRuleFromCompanyLocation	is a FromCompanyLocation
        LocalAvailableQuantity             		is a Quantity
        	precision is NumberOfDecimalsQuantity
        LocalFromCompanyLocationFromRule		is a FromCompanyLocation
		LocalCurrencyCode		is like Currency
		LocalCostConversionUOM	is a UnitOfMeasure
		LocalCostUOM			is a UnitOfMeasure
		LocalCompletionMessage			is Text
		LocalCompanyForQuantityAdd		is like InventoryCompany
		LocalRequisitionForQuantityAdd	is like Requisition
		LocalCostUOMForQuantityAdd		is a UnitOfMeasure
		LocalUnitCostForQuantityAdd		is like UnsignedUnitCost
			precision is NumberOfDecimalsCost
				round to precision
		LocalBlankVendorLocation		is Boolean
				
    Rule Blocks
		BuildTextIndex
			build text search field TextSearch
				Fields
					Item
					ServiceDescription
					SpecialItemDescription
					ManufacturerNumber
					DerivedStrippedManufacturerNumber
					DerivedStrippedItem
					Item.Reference1
					Item.Reference2
					Item.Description
					Item.Description2
					Item.Description3
					Item.GenericName
					Item.FreightClass
					Item.MajorPurchasingClass
					Item.MinorPurchasingClass
					Item.MajorInventoryClass
					Item.MinorInventoryClass
					Item.MajorSalesClass
					Item.MinorSalesClass
					Item.ManufacturerNumber
					Item.VendorItemRel.VendorItem
					Item.VendorItemRel.VendorItemDescription
					Item.VendorItemRel.ManufacturerNumber
					Item.DerivedStrippedItem
					Item.ManufacturerNumberStripped
					Item.VendorItemRel.ManufacturerNumberStripped
					Item.VendorItemRel.VendorItemStripped

		BuildTemplateTextIndex
			build text search field TemplateTextSearch
				Fields
					ProcurementTemplate
					ProcurementTemplate.Description
					Item
					ServiceDescription
					SpecialItemDescription
					ManufacturerNumber
					DerivedStrippedManufacturerNumber
					DerivedStrippedItem
					Item.Reference1
					Item.Reference2
					Item.Description
					Item.Description2
					Item.Description3
					Item.GenericName
					Item.FreightClass
					Item.MajorPurchasingClass
					Item.MinorPurchasingClass
					Item.MajorInventoryClass
					Item.MinorInventoryClass
					Item.MajorSalesClass
					Item.MinorSalesClass
					Item.ManufacturerNumber
					Item.VendorItemRel.VendorItem
					Item.VendorItemRel.VendorItemDescription
					Item.VendorItemRel.ManufacturerNumber
					Item.DerivedStrippedItem
					Item.ManufacturerNumberStripped
					Item.VendorItemRel.ManufacturerNumberStripped
					Item.VendorItemRel.VendorItemStripped
					
		GetManufacturerInformation
			if ((DefaultItemType.Service
			or  DefaultItemType.Special)
			and ContractLineRel exists)
				LocalManufacturer									= ContractLine.Manufacturer
				LocalManufacturerNumber								= ContractLine.ManufacturerNumber
			else
			if (LocalCreatePurchaseOrder 
			and VendorItemDefaultRel.Manufacturer.ManufacturerCode entered)
				LocalManufacturer									= VendorItemDefaultRel.Manufacturer
				LocalManufacturerNumber								= VendorItemDefaultRel.ManufacturerNumber
			else
			if (ItemAtRequisitionFromLocationRel.Manufacturer.ManufacturerCode entered)
				LocalManufacturer									= ItemAtRequisitionFromLocationRel.Manufacturer
				LocalManufacturerNumber								= ItemAtRequisitionFromLocationRel.ManufacturerNumber
			else
			if (ItemLocationRel.Manufacturer.ManufacturerCode entered)
				LocalManufacturer									= ItemLocationRel.Manufacturer
				LocalManufacturerNumber								= ItemLocationRel.ManufacturerNumber
			else	
			if (Item.Manufacturer.ManufacturerCode entered)
				LocalManufacturer									= Item.Manufacturer
				LocalManufacturerNumber								= Item.ManufacturerNumber
			else
				LocalManufacturer								= Manufacturer
				LocalManufacturerNumber							= ManufacturerNumber							
		
		
		CreateRequisitionLineFromTemplate
            invoke CreateFromProcurementTemplateLineForRSS RequisitionLine
            	assign result to LocalRequisitionLineView
        	    invoked.PrmInventoryCompany         = PrmCompany
        	    invoked.PrmProcurementTemplate		= ProcurementTemplate
        	    invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
        	    invoked.PrmRequisition              = LocalRequisition
                invoked.PrmQuantity                 = PrmQuantity
                invoked.PrmTransactionCurrencyCode	= PrmTransactionCurrencyCode
                invoked.PrmEnteredUOM               = PrmUOM
                invoked.PrmServiceCode          	= PrmServiceCode
                invoked.PrmDescription         	    = PrmDescription
				invoked.PrmToAccountingEntity		= PrmToAccountingEntity
				invoked.PrmGeneralLedgerChartAccount	= PrmGeneralLedgerChartAccount
				invoked.PrmAccountingUnit			= PrmAccountingUnit
				invoked.PrmProject					= PrmProject
				invoked.PrmFinanceDimension1		= PrmFinanceDimension1
				invoked.PrmFinanceDimension2		= PrmFinanceDimension2
				invoked.PrmFinanceDimension3		= PrmFinanceDimension3
				invoked.PrmFinanceDimension4		= PrmFinanceDimension4
				invoked.PrmFinanceDimension5		= PrmFinanceDimension5
				invoked.PrmFinanceDimension6		= PrmFinanceDimension6
				invoked.PrmFinanceDimension7		= PrmFinanceDimension7
				invoked.PrmFinanceDimension8		= PrmFinanceDimension8
				invoked.PrmFinanceDimension9		= PrmFinanceDimension9
				invoked.PrmFinanceDimension10		= PrmFinanceDimension10
				invoked.PrmSourcingEventRequired	= PrmSourcingEventRequired
				invoked.PrmAsset					= PrmAsset
				invoked.PrmAssetTemplate			= PrmAssetTemplate
				invoked.PrmAllocationPriority		= PrmAllocationPriority
				if (ParItem)
					if (ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.Vendor entered
					and PrmContract.ApPoPurchaseFrom.VendorLocation entered
					and ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.PurchaseFromLocation = PrmItemPurchaseFromLocation)
						invoked.PrmVendor					= PrmItemVendor
						invoked.PrmPurchaseFromLocation		= PrmItemPurchaseFromLocation
				else
				if (PrmItemVendor entered)
					invoked.PrmVendor 					= PrmItemVendor						
					invoked.PrmPurchaseFromLocation	    = PrmItemPurchaseFromLocation		
				
				invoked.PrmMajorPurchasingClass		= PrmMajorPurchasingClass
				invoked.PrmMinorPurchasingClass     = PrmMinorPurchasingClass
				invoked.PrmCommodityCode			= PrmCommodityCode
				invoked.PrmFromCompany				= PrmFromCompany
				invoked.PrmFromLocation				= PrmFromLocation
				invoked.PrmManufacturer				= PrmManufacturer
				invoked.PrmManufacturerNumber		= PrmManufacturerNumber
				invoked.PrmCreatePurchaseOrder		= PrmCreatePurchaseOrder			
				invoked.PrmGLEncumbranceReference	= PrmGLEncumbranceReference

				LocalUnitCost						= DefaultUnitCost
				round LocalUnitCost to nearest DerivedRoundTo						
				LocalCostOption						= CostOption			
				if (PrmCostOption entered 
				and PrmCostOption not = LocalCostOption)
					invoked.PrmCostOption			= PrmCostOption
					LocalCostOption					= PrmCostOption			
																											   
				if ((PrmTransactionUnitCost entered and PrmTransactionUnitCost not = LocalUnitCost)
				or (PrmItemVendor entered and PrmItemVendor not = DerivedVendor and LocalCostOption.CostRequired)
				or ((DefaultItemType.Special and PrmContract.UOMSMustMatchForSpecials)	
				and (PrmContract entered and (PrmContractLine.UOM not = PrmUOM))))		
					if(not IsOnContract)
						invoked.PrmTransactionUnitCost	= PrmTransactionUnitCost
					if ((DefaultItemType.Service and ServiceCode.Amount)		
					and (PrmItemVendor not entered or PrmItemVendor = DerivedVendor))
						invoked.PrmContract			= PrmContract
						invoked.PrmContractLine		= PrmContractLine
				else
					if (DefaultItemType.Service or (HasContract and (ContractLine.UOM = PrmUOM)))
						invoked.PrmContract					= Contract
						invoked.PrmContractLine				= ContractLine
					
				if(SpecialItem)
					if (HasContract)
						invoked.PrmVendorItem 		= ContractLine.VendorItem
					else
						invoked.PrmVendorItem 		= Item
					
	Derived Fields
		

		IsNotAValidBuyUOMmsg		is a MessageField
			"Warning:_<UnitOfMeasure>IsNotAValidBuyUOMForThisItem"
		
		IsNotAValidUnitOfMeasuremsg		is a MessageField
			"Warning:_<UnitOfMeasure>IsNotAValidUnitOfMeasureForItem"

		InventoryItemLabel is a LabelField
			restricted
			"Stock" 
			
		NonStockItemLabel is a LabelField
			restricted
			"NonStock" 

		SpecialItemLabel is a LabelField
			restricted
			"Special"

		ServiceItemLabel is a LabelField
			restricted
			"Service"
	

    	EnteredCostCodeLabel is a LabelField
    		restricted
    		"Entered"
    		
    	LastCostCostCodeLabel is a LabelField
    		restricted
    		"LastCost"
    		
    	ContractCostCodeLabel is a LabelField
    		restricted
    		"Contract"
    		
    	CatalogQuoteCostCodeLabel is a LabelField
    		restricted
    		"CatalogQuote"
    		
    	BlanketCostCodeLabel is a LabelField
    		restricted
    		"Blanket"
    		
    	LastPoCreatedCostCodeLabel is a LabelField
    		restricted
    		"LastPoCreated"
    		
    	InventoryCostCodeLabel is a LabelField
    		restricted
    		"InventoryCost"
    		
    	PunchoutCostCodeLabel is a LabelField
    		restricted
    		"Punchout"
    		
    	CostRequiredLabel is a LabelField
    		restricted
    		"CostRequired"
    		
    	NoChargeLabel is a LabelField
    		restricted
    		"NoCharge"
    		
    	VendorDeterminedLabel is a LabelField
    		restricted
    		"VendorDetermined"
    		
    	TierCompanyParticipantCostCodeLabel is a LabelField
    		restricted
    		"Tier-CompanyParticipant"

    	TierIcLocationParticipant is a LabelField
    		restricted
    		"Tier-InventoryLocationParticipant"

    	TierReqLocParticipant is a LabelField
    		restricted
    		"Tier-RequestingLocationParticipant"
    		
    	WebsiteCostCodeLabel is a LabelField
    		restricted
    		"Website"
    		
    	ProcurementTemplateContractCostCodeLabel is a LabelField
    		restricted
    		"ProcurementTemplateContract"
    		
    	StandingCostCodeLabel is a LabelField
    		restricted
    		"Standing"

    	StrategicSourcingCostCodeLabel is a LabelField
    		restricted
    		"StrategicSourcing"
	
		SubstituteItemLabel is a LabelField
			"HasSubstituteItem(s)"
	
		DescriptionDisplay is a DerivedField
			type is like Description
			if (Item exists)
				return Item.Description
			else
				if (SpecialItemDescription entered)
					return SpecialItemDescription
				else
					return ServiceDescription
           
		Description2Display is a DerivedField
			type is like Description 
			if (Item exists)
				return Item.Description2 
			else 
				if (ContractLine entered)
					return ContractLineRel.ItemDescription2

		Description3Display is a DerivedField
			type is like Description3 
			if (Item exists)
				return Item.Description3 
			else 
				if (ContractLine entered)
					return ContractLineRel.ItemDescription3

		DerivedCompany is a DerivedField
			type is like InventoryCompany
			restricted
			if (RequisitionRel exists)
				return RequisitionRel.Company
			else
				return RequesterRel.Company
	
		DerivedRequestingLocation		is a DerivedField
			type is like RequestingLocation
			if (RequisitionRel exists)
				return RequisitionRel.RequestingLocation
			else
				return RequesterRel.RequestingLocation
				
		DerivedLocationRule		is a DerivedField
			type is like WarehouseLocationRule
			restricted
			if (RequisitionRel exists)
				return RequisitionRel.LocationRule
			else
				return RequesterRel.RequestingLocation.LocationRule

		DefaultLocationRuleFromCompany is a DerivedField
			type is like InventoryCompany				
			if (DerivedLocationRule entered)
				if (Item exists)
	            	initialize LocalAvailableQuantity
	            	for each WarehouseLocationRuleDetailsRel
	            		LocalLocationRuleFromCompanyLocation.FromCompany = each.LocationCompany
	            		LocalLocationRuleFromCompanyLocation.FromLocation = each.InventoryLocation
	            		if (WarehouseLocationRuleItemLocationRel exists
	                    and WarehouseLocationRuleItemLocationRel.InventoryTracked
	            		and WarehouseLocationRuleItemLocationRel.Active)
	                		if (WarehouseLocationRuleItemLocationRel.AvailableQuantity >= 1)
	                			LocalFromCompanyLocationFromRule.FromCompany = LocalLocationRuleFromCompanyLocation.FromCompany
	                			LocalFromCompanyLocationFromRule.FromLocation = LocalLocationRuleFromCompanyLocation.FromLocation
	                			end for each
	                		else
	                			if (WarehouseLocationRuleItemLocationRel.AvailableQuantity > LocalAvailableQuantity
	                        	or LocalFromCompanyLocationFromRule not entered)
	                				LocalAvailableQuantity = WarehouseLocationRuleItemLocationRel.AvailableQuantity
	                				LocalFromCompanyLocationFromRule.FromCompany = LocalLocationRuleFromCompanyLocation.FromCompany
	                				LocalFromCompanyLocationFromRule.FromLocation = LocalLocationRuleFromCompanyLocation.FromLocation
	                return LocalFromCompanyLocationFromRule.FromCompany

		DefaultFromCompany is a DerivedField
			type is like InventoryCompany
			if (DefaultLocationRuleFromCompany entered)
				return DefaultLocationRuleFromCompany
			
			if (FromCompanyLocation.FromCompany entered)
				if (ItemAtRequestingLocationRel exists
				and ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered)
					return ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom.ReplenishFromCompany
				else
					return FromCompanyLocation.FromCompany
			
			if (RequisitionRel exists)
				if (ItemAtRequestingLocationRel exists
				and ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered)
					return ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom.ReplenishFromCompany
				else
					return RequisitionRel.FromCompanyLocation.FromCompany
					
			if (RequestingLocationRel.FromCompanyLocation.FromCompany entered)
				if (ItemAtRequestingLocationRel exists
				and ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered)
					return ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom.ReplenishFromCompany
				else
					return RequestingLocationRel.FromCompanyLocation.FromCompany
			
			return DerivedCompany
			
		DefaultLocationRuleFromLocation	is a DerivedField
			type is like InventoryLocation
			if (DerivedLocationRule entered)
				if (Item exists)
	            	initialize LocalAvailableQuantity
	            	for each WarehouseLocationRuleDetailsRel
	            		LocalLocationRuleFromCompanyLocation.FromCompany = each.LocationCompany
	            		LocalLocationRuleFromCompanyLocation.FromLocation = each.InventoryLocation
	            		if (WarehouseLocationRuleItemLocationRel exists
	                    and WarehouseLocationRuleItemLocationRel.InventoryTracked
	            		and WarehouseLocationRuleItemLocationRel.Active)
	                		if (WarehouseLocationRuleItemLocationRel.AvailableQuantity >= 1)
	                			LocalFromCompanyLocationFromRule.FromCompany = LocalLocationRuleFromCompanyLocation.FromCompany
	                			LocalFromCompanyLocationFromRule.FromLocation = LocalLocationRuleFromCompanyLocation.FromLocation
	                			end for each
	                		else
	                			if (WarehouseLocationRuleItemLocationRel.AvailableQuantity > LocalAvailableQuantity
	                        	or LocalFromCompanyLocationFromRule not entered)
	                        		LocalAvailableQuantity = WarehouseLocationRuleItemLocationRel.AvailableQuantity
	                        		LocalFromCompanyLocationFromRule.FromCompany = LocalLocationRuleFromCompanyLocation.FromCompany
	                        		LocalFromCompanyLocationFromRule.FromLocation = LocalLocationRuleFromCompanyLocation.FromLocation
	                return LocalFromCompanyLocationFromRule.FromLocation
			
		DefaultFromLocation	is a DerivedField
			type is like InventoryLocation
			
			if (DefaultLocationRuleFromLocation entered)
				return DefaultLocationRuleFromLocation
												
			if (FromCompanyLocation.FromLocation entered)
				if (ItemAtRequestingLocationRel exists
				and ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered)
					return ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom.ReplenishFromLocation
				else
					return FromCompanyLocation.FromLocation

			if  (RequisitionRel exists)
				if (ItemAtRequestingLocationRel exists
				and ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered)
					return ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom.ReplenishFromLocation
				else
					return RequisitionRel.FromCompanyLocation.FromLocation
								
			if (RequestingLocationRel.FromCompanyLocation.FromLocation entered)
				if (ItemAtRequestingLocationRel exists
				and ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered)
					return ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom.ReplenishFromLocation
				else
					return RequestingLocationRel.FromCompanyLocation.FromLocation
			
		NumberOfDecimalsCost is a ConditionalField
			type is Numeric size 1
			if (HasItem)
				Item.NumberOfDecimalsCost
			else
				InventoryCompanyRel.NumberOfDecimalsCost

		DefaultItemType	is a DerivedField
			type is like ItemType
			if (DerivedLocationRule entered)
        		if (Item exists)
	    			if (not RequestingLocationRel.Stockless)
	        			for each WarehouseLocationRuleDetailsRel
	        				LocalLocationRuleFromCompanyLocation.FromCompany  = each.LocationCompany
	                		LocalLocationRuleFromCompanyLocation.FromLocation = each.InventoryLocation
	                		if (WarehouseLocationRuleItemLocationRel exists
                            and WarehouseLocationRuleItemLocationRel.InventoryTracked
	                		and WarehouseLocationRuleItemLocationRel.Active)
	                        	return ItemType.Inventoried
	                        	end for each
					return ItemType.NonStock
			if (SpecialItem)
				return ItemType.Special
				
			if (IsServiceItem)	
				return ItemType.Service			
					
			if (not RequestingLocationRel.ParOrExchangeLocation
			and ItemLocationRelExists			
			or (RequestingLocationRel.ParOrExchangeLocation
			and (ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered
			or (ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel not exists
			and ItemLocationRelExists))))
				if (RequestingLocationRel.Stockless
				and ItemContractLinesRel.Stockless)
					return ItemType.NonStock
				else
					return ItemType.Inventoried
			else									
				return ItemType.NonStock				

		DefaultItemTypeLabel is a DerivedField
			type is MessageField
			if (DefaultItemType.Service)
				return ServiceItemLabel
			else
			if (DefaultItemType.Special)
				return SpecialItemLabel
			else
			if (DefaultItemType.Inventoried)
				return InventoryItemLabel
			else
				return NonStockItemLabel

		DefaultTransactionCost	is a DerivedField
			type is like InternationalCost
			restricted
			TransactionCostDefault.InputItem 							 = Item
			TransactionCostDefault.InputItemType						 = DefaultItemType
			TransactionCostDefault.InputUOM								 = DerivedUOM
			TransactionCostDefault.InputFromCompanyLocation.FromCompany  = DefaultFromCompany
			TransactionCostDefault.InputFromCompanyLocation.FromLocation = DefaultFromLocation
			return TransactionCostDefault.GetTransactionCost
		

		DerivedCreatePurchaseOrder is a DerivedField
			type is Boolean
			if (not DefaultItemType.Inventoried
			or (DefaultFromCompany = DerivedCompany
			and DefaultFromLocation = DerivedRequestingLocation))
				return true
		

		DerivedUOM is a DerivedField
			type is like UnitOfMeasure
			if (UnitOfMeasure entered)
				return UnitOfMeasure
			else
			if (LocalCostUOM entered)
				return LocalCostUOM
			else
			if (IsServiceItem
			or (DerivedCreatePurchaseOrder 
			and (ContractRel exists and ContractRel.UseContractUOM)))
				return ContractLineDefaultRel.UOM
			else
			if (DefaultItemType.Inventoried
            or DefaultItemType.NonStock)
				if (DerivedCreatePurchaseOrder)
					if (ParItem
					and ItemAtRequestingLocationRel.DefaultTransactionUOM entered)
						return ItemAtRequestingLocationRel.DefaultTransactionUOM
					else
					if (VendorItemDefaultRel.VendorBuyUOM entered)
						return  VendorItemDefaultRel.VendorBuyUOM
					else
					if (ItemLocationRel.DefaultSourceUOM.UnitOfMeasure entered)
						return ItemLocationRel.DefaultSourceUOM.UnitOfMeasure
					else
					if (LocationItemUOMDefaultBuyingRel.UnitOfMeasure entered)
						return LocationItemUOMDefaultBuyingRel.UnitOfMeasure
					else
					if (ItemRel.DefaultBuyUOM entered)
						return ItemRel.DefaultBuyUOM
				else
					if (ParItem
					and ItemAtRequestingLocationRel.DefaultTransactionUOM entered)
						return ItemAtRequestingLocationRel.DefaultTransactionUOM
					else
					if (ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure entered)
						return ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure
					else
					if (LocationItemUOMDefaultTransactionRel.UnitOfMeasure entered)
						return LocationItemUOMDefaultTransactionRel.UnitOfMeasure
					else
					if (ItemRel.DefaultInventoryTransactionUOM entered)
						return ItemRel.DefaultInventoryTransactionUOM	
			else
			if (ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure entered)
				return ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure
			else
			if (TransactionCostDefault.DefaultUOM entered)
				return TransactionCostDefault.DefaultUOM
			else
			if (HasContractLine)
				return ContractLine.UOM
				
		BuyUOM is a DerivedField
			type is like UnitOfMeasure
			if (TransactionCostDefault.DefaultUOM entered)
				return TransactionCostDefault.DefaultUOM 

			if (HasContractLine)
				return ContractLine.UOM
				
		DefaultUnitCost		is a DerivedField
			type is like UnitCost
				precision is NumberOfDecimalsCost	
				
			initialize ProcurementCostDefault
			initialize LocalCreatePurchaseOrder				
						
			LocalVendorItem = TransactionCostDefault.DefaultVendorItem
			LocalCreatePurchaseOrder = DerivedCreatePurchaseOrder
			
			if ((ItemIsStockAtRequestingFromLocation and ItemAtRequestingFromLocationRel.NoCharge 
			and DefaultItemType.Inventoried
			and ItemAtRequestingLocationRel not exists
			and ItemAtRequestingFromLocationRel.InventoryLocation = DefaultFromLocation)
			or	(ItemIsStockAtDefaultFromLocation and ItemLocationRel.NoCharge
			and	DefaultItemType.Inventoried))
				LocalCostOption = CostOption.NoCharge
				LocalCostCode = CostCode.InventoryCost
				initialize LocalContract						 
				initialize LocalContractLine
				include GetManufacturerInformation
				initialize LocalDefaultUnitCost
				round LocalDefaultUnitCost to nearest DerivedRoundTo
				return LocalDefaultUnitCost
								
			if (DefaultTransactionCost entered
			and DefaultFromLocation not = DerivedRequestingLocation
			and ItemLocationRel exists and ItemLocationRel.InventoryTracked
			and not LocalCreatePurchaseOrder)
				LocalCostUOM = TransactionCostDefault.DefaultUOM
				LocalCostCode = CostCode.InventoryCost
				LocalVendor = TransactionCostDefault.DefaultVendor
				LocalPurchaseFromLocation = TransactionCostDefault.DefaultPurchaseFromLocation
				initialize LocalContract						 
				initialize LocalContractLine						 
				initialize LocalCostOption
				include GetManufacturerInformation
				LocalDefaultUnitCost = DefaultTransactionCost
				round LocalDefaultUnitCost to nearest DerivedRoundTo
				return LocalDefaultUnitCost
			
				
			if (PurchasingCompanyRel.CostOrVendorDefaultingOrder.VendorFirstThenCost)
				TransactionCostDefault.LocalCreatePurchaseOrder					= LocalCreatePurchaseOrder					
				TransactionCostDefault.InputFromCompanyLocation.FromCompany     = DefaultFromCompany
                TransactionCostDefault.InputFromCompanyLocation.FromLocation    = DefaultFromLocation
                TransactionCostDefault.InputRequestingLocation                  = DerivedRequestingLocation
				TransactionCostDefault.InputRequisition                         = RequesterRel.CurrentRequisitionForRQC
				TransactionCostDefault.InputCompany								= DerivedCompany

				if (DefaultItemType.Special
                or  DefaultItemType.Service)    
                    TransactionCostDefault.InputItemType                        = DefaultItemType 

				LocalVendor														= TransactionCostDefault.DefaultVendor
				LocalPurchaseFromLocation										= TransactionCostDefault.DefaultPurchaseFromLocation

				if (not RequestingLocationRel.ParOrExchangeLocation
				and LocalVendor entered
				and LocalPurchaseFromLocation entered
				and TransactionCostDefault.DefaultLocalVendorLocationFromContract)
					LocalBlankVendorLocation = true

			if (ItemAtRequestingLocationRel exists)
				if (RequestingLocationRel.Stockless
				and ItemContractLinesRel.Stockless
				and (ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered
				or ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.Vendor entered))
					LocalVendor						= Contract.Vendor
					if (ItemContractLinesRel.ApPoPurchaseFrom.VendorLocation entered)
						LocalPurchaseFromLocation 	= Contract.ApPoPurchaseFrom.VendorLocation
					else
					if (ItemContractLinesRel.ApPoPurchaseFrom.PurchaseFromLocation entered)
						LocalPurchaseFromLocation 	= Contract.ApPoPurchaseFrom.PurchaseFromLocation
				else
				if (RequestingLocationRel.ParOrExchangeLocation
				and ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.Vendor entered)
					LocalVendor 				= ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.Vendor
					LocalPurchaseFromLocation 	= ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.PurchaseFromLocation
			
			if (PurchasingCompanyRel.CostOrVendorItemDefaultingOrder.VendorItemBeforeCost)
				if (ContractLineRel exists
				and not ContractLineRel.OnHold
				and ContractLine.VendorItem entered)
					LocalVendorItem			= ContractLine.VendorItem
				else
					LocalVendorItem 		= VendorItemDefaultRel.VendorItem

			ProcurementCostDefault.InItem 						= Item
			ProcurementCostDefault.InItemType 					= DefaultItemType
			ProcurementCostDefault.InVendor						= LocalVendor			

			if ((DefaultItemType.Service
			or  DefaultItemType.Special)
			and ContractLineRel exists)
				ProcurementCostDefault.InManufacturerCode 			= ContractLine.Manufacturer.ManufacturerCode 
				ProcurementCostDefault.InManufacturerDivision 		= ContractLine.Manufacturer.ManufacturerDivision 
				ProcurementCostDefault.InManufacturerNumber 		= ContractLine.ManufacturerNumber
				LocalManufacturer									= ContractLine.Manufacturer
				LocalManufacturerNumber								= ContractLine.ManufacturerNumber
			else
			if (LocalCreatePurchaseOrder 
			and VendorItemDefaultRel.Manufacturer.ManufacturerCode entered)
				ProcurementCostDefault.InManufacturerCode 			= VendorItemDefaultRel.Manufacturer.ManufacturerCode 
				ProcurementCostDefault.InManufacturerDivision 		= VendorItemDefaultRel.Manufacturer.ManufacturerDivision 
				ProcurementCostDefault.InManufacturerNumber 		= VendorItemDefaultRel.ManufacturerNumber
			else
			if (ItemAtRequisitionFromLocationRel.Manufacturer.ManufacturerCode entered)
				ProcurementCostDefault.InManufacturerCode 			= ItemAtRequisitionFromLocationRel.Manufacturer.ManufacturerCode 
				ProcurementCostDefault.InManufacturerDivision 		= ItemAtRequisitionFromLocationRel.Manufacturer.ManufacturerDivision 
				ProcurementCostDefault.InManufacturerNumber 		= ItemAtRequisitionFromLocationRel.ManufacturerNumber
				LocalManufacturer									= ItemAtRequisitionFromLocationRel.Manufacturer
				LocalManufacturerNumber								= ItemAtRequisitionFromLocationRel.ManufacturerNumber
			else
			if (ItemLocationRel.Manufacturer.ManufacturerCode entered)
				ProcurementCostDefault.InManufacturerCode 			= ItemLocationRel.Manufacturer.ManufacturerCode 
				ProcurementCostDefault.InManufacturerDivision 		= ItemLocationRel.Manufacturer.ManufacturerDivision 
				ProcurementCostDefault.InManufacturerNumber 		= ItemLocationRel.ManufacturerNumber
				LocalManufacturer									= ItemLocationRel.Manufacturer
				LocalManufacturerNumber								= ItemLocationRel.ManufacturerNumber
			else	
			if (Item.Manufacturer.ManufacturerCode entered)
				ProcurementCostDefault.InManufacturerCode 			= Item.Manufacturer.ManufacturerCode 
				ProcurementCostDefault.InManufacturerDivision 		= Item.Manufacturer.ManufacturerDivision 
				ProcurementCostDefault.InManufacturerNumber 		= Item.ManufacturerNumber
				LocalManufacturer									= Item.Manufacturer
				LocalManufacturerNumber								= Item.ManufacturerNumber
			else
				ProcurementCostDefault.InManufacturerCode 		= Manufacturer.ManufacturerCode 
				ProcurementCostDefault.InManufacturerDivision 	= Manufacturer.ManufacturerDivision 
				ProcurementCostDefault.InManufacturerNumber 	= ManufacturerNumber
				LocalManufacturer								= Manufacturer
				LocalManufacturerNumber							= ManufacturerNumber							
		
			if (HasItem)
				ProcurementCostDefault.InVendorItem				= LocalVendorItem
			else
				ProcurementCostDefault.InVendorItem				= SpecialVendorItem
			if (DefaultItemType.Service or ContractIsWithinEffectiveDate)
				ProcurementCostDefault.InContractGroup			= Contract.ContractGroup
				ProcurementCostDefault.InContract				= Contract
				ProcurementCostDefault.InContractLine			= ContractLine
				ProcurementCostDefault.InContractType			= Contract.ContractType
				ProcurementCostDefault.InVendor					= Contract.Vendor		
				initialize LocalPurchaseFromLocation
				default LocalPurchaseFromLocation to Contract.ApPoPurchaseFrom.PurchaseFromLocation
				default LocalPurchaseFromLocation to Contract.ApPoPurchaseFrom.VendorLocation
			ProcurementCostDefault.InPurchaseFromLocation		= LocalPurchaseFromLocation
			ProcurementCostDefault.InQuantity					= Quantity
			ProcurementCostDefault.InQuantityUOM				= DerivedUOM			
			ProcurementCostDefault.InDate 						= current corporate date
			ProcurementCostDefault.InSystem						= "RQ"
			ProcurementCostDefault.InCompany 					= DefaultFromCompany
			ProcurementCostDefault.InLocation 					= DefaultFromLocation
			ProcurementCostDefault.InRequestingLocation			= DerivedRequestingLocation
			ProcurementCostDefault.InRequestingCompany 			= DerivedCompany		
			ProcurementCostDefault.InStockless 					= RequestingLocationRel.Stockless
			ProcurementCostDefault.InProcurementGroup 			= ProcurementGroup
			ProcurementCostDefault.InDescription				= ItemDescription
			ProcurementCostDefault.InServiceCode				= ServiceCode
			ProcurementCostDefault.InSkipUOMMatching			= true
			if (DefaultItemType.Inventoried 
			and not LocalCreatePurchaseOrder)
				ProcurementCostDefault.InBypassUseContractUOM = true
				if (not ItemLocationRel.NoCharge)
					ProcurementCostDefault.InSkipZeroCostContractLine = true
			Execute	= ProcurementCostDefault.DefaultUnitCost
			if (ProcurementCostDefault.InStockless)
				if	((ProcurementCostDefault.OutputUnitCost not entered
				and	ProcurementCostDefault.OutputCostOption.CostRequired)
				or 	(ProcurementCostDefault.OutputContract not entered
				and ProcurementCostDefault.OutputCostCode.Entered)
				or 	(ProcurementCostDefault.OutputUnitCost entered
				and ProcurementCostDefault.OutputCostCode not entered))
					ProcurementCostDefault.InStockless	= false
					Execute	= ProcurementCostDefault.DefaultUnitCost

			if (LocalBlankVendorLocation
			and ProcurementCostDefault.LocalPurchaseFromLocation not entered)
				initialize LocalPurchaseFromLocation
			else
				LocalPurchaseFromLocation	= ProcurementCostDefault.OutputPurchaseFromLocation
			LocalCostOption				= ProcurementCostDefault.OutputCostOption
			LocalCostCode				= ProcurementCostDefault.OutputCostCode
			LocalContract				= ProcurementCostDefault.OutputContract
			LocalContractLine			= ProcurementCostDefault.OutputContractLine
			LocalQuantity				= ProcurementCostDefault.OutputQuantity
			LocalVendor 				= ProcurementCostDefault.OutputVendor
			LocalVendorItem				= ProcurementCostDefault.OutputVendorItem
			LocalCurrencyCode			= ProcurementCostDefault.OutputCurrencyCode
			LocalCostUOM				= ProcurementCostDefault.OutputCostUOM
			LocalDefaultUnitCost 		= ProcurementCostDefault.OutputUnitCost
			
			if (LocalCreatePurchaseOrder)
				if (DefaultItemType.Special
				and TransientItemType.SpecialItem
				and LocalContract entered
				and LocalContractLine entered
				and LocalCostUOM not entered
				and DerivedUOM not entered)
					LocalCostUOM = ContractLineDefaultRel.UOM

				if (LocalVendor entered
				and (LocalContract entered
				or LocalCostCode.LastPoCreated))
					if ((DefaultItemType.Inventoried
					or DefaultItemType.NonStock)
					and	DerivedUOM entered)
						if (VendorItemDefaultRel.VendorBuyUOM.UnitOfMeasure entered
						or VendorItemUsedRel.VendorBuyUOM.UnitOfMeasure entered
						or UnitOfMeasure entered)
							if (LocalVendorItem not entered)
								LocalVendorItem = VendorItemDefaultRel.VendorItem
							if(LocalVendorItem not entered
							and LocalContract entered)
								LocalVendorItem = VendorItemUsedRel.VendorItem
							initialize UOMCalculation
							UOMCalculation.InputUOM			= LocalCostUOM
							if (UnitOfMeasure entered)
								UOMCalculation.InputToUOM		= UnitOfMeasure
								LocalCostUOM					= UnitOfMeasure
							else
							if (VendorItemDefaultRel.VendorBuyUOM.UnitOfMeasure entered)
								UOMCalculation.InputToUOM		= VendorItemDefaultRel.VendorBuyUOM.UnitOfMeasure
								LocalCostUOM					= VendorItemDefaultRel.VendorBuyUOM.UnitOfMeasure
							else
							if (LocalContract entered)
								UOMCalculation.InputToUOM		= VendorItemUsedRel.VendorBuyUOM.UnitOfMeasure
								LocalCostUOM					= VendorItemUsedRel.VendorBuyUOM.UnitOfMeasure
							UOMCalculation.InputUnitCost    = LocalDefaultUnitCost
							UOMCalculation.Method           = UOMCalculation.Method.ConvertToAlternate
							UOMCalculation.DoRounding  		= true
							LocalDefaultUnitCost            = UOMCalculation.OutputUnitCost

				if (LocalVendor not entered
				and RequisitionRel.Vendor entered
				and PurchasingCompanyRel.CostOrVendorDefaultingOrder.CostFirstThenVendor)
					LocalVendor 			= RequisitionRel.Vendor
					LocalPurchaseFromLocation	= RequisitionRel.PurchaseFromLocation
					if ((DefaultItemType.Inventoried
					or DefaultItemType.NonStock)
					and	DerivedUOM entered)
						if (VendorItemDefaultRel.VendorBuyUOM.UnitOfMeasure entered
						or UnitOfMeasure entered)
							LocalVendorItem = VendorItemDefaultRel.VendorItem
							initialize UOMCalculation
							UOMCalculation.InputUOM			= LocalCostUOM
							if (UnitOfMeasure entered)
								UOMCalculation.InputToUOM		= UnitOfMeasure
								LocalCostUOM					= UnitOfMeasure
							else
							if (VendorItemDefaultRel.VendorBuyUOM.UnitOfMeasure entered)
								UOMCalculation.InputToUOM		= VendorItemDefaultRel.VendorBuyUOM.UnitOfMeasure
								LocalCostUOM					= VendorItemDefaultRel.VendorBuyUOM.UnitOfMeasure
							UOMCalculation.InputUnitCost    = LocalDefaultUnitCost
							UOMCalculation.Method           = UOMCalculation.Method.ConvertToAlternate
							UOMCalculation.DoRounding  		= true
							LocalDefaultUnitCost            = UOMCalculation.OutputUnitCost

				if (LocalVendorItem entered)
					if (LocalVendorItem.Manufacturer.ManufacturerCode entered)	
						LocalManufacturer		= LocalVendorItem.Manufacturer
						LocalManufacturerNumber	= LocalVendorItem.ManufacturerNumber
					else
						initialize LocalManufacturer
						initialize LocalManufacturerNumber
				else
				if (ContractLineDefaultRel.Manufacturer.ManufacturerCode entered)
					LocalManufacturer		= ContractLineDefaultRel.Manufacturer
					LocalManufacturerNumber	= ContractLineDefaultRel.ManufacturerNumber
				else
				if (VendorItemDefaultRel.Manufacturer.ManufacturerCode entered)
					LocalManufacturer		= VendorItemDefaultRel.Manufacturer
					LocalManufacturerNumber	= VendorItemDefaultRel.ManufacturerNumber
			else
				initialize LocalContract
				initialize LocalContractLine
				initialize LocalVendor
				initialize LocalVendorItem
				initialize LocalPurchaseFromLocation

			if (ContractLineRel exists
			and (ContractLineRel.OnHold
			or not ContractIsWithinEffectiveDate))
				initialize LocalDefaultUnitCost
				initialize LocalContract
				initialize LocalContractLine
				initialize LocalVendor
				LocalCostCode = CostCode.Entered
			round LocalDefaultUnitCost to nearest DerivedRoundTo		
			return LocalDefaultUnitCost

		NumberOfDecimalsQuantity is a ConditionalField
			type is Numeric size 1
			if (HasItem)
				Item.NumberOfDecimalsQuantity
			else
				InventoryCompanyRel.NumberOfDecimalsQuantity

		BuyQuantity is a DerivedField
			type is like Quantity
				precision is NumberOfDecimalsQuantity
			if (LocalQuantity entered)
				return LocalQuantity

			return Quantity

		DerivedQuantityWithUOM is a LabelField
			"<BuyQuantity>_<DerivedUOM>"

		DerivedQuantity is a DerivedField
			type is like Quantity
				precision is NumberOfDecimalsQuantity
			if (BuyQuantity entered)
				return BuyQuantity
			else
				return 1

		ItemAvailableSOH is a DerivedField
			type is like Quantity
				precision is NumberOfDecimalsQuantity
			default label is untranslatable				
			if ((FromCompanyLocation.FromLocation entered
			and ItemLocationRel.InventoryTracked)
			and DerivedAvailableQtyInTranUOM
			and not ItemRel.IsCatchWeightItem)
				if (ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure entered)
					LocalCostTranUOM				= ItemLocationRel.DefaultTransactionUOM
					return ItemLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
				else
					LocalCostTranUOM				= Item.DefaultTransactionUOM
					if (HasItemLocationStockUOM)
						LocalCostTranUOM 			= ItemLocationRel.ItemLocationStockUOM
						return ItemLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
					return ItemLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
			else
			if (ItemIsStockAtDefaultFromLocation
			and FromCompanyLocation.FromLocation = DefaultFromLocation)
				if (HasItemLocationStockUOM)
					LocalCostTranUOM 				= ItemLocationRel.ItemLocationStockUOM
					return ItemLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
				return ItemLocationRel.AvailableQuantity

			if (ItemAtRequisitionFromLocationRel exists
			and DerivedAvailableQtyInTranUOM
			and not ItemRel.IsCatchWeightItem)
				if (ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure entered)
					LocalCostTranUOM				= ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure
					return ItemAtRequisitionFromLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
				else
					if (HasItemLocationStockUOM)
						LocalCostTranUOM 			= ItemLocationRel.ItemLocationStockUOM
						return ItemAtRequisitionFromLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
					return ItemAtRequisitionFromLocationRel.AvailableQuantity
			else
				if (ItemAtRequisitionFromLocationRel exists)
					if (not ItemRel.IsCatchWeightItem
					and HasItemLocationStockUOM)
						LocalCostTranUOM 			= ItemLocationRel.ItemLocationStockUOM
						return ItemAtRequisitionFromLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
					return ItemAtRequisitionFromLocationRel.AvailableQuantity
					
			if (ItemIsStockAtRequesterFromLocation
			and DerivedAvailableQtyInTranUOM
			and not ItemRel.IsCatchWeightItem)
				if (ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure entered)
					LocalCostTranUOM				= ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure
					return ItemAtFromLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
				else
					if (HasItemLocationStockUOM)
						LocalCostTranUOM 			= ItemLocationRel.ItemLocationStockUOM
						return ItemAtFromLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
					return ItemAtFromLocationRel.AvailableQuantity
			else
				if (ItemIsStockAtRequesterFromLocation)
					if (not ItemRel.IsCatchWeightItem
					and HasItemLocationStockUOM)
						LocalCostTranUOM 			= ItemLocationRel.ItemLocationStockUOM
						return ItemAtFromLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
					return ItemAtFromLocationRel.AvailableQuantity
				


		ItemLocationRuleAvailableSOH is a DerivedField
			type is like Quantity
				precision is NumberOfDecimalsQuantity
			default label is untranslatable
			if (Item exists) 				
				if (DerivedLocationRule entered)
	            	initialize LocalAvailableQuantity
	            	for each WarehouseLocationRuleDetailsRel
	            		LocalLocationRuleFromCompanyLocation.FromCompany = each.LocationCompany
	            		LocalLocationRuleFromCompanyLocation.FromLocation = each.InventoryLocation
	            		if (WarehouseLocationRuleItemLocationRel exists
	                    and WarehouseLocationRuleItemLocationRel.InventoryTracked
	            		and WarehouseLocationRuleItemLocationRel.Active)
	                		if (WarehouseLocationRuleItemLocationRel.AvailableQuantity >= 1)
	                			LocalFromCompanyLocationFromRule.FromCompany = LocalLocationRuleFromCompanyLocation.FromCompany
	                			LocalFromCompanyLocationFromRule.FromLocation = LocalLocationRuleFromCompanyLocation.FromLocation
	                			if (DerivedAvailableQtyInTranUOM)
									if (DefaultTransactionCost entered)
										LocalCostTranUOM				= TransactionCostDefault.DefaultUOM
										return WarehouseLocationRuleItemLocationRel.AvailableQuantity / ItemUOMTranRel.UOMConversion
								else
	                				return WarehouseLocationRuleItemLocationRel.AvailableQuantity
	                			end for each
	                		else
	                			if (WarehouseLocationRuleItemLocationRel.AvailableQuantity > LocalAvailableQuantity
	                			or LocalFromCompanyLocationFromRule not entered)
	        						LocalAvailableQuantity = WarehouseLocationRuleItemLocationRel.AvailableQuantity
	                				LocalFromCompanyLocationFromRule.FromCompany = LocalLocationRuleFromCompanyLocation.FromCompany
	        						LocalFromCompanyLocationFromRule.FromLocation = LocalLocationRuleFromCompanyLocation.FromLocation
					
		ItemAvailableSOHUOM is a DerivedField
			type is like UnitOfMeasure
			if  (DefaultItemType.Inventoried
			and Item.IsCatchWeightItem
			and IsValidItem)
				return Item.SecondaryUOM
			else
			if (DerivedAvailableQtyInTranUOM)
				if (ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure entered)
					return ItemLocationRel.DefaultTransactionUOM.UnitOfMeasure
				else
				if (HasItemLocationStockUOM)
					return ItemLocationRel.ItemLocationStockUOM
				return Item.DefaultTransactionUOM
			else
			if (HasItemLocationStockUOM)
				return ItemLocationRel.ItemLocationStockUOM
			else
				return BaseUOM

		DerivedItemAvailableSOH is a DerivedField
			type is Alpha size up to 50
			if (DefaultItemType.Inventoried)
				if (DerivedLocationRule entered)
					return ItemLocationRuleAvailableSOH + " " + ItemAvailableSOHUOM
				else
					return ItemAvailableSOH + " " + ItemAvailableSOHUOM
			else
				return blank
								
		DefaultCurrencyCode	is a DerivedField
			type is like Currency
			if (HasContractLine)
				return Contract.CurrencyCode
			else
				return InventoryCompanyRel.Company.Currency

		ItemDescription is a DerivedField
			type is like Description
			if (Item exists)
				return Item.Description
			else
				if (SpecialItemDescription entered)
					return SpecialItemDescription
				else
					return ServiceDescription

		ItemDescription2 is a DerivedField	
			type is like Description
			if (Item exists)
				return Item.Description2
			else
				return ItemContractLinesRel.ItemDescription2

		ItemDescription3 is a DerivedField	
			type is like Description3
			if (Item exists)
				return Item.Description3
			else
				return ItemContractLinesRel.ItemDescription3
						 
		DerivedContractID is a DerivedField
			type is like Contract
			if (LocalContract entered)
				return LocalContract
			else
				if (LocalCostCode.Contract
				or  LocalCostCode.CatalogQuote
				or  LocalCostCode.Blanket
				or  LocalCostCode.TierCompanyParticipant
				or  LocalCostCode.TierIcLocationParticipant
				or  LocalCostCode.TierReqLocParticipant)
					return Contract
									 
		DerivedContractLine is a DerivedField
			type is like ContractLine
			if (LocalContractLine entered)
				return LocalContractLine
			else
				if (LocalCostCode.Contract
				or  LocalCostCode.CatalogQuote
				or  LocalCostCode.Blanket
				or  LocalCostCode.TierCompanyParticipant
				or  LocalCostCode.TierIcLocationParticipant
				or  LocalCostCode.TierReqLocParticipant)
					return ContractLine
					
		DerivedVendor is a DerivedField
			type is like Vendor
			if (HasItem or LocalCostCode.LastPoCreated)
				return LocalVendor
			else
				if (LocalCostCode.Contract
				or  LocalCostCode.CatalogQuote
				or  LocalCostCode.Blanket
				or  LocalCostCode.TierCompanyParticipant
				or  LocalCostCode.TierIcLocationParticipant
				or  LocalCostCode.TierReqLocParticipant)				
					return ContractRel.Vendor
						 
		DerivedPurchaseFromLocation is a DerivedField
			type is like PurchaseFromLocation
			if (HasItem)
				return LocalPurchaseFromLocation
			else
				if (LocalCostCode.Contract
				or  LocalCostCode.CatalogQuote
				or  LocalCostCode.Blanket
				or  LocalCostCode.TierCompanyParticipant
				or  LocalCostCode.TierIcLocationParticipant
				or  LocalCostCode.TierReqLocParticipant)	
					if (ContractRel.ApPoPurchaseFrom.VendorLocation entered)
						return ContractRel.ApPoPurchaseFrom.VendorLocation
					else			
						return ContractRel.ApPoPurchaseFrom.PurchaseFromLocation
					
		VendorAndVendorName is a StringField
            type is Alpha size up to 42
            restricted
            DerivedVendor
            " - "
            VendorRel.VendorName
					
		PurchaseFromLocationAndVendorName is a StringField
            type is Alpha size up to 37
            restricted
            DerivedPurchaseFromLocation
            " - "
            PurchaseFromLocationRel.VendorName

        DerivedVendorAndVendorName is a DerivedField
            type is Alpha size up to 42
            if (DerivedVendor entered)
            	return VendorAndVendorName
            	
        DerivedPurchaseFromLocationAndVendorName is a DerivedField
            type is Alpha size up to 37
            if (DerivedPurchaseFromLocation entered)
            	return PurchaseFromLocationAndVendorName

		DerivedVendorAndPurchaseFrom is a ConditionalField
			type is MessageField
            if (DerivedPurchaseFromLocation not entered)
				"Vendor: " + VendorRel.VendorName
			else
				"Vendor: " + VendorRel.VendorName + " Purchase From: " + PurchaseFromLocationRel.VendorName

		DerivedVendorItem is a DerivedField
			type is like VendorItem
			if (HasItem)
				return LocalVendorItem
			else
				if (LocalCostCode.Contract
				or  LocalCostCode.CatalogQuote
				or  LocalCostCode.Blanket
				or  LocalCostCode.TierCompanyParticipant
				or  LocalCostCode.TierIcLocationParticipant
				or  LocalCostCode.TierReqLocParticipant)				
					return ItemContractLinesRel.VendorItem

		DerivedVendorItemDescription is a DerivedField
			type is like Description
			if (HasItem
			and DerivedVendorItem entered)
				return Item.VendorItemRel.VendorItemDescription
			else
				if (LocalCostCode.Contract
				or  LocalCostCode.CatalogQuote
				or  LocalCostCode.Blanket
				or  LocalCostCode.TierCompanyParticipant
				or  LocalCostCode.TierIcLocationParticipant
				or  LocalCostCode.TierReqLocParticipant)				
					return ItemContractLinesRel.VendorItemDescription

		CostCode is a DerivedField
			type is like CostCode
			if (LocalCostCode entered)
				return LocalCostCode
			else
				return CostCode.Entered
										 		
		CostCodeLabel is a DerivedField
			type is MessageField
			if (CostCode.Entered)
				return EnteredCostCodeLabel
			else
			if (CostCode.LastCost)
				return LastCostCostCodeLabel
			else
			if (CostCode.Contract)
				return ContractCostCodeLabel
			else
			if (CostCode.CatalogQuote)
				return CatalogQuoteCostCodeLabel
			else
			if (CostCode.Blanket)
				return BlanketCostCodeLabel
			else
			if (CostCode.LastPoCreated)
				return LastPoCreatedCostCodeLabel
			else
			if (CostCode.InventoryCost)
				return InventoryCostCodeLabel
			else
			if (CostCode.Punchout)
				return PunchoutCostCodeLabel
			else
			if (CostCode.TierCompanyParticipant)
				return TierCompanyParticipantCostCodeLabel
			else
			if (CostCode.TierIcLocationParticipant)
				return TierIcLocationParticipant
			else
			if (CostCode.TierReqLocParticipant)
				return TierReqLocParticipant
			else
			if (CostCode.Website)
				return WebsiteCostCodeLabel
			else
			if (CostCode.ProcurementTemplateContract)
				return ProcurementTemplateContractCostCodeLabel
			else
			if (CostCode.Standing)
				return StandingCostCodeLabel
			else
			if (CostCode.StrategicSourcing)
				return StrategicSourcingCostCodeLabel
			else
				return ""		

		CostOption is a DerivedField
			type is like CostOption
			if (LocalCostOption entered)
				return LocalCostOption						 
			else
				return CostOption.CostRequired						 
						 
		CostOptionLabel is a DerivedField
			type is MessageField
			if (CostOption.CostRequired)
				return CostRequiredLabel						 
			else
			if (CostOption.NoCharge)	
				return NoChargeLabel
			else
			if (CostOption.VendorDetermined)
				return VendorDeterminedLabel
				
		BaseUOM is a DerivedField
			type is AlphaUpper size 4
    		restricted
			if (IsValidItem)
				return Item.StockUOM
			else
				return BuyUOM	    
		
		UOMMultiplier is a DerivedField
			type is like UOMConversion
    		restricted
			if (HasItemLocationStockUOM)
				LocalCostConversionUOM = LocalCostUOM
				return ItemUOMConversionRel.UOMConversion / ItemLocationRel.ItemLocationStockUOM.UOMConversion
			else
			if (HasItem)
				return ItemUOMRel.UOMConversion
			else			
				return 1

		DerivedUOMMultiplier is a DerivedField
			type is like UOMConversion
				precision is NumberOfDecimalsQuantity
    		restricted
			if (HasItemLocationStockUOM)
				LocalCostConversionUOM = LocalCostUOM
				return ItemUOMConversionRel.UOMConversion / ItemLocationRel.ItemLocationStockUOM.UOMConversion
			else
			if (HasItem)
				return ItemUOMRel.UOMConversion
			else			
				return 1
				 
		ItemUOMConversion is a DerivedField
			type is MessageField
			if (HasItemLocationStockUOM)
				return UOMMultiplier + " " + ItemLocationRel.ItemLocationStockUOM + " per " + DerivedUOM
			else
				return UOMMultiplier + " " + BaseUOM + " per " + DerivedUOM

		DerivedItemUOMConversion is a DerivedField
			type is MessageField
			restricted
			if (HasItemLocationStockUOM)
				return DerivedUOMMultiplier + " " + ItemLocationRel.ItemLocationStockUOM + " per " + DerivedUOM
			else
				return DerivedUOMMultiplier + " " + BaseUOM + " per " + DerivedUOM
		
		DerivedContractUOMConversion is a DerivedField
			type is like UOMConversion
				precision is NumberOfDecimalsQuantity
    		restricted
			return ContractLine.UOMUnitConversion

		ContractItemUOMConversion is a MessageField
			"<DerivedContractUOMConversion>_per<ContractLine.UOM.UnitOfMeasure>"

		DerivedDefaultContractUOMConversion is a DerivedField
			type is like UOMConversion
				precision is NumberOfDecimalsQuantity
    		restricted
			return ContractLineDefaultRel.UOM.UOMConversion

		DefaultContractUOMConversion is a MessageField
			"<DerivedDefaultContractUOMConversion>_<BaseUOM>per<ContractLineDefaultRel.UOM.UnitOfMeasure>"
				
		UnitOfMeasureConversion	 is a DerivedField
			type is MessageField
			if (Item exists)
				return ItemUOMConversion			
			if (ContractLine.UOMConversion != 0)
				return ContractItemUOMConversion

		DefaultUOMConversion	 is a DerivedField
			type is MessageField
			if (Item exists)
				return DerivedItemUOMConversion
			if (ContractLine.UOMConversion != 0)
				return ContractItemUOMConversion
			else
				return DerivedItemUOMConversion	

		DerivedManufacturer is a DerivedField
			type is like ManufacturerCode
			if (LocalManufacturer entered)
				return LocalManufacturer
			else
				return ContractLineDefaultRel.Manufacturer							

		DerivedManufacturerCode is a DerivedField
			type is like ManufacturerCode
			if (LocalManufacturer.ManufacturerCode entered)
				return LocalManufacturer.ManufacturerCode
			else
				return ContractLineDefaultRel.Manufacturer.ManufacturerCode 							

		DerivedManufacturerDivision is a DerivedField
			type is like ManufacturerDivision
			if (LocalManufacturer.ManufacturerDivision entered)
				return LocalManufacturer.ManufacturerDivision
			else
				return ContractLineDefaultRel.Manufacturer.ManufacturerDivision

		DerivedManufacturerNumber is a DerivedField
			type is like ManufacturerNumber
			if (LocalManufacturerNumber entered)
				return LocalManufacturerNumber
			else
				return ContractLineDefaultRel.ManufacturerNumber

		DerivedManufacturerInformation is a DerivedField
			type is MessageField
 			default label is "Manufacturer"
			if (DerivedManufacturerCode entered)
				if (DerivedManufacturerDivision entered)
					return "Manufacturer: " + DerivedManufacturerCode + " - " + DerivedManufacturerDivision + " - " + DerivedManufacturerNumber
				else	
					return "Manufacturer: " + DerivedManufacturerCode + " - " + DerivedManufacturerNumber
			else
				if (DerivedManufacturerNumber entered)
					return "Manufacturer: " + DerivedManufacturerNumber
					
		DerivedManufacturerDescription is a DerivedField
			type is like Description
			if (LocalManufacturer.Description entered)
				return LocalManufacturer.Description
			else
				return ContractLineDefaultRel.Manufacturer.Description 							

		DerivedStrippedManufacturerNumber is a DerivedField
			type is like ManufacturerNumber
			return com.lawson.apps.procurement.base.StringUtils.stripNonAlphaNumeric(ManufacturerNumber)

		DerivedStrippedItem is a DerivedField
			type is like Item
			return com.lawson.apps.procurement.base.StringUtils.stripNonAlphaNumeric(Item)
		
		ItemActive is a DerivedField
			type is Boolean
			if (Item exists)
				return Item.Active
			return true
			
		DerivedItem is a DerivedField
			type is like Item
			if (Item entered)
				return Item
			else
				return SpecialItem

		DerivedVendorForList is a DerivedField
			type is like Vendor
			return first ProcurementTemplateParticipantsByVendorRel.Vendor
		
		DerivedItemUOMAndDescription 	is a StringField
			type is Alpha size up to 67
			DerivedUOM
			" - "
			BuyUOMRel.Description
			
        ItemUOMAndDescription is a DerivedField
            type is Alpha size up to 67
            if (BuyUOM entered)
            	return DerivedItemUOMAndDescription
            
       	IsRequesterFavoritePOTemplate	is a DerivedField
			type is Boolean
            return ProcurementTemplate.IsRequesterFavoritePOTemplate
            
        ProcurementTemplateUpdateAllowed is a DerivedField
        	type is Boolean
        	return ProcurementTemplate.ProcurementTemplateUpdateAllowed
        	
        DerivedItemType is a DerivedField
        	type is Numeric 1
        	if (ContractLine entered)
        		return TransientItemType.FromContractLine	
        	else
        	if (IsSpecialItem)
        		return TransientItemType.SpecialItem
        	else
        	if (ServiceDescription entered)
        		return TransientItemType.Service
        	else
        	if (Item exists)
        		return TransientItemType.ItemMasterItem
        
        DerivedValidUOM is a DerivedField
        	type is Boolean
        	if  (ContractLine.ItemType.Itemmast and ItemUOMExistsRel exists)
        		return true
        	if (ContractLine.ItemType.Itemmast and (not Contract.UOMSMustMatch or IsMatchingUOM))
        		return true
			if (ContractLine.ItemType.Special  and (not Contract.UOMSMustMatchForSpecials or IsMatchingUOM))
				return true
        	return false
        	
        DerivedRoundTo			is a DerivedField
			type is Unsigned Decimal 21.8
			if (NumberOfDecimalsCost = 8)
				return .00000001
			else
			if (NumberOfDecimalsCost = 7)
				return .0000001
			else
			if (NumberOfDecimalsCost = 6)
				return .000001
			else
			if (NumberOfDecimalsCost = 5)
				return .00001
			else
			if (NumberOfDecimalsCost = 4)
				return .0001
			else
			if (NumberOfDecimalsCost = 3)
				return .001
			else
			if (NumberOfDecimalsCost = 2)
				return .01
			else
			if (NumberOfDecimalsCost = 1)
				return .1
			else
			if (NumberOfDecimalsCost = 0)
				return 1
			else
				return blank

		DerivedMaxRequisitionQtyMessage	is a MessageField
			"MaxRequisitionQuantityOf_<ItemLocationRel.DerivedMaximumRequisitionQuantity>_<Item.StockUOM>"	

		DerivedMaximumRequisitionQuantity is a DerivedField
			type is MessageField
			if (ItemLocationRel.MaximumRequisitionQuantity entered)
				return DerivedMaxRequisitionQtyMessage
				
		DerivedPicture is a DerivedField			
			type is BinaryDocument
			if (IsInventoryOrNonstock)
				return Item.Picture.File
			else
				return ContractLine.Picture.File

		ItemAddedMessage is a MessageField
			restricted
			"<Item>AddedToRequisition"

		ItemUpdatedMessage is a MessageField
			restricted
			"<Item>UpdatedOnRequisition"

		SelectedItemsAddedMessage is a MessageField
			restricted
			"SelectedItemsAddedToRequisition"

		SelectedItemsUpdatedMessage is a MessageField
			restricted
			"SelectedItemsUpdatedOnRequisition" 

		ItemAbbreviation is a DerivedField
			type is AlphaUpper 3
			restricted
			return ItemDescription
				
		DerivedPriority is a DerivedField
        	type is Numeric size 1
        	if (DerivedContractLine entered)
        		return ContractLineDefaultRel.Priority
	
        DerivedFAlocationPriorityLevelGroup is a StringField
            type is Alpha size up to 7
			restricted
			actor.context.FinanceEnterpriseGroup
			"^"
			RSSLPLAllocationPriorityLevelRel.AllocationPriorityLevel

		LineMessage is a MessageField
			restricted
			":_Line_"	

		TemplateMessage is a MessageField
			restricted
			"Procurement_\Template_"		

		MajorPurchasingClassAndDescription is a StringField
			type is Alpha size up to 88           
			DerivedMajorPurchasingClass
			" - "
			DerivedMajorPurchasingClassDesc
		
		MinorPurchasingClassAndDescription is a StringField
			type is Alpha size up to 88
			DerivedMinorPurchasingClass
			" - "
			DerivedMinorPurchasingClassDesc
				
		DerivedMajorPurchasingClass is a DerivedField
			type is like MajorPurchasingClass
			if (IsSpecialItem
			or IsServiceItem)
				if (ContractLine.MajorPurchasingClass entered)
					return ContractLine.MajorPurchasingClass
			
		DerivedMinorPurchasingClass is a DerivedField
			type is like MinorPurchasingClass
			if (IsSpecialItem
			or IsServiceItem)
				if (ContractLine.MinorPurchasingClass entered)
					return ContractLine.MinorPurchasingClass
			
		DerivedMajorPurchasingClassDesc is a DerivedField
			type is Alpha size up to 67
			if (IsSpecialItem
			or IsServiceItem)
				if (ContractLine.MajorPurchasingClass entered)
					return ContractLine.MajorPurchasingClass.Description
			
		DerivedMinorPurchasingClassDesc is a DerivedField
			type is Alpha size up to 67
			if (IsSpecialItem
			or IsServiceItem)
				if (ContractLine.MinorPurchasingClass entered)
					return ContractLine.MinorPurchasingClass.Description

		DerivedCurrencyCode is a DerivedField
			type is like Currency
			if (LocalCurrencyCode entered)
				return LocalCurrencyCode
			else
				return InventoryCompanyRel.Company.Currency
					
		DerivedContractItem is a DerivedField
			type is like YesOrNo
			if (DerivedContractID entered)
				return "Y"
			else
				return "N"
				
		RecallLabel is a LabelField
			"Recall"

		ContractLabel is a LabelField
			restricted
			"Contract:<DerivedContractID>Line:<DerivedContractLine>"

		PreferrredContractLabel is a LabelField
			restricted
			"PreferredContract:<DerivedContractID>Line:<DerivedContractLine>"

		OnContractLabel is a DerivedField
			type is MessageField
			if (ContractLineDefaultRel.PreferredLine)
				return PreferrredContractLabel
			else
				return ContractLabel

		KitLabel is a LabelField
			"KitItem"

		RecipeItemLabel is a LabelField
			"RecipeItem"

		LatexLabel is a LabelField
			"PackageIndicatesLatex"

		DerivedUnitCostWithCurrency is a LabelField
			"<DefaultUnitCost>_<DefaultCurrencyCode>"
		
		SpecialHandlingCodeLabel is a LabelField
			"HasSpecialHandlingCode"
		
		DerivedSpecialHandlingCode is a DerivedField
			type is Alpha size 25
			if (HasSpecialHandlingCode)
				if (ContractLine.SpecialHandlingCode entered)
					return ContractLine.SpecialHandlingCode
				else 
					return Item.SpecialHandlingCode
		
		DerivedSpecialHandlingInstructions is a DerivedField
			type is MessageField
			if (HasSpecialHandlingCode)
				if (ContractLine.SpecialHandlingCode entered)
					return ContractLine.SpecialHandlingInstructions
				else 
					return Item.SpecialHandlingInstructions

		DerivedTimeSensitive is a DerivedField
			type is Boolean
			if (HasSpecialHandlingCode)
				if (ContractLine.SpecialHandlingCode entered)
					return ContractLine.SpecialHandlingCode.TimeSensitive
				else 
					return Item.SpecialHandlingCode.TimeSensitive

		DerivedHandlingTimeInMinutes is a DerivedField
			type is Numeric 3
			if (HasSpecialHandlingCode)
				if (ContractLine.SpecialHandlingCode.TimeSensitive 
				and ContractLine.SpecialHandlingCode entered)
					return ContractLine.HandlingTimeInMinutes
				else 
					return Item.HandlingTimeInMinutes

		DerivedRequisitionLine is a DerivedField
			type is like RequisitionLine
			if (RequisitionLineItemRel exists)
				return first RequisitionLineItemRel.RequisitionLine

		DerivedRequisitionLineUpdate is a DerivedField
			type is like RequisitionLine
			if (RequisitionLineItemUpdateRel exists)
				return first RequisitionLineItemUpdateRel.RequisitionLine

		RSSLPLDerivedContractID is a DerivedField
			type is like Contract
			if (HasItem
			or LocalContract entered)
				return LocalContract
			else
				return Contract
		
		RSSLPLDerivedContractLine is a DerivedField
			type is like ContractLine
			if (HasItem 
			or LocalContractLine entered)
				return LocalContractLine
			else
				return ContractLine

		RSSLPLDerivedPriority is a DerivedField
			type is Numeric size 1
			if (RSSLPLDerivedContractLine entered)
				return RSSLPLContractLineRel.Priority
		
		RSSLPLDerivedContractLineActive is a DerivedField
			type is Alpha size up to 3
			if (RSSLPLDerivedContractLine entered)
				if (RSSLPLContractLineRel.HasBeenActivated)
					return "Yes"
				else
					return "No"
		
		RSSLPLDerivedPreferredLine is a DerivedField
			type is Alpha size up to 3
			if (RSSLPLDerivedContractLine entered)
				if (RSSLPLContractLineRel.PreferredLine)
					return "Yes"
				else
					return "No"

		DerivedItemGTIN is a DerivedField
			type is like ItemGTIN
			if (IsServiceItem or SpecialItem)
				if (ContractLine.GlobalTradeItemNumber entered)
					return ContractLine.GlobalTradeItemNumber

			if (Item.ItemGroup.AllowMultipleGTINs)
				if  (ContractLine.GlobalTradeItemNumber entered
				and  ContractLine.GlobalTradeItemNumber.UnitOfMeasure.UnitOfMeasure = DerivedUOM)
					return ContractLine.GlobalTradeItemNumber
				if (GTINWithMatchingManufacturerInfoRel.ItemGTIN entered)
					return GTINWithMatchingManufacturerInfoRel.ItemGTIN
				else
					return NoDefaultGTINRel.ItemGTIN
		
		RSSLPLDerivedUnitCostCurrencyCode	is a DerivedField
			type is MessageField
			if (RSSLPLDisplayCurrencyCode)
				return DerivedUnitCostWithCurrency
			else
				return DefaultUnitCost
		
	Context Fields
		PurchasingCompany
		PurchaseOrder	
		PurchaseOrderLine

	Field Groups
		TextSearchable
			Item
			ServiceDescription
			SpecialItemDescription
			ManufacturerNumber

    Conditions
		HasSpecialHandlingCode
			when (Item.SpecialHandlingCode entered 
			or ContractLine.SpecialHandlingCode entered)

		IsServiceItemByAmount
			when (ServiceCode.Amount)

        HasContract
        	restricted
            when (Contract entered)

        HasTemplateDocumentNumber
            classic name is HAS-DOC-NBR
        	restricted
            when (TemplateDocumentNumber entered)

        HasItem
            classic name is HAS-ITEMSLINE
            restricted
            when (Item exists
            and   ProcurementTemplateLine entered)

        HasDescription3 
			restricted 
			when (Description3Display entered)
		
		HasPicture 
			restricted
			when (DerivedPicture entered)
		
		RecallNoticesExist
        	restricted
        	when (RecallProductItemsRel exists)
        
        HasContractLine
        	restricted
            when (ContractLine entered)

        HasProcurementTemplateLine
            classic name is HAS-TEMPLATELN
        	restricted
            when (ProcurementTemplateLine entered)
                    	
        IsServiceItem
            when (ServiceCode.Quantity 
            or 	  ServiceCode.Amount)

        IsValidItem
        	restricted
        	when (Item exists)
         
        IsSpecialItem
        	restricted
        	when (SpecialItemDescription entered)
        
		ItemIsStockAtRequestingFromLocation
			restricted
			when (ItemAtRequestingFromLocationRel exists
			and ItemAtRequestingFromLocationRel.InventoryTracked)
			
		ManufacturerEntered
			restricted
			when (Manufacturer entered
			or    ManufacturerNumber entered)

		ItemHasMultipleUOMs
			restricted
			when (instance count of ItemUOMMultRel > 1)
						
		NotValidBuyUOM
			restricted
			when (UnitOfMeasure entered
			and   not IsNotValidUOM
			and   not SpecialItem
			and	  ServiceDescription not entered
			and   ItemUOMBuyRel not exists)
			
		ItemIsStockAtDefaultFromLocation
			restricted
			when (DefaultFromLocation entered
			and	  ItemLocationRel.InventoryTracked)
			
		IsUOMFieldValid
			restricted
			when ((not Contract.UOMSMustMatch and not ContractLine.SpecialOrService)
			or   (not Contract.UOMSMustMatchForSpecials and ContractLine.SpecialOrService))
		
		IsMatchingUOM
			restricted
			when (UnitOfMeasure = ContractLine.UOM)
		
		IsNotValidUOM
			restricted
			when  (UnitOfMeasure entered
			and    TransientItemType.FromContractLine
			and	   not ContractLine.ItemType.Service
			and    not DerivedValidUOM)
			
		HasItemContract
			restricted
			when (ItemContractLinesRel exists)
		
		HasItemContractLine
			restricted
			when (ActiveOrAmendmentContractLinesRel exists)

		ItemWithNoFromLocation
            when (ItemActive
            and   ItemLocationRel not exists
            and   ItemAtRequisitionFromLocationRel not exists)	
            
		ItemActiveAtFromLocation            
            when (ItemActive
            and   ItemLocationRel exists and ItemLocationRel.Active
            or    ItemAtRequisitionFromLocationRel exists and ItemAtRequisitionFromLocationRel.Active)	
		
		IsInventoryOrNonstock
			restricted
			when (DefaultItemType.Inventoried
			or DefaultItemType.NonStock)	

		IsKitItem	
			when (KitItemRel exists)
			
		ContractIsWithinEffectiveDate                                                                    
            restricted
			when (ContractLineRel exists
			and (ContractLine.EffectiveDate <= current corporate date
			and (ContractLine.ExpirationDate not entered
			or ContractLine.ExpirationDate >= current corporate date)))
				
        IsActive
        	restricted
            when (Item.Active)

		HasVendorParticipant
			restricted
			when (ProcurementTemplateParticipantsByVendorRel exists)
		
		IsASupplier
			restricted
			when (actor.agent(SupplierSourceId).SupplierSourceId exists)

		ItemLocationRelExists
			restricted
			when (ItemLocationRel exists
			and ItemLocationRel.Active
			and ItemLocationRel.InventoryTracked)
			
		LatexItem
			when (Item.Latex = 1)

		CostCodeIsContractBlanketCatalog
			restricted
			when (CostCode.Contract
			or CostCode.Blanket
			or CostCode.CatalogQuote)

		CostCodeIsLastCostLastPO
			restricted
			when (CostCode.LastCost
			or CostCode.LastPoCreated)

		IsInventoryCost
			restricted
			when (DefaultItemType.Inventoried
			and CostCode.InventoryCost
			and DefaultUnitCost != 0)

		IsCostNotEditable
			when ((not RequesterRel.OverrideContractCost
			and (CostCodeIsContractBlanketCatalog
			or CostCode.TierCompanyParticipant
			or CostCode.TierIcLocationParticipant
			or CostCode.TierReqLocParticipant))
			or (not RequesterRel.OverrideLastPOLastCost
			and CostCodeIsLastCostLastPO))

		IsCostUpdateProhibited
			when (IsCostNotEditable
			or    IsInventoryCost
			or    CostOption.NoCharge)

		InactiveInventoryOrNonStock
			restricted
			when (IsInventoryOrNonstock
			and not IsActive)

		RSSLPLCurrentRequisitionForRQCEntered
			restricted
			when (actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC entered)

		RSSLPLCurrentRequisitionMultiplier
			restricted
			when (actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC entered
			and   actor.agent(Employee).Employee.Requester.QuantityMultiplierOnShoppingListAllowed)

		RSSLPLCurrentRequisitionNoMultiplier
			restricted
			when (actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC entered
			and   !actor.agent(Employee).Employee.Requester.QuantityMultiplierOnShoppingListAllowed)

		MissingDefaultUnitCost
			restricted
			when (DefaultUnitCost not entered
			and CostOption.CostRequired)
		
		ContractItem
			when (ContractLineRel exists)

        HasSubstituteItem
			when (first AssociatedItemsRel exists)
		HasDefaultContractLine
			when (ContractLineDefaultRel exists)
		
		HasContractLineAndDisplayContract
			when (RSSLPLDerivedContractLine entered
			and   actor.agent(Employee).Employee.Requester.DisplayContract)

		ParItem
			restricted
			when (RequestingLocationRel.ParOrExchangeLocation 
			and (ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.ReplenishFrom entered							
			or ItemAtRequestingLocationRel.ItemReplenishmentSourcesRel.Vendor entered))

		HasItemLocationStockUOM
			when ((DefaultItemType.Inventoried
            or DefaultItemType.NonStock)
			and	  ItemLocationRel.HasItemLocationStockUOM)
		
		IsUsingLocationItemUOMDefaultBuyUOM
			when (HasItemLocationStockUOM
			and LocationItemUOMDefaultBuyingRel.UnitOfMeasure entered
			and LocationItemUOMDefaultBuyingRel.UnitOfMeasure = UnitOfMeasure)

		IsUsingLocationItemUOMDefaultTransactionUOM
			when (HasItemLocationStockUOM
			and LocationItemUOMDefaultTransactionRel.UnitOfMeasure entered
			and LocationItemUOMDefaultTransactionRel.UnitOfMeasure = UnitOfMeasure)

		ItemIsStockAtRequesterFromLocation
			restricted
			when (ItemAtFromLocationRel exists
			and ItemAtFromLocationRel.InventoryTracked)
			
		UOMIsDisplayedOnRequester
			restricted
			when (ItemLocationRel.InventoryTracked
			and  HasItem
			and  ItemHasMultipleUOMs
			and  RequesterRel.AvailableQuantityDisplayUOM.Transaction)
			
		UOMIsDisplayedOnInventoryCompany	
			when (ItemLocationRel.InventoryTracked
			and HasItem
			and ItemHasMultipleUOMs
			and RequesterRel.AvailableQuantityDisplayUOM not entered
			and InventoryCompanyRel.AvailableQuantityDisplayUOM.Transaction)

		DerivedAvailableQtyInTranUOM
			when (UOMIsDisplayedOnRequester 
			or   UOMIsDisplayedOnInventoryCompany)
		
		DisplayRequisitionDescription
			restricted
			when (RequesterRel.DisplayRequisitionDescription)
		
		DisplayStockOnHand
			restricted
			when (DefaultItemType.Inventoried
			and RequesterRel.DisplayStockOnHand)

		SetToDisplayOnlyTransactionUOM
			restricted
			when (RequesterRel.SetToDisplayOnlyTransactionUOM)

		DisplayRequestedDeliveryDate
			restricted
			when (RequesterRel.DisplayRequestedDeliveryDate)
		
		DisplayPurchaseClasses
			restricted
			when (RequesterRel.DisplayPurchaseClasses)

		RSSLPLAllocationPriorityLevelEnabled
			restricted
            when (RSSLPLConfigurationParameterRel exists)
								
		IsOnContract
			restricted
			when (not RequesterRel.OverrideContractCost
			and   LocalContract entered
			and   LocalContractLine entered)
		
		RSSLPLShowRequiredFields
			restricted
			when (RequesterRel.RequireBuyer
			or RequesterRel.RequirePOCode
			or RequesterRel.RequireCommodityCodeDisplay
			or RequesterRel.RequireDeliverTo
			or RequesterRel.RequireVendor)
		
		RSSLPLDisplayCurrencyCode
			restricted
			when (RequesterRel.RSSLPLDisplayCurrencyCode)
		
		RSSLPLDisplayAllocationPriorityLevel
			restricted
			when (RSSLPLAllocationPriorityLevelEnabled
			and RequesterRel.RSSLPLDisplayPriority)
		
		RSSLPLDisplayPriority
			restricted
			when (not RSSLPLAllocationPriorityLevelEnabled
			and RequesterRel.RSSLPLDisplayPriority)
		
		RSSLPLDisplayFromCompany
			restricted
			when (RequesterRel.RSSLPLDisplayFromCompany)
		
		RSSLPLDisplayFromLocation
			restricted
			when (RequesterRel.RSSLPLDisplayFromLocation)
		
		RSSLPLDisplayCompany
			restricted
			when (RequesterRel.RSSLPLDisplayCompany)
		
		RSSLPLDisplayRequestingLocation
			restricted
			when (RequesterRel.RSSLPLDisplayRequestingLocation)

    Relations
        PurchasingCompanyRel
            classic name is PO-COMPANY
            one-to-one relation to PurchasingCompany
            Field Mapping uses symbolic key
                related.Company = DerivedCompany
    
    	ContractLineRel
            one-to-many relation to ContractLine
            Field Mapping uses symbolic key
                related.ContractGroup   				= 	ProcurementGroup
                related.Contract        				= 	Contract
                related.ContractLine                    =   ContractLine
                
        RecallProductItemsRel
			one-to-many relation to RecallProductItem
			Field Mapping uses ByItem
				related.RecallGroup	= ProcurementGroup
				related.Item        = Item
    		Instance Selection
    			where (related.RecallNotice.Status.Pending
    			or     related.RecallNotice.Status.Active)
        VendorItemDefaultRel
            one-to-many relation to VendorItem
            Field Mapping uses symbolic key
                related.ProcurementGroup 				= ProcurementGroup
                related.Item             				= Item
        		related.Vendor							= LocalVendor
        	Instance Selection
        		where (related.UseAsDefault)

        OtherProcurementTemplateLinesRel
        	one-to-many relation to ProcurementTemplateLine
        	Field Mapping uses ByItemUOM
        		related.ProcurementGroup 				= 	ProcurementGroup
        		related.ProcurementTemplate 			= 	ProcurementTemplate
        		related.Item							= 	Item
        		related.UnitOfMeasure					= 	UnitOfMeasure
        	Instance Selection
        		where (related.ProcurementTemplateLine != 	ProcurementTemplateLine)
        		
        ItemUOMDefaultRel
        	one-to-many relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup	= ProcurementGroup
        		related.Item		= Item
        	Instance Selection
        		where (related.DefaultForBuying)

        ItemUOMBuyRel
        	one-to-many relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup		= ProcurementGroup
        		related.Item			= Item
        		related.UnitOfMeasure	= UnitOfMeasure
        	Instance Selection
        		where (related.OKForBuying)

		RequisitionLineItemRel
			one-to-many relation to RequisitionLine
			Field Mapping uses Set8
				related.Company 				= LocalCompanyForQuantityAdd
				related.Item					= DerivedItem
				related.Requisition				= LocalRequisitionForQuantityAdd
			Instance Selection
				where (related.EnteredUOM = LocalCostUOMForQuantityAdd
				and    related.ItemType   = DefaultItemType
				and    related.UnitCost   = LocalUnitCostForQuantityAdd)

		RequisitionLineItemUpdateRel
			one-to-many relation to RequisitionLine
			Field Mapping uses Set8
				related.Company 				= LocalCompanyForQuantityAdd
				related.Item					= DerivedItem
				related.Requisition				= LocalRequisitionForQuantityAdd
			Instance Selection
				where (related.EnteredUOM = TransientCostUOM
				and    related.ItemType   = DefaultItemType
				and    related.UnitCost   = TransientDefaultUnitCost)

		RequisitionLineItemMatchRel
			one-to-one relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company				= LocalCompanyForQuantityAdd
				related.Requisition			= LocalRequisitionForQuantityAdd
				related.RequisitionLine		= DerivedRequisitionLine
        		
  		RequisitionLineItemMatchUpdateRel
			one-to-one relation to RequisitionLine
			Field Mapping uses symbolic key
				related.Company				= LocalCompanyForQuantityAdd
				related.Requisition			= LocalRequisitionForQuantityAdd
				related.RequisitionLine		= DerivedRequisitionLineUpdate
        		
        ItemTransientCostUOMRel
        	one-to-one relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup		= ProcurementGroup
        		related.Item			= Item
        		related.UnitOfMeasure	= TransientCostUOM
        		
        ItemUOMRel
        	one-to-one relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup		= ProcurementGroup
        		related.Item			= Item
        		related.UnitOfMeasure	= DerivedUOM	
        		
        ItemUOMExistsRel
        	one-to-many relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup		= ProcurementGroup
        		related.Item			= Item
        		related.UnitOfMeasure	= UnitOfMeasure
 
		ItemUOMMultRel
			one-to-many relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup		= ProcurementGroup
        		related.Item			= Item

		ItemUOMTranRel
			one-to-one relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup		= ProcurementGroup
        		related.Item			= Item
        		related.UnitOfMeasure	= LocalCostTranUOM

		GTINWithMatchingManufacturerInfoRel
			one-to-many relation to ItemGTIN
			Field Mapping uses Set7
				related.ItemGroup			= ProcurementGroup
                related.Manufacturer		= LocalManufacturer
                related.ManufacturerNumber	= DerivedManufacturerNumber
                related.Item				= Item
                related.UnitOfMeasure		= DerivedUOM
			Instance Selection
				where (related.Active
				and    related.UseAsDefaultPerUOM)			

		NoDefaultGTINRel
			one-to-many relation to ItemGTIN
			Field Mapping uses Set7
				related.ItemGroup			= ProcurementGroup
                related.Manufacturer		= LocalManufacturer
                related.ManufacturerNumber	= DerivedManufacturerNumber
                related.Item				= Item
                related.UnitOfMeasure		= DerivedUOM
			Instance Selection
				where (related.Active)

        PurchaseOrderInterfaceRel
        	one-to-one relation to PurchaseOrderInterface
        	Field Mapping uses symbolic key
        		related.Company										 = LocalPurchasingCompany
        		related.PurchaseOrderInterface.SourceDocumentOrigin  = SourceDocumentOrigin.ProcurementTemplates
        		related.PurchaseOrderInterface.SourceDocumentNumeric = TemplateDocumentNumber
        		related.PurchaseOrderInterface.SourceDocumentAlpha	 = blank
        		related.PurchaseOrderInterface.OperatingCompany		 = LocalOperatingCompany
        		related.PurchaseOrderInterface.RequestingLocation	 = blank
        		related.PurchaseOrderInterface.LineNumber			 = ProcurementTemplateLine
				
        InventoryCompanyRel
            one-to-one relation to InventoryCompany
            Field Mapping uses symbolic key
                related.Company = DerivedCompany

		RequestingLocationRel 
			one-to-one relation to RequestingLocation
			Field Mapping uses symbolic key
				related.Company     		= DerivedCompany
				related.RequestingLocation  = DerivedRequestingLocation

		RequesterRel
            one-to-one relation to Requester
            Field Mapping uses symbolic key
            	related.HROrganization = actor.agent(Employee).HROrganization
                related.Requester = actor.agent(Employee).Employee.Requester.Requester
				
		RequisitionRel
			one-to-one relation to Requisition
			Field Mapping uses symbolic key
				related.Company				= RequesterRel.CurrentCompanyForRQC
				related.Requisition			= RequesterRel.CurrentRequisitionForRQC

		ItemAtRequestingLocationRel
			one-to-one relation to ItemLocation
            Field Mapping uses symbolic key
				related.Company				= DerivedCompany
				related.InventoryLocation  	= DerivedRequestingLocation
				related.Item				= Item

		ItemAtRequestingFromLocationRel
			one-to-one relation to ItemLocation
            Field Mapping uses symbolic key
				related.Company				= RequestingLocationRel.FromCompanyLocation.FromCompany
				related.InventoryLocation  	= RequestingLocationRel.FromCompanyLocation.FromLocation
				related.Item				= Item

		ItemAtRequisitionFromLocationRel
			one-to-one relation to ItemLocation
			Field Mapping uses symbolic key
				related.Company				= RequisitionRel.FromCompanyLocation.FromCompany
				related.InventoryLocation  	= RequisitionRel.FromCompanyLocation.FromLocation
				related.Item				= Item
				
		ItemAtLocationRuleFromLocationRel
			one-to-one relation to ItemLocation
            Field Mapping uses symbolic key
				related.Company				= DefaultLocationRuleFromCompany
				related.InventoryLocation  	= DefaultLocationRuleFromLocation
				related.Item				= Item
					
		ItemLocationRel
			one-to-one relation to ItemLocation
            Field Mapping uses symbolic key
                related.Company           = DefaultFromCompany 
                related.InventoryLocation = DefaultFromLocation
                related.Item              = Item

		FromCompanyRel
			one-to-one relation to InventoryCompany
            Field Mapping uses symbolic key
                related.Company           = DefaultFromCompany

		FromLocationRel
			one-to-one relation to InventoryLocation
            Field Mapping uses symbolic key
                related.Company           = DefaultFromCompany 
                related.InventoryLocation = DefaultFromLocation
                		
		ProcurementTemplateParticipantsByCompanyAndRequesterRel
            one-to-many relation to ProcurementTemplateParticipant
            Field Mapping uses symbolic key
                related.ProcurementGroup    = ProcurementTemplate.ProcurementGroup
                related.ProcurementTemplate = ProcurementTemplate						
            Instance Selection
            	where (ProcurementTemplate.RSSIParticipate)
            	
		ProcurementTemplateParticipantsByVendorRel
            one-to-many relation to ProcurementTemplateParticipant
            Field Mapping uses symbolic key
                related.ProcurementGroup    = ProcurementTemplate.ProcurementGroup
                related.ProcurementTemplate = ProcurementTemplate	
			Instance Selection 
				where (related.Vendor entered)

		BuyUOMRel
        	one-to-one relation to UnitOfMeasure
        	Field Mapping uses symbolic key
        		related.ItemGroup		= ProcurementGroup
        		related.UnitOfMeasure	= DerivedUOM					

		RecallProductItemForItemRel
    		one-to-many relation to RecallProductItem
    		Field Mapping uses ByItem
    			related.RecallGroup	= ProcurementGroup
    			related.Item        = Item
    		Instance Selection
    			where (related.RecallNotice.Status.Pending
    			or     related.RecallNotice.Status.Active)

		ContractRel
			one-to-one relation to Contract
			Field Mapping uses symbolic key
				related.ContractGroup    = ProcurementGroup
				related.Contract	   	 = DerivedContractID
				
		ItemContractLinesRel
			one-to-many relation to ContractLine
			Field Mapping uses ByItemContractLine
				related.ContractGroup	= ProcurementGroup
				related.ItemNumber		= Item
				
		ActiveOrAmendmentContractLinesRel
			one-to-many relation to ContractLine
			Field Mapping uses ByItemContractLine
				related.ContractGroup	= ProcurementGroup
				related.ItemNumber		= Item
				related.Contract		= Contract
			Instance Selection
				where (related.ContractLineState.Active
				or 	   related.ContractLineState.Amendment)
		
		VendorRel
			one-to-one relation to Vendor
			Field Mapping uses symbolic key
				related.VendorGroup	= ProcurementGroup
				related.Vendor		= DerivedVendor

		PurchaseFromLocationRel
			one-to-one relation to VendorLocation
			Field Mapping uses symbolic key
				related.VendorGroup				= ProcurementGroup
				related.Vendor					= DerivedVendor
				related.VendorLocation			= DerivedPurchaseFromLocation

		KitItemRel
			one-to-one relation to KitItem
			Field Mapping uses symbolic key
				related.ItemGroup							= ProcurementGroup
				related.KitItem.Company						= DefaultFromCompany
				related.KitItem.InventoryLocation			= DefaultFromLocation
				related.KitItem.Item						= Item
				
		ContractLineDefaultRel
			one-to-one relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup    = ProcurementGroup
				related.Contract	   	 = DerivedContractID
				related.ContractLine     = DerivedContractLine
				
		WarehouseLocationRuleDetailsRel
            one-to-many relation to WarehouseLocationRuleDetail
            Field Mapping uses symbolic key
                related.Company               = DerivedCompany
                related.WarehouseLocationRule = DerivedLocationRule
                
        WarehouseLocationRuleItemLocationRel
            one-to-one relation to ItemLocation
            Field Mapping uses symbolic key
                related.Company               = LocalLocationRuleFromCompanyLocation.FromCompany
                related.InventoryLocation     = LocalLocationRuleFromCompanyLocation.FromLocation
                related.Item                  = Item
		AssociatedItemsRel
			one-to-many relation to AssociatedItem
			Field Mapping uses symbolic key
				related.ItemGroup = ProcurementGroup
				related.Item      = Item
			Instance Selection
				where (related.AssociatedItem.AssociatedItemSubType.Substitute
				and	   related.AssociatedItem.IsWithinEffectiveDate
				and	   (related.AssociatedItem.ItemRel.Active
				or		(related.AssociatedItem.Contract entered
				and		 related.AssociatedItem.IsWithinContractLineEffectiveDate
				and	not	 related.AssociatedItem.ContractLineNotAvailable
				and not  related.AssociatedItem.ContractLineClosed
				and      related.AssociatedItem.IsValidContractParticipantForRSSLPL))
				and 	((related.AssociatedItem.IsSubstituteForCompanyOnly
				and 	  related.AssociatedItem.RelatedCompany = DefaultFromCompany)
				or 		((related.AssociatedItem.RelatedCompany = DefaultFromCompany
				and 	  related.AssociatedItem.RelatedLocation = DefaultFromLocation)
				or		 related.AssociatedItem.IsNotLocationSpecific))
				and    (related.AssociatedItem.RelatedItemLocationRel.Active
				or 		related.AssociatedItem.RelatedItemLocationRel not exists))
				
		ItemRel
			one-to-one relation to Item
			Field Mapping uses symbolic key
				related.ItemGroup 			= ProcurementGroup
				related.Item      			= Item

		LocationItemUOMDefaultTransactionRel
			one-to-many relation to LocationItemUOM
			Field Mapping uses symbolic key
				related.Company  							= DefaultFromCompany
				related.InventoryLocation 					= DefaultFromLocation
				related.Item								= Item
			Instance Selection
				where (related.DefaultForInventoryTransactions)

		LocationItemUOMDefaultBuyingRel
			one-to-many relation to LocationItemUOM
			Field Mapping uses symbolic key
				related.Company  							= DefaultFromCompany
				related.InventoryLocation 					= DefaultFromLocation
				related.Item								= Item
			Instance Selection
				where (related.DefaultForBuying)

		ItemAtFromLocationRel
			one-to-one relation to ItemLocation
            Field Mapping uses symbolic key
				related.Company				= RequestingLocationRel.FromCompanyLocation.FromCompany
				related.InventoryLocation  	= RequestingLocationRel.FromCompanyLocation.FromLocation
				related.Item				= Item
		
		ItemUOMConversionRel
        	one-to-one relation to ItemUOM
        	Field Mapping uses symbolic key
        		related.ItemGroup		= ProcurementGroup
        		related.Item			= Item
        		related.UnitOfMeasure	= LocalCostConversionUOM

        VendorItemUsedRel
            one-to-many relation to VendorItem
            Field Mapping uses symbolic key
                related.ProcurementGroup 				= ProcurementGroup
                related.Item             				= Item
        		related.Vendor							= LocalVendor

		RSSLPLConfigurationParameterRel
            one-to-many relation to ConfigurationParameter
            Field Mapping uses symbolic key
                related.ConfigurationParameter.ConfigurationID  = "config"
                related.ConfigurationParameter.Name             = "RSS_LPLAllocationPriorityLevel"
			Instance Selection
				where (related.ConfigurationParameter.Value = "true")
		
		RSSLPLAllocationPriorityLevelRel
			one-to-many relation to AllocationPriorityLevel
			Field Mapping uses symbolic key
				related.FinanceEnterpriseGroup	= actor.context.FinanceEnterpriseGroup
			Instance Selection
				where (related.UseAsDefault)
		
		RSSLPLContractLineRel
			one-to-one relation to ContractLine
			Field Mapping uses symbolic key
				related.ContractGroup 			= ProcurementGroup
				related.Contract				= RSSLPLDerivedContractID
				related.ContractLine			= RSSLPLDerivedContractLine
				
    Sets
        Set2
            indexed
            Sort Order
                ProcurementGroup
                ProcurementTemplate
                Item
                ProcurementTemplateLine

        Set3
            indexed
            Sort Order
                ProcurementGroup
                Item
                ProcurementTemplate
                ProcurementTemplateLine

        Set4
            indexed
            Instance Selection
                where (HasTemplateDocumentNumber)
            Sort Order
                ProcurementGroup
                TemplateDocumentNumber
                ProcurementTemplateLine



		ByItemDescription
        	indexed   	        
            Sort Order
                ProcurementGroup                                
                ServiceDescription
                ProcurementTemplate
           	Instance Selection
				where (IsServiceItem)


		ByItemUOM
			Sort Order
				ProcurementGroup
				ProcurementTemplate
				Item
				UnitOfMeasure
				ProcurementTemplateLine

		ByDisplayOrder
			duplicates
			Sort Order
				ProcurementGroup
				ProcurementTemplate
				DisplayOrder
				ProcurementTemplateLine
				
		ByContractLine
			Sort Order
				ProcurementGroup
				Contract
				ContractLine
				ProcurementTemplate
				ProcurementTemplateLine				
		
    Field Rules
    	TemplateDocumentNumber
    		force default to ProcurementTemplate.TemplateDocumentNumber
    		
    	Contract
			if (Contract entered)
				if (HasVendorParticipant)
					constraint (first ProcurementTemplateParticipantsByVendorRel.Vendor = Contract.Vendor)
						"VendorParticipantMustBeTheSameAsContractVendor"
				constraint (Contract.HasBeenActivated)
					"ContractMustBeActive,Amendment,OrAddendum"
				constraint (Contract.ContractPurchaseType
				or          Contract.CatalogQuotePurchaseType)
					"OnlyContractOrCatalogPurchaseTypeContractsCanBeUsedForTemplates"
				constraint (Contract.IsValidForProcurementTemplate)
					"ContractCannotBeUsedForProcurementTemplate"
    	
    	ContractLine
    		if (ContractLine entered)
    			constraint (!ContractLineRel.ErrorsExist)
    				"CannotCreateTemplateLineFromContractLineWithErrors"
    				
    			constraint (ContractLineRel.CanUseForCostDefaulting)
    				"CannotCreateTemplateLineFromContractLineThatIsNotUsedForCostDefaulting"
    				
    			constraint (!ContractLineRel.ContractLineState.Closed)
    				"CannotCreateTemplateLineFromContractLineThatIsClosed"
    	
    	Manufacturer
			default to ContractLineRel.Manufacturer
    		if (SpecialItem)
    			required
    			
    	ManufacturerNumber
			default to ContractLineRel.ManufacturerNumber
    		if (SpecialItem)
    			required
    			
		DisplayOrder
			default to ProcurementTemplateLine

		DistributionAccount
		
			if (UseRequestingLocationAcctUnit)
				cannot be entered
					"CannotEnterDistributionAccountAndSetUseRequestingLocationAccountToTrue"
				
        Item
        	default to ContractLineRel.ItemNumber
			
			required
			if (TransientItemType.ItemMasterItem)
				constraint (Item exists)
					"Item<Item>DoesNotExist"
			else
			if (TransientItemType.SpecialItem 
			or  TransientItemType.Service)
				constraint (Item not exists)
					"CannotEnterItemMasterItemOnSpecialOrServiceTypeOfItem"
            	
	        constraint (OtherProcurementTemplateLinesRel not exists) 
				"CannotEnterTwoLinesWithSameItemAndSame_\U\O\M" 
			
        ServiceDescription
        	if (ContractLineRel.ServiceItemType)
	    		default to ContractLineRel.ItemDescription
        	
        	if (TransientItemType.Service
        	or  IsServiceItem)
        		required
        			"ServiceDescriptionMustBeEnteredForAServiceItem"		

		ServiceCode
			if (TransientItemType.Service)
				required
					"ServiceCodeIsRequiredForServiceTypeOfItem"
			else				
			if (ContractLineRel.ServiceItemType)
				default to ContractLineRel.ServiceCode	
					
        UnitOfMeasure
			default to ContractLineRel.UOM
        		
        	if (Quantity entered)
        		required
    				"MustEnterUnitOfMeasureWithAQuantity"
        	
			constraint (not TransientItemType.ItemMasterItem
			or			ItemUOMExistsRel exists)
					"<UnitOfMeasure>IsNotAValidUnitOfMeasureForItem"
					
        Quantity
        	if (ServiceCode.Amount)
            	constraint(Quantity = 1)
            		"ServiceItemByAmount,QuantityMustBe1"

        FromCompanyLocation
			if (FromCompanyLocation.FromLocation not entered)
				cannot be entered
					"CannotEnterFromCompanyWithoutFromLocation" 			
			
			if (FromCompanyLocation.FromCompany not entered)
				cannot be entered
					"CannotEnterFromLocationWithoutFromCompany" 			
		
		CommodityCode
			if (ContractLineRel.ServiceItemType)
				default to ContractLineRel.CommodityCode
		
        SpecialItemDescription
	    	if (ContractLineRel.SpecialItem)
	    		default to ContractLineRel.ItemDescription
	    	
	    	if (SpecialItemDescription entered)
        		SpecialItem = true
        		
	    	if (TransientItemType.SpecialItem
	    	or  SpecialItem)
	        	required
	        	
	    TransientItemType
	    	if (TransientItemType.SpecialItem)
				constraint (ProcurementGroup.AllowSpecialItemsOnTemplates)
					"ProcurementGroupDoesNotAllowSpecialItemsOnTemplatesThatAreNotAssociatedWithContracts"	    													

			if (InactiveInventoryOrNonStock and action type.Create)
				confirmation required 
					"Item<Item>IsCurrentlyInactive.Continue?"

	Actions


		CreateRequisitionLineFromTemplateLineSet is a Set Action
			restricted
			Parameters
				PrmProcurementGroup		is a ProcurementGroup
				PrmProcurementTemplate	is a ProcurementTemplate
					context of PrmProcurementGroup
				PrmInventoryCompany		is an InventoryCompany
				PrmRequisition			is a Requisition
				PrmCopyAllLines			is Boolean
			Instance Selection
				where (ProcurementGroup 	= PrmProcurementGroup
				and    ProcurementTemplate	= PrmProcurementTemplate)
            Local Fields
                CreateErrorMessage 		is Alpha size 200
			Action Rules
				Empty Set Rules
					invoke FinishCreateFromTemplate PrmRequisition
				Set Rules
					Exit Rules
						invoke FinishCreateFromTemplate PrmRequisition
				Instance Rules
					initialize CreateErrorMessage
					invoke CreateFromProcurementTemplateLine RequisitionLine
						resume on error
		            		CreateErrorMessage = error message
						invoked.PrmProcurementGroup			= PrmProcurementGroup
						invoked.PrmProcurementTemplate		= PrmProcurementTemplate
						invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
						invoked.PrmInventoryCompany			= PrmInventoryCompany
						invoked.PrmRequisition				= PrmRequisition
						invoked.PrmCopyAllLines 			= PrmCopyAllLines

					if (CreateErrorMessage entered)
						invoke Create RequisitionLineError
			                invoked.Company					= PrmInventoryCompany
			                invoked.Requisition				= PrmRequisition
							invoked.ErrorType 				= RequisitionLineError.ErrorType.Create
							if (CreateErrorMessage[1:7] = "Warning")
								invoked.ErrorMessageNumber 	= 999
							else
								invoked.ErrorMessage 		= TemplateMessage + PrmProcurementTemplate + LineMessage + ProcurementTemplateLine + ": " + CreateErrorMessage

		PopulateBlankItem is a Set Action
			restricted
    		Parameters
    			PrmProcurementGroup		is a ProcurementGroup
    		Instance Selection
    			where (ProcurementGroup = PrmProcurementGroup
    			and	  (IsServiceItem or SpecialItem)
    			and	   Item not entered)
    		Action Rules
    			Instance Rules
    				if (SpecialItem)
    					Item = SpecialItemDescription
    				else
    					Item = ServiceDescription
    					
		Create is a Create Action
			Action Rules
				constraint (!ProcurementTemplate.Locked)
					"ProcurementTemplateLocked,RecordsCannotBeInserted" 		
				
				if (FromCompanyLocation.FromCompany not entered
				and FromCompanyLocation.FromLocation not entered)
					FromCompanyLocation = ProcurementTemplate.FromCompanyLocation 
					
			Exit Rules
				include BuildTextIndex
				include BuildTemplateTextIndex
				invoke SendParticipantAddNotification ProcurementTemplate
					invoked.PrmLine = ProcurementTemplateLine
				
		Update is an Update Action
			Action Rules
				constraint (!ProcurementTemplate.Locked)
					"ProcurementTemplateLocked,RecordsCannotBeOrChanged" 		
			Exit Rules
				if (TextSearchable changed)
					include BuildTextIndex
					include BuildTemplateTextIndex
				invoke SendParticipantUpdateNotification ProcurementTemplate
					invoked.PrmLine = ProcurementTemplateLine

		Delete is a Delete Action
			Entrance Rules
				if (!LocalFromContract)
					constraint (!ProcurementTemplate.Locked)
						"ProcurementTemplateLocked,RecordsCannotBeChanged" 		
				invoke SendParticipantDeleteNotification ProcurementTemplate
					invoked.PrmLine = ProcurementTemplateLine
		
		IncludeInRequisitionLine is an Instance Action 
			completion message is "AddedToRequisitionNo<PrmRequisition>"
			default label is "AddToRequisition"
			Parameters
				PrmCompany						is an InventoryCompany
				PrmRequisition					is a Requisition
					default label is "Requisition"
				PrmVendor						is a Vendor
					default label is "Vendor"
				PrmPurchaseFromLocation			is a VendorLocation
					default label is "PurchaseFromLocation"
			Parameter Rules
				PrmCompany
					required
				PrmRequisition
					required
					constraint (!PrmRequisition.IsRejectedStatus)
						"RequisitionHasBeenRejected;CannotAddLine(s)"
					constraint (!PrmRequisition.IsClosedStatus)
						"RequisitionIsClosed;CannotAddLine(s)"
					constraint (!PrmRequisition.Status.Processed)
						"RequisitionHasBeenProcessed;CannotAddLine(s)"
					constraint (!PrmRequisition.NeedsApproval)
						"RequisitionNeedsApproval;CannotAddLine(s)"
					constraint (!PrmRequisition.IsCreateInProgress)
						"RequisitionCreationInProgress;CannotAddLine(s)"
			Action Rules
				if (HasContractLine)
					constraint (not ContractLine.OnHold)
						"CannotCreateRequisitionLine;Contract<Contract>Line<ContractLine>IsOnHold"
						
					if (DefaultItemType.Inventoried and not ItemLocationRel.NoCharge) 
						constraint (ContractLine.CostOption.CostRequired)
							"CostOptionCannotBeSetToNoChargeOrVendorDeterminedIfItemAtItemLocationIsChargeable"	
				
				invoke CreateFromProcurementTemplateLine RequisitionLine
					invoked.PrmProcurementGroup         = ProcurementGroup
					invoked.PrmProcurementTemplate		= ProcurementTemplate
					invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
					invoked.PrmInventoryCompany         = PrmCompany
					invoked.PrmRequisition              = PrmRequisition
					invoked.PrmVendor     		        = PrmVendor
					invoked.PrmPurchaseFromLocation 	= PrmPurchaseFromLocation
					if (IsASupplier)				
						invoked.PrmFromSupplierRequisition = true												
		
		MobileAddToRequisitionLine is an Instance Action
			restricted
			default label is "AddItems"
			completion message is "ItemAdded_toRequisition"
            Local Fields
            	LocalRequisitionView is a Requisition view
                LocalRequisition				is a Requisition
				LocalInventoryCompany			is an InventoryCompany
			Parameters
				PrmQuantity					is a Quantity
					precision is NumberOfDecimalsQuantity
                PrmTransactionUnitCost          is an InternationalCost
					precision is NumberOfDecimalsCost	
			Parameter Rules
				PrmQuantity
					initial value is Quantity
					default to Quantity
			Action Rules
				if (HasContractLine)
					constraint (not ContractLine.OnHold)
						"CannotCreateRequisitionLine;Contract<Contract>Line<ContractLine>IsOnHold"
				
				if (actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC not entered)
	            	invoke Create Requisition
    	            	assign result to LocalRequisitionView
	    	            invoked.Company					= actor.agent(Employee).Employee.Requester.Company
	        	        invoked.RequestingLocation		= actor.agent(Employee).Employee.Requester.RequestingLocation
	        	    LocalInventoryCompany = actor.agent(Employee).Employee.Requester.Company
	               	LocalRequisition = LocalRequisitionView.Requisition
					invoke UpdateCurrentRequisitionForRQC RequesterRel
						invoked.PrmCompany				= LocalInventoryCompany
						invoked.PrmRequisition     		= LocalRequisition
	           	else
	        	    LocalInventoryCompany = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
	          		LocalRequisition = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
	          		
				invoke CreateFromProcurementTemplateLine RequisitionLine
					invoked.PrmProcurementGroup         = ProcurementGroup
					invoked.PrmProcurementTemplate		= ProcurementTemplate
					invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
					invoked.PrmInventoryCompany         = LocalInventoryCompany 
					invoked.PrmRequisition              = LocalRequisition
					invoked.PrmQuantity					= PrmQuantity
		
		MobileAddSelectedToRequisitionLine is an Instance Action
			completion message is "ItemAdded"
			default label is "AddItem"
            Local Fields
            	LocalRequisitionView is a Requisition view
                LocalRequisition				is a Requisition
				LocalInventoryCompany			is an InventoryCompany
			Action Rules
				if (HasContractLine)
					constraint (not ContractLine.OnHold)
						"CannotCreateRequisitionLine;Contract<Contract>Line<ContractLine>IsOnHold"
				
				if (actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC not entered)
	            	invoke Create Requisition
    	            	assign result to LocalRequisitionView
	    	            invoked.Company					= actor.agent(Employee).Employee.Requester.Company
	        	        invoked.RequestingLocation		= actor.agent(Employee).Employee.Requester.RequestingLocation
	        	    LocalInventoryCompany = actor.agent(Employee).Employee.Requester.Company
	               	LocalRequisition = LocalRequisitionView.Requisition
					invoke UpdateCurrentRequisitionForRQC RequesterRel
						invoked.PrmCompany				= LocalInventoryCompany
						invoked.PrmRequisition     		= LocalRequisition
	           	else
	        	    LocalInventoryCompany = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
	          		LocalRequisition = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
				
				invoke CreateFromProcurementTemplateLine RequisitionLine
					invoked.PrmProcurementGroup         = ProcurementGroup
					invoked.PrmProcurementTemplate		= ProcurementTemplate
					invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
					invoked.PrmInventoryCompany         = LocalInventoryCompany 
					invoked.PrmRequisition              = LocalRequisition
						
		IncludeInProcurementTemplateLine is an Instance Action
			completion message is "AddedToPurchaseOrderNo<PrmPurchaseOrder>"
			default label is "AddToPurchaseOrder"
			Parameters
				PrmCompany						is a PurchasingCompany
				PrmPurchaseOrder				is a PurchaseOrder	
					default label is "PurchaseOrder"
			Action Rules
				if (Contract entered)
					constraint (Contract.Vendor = PrmPurchaseOrder.Vendor)
						"CannotSelectTemplateLineAssociatedWithAContractForADifferentVendorThanThePurchaseOrderVendor" 
				
				invoke CreateFromTemplateLine PurchaseOrderLine
					invoked.PrmCompany					= PrmCompany
					invoked.PrmProcurementGroup         = ProcurementGroup
					invoked.PrmProcurementTemplate		= ProcurementTemplate
					invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
					invoked.PrmPurchaseOrder			= PrmPurchaseOrder
					invoked.PrmVendor					= PrmPurchaseOrder.Vendor
						
        DeleteOrClearFromContractInstance is an Instance Action
            restricted
            Parameters
                DeleteLines             is Boolean
                ClearLines              is Boolean
           
            Action Rules
               
                LocalFromContract = true
                if (DeleteLines)
                    invoke Delete
                if (ClearLines)
                    Contract = 0
                    ContractLine = 0       

		DeleteOrClearFromContract is a Set Action
			restricted
			Parameters
				ParmProcurementGroup	is a ProcurementGroup
				ParmContract 			is like Contract		
				DeleteLines 			is Boolean
				ClearLines  			is Boolean
			
			Sort Order 
				ProcurementGroup 
				Contract 

			Instance Selection 
				where (ParmProcurementGroup = ProcurementGroup
				and    ParmContract         = Contract)
			
			Action Rules
				
				Instance Rules
				
					LocalFromContract = true
					if (DeleteLines)
						invoke Delete
					if (ClearLines)
						Contract = 0
						ContractLine = 0		
				
		CreatePurchaseOrderRequest is an Instance Action  
			Parameters
				PrmCompany				is an InventoryCompany
					default label is "Company"
				PrmBuyer				is a Buyer
					default label is "Buyer"
				PrmShipToLocation		is an InventoryLocation
					default label is "ShipToLocation"
				PrmPurchaseOrderDate	is Date
					default label is "PurchaseOrderDate"
				PrmDeliveryDate			is Date
					default label is "DeliveryDate"
				PrmVendor				is a Vendor
					default label is "Vendor"
				PrmPurchaseFromLocation is a PurchaseFromLocation
					default label is "FromLocation"
				PrmQuantity				is a Quantity
					default label is "Quantity"
				PrmUOM					is a UnitOfMeasure
					default label is "UOM"
				PrmGlobalLineType		is a GlobalLineType
					default label is "LineType"
				PrmMajorPurchasingClass is a MajorPurchasingClass
					default label is "MajorPurchasingClass"
				PrmMinorPurchasingClass is a MinorPurchasingClass
					default label is "MinorPurchasingclass"
				PrmUnitCost				is a InternationalCost
					default label is "UnitCost"
				PrmProcessLevel			is a PayablesProcessLevel
					default label is "ProcessLevel"
				PrmPOCode				is a POCode
					default label is "POCode" 
			
			Local Fields
				LocalPurchaseOrderInterface is a PurchaseOrderInterface
				
			Parameter Rules
				PrmCompany
					required
					constraint (PrmCompany.BusinessGroup = ProcurementGroup)
						"Company<PrmCompany>InvalidForProcurementGroup<ProcurementGroup>"
				PrmBuyer
					required
				PrmShipToLocation
					required
				PrmPurchaseOrderDate
					required
				PrmDeliveryDate
					required
				PrmVendor
					required
				PrmUOM
					required
					default to UnitOfMeasure
				PrmQuantity
					default to Quantity


						
			Action Rules
				LocalOperatingCompany = PrmCompany
				LocalPurchasingCompany = PrmCompany
				LocalVendor = PrmVendor
				LocalUOM = PrmUOM
				if (PurchaseOrderInterfaceRel exists)
					increment PurchaseOrderInterfaceRel.Quantity by PrmQuantity
				else
					invoke Create PurchaseOrderInterface
						assign result to LocalPurchaseOrderInterface
						fill in fields from this instance
						invoked.ProcurementGroup 							 = ProcurementGroup
						invoked.Company										 = PrmCompany
						invoked.PurchaseOrderInterface.OperatingCompany		 = PrmCompany
						invoked.PurchaseOrderInterface.LineNumber			 = ProcurementTemplateLine
						invoked.Item										 = Item
						invoked.Description									 = Item.Description
						invoked.PurchaseOrderInterface.SourceDocumentOrigin	 = SourceDocumentOrigin.ProcurementTemplates
						invoked.PurchaseOrderInterface.SourceDocumentNumeric = TemplateDocumentNumber
						invoked.Buyer										 = PrmBuyer
						invoked.Vendor										 = PrmVendor
						invoked.PurchaseFromLocation						 = PrmPurchaseFromLocation
						invoked.ShipToLocation								 = PrmShipToLocation
						invoked.RequestedDeliveryDate						 = PrmDeliveryDate
						if (ServiceCode.Quantity or ServiceCode.Amount)
							invoked.ItemType 								 = ItemType.Service
							invoked.Description								 = ServiceDescription
						else
							if (SpecialItem)
								invoked.ItemType							 = ItemType.Special
								invoked.Description							 = SpecialItemDescription

						invoked.Dropship									 = false
						invoked.Quantity									 = PrmQuantity
						invoked.OverrideCost								 = false
						if (VendorItemDefaultRel exists)
							invoked.VendorItem								 = VendorItemDefaultRel.VendorItem
							invoked.Manufacturer							 = VendorItemDefaultRel.Manufacturer
							invoked.ManufacturerNumber						 = VendorItemDefaultRel.ManufacturerNumber
						else
							if (Item exists)
								invoked.Manufacturer						 = Item.Manufacturer
								invoked.ManufacturerNumber					 = Item.ManufacturerNumber
								
						invoked.VendorName									 = PrmVendor.VendorName
						invoked.MajorPurchasingClass						 = PrmMajorPurchasingClass
						invoked.MinorPurchasingClass						 = PrmMinorPurchasingClass
						invoked.EnteredUnitCost								 = PrmUnitCost
						invoked.ProcessLevel								 = PrmProcessLevel
						invoked.POCode										 = PrmPOCode
						invoked.EnteredUOM									 = PrmUOM
						invoked.EnteredUOMMultiplier						 = 1
				
		RecallProcurementTemplateLineQuery is a Set Action
			restricted
			Parameters
				PrmRecallGroup			is a RecallGroup
				PrmRecallNotice			is a RecallNotice
				PrmRecallProduct		is a RecallProduct
				PrmItem					is an Item
				PrmManufacturerNumber	is like ManufacturerNumber
				PrmManufacturerCode		is like ManufacturerCode
				PrmManufacturerDivision is like ManufacturerDivision
				PrmQueryPriority		is Numeric size 2
					States
		   				High				value is 1
		   				Medium				value is 2
		   				Low					value is 3
				PrmQueryDueDate			is TimeStamp
				PrmQueryDocumentUser	is a RecallUser
				PrmInstructions         is a RecallTaskInstruction
				PrmCreateTasks          is Boolean
				
			Sort Order
				ProcurementGroup
    			Item
    			Manufacturer 
				ManufacturerNumber 
				ProcurementTemplate
    			ProcurementTemplateLine
				
			Instance Selection
				where  (ProcurementGroup	= PrmRecallGroup
				and   ((PrmItem entered
				and     Item entered
				and     Item = PrmItem)
				or     (SpecialItem
				and     PrmManufacturerNumber entered 
				and 	ManufacturerNumber entered
				and     ManufacturerNumber = PrmManufacturerNumber
				and    (PrmManufacturerCode !entered
				or     (PrmManufacturerDivision entered
				and     Manufacturer.ManufacturerCode     = PrmManufacturerCode
				and     Manufacturer.ManufacturerDivision = PrmManufacturerDivision)
				or     (PrmManufacturerCode entered
				and     PrmManufacturerDivision !entered
				and     Manufacturer.ManufacturerCode     = PrmManufacturerCode)))))
								
			Action Rules
				Instance Rules
					invoke Create RecallProductTransaction
						invoked.RecallGroup												= PrmRecallGroup
						invoked.RecallNotice											= PrmRecallNotice
						invoked.RecallProduct											= PrmRecallProduct
						invoked.ActivityType											= 2 
						invoked.ProcurementTemplateLineGroup.ProcurementTemplate		= ProcurementTemplate
						invoked.ProcurementTemplateLineGroup.ProcurementTemplateLine	= ProcurementTemplateLine
						invoked.LocalPriority											= PrmQueryPriority
						invoked.LocalDueDate											= PrmQueryDueDate
						invoked.LocalRecallUser											= PrmQueryDocumentUser
						invoked.LocalInstructions                                       = PrmInstructions   
            			invoked.LocalCreateTasks                                        = PrmCreateTasks
            			

		CreateRequisition is an Instance Action
        	restricted
            Local Fields
            	LocalRequisitionView is a Requisition view
                LocalRequisitionLineView is a RequisitionLine view
                LocalUnitCost					is an InternationalCost                                            
                LocalRequisition				is a Requisition
                   
            Parameters
            	PrmCompany             			is an InventoryCompany                        
            	PrmRequestingLocation			is a RequestingLocation
				PrmFromCompany					is like InventoryCompany
				PrmFromLocation					is like InventoryLocation
				PrmRequestedDeliveryDate		is Date
				PrmDeliverTo					is a DeliverTo
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a VendorLocation
				PrmItemVendor					is like Vendor					
				PrmItemPurchaseFromLocation		is like VendorLocation			
				PrmRequisitionDescription		is Alpha size 30
				PrmBuyer						is a Buyer
				PrmCommodityCode				is a CommCodes
				PrmPurchaseTaxCode				is a TaxCode
				PrmPurchaseTaxable				is Boolean
				PrmPOCode						is a POCode
				PrmQuantity                     is a Quantity
				PrmTransactionCurrencyCode		is a Currency
				PrmUOM                          is a UnitOfMeasure
				PrmTransactionUnitCost          is an InternationalCost
				PrmItemType                     is an ItemType
				PrmServiceCode                  is a ServiceCode
				PrmDescription                  is a Description
				PrmVendorItem                   is like VendorItem
				PrmToAccountingEntity			is a AccountingEntity
				PrmGeneralLedgerChartAccount	is a GeneralLedgerChartAccount
				PrmAccountingUnit				is like AccountingUnit
				PrmProject						is a Project
				PrmFinanceDimension1			is a FinanceDimension1
				PrmFinanceDimension2			is a FinanceDimension2
				PrmFinanceDimension3			is a FinanceDimension3
				PrmFinanceDimension4			is a FinanceDimension4
				PrmFinanceDimension5			is a FinanceDimension5
				PrmFinanceDimension6			is a FinanceDimension6
				PrmFinanceDimension7			is a FinanceDimension7
				PrmFinanceDimension8			is a FinanceDimension8
				PrmFinanceDimension9			is a FinanceDimension9
				PrmFinanceDimension10			is a FinanceDimension10
	            PrmSourcingEventRequired		is Boolean		
	            PrmAsset						is an Asset
	            PrmRequisitionSource			is a RqSource
	            PrmAssetTemplate				is an AssetTemplate
	            PrmContract						is a Contract
	            PrmContractLine					is a ContractLine
	            PrmAllocationPriority		    is a AllocationPriority
				PrmCostOption					is a CostOption	            
				PrmMajorPurchasingClass         is a MajorPurchasingClass
				PrmMinorPurchasingClass			is a MinorPurchasingClass
				PrmManufacturer					is AlphaUpper size 9	
				PrmManufacturerNumber			is a ManufacturerNumber
				PrmCreatePurchaseOrder			is Boolean					
				PrmGLEncumbranceReference		is AlphaUpper size 60
				PrmReqAllocationPriority		is like AllocationPriority
				
            Parameter Rules
            	PrmQuantity
                    default to Quantity
                PrmUOM
                    default to UnitOfMeasure
                PrmItemType
                    default to DefaultItemType
                PrmTransactionUnitCost
                    default to DefaultUnitCost
                PrmServiceCode
                    default to ServiceCode
                PrmDescription
                    default to DescriptionDisplay
                PrmVendorItem
                	if (SpecialItem)
                		if (HasContract)
                			default to ContractLine.VendorItem
                		else	
                    		default to Item
                                                             
			Action Rules
            	invoke Create Requisition
                	assign result to LocalRequisitionView
	                invoked.Company					= PrmCompany
	                invoked.RequestingLocation		= PrmRequestingLocation
					invoked.FromCompanyLocation.FromCompany		= PrmFromCompany
					invoked.FromCompanyLocation.FromLocation	= PrmFromLocation
					invoked.RequestedDeliveryDate	= PrmRequestedDeliveryDate
					invoked.DeliverTo				= PrmDeliverTo
					invoked.AllocationPriority		= PrmReqAllocationPriority
					invoked.RequisitionSource		= PrmRequisitionSource
					invoked.Vendor					= PrmVendor
					invoked.PurchaseFromLocation	= PrmPurchaseFromLocation
					invoked.RequisitionDescription	= PrmRequisitionDescription
					invoked.Buyer					= PrmBuyer
					invoked.CommodityCode			= PrmCommodityCode
					invoked.PurchaseTaxCode			= PrmPurchaseTaxCode
					invoked.PurchaseTaxable			= PrmPurchaseTaxable
					invoked.POCode					= PrmPOCode
                           
               	NewRequisition = LocalRequisitionView.Requisition    
               	LocalRequisition = LocalRequisitionView.Requisition

                include CreateRequisitionLineFromTemplate
                
						
                NewRequisitionLine = LocalRequisitionLineView.RequisitionLine
                                      

        AddToRequisition is an Instance Action 
			restricted
            Local Fields
            	LocalRequisitionLineView is a RequisitionLine view
            	LocalUnitCost					is an InternationalCost
                LocalRequisition				is a Requisition
                              
            Parameters
            	PrmCompany              	    is an InventoryCompany
                PrmRequisition      	        is a Requisition
            	PrmQuantity                     is a Quantity
				PrmTransactionCurrencyCode		is a Currency
                PrmUOM                          is a UnitOfMeasure
                PrmTransactionUnitCost          is an InternationalCost
                PrmItemType                     is an ItemType
                PrmServiceCode                  is a ServiceCode
                PrmDescription                  is a Description
                PrmVendorItem                   is like VendorItem
				PrmToAccountingEntity			is a AccountingEntity
				PrmGeneralLedgerChartAccount	is a GeneralLedgerChartAccount
				PrmAccountingUnit				is like AccountingUnit
				PrmProject						is a Project
				PrmFinanceDimension1			is a FinanceDimension1
				PrmFinanceDimension2			is a FinanceDimension2
				PrmFinanceDimension3			is a FinanceDimension3
				PrmFinanceDimension4			is a FinanceDimension4
				PrmFinanceDimension5			is a FinanceDimension5
				PrmFinanceDimension6			is a FinanceDimension6
				PrmFinanceDimension7			is a FinanceDimension7
				PrmFinanceDimension8			is a FinanceDimension8
				PrmFinanceDimension9			is a FinanceDimension9
				PrmFinanceDimension10			is a FinanceDimension10
	            PrmSourcingEventRequired		is Boolean		
	            PrmAsset						is an Asset
	            PrmAssetTemplate				is an AssetTemplate
	            PrmContract						is a Contract
	            PrmContractLine					is a ContractLine
	            PrmAllocationPriority		    is a AllocationPriority
				PrmCostOption					is a CostOption
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a VendorLocation
				PrmItemVendor					is like Vendor						
				PrmItemPurchaseFromLocation		is like VendorLocation				
				PrmMajorPurchasingClass         is a MajorPurchasingClass
				PrmMinorPurchasingClass			is a MinorPurchasingClass
				PrmCommodityCode				is a CommCodes
				PrmFromCompany					is like InventoryCompany
				PrmFromLocation					is like InventoryLocation
				PrmManufacturer					is AlphaUpper size 9	
				PrmManufacturerNumber			is a ManufacturerNumber
				PrmCreatePurchaseOrder			is Boolean							
				PrmGLEncumbranceReference		is AlphaUpper size 60
				
            Parameter Rules


                PrmUOM
                    default to UnitOfMeasure
                PrmItemType
                    default to DefaultItemType


                PrmServiceCode
                    default to ServiceCode
                PrmDescription
                    default to DescriptionDisplay
                PrmVendorItem
                	if (SpecialItem)
                		if (HasContract)
                			default to ContractLine.VendorItem
                		else	
                    		default to Item

          	Action Rules
          		LocalRequisition = PrmRequisition
          		include CreateRequisitionLineFromTemplate
						
                NewRequisition = PrmRequisition
                NewRequisitionLine = LocalRequisitionLineView.RequisitionLine
                
        RSSLPLAddRequisition is an Instance Action 
			default label is "_"
			completion message is "<LocalCompletionMessage>"
            Local Fields
            	LocalRequisitionView 			is a Requisition view
                LocalUnitCost					is an InternationalCost                                            
				LocalQuantity					is a Quantity
					precision is NumberOfDecimalsQuantity
						round to precision
                LocalRequisition				is a Requisition
            Parameters
            	PrmCompany             			is an InventoryCompany                        
            	PrmRequestingLocation			is a RequestingLocation
				PrmDate							is Date
				PrmDeliverTo					is a DeliverTo
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a VendorLocation
				PrmItemVendor					is like Vendor					
				PrmItemPurchaseFromLocation		is like VendorLocation
				PrmRequisition                  is a Requisition			
				PrmRequisitionDescription		is Alpha size 30
				PrmBuyer						is a Buyer
				PrmCommodityCode				is a CommCodes
				PrmPurchaseTaxCode				is a TaxCode
				PrmPurchaseTaxable				is Boolean
				PrmPOCode						is a POCode
				PrmQuantity						is an UnsignedQuantity
					precision is NumberOfDecimalsQuantity
				PrmTransactionCurrencyCode		is a Currency
				PrmEnteredUOM                   is a UnitOfMeasure
				PrmTransactionUnitCost          is an UnsignedUnitCost
					precision is NumberOfDecimalsCost
				PrmItemType                     is an ItemType
				PrmServiceCode                  is a ServiceCode
				PrmDescription                  is a Description
				PrmVendorItem                   is like VendorItem
				PrmToAccountingEntity			is a AccountingEntity
				PrmGeneralLedgerChartAccount	is a GeneralLedgerChartAccount
				PrmAccountingUnit				is like AccountingUnit
				PrmProject						is a Project
				PrmFinanceDimension1			is a FinanceDimension1
				PrmFinanceDimension2			is a FinanceDimension2
				PrmFinanceDimension3			is a FinanceDimension3
				PrmFinanceDimension4			is a FinanceDimension4
				PrmFinanceDimension5			is a FinanceDimension5
				PrmFinanceDimension6			is a FinanceDimension6
				PrmFinanceDimension7			is a FinanceDimension7
				PrmFinanceDimension8			is a FinanceDimension8
				PrmFinanceDimension9			is a FinanceDimension9
				PrmFinanceDimension10			is a FinanceDimension10
	            PrmSourcingEventRequired		is Boolean		
	            PrmAsset						is an Asset
	            PrmRequisitionSource			is a RqSource
	            PrmAssetTemplate				is an AssetTemplate
	            PrmContract						is a Contract
	            PrmContractLine					is a ContractLine
	            PrmAllocationPriority		    is a AllocationPriority
				PrmCostOption					is a CostOption	            
				PrmMajorPurchasingClass         is a MajorPurchasingClass
				PrmMinorPurchasingClass			is a MinorPurchasingClass
				PrmManufacturer					is AlphaUpper size 9	
				PrmManufacturerNumber			is a ManufacturerNumber
				PrmCreatePurchaseOrder			is Boolean					
				PrmGLEncumbranceReference		is AlphaUpper size 60
				PrmAddToRequisition				is Numeric size 1
					States
						AddToExistingRequisition	value is 0
						StartNewRequisition			value is 1
				PrmFromCompanyLocation 			is a FromCompanyLocation				
				PrmRSSSourceInformation			is Numeric size 1
					States
            			NotApplicable         	value is 0
            			SearchCatalog    		value is 1
						RecentlyRequestedItem   value is 2
            			ShoppingList    		value is 3
						Punchout				value is 4
						SpecialAndService		value is 5
						CopyRequisitionLine 	value is 6				
				PrmAllocationPriorityLevel		is an AllocationPriorityLevel
			Parameter Rules
				PrmCompany
				    default to actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
				    initial value is actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
				    default to actor.agent(Employee).Employee.Requester.Company
				    initial value is actor.agent(Employee).Employee.Requester.Company
				PrmRequestingLocation
            		default to PrmRequisition.RequestingLocation
            		initial value is PrmRequisition.RequestingLocation
            		default to actor.agent(Employee).Employee.Requester.RequestingLocation
            		initial value is actor.agent(Employee).Employee.Requester.RequestingLocation					
				PrmRequisition
					if (PrmAddToRequisition.AddToExistingRequisition)
						required
							"FieldIsRequired"
						constraint(PrmRequisition.UpdateAllowed)
							"RequisitionMustBeUnreleased"
					else
						PrmRequisition = 0
				PrmQuantity
					required
						"QuantityIsRequired"
				PrmEnteredUOM
					default to DerivedUOM
					initial value is DerivedUOM
				PrmTransactionUnitCost
					initial value is DefaultUnitCost
					default to DefaultUnitCost
				PrmItemType
                    default to DefaultItemType
				PrmServiceCode
                    default to ServiceCode
                PrmDescription
                    default to DescriptionDisplay
                PrmVendorItem
                	if (SpecialItem)
                		if (HasContract)
                			default to ContractLine.VendorItem
                		else	
                    		default to Item						
				PrmAllocationPriority							
					if (RSSLPLConfigurationParameterRel exists)
						default to PrmAllocationPriorityLevel
						default to RSSLPLAllocationPriorityLevelRel.AllocationPriorityLevel
				PrmDate
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireRequestedDeliveryDate)
						required
							"Field_Requested_Delivery_DateIsRequired"
				PrmRequisitionDescription
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireRequisitionDescription)
						required
							"Field_Requisition_DescriptionIsRequired"
				PrmCostOption
					default to CostOption
					initial value is CostOption
				PrmBuyer
					initial value is PrmRequestingLocation.Buyer

					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireBuyer)
						required
							"Field_BuyerIsRequired"
				PrmPOCode
					initial value is PrmRequestingLocation.POCode

					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequirePOCode)
						required
							"Field_PO_CodeIsRequired"
				PrmCommodityCode
					initial value is Item.CommodityCode
					
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireCommodityCodeDisplay)
						required
							"Field_Commodity_CodeIsRequired"
				PrmDeliverTo
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireDeliverTo)
						required
							"Field_Deliver_ToIsRequired"
				
	            PrmVendor
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireVendor)
						required
							"Field_VendorIsRequired"

			Action Rules
			




				if (PrmRequisition not entered)
	            	invoke Create Requisition
    	            	assign result to LocalRequisitionView
	    	            invoked.Company					= PrmCompany
	        	        invoked.RequestingLocation		= PrmRequestingLocation
						invoked.AllocationPriority				 	= PrmAllocationPriority
						if (RSSLPLConfigurationParameterRel exists)
							invoked.TransientAllocationPriorityLevel 	= PrmAllocationPriority
						invoked.RequestedDeliveryDate	= PrmDate
						invoked.RequisitionDescription	= PrmRequisitionDescription
						if (PrmFromCompanyLocation entered)
							invoked.FromCompanyLocation				= PrmFromCompanyLocation
						invoked.DeliverTo				= PrmDeliverTo
						invoked.RequisitionSource		= RqSource.RequisitionSelfService
						invoked.Vendor					= PrmVendor
						invoked.PurchaseFromLocation	= PrmPurchaseFromLocation
						invoked.RequisitionDescription	= PrmRequisitionDescription
						invoked.Buyer					= PrmBuyer
						invoked.CommodityCode			= PrmCommodityCode
						invoked.PurchaseTaxCode			= PrmPurchaseTaxCode
						invoked.PurchaseTaxable			= PrmPurchaseTaxable
						invoked.POCode					= PrmPOCode
	               	LocalRequisition = LocalRequisitionView.Requisition
	           	else
	          		LocalRequisition = PrmRequisition

				LocalCompanyForQuantityAdd = PrmCompany
				LocalCostUOMForQuantityAdd = PrmEnteredUOM
				LocalRequisitionForQuantityAdd = LocalRequisition
				LocalUnitCostForQuantityAdd = PrmTransactionUnitCost
				if (DefaultUnitCost = LocalUnitCostForQuantityAdd
				and !ContractRel.UseContractUOM
				and (DefaultItemType.Inventoried or DefaultItemType.NonStock)
				and  LocalCostUOMForQuantityAdd != DerivedUOM)
					TransientCostUOM = PrmEnteredUOM
					LocalUnitCostForQuantityAdd = LocalUnitCostForQuantityAdd * (ItemTransientCostUOMRel.UOMConversion / ItemUOMRel.UOMConversion)

				LocalCompletionMessage = ItemAddedMessage






				if (RequisitionLineItemRel exists
				and RequesterRel.ValidateDuplicateItem
				and !IsServiceItemByAmount)
					LocalCompletionMessage = ItemUpdatedMessage
					invoke RSSLPLUpdateRequisitionLineQTY RequisitionLineItemMatchRel
						invoked.PrmQuantity							= RequisitionLineItemMatchRel.Quantity + DerivedQuantity
						invoked.PrmUOM								= RequisitionLineItemMatchRel.EnteredUOM
				else
					LocalCostUOMForQuantityAdd = DerivedUOM
					if  (RequisitionLineItemRel exists
					and  ContractRel.UseContractUOM
					and (DefaultItemType.Inventoried or DefaultItemType.NonStock)
					and RequesterRel.ValidateDuplicateItem
					and !IsServiceItemByAmount)
						LocalCompletionMessage = SelectedItemsUpdatedMessage
						TransientCostUOM = PrmEnteredUOM
						LocalQuantity = TransientEnteredQuantity * (ItemTransientCostUOMRel.UOMConversion / ItemUOMRel.UOMConversion)
						invoke RSSLPLUpdateRequisitionLineQTY RequisitionLineItemMatchRel
							invoked.PrmQuantity							= RequisitionLineItemMatchRel.Quantity + LocalQuantity
							invoked.PrmUOM								= RequisitionLineItemMatchRel.EnteredUOM
					else
						invoke CreateFromProcurementTemplateLineForRSS RequisitionLine
							invoked.PrmInventoryCompany         = PrmCompany
							invoked.PrmProcurementTemplate		= ProcurementTemplate
							invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
							invoked.PrmRequisition              = LocalRequisition
							invoked.PrmQuantity                 = PrmQuantity
							invoked.PrmTransactionCurrencyCode	= PrmTransactionCurrencyCode
							invoked.PrmEnteredUOM               = PrmEnteredUOM
							invoked.PrmServiceCode          	= PrmServiceCode
							invoked.PrmDescription         	    = PrmDescription
							invoked.PrmVendorItem               = PrmVendorItem
							invoked.PrmToAccountingEntity		= PrmToAccountingEntity
							invoked.PrmGeneralLedgerChartAccount	= PrmGeneralLedgerChartAccount
							invoked.PrmAccountingUnit			= PrmAccountingUnit
							invoked.PrmProject					= PrmProject
							invoked.PrmFinanceDimension1		= PrmFinanceDimension1
							invoked.PrmFinanceDimension2		= PrmFinanceDimension2
							invoked.PrmFinanceDimension3		= PrmFinanceDimension3
							invoked.PrmFinanceDimension4		= PrmFinanceDimension4
							invoked.PrmFinanceDimension5		= PrmFinanceDimension5
							invoked.PrmFinanceDimension6		= PrmFinanceDimension6
							invoked.PrmFinanceDimension7		= PrmFinanceDimension7
							invoked.PrmFinanceDimension8		= PrmFinanceDimension8
							invoked.PrmFinanceDimension9		= PrmFinanceDimension9
							invoked.PrmFinanceDimension10		= PrmFinanceDimension10
							invoked.PrmSourcingEventRequired	= PrmSourcingEventRequired
							invoked.PrmAsset					= PrmAsset
							invoked.PrmAssetTemplate			= PrmAssetTemplate
							invoked.PrmAllocationPriority		= PrmAllocationPriority
							invoked.PrmDate						= PrmDate	
							invoked.PrmMajorPurchasingClass		= PrmMajorPurchasingClass
							invoked.PrmMinorPurchasingClass     = PrmMinorPurchasingClass
							invoked.PrmCommodityCode			= PrmCommodityCode
							invoked.PrmManufacturer				= PrmManufacturer
							invoked.PrmManufacturerNumber		= PrmManufacturerNumber
							invoked.PrmCreatePurchaseOrder		= PrmCreatePurchaseOrder			
							invoked.PrmGLEncumbranceReference	= PrmGLEncumbranceReference
							invoked.PrmRSSSourceInformation		= PrmRSSSourceInformation.ShoppingList
							invoked.PrmQuantity					= PrmQuantity
							LocalUnitCost						= DefaultUnitCost
							round LocalUnitCost to nearest DerivedRoundTo
							if (PrmItemVendor entered)
								invoked.PrmVendor 					= PrmItemVendor						
								invoked.PrmPurchaseFromLocation	    = PrmItemPurchaseFromLocation
							else
							if (not DefaultItemType.Inventoried
							or (LocalCreatePurchaseOrder
							and DefaultItemType.Inventoried))
								invoked.PrmVendor 					= LocalVendor						
								invoked.PrmPurchaseFromLocation	    = LocalPurchaseFromLocation
							if ((PrmTransactionUnitCost entered and PrmTransactionUnitCost not = LocalUnitCost)
							or ((DefaultItemType.Special and Contract.UOMSMustMatchForSpecials)
							and ContractLine.UOM not = PrmEnteredUOM))
								invoked.PrmTransactionUnitCost 	= PrmTransactionUnitCost
							invoked.PrmEnteredUOM				= PrmEnteredUOM
								if (not ContractLine.OnHold
								and current corporate date >= ContractLine.EffectiveDate
								and (current corporate date <= ContractLine.ExpirationDate
								or   ContractLine.ExpirationDate not entered))
									invoked.PrmContract				= Contract
									invoked.PrmContractLine			= ContractLine
								invoked.PrmServiceCode          	= ServiceCode
								invoked.PrmDescription         	    = DescriptionDisplay
							if (DefaultItemType.Service or (HasContract and ContractLine.UOM = PrmEnteredUOM))
								if (not ContractLine.OnHold
								and current corporate date >= ContractLine.EffectiveDate
								and (current corporate date <= ContractLine.ExpirationDate
								or   ContractLine.ExpirationDate not entered))
									invoked.PrmContract			= Contract
									invoked.PrmContractLine		= ContractLine
									invoked.PrmTransactionUnitCost	= PrmTransactionUnitCost

			Exit Rules
				invoke UpdateCurrentRequisitionForRQC RequesterRel
						invoked.PrmCompany				= PrmCompany
						invoked.PrmRequisition     		= LocalRequisition

		RSSLPLAutoAddToRequisition is an Update Action 
			completion message is "<LocalCompletionMessage>"
			bypass field rules
			Action Rules
				if (actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC not entered)
					TransientAddToRequisition = TransientAddToRequisition.StartNewRequisition
				invoke RSSLPLAddSelectedToRequisition

		RSSLPLAddToRequisition is an Instance Action 
			default label is "_"
			completion message is "<LocalCompletionMessage>"
			Local Fields
				LocalUnitCost					is an InternationalCost
			Action Rules
				LocalCompletionMessage = ItemAddedMessage
				LocalCompanyForQuantityAdd = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
				LocalCostUOMForQuantityAdd = DerivedUOM
				LocalRequisitionForQuantityAdd = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
				LocalUnitCostForQuantityAdd = DefaultUnitCost






				if (RequisitionLineItemRel exists
				and RequesterRel.ValidateDuplicateItem
				and !IsServiceItemByAmount)
					LocalCompletionMessage = ItemUpdatedMessage
					invoke RSSLPLUpdateRequisitionLineQTY RequisitionLineItemMatchRel
						invoked.PrmQuantity							= RequisitionLineItemMatchRel.Quantity + DerivedQuantity
						invoked.PrmUOM								= RequisitionLineItemMatchRel.EnteredUOM
				else
					invoke CreateFromProcurementTemplateLineForRSS RequisitionLine
						invoked.PrmProcurementTemplate		= ProcurementTemplate
						invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
						invoked.PrmInventoryCompany         = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
						invoked.PrmRequisition              = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
						invoked.PrmQuantity					= DerivedQuantity
						LocalUnitCost						= DefaultUnitCost
						invoked.PrmEnteredUOM				= DerivedUOM
						if (not ContractLine.OnHold
							and current corporate date >= ContractLine.EffectiveDate
							and (current corporate date <= ContractLine.ExpirationDate
							or   ContractLine.ExpirationDate not entered))
							invoked.PrmContract					= Contract
							invoked.PrmContractLine				= ContractLine
						invoked.PrmServiceCode          	= ServiceCode
						invoked.PrmDescription         	    = DescriptionDisplay
						if (not DefaultItemType.Inventoried
						or (LocalCreatePurchaseOrder
						and DefaultItemType.Inventoried))
							invoked.PrmVendor					= LocalVendor
							invoked.PrmPurchaseFromLocation		= LocalPurchaseFromLocation
					
		RSSLPLAddSelectedToNewRequisition is an Instance Action 
			completion message is "SelectedItemsAdded_toRequisition"
            Local Fields
            	LocalRequisitionView 			is a Requisition view
            	LocalRequisitionLineView is a RequisitionLine view
				LocalUnitCost					is an InternationalCost  
                LocalRequisition				is a Requisition
			Parameters
				PrmCompany             			is an InventoryCompany                        
            	PrmRequestingLocation			is a RequestingLocation
				PrmDate							is Date
				PrmDeliverTo					is a DeliverTo
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a VendorLocation
				PrmRequisition                  is a Requisition			
				PrmRequisitionDescription		is Alpha size 30
				PrmBuyer						is a Buyer
				PrmCommodityCode				is a CommCodes
				PrmPurchaseTaxCode				is a TaxCode
				PrmPurchaseTaxable				is Boolean
				PrmPOCode						is a POCode
	            PrmRequisitionSource			is a RqSource
	            PrmAllocationPriority		    is a AllocationPriority
				PrmAddToRequisition				is Numeric size 1
					States
						AddToExistingRequisition	value is 0
						StartNewRequisition			value is 1
				PrmFromCompanyLocation 			is a FromCompanyLocation
				PrmQuantityMultiplier			is an UnsignedQuantity		
				PrmRSSSourceInformation			is Numeric size 1
					States
            			NotApplicable         	value is 0
            			SearchCatalog    		value is 1
						RecentlyRequestedItem   value is 2
            			ShoppingList    		value is 3
						Punchout				value is 4
						SpecialAndService		value is 5		
						CopyRequisitionLine 	value is 6	
				PrmAllocationPriorityLevel		is a AllocationPriorityLevel
			Parameter Rules
				PrmCompany
				    default to actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
				    initial value is actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
				    default to actor.agent(Employee).Employee.Requester.Company
				    initial value is actor.agent(Employee).Employee.Requester.Company
				PrmRequestingLocation
            		default to PrmRequisition.RequestingLocation
            		initial value is PrmRequisition.RequestingLocation
            		default to actor.agent(Employee).Employee.Requester.RequestingLocation
            		initial value is actor.agent(Employee).Employee.Requester.RequestingLocation					
				PrmRequisition
					if (PrmAddToRequisition.AddToExistingRequisition)
						required
							"FieldIsRequired"
						constraint(PrmRequisition.UpdateAllowed)
							"RequisitionMustBeUnreleased"
				PrmQuantityMultiplier
					if (actor.agent(Employee).Employee.Requester.QuantityMultiplierOnShoppingListAllowed)
						required
							"FieldIsRequired"
				PrmAllocationPriority							
					if (RSSLPLConfigurationParameterRel exists)
						default to PrmAllocationPriorityLevel
						default to RSSLPLAllocationPriorityLevelRel.AllocationPriorityLevel
				PrmDate
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireRequestedDeliveryDate)
						required
							"Field_Requested_Delivery_DateIsRequired"
				PrmRequisitionDescription
					if (PrmAddToRequisition.StartNewRequisition
					and RequesterRel.RequireRequisitionDescription)
						required
							"Field_Requisition_DescriptionIsRequired"
			Action Rules
				if (PrmAddToRequisition.StartNewRequisition)
					if (PrmRequisition = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC)
		            	invoke Create Requisition
	    	            	assign result to LocalRequisitionView
		    	            invoked.Company					= PrmCompany
		        	        invoked.RequestingLocation		= PrmRequestingLocation
							invoked.AllocationPriority				 	= PrmAllocationPriority
							if (RSSLPLConfigurationParameterRel exists)
								invoked.TransientAllocationPriorityLevel 	= PrmAllocationPriority
							invoked.RequestedDeliveryDate	= PrmDate
							invoked.RequisitionDescription	= PrmRequisitionDescription
							if (PrmFromCompanyLocation entered)
								invoked.FromCompanyLocation				= PrmFromCompanyLocation
							invoked.DeliverTo				= PrmDeliverTo
							invoked.RequisitionSource		= RqSource.RequisitionSelfService
							invoked.Vendor					= PrmVendor
							invoked.PurchaseFromLocation	= PrmPurchaseFromLocation
							invoked.RequisitionDescription	= PrmRequisitionDescription
							invoked.Buyer					= PrmBuyer
							invoked.CommodityCode			= PrmCommodityCode
							invoked.PurchaseTaxCode			= PrmPurchaseTaxCode
							invoked.PurchaseTaxable			= PrmPurchaseTaxable
							invoked.POCode					= PrmPOCode
		               	LocalRequisition = LocalRequisitionView.Requisition
		               	PrmRequisition   = LocalRequisitionView.Requisition
		               	NewRequisition	 = LocalRequisitionView.Requisition
					else
						LocalRequisition = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
	           	else
	          		LocalRequisition = PrmRequisition
				LocalCompanyForQuantityAdd = PrmCompany
				LocalCostUOMForQuantityAdd = DerivedUOM
				LocalRequisitionForQuantityAdd = LocalRequisition
				LocalCompletionMessage = SelectedItemsAddedMessage






				if (RequisitionLineItemRel exists
				and RequesterRel.ValidateDuplicateItem
				and !IsServiceItemByAmount)
					LocalCompletionMessage = SelectedItemsUpdatedMessage
					invoke RSSLPLUpdateRequisitionLineQTY RequisitionLineItemMatchRel
						invoked.PrmQuantity							= RequisitionLineItemMatchRel.Quantity + DerivedQuantity
						invoked.PrmUOM								= RequisitionLineItemMatchRel.EnteredUOM
				else
					invoke CreateFromProcurementTemplateLineForRSS RequisitionLine
						invoked.PrmInventoryCompany         = PrmCompany
						invoked.PrmProcurementTemplate		= ProcurementTemplate
						invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
						invoked.PrmRequisition              = LocalRequisition
						LocalUnitCost						= DefaultUnitCost
						invoked.PrmQuantity                 = Quantity
						invoked.PrmEnteredUOM				= DerivedUOM
						invoked.PrmServiceCode          	= ServiceCode
						invoked.PrmDescription         	    = DescriptionDisplay
						if (not ContractLine.OnHold
							and current corporate date >= ContractLine.EffectiveDate
							and (current corporate date <= ContractLine.ExpirationDate
							or   ContractLine.ExpirationDate not entered))
							invoked.PrmContract				= Contract
							invoked.PrmContractLine			= ContractLine
						invoked.PrmQuantityMultiplier		= PrmQuantityMultiplier
						invoked.PrmRSSSourceInformation		= PrmRSSSourceInformation.ShoppingList
			Exit Rules
				invoke UpdateCurrentRequisitionForRQC RequesterRel
						invoked.PrmCompany				= PrmCompany
						invoked.PrmRequisition     		= LocalRequisition

		RSSLPLAddSelectedToRequisition is an Update Action 
			completion message is "<LocalCompletionMessage>"
			Local Fields
				LocalUnitCost					is an InternationalCost
				LocalQuantity					is a Quantity
					precision is NumberOfDecimalsQuantity
						round to precision
            	LocalRequisitionView 			is a Requisition view
				LocalRequisitionSource		    is a RqSource

			Field Rules	
				TransientPOCode
					if (TransientAddToRequisition.StartNewRequisition
					and RequesterRel.RequirePOCode)
						required
							"Field_PO_CodeIsRequired"
				
				TransientCommodityCode
					if (TransientAddToRequisition.StartNewRequisition
					and RequesterRel.RequireCommodityCodeDisplay)
						required
							"Field_Commodity_CodeIsRequired"
				
				TransientDeliverTo
					if (TransientAddToRequisition.StartNewRequisition
					and RequesterRel.RequireDeliverTo)
						required
							"Field_Deliver_ToIsRequired"
				
	            TransientRequisitionDescription
					if (TransientAddToRequisition.StartNewRequisition
					and RequesterRel.RequireRequisitionDescription)
						required
							"Field_Requisition_DescriptionIsRequired"
				
	            TransientRequestedDeliveryDate
					if (TransientAddToRequisition.StartNewRequisition
					and RequesterRel.RequireRequestedDeliveryDate)
						required
							"Field_Requested_Delivery_DateIsRequired"

			Entrance Rules
				if (TransientAddToRequisition.AddToExistingRequisition
				and actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC not entered)
					constraint(TransientRequisition.Requisition entered)
						"RequisitionRequired"

				constraint(TransientEnteredQuantity entered)
					"QuantityIsRequired"

				constraint(TransientCostUOM entered)
					"UnitOfMeasureIsRequired"					

				if (TransientItemType.ItemMasterItem)
					constraint(ItemTransientCostUOMRel exists)
						"<TransientCostUOM>IsNotAValidUnitOfMeasureForItem"
				else
					constraint(TransientCostUOM exists)
						"<TransientCostUOM>IsNotAValidUnitOfMeasureForItem"
				
				if (TransientAddToRequisition.StartNewRequisition)
					TransientBuyer.InputRequireBuyer = RequesterRel.RequireBuyer
				
				if (TransientAddToRequisition.StartNewRequisition)
					TransientVendor.InputRequireVendor = RequesterRel.RequireVendor
	
			Action Rules
				if (actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC entered
				and TransientRequisition.Requisition not entered)
					TransientRequisition.InventoryCompany = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
					TransientRequisition.Requisition = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
					TransientRequisition.RequestingLocation = RequisitionRel.RequestingLocation

				if (TransientAddToRequisition.StartNewRequisition)
					if (actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC not entered)
		            	invoke Create Requisition
	    	            	assign result to LocalRequisitionView
		    	            invoked.Company					= TransientRequisition.InventoryCompany
		        	        invoked.RequestingLocation		= TransientRequisition.RequestingLocation
							if (TransientFromCompanyLocation entered)
								invoked.FromCompanyLocation	= TransientFromCompanyLocation
							invoked.RequestedDeliveryDate	= TransientRequestedDeliveryDate
							if (RSSLPLAllocationPriorityLevelEnabled)
			        	        invoked.AllocationPriority	= TransientAllocationPriorityLevel.AllocationPriorityLevel
							else
			        	        invoked.AllocationPriority	= TransientAllocationPriority
							invoked.RequisitionDescription	= TransientRequisitionDescription
							invoked.RequisitionSource		= LocalRequisitionSource.RequisitionSelfService
							invoked.DeliverTo				= TransientDeliverTo
							invoked.CommodityCode			= TransientCommodityCode
							invoked.POCode					= TransientPOCode
							invoked.Buyer					= TransientBuyer.Buyer
							invoked.Vendor					= TransientVendor.Vendor
		               	TransientRequisition.Requisition 	= LocalRequisitionView.Requisition
						invoke UpdateCurrentRequisitionForRQC RequesterRel
							invoked.PrmCompany				= TransientRequisition.InventoryCompany
							invoked.PrmRequisition     		= LocalRequisitionView.Requisition			
	           	else
				if (TransientRequisition entered
				and TransientRequisition != actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC)
					invoke UpdateCurrentRequisitionForRQC RequesterRel
						invoked.PrmCompany				= TransientRequisition.InventoryCompany
						invoked.PrmRequisition     		= TransientRequisition.Requisition			

				if (DefaultUnitCost = TransientDefaultUnitCost
				and !ContractRel.UseContractUOM
				and (DefaultItemType.Inventoried or DefaultItemType.NonStock)
				and TransientCostUOM != DerivedUOM)
					TransientDefaultUnitCost = TransientDefaultUnitCost * (ItemTransientCostUOMRel.UOMConversion / ItemUOMRel.UOMConversion)
					
				LocalCompanyForQuantityAdd 	   = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
				LocalRequisitionForQuantityAdd = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
				LocalCostUOMForQuantityAdd = DerivedUOM
				LocalUnitCostForQuantityAdd = TransientDefaultUnitCost
				LocalCompletionMessage = SelectedItemsAddedMessage
				if (RequisitionLineItemUpdateRel exists
				and RequesterRel.ValidateDuplicateItem
				and !IsServiceItemByAmount)



						LocalCompletionMessage = SelectedItemsUpdatedMessage
						if (TransientQuantityMultiplier > 1
						and !ProcurementTemplateLine.ServiceCode.Amount)
							LocalQuantity = TransientEnteredQuantity * TransientQuantityMultiplier
						else
							LocalQuantity = TransientEnteredQuantity
						invoke RSSLPLUpdateRequisitionLineQTY RequisitionLineItemMatchUpdateRel
							invoked.PrmQuantity							= RequisitionLineItemMatchUpdateRel.Quantity + LocalQuantity
							invoked.PrmUOM								= RequisitionLineItemMatchUpdateRel.EnteredUOM
				else
				if  (RequisitionLineItemRel exists
				and  ContractRel.UseContractUOM
				and (DefaultItemType.Inventoried or DefaultItemType.NonStock)
				and RequesterRel.ValidateDuplicateItem
				and !IsServiceItemByAmount)
					LocalCompletionMessage = SelectedItemsUpdatedMessage
					LocalQuantity = TransientEnteredQuantity * (ItemTransientCostUOMRel.UOMConversion / ItemUOMRel.UOMConversion)
					invoke RSSLPLUpdateRequisitionLineQTY RequisitionLineItemMatchRel
						invoked.PrmQuantity							= RequisitionLineItemMatchRel.Quantity + LocalQuantity
						invoked.PrmUOM								= RequisitionLineItemMatchRel.EnteredUOM
				else
					invoke CreateFromProcurementTemplateLineForRSS RequisitionLine
						invoked.PrmProcurementTemplate		= ProcurementTemplate
						invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
						invoked.PrmInventoryCompany         = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
						invoked.PrmRequisition              = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
						invoked.PrmQuantity					= TransientEnteredQuantity
						LocalUnitCost						= DefaultUnitCost
						round LocalUnitCost to nearest DerivedRoundTo
						if ((TransientDefaultUnitCost entered and TransientDefaultUnitCost not = LocalUnitCost)
						or ((DefaultItemType.Special and Contract.UOMSMustMatchForSpecials)
						and ContractLine.UOM not = TransientCostUOM))
							invoked.PrmTransactionUnitCost 	= TransientDefaultUnitCost
						invoked.PrmEnteredUOM				= TransientCostUOM
							if (not ContractLine.OnHold
							and current corporate date >= ContractLine.EffectiveDate
							and (current corporate date <= ContractLine.ExpirationDate
							or   ContractLine.ExpirationDate not entered))
								invoked.PrmContract				= Contract
								invoked.PrmContractLine			= ContractLine
							invoked.PrmServiceCode          	= ServiceCode
							invoked.PrmDescription         	    = DescriptionDisplay
						invoked.PrmQuantityMultiplier			= TransientQuantityMultiplier
						if (not DefaultItemType.Inventoried
						or (LocalCreatePurchaseOrder
						and DefaultItemType.Inventoried))
							invoked.PrmVendor						= LocalVendor
							invoked.PrmPurchaseFromLocation			= LocalPurchaseFromLocation

		RSSLPLAddSelectedToQuantityMultiplier is an Update Action
			completion message is "<LocalCompletionMessage>"
			bypass field rules
			Local Fields
				LocalUnitCost					is an InternationalCost
				LocalQuantity					is a Quantity
					precision is NumberOfDecimalsQuantity
						round to precision
			Entrance Rules
				constraint(TransientEnteredQuantity entered)
					"QuantityIsRequired"

				constraint(TransientCostUOM entered)
					"UnitOfMeasureIsRequired"					

				if (TransientItemType.ItemMasterItem)
					constraint(ItemTransientCostUOMRel exists)
						"<TransientCostUOM>IsNotAValidUnitOfMeasureForItem"
				else
					constraint(TransientCostUOM exists)
						"<TransientCostUOM>IsNotAValidUnitOfMeasureForItem"
			Action Rules
				if (TransientQuantityMultiplier not entered)
					TransientQuantityMultiplier = 1

				if (DefaultUnitCost = TransientDefaultUnitCost
				and !ContractRel.UseContractUOM
				and (DefaultItemType.Inventoried or DefaultItemType.NonStock)
				and TransientCostUOM != DerivedUOM)
					TransientDefaultUnitCost = TransientDefaultUnitCost * (ItemTransientCostUOMRel.UOMConversion / ItemUOMRel.UOMConversion)
					
				LocalCompanyForQuantityAdd 	   = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
				LocalRequisitionForQuantityAdd = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
				LocalCostUOMForQuantityAdd = DerivedUOM
				LocalCompletionMessage = SelectedItemsAddedMessage
				if (RequisitionLineItemUpdateRel exists
				and RequesterRel.ValidateDuplicateItem
				and !IsServiceItemByAmount)



					LocalCompletionMessage = SelectedItemsUpdatedMessage
					invoke RSSLPLUpdateRequisitionLineQTY RequisitionLineItemMatchUpdateRel
						if (TransientQuantityMultiplier > 1
						and !ProcurementTemplateLine.ServiceCode.Amount)
							LocalQuantity                 = TransientEnteredQuantity * TransientQuantityMultiplier
						else
							LocalQuantity                 = TransientEnteredQuantity

						invoked.PrmQuantity							= RequisitionLineItemMatchUpdateRel.Quantity + LocalQuantity
						invoked.PrmUOM								= RequisitionLineItemMatchUpdateRel.EnteredUOM
				else	
				if  (RequisitionLineItemRel exists
				and  ContractRel.UseContractUOM
				and (DefaultItemType.Inventoried or DefaultItemType.NonStock)
				and RequesterRel.ValidateDuplicateItem
				and !IsServiceItemByAmount)
					LocalCompletionMessage = SelectedItemsUpdatedMessage
					LocalQuantity = TransientEnteredQuantity * (ItemTransientCostUOMRel.UOMConversion / ItemUOMRel.UOMConversion) * TransientQuantityMultiplier
					invoke RSSLPLUpdateRequisitionLineQTY RequisitionLineItemMatchRel
						invoked.PrmQuantity							= RequisitionLineItemMatchRel.Quantity + LocalQuantity
						invoked.PrmUOM								= RequisitionLineItemMatchRel.EnteredUOM
				else
					invoke CreateFromProcurementTemplateLineForRSS RequisitionLine
						invoked.PrmProcurementTemplate		= ProcurementTemplate
						invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
						invoked.PrmInventoryCompany         = actor.agent(Employee).Employee.Requester.CurrentCompanyForRQC
						invoked.PrmRequisition              = actor.agent(Employee).Employee.Requester.CurrentRequisitionForRQC
						invoked.PrmQuantity					= TransientEnteredQuantity
						LocalUnitCost						= DefaultUnitCost
						round LocalUnitCost to nearest DerivedRoundTo
						if ((TransientDefaultUnitCost entered and TransientDefaultUnitCost not = LocalUnitCost)
						or ((DefaultItemType.Special and Contract.UOMSMustMatchForSpecials)
						and ContractLine.UOM not = TransientCostUOM))
							invoked.PrmTransactionUnitCost 	= TransientDefaultUnitCost
						invoked.PrmEnteredUOM				= TransientCostUOM
						if (not ContractLine.OnHold
							and current corporate date >= ContractLine.EffectiveDate
							and (current corporate date <= ContractLine.ExpirationDate
							or   ContractLine.ExpirationDate not entered))
							invoked.PrmContract					= Contract
							invoked.PrmContractLine				= ContractLine
						invoked.PrmServiceCode          	= ServiceCode
						invoked.PrmDescription         	    = DescriptionDisplay
						invoked.PrmQuantityMultiplier		= TransientQuantityMultiplier
						if (DefaultItemType.Service)
							invoked.PrmVendor				= DerivedVendor
							invoked.PrmPurchaseFromLocation	= DerivedPurchaseFromLocation
				
		CopyToRequisitionAll is an Instance Action 
			restricted
            Local Fields
            	LocalRequisitionLineView is a RequisitionLine view
            	LocalUnitCost					is an InternationalCost
            	LocalContract					is like Contract
				LocalContractLine				is like ContractLine
                                
            Parameters
            	PrmCompany              	    is an InventoryCompany
                PrmRequisition      	        is a Requisition
            	PrmQuantity                     is a Quantity
				PrmTransactionCurrencyCode		is a Currency
                PrmUOM                          is a UnitOfMeasure
                PrmTransactionUnitCost          is an InternationalCost
                PrmItemType                     is an ItemType
                PrmServiceCode                  is a ServiceCode
                PrmDescription                  is a Description
                PrmVendorItem                   is like VendorItem
				PrmToAccountingEntity			is a AccountingEntity
				PrmGeneralLedgerChartAccount	is a GeneralLedgerChartAccount
				PrmAccountingUnit				is like AccountingUnit
				PrmProject						is a Project
				PrmFinanceDimension1			is a FinanceDimension1
				PrmFinanceDimension2			is a FinanceDimension2
				PrmFinanceDimension3			is a FinanceDimension3
				PrmFinanceDimension4			is a FinanceDimension4
				PrmFinanceDimension5			is a FinanceDimension5
				PrmFinanceDimension6			is a FinanceDimension6
				PrmFinanceDimension7			is a FinanceDimension7
				PrmFinanceDimension8			is a FinanceDimension8
				PrmFinanceDimension9			is a FinanceDimension9
				PrmFinanceDimension10			is a FinanceDimension10
				PrmCostCode						is a CostCode
	            PrmSourcingEventRequired		is Boolean		
	            PrmAsset						is an Asset
	            PrmAssetTemplate				is an AssetTemplate
	            PrmContract						is a Contract
	            PrmContractLine					is a ContractLine
	            PrmAllocationPriority		    is a AllocationPriority
				PrmCostOption					is a CostOption
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a VendorLocation
				PrmMajorPurchasingClass         is a MajorPurchasingClass
				PrmMinorPurchasingClass			is a MinorPurchasingClass
	            PrmRequestingLocation  			is a RequestingLocation
				PrmFromCompanyLocation 			is a FromCompanyLocation  
	            PrmDate                			is Date
	            PrmBuyer						is a Buyer
	            PrmDeliverTo					is a DeliverTo
	            PrmPOCode						is a POCode
	            PrmPurchaseTaxCode				is a TaxCode
				PrmPurchaseTaxable				is Boolean
				PrmCommodityCode				is a CommCodes
				PrmQuantityMultiplier			is a Quantity
				
            Parameter Rules
            	PrmQuantity
                    default to Quantity
                PrmUOM
                    default to UnitOfMeasure
                PrmItemType
                    default to DefaultItemType
                PrmTransactionUnitCost
                    default to DefaultUnitCost
                PrmServiceCode
                    default to ServiceCode
                PrmDescription
                    default to DescriptionDisplay
                PrmVendorItem
                	if (SpecialItem)
                		if (HasContract)
                			default to ContractLine.VendorItem
                		else	
                    		default to Item

          	Action Rules
            	invoke CreateFromProcurementTemplateLineForRSS RequisitionLine 
                	assign result to LocalRequisitionLineView
        	        invoked.PrmInventoryCompany         = PrmCompany
        	        invoked.PrmProcurementTemplate		= ProcurementTemplate
        	        invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
        	        invoked.PrmRequisition              = PrmRequisition
                    invoked.PrmQuantity                 = PrmQuantity
                    invoked.PrmQuantityMultiplier       = PrmQuantityMultiplier
                    invoked.PrmTransactionCurrencyCode	= PrmTransactionCurrencyCode
                    invoked.PrmEnteredUOM               = DerivedUOM
                    invoked.PrmServiceCode          	= PrmServiceCode
                    invoked.PrmDescription         	    = PrmDescription
                    invoked.PrmVendorItem               = PrmVendorItem
					invoked.PrmToAccountingEntity		= PrmToAccountingEntity
					invoked.PrmGeneralLedgerChartAccount	= PrmGeneralLedgerChartAccount
					invoked.PrmAccountingUnit			= PrmAccountingUnit
					invoked.PrmProject					= PrmProject
					invoked.PrmFinanceDimension1		= PrmFinanceDimension1
					invoked.PrmFinanceDimension2		= PrmFinanceDimension2
					invoked.PrmFinanceDimension3		= PrmFinanceDimension3
					invoked.PrmFinanceDimension4		= PrmFinanceDimension4
					invoked.PrmFinanceDimension5		= PrmFinanceDimension5
					invoked.PrmFinanceDimension6		= PrmFinanceDimension6
					invoked.PrmFinanceDimension7		= PrmFinanceDimension7
					invoked.PrmFinanceDimension8		= PrmFinanceDimension8
					invoked.PrmFinanceDimension9		= PrmFinanceDimension9
					invoked.PrmFinanceDimension10		= PrmFinanceDimension10
					invoked.PrmSourcingEventRequired	= PrmSourcingEventRequired
					invoked.PrmAsset					= PrmAsset
					invoked.PrmAssetTemplate			= PrmAssetTemplate
					invoked.PrmAllocationPriority		= PrmAllocationPriority
					invoked.PrmCostOption				= PrmCostOption
					invoked.PrmMajorPurchasingClass		= PrmMajorPurchasingClass
					invoked.PrmMinorPurchasingClass     = PrmMinorPurchasingClass
					LocalUnitCost						= DefaultUnitCost
					LocalContract						= DerivedContractID
					LocalContractLine					= DerivedContractLine
					
					if (LocalVendor  entered)
					    invoked.PrmVendor					= LocalVendor 
					    invoked.PrmPurchaseFromLocation 	= LocalPurchaseFromLocation
					else
						invoked.PrmVendor					= PrmVendor
						invoked.PrmPurchaseFromLocation		= PrmPurchaseFromLocation
					
					if (DefaultItemType.Service or HasContract)
						if (ContractIsWithinEffectiveDate
						and not ContractLineRel.OnHold)
							invoked.PrmContract					= Contract
							invoked.PrmContractLine				= ContractLine
					else
						if  (PrmTransactionUnitCost 	not = 0
						and  DerivedContractID  not = 0)
							invoked.PrmContract				= DerivedContractID
							invoked.PrmContractLine			= DerivedContractLine
					if (PrmFromCompanyLocation entered)
						invoked.PrmFromCompany				= PrmFromCompanyLocation.FromCompany
						invoked.PrmFromLocation				= PrmFromCompanyLocation.FromLocation
	            	if (PrmAllocationPriority entered)
	            		invoked.PrmAllocationPriority 		= PrmAllocationPriority 
					if (PrmCommodityCode entered)
						invoked.PrmCommodityCode			= PrmCommodityCode  	
					if (PrmDate entered)
						invoked.PrmDate 		= PrmDate
					if (PrmRequestingLocation entered)
						invoked.PrmRequestingLocation 			= PrmRequestingLocation
					if (PrmBuyer entered)
						invoked.PrmBuyer 					= PrmBuyer  
	            	if (PrmDeliverTo entered)
	            		invoked.PrmDeliverTo				= PrmDeliverTo
	            	if (PrmPOCode entered)
	            		invoked.PrmPOCode					= PrmPOCode
	    	        if (PrmPurchaseTaxCode entered)
	    	        	invoked.PrmPurchaseTaxCode			= PrmPurchaseTaxCode
					if (PrmPurchaseTaxable entered)
						invoked.PrmPurchaseTaxable			= PrmPurchaseTaxable  
						
                NewRequisition = PrmRequisition
                NewRequisitionLine = LocalRequisitionLineView.RequisitionLine  

        BatchCopyToRequisitionAllRSS is a Set Action
            restricted
            run in background
			
            Local Fields
            	LocalRequisitionLineView is a RequisitionLine view
            	LocalUnitCost					is an InternationalCost
            	LocalContract					is like Contract
				LocalContractLine				is like ContractLine
				CreateErrorMessage				is Alpha size 200
                                
            Parameters
            	PrmCompany              	    is an InventoryCompany
            	PrmProcurementTemplate			is a ProcurementTemplate
                PrmRequisition      	        is a Requisition
            	PrmQuantity                     is a Quantity
				PrmTransactionCurrencyCode		is a Currency
                PrmUOM                          is a UnitOfMeasure
                PrmTransactionUnitCost          is an InternationalCost
                PrmItemType                     is an ItemType
                PrmServiceCode                  is a ServiceCode
                PrmDescription                  is a Description
                PrmVendorItem                   is like VendorItem
				PrmToAccountingEntity			is a AccountingEntity
				PrmGeneralLedgerChartAccount	is a GeneralLedgerChartAccount
				PrmAccountingUnit				is like AccountingUnit
				PrmProject						is a Project
				PrmFinanceDimension1			is a FinanceDimension1
				PrmFinanceDimension2			is a FinanceDimension2
				PrmFinanceDimension3			is a FinanceDimension3
				PrmFinanceDimension4			is a FinanceDimension4
				PrmFinanceDimension5			is a FinanceDimension5
				PrmFinanceDimension6			is a FinanceDimension6
				PrmFinanceDimension7			is a FinanceDimension7
				PrmFinanceDimension8			is a FinanceDimension8
				PrmFinanceDimension9			is a FinanceDimension9
				PrmFinanceDimension10			is a FinanceDimension10
				PrmCostCode						is a CostCode
	            PrmSourcingEventRequired		is Boolean		
	            PrmAsset						is an Asset
	            PrmAssetTemplate				is an AssetTemplate
	            PrmContract						is a Contract
	            PrmContractLine					is a ContractLine
	            PrmAllocationPriority		    is a AllocationPriority
				PrmCostOption					is a CostOption
				PrmVendor						is a Vendor
				PrmPurchaseFromLocation			is a VendorLocation
				PrmMajorPurchasingClass         is a MajorPurchasingClass
				PrmMinorPurchasingClass			is a MinorPurchasingClass
	            PrmRequestingLocation  			is a RequestingLocation
				PrmFromCompanyLocation 			is a FromCompanyLocation  
	            PrmDate                			is Date
	            PrmBuyer						is a Buyer
	            PrmDeliverTo					is a DeliverTo
	            PrmPOCode						is a POCode
	            PrmPurchaseTaxCode				is a TaxCode
				PrmPurchaseTaxable				is Boolean
				PrmCommodityCode				is a CommCodes
				PrmQuantityMultiplier			is a Quantity
				
            Parameter Rules
            	PrmQuantity
                    default to Quantity
                PrmUOM
                    default to UnitOfMeasure
                PrmItemType
                    default to DefaultItemType
                PrmTransactionUnitCost
                    default to DefaultUnitCost
                PrmServiceCode
                    default to ServiceCode
                PrmDescription
                    default to DescriptionDisplay
                PrmVendorItem
                	if (SpecialItem)
                		if (HasContract)
                			default to ContractLine.VendorItem
                		else	
                    		default to Item
				
			Instance Selection
				where 	(ProcurementTemplate = PrmProcurementTemplate)

          	Action Rules
          		Instance Rules
				  	initialize CreateErrorMessage
	            	invoke CreateFromProcurementTemplateLineForRSS RequisitionLine 
	                	assign result to LocalRequisitionLineView
						resume on error
							CreateErrorMessage = error message
	        	        invoked.PrmInventoryCompany         = PrmCompany
	        	        invoked.PrmProcurementTemplate		= ProcurementTemplate
	        	        invoked.PrmProcurementTemplateLine	= ProcurementTemplateLine
	        	        invoked.PrmRequisition              = PrmRequisition
	                    invoked.PrmQuantity                 = PrmQuantity
	                    invoked.PrmQuantityMultiplier       = PrmQuantityMultiplier
	                    invoked.PrmTransactionCurrencyCode	= PrmTransactionCurrencyCode
	                    invoked.PrmEnteredUOM               = DerivedUOM
	                    invoked.PrmServiceCode          	= PrmServiceCode
	                    invoked.PrmDescription         	    = PrmDescription
	                    invoked.PrmVendorItem               = PrmVendorItem
						invoked.PrmToAccountingEntity		= PrmToAccountingEntity
						invoked.PrmGeneralLedgerChartAccount	= PrmGeneralLedgerChartAccount
						invoked.PrmAccountingUnit			= PrmAccountingUnit
						invoked.PrmProject					= PrmProject
						invoked.PrmFinanceDimension1		= PrmFinanceDimension1
						invoked.PrmFinanceDimension2		= PrmFinanceDimension2
						invoked.PrmFinanceDimension3		= PrmFinanceDimension3
						invoked.PrmFinanceDimension4		= PrmFinanceDimension4
						invoked.PrmFinanceDimension5		= PrmFinanceDimension5
						invoked.PrmFinanceDimension6		= PrmFinanceDimension6
						invoked.PrmFinanceDimension7		= PrmFinanceDimension7
						invoked.PrmFinanceDimension8		= PrmFinanceDimension8
						invoked.PrmFinanceDimension9		= PrmFinanceDimension9
						invoked.PrmFinanceDimension10		= PrmFinanceDimension10
						invoked.PrmSourcingEventRequired	= PrmSourcingEventRequired
						invoked.PrmAsset					= PrmAsset
						invoked.PrmAssetTemplate			= PrmAssetTemplate
						invoked.PrmAllocationPriority		= PrmAllocationPriority
						invoked.PrmCostOption				= PrmCostOption
						invoked.PrmMajorPurchasingClass		= PrmMajorPurchasingClass
						invoked.PrmMinorPurchasingClass     = PrmMinorPurchasingClass
						LocalUnitCost						= DefaultUnitCost
						LocalContract						= DerivedContractID
						LocalContractLine					= DerivedContractLine
						
						if (LocalVendor  entered)
						    invoked.PrmVendor					= LocalVendor 
						    invoked.PrmPurchaseFromLocation 	= LocalPurchaseFromLocation
						else
							invoked.PrmVendor					= PrmVendor
							invoked.PrmPurchaseFromLocation		= PrmPurchaseFromLocation
						
						if (DefaultItemType.Service or HasContract)
							if (ContractIsWithinEffectiveDate
							and not ContractLineRel.OnHold)
								invoked.PrmContract					= Contract
								invoked.PrmContractLine				= ContractLine
						else
							if  (PrmTransactionUnitCost 	not = 0
							and  DerivedContractID  not = 0)
								invoked.PrmContract				= DerivedContractID
								invoked.PrmContractLine			= DerivedContractLine
						if (PrmFromCompanyLocation entered)
							invoked.PrmFromCompany				= PrmFromCompanyLocation.FromCompany
							invoked.PrmFromLocation				= PrmFromCompanyLocation.FromLocation
		            	if (PrmAllocationPriority entered)
		            		invoked.PrmAllocationPriority 		= PrmAllocationPriority 
						if (PrmCommodityCode entered)
							invoked.PrmCommodityCode			= PrmCommodityCode  	
						if (PrmDate entered)
							invoked.PrmDate 		= PrmDate
						if (PrmRequestingLocation entered)
							invoked.PrmRequestingLocation 			= PrmRequestingLocation
						if (PrmBuyer entered)
							invoked.PrmBuyer 					= PrmBuyer  
		            	if (PrmDeliverTo entered)
		            		invoked.PrmDeliverTo				= PrmDeliverTo
		            	if (PrmPOCode entered)
		            		invoked.PrmPOCode					= PrmPOCode
		    	        if (PrmPurchaseTaxCode entered)
		    	        	invoked.PrmPurchaseTaxCode			= PrmPurchaseTaxCode
						if (PrmPurchaseTaxable entered)
							invoked.PrmPurchaseTaxable			= PrmPurchaseTaxable  

					if (CreateErrorMessage entered)
						invoke Create RequisitionLineError
			                invoked.Company					= PrmCompany
			                invoked.Requisition				= PrmRequisition
							invoked.ErrorType 				= RequisitionLineError.ErrorType.Create
							if (CreateErrorMessage[1:7] = "Warning")
								invoked.ErrorMessageNumber 	= 999
							else
								invoked.ErrorMessage 		= TemplateMessage + PrmProcurementTemplate + LineMessage + ProcurementTemplateLine + ": " + CreateErrorMessage
						
	                NewRequisition = PrmRequisition
	                NewRequisitionLine = LocalRequisitionLineView.RequisitionLine  

		BuildTextIndexes is an Instance Action
			restricted
			Action Rules
				include BuildTextIndex
				include BuildTemplateTextIndex					
						
		BuildTemplateTextIndex is an Instance Action
			restricted
			Action Rules
				include BuildTemplateTextIndex
				
		BuildTextIndexesForTemplateLines is a Set Action
			restricted
			run in background
			Parameters
				ParmProcurementGroup	is a ProcurementGroup
					default label is "ProcurementGroup"
			Parameter Rules
				ParmProcurementGroup
					required
						"ProcurementGroupIsRequired"
				
			Instance Selection
				where 	(ProcurementGroup	= ParmProcurementGroup)
				
			Action Rules
				Instance Rules
					invoke BuildTextIndexes

		BuildTextIndexesForAnItem is a Set Action
			restricted
			run in background
			Parameters
				ParmProcurementGroup	is a ProcurementGroup
					default label is "ProcurementGroup"
				ParmItem				is a Item
					default label is "Item"
			Parameter Rules
				ParmProcurementGroup
					required
						"ProcurementGroupIsRequired"
				ParmItem
					required
						"ItemIsRequired"
			Sort Order
				ProcurementGroup
    			Item
    			ProcurementTemplate
    			ProcurementTemplateLine

			Instance Selection
				where 	(ProcurementGroup	= ParmProcurementGroup
				and		Item				= ParmItem)
				
			Action Rules
				Instance Rules
					invoke BuildTextIndexes
